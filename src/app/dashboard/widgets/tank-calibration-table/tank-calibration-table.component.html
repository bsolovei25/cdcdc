<evj-widget-preview
  [title]="widgetTitle"
  [previewTitle]="widgetType"
  *ngIf="isMock"
></evj-widget-preview>

<div class="container" *ngIf="!isMock">
  <evj-widget-header
    [title]="widgetTitle"
    [units]="widgetUnits"
    [code]="widgetCode"
    [id]="id"
    [uniqId]="uniqId"
    [widgetType]="widgetType"
    [icon]="widgetIcon"
    (selected)="selectTable($event)"
  ></evj-widget-header>

  <evj-frame-top></evj-frame-top>
  <div class="content">
    <ng-container *ngIf="isReport">
      <section
        class="table__left"
        (mousedown)="$event.stopPropagation()"
        (touchstart)="$event.stopPropagation()"
      >
        <div class="table scroll-bar" #tableBody>
          <table>
            <thead>
              <tr class="header__items">
                <th class="header header__th header__name">
                  Наименование
                </th>
                <th class="header header__th header__date">
                  Дата начала калибровки
                  <svg-icon
                    src="assets/icons/widgets/calibration-table/sort-up.svg"
                    [svgStyle]="{ 'width.px':12, 'height.px':12 }"
                  ></svg-icon>
                </th>
                <th class="header header__th header__date">
                  Дата окончания калибровки
                  <svg-icon
                    src="assets/icons/widgets/calibration-table/sort-bottom.svg"
                    [svgStyle]="{ 'width.px':12, 'height.px':12 }"
                  ></svg-icon>
                </th>
                <th class="header header__th header__action">
                  Действия с калибровками
                </th>
              </tr>
            </thead>
            <tbody class="table__body">
              <ng-container *ngFor="let element of dataSource">
                <tr
                  class="table__item"
                  (click)="expandedElement.isSelected(element) ? 
                expandedElement.deselect(element)
              : expandedElement.select(element)"
                >
                  <td class="item item__tr">
                    <svg-icon
                      class="item__tr-icon"
                      src="assets/icons/widgets/calibration-table/arrow.svg"
                      [svgStyle]="{ 'width.px':8, 'height.px':5 }"
                      [class.arrow-rtl]="expandedElement.isSelected(element)"
                    ></svg-icon>
                    <span class="item__tr-name">{{ element.name }}</span>
                  </td>
                </tr>
                <ng-container *ngFor="let elementChildren of getChildrenRows(element)">
                  <tr
                    *ngIf="expandedElement.isSelected(element)"
                    [class.expanded-row]="elementChildren"
                  >
                    <td [class.expanded-column]="elementChildren" class="item item__td item__name">
                      {{ elementChildren.name }}
                    </td>
                    <td [class.expanded-column]="elementChildren" class="item item__td item__date">
                      {{ elementChildren.startDate | date }}
                    </td>
                    <td [class.expanded-column]="elementChildren" class="item item__td item__date">
                      {{ elementChildren.endDate | date }}
                    </td>
                    <td
                      [class.expanded-column]="elementChildren"
                      class="item item__td item__action"
                    >
                      <svg-icon
                        class="item__action-icon"
                        src="assets/icons/widgets/calibration-table/upload.svg"
                        [svgStyle]="{ 'width.px':20, 'height.px':20 }"
                      ></svg-icon>
                      <svg-icon
                        class="item__action-icon"
                        src="assets/icons/widgets/calibration-table/download.svg"
                        [svgStyle]="{ 'width.px':20, 'height.px':20 }"
                      ></svg-icon>
                      <span class="item__action-trash">
                        <svg-icon
                          src="assets/icons/widgets/calibration-table/trash.svg"
                          [svgStyle]="{ 'width.px':20, 'height.px':20 }"
                        ></svg-icon>
                      </span>
                    </td>
                  </tr>
                </ng-container>
              </ng-container>
              <ng-container *ngFor="let end of endTr">
                <tr class="table__item expanded-row">
                  <td class="item item__td item__name"></td>
                  <td class="item item__td item__date"></td>
                  <td class="item item__td item__date"></td>
                  <td class="item item__td item__action"></td>
                </tr>
              </ng-container>
            </tbody>
            <tfoot>
              <div class="bottom-reference-left">
                <div class="bottom-reference-left__block">
                  <div class="bottom-reference-left__button-add">
                    <svg-icon
                      src="./assets/icons/widgets/references/add_white.svg"
                      class="add_button_icon"
                    >
                    </svg-icon>
                  </div>
                  <div class="bottom-reference-left__input-block">
                    <div class="bottom-reference-left__button-search">
                      <svg-icon
                        class="button_filter_icon"
                        src="./assets/icons/widgets/references/search_white.svg"
                      >
                      </svg-icon>
                    </div>
                    <div class="bottom-reference-left__input">
                      <input type="text" />
                    </div>
                  </div>
                </div>
              </div>
            </tfoot>
          </table>
        </div>
      </section>

      <section
        class="table__right"
        (mousedown)="$event.stopPropagation()"
        (touchstart)="$event.stopPropagation()"
      >
        <div class="table scroll-bar" #tableRight>
          <table>
            <thead>
              <tr class="header__items">
                <th class="header header__th header__name">
                  Наименование
                </th>
                <th class="header header__th header__name">
                  Наименование
                </th>
                <th class="header header__th header__name">
                  Наименование
                </th>
              </tr>
            </thead>
            <tbody class="table__body">
              <ng-container *ngFor="let element of dataSource">
                <tr *ngIf="expandedElement.isSelected(element)" class="expanded-row">
                  <td class="item item__td item__name">
                    {{ element.name }}
                  </td>
                  <td class="item item__td item__name">
                    {{ element.name }}
                  </td>
                  <td class="item item__td item__name">
                    {{ element.name }}
                  </td>
                </tr>
              </ng-container>
              <ng-container *ngFor="let end of endTr2">
                <tr class="table__item expanded-row">
                  <td class="item item__td item__name"></td>
                  <td class="item item__td item__name"></td>
                  <td class="item item__td item__name"></td>
                </tr>
              </ng-container>
            </tbody>
            <tfoot>
              <div class="bottom-reference-left">
                <div class="bottom-reference-left__block">
                  <div class="bottom-reference-left__button-add"></div>
                  <div class="bottom-reference-left__input-block">
                    Таблица с калибровок резервуара
                  </div>
                  <div
                    style="width: 70px; height: 20px; border-radius: 7px; background-color: aqua;"
                  ></div>
                </div>
              </div>
            </tfoot>
          </table>
        </div>
      </section>
    </ng-container>
    <ng-container *ngIf="!isReport">
      <evj-tank-calibration-table-files></evj-tank-calibration-table-files
    ></ng-container>
  </div>
  <evj-frame-bottom></evj-frame-bottom>
</div>
