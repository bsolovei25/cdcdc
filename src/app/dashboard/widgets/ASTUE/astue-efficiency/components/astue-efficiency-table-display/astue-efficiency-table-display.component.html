<div class="table-display">
  <div class="table-display__header header">
    <div class="header__buttons" *ngIf="isInitialDataShow;else title">
      <div class="button" (click)="clickDisplayButton()">Графическое отображение</div>
      <div class="button button_active">Табличное отображение</div>
    </div>
    <ng-template #title>
      <div class="header__title">
        <img
          class="arrow"
          [ngClass]="{'arrow_open':isDropdownOpen}"
          src="assets/icons/widgets/ASTUE/astue-efficiency/units/arrow.svg"
        />
        <div
          class="title item"
          *ngIf="scriptSelection.hasValue();else default"
          (click)="toggleDropdown()"
        >
          <div class="item__name">{{scriptSelection.selected[0].name}}</div>
          <div class="item__dates">
            {{scriptSelection.selected[0].fromDateTime|date:"dd.mm.yyyy | hh:MM"}} -
            {{scriptSelection.selected[0].toDateTime|date:"dd.mm.yyyy | hh:MM"}}
          </div>
        </div>
        <ng-template #default>
          <div class="title" (click)="toggleDropdown()">Выберите сценарий пользователя</div>
        </ng-template>
        <div class="dropdown" [ngClass]="{'dropdown_open': isDropdownOpen}">
          <div
            class="dropdown__item item"
            (click)="selectScript(script)"
            *ngFor="let script of scripts"
          >
            <div class="item__name">{{script.name}}</div>
            <div class="item__dates">
              {{script.fromDateTime|date:"dd.mm.yyyy | hh:MM"}} -
              {{script.toDateTime|date:"dd.mm.yyyy | hh:MM"}}
            </div>
          </div>
        </div>
      </div>
    </ng-template>
    <div class="header__right">
      <div class="button">Сформировать отчет</div>
      <div class="button">Сохранить</div>
      <div class="button">Отмена</div>
    </div>
  </div>
  <div class="table-display__container">
    <div class="table-display__table table">
      <table>
        <thead>
          <tr class="table__header table-header">
            <th class="table-header__item" *ngIf="isInitialDataShow; else tableTitle">
              Наименование
            </th>
            <ng-template #tableTitle>
              <th class="table-header__item">Показатели</th>
            </ng-template>
            <th class="table-header__item">Итого</th>
            <th class="table-header__item" *ngFor="let value of data[0].data">
              {{value.date|date:'dd.MM'}}
            </th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let block of data">
            <tr
              class="table__row block"
              [ngClass]="{'block_open':blockSelection.isSelected(block)}"
              (click)="blockSelection.toggle(block)"
            >
              <td class="block__item" [ngClass]="{'block__item-status': block.status}">
                <img
                  class="arrow"
                  src="assets/icons/widgets/ASTUE/astue-efficiency/units/arrow.svg"
                />
                {{block.name}}
                <div class="status" *ngIf="block.status">{{block.status}}</div>
              </td>
              <div class="block__item" style="border-left: none;" *ngIf="block.status"></div>
              <td class="block__item with-status" *ngIf="block.status;else values"></td>
              <ng-template #values>
                <td class="block__item">{{block.dataSummary}}</td>
                <td class="block__item" *ngFor="let value of block.data">
                  <input
                    type="text"
                    class="cell__input"
                    [(ngModel)]="value.value"
                    [disabled]="!value.isEditable"
                    placeholder="Введите значение"
                    (focus)="$event.target.select()"
                    (change)="defineDataSummary(block)"
                  />
                  <div class="cell__indicator" *ngIf="!!value.value && value.isEditable"></div>
                  <img
                    class="cell__edit"
                    src="assets/icons/widgets/ASTUE/astue-efficiency/table/edit.svg"
                  />
                </td>
              </ng-template>
            </tr>
            <ng-container *ngIf="blockSelection.isSelected(block)">
              <tr class="table__row row" *ngFor="let child of block.children">
                <td class="row__item">
                  {{child.name}}
                  <div class="status" *ngIf="block.status">{{block.status}}</div>
                </td>
                <td class="row__item">{{child.dataSummary}}</td>
                <td class="row__item" *ngFor="let value of child.data">
                  <input
                    type="text"
                    class="cell__input"
                    [(ngModel)]="value.value"
                    [disabled]="!value.isEditable"
                    placeholder="Введите значение"
                    (focus)="$event.target.select()"
                    (change)="defineDataSummary(child)"
                  />
                  <div class="cell__indicator" *ngIf="!!value.value && value.isEditable"></div>
                  <img
                    class="cell__edit"
                    src="assets/icons/widgets/ASTUE/astue-efficiency/table/edit.svg"
                  />
                </td>
              </tr>
            </ng-container>
          </ng-container>
          <ng-container *ngIf="!isInitialDataShow">
            <tr class="table__row separation-line">
              <td class="separation-line__item">Отклонения</td>
              <td class="separation-line__item"></td>
            </tr>
            <ng-container *ngFor="let deviation of deviationsData">
              <tr class="table__row block" (click)="blockSelection.toggle(deviation)">
                <td class="block__item" [ngClass]="{'block__item-status': deviation.status}">
                  <img
                    class="arrow"
                    src="assets/icons/widgets/ASTUE/astue-efficiency/units/arrow.svg"
                  />
                  {{deviation.name}}
                  <img
                    class="separator"
                    src="assets/icons/widgets/ASTUE/astue-efficiency/table/separator.svg"
                  />
                  {{deviation.relativeName}}
                </td>
                <div class="block__item" style="border-left: none;"></div>
                <td class="block__item with-status"></td>
              </tr>
              <ng-container *ngIf="blockSelection.isSelected(deviation)">
                <tr class="table__row row" *ngFor="let child of deviation.children">
                  <td class="row__item">
                    {{child.name}}
                    <div class="status" *ngIf="deviation.status">{{deviation.status}}</div>
                  </td>
                  <td class="row__item">{{child.dataSummary}}</td>
                  <td class="row__item" *ngFor="let value of child.data">
                    <input
                      type="text"
                      class="cell__input"
                      [(ngModel)]="value.value"
                      [disabled]="!value.isEditable"
                      placeholder="Введите значение"
                      (focus)="$event.target.select()"
                      (change)="defineDataSummary(child)"
                    />
                    <div class="cell__indicator" *ngIf="!!value.value && value.isEditable"></div>
                    <img
                      class="cell__edit"
                      src="assets/icons/widgets/ASTUE/astue-efficiency/table/edit.svg"
                    />
                  </td>
                </tr>
              </ng-container>
            </ng-container>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>
