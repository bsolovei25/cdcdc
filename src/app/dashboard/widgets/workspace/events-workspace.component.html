<evj-widget-preview [title]="title" [icon]="icon" [previewTitle]="previewTitle" *ngIf="isMock"></evj-widget-preview>

<ng-container *ngIf="!isMock">
  <div class="container pointer-event">
    <!-- loading data -->
    <!-- <div class="loading-shade" *ngIf="isLoading">
      <div class="item loading-6">
        <svg viewBox="25 25 50 50">
          <circle cx="50" cy="50" r="20"></circle>
        </svg>
      </div>
    </div> -->
    <evj-widget-header [title]="title" [id]="id" [uniqId]="uniqId" [icon]="icon"></evj-widget-header>

    <evj-frame-top></evj-frame-top>

    <!--  Event -->
    <!-- <ng-container *ngIf="!isMock && event"> -->
    <ng-container>
      <section *ngIf="true" class="workspace" (mousedown)="$event.stopPropagation()"
        (touchstart)="$event.stopPropagation()">
        <div class="workspace__header">
          <evj-ui-block class="workspace__header__block" status="normal">
            <mat-form-field class="status">
              <mat-label>Статус</mat-label>
              <mat-select panelClass="mat-select-custom">
                <mat-option *ngFor="let food of foods" [value]="food.value">
                  {{food.viewValue}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </evj-ui-block>
          <evj-ui-block class="workspace__header__block" status="danger">
            <mat-form-field class="priority">
              <mat-label>Приоритет</mat-label>
              <mat-select panelClass="mat-select-custom">
                <mat-option *ngFor="let food of foods" [value]="food.value">
                  {{food.viewValue}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </evj-ui-block>
          <evj-ui-block class="workspace__header__block" status="accept">
            <mat-form-field class="accept">
              <mat-label>Событие</mat-label>
              <mat-select panelClass="mat-select-custom">
                <mat-option *ngFor="let food of foods" [value]="food.value">
                  {{food.viewValue}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </evj-ui-block>
        </div>

        <div class="workspace__body">
          <div class="workspace__body__left">
            <div class="select__block">
              <div class="categories">
                <evj-ui-block class="workspace__header__block" status="normal">
                  <mat-form-field>
                    <mat-label>Категория</mat-label>
                    <mat-select panelClass="mat-select-custom">
                      <mat-option *ngFor="let food of foods" [value]="food.value">
                        {{food.viewValue}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </evj-ui-block>
              </div>
              <div class="type">
                <evj-ui-block class="workspace__header__block" status="normal">
                  <mat-form-field>
                    <mat-label>Тип оборудования</mat-label>
                    <mat-select panelClass="mat-select-custom">
                      <mat-option *ngFor="let food of foods" [value]="food.value">
                        {{food.viewValue}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </evj-ui-block>
              </div>
              <div class="type_incident">
                <evj-ui-block class="workspace__header__block" status="normal">
                  <mat-form-field>
                    <mat-label>Тип происшествия</mat-label>
                    <mat-select panelClass="mat-select-custom">
                      <mat-option *ngFor="let food of foods" [value]="food.value">
                        {{food.viewValue}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </evj-ui-block>
              </div>
              <div class="number_position">
                <evj-ui-block class="workspace__header__block" status="normal">
                  <mat-form-field>
                    <mat-label>Номер позиции</mat-label>
                    <mat-select panelClass="mat-select-custom">
                      <mat-option *ngFor="let food of foods" [value]="food.value">
                        {{food.viewValue}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </evj-ui-block>
              </div>
            </div>

            <div class="description">
              <div class="description_nav">
                <div class="description_title">Краткое описание</div>
                <div class="description_button_update">Р</div>
              </div>
              <div class="description__content">
                <div class="description__content_text">
                  Неисправность расходомера FIRCАHL-1008 «Расход МЭА в колонну К-2» в 8:20. Переход
                  на ручное управление клапаном 12FV-1008 в 8:22 Остановка насоса Н-17А по
                  блокировке поз. FISAL1043 на установке ГФУ-2 с БОР производства №1
                </div>
              </div>
              <div class="frame_description_bottom"></div>
            </div>

            <div class="fact_block">
              <div class="title_fact_block">
                <div class="title_fact_block_text">
                  кекчебурек
                </div>
              </div>
              <div class="fact_content">
                <!--ngFor -->
                <div class="fact_new">
                  <div class="fact_text">
                    <span>Неисправность расходомера FIRCАHL-1008 «Расход МЭА в колонну К-2» в 8:20.
                      Переход на ручное управление клапаном 12FV-1008 в 8:22 Остановка насоса Н-17А по
                      блокировке поз. FISAL1043 на установке ГФУ-2 с БОР производства №1</span>
                  </div>
                  <div class="fact_menu">
                    <div class="fact_button">
                      <div class="fact_button_update"></div>
                      <div class="fact_button_delete"></div>
                    </div>
                    <div class="fact_info"></div>
                  </div>
                </div>
                <div class="fact_new">
                  <div class="fact_text">
                    Неисправность расходомера FIRCАHL-1008 «Расход МЭА в колонну К-2» в 8:20.
                    Переход на ручное управление клапаном 12FV-1008 в 8:22 Остановка насоса Н-17А по
                    блокировке поз. FISAL1043 на установке ГФУ-2 с БОР производства №1
                  </div>
                  <div class="fact_menu">
                    <div class="fact_button">
                      <div class="fact_button_update"></div>
                      <div class="fact_button_delete"></div>
                    </div>
                    <div class="fact_info"></div>
                  </div>
                </div>
                <div class="fact_new">
                  <div class="fact_text">
                    Неисправность расходомера FIRCАHL-1008 «Расход МЭА в колонну К-2» в 8:20.
                    Переход на ручное управление клапаном 12FV-1008 в 8:22 Остановка насоса Н-17А по
                    блокировке поз. FISAL1043 на установке ГФУ-2 с БОР производства №1
                  </div>
                  <div class="fact_menu">
                    <div class="fact_button">
                      <div class="fact_button_update"></div>
                      <div class="fact_button_delete"></div>
                    </div>
                    <div class="fact_info"></div>
                  </div>
                </div>
                <div class="fact_new">
                  <div class="fact_text">
                    Неисправность расходомера FIRCАHL-1008 «Расход МЭА в колонну К-2» в 8:20.
                    Переход на ручное управление клапаном 12FV-1008 в 8:22 Остановка насоса Н-17А по
                    блокировке поз. FISAL1043 на установке ГФУ-2 с БОР производства №1
                  </div>
                  <div class="fact_menu">
                    <div class="fact_button">
                      <div class="fact_button_update"></div>
                      <div class="fact_button_delete"></div>
                    </div>
                    <div class="fact_info"></div>
                  </div>
                </div>
              </div>
              <div class="empty"></div>
              <div class="fact_comment">
                <div class="comment__new">
                  <input type="text" class="comment__text gridster-item-content"
                    placeholder="Напишите свой комментарий..." (keypress)="onEnterPush($event)" #input />
                  <button type="submit" class="button comment__file   gridster-item-content">
                    <svg-icon class="button__icon" src="./assets/icons/widgets/change-shift/add_file.svg"></svg-icon>
                  </button>
                  <button type="submit" class="button comment__submit  gridster-item-content" (click)="onSendMessage()">
                    <svg-icon class="button__icon" src="./assets/icons/widgets/change-shift/send.svg"></svg-icon>
                  </button>
                </div>
              </div>
            </div>

            <div class="comments_block">
              <div class="title_comments_block">
                <div class="title_comments_block_text">
                  кекчебурек
                </div>
              </div>
              <div class="comments_content">
                <!--ngFor -->
                <div class="comment_new">
                  <div class="comment_text">
                    Неисправность расходомера FIRCАHL-1008 «Расход МЭА в колонну К-2» в 8:20.
                    Переход на ручное управление клапаном 12FV-1008 в 8:22 Остановка насоса Н-17А по
                    блокировке поз. FISAL1043 на установке ГФУ-2 с БОР производства №1
                  </div>
                  <div class="comment_menu">
                    <div class="comment_button">
                      <div class="comment_button_update"></div>
                      <div class="comment_button_delete"></div>
                    </div>
                    <div class="comment_info"></div>
                  </div>
                </div>
              </div>
              <div class="empty"></div>
              <div class="fact_comment">
                <div class="comment__new">
                  <input type="text" class="comment__text gridster-item-content"
                    placeholder="Напишите свой комментарий..." (keypress)="onEnterPush($event)" #input />
                  <button type="submit" class="button comment__file   gridster-item-content">
                    <svg-icon class="button__icon" src="./assets/icons/widgets/change-shift/add_file.svg"></svg-icon>
                  </button>
                  <button type="submit" class="button comment__submit  gridster-item-content" (click)="onSendMessage()">
                    <svg-icon class="button__icon" src="./assets/icons/widgets/change-shift/send.svg"></svg-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="workspace__body__right">
            <div class="info_block">
              <div class="place">
                <div class="place_title">
                  Место:
                </div>
                <div class="place_body">
                  ГФУ-2 с БОР
                </div>
              </div>
              <div class="creator">
                <div class="creator_title">
                  Автор
                </div>
                <div class="creator_body">Иванов И.И.</div>
              </div>
              <div class="deadline">
                <mat-form-field>
                  <input matInput [matDatepicker]="myDatepicker" />
                  <mat-datepicker-toggle matSuffix [for]="myDatepicker"></mat-datepicker-toggle>
                  <mat-datepicker #myDatepicker></mat-datepicker>
                </mat-form-field>
              </div>
            </div>
            <div class="responsible">
              <evj-ui-block class="workspace__header__block" status="normal">
                <mat-form-field>
                  <mat-label>Отвественный</mat-label>
                  <mat-select panelClass="mat-select-custom">
                    <mat-option *ngFor="let food of foods" [value]="food.value">
                      {{food.viewValue}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </evj-ui-block>
            </div>
            <div class="events-correct">
              <div class="events-correct-block">
                <div class="event_info">
                  <div class="event_info_title">Корректирующие мероприятия</div>
                  <div class="event_info_date">
                    <div class="event_info_date_title">Начало события</div>
                    <div class="event_info_date_body">
                      25.02.2020 | 13.23
                    </div>
                  </div>
                </div>
                <div class="events">
                  <div class="events_content">
                    <div class="events_container">
                      <div class="events_info">
                        <div class="events_info_title">Кратное описание</div>
                        <div class="events_info_body">
                          Неисправность расходомера FIRCАHL-1008 «Расход МЭА в колонну К-2» в 8:20.
                          Переход на ручное управление клапаном 12FV-1008 в 8:22 Остановка насоса Н-17А по
                          блокировке поз. FISAL1043 на установке ГФУ-2 с БОР производства №1
                        </div>
                      </div>
                      <div class="events_status">
                        <div class="events_status_status">Потрачено</div>
                        <div class="events_status_datetime">
                          <div class="datetime_title">Срок исполнения</div>
                          <div class="datetime_body"> 25.02.2020 | 13.23</div>
                        </div>
                        <div class="events_status_responsible">
                          <div class="responsible_title">Ответственный</div>
                          <div class="responsible_body">Иванов Иван Иванович</div>
                        </div>
                      </div>
                    </div>
                    <div class="events_menu">
                      <div class="events_check"></div>
                      <div class="events_button">
                        <div clas="events_button_delete"></div>
                        <div clas="events_button_update"></div>
                      </div>
                    </div>
                    <div class="progress_line"></div>
                  </div>
                  <div class="events_content">
                    <div class="events_container">
                      <div class="events_info">
                        <div class="events_info_title">Кратное описание</div>
                        <div class="events_info_body">
                          Неисправность расходомера FIRCАHL-1008 «Расход МЭА в колонну К-2» в 8:20.
                          Переход на ручное управление клапаном 12FV-1008 в 8:22 Остановка насоса Н-17А по
                          блокировке поз. FISAL1043 на установке ГФУ-2 с БОР производства №1
                        </div>
                      </div>
                      <div class="events_status">
                        <div class="events_status_status">Потрачено</div>
                        <div class="events_status_datetime">
                          <div class="datetime_title">Срок исполнения</div>
                          <div class="datetime_body"> 25.02.2020 | 13.23</div>
                        </div>
                        <div class="events_status_responsible">
                          <div class="responsible_title">Ответственный</div>
                          <div class="responsible_body">Иванов Иван Иванович</div>
                        </div>
                      </div>
                    </div>
                    <div class="events_menu">
                      <div class="events_check"></div>
                      <div class="events_button">
                        <div clas="events_button_delete"></div>
                        <div clas="events_button_update"></div>
                      </div>
                    </div>
                    <div class="progress_line"></div>
                  </div>
                  <div class="events_content">
                    <div class="events_container">
                      <div class="events_info">
                        <div class="events_info_title">Кратное описание</div>
                        <div class="events_info_body">
                          Неисправность расходомера FIRCАHL-1008 «Расход МЭА в колонну К-2» в 8:20.
                          Переход на ручное управление клапаном 12FV-1008 в 8:22 Остановка насоса Н-17А по
                          блокировке поз. FISAL1043 на установке ГФУ-2 с БОР производства №1
                        </div>
                      </div>
                      <div class="events_status">
                        <div class="events_status_status">Потрачено</div>
                        <div class="events_status_datetime">
                          <div class="datetime_title">Срок исполнения</div>
                          <div class="datetime_body"> 25.02.2020 | 13.23</div>
                        </div>
                        <div class="events_status_responsible">
                          <div class="responsible_title">Ответственный</div>
                          <div class="responsible_body">Иванов Иван Иванович</div>
                        </div>
                      </div>
                    </div>
                    <div class="events_menu">
                      <div class="events_check"></div>
                      <div class="events_button">
                        <div clas="events_button_delete"></div>
                        <div clas="events_button_update"></div>
                      </div>
                    </div>
                    <div class="progress_line"></div>
                  </div>
                  <div class="events_content">
                    <div class="events_container">
                      <div class="events_info">
                        <div class="events_info_title">Кратное описание</div>
                        <div class="events_info_body">
                          Неисправность расходомера FIRCАHL-1008 «Расход МЭА в колонну К-2» в 8:20.
                          Переход на ручное управление клапаном 12FV-1008 в 8:22 Остановка насоса Н-17А по
                          блокировке поз. FISAL1043 на установке ГФУ-2 с БОР производства №1
                        </div>
                      </div>
                      <div class="events_status">
                        <div class="events_status_status">Потрачено</div>
                        <div class="events_status_datetime">
                          <div class="datetime_title">Срок исполнения</div>
                          <div class="datetime_body"> 25.02.2020 | 13.23</div>
                        </div>
                        <div class="events_status_responsible">
                          <div class="responsible_title">Ответственный</div>
                          <div class="responsible_body">Иванов Иван Иванович</div>
                        </div>
                      </div>
                    </div>
                    <div class="events_menu">
                      <div class="events_check"></div>
                      <div class="events_button">
                        <div clas="events_button_delete"></div>
                        <div clas="events_button_update"></div>
                      </div>
                    </div>
                    <div class="progress_line"></div>
                  </div>
                </div>
                <div class="events_bottom_info">
                  <div class="add_events"></div>
                  <div class="end_events">
                    <div class="end_events_title">Завершение события</div>
                    <div class="end_events_body">25.02.2020 | 13.23</div>
                  </div>
                </div>
              </div>
              <div class="events-correct-progress">
                <div class="line_progress">
                  <div class="top_frame_line"></div>
                  <div class="middle_line"></div>
                  <div class="bottom_frame_line"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </ng-container>

    <!--  Create Event -->
    <!-- <ng-container *ngIf="!isMock && !event"> -->
    <ng-container *ngIf="false">
      <div class="workspace__mock" (mousedown)="$event.stopPropagation()" (touchstart)="$event.stopPropagation()">
        <div class="workspace__submit">
          <div class="submit__frame submit__frame-left"></div>
          <div class="submit__frame submit__frame-right"></div>
          <button type="submit gridster-item-content" (click)="createEvent()">
            Создать событие
          </button>
        </div>
      </div>
    </ng-container>

    <evj-frame-bottom></evj-frame-bottom>
  </div>
</ng-container>

<ng-container *ngIf="false">
  <div *ngIf="event" class="change-shift" (mousedown)="$event.stopPropagation()"
    (touchstart)="$event.stopPropagation()">
    <div class="workspace__header__block">
      <section class="workspace__blocks" style="margin-right: 10px;">
        <div class="workspace__block">
          <div class="workspace__block__title">
            Дата / время:
          </div>
          <div class="workspace__block__body">
            {{ event.eventDateTime | date:'dd-MM-yyyy HH:mm' }}
          </div>
        </div>

        <div class="workspace__block">
          <div class="workspace__block__title">
            Организация:
          </div>
          <div class="workspace__block__body">
            {{ event.organization }}
          </div>
        </div>

        <div class="workspace__block">
          <div class="workspace__block__title">
            Смена:
          </div>
          <div class="workspace__block__body">
            Бригада-3
          </div>
        </div>

        <div class="workspace__block">
          <div class="workspace__block__title">
            Подразделение:
          </div>
          <div class="workspace__block__body">
            {{ event.branch }}
          </div>
        </div>

        <div class="workspace__block">
          <div class="workspace__block__title">
            Место:
          </div>
          <div class="workspace__block__body">
            ГФУ-2 с БОР
          </div>
        </div>

        <div class="workspace__block">
          <div class="workspace__block__title">
            Старший оператор:
          </div>
          <div class="workspace__block__body" *ngIf="event.responsibleOperator">
            {{ event.responsibleOperator.lastName }} {{ event.responsibleOperator.firstName }}
          </div>
        </div>

        <div class="workspace__block" *ngIf="user">
          <div class="workspace__block__title">
            Ответственный:
          </div>
          <div class="workspace__block__body">
            {{ user[idUser].lastName }} {{ user[idUser].firstName }}
          </div>
        </div>
      </section>

      <section class="workspace__blocks">
        <div class="workspace__block__right">
          <div class="workspace__block__title">
            Статус:
          </div>
          <div class="workspace__block__body__drop-down">
            <div class="dropdown dropdown-dark">
              <select name="contactMethod" class="dropdown-select" [(ngModel)]="event.status" [compareWith]="compareFn">
                <option *ngFor="let p of status" [ngValue]="p">{{ statuses[p.name] }}</option>
              </select>
            </div>
          </div>
        </div>

        <div class="workspace__block__right">
          <div class="workspace__block__title">
            Приоритет:
          </div>
          <div class="workspace__block__body__drop-down">
            <div class="dropdown dropdown-dark">
              <select name="contactMethod" class="dropdown-select" [(ngModel)]="event.priority"
                [compareWith]="compareFn">
                <option *ngFor="let p of priority" [ngValue]="p">{{ priorities[p.name] }}</option>
              </select>
            </div>
          </div>
        </div>

        <div class="workspace__block__right">
          <div class="workspace__block__title">
            Система источник:
          </div>
          <div class="workspace__block__body__drop-down">
            <div class="dropdown dropdown-dark">
              <select name="contactMethod" class="dropdown-select" [(ngModel)]="event.category"
                [compareWith]="compareFn" (change)="changeCategory()">
                <option *ngFor="let p of category" [ngValue]="p">{{ categories[p.name] }} </option>
              </select>
            </div>
          </div>
        </div>

        <div class="workspace__block__right">
          <div class="workspace__block__title">
            Зафиксировал:
          </div>
          <div class="workspace__block__body__drop-down" style="max-width: 120px;">
            <div class="dropdown dropdown-dark">
              <select name="contactMethod" class="dropdown-select" [(ngModel)]="event.fixedBy"
                [compareWith]="compareFn">
                <option *ngFor="let p of user" [ngValue]="p">{{ p.lastName }} {{ p.firstName }}</option>
              </select>
            </div>
          </div>
        </div>

        <div class="workspace__block__right">
          <div class="workspace__block__title">
            Тип происшествия:
          </div>
          <div class="workspace__block__body__drop-down">
            <div class="dropdown dropdown-dark">
              <select name="contactMethod" class="dropdown-select" [(ngModel)]="event.eventType"
                [compareWith]="compareFn" (change)="changeCategory()">
                <option *ngFor="let p of eventTypes" [ngValue]="p">{{ p.name }} </option>
              </select>
            </div>
          </div>
        </div>

        <div class="workspace__block__right">
          <div class="workspace__block__title">
            Тип оборудования:
          </div>
          <div class="workspace__block__body__drop-down">
            <div class="dropdown dropdown-dark">
              <select name="contactMethod" class="dropdown-select" [(ngModel)]="event.equipmentCategory"
                [compareWith]="compareFn" (change)="changeCategory()">
                <option *ngFor="let p of equipmentCategory" [ngValue]="p">{{ p.name }} </option>
              </select>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div class="incidents">
      <div class="workspace__block-border">
        <div class="block-border__title">
          Установленные факты:
        </div>
        <div class="block-border__body">
          <textarea class="gridster-item-content" placeholder="Введите значение..." minlength="6"
            [(ngModel)]="event.establishedFacts">
          </textarea>
          <div class="block-border__footer"></div>
        </div>
      </div>
      <div class="workspace__block-border" style="margin-left: 10px;">
        <div class="block-border__title">
          Краткое описание причины
        </div>
        <div class="block-border__body">
          <textarea required class="gridster-item-content" placeholder="Введите значение..." minlength="3"
            [(ngModel)]="event.description">
          </textarea>
          <div class="block-border__footer"></div>
        </div>
      </div>
    </div>

    <div class="blocks-bottom">
      <div class="block-bottom">
        <div class="change-shift__comment" style="height: 120px; min-height: 120px;">
          <div class="comment__title">
            Корректирующие мероприятия
          </div>
          <div class="comment__body">
            <div class="comment__display">
              <ul class="messages scroll-bar events" #scroll2>
                <li class="message event" *ngFor="let retrieval of event.retrievalEvents; let i = index">
                  <div class="event__header">
                    <span>
                      {{ getIndex(i) }}. <span class="event__sub">Ответственный</span>
                      <span style="padding-left:10px;" *ngIf="retrieval.responsibleOperator">
                        {{ retrieval.responsibleOperator.lastName }} {{
                        retrieval.responsibleOperator.firstName }}</span>
                    </span>

                    <span class="event__sub-right">
                      <span *ngIf="retrieval.status">{{ statuses[retrieval.status.name] }}</span>
                      <svg-icon *ngIf="!retrieval.source" class="event__delete" [applyCss]="true"
                        src="./assets/edit.svg" (click)="onEditRetrieval(retrieval)"
                        (mousedown)="$event.stopPropagation()" (touchstart)="$event.stopPropagation()"></svg-icon>
                      <svg-icon *ngIf="!retrieval.source" class="event__delete" [applyCss]="true"
                        src="./assets/garbage_bad_pic.svg" (click)="overlayConfirmationOpen()"></svg-icon>
                    </span>
                  </div>
                  <div class="event__body">
                    <span>{{ retrieval.description }}</span>
                  </div>
                  <div class="event__footer">
                    <span class="event__sub">Срок исполнения</span>
                    <span class="event__date">
                      <span>{{ retrieval.deadline | date:'dd-MM-yyyy HH:mm' }}</span>
                    </span>
                  </div>
                  <div (mousedown)="$event.stopPropagation()" (touchstart)="$event.stopPropagation()"
                    id="overlay-confirmation">
                    <div class="overlay-confirmation__body" (click)="$event.stopPropagation()">
                      <span>Вы действительно хотите удалить выбранное Мероприятие?</span>
                      <div style="display: flex;">
                        <div class="workspace__submit">
                          <div class="submit__frame submit__frame-left"></div>
                          <div class="submit__frame submit__frame-right"></div>
                          <button type="submit gridster-item-content" (click)="deleteRetrieval(event.id, retrieval.id)">
                            Удалить
                          </button>
                        </div>
                        <div class="workspace__submit">
                          <div class="submit__frame submit__frame-left"></div>
                          <div class="submit__frame submit__frame-right"></div>
                          <button type="submit gridster-item-content" (click)="overlayConfirmationClose()">
                            Отменить
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
            <div class="comment__new">
              <div class="workspace__submit">
                <div class="submit__frame submit__frame-left"></div>
                <div class="submit__frame submit__frame-right"></div>
                <button type="submit gridster-item-content" (click)="addRetrieval()">
                  Добавить мероприятие
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="block-bottom" style="margin-left: 10px">
        <div class="workspace__block-border media">
          <div class="block-border__title">
            Медиа контент
          </div>
          <div class="media__items">
            <div *ngIf="event.graphValues" class="media__item" (click)="openLineChart()">
              <svg-icon class="button__icon" src="./assets/line-chart.svg"> </svg-icon>
            </div>
            <div class="media__item">
              <svg-icon class="button__icon" src="./assets/round-add-button.svg"> </svg-icon>
            </div>
          </div>
        </div>

        <div class="change-shift__comment" style="height: 100px; min-height: 100px;">
          <div class="comment__title">
            Комментарий оператора
          </div>
          <div class="comment__body">
            <div class="comment__display">
              <div class="messages scroll-bar" #scroll>
                <div class="message" *ngFor="let comment of comments">
                  {{ comment }}
                </div>
              </div>
            </div>
            <div class="comment__new">
              <input type="text" class="comment__text gridster-item-content" placeholder="Напишите свой комментарий..."
                (keypress)="onEnterPush($event)" #input />
              <button type="submit" class="button comment__file   gridster-item-content">
                <svg-icon class="button__icon" src="./assets/icons/widgets/change-shift/add_file.svg"></svg-icon>
              </button>
              <button type="submit" class="button comment__submit  gridster-item-content" (click)="onSendMessage()">
                <svg-icon class="button__icon" src="./assets/icons/widgets/change-shift/send.svg"></svg-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="workspace__save">
      <div class="workspace__submit">
        <div class="submit__frame submit__frame-left"></div>
        <div class="submit__frame submit__frame-right"></div>
        <button type="submit gridster-item-content" (click)="createEvent()" [disabled]="isLoading">
          Создать событие
        </button>
      </div>
      <div class="workspace__submit">
        <div class="submit__frame submit__frame-left"></div>
        <div class="submit__frame submit__frame-right"></div>
        <button class="btn-disabled" type="submit gridster-item-content" (click)="saveItem()" [disabled]="isLoading">
          Сохранить
        </button>
      </div>
    </div>
  </div>

  <div (mousedown)="$event.stopPropagation()" (touchstart)="$event.stopPropagation()" id="overlay-retrieval"
    (click)="overlayClose()">
    <div class="overlay-retrieval__body" (click)="$event.stopPropagation()">
      <div *ngIf="isNewRetrieval" class="overlay-retrieval__header__block">
        <section class="overlay-retrieval__blocks">
          <div class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Дата / время:
            </div>
            <div class="overlay-retrieval__block__body">
              {{ isNewRetrieval.eventDateTime | date:'dd-MM-yyyy HH:mm' }}
            </div>
          </div>

          <div class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Организация:
            </div>
            <div class="overlay-retrieval__block__body">
              {{ isNewRetrieval.organization }}
            </div>
          </div>

          <div class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Смена:
            </div>
            <div class="overlay-retrieval__block__body">
              Бригада-3
            </div>
          </div>

          <div class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Подразделение:
            </div>
            <div class="overlay-retrieval__block__body">
              {{ isNewRetrieval.branch }}
            </div>
          </div>

          <div class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Место:
            </div>
            <div class="overlay-retrieval__block__body">
              <!-- {{ event.place.name }} -->
              ГФУ-2 с БОР
            </div>
          </div>

          <div class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Старший оператор:
            </div>
            <div class="overlay-retrieval__block__body" *ngIf="isNewRetrieval.responsibleOperator">
              {{ isNewRetrieval.responsibleOperator.lastName }} {{
              isNewRetrieval.responsibleOperator.firstName }}
            </div>
          </div>

          <div class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Зафиксировал:
            </div>
            <div class="overlay-retrieval__block__body select">
              <div class="dropdown dropdown-dark">
                <select name="contactMethod" class="dropdown-select" [(ngModel)]="isNewRetrieval.fixedBy"
                  [compareWith]="compareFn">
                  <option *ngFor="let p of user" [ngValue]="p">{{ p.lastName }} {{ p.firstName }}</option>
                </select>
              </div>
            </div>
          </div>

          <div class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Статус:
            </div>
            <div class="overlay-retrieval__block__body select">
              <div class="dropdown dropdown-dark">
                <select name="contactMethod" class="dropdown-select" [(ngModel)]="isNewRetrieval.status"
                  [compareWith]="compareFn">
                  <option *ngFor="let p of status" [ngValue]="p">{{ statuses[p.name] }}</option>
                </select>
              </div>
            </div>
          </div>

          <div class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Приоритет:
            </div>
            <div class="overlay-retrieval__block__body select">
              <div class="dropdown dropdown-dark">
                <select name="contactMethod" class="dropdown-select" [(ngModel)]="isNewRetrieval.priority"
                  [compareWith]="compareFn">
                  <option *ngFor="let p of priority" [ngValue]="p">{{ priorities[p.name] }}</option>
                </select>
              </div>
            </div>
          </div>

          <div class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Система источник:
            </div>
            <div class="overlay-retrieval__block__body select">
              <div class="dropdown dropdown-dark">
                <select name="contactMethod" class="dropdown-select" [(ngModel)]="isNewRetrieval.category"
                  [compareWith]="compareFn" (change)="changeCategory()">
                  <option *ngFor="let p of category" [ngValue]="p">{{ categories[p.name] }}
                  </option>
                </select>
              </div>
            </div>
          </div>

          <div class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Тип происшествия:
            </div>
            <div class="overlay-retrieval__block__body select">
              <div class="dropdown dropdown-dark">
                <select name="contactMethod" class="dropdown-select" [(ngModel)]="isNewRetrieval.eventType"
                  [compareWith]="compareFn" (change)="changeCategory()">
                  <option *ngFor="let p of eventTypes" [ngValue]="p">{{ p.name }} </option>
                </select>
              </div>
            </div>
          </div>

          <div class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Тип оборудования:
            </div>
            <div class="overlay-retrieval__block__body select">
              <div class="dropdown dropdown-dark">
                <select name="contactMethod" class="dropdown-select" [(ngModel)]="isNewRetrieval.equipmentCategory"
                  [compareWith]="compareFn" (change)="changeCategory()">
                  <option *ngFor="let p of equipmentCategory" [ngValue]="p">{{ p.name }} </option>
                </select>
              </div>
            </div>
          </div>

          <div *ngIf="user" class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Ответственный:
            </div>
            <div class="overlay-retrieval__block__body">
              {{ user[idUser].lastName }} {{ user[idUser].firstName }}
            </div>
          </div>

          <div class="overlay-retrieval__block">
            <div class="overlay-retrieval__block__title">
              Срок исполнения
            </div>
            <div class="overlay-retrieval__block__body">
              <input type="datetime-local" class="dates-selector__date-input"
                [ngModel]="isNewRetrieval.deadline | date:'yyyy-MM-ddTHH:mm'"
                (ngModelChange)="isNewRetrieval.deadline=$event" />
            </div>
          </div>

          <div class="overlay-retrieval__block overlay-retrieval__block-border">
            <div class="block-border__title">
              Краткое описание причины
            </div>
            <div class="block-border__body">
              <textarea class="gridster-item-content" placeholder="Введите значение..." minlength="3"
                [(ngModel)]="isNewRetrieval.description">
              </textarea>
              <div class="block-border__footer"></div>
            </div>
          </div>

          <div class="overlay-retrieval__block-border overlay-retrieval__block-border">
            <div class="block-border__title">
              Непосредственные / прямые причины:
            </div>
            <div class="block-border__body">
              <textarea class="gridster-item-content" placeholder="Введите значение..." minlength="6"
                [(ngModel)]="isNewRetrieval.directReasons">
              </textarea>
              <div class="block-border__footer"></div>
            </div>
          </div>
        </section>
      </div>

      <div class="overlay-retrieval__footer">
        <div class="workspace__submit">
          <div class="submit__frame submit__frame-left"></div>
          <div class="submit__frame submit__frame-right"></div>
          <button type="submit gridster-item-content" (click)="overlayClose()">
            Отменить
          </button>
        </div>
        <div class="workspace__submit">
          <div class="submit__frame submit__frame-left"></div>
          <div class="submit__frame submit__frame-right"></div>
          <button *ngIf="!isEdit" type="submit gridster-item-content" (click)="saveRetrieval(event.id)">
            Сохранить
          </button>
          <button *ngIf="isEdit" type="submit gridster-item-content" (click)="editSaveRetrieval()">
            Изменить и сохранить
          </button>
        </div>
      </div>
    </div>
  </div>

  <div (mousedown)="$event.stopPropagation()" (touchstart)="$event.stopPropagation()" id="overlay-chart"
    (click)="overlayChartClose()">
    <div class="overlay-chart__body" (click)="$event.stopPropagation()" *ngIf="event.graphValues">
      <evj-line-chart-workspace [dataChartAttribute]="event.graphValues"></evj-line-chart-workspace>
    </div>
  </div>
</ng-container>