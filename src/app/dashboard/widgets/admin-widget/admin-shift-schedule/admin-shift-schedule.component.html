<evj-widget-preview
  [title]="widgetTitle"
  [icon]="widgetIcon"
  [previewTitle]="widgetType"
  *ngIf="isMock"
>
</evj-widget-preview>

<div class="container pointer-event" *ngIf="!isMock">
  <evj-loading-shade [isLoading]="isLoading"></evj-loading-shade>
  <evj-widget-header
    [title]="widgetTitle"
    [units]="widgetUnits"
    [code]="widgetCode"
    [id]="id"
    [uniqId]="uniqId"
    [icon]="widgetIcon"
    [widgetType]="widgetType"
    [isEventOpen]="isSelectMenu"
    [select]="allUnits"
    (selected)="selectedUnits($event)"
    (selectedMenu)="selectedMenu($event)"
  ></evj-widget-header>
  <evj-frame-top></evj-frame-top>

  <div
    class="content"
    (mousedown)="$event.stopPropagation()"
    (touchstart)="$event.stopPropagation()"
  >
    <evj-alert-window [info]="alertWindow"></evj-alert-window>

    <ng-container *ngIf="isSelectMenu">
      <div class="content__blocks">
        <div class="block-left">
          <div class="block-top" *ngIf="scheduleShiftMonth.length">
            <evj-admin-shift-card class="calendar" title="Календарь дежурств">
              <section>
                <mat-calendar
                  #calendar
                  [dateClass]="dateClass()"
                  [(selected)]="selectedDay.date"
                  (selectedChange)="dateChanged($event)"
                  ngClass="calendar-red"
                  locale="ru"
                ></mat-calendar>
              </section>
            </evj-admin-shift-card>
            <evj-admin-shift-card class="main-team" title="Смена">
              <section class="main-team__section">
                <p class="title">Главный в бригаде</p>
                <div class="main-team__section__container">
                  <ul class="list">
                    <li class="list__item" *ngFor="let i of selectedShift?.shiftMembers;">
                      <evj-admin-shift-info-employee
                        [data]="i.employee"
                      ></evj-admin-shift-info-employee>
                    </li>
                  </ul>
                </div>
                <p class="title">Основной состав бригады</p>
                <div class="main-team__section__container">
                  <ul class="list">
                    <li class="list__item" *ngFor="let i of selectedShift?.shiftMembers;">
                      <evj-admin-shift-info-employee
                        [data]="i.employee"
                        type="garbage"
                      ></evj-admin-shift-info-employee>
                    </li>
                  </ul>
                </div>
              </section>
            </evj-admin-shift-card>
          </div>
          <div class="block-bottom" *ngIf="selectedDay">
            <evj-admin-shift-card class="duty-schedule" title="График дежурств">
              <section>
                <div class="title">
                  <!-- <button
                (click)="resetBrigadesFromShifts()"
                class="title-button"
                mat-icon-button
                *ngIf="dateNowIcon.getDate() === selectedDay.date.getDate()
                && dateNowIcon.getMonth() === selectedDay.date.getMonth()"
              >
                <svg-icon
                  class="icon-storage-title"
                  [svgStyle]="{'height.px':25}"
                  src="./assets/icons/garbage_bad_pic.svg"
                ></svg-icon>
              </button> -->
                </div>
                <ng-container *ngIf="selectedDay && yesterday">
                  <div class="date-yesterday">
                    {{ yesterday?.date | date:'d MMMM' }} - {{ selectedDay.date | date:'d MMMM yyyy'
                    }}
                  </div>
                  <div class="shift-yesterday" *ngFor="let i of yesterday.items; let idx = index">
                    <p>3 смена</p>
                    <p>{{ i.start | date:'HH.mm' }} - {{ i.end | date:'HH.mm' }}</p>
                    <p *ngIf="i.brigadeName" class="shift-today-item">
                      Бригада {{ i.brigadeName }}
                    </p>
                    <p *ngIf="!i.brigadeName" class="shift-today-item">Не назначено</p>
                  </div>
                </ng-container>
                <div class="date-today">
                  <p>{{ selectedDay.date | date:'d MMMM yyyy' }}</p>
                </div>
                <div
                  *ngFor="let shift of selectedDay.items; let idx = index"
                  class="shift-today"
                  [class.shift-today--active]="selectedShift?.id === shift.id"
                  (click)="selectShift(shift)"
                >
                  <p>{{ idx + 1 }} смена</p>
                  <p>{{ shift.start | date:'HH.mm' }} - {{ shift.end | date:'HH.mm' }}</p>
                  <p
                    *ngIf="!shift.brigadeId"
                    class="btn shift-today-item"
                    (click)="openOverlay($event, shift, true)"
                  >
                    Назначить
                  </p>
                  <p
                    *ngIf="shift.brigadeId"
                    class="btn shift-today-item"
                    (click)="openOverlay($event, shift, true)"
                    [matTooltip]="shift.brigadeName"
                  >
                    {{ shift.brigadeName }}
                  </p>
                  <svg-icon
                    (click)="deleteBrigadeFromShift($event, shift)"
                    class="shift-today__icon-storage"
                    src="assets/icons/widgets/admin-shift-schedule/garbage.svg"
                  ></svg-icon>
                </div>
                <div class="shift-overlay" #shiftOverlay>
                  <ul>
                    <li>
                      <svg-icon
                        (click)="openOverlay(null, null, false)"
                        class="icon"
                        [svgStyle]="{'width.px':10,'fill':'rgb(150,50,255)','padding.px':1,'margin.px':3}"
                        src="./assets/icons/widgets/admin-shift-schedule/close.svg"
                      ></svg-icon>
                    </li>
                    <li
                      *ngFor="let b of filterBrigade(allBrigade);"
                      (click)="onChooseBrigade(b, selectedDay)"
                    >
                      Бригада {{ b.brigadeNumber }}
                    </li>
                  </ul>
                </div>
              </section>
            </evj-admin-shift-card>

            <evj-admin-shift-card
              class="additional-team"
              title="Дополнительный состав бригады"
              *ngIf="selectedShift && selectedShift?.shiftMembers && selectedShift?.shiftMembers.length > 0 && brigadesSubstitution"
            >
              <section class="additional-team__section">
                <div class="additional-team__section__container">
                  <ul class="list">
                    <li class="list__item" *ngFor="let i of selectedShift?.shiftMembers">
                      <evj-admin-shift-info-employee
                        [data]="i.employee"
                        type="garbage"
                      ></evj-admin-shift-info-employee>
                    </li>
                  </ul>
                </div>
              </section>
            </evj-admin-shift-card>
          </div>
        </div>
        <div class="block-right">
          <evj-admin-shift-list-employees [data]="allUsers" [brigadeColors]="brigadeColors">
          </evj-admin-shift-list-employees>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="!isSelectMenu">
      <div class="control-block" cdkDropListGroup>
        <div class="control-block__left-side">
          <div class="content-menu">
            Изменение состава бригад
            <svg-icon
              matTooltip="Добавить бригаду"
              (click)="postBrigade()"
              class="content-menu__icon"
              src="./assets/icons/SVG/add_button.svg"
              [svgStyle]="{ 'width.px':15, 'height.px':15 }"
            ></svg-icon>
          </div>
          <div class="content-brigade">
            <div class="content-brigade__scroll">
              <div class="content-brigade__left">
                <div class="content-brigade__block" *ngFor="let item of leftBrigades">
                  <evj-admin-shift-brigade [data]="item"> </evj-admin-shift-brigade>
                </div>
              </div>
              <div class="content-brigade__right">
                <div class="content-brigade__block" *ngFor="let item of rightBrigades">
                  <evj-admin-shift-brigade [data]="item"> </evj-admin-shift-brigade>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="control-block__right-side">
          <div style="height: calc(100% - 24px);">
            <evj-admin-shift-list-employees [data]="allUsers" [brigadeColors]="brigadeColors">
            </evj-admin-shift-list-employees>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <evj-frame-bottom></evj-frame-bottom>
</div>
