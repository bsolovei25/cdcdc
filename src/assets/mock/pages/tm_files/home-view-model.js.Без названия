/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define('system/lang/event-binding',["require","exports"],function(require,exports){"use strict";var a=function(){function a(a,b,c){void 0===c&&(c=[]),this.handler=a,this.context=b,this.args=c}return a.prototype.execute=function(a){void 0===a&&(a=[]),a=this.args.concat(a),this.handler.apply(this.context,a)},a.prototype.dispose=function(){this.handler=null,this.context=null,this.args=null},a}();exports.EventBinding=a});
define('system/lang/event',["require","exports","./event-binding"],function(require,exports,a){"use strict";var b=function(){function b(){this.bindings=[]}return b.prototype.add=function(b,c){for(var d=[],e=2;e<arguments.length;e++)d[e-2]=arguments[e];if(null===b)throw"Event handler must not be null";if(void 0===b)throw"Event handler must not be undefined";var f=Array.prototype.slice.call(arguments,2),g=new a.EventBinding(b,c,f);return this.bindings.push(g),g},b.prototype.raise=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];for(var c=this.bindings.length,d=0;d!==c;d++)this.bindings[d].execute(a)},b.prototype.remove=function(a,b){arguments.length>1?c(this,a,b):arguments.length>0?(b=a,d(this,b)):e(this)},b}();function c(a,b,c){for(var d=[],e=a.bindings.length,f=0;f!==e;f++){var g=a.bindings[f];g.handler!==b||g.context!==c?d.push(g):g.dispose()}a.bindings=d}function d(a,b){for(var c=[],d=a.bindings.length,e=0;e!==d;e++){var f=a.bindings[e];f.context!==b?c.push(f):f.dispose()}
a.bindings=c}function e(a){for(var b=a.bindings.length,c=0;c!==b;c++)a.bindings[c].dispose();a.bindings=[]}return b});
define('system/lang/ioc',["require","exports"],function(require,exports){"use strict";function a(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return function(b){b.dependsOn=a}}exports.dependsOn=a;function b(a){a.singleton=!0}exports.singleton=b;function c(a){return function(b){b.factory=a}}exports.factory=c;function d(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return Object.resolve.apply(Object,[a].concat(b))}exports.resolve=d});
define('application/application-events',["require","exports","system/lang/event","system/lang/ioc"],function(require,exports,a,b){"use strict";var c=function(){function b(){this.windowResized=new a,this.windowUnloaded=new a,this.signout=new a,this.windowClicked=new a,this.errorOccured=new a,this.errorUnhandled=new a,this.errorCleared=new a,this.titleChanged=new a,this.iconChanged=new a,this.navigate=new a,this.assetcontextChanged=new a,this.connectionChanged=new a,this.sessionChanged=new a,this.sessionExpired=new a,this.offlineSessionExpired=new a,this.smallDeviceOptionsMenuClicked=new a,this.layoutChanged=new a,this.bulkClose=new a}return b.prototype.removeAll=function(){this.connectionChanged.remove(),this.windowResized.remove(),this.windowUnloaded.remove(),this.signout.remove(),this.windowClicked.remove(),this.errorOccured.remove(),this.errorUnhandled.remove(),this.errorCleared.remove(),this.titleChanged.remove(),this.iconChanged.remove(),this.navigate.remove(),this.assetcontextChanged.remove(),
this.connectionChanged.remove(),this.sessionExpired.remove(),this.smallDeviceOptionsMenuClicked.remove(),this.layoutChanged.remove(),this.bulkClose.remove()},b}();return c=__decorate([b.singleton],c)});
define('application/application-context',["require","exports","ramda"],function(require,exports,a){"use strict";var b=function(b){return function(c){if(!c)return!1;var d=b(c);return!a.isNil(d)&&""!==d}},c=b(a.prop("siteKey")),d=b(a.prop("defaultSiteKey")),e=function(){function a(){f(this)}return a.prototype.getSiteContext=function(){return c(this.assetcontext)?this.assetcontext.siteKey:d(this.user)?this.user.defaultSiteKey:null},a.prototype.hasPredixSDKInstalled=function(){return!!window.PredixSDK},a.prototype.reset=function(){f(this)},a}();function f(a){a.user=null,a.session=null,a.homeRoute="home",a.sessionStatus={isActive:!1},a.assetcontext=null,a.licensedModules=null,a.help={helpContext:null,helpUrl:null,defaultUrl:null},a.connectionStatus={connected:!0,lastStatusChange:null,connectionCheckerInterval:null,lastResponse:new Date,lastUserActivity:new Date},a.navigation={activeRoute:null,tabsInfo:null},a.isSupportedBrowser=!0,a.isAppHub=!!window.nav,a.hostingEnvironment=0}return new e});
define('spa/knockout/knockout-view-model',["require","exports","knockout"],function(require,exports,a){"use strict";return function(){function b(a){this.view=a,this.subscriptions=[],this.preserveContext=!1}return b.prototype.attach=function(b){b.attach($(this.view));var c=b.element;if(a.contextFor(c)&&this.preserveContext){var d=a.contextFor(c).createChildContext(this);a.applyBindingsToDescendants(d,c)}else a.applyBindingsToDescendants(this,c)},b.prototype.detach=function(b){a.cleanNode(b.element),b.clear()},b}()});
define('system/lang/object',["require","exports","lodash","jquery","bluebird"],function(require,exports,a,b,c){"use strict";function d(a,b){return __extends(b,a),a}function e(a){return new(Function.prototype.bind.apply(a,arguments))}function f(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];if(g(b))return h(b);var k;if(i(b))k=j(b);else{var o=l(b),p=a.map(o,function(a){return f(a)});p.unshift(b),p=p.concat(c),k=e.apply(null,p)}return m(b)&&n(b,k),k}function g(a){return a.singleton&&a.instance}function h(a){return a.instance}function i(b){return b.factory&&a.isFunction(b.factory)}function j(a){return k(a)()}function k(a){return a.factory}function l(a){return a.dependsOn||[]}function m(a){return!!a.singleton}function n(a,b){a.instance=b}function o(b,c){var d=[],e=0;for(c=c||0,e=0;e<c;e++)d.push({});return a.each(b,function(a,b){var c={id:e,name:b,text:a,toString:function(){return a}};d[b]=c,d.push(c),e++}),d.parse=function(c){if(isNaN(c)){var e=void 0;return a.each(d,function(a){c===a&&(e=c)}),
e||a.each(b,function(a,b){c!==a&&c!==b||(e=d[b])}),e}return d[c]},d.getDisplayText=function(a){var b=d.parse(a);return b?b.text:""},Object.freeze&&Object.freeze(d),d}function p(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];var e=Array.prototype.slice.call(arguments,2);if(r(a,b))return a[b].apply(a,e)}function q(a,b){b(a),p(a,"dispose")}function r(b,c,d){void 0===d&&(d=!1),a.isArray(c)||(c=[c]);for(var e=0;e<c.length;e++)if(!a.isFunction(b[c[e]])){if(d)throw"Required method "+c[e]+" is not defined";return!1}return!0}function s(b,c){var d=b[c];if(d&&a.isFunction(d))return d.bind(b)}function t(a,b,c){return!!a[b]&&(a[b]=c,!0)}function u(a,b){var c;return a[b]&&(c=a[b],delete a[b]),c}function v(a,b){return null===a?b:void 0===a?b:a}function w(a){var b=function(){return arguments.length&&(a=arguments[0]),a};return b.prop=function(){return a},b}var x=function(){function a(a){void 0===a&&(a=""),this.message=a,this.name="AbstractClassError"}return a}(),y=function(){
function a(a){void 0===a&&(a=""),this.message=a,this.name="AbstractMethodError"}return a}();function z(a,b){if(a.constructor===b)throw new x("Cannot create an instance of abstract class "+(b.name||""))}function A(a){throw new y("Cannot execute abstract method "+a+", must be overridden")}function B(a){return new c(C.bind(null,a))}function C(a,b,c){require(a,E.bind(null,b),D.bind(null,c))}function D(a,b){throw a(b),new Error(b)}function E(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];a(b)}var F={construct:e,resolve:f,inherit:d,createEnum:o,use:q,tryMethod:p,respondsTo:r,method:s,trySet:t,removeProperty:u,defaultValue:v,prop:w,AbstractClassError:x,AbstractMethodError:y,abstractClass:z,abstractMethod:A,require:B};return b.extend(Object,F),F});
define('system/collections/list',["require","exports","jquery","knockout","system/lang/object"],function(require,exports,a,b,c){"use strict";return function(){function d(a){void 0===a&&(a=[]),this.items=a}return d.indexOf=function(b,c){var d=-1;return a.isArray(b)===!1?d:(a.each(b,function(a,b){if(c(b,a)===!0)return d=a,!1}),d)},d.sort=function(a,c,d,e){function f(a,b){return a&&b||!a&&!b?0:a?1:-1}function g(a,b){return a===b?0:a<b?-1:1}function h(a,b){var c=a.toString().toLocaleLowerCase(),d=b.toString().toLocaleLowerCase();return c===d?0:c<d?-1:1}function i(a,i){var j=b.utils.unwrapObservable(d?a[d]:a),k=b.utils.unwrapObservable(d?i[d]:i);e=e||typeof j;var l;switch(e){case"boolean":l=f(j,k);break;case"number":l=j-k;break;case"datetime":l=g(j,k);break;default:l=h(j,k)}return c||(l=0-l),l}a.sort(i)},d.fillArray=function(a,b,c){for(;b--;)a[b]=c;return a},d.prototype.count=function(){return this.items.length},d.prototype.add=function(a){this.items[this.count()]=a},d.prototype.item=function(a){
return a<0&&(a+=this.count()),this.items[a]},d.prototype.clear=function(){this.items.length=0},d.prototype.indexOf=function(a){return this.items.indexOf(a)},d.prototype.contains=function(a){return this.indexOf(a)!==-1},d.prototype.addRange=function(a){a.forEach(this.add,this)},d.prototype.forEach=function(a,b){for(var c=0;c!==this.count();c++)a.call(b,this.item(c),c,this)},d.prototype.map=function(a,b){for(var d=c.resolve(this.constructor),e=0;e!==this.count();e++)d.add(a.call(b,this.item(e),e,this));return d},d.prototype.take=function(a){var b;return b=a>=0?this.items.slice(0,a):this.items.slice(a),c.resolve(this.constructor,b)},d.prototype.shift=function(){return this.items.shift()},d.prototype.pop=function(){return this.items.pop()},d.prototype.moveToEnd=function(a){this.remove(a),this.add(a)},d.prototype.remove=function(a){var b=this.indexOf(a);b!==-1&&this.items.splice(b,1)},d.prototype.createArrayIndex=function(a,b){var c={};if(a)for(var d=0;d<a.length;d++)c[a[d][b]]=a[d]
;return c},d}()});
define('system/collections/observable-list',["require","exports","knockout"],function(require,exports,a){"use strict";return function(){function b(b){void 0===b&&(b=[]),this.items=a.observableArray(b)}return b.prototype.count=function(){return this.items().length},b.prototype.item=function(a){return this.items()[a]},b.prototype.add=function(a){this.items.push(a)},b.prototype.remove=function(a){return this.items.remove(a)},b.prototype.clear=function(){this.items([])},b.prototype.indexOf=function(a){return this.items.indexOf(a)},b.prototype.moveUp=function(a){var b=this.items.indexOf(a);0!==b&&(this.items()[b]=this.items()[b-1],this.items()[b-1]=a,this.items.valueHasMutated())},b.prototype.moveDown=function(a){var b=this.items.indexOf(a);b!==this.items().length-1&&(this.items()[b]=this.items()[b+1],this.items()[b+1]=a,this.items.valueHasMutated())},b.prototype.dispose=function(){this.items([])},b}()});
define('system/knockout/change-tracker',["require","exports","knockout","ramda"],function(require,exports,a,b){"use strict";var c=function(){function b(b,c,f){void 0===c&&(c=a.toJSON),void 0===f&&(f=!1),this.hashFunction=c,this.objectToTrack=b,this.lastCleanState=a.observable(),f||this.lastCleanState(e(this)),this.isDirty=a.computed(d.bind(null,this))}return b.prototype.markCurrentStateAsClean=function(){this.lastCleanState(e(this))},b.prototype.dispose=function(){this.isDirty.dispose(),this.lastCleanState(null)},b}();function d(a){return e(a)!==a.lastCleanState()}function e(a){var c=a.hashFunction.apply(a.objectToTrack);return b.is(Object,c)?JSON.stringify(c):c}return c});
define('system/lang/functional',['require','ramda'],function(require){"use strict";var a=require("ramda");function b(){}function c(b,c){return a.is(Function,c[b])?c[b]():c[b]}function d(a,b){return console[a](b),b}function e(a){return a}function f(){return Array.prototype.join.call(arguments,"")}function g(b){if(a.is(Function,b)){var c=Array.prototype.slice.call(arguments,1);return setTimeout(function(){b.apply(void 0,c)},1)}}var h=a.either(a.identity,function(){return{}}),i=a.either(a.identity,function(){return[]});return{noop:b,identity:a.identity,areSame:a.identical,result:a.curry(c),log:d.bind(null,"log"),trace:d.bind(null,"trace"),warn:d.bind(null,"warn"),error:d.bind(null,"error"),debug:e,str:f,defer:g,defaultToObject:h,defaultToArray:i}});
define('system/knockout/knockout-manager',["require","exports","knockout","system/collections/list","system/collections/observable-list","./change-tracker","system/lang/functional"],function(require,exports,a,b,c,d){"use strict";var e=require("system/lang/functional");return function(){function f(a){void 0===a&&(a=e.noop),this.observables=new b,this.computeds=new b,this.subscriptions=new b,this.tracker=new d(this,a),this.isDirty=this.tracker.isDirty}return f.prototype.observable=function(){var b=a.observable.apply(null,Array.prototype.splice.call(arguments,0));return this.observables.add(b),b},f.prototype.observableArray=function(){var b=a.observableArray.apply(null,Array.prototype.splice.call(arguments,0));return this.observables.add(b),b},f.prototype.observableList=function(a){var b=new c(a);return this.observables.add(b),b},f.prototype.computed=function(b){var c=a.computed.apply(null,Array.prototype.splice.call(arguments,0));return this.computeds.add(c),c},f.prototype.pureComputed=function(b){
var c=a.pureComputed.apply(null,Array.prototype.splice.call(arguments,0));return this.computeds.add(c),c},f.prototype.subscribe=function(a,b,c,d){var e=a.subscribe(b,c,d);return this.subscriptions.add(e),e},f.prototype.dispose=function(){this.disposeSubscriptions(),this.disposeComputeds(),this.disposeObservables(),this.tracker.dispose()},f.prototype.disposeSubscriptions=function(){this.subscriptions.forEach(function(a){a.dispose()}),this.subscriptions.clear()},f.prototype.disposeComputeds=function(){this.computeds.forEach(function(a){a.dispose()}),this.computeds.clear()},f.prototype.disposeObservables=function(){this.observables.forEach(function(a){a.dispose?a.dispose():a(null)}),this.observables.clear()},f.prototype.createHash=function(){return this.observables.items.map(function(a){return a()})},f}()});
define('system/globalization/translator',["require","exports","system/lang/ioc","jed"],function(require,exports,a){"use strict";var b=require("jed"),c=function(){function a(){this.jed=null}return a.prototype.setLocale=function(a){this.jed=new b(a)},a.prototype.translate=function(a,b,c){if(!a)return a;if(!this.jed)return a;var d=this.jed.translate(a);return b&&d.onDomain(b),c&&d.withContext(c),d.fetch()},a}();return c=__decorate([a.singleton],c)});
define('logging/error-notification-handler',['require','jquery','knockout','spa/ko/knockout-view-model','system/lang/event'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("spa/ko/knockout-view-model"),d=require("system/lang/event"),e=[];function f(){g.call(this)}var g=Object.inherit(c,f);f.prototype.addError=function a(b){b&&(b.errorCode=b.errorCode||"",b.errorMessage=b.errorMessage||"",b.errorDetail=b.errorDetail||"",b.date=b.date||h(),b.time=b.time||i(new Date))},f.prototype.getErrorsLog=function a(b,c){return e},f.prototype.getErrorById=function b(c){return a.grep(e,function(a){return a.number===parseInt(c.logId)})};function h(){var a=new Date;return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear().toString().substr(2,2)}function i(a){var b=a.getHours(),c=a.getMinutes(),d=b>=12?"pm":"am";return b%=12,b=b?b:12,c=c<10?"0"+c:c,b+":"+c+" "+d}return f.singleton=!0,f});
define('spa/knockout/managed-view-model',['require','./knockout-view-model','system/knockout/knockout-manager','system/globalization/translator','logging/error-notification-handler','system/lang/functional'],function(require){"use strict";var a=require("./knockout-view-model"),b=require("system/knockout/knockout-manager"),c=require("system/globalization/translator"),d=require("logging/error-notification-handler"),e=require("system/lang/functional");function f(a,h){Object.abstractClass(this,f),g.call(this,a),this.kom=Object.resolve(b,h||e.noop),this.translator=Object.resolve(c),this.errorNotificationHandler=Object.resolve(d),this.region=null}var g=Object.inherit(a,f);return f.prototype.attach=function(a){Object.tryMethod(this,"beforeAttach",a),g.prototype.attach.call(this,a),this.region=a,Object.tryMethod(this,"afterAttach",a)},f.prototype.detach=function(a){Object.tryMethod(this,"beforeDetach",a),g.prototype.detach.call(this,a),this.kom.disposeSubscriptions(),this.kom.disposeComputeds(),this.region=null,Object.tryMethod(this,"afterDetach",a)},f.prototype.unload=function(){Object.tryMethod(this,"beforeUnload"),this.kom.dispose(),Object.tryMethod(this,"afterUnload")},
f.prototype.translate=function(a){return this.translator.translate(a)},f.prototype.reportError=function(a,b,c){b&&b.error(a.stack),this.errorNotificationHandler.addError({errorCode:c||null,errorMessage:a.message,errorDetail:a.stack})},f});
define('system/text/parser',["require","exports","ramda","globalize"],function(require,exports,a){"use strict";var b=require("globalize"),c=function(){function c(){}return c.prototype.parseInt=function(a,c,d){return void 0===a||null===a?a:"string"!=typeof a&&"number"!=typeof a?NaN:b.parseInt(a,c,d)},c.prototype.parseFloat=function(a,c,d){return void 0===a||null===a||"number"==typeof a?a:"string"!=typeof a?NaN:b.parseFloat(a,c,d)},c.prototype.parseDate=function(c,e,f){if(!e){var g=a.clone(b.findClosestCulture().calendar.patterns);return g.dt=d("d","t"),g.dT=d("d","T"),g.Dt=d("D","t"),g.DT=d("D","T"),g.Mt=d("M","t"),g.MT=d("M","T"),g.Yt=d("Y","t"),g.YT=d("Y","T"),b.parseDate(c,a.values(g),f)}return b.parseDate(c,e,f)},c}();function d(a,b){return e(a)+" "+e(b)}function e(a){return b.findClosestCulture().calendar.patterns[a]}return new c});
define('system/text/formatter',["require","exports","lodash","jquery","system/lang/ioc","system/text/parser"],function(require,exports,a,b,c,d){"use strict";var e=require("globalize");Date.Formats={Unformatted:"yyyy-MM-dd HH:mm:ss",Sortable:"S",LongDate_ShortTime:"f",LongDate_LongTime:"F",ShortTime:"t",LongTime:"T",ShortDate:"d",LongDate:"D",Month_Year:"Y",Month_Day:"M"};var f=function(a){return function(b){return a+(b||"")}};Number.Formats={Number:f("n"),Decimal:f("d"),Percent:f("p"),Currency:f("c")},Number.Formats.Number_Zero="n0",Number.Formats.Number_Two=Number.Formats.Number(2),Number.Formats.Number_Four=Number.Formats.Number(4),Number.Formats.Decimal_Zero="d0",Number.Formats.Decimal_Two=Number.Formats.Decimal(2),Number.Formats.Decimal_Four=Number.Formats.Decimal(4),Number.Formats.Percent_Zero="p0",Number.Formats.Percent_One=Number.Formats.Percent(1),Number.Formats.Percent_Two=Number.Formats.Percent(2),Number.Formats.Currency_Zero="c0",Number.Formats.Currency_Two=Number.Formats.Currency(2)
;var g=function(){function c(){this.culture="en"}return c.prototype.setCulture=function(a){this.culture=a,e.culture(a)},c.prototype.cultureInfo=function(){return e.culture()},c.prototype.getFormatByCode=function(a){return i(a)},c.prototype.format=function(b,c,f){var g=this,i=!1,j=null;if(f=f||this.culture,a.isArray(c))return a.map(c,function(a){return g.format(b,a,f)}).join(" ");if(c=c,b instanceof Date)return h(b,c,f);if(c&&null!==c.match(/^[ndmg]e?[0-9]*/i)&&!(b instanceof Date)){var k="number"==typeof b?b:d.parseFloat(b,10,"en");if(isNaN(k)||null===k)c=void 0;else{var l=c.substr(0,1);if(null!==c.match(/^[ndmg]e[0-9]*/i)){c=c.replace("e","");var n=m(k,!0);n&&n.length>1&&(k=parseFloat(n[0]),j="e"+n[1])}switch(b=k,l){case"m":c=o(k,c);break;case"g":c=o(k,c),i=!0}}}var p=e.format(b,c,f);if(j&&(p+=j),i){var q=new RegExp(e.culture(f).numberFormat[","].replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),"g");p&&(p=p.replace(q,""))}return p},c.prototype.abbreviate=function(a,b){
return a&&a.length>2*b?a.substr(0,b)+"..."+a.substr(a.length-b,a.length):a},c.prototype.abbreviateByWidth=function(a,c,d){if(!a)return a;var e=document.createElement("span");e.className="dummy-span";var f=b(e);f.text(a),b(document).find("body").append(f);var g=f.width();return b(e).remove(),g>c?this.abbreviate(a,d):a},c}();g=__decorate([c.singleton],g);function h(a,b,c){return b=i(b),e.format(a,b,c)}function i(a){return"g"===a?j():"G"===a||"GT"===a?l():"r"===a||"R"===a?"ddd, dd MMM yyyy HH':'mm':'ss 'GMT'":"s"===a||"m"===a||"y"===a?a.toUpperCase():a}function j(){return k("d")+" "+k("t")}function k(a){return e.culture().calendar.patterns[a]}function l(){return k("d")+" "+k("T")}function m(a,b){return a=a,!b&&n(a)?[a.toString()]:a.toExponential().split(/[eE]/)}function n(a){if(0===a)return!0;var b=Math.abs(a);return b<1e10&&b>1e-6}function o(a,b){var c=b.substr(1);return p(q(a,c.length>0?parseInt(c,10):void 0))}function p(a){var b=a.indexOf(".");return"n"+(b>-1?a.length-1-b:0)}
function q(a,b){var c=Number(a);if(isNaN(c))return a;var d,e=m(c);if(Math.abs(c)<1&&e&&e.length>1){var f=Math.floor(parseFloat(e[0])).toString().length,g=e[0].toString().length>f?e[0].toString().length-f-1:0,h=f+g,i=Math.abs(parseFloat(e[1])),j=i+(b>h?h:b)-1;d=c.toFixed(j>20?20:j)}else d=Math.abs(c)>=1||!b?0===b||b?c.toFixed(b>20?20:b):c.toString():c.toPrecision(b);var k=c.toString();return k.length<d.length?k:d}return g});
define('system/diagnostics/log-message',["require","exports","lodash","system/lang/object","system/text/formatter"],function(require,exports,a,b,c){"use strict";var d=function(){function d(a,b,c,d,e){void 0===e&&(e=""),this.level=a,this.source=b,this.text=c,this.timestamp=d?new Date(d):new Date,this.context=e}return d.fromJson=function(a){return new d(a.level,a.source,a.text,a.timestamp,a.context)},d.fromJsonCollection=function(b){return a.map(b,d.fromJson)},d.prototype.fullSource=function(){return this.context?this.source+" ["+this.context+"]":this.source},d.prototype.toJson=function(){return{timestamp:this.timestamp.toISOString(),level:this.level,source:this.source,text:this.text,context:this.context}},d.prototype.getFormattedTimestamp=function(){return b.resolve(c).format(this.timestamp,"f")},d.prototype.getLevelCaption=function(a){return e(a,this.level)},d}();function e(b,c){var d=a.find(b,{value:c});return d?d.text:c}return d});
define('system/diagnostics/logger',["require","exports","lodash","./log-message"],function(require,exports,a,b){"use strict";var c={trace:5,debug:4,info:3,warn:2,error:1,fatal:0},d=function(){function a(a,b,c){this.id=a,this.messageLogged=b,this.level=c}return a.prototype.log=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];e(this,a,b)},a.prototype.trace=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.trace,b)},a.prototype.debug=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.debug,b)},a.prototype.info=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.info,b)},a.prototype.warn=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.warn,b)},a.prototype.error=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.error,b)},a.prototype.fatal=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c]
;e(this,a.levels.fatal,b)},a.prototype.isTraceEnabled=function(){return f(this,a.levels.trace)},a.prototype.isDebugEnabled=function(){return f(this,a.levels.debug)},a.prototype.isInfoEnabled=function(){return f(this,a.levels.info)},a.prototype.isWarnEnabled=function(){return f(this,a.levels.warn)},a.prototype.isErrorEnabled=function(){return f(this,a.levels.error)},a.prototype.isFatalEnabled=function(){return f(this,a.levels.fatal)},a}();d.levels={trace:"trace",debug:"debug",info:"info",warn:"warn",error:"error",fatal:"fatal"};function e(a,c,d){if(f(a,c)){var e=new b(c,a.id,g(d).join(" "));a.messageLogged.raise(a,e)}}function f(a,b){return c[b]<=c[a.level]}function g(b){return a.map(b,function(b){return a.isObject(b)?JSON.stringify(b):a.isNull(b)?"":a.isUndefined(b)?"":b.toString()})}return d});
define('config/storage-config',["require","exports","application/application-context"],function(require,exports,a){"use strict";function b(){var b=a.session,c=b.apiServer.toUpperCase(),d=b.datasourceId.toUpperCase(),e=b.userId.toUpperCase(),f="Meridium APM("+c+", "+d+", "+e+")";return{name:f,description:f}}exports.documentStorage=b});
define('system/data/document-storage',["require","exports","jquery","config/storage-config","localforage"],function(require,exports,a,b){"use strict";var c=require("localforage");return function(){function d(d){var e=a.extend({},b.documentStorage(),{storeName:"data"});this.prefix=d+"__",this.instance=c.createInstance(e)}return d.prototype.getItem=function(b){var c=a.Deferred();return this.instance.getItem(this.prefix+b).then(c.resolve.bind(c),c.reject.bind(c)),c.promise()},d.prototype.setItem=function(b,c){var d=a.Deferred();return this.instance.setItem(this.prefix+b,c).then(d.resolve.bind(d),d.reject.bind(d)),d.promise()},d.prototype.removeItem=function(b){var c=a.Deferred();return this.instance.removeItem(this.prefix+b).then(c.resolve.bind(c),c.reject.bind(c)),c.promise()},d}()});
define('system/data/client-preferences',["require","exports","system/data/document-storage","system/lang/ioc"],function(require,exports,a,b){"use strict";var c=function(){function b(){this.documentStorage=new a("client_preferences")}return b.prototype.retrievePreferences=function(a){return this.documentStorage.getItem(a)},b.prototype.savePreference=function(a,b){return this.documentStorage.setItem(a,b)},b.prototype.deletePreference=function(a){return this.documentStorage.removeItem(a)},b}();return c=__decorate([b.singleton],c)});
define('system/diagnostics/log-service',["require","exports","lodash","jquery","system/lang/object","system/lang/ioc","system/data/document-storage","system/data/client-preferences","./log-message","./logger"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";var i={id:"log_config",level:h.levels.error,size:1e3},j=function(){function d(){this.clientPreferences=c.resolve(f),this.logStorage=new e("log"),this.messages=[]}return d.prototype.initializeLogConfig=function(a){return void 0===a&&(a=b.Deferred()),k(this).done(l.bind(null,this,a)),a.promise()},d.prototype.trimLog=function(){for(;this.messages.length>i.size;)this.messages.shift();return b.Deferred().resolve().promise()},d.prototype.saveConfig=function(b){return b=a.extend({},i,b),this.clientPreferences.savePreference(i.id,b)},d.prototype.saveMessage=function(a){var c=b.Deferred();this.messages.push(a.toJson()),this.trimLog(),this.logStorage.setItem("messages",this.messages).done(c.resolve.bind(c)).fail(o)},d.prototype.getAllMessages=function(){var a;try{
return a=this.messages.slice(0),a.reverse(),a=g.fromJsonCollection(a||[]),Promise.resolve(a)}catch(a){return console.error(a),Promise.reject(a)}},d.prototype.clearLog=function(){return this.messages=[],Promise.resolve(this.logStorage.setItem("messages",this.messages))},d}();j=__decorate([d.singleton],j);function k(a){return a.clientPreferences.retrievePreferences(i.id)}function l(a,b,c){c?n(a).done(b.resolve.bind(b,c)):a.saveConfig(i).done(m.bind(null,a,b,i))}function m(a,b,c){n(a).done(b.resolve.bind(b,c))}function n(a){return a.logStorage.getItem("messages").done(function(b){b&&(a.messages=b)}).fail(console.error)}function o(a,b){console.error(b),a.reject(b)}return j});
define('system/diagnostics/log-manager',["require","exports","lodash","system/lang/object","./logger","./log-service","system/lang/event"],function(require,exports,a,b,c,d,e){"use strict";var f=function(){function f(){this.defaultLevel=c.levels.error,this.level=this.defaultLevel,this.loggers={},this.nestedContexts=[],this.messageCache=[],this.messageLogged=new e,this.messageLogged.add(this.cacheMessage,this)}return f.prototype.cacheMessage=function(a,b){b.context=this.currentContext(),this.messageCache.push(b)},f.prototype.initialize=function(){var a=b.resolve(d);return a.trimLog(),a.initializeLogConfig().done(g.bind(null,this)).fail(h)},f.prototype.saveConfig=function(){return b.resolve(d).saveConfig().fail(h)},f.prototype.getLogger=function(a){var b=this.loggers[a];return b||(b=new c(a,this.messageLogged,this.level),this.loggers[a]=b),b},f.prototype.setLevel=function(b){this.level=b,a.each(this.loggers,function(a){return a.level=b})},f.prototype.pushContext=function(a){this.nestedContexts.push(k(a))},
f.prototype.popContext=function(){this.nestedContexts.pop()},f.prototype.currentContext=function(){return this.nestedContexts[this.nestedContexts.length-1]},f}();function g(a,b){a.setLevel(c.levels[b.level]),i(a),a.messageLogged.add(function(b,c){c.context=a.currentContext(),j(a,c)},a)}function h(a){console.error(a)}function i(b){b.messageLogged.remove(b.cacheMessage,b),a.each(b.messageCache,j.bind(null,b))}function j(a,c){b.resolve(d).saveMessage(c)}function k(b){return a.isObject(b)?JSON.stringify(b):b.toString()}return new f});
define('system/hardware/device',["require","exports","detect"],function(require,exports){"use strict";var a=require("detect");return function(){function b(b){this.userAgent=b||navigator.userAgent,this.parsedUserAgent=a.parse(this.userAgent)}return b.prototype.isMobile=function(){return this.isMobileApp()},b.prototype.isMobileApp=function(){return void 0!==window.cordova},b.prototype.isWindowsApp=function(){return!!window.MSApp},b.prototype.isAndroid=function(){return/Android/i.test(this.userAgent)},b.prototype.isIOS=function(){return/iPhone|iPad|iPod/i.test(this.userAgent)},b.prototype.isIE=function(){return/Trident/i.test(this.userAgent)&&!/MSIE/i.test(this.userAgent)},b.prototype.isEdge=function(){return/EDGE/i.test(this.userAgent)},b.prototype.isChromeOnAndroid=function(){return!!this.canReadBrowserAndOS()&&("CHROME"===this.parsedUserAgent.browser.family.toUpperCase()&&"ANDROID"===this.parsedUserAgent.os.family.toUpperCase())},b.prototype.canReadBrowserAndOS=function(){
return!(!this.parsedUserAgent.browser.family||!this.parsedUserAgent.os.family)},b.prototype.innerWidth=function(){return window.innerWidth},b.prototype.outerWidth=function(){return window.outerWidth},b.prototype.screenWidth=function(){return window.screen.width},b.prototype.innerHeight=function(){return window.innerHeight},b.prototype.pixelRatio=function(){return window.devicePixelRatio},b.prototype.deviceInnerWidth=function(){return this.roundUp(this.innerWidth()*this.pixelRatio())},b.prototype.roundUp=function(a){return Math.ceil(a)},b.prototype.deviceOuterWidth=function(){return this.roundUp(this.outerWidth()*this.pixelRatio())},b.prototype.deviceScreenWidth=function(){return this.roundUp(this.screenWidth()*this.pixelRatio())},b.prototype.isChrome=function(){return/Chrome/i.test(this.userAgent)},b}()});
define('system/mobile/device-connectivity',["require","exports","system/lang/ioc","system/lang/ioc","system/lang/ioc","application/application-events","bluebird","ramda"],function(require,exports,a,b,c,d,e,f){"use strict";var g=function(){function a(){this.userSetToOffline=!1,this.applicationEvents=c.resolve(d)}return a.prototype.getManualOfflineStatus=function(){return this.userSetToOffline},a.prototype.setManualOfflineStatus=function(a){this.userSetToOffline=a,this.hasPredixSDKInstalled()?this.queryConnectivity().catch(this.handleConnectivityFailure.bind(null,this)).then(this.handleConnectivityResponse.bind(null,this)):this.applicationEvents.connectionChanged.raise(this,{connected:!this.userSetToOffline})},a.prototype.hasPredixSDKInstalled=function(){return!!window.PredixSDK},a.prototype.queryConnectivity=function(){return new e(function(a,b){window.PredixSDK.queryConnectivity(a,b)})},a.prototype.handleConnectivityResponse=function(a,b){var c=window;a.deviceIsOnline(b)&&(b=a.resetConnectivityWithToggle(a,b)),
c.broadcaster.fireEvent("PredixSDK.ReachabilityChanged",{ReachabilityStatus:b})},a.prototype.deviceIsOnline=function(a){return f.contains("Online",a)},a.prototype.resetConnectivityWithToggle=function(a,b){b=a.getStateAsArray(b);var c=f.indexOf("Online",b);return a.userSetToOffline===!0&&(b[c]="Offline"),b},a.prototype.getStateAsArray=function(a){return"string"==typeof a&&(a=a.split(",")),a},a.prototype.handleConnectivityFailure=function(a){console.log("An error occurred")},a}();return g=__decorate([a.singleton,b.dependsOn(d)],g)});
define('system/http/predix-mobile-ajax-client',["require","exports","system/diagnostics/log-manager","application/application-context","system/mobile/device-connectivity","system/lang/object","ramda"],function(require,exports,a,b,c,d,e){"use strict";var f=a.getLogger("system/http/ajax-client"),g=59900,h={timeout:g,headers:{"Content-Type":"application/json",timeout:g}},i="apm",j="api/core/utility/unauthorizedping",k="",l=function(){function a(){}return a.prototype.baseUrl=function(){return k+i+"/"},a.useSecureConnection=function(a){},a.setServer=function(a){k=a},a.addAjaxOption=function(a,b){var c={};c[a]=b,$.extend(h,c)},a.clearHeaders=function(){},a.prototype.url=function(a){return a=this.trimSlash(a),a=k+i+"/"+a,a=encodeURI(decodeURI(a))},a.prototype.get=function(a,b){return f.info("ajax GET",a),a=this.url(a),m("GET","text",b,{},a)},a.prototype.post=function(a,b,c){return f.info("ajax POST",b,c),a=this.url(a),m("POST","text",c,b,a)},a.prototype.put=function(a,b,c){return f.info("ajax PUT",b,c),a=this.url(a),
m("PUT","text",c,b,a)},a.prototype.delete=function(a,b){return f.info("ajax DELETE",a),a=this.url(a),m("DELETE","text",b,{},a)},a.prototype.getBinary=function(a,b){return f.info("ajax binary GET",a),a=this.url(a),m("GET","blob",b,{},a)},a.isMultiTenant=function(){return!!window.nav},a.prototype.trimSlash=function(a){return a&&"/"===a.charAt(0)&&(a=a.substring(0).slice(1)),a},a}();function m(a,b,f,g,i){var j=$.extend(!0,{},h,f),k=$.Deferred(),l=window,m=new l.PredixRequest(a,i),p=d.resolve(c);return m.responseType=b,q(m,j),m.onComplete=x.bind(null,k.resolve.bind(k),k.reject.bind(k),a,i),m.onError=y.bind(null,k.reject.bind(k),i),m.beforeSend=o(m,p.getManualOfflineStatus()),"GET"===a?m.send():f&&!e.isNil(f.data)?m.send(f.data):m.send(g),n(k,m)}function n(a,b){var c=a.promise();return c.abort=b.abort,c}function o(a,b){return b?p.bind(null,a):null}function p(a){console.log("Aborting"),a.abort(),a.onComplete({statusCode:-1,error:"error"})}function q(a,b){
e.mapObjIndexed(r.bind(null,a),b.headers)}function r(a,b,c){a.setRequestHeader(c,b)}function s(a){return a>=200&&a<300||304===a}function t(a,b,c,d){if(null===b.data||""===b.data)try{c(null,null,a)}catch(a){console.log("error from success callback for url: "+d),console.log("response: "+JSON.stringify(b)),console.log("error: "+a)}else if("string"==typeof b.data)try{c(JSON.parse(b.data),null,a)}catch(a){console.log("error from success callback for url: "+d),console.log("response: "+JSON.stringify(b)),console.log("error: "+a)}else try{c(b.data,null,a)}catch(c){console.log("error from success callback for url: "+d),console.log("response: "+JSON.stringify(b),null,a),console.log("error: "+c)}}function u(a,b,c,d){var e="error";try{console.log("====jqXHR: "+JSON.stringify(a)),console.log("====text: "+e),console.log("====Error thrown "+d+" === "+b),c(a,e,b)}catch(a){console.log("error from fail callback for url: "+d),console.log("error: "+a)}}function v(a){
w(a,j)||(b.connectionStatus.lastResponse=new Date)}function w(a,b){return a.indexOf(b)>-1}function x(a,b,c,d,e){console.log("====SUCCESS "+c+" RESPONSE FROM URL: "+d+" === "+e.data),v(d);var f=s(e.statusCode),g={status:e.statusCode};f===!0?t(g,e,a,d):u(g,e.data,b,d)}function y(a,b,c){console.log("====FAIL RESPONSE FROM URL: "+b+" === "+JSON.stringify(c)),u({status:c.statusCode,statusText:c.error},c.error,a,b)}return l});
define('system/http/binary-transport',['require','jquery'],function(require){"use strict";require("jquery").ajaxTransport("+binary",function(a,b,c){if(window.FormData&&(a.dataType&&"binary"===a.dataType||a.data&&(window.ArrayBuffer&&a.data instanceof ArrayBuffer||window.Blob&&a.data instanceof Blob)))return{send:function(b,c){var d=new XMLHttpRequest,e=a.url,f=a.type,g=a.async||!0,h=a.responseType||"blob",i=a.data||null,j=a.username||null,k=a.password||null;d.addEventListener("load",function(){var b={};b[a.dataType]=d.response,c(d.status,d.statusText,b,d.getAllResponseHeaders())}),d.open(f,e,g,j,k);for(var l in b)b.hasOwnProperty(l)&&d.setRequestHeader(l,b[l]);d.responseType=h,d.send(i)},abort:function(){c.abort()}}})});
define('system/http/ajax-client',["require","exports","lodash","jquery","system/lang/ioc","application/application-events","system/diagnostics/log-manager","system/hardware/device","system/mobile/device-connectivity","system/http/predix-mobile-ajax-client","system/lang/object","./binary-transport"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";require("./binary-transport");var j=k()?59900:3e5;function k(){return!!window.nav}var l=e.getLogger("system/http/ajax-client"),m={contentType:"application/json",dataType:"json",cache:!0,timeout:j,headers:{timeout:j}},n={useSecureConnection:"https:"===location.protocol,server:null},o=function(){function c(){}return c.useSecureConnection=function(a){n.useSecureConnection=a,l.info("connectionOptions.useSecureConnection",a)},c.setServer=function(a){c.useSecureConnection(r(a)),a=v(a),a=w(a),n.server=a,l.info("connectionOptions.server",a)},c.server=function(){return n.server},c.secureConnection=function(){return n.useSecureConnection},c.addHeader=function(a,c){
var d={};d[a]=c,m.headers=m.headers||{},b.extend(m.headers,d),l.info("adding to ajaxOptions.headers",a,c)},c.clearHeaders=function(){m.headers=void 0,l.info("ajaxOptions.headers cleared")},c.headers=function(){return b.extend({},m.headers)},c.promise=function(a,b){var c=a.promise();return c.request={abort:b.abort},c},c.prototype.url=function(a){return q(this,a)},c.prototype.get=function(a,c){a=q(this,a);var d="GET",e=b.extend({},m,{url:a,type:d});return l.info("ajax GET",e.url),y(e,c)},c.prototype.getBinary=function(a,c){a=this.url(a);var d="GET",e="binary",f=!1,g=b.extend({},m,{url:a,type:d,dataType:e,processData:f});return delete g.contentType,l.info("ajax binary GET",g.url),y(g,c)},c.prototype.post=function(c,d,e){c=q(this,c),d=a.isObject(d)?JSON.stringify(d):d;var f="POST",g=b.extend({},m,{url:c,type:f,data:d});return l.info("ajax POST",d,e),y(g,e)},c.prototype.put=function(c,d,e){return l.info("ajax PUT",d,e),c=q(this,c),y(b.extend({},m,{url:c,type:"PUT",
data:a.isObject(d)?JSON.stringify(d):d}),e)},c.prototype.delete=function(a,c){a=q(this,a);var d=b.extend({},m,{url:a,type:"DELETE"});return l.info("ajax DELETE",d.url),y(d,c)},c.isMultiTenant=function(){return k()},c.prototype.protocol=function(){return n.useSecureConnection?"https":"http"},c.prototype.baseUrl=function(){return z(this)},c}();o=__decorate([c.dependsOn(d)],o),o.factory=function(){return p()?new h:new o};function p(){return!!window.PredixSDK}function q(a,b){return b=(new f).isMobileApp()?z(a)+"meridium/"+A(b):A(b)}function r(a){return s(a)?u(a):x()}function s(a){return!!a&&(t(a)||u(a))}function t(a){return a.toLowerCase().indexOf("http://")>-1}function u(a){return a.toLowerCase().indexOf("https://")>-1}function v(a){return a?a.toLowerCase().replace("https://","").replace("http://",""):a}function w(a){return a?a.toString().replace(/\//g,""):a}function x(){return"https:"===location.protocol}function y(a,c){var d=i.resolve(f),e=i.resolve(g)
;return d.isMobile()&&e.getManualOfflineStatus()?b.ajax({beforeSend:function(a){a.abort("error")}}):b.ajax(b.extend({},a,c))}function z(a){return n.server?a.protocol()+"://"+n.server+"/":""}function A(a){return a&&"/"===a.charAt(0)&&(a=a.substring(0).slice(1)),a}return o});
define('system/http/ajax-request',['require','lodash','system/http/ajax-client','mi-assert'],function(require){"use strict";var a=require("lodash"),b=require("system/http/ajax-client"),c=require("mi-assert");function d(a,c,d,e){this.ajaxClient=Object.resolve(b),this.method=a,this.url=c,this.data=d||null,this.options=e||null}d.get=function(a,b){return new d("get",a,null,b)},d.post=function(a,b,c){return new d("post",a,b,c)},d.put=function(a,b,c){return new d("put",a,b,c)},d.delete=function(a,b){return new d("delete",a,null,b)},d.prototype.send=function a(b){var c;if("get"===this.method)c=this.ajaxClient.get(this.url,this.options);else if("post"===this.method)c=this.ajaxClient.post(this.url,this.data,this.options);else if("put"===this.method)c=this.ajaxClient.put(this.url,this.data,this.options);else{if("delete"!==this.method)throw"Unknown request method: "+this.method;c=this.ajaxClient.delete(this.url,this.options)}return b&&c.fail(this.onFail(b)),c},d.prototype.onFail=function a(b){return c.isObject(b,"dfd"),e.bind(null,b,this)};function e(b,e,f){c.isObject(b,"dfd"),
c.instanceOf(e,d,"request"),c.isObject(f,"response"),a.isFunction(b.promise)?b.reject(e,f):b.reject({request:e,response:f})}return d});
define('dashboard/dtos/widget-dto',[],function a(){"use strict";function b(){this.type="",this.name="",this.uniqueID="",this.properties=[],this.caption=""}return b});
define('dashboard/models/dashboard-user',['require','application/application-context'],function(require){"use strict";var a=require("application/application-context");function b(){}return b.prototype.language=function b(){return a.session.licensedCultureId},b.prototype.usesDefaultLanguage=function a(){var b=this.language();return!b||"en"===b},b});
define('dashboard/models/widget',['require','lodash','knockout','system/lang/event','./dashboard-user','mi-assert'],function(require){"use strict";var a=require("lodash"),b=require("knockout"),c=require("system/lang/event"),d=require("./dashboard-user"),e=require("mi-assert");function f(a,f,h,k,l,m){e.isString(f,"type"),e.isString(h,"name"),e.isString(k,"uniqueID"),e.isObject(l,"properties"),this.user=new d,this.dashboard=b.observable(a),this.type=b.observable(f),this.name=b.observable(h),this.uniqueID=b.observable(k),this.properties=b.observable(l),this.caption=b.observable(m),this.propertiesAsArray=b.computed(g.bind(null,this)),this.translationContext=b.computed(i.bind(null,this)),this.name.subscribe(j.bind(null,this)),this.caption.subscribe(o.bind(null,this)),this.nameChanged=Object.resolve(c)}function g(b){return p(b),a.map(b.properties(),h)}function h(a,b){return e.isString(b),{key:b,value:a}}function i(a){return a.localizationContext(a.uniqueID())}f.prototype.localizationContext=function a(b){return this.dashboard().path()+"\\fields\\"+b};function j(a,b){p(a),e.isString(b,"value"),
a.user.usesDefaultLanguage()?a.caption(b):l(a,b)}function k(a,b){a.nameChanged.raise(a,b)}function l(a,b){require(["../services/dashboard-service"],m.bind(null,a,b))}function m(a,b,c){Object.resolve(c).getTranslation(a.user.language(),b,a.translationContext()).done(n.bind(null,a))}function n(a,b){a.caption(b)}function o(a,b){p(a),e.isString(b,"value"),k(a,b)}function p(a){e.instanceOf(a,f,"self")}return f});
/**
 * @license RequireJS text 2.0.9 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */
/*jslint regexp: true */
/*global require, XMLHttpRequest, ActiveXObject,
  define, window, process, Packages,
  java, location, Components, FileUtils */

define('text',['module'], function (module) {
    'use strict';

    var text, fs, Cc, Ci, xpcIsWindows,
        progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'],
        xmlRegExp = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,
        bodyRegExp = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,
        hasLocation = typeof location !== 'undefined' && location.href,
        defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\:/, ''),
        defaultHostName = hasLocation && location.hostname,
        defaultPort = hasLocation && (location.port || undefined),
        buildMap = {},
        masterConfig = (module.config && module.config()) || {};

    text = {
        version: '2.0.9',

        strip: function (content) {
            //Strips <?xml ...?> declarations so that external SVG and XML
            //documents can be added to a document without worry. Also, if the string
            //is an HTML document, only the part inside the body tag is returned.
            if (content) {
                content = content.replace(xmlRegExp, "");
                var matches = content.match(bodyRegExp);
                if (matches) {
                    content = matches[1];
                }
            } else {
                content = "";
            }
            return content;
        },

        jsEscape: function (content) {
            return content.replace(/(['\\])/g, '\\$1')
                .replace(/[\f]/g, "\\f")
                .replace(/[\b]/g, "\\b")
                .replace(/[\n]/g, "\\n")
                .replace(/[\t]/g, "\\t")
                .replace(/[\r]/g, "\\r")
                .replace(/[\u2028]/g, "\\u2028")
                .replace(/[\u2029]/g, "\\u2029");
        },

        createXhr: masterConfig.createXhr || function () {
            //Would love to dump the ActiveX crap in here. Need IE 6 to die first.
            var xhr, i, progId;
            if (typeof XMLHttpRequest !== "undefined") {
                return new XMLHttpRequest();
            } else if (typeof ActiveXObject !== "undefined") {
                for (i = 0; i < 3; i += 1) {
                    progId = progIds[i];
                    try {
                        xhr = new ActiveXObject(progId);
                    } catch (e) {}

                    if (xhr) {
                        progIds = [progId];  // so faster next time
                        break;
                    }
                }
            }

            return xhr;
        },

        /**
         * Parses a resource name into its component parts. Resource names
         * look like: module/name.ext!strip, where the !strip part is
         * optional.
         * @param {String} name the resource name
         * @returns {Object} with properties "moduleName", "ext" and "strip"
         * where strip is a boolean.
         */
        parseName: function (name) {
            var modName, ext, temp,
                strip = false,
                index = name.indexOf("."),
                isRelative = name.indexOf('./') === 0 ||
                             name.indexOf('../') === 0;

            if (index !== -1 && (!isRelative || index > 1)) {
                modName = name.substring(0, index);
                ext = name.substring(index + 1, name.length);
            } else {
                modName = name;
            }

            temp = ext || modName;
            index = temp.indexOf("!");
            if (index !== -1) {
                //Pull off the strip arg.
                strip = temp.substring(index + 1) === "strip";
                temp = temp.substring(0, index);
                if (ext) {
                    ext = temp;
                } else {
                    modName = temp;
                }
            }

            return {
                moduleName: modName,
                ext: ext,
                strip: strip
            };
        },

        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,

        /**
         * Is an URL on another domain. Only works for browser use, returns
         * false in non-browser environments. Only used to know if an
         * optimized .js version of a text resource should be loaded
         * instead.
         * @param {String} url
         * @returns Boolean
         */
        useXhr: function (url, protocol, hostname, port) {
            var uProtocol, uHostName, uPort,
                match = text.xdRegExp.exec(url);
            if (!match) {
                return true;
            }
            uProtocol = match[2];
            uHostName = match[3];

            uHostName = uHostName.split(':');
            uPort = uHostName[1];
            uHostName = uHostName[0];

            return (!uProtocol || uProtocol === protocol) &&
                   (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) &&
                   ((!uPort && !uHostName) || uPort === port);
        },

        finishLoad: function (name, strip, content, onLoad) {
            content = strip ? text.strip(content) : content;
            if (masterConfig.isBuild) {
                buildMap[name] = content;
            }
            onLoad(content);
        },

        load: function (name, req, onLoad, config) {
            //Name has format: some.module.filext!strip
            //The strip part is optional.
            //if strip is present, then that means only get the string contents
            //inside a body tag in an HTML string. For XML/SVG content it means
            //removing the <?xml ...?> declarations so the content can be inserted
            //into the current doc without problems.

            // Do not bother with the work if a build and text will
            // not be inlined.
            if (config.isBuild && !config.inlineText) {
                onLoad();
                return;
            }

            masterConfig.isBuild = config.isBuild;

            var parsed = text.parseName(name),
                nonStripName = parsed.moduleName +
                    (parsed.ext ? '.' + parsed.ext : ''),
                url = req.toUrl(nonStripName),
                useXhr = (masterConfig.useXhr) ||
                         text.useXhr;

            //Load the text. Use XHR if possible and in a browser.
            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {
                text.get(url, function (content) {
                    text.finishLoad(name, parsed.strip, content, onLoad);
                }, function (err) {
                    if (onLoad.error) {
                        onLoad.error(err);
                    }
                });
            } else {
                //Need to fetch the resource across domains. Assume
                //the resource has been optimized into a JS module. Fetch
                //by the module name + extension, but do not include the
                //!strip part to avoid file system issues.
                req([nonStripName], function (content) {
                    text.finishLoad(parsed.moduleName + '.' + parsed.ext,
                                    parsed.strip, content, onLoad);
                });
            }
        },

        write: function (pluginName, moduleName, write, config) {
            if (buildMap.hasOwnProperty(moduleName)) {
                var content = text.jsEscape(buildMap[moduleName]);
                write.asModule(pluginName + "!" + moduleName,
                               "define(function () { return '" +
                                   content +
                               "';});\n");
            }
        },

        writeFile: function (pluginName, moduleName, req, write, config) {
            var parsed = text.parseName(moduleName),
                extPart = parsed.ext ? '.' + parsed.ext : '',
                nonStripName = parsed.moduleName + extPart,
                //Use a '.js' file name so that it indicates it is a
                //script that can be loaded across domains.
                fileName = req.toUrl(parsed.moduleName + extPart) + '.js';

            //Leverage own load() method to load plugin value, but only
            //write out values that do not have the strip argument,
            //to avoid any potential issues with ! in file names.
            text.load(nonStripName, req, function (value) {
                //Use own write() method to construct full module value.
                //But need to create shell that translates writeFile's
                //write() to the right interface.
                var textWrite = function (contents) {
                    return write(fileName, contents);
                };
                textWrite.asModule = function (moduleName, contents) {
                    return write.asModule(moduleName, fileName, contents);
                };

                text.write(pluginName, nonStripName, textWrite, config);
            }, config);
        }
    };

    if (masterConfig.env === 'node' || (!masterConfig.env &&
            typeof process !== "undefined" &&
            process.versions &&
            !!process.versions.node &&
            !process.versions['node-webkit'])) {
        //Using special require.nodeRequire, something added by r.js.
        fs = require.nodeRequire('fs');

        text.get = function (url, callback, errback) {
            try {
                var file = fs.readFileSync(url, 'utf8');
                //Remove BOM (Byte Mark Order) from utf8 files if it is there.
                if (file.indexOf('\uFEFF') === 0) {
                    file = file.substring(1);
                }
                callback(file);
            } catch (e) {
                errback(e);
            }
        };
    } else if (masterConfig.env === 'xhr' || (!masterConfig.env &&
            text.createXhr())) {
        text.get = function (url, callback, errback, headers) {
            var xhr = text.createXhr(), header;
            xhr.open('GET', url, true);

            //Allow plugins direct access to xhr headers
            if (headers) {
                for (header in headers) {
                    if (headers.hasOwnProperty(header)) {
                        xhr.setRequestHeader(header.toLowerCase(), headers[header]);
                    }
                }
            }

            //Allow overrides specified in config
            if (masterConfig.onXhr) {
                masterConfig.onXhr(xhr, url);
            }

            xhr.onreadystatechange = function (evt) {
                var status, err;
                //Do not explicitly handle errors, those should be
                //visible via console output in the browser.
                if (xhr.readyState === 4) {
                    status = xhr.status;
                    if (status > 399 && status < 600) {
                        //An http 4xx or 5xx error. Signal an error.
                        err = new Error(url + ' HTTP status: ' + status);
                        err.xhr = xhr;
                        errback(err);
                    } else {
                        callback(xhr.responseText);
                    }

                    if (masterConfig.onXhrComplete) {
                        masterConfig.onXhrComplete(xhr, url);
                    }
                }
            };
            xhr.send(null);
        };
    } else if (masterConfig.env === 'rhino' || (!masterConfig.env &&
            typeof Packages !== 'undefined' && typeof java !== 'undefined')) {
        //Why Java, why is this so awkward?
        text.get = function (url, callback) {
            var stringBuffer, line,
                encoding = "utf-8",
                file = new java.io.File(url),
                lineSeparator = java.lang.System.getProperty("line.separator"),
                input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)),
                content = '';
            try {
                stringBuffer = new java.lang.StringBuffer();
                line = input.readLine();

                // Byte Order Mark (BOM) - The Unicode Standard, version 3.0, page 324
                // http://www.unicode.org/faq/utf_bom.html

                // Note that when we use utf-8, the BOM should appear as "EF BB BF", but it doesn't due to this bug in the JDK:
                // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058
                if (line && line.length() && line.charAt(0) === 0xfeff) {
                    // Eat the BOM, since we've already found the encoding on this file,
                    // and we plan to concatenating this buffer with others; the BOM should
                    // only appear at the top of a file.
                    line = line.substring(1);
                }

                if (line !== null) {
                    stringBuffer.append(line);
                }

                while ((line = input.readLine()) !== null) {
                    stringBuffer.append(lineSeparator);
                    stringBuffer.append(line);
                }
                //Make sure we return a JavaScript string and not a Java string.
                content = String(stringBuffer.toString()); //String
            } finally {
                input.close();
            }
            callback(content);
        };
    } else if (masterConfig.env === 'xpconnect' || (!masterConfig.env &&
            typeof Components !== 'undefined' && Components.classes &&
            Components.interfaces)) {
        //Avert your gaze!
        Cc = Components.classes,
        Ci = Components.interfaces;
        Components.utils['import']('resource://gre/modules/FileUtils.jsm');
        xpcIsWindows = ('@mozilla.org/windows-registry-key;1' in Cc);

        text.get = function (url, callback) {
            var inStream, convertStream, fileObj,
                readData = {};

            if (xpcIsWindows) {
                url = url.replace(/\//g, '\\');
            }

            fileObj = new FileUtils.File(url);

            //XPCOM, you so crazy
            try {
                inStream = Cc['@mozilla.org/network/file-input-stream;1']
                           .createInstance(Ci.nsIFileInputStream);
                inStream.init(fileObj, 1, 0, false);

                convertStream = Cc['@mozilla.org/intl/converter-input-stream;1']
                                .createInstance(Ci.nsIConverterInputStream);
                convertStream.init(inStream, "utf-8", inStream.available(),
                Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);

                convertStream.readString(inStream.available(), readData);
                convertStream.close();
                inStream.close();
                callback(readData.value);
            } catch (e) {
                throw new Error((fileObj && fileObj.path || '') + ': ' + e);
            }
        };
    }
    return text;
});


define('text!dashboard/views/widget-editor.html',[],function () { return '<div data-bind="with: widget">\r\n    <div class="form-group">\r\n        <label>Name</label>\r\n        <input type="text" class="form-control" data-bind="value: name">\r\n    </div>\r\n\r\n    <div data-bind="text: type"></div>\r\n    <div data-bind="foreach: propertiesAsArray">\r\n        <details>\r\n            <summary data-bind="text: key"></summary>\r\n            <div data-bind="text: value"></div>\r\n        </details>\r\n    </div>\r\n</div>\r\n';});

define('dashboard/view-models/widget-editor',['require','exports','module','lodash','jquery','logging/error-notification-handler','system/diagnostics/log-manager','spa/ko/managed-view-model','../models/widget','text!../views/widget-editor.html','mi-assert'],function a(require,exports,module){"use strict";var b=require("lodash"),c=require("jquery"),d=require("logging/error-notification-handler"),e=require("system/diagnostics/log-manager"),f=e.getLogger(module.id),g=require("spa/ko/managed-view-model"),h=require("../models/widget"),i=require("text!../views/widget-editor.html"),j=require("mi-assert");function k(a,b){l.call(this,b||i),this.widgetVM=a,this.widget=a.widget,this.backup={name:this.kom.observable()},this.errorNotificationHandler=Object.resolve(d)}var l=Object.inherit(g,k);k.prototype.load=function a(){Object.tryMethod(this,"beforeLoad"),n(this),Object.tryMethod(this,"afterLoad")},k.prototype.save=function a(){Object.tryMethod(this,"beforeSave"),this.widgetVM.save(),o(this),Object.tryMethod(this,"afterSave")},k.prototype.cancel=function a(){Object.tryMethod(this,"beforeCancel"),p(this),Object.tryMethod(this,"afterCancel")},k.prototype.onError=function a(b){f.error(b.stack),this.errorNotificationHandler.addError({
errorMessage:b.message,errorDetail:b.stack})},k.prototype.handleRequiredFields=function a(d){var e=this,f="input.form-control.disabled:eq(1)",g;b.defer(function(){g=c("button.btn.pull-right.btn-primary"),g.attr("disabled","true"),d.subscribe(m.bind(null,e,g,f)),d()?g.removeAttr("disabled"):c(f).css("border-color","red")})};function m(a,b,d){b.removeAttr("disabled"),c(d).css("border-color","#C0C5C5")}function n(a){q(a),r(a),a.backup.name(a.widget.name())}function o(a){q(a),a.backup.name(null)}function p(a){q(a),r(a),a.widget.name(a.backup.name())}function q(a){j.instanceOf(a,k,"self")}function r(a){j.instanceOf(a.widget,h,"self.widget")}return k});
define('system/error/error-message',["require","exports"],function(require,exports){"use strict";return function(){function a(a,b,c){void 0===c&&(c=null),this.code=a,this.message=b,this.detail=c}return a.fromHttpResponse=function(b,c,d){if(c.responseText){var e=d?d+c.responseText:c.responseText;return new a(b,this.fromDetail(e),c.responseText)}var e=d?d+c.statusText:c.statusText;return new a(b,e)},a.fromDetail=function(a){return a=a.replace("\r\n"," ").replace("\n","").replace("\r",""),a.length>512&&(a=a.substring(0,510)+".."),a},a}()});
define('spa/conductor',["require","exports","jquery","system/lang/ioc","system/diagnostics/log-manager","application/application-events","system/error/error-message","system/globalization/translator"],function(require,exports,a,b,c,d,e,f){"use strict";var g=c.getLogger("spa/conductor"),h="FND1",i="PAGE_NOT_LOADED",j=function(){function b(a,b){this.errorOccured=a.errorOccured,this.translator=b}return b.prototype.activateScreen=function(a,b){try{return k(this,a,b)}catch(a){l(this,a)}},b.prototype.createArgumentArray=function(a,b){return void 0===b&&(b=[]),g.isTraceEnabled()&&g.trace("create argument array"),a?(a.named&&b.push(a.named),Array.prototype.push.apply(b,a.positional),b):b},b.prototype.reuseScreen=function(a,b,c){try{return m(this,a,b,c)}catch(a){l(this,a)}},b.prototype.deactivateScreen=function(a){try{n(a)}catch(a){l(this,a)}},b.prototype.canUnloadScreen=function(a){try{return o(a)}catch(a){return l(this,a),!1}},b.prototype.attachScreen=function(a,b,c){try{p(a,b,c)}catch(a){l(this,a)}},
b.prototype.detachScreen=function(a){try{q(a)}catch(a){l(this,a)}},b.prototype.canReuseScreen=function(a,b,c){try{return r(this,a,b,c)}catch(a){return l(this,a),!1}},b.prototype.openScreen=function(a,b){try{s(this,a,b)}catch(a){l(this,a)}},b.prototype.loadScreen=function(a,b){try{t(this,a,b)}catch(a){l(this,a)}},b.prototype.closeScreen=function(a){try{u(a)}catch(a){l(this,a)}},b.prototype.unloadScreen=function(a){try{v(a)}catch(a){l(this,a)}},b.prototype.changeScreen=function(b,d,e,f){void 0===e&&(e={});var h=d.screen,i={isClosing:!0,checkForReuse:!0,checkForUnload:!1};if(c.pushContext(w(b)+" from "+w(h)),a.extend(i,f),i.checkForReuse&&this.canReuseScreen(h,b,e))return g.isDebugEnabled()&&g.debug("Reusing previous screen."),void this.reuseScreen(h,d,e);this.openScreen(b,e),this.loadScreen(b,e),this.deactivateScreen(h),this.activateScreen(b,e),this.detachScreen(d),this.attachScreen(b,d,e.url),i.isClosing&&b!==h&&(g.isDebugEnabled()&&g.debug("closing previous screen."),
this.unloadScreen(h),this.closeScreen(h)),c.popContext()},b.prototype.hideScreen=function(a){this.deactivateScreen(a.screen),this.detachScreen(a)},b.prototype.clearScreen=function(a){this.changeScreen(null,a),a.screen=null},b.prototype.showScreen=function(a,b){this.activateScreen(a.screen),this.attachScreen(a.screen,a,b)},b}();j=__decorate([b.dependsOn(d,f)],j);function k(a,b,c){if(g.isTraceEnabled()&&g.trace("activating screen"),(!b||!b.isActive)&&b&&(b.isActive=!0,b.activate)){var d=a.createArgumentArray(c);return b.activate.apply(b,d)}}function l(a,b){var c,d;c=b&&b.message?b.message:b instanceof Object?JSON.stringify(b):b,d=b.stack?b.stack:(new Error).stack;var f=a.translator.translate(i),g=new e(h,f,c+"\n"+d);a.errorOccured.raise(a,g)}function m(a,b,c,d){if(g.isTraceEnabled()&&g.trace("reuse screen"),b.reuse){var e=a.createArgumentArray(d,[c,d.url]);return b.reuse.apply(b,e)}}function n(a){g.isTraceEnabled()&&g.trace("deactivating screen"),a&&!a.isActive||a&&(a.isActive=!1,
a.deactivate&&a.deactivate())}function o(a){return g.isTraceEnabled()&&g.trace("can deactivate screen"),!a||!a.canUnload||a.canUnload()}function p(a,b,c){a&&a.isAttached===!0||(g.isTraceEnabled()&&g.trace("attaching screen"),a&&a.attach&&(a.attach(b,c),b.screen=a,a.isAttached=!0))}function q(a){g.isTraceEnabled()&&g.trace("detaching screen"),a&&a.screen&&(a&&a.screen&&!a.screen.isAttached||a.screen.detach&&(a.screen.detach(a),a.screen.isAttached=!1))}function r(a,b,c,d){var e=!0;if(g.isTraceEnabled()&&g.trace("can reuse screen: ",w(c)),!c||!b||c.constructor!==b.constructor)return!1;if(c.canReuse){var f=a.createArgumentArray(d);e=c.canReuse.apply(c,f)}else c.reuse||(e=!1);return e!==!1}function s(a,b,c){if(g.isTraceEnabled()&&g.trace("opening screen"),b&&!b.isOpen){if(b.open){var d=a.createArgumentArray(c);d[d.length]=c.url,b.open.apply(b,d)}b.isOpen=!0}}function t(a,b,c){if(g.isTraceEnabled()&&g.trace("load screen"),b&&!b.isLoaded){if(b.load){var d=a.createArgumentArray(c)
;b.load.apply(b,d)}b.isLoaded=!0}}function u(a){g.isTraceEnabled()&&g.trace("closing screen"),a&&a.isOpen&&(a.close&&a.close(),a.isOpen=!1)}function v(a){g.isTraceEnabled()&&g.trace("unload screen"),a&&a.isLoaded&&(a.unload&&a.unload(),a.isLoaded=!1)}function w(a){return a?a.constructor&&a.constructor.name?a.constructor.name:a.constructor?a.constructor:a.toString():a}return j});
define('spa/region',["require","exports","jquery"],function(require,exports,a){"use strict";var b=8,c=function(){function a(a){this.element=null,this.$element=null,this.setElement(a),this.activeContainer=null,this.screen=null}return a.prototype.setElement=function(a){var b=d(a);this.element=e(b),this.$element=h(b),i(this)},a.prototype.attach=function(a){this.clear(),this.activeContainer=j(),k(this,a),l(this)},a.prototype.clear=function(){this.activeContainer&&(n(this),i(this))},a.prototype.remove=function(){if(!this.$element)throw new Error("region.$element is null");this.$element.remove()},a.prototype.dispose=function(){this.clear(),this.detach(),this.screen=null},a.prototype.detach=function(){this.element=null,this.$element=null},a.prototype.removeAndDispose=function(){this.remove(),this.dispose()},a}();function d(a){return a||document.createElement("div")}function e(a){return f(a)?g(a):a}function f(b){return b instanceof a}function g(a){return a.get(0)}function h(b){return f(b)?b:a(b)}
function i(a){if(!a.$element)throw new Error("region.$element is null");a.$element.empty()}function j(){var a=document.createElement("div");return a.classList.add("region"),a}function k(b,c){a(b.activeContainer).append(c)}function l(a){if(m(a.element)){if(!a.$element)throw new Error("region.$element is null");a.$element.after(a.activeContainer)}else{if(!a.element)throw new Error("region.element is null");a.element.appendChild(a.activeContainer)}}function m(a){return!!a&&a.nodeType===b}function n(b){a(b.activeContainer).remove(),b.activeContainer=null}return c});

define('text!system/ui/views/dialog.html',[],function () { return '<div class="pattern pattern-dialog" >\r\n    <div class="dialog-opacity-style"></div>\r\n    <div class="dialog-wrapper">\r\n        <section class="title">\r\n            <div class="title-wrapper">\n                <div class="title-container" data-bind="text: title, attr: {title: title}"></div>\n            </div>\r\n            <span class="close-dialog icon-close-popup"\r\n            \tdata-bind="click: closeDialog, visible: showCloseIcon"></span>\r\n        </section>\r\n        <section class="content dialog-content"></section>\r\n    </div>\r\n</div>';});

define('system/ui/dialog-view-model',["require","exports","jquery","knockout","spa/conductor","spa/region","application/application-events","system/lang/object","text!./views/dialog.html"],function(require,exports,a,b,c,d,e,f){"use strict";var g=require("text!./views/dialog.html"),h=0,i=function(){function i(a,g,h){void 0===h&&(h=null),this.options=h,this.content=a,this.title=g,this.showHelp=b.observable(!0),this.showClose=b.observable(!0),this.showCloseIcon=b.observable(!1),this.showCheck=b.observable(!0),this.applicationEvents=f.resolve(e),this.dialogShellRegion=new d(null),this.dialogContentRegion=new d(null),this.$wrapper=null,this.conductor=f.resolve(c)}return i.prototype.show=function(){var c=document.createElement("div");document.body.appendChild(c),this.dialogShellRegion.setElement(c),this.dialogShellRegion.attach(a(g)),b.applyBindings(this,this.dialogShellRegion.activeContainer),this.$wrapper=this.dialogShellRegion.$element.find(".dialog-wrapper");var d=this.$wrapper.find(".dialog-content")
;if(this.dialogContentRegion.setElement(d),this.options?(this.options.height&&this.$wrapper.css("height",this.options.height),this.options.width&&this.$wrapper.css("width",this.options.width),this.options.noPadding?d.addClass("dialog-no-padding"):j(this,d)):j(this,d),this.options&&this.options.hasOwnProperty("closeIcon")){var e=this.options.closeIcon||!1;this.showCloseIcon(e)}h++,this.dialogShellRegion.$element.find(".dialog-opacity-style").css("z-index",h.toString()+"98"),this.dialogShellRegion.$element.find(".dialog-opacity-style").on("touchstart",m.bind(null)),this.$wrapper.css("z-index",h.toString()+"99"),this.conductor.changeScreen(this.content,this.dialogContentRegion),l(this),this.applicationEvents.windowResized.add(l,this,this),this.$wrapper.find("div.dialog-message-box div.btn.btn-primary").each(n.bind(null)),this.$wrapper.find(".okButtonClass").hover(o.bind(null,this),p.bind(null,this)),this.$wrapper.find(".cancelButtonClass").hover(o.bind(null,this),p.bind(null,this)),
q(this)},i.prototype.closeDialog=function(){r(this),k(this),h--},i.prototype.centerDialog=function(){l(this)},i.prototype.setContent=function(a){this.content=a,this.conductor.changeScreen(this.content,this.dialogContentRegion),l(this)},i}();function j(a,b){a.$wrapper.find(".title").addClass("title-with-padding"),b.addClass("dialog-with-padding")}function k(a){a.dialogShellRegion.$element.find(".dialog-opacity-style").off("touchstart"),a.conductor.clearScreen(a.dialogContentRegion),b.cleanNode(a.dialogShellRegion.activeContainer),a.dialogShellRegion.clear(),a.dialogShellRegion.$element.remove(),a.applicationEvents.windowResized.remove(a),a.applicationEvents.navigate.remove(a)}function l(b){var c,d,e,f,g,h;window.scrollTo(0,0),e=window.innerHeight?window.innerHeight:a(window).height(),f=window.innerWidth?window.innerWidth:a(window).width(),h=b.$wrapper.outerHeight(),g=b.$wrapper.outerWidth(),c=Math.max(0,(e-h)/2+a(window).scrollTop()),d=Math.max(0,(f-g)/2+a(window).scrollLeft()),
b.$wrapper.css("top",c+"px"),b.$wrapper.css("left",d+"px")}function m(a){a.preventDefault(),a.stopPropagation()}function n(b,c){var d=a(c);d.attr("tabindex",b+1),"OK"===d.text()&&(d.addClass("okButtonClass"),d.focus()),"Cancel"===d.text()&&d.addClass("cancelButtonClass")}function o(b){a(b).focus()}function p(b){a(b).blur()}function q(b){b.$wrapper.keydown(function(b){var c=a(b.currentTarget).find("input, select, textarea, button"),d=c.first(),e=c.last();9===(b.which||b.keyCode)&&(b.shiftKey&&d.length&&d.is(":focus")&&(b.preventDefault(),e.focus()),!b.shiftKey&&e.length&&e.is(":focus")&&(b.preventDefault(),d.focus()))})}function r(a){a.$wrapper.off("keydown")}return i});
define('system/ui/dialog-box',['require','lodash','jquery','system/ui/dialog-view-model','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/ui/dialog-view-model");require("system/lang/object");function d(a,b,c){e.call(this,a,b,c),this.handlingButtonClick=!1,this.dfd=null,this.showHelp(!1),this.showClose(!1),this.showCheck(!1)}var e=Object.inherit(c,d);d.prototype.show=function(){return e.prototype.show.call(this),f(this),this.dialogContentRegion.$element.css("overflow-y","auto").addClass("dialog-box"),this.dfd=b.Deferred(),this.dfd.promise()},d.prototype.setContent=function(a){e.prototype.setContent.call(this,a)};function f(c){if(c.options&&c.options.buttons){var d=c.options.buttons||[],e=c.dialogShellRegion.$element.find(".dialog-wrapper");if(d.length>0){var f=b('<div class="button-bar clearfix text-right"></div>').appendTo(e);a.each(d,function(a,d){var e=a.cssClass?a.cssClass:"btn-default";b('<button class="btn pull-right '+e+'"><span>'+a.name+"</span></button>").on("click",g.bind(null,c,d,a.value||a.name)).appendTo(f)}),
b('<div class="clearfix"></div>').appendTo(f),c.centerDialog()}}}function g(a,c,d){if(!a.handlingButtonClick){a.handlingButtonClick=!0;var e=Object.tryMethod(a.content,d);if(e===!1)return void(a.handlingButtonClick=!1);b.when(e).done(function(b){a.dfd.resolve(c,d,b),a.closeDialog(),a.handlingButtonClick=!1}).fail(function(b){a.options.closeOnReject&&(a.dfd.reject(c,d,b),a.closeDialog()),a.handlingButtonClick=!1})}}d.prototype.closeDialog=function(){h(this),e.prototype.closeDialog.apply(this,arguments)};function h(c){var d=c.dialogShellRegion.$element.find(".dialog-wrapper"),e=b(".button-bar",d),f=e.find("button");a.each(f,i),e.remove(),c.centerDialog()}function i(a){b(a).off().remove()}return d});
define('dashboard/views/edit-widget-dialog-box',['require','system/ui/dialog-box','system/globalization/translator','mi-assert'],function a(require){"use strict";var b=require("system/ui/dialog-box"),c=require("system/globalization/translator"),d=require("mi-assert");function e(a,b){return d.ok(a),f(a,b).show()}function f(a,e){d.ok(a);var f=Object.resolve(c);return new b(a,f.translate("EDIT_WIDGET"),{buttons:[{name:f.translate("SAVE"),value:"save",cssClass:"btn-primary"},{name:f.translate("CANCEL"),value:"cancel",cssClass:"btn-default"}],height:e.height||"60%",width:e.width||"50%"})}return{show:e}});

define('text!system/ui/views/message-box.html',[],function () { return '<div class="dialog-message-box">\r\n    <div class="message-text-container">\r\n        <i class="message-icon" data-bind="css:icon"></i>\r\n        <div class="main-message" data-bind="html:message"></div>\r\n    </div>    \r\n    <section class="button-align message-box-button-container" data-bind="foreach: buttons">\r\n        <div class="btn btn-primary" data-bind="text: name,\r\n            css: $parent.buttonStyle,\r\n            event: { \'keydown\': $parent.buttonKeyDown.bind($parent) },\r\n            click: $parent.buttonClicked.bind($parent, $index())"></div>\r\n    </section>\r\n</div>';});

define('system/ui/message-box',["require","exports","jquery","system/lang/object","spa/knockout/knockout-view-model","system/knockout/knockout-manager","system/globalization/translator","system/ui/dialog-view-model","text!./views/message-box.html"],function(require,exports,a,b,c,d,e,f){"use strict";var g=require("text!./views/message-box.html"),h=9,i=13,j=function(c){__extends(j,c);function j(a,f,h,i){var j=c.call(this,g)||this;return j.kom=new d,j.message=a,j.title=f,j.buttons=j.kom.observableArray(h),j.icon=i||"icon-node-warning",j.dfd=null,j.dialog=null,j.translator=b.resolve(e),j.$element=null,j.buttonStyle=j.kom.pureComputed(k.bind(null,j)),j.canSave=!0,j}return j.show=function(a,b,c,d,e){return c=c||[{name:q("OK")}],new j(a,b,c,d).showMessage(e)},j.showOk=function(a,b,c){var d=[{name:q("OK")}];return j.show(a,b,d,c)},j.showOkCancel=function(a,b,c){var d=[{name:q("OK")},{name:q("CANCEL")}];return j.show(a,b,d,c)},j.showYesNo=function(a,b,c){var d=[{name:q("YES")},{name:q("NO")}];return j.show(a,b,d,c)},
j.showYesNoCancel=function(a,b,c){var d=[{name:q("YES")},{name:q("NO")},{name:q("CANCEL")}];return j.show(a,b,d,c)},j.showUnsavedChanges=function(a){var b=q("UNSAVED_CHANGES_DIALOG_TITLE"),c=q("UNSAVED_CHANGES_DIALOG_MESSAGE"),d=[{name:q("UNSAVED_CHANGES_DIALOG_DONT_SAVE_BTN")},{name:q("UNSAVED_CHANGES_DIALOG_SAVE_BTN")}],e={showCloseIcon:!0,buttonIndex:1,applyUnsavedChangesDialogStyling:!0,canSave:!0};return r(a)&&(e.canSave=!1,c=q("UNSAVED_CHANGES_DIALOG_NO_SAVE_MESSAGE"),d=[{name:q("UNSAVED_CHANGES_DIALOG_CONTINUE_BTN")},{name:q("UNSAVED_CHANGES_DIALOG_GO_BACK_BTN")}]),j.show(c,b,d,"",e)},j.prototype.showMessage=function(b){var c=!!b&&b.showCloseIcon,d=b?b.buttonIndex:0,e=!!b&&b.applyUnsavedChangesDialogStyling;return this.dialog=new f(this,this.title,{closeIcon:c}),this.dfd=a.Deferred(),this.dialog.show(),this.$element=this.dialog.$wrapper.find(".dialog-message-box"),l(this,e),m(this,d),c&&o(this),r(b)&&(this.canSave=!1),this.dfd},j.prototype.buttonClicked=function(a){
this.dialog.closeDialog(),1===a&&this.canSave===!1?s(this):this.dfd.resolve(a)},j.prototype.buttonKeyDown=function(b,c){var d=a(c.target),e=this.$element.find(".message-box-button-container > .btn");if(c.keyCode===i)return d.click(),!1;if(c.keyCode===h){if(d.is(":last-of-type")&&c.shiftKey===!1)return e.first().focus(),!1;if(d.is(":first-of-type")&&c.shiftKey===!0)return e.last().focus(),!1}return!0},j.prototype.unload=function(){this.kom.dispose()},j}(c);function k(a){var b=a.buttons().length;return 2===b?"two-buttons":3===b?"three-buttons":""}function l(a,b){var c=a.$element.parents(".dialog-content");c.addClass("message-box-content"),c.siblings(".title").addClass("message-box-title"),a.dialog.centerDialog(),b&&(c.removeClass("dialog-with-padding"),a.dialog.$wrapper.find(".title-wrapper").addClass("unsaved-dialog-title"),a.dialog.$wrapper.find("section.title").removeClass("title-with-padding"),a.$element.find(".main-message").addClass("message-with-padding"),
a.$element.find(".message-box-button-container").addClass("unsaved-dialog-button-container"))}function m(b,c){var d=b.$element.find(".message-box-button-container > .btn");d[c].focus(),1===c&&(a(d[c]).addClass("activeBtn"),d.on("mouseenter",n.bind(null,d)))}function n(b){a(b[1]).hasClass("activeBtn")&&(a(b[1]).removeClass("activeBtn"),b.off("mouseenter"))}function o(a){a.dialog.$wrapper.find(".icon-close-popup").on("click",p.bind(null,a))}function p(a){a.dfd.reject()}function q(a){return b.resolve(e).translate(a)}function r(a){return a&&void 0!==a.canSave&&null!==a.canSave&&"false"===a.canSave.toString().toLowerCase()}function s(a){p(a)}return j});

define('text!dashboard/views/widget.html',[],function () { return '<div data-bind="with: widget">\n    <div data-bind="text: type"></div>\n    <div data-bind="foreach: propertiesAsArray">\n        <details>\n            <summary data-bind="text: key"></summary>\n            <div data-bind="text: value"></div>\n        </details>\n    </div>\n</div>\n';});

define('system/lang/property',['require'],function(require){"use strict";var a="__private__";function b(a,b,c){e(a),g(a,b,c),Object.defineProperty(a,b,{get:h(a,b)})}function c(a,b,c){e(a),g(a,b,c),Object.defineProperty(a,b,{set:i(a,b)})}function d(a,b,c){e(a),g(a,b,c),Object.defineProperty(a,b,{get:h(a,b),set:i(a,b)})}function e(b){b[a]||(b[a]={})}function f(b,c){return b[a][c]}function g(b,c,d){return b[a][c]=d,b}function h(a,b){return f.bind(null,a,b)}function i(a,b){return g.bind(null,a,b)}return{readOnly:b,writeOnly:c,readWrite:d,set:g,get:f}});
define('system/lang/interface',['lodash'],function(){"use strict";var a=require("lodash");function b(a,b,c){this.name=a,this.methods=b||[],this.properties=c||[]}b.prototype.implementedBy=function(a){c(this,a),d(this,a)};function c(b,c){var d,e;for(d=0;d<b.methods.length;d++){if(e=b.methods[d],a.isUndefined(c[e]))throw"Missing method "+e;if(!a.isFunction(c[e]))throw e+" is not a function"}return!0}function d(b,c){var d,e;for(d=0;d<b.properties.length;d++)if(e=b.properties[d],a.isUndefined(c[e]))throw"Missing property "+e;return!0}return b});
define('dashboard/view-models/i-widget-view-model',['require','exports','module','system/lang/interface'],function(require,exports,module){"use strict";var a=require("system/lang/interface"),b=["unload","getSaveRequested","getLayoutChanged","getRemoveRequested","getHideRequested"];return new a(module.id,b)});
define('dashboard/view-models/widget-view-model',['require','exports','module','lodash','logging/error-notification-handler','system/diagnostics/log-manager','system/lang/event','spa/ko/managed-view-model','../models/widget','./widget-editor','../views/edit-widget-dialog-box','system/ui/message-box','text!../views/widget.html','system/lang/property','./i-widget-view-model','mi-assert'],function a(require,exports,module){"use strict";var b=require("lodash"),c=require("logging/error-notification-handler"),d=require("system/diagnostics/log-manager"),e=d.getLogger(module.id),f=require("system/lang/event"),g=require("spa/ko/managed-view-model"),h=require("../models/widget"),i=require("./widget-editor"),j=require("../views/edit-widget-dialog-box"),k=require("system/ui/message-box"),l=require("text!../views/widget.html"),m=require("system/lang/property"),n=require("./i-widget-view-model"),o=require("mi-assert");function p(a,d,e,g){o.instanceOf(a,h,"widget"),o.assert(b.isString(d)||void 0===d,"view is string or undefined"),o.assert(b.isFunction(e)||void 0===e,"editorType is function or undefined"),q.call(this,d||l),this.__private__={},m.readOnly(this,"widget",a),m.readOnly(this,"editorType",e||i),m.readOnly(this,"editorDialogOptions",g||{}),m.readOnly(this,"minWidth",6),m.readOnly(this,"minHeight",4),m.readOnly(this,"allowRefresh",!0),m.readOnly(this,"allowGoTo",!0),
this.__private__.saveRequested=Object.resolve(f),this.__private__.layoutChanged=Object.resolve(f),this.__private__.removeRequested=Object.resolve(f),this.__private__.hideRequested=Object.resolve(f),this.errorNotificationHandler=Object.resolve(c),o.implementsInterface(this,n,module.id)}var q=Object.inherit(g,p);p.prototype.load=function(){},p.prototype.unload=function(){},p.prototype.refresh=function(){},p.prototype.redraw=function(){},p.prototype.goto=function(){},p.prototype.beforeAttach=function(a){o.ok(a)},p.prototype.afterAttach=function(a){o.ok(a)},p.prototype.beforeDetach=function(a){o.ok(a)},p.prototype.afterDetach=function(a){o.ok(a),this.dispose()},p.prototype.resize=function(a,b){o.isNumber(a),o.isNumber(b)},p.prototype.show=function(){Object.tryMethod(this,"beforeShow"),Object.tryMethod(this,"afterShow")},p.prototype.onError=function(a){throw e.error(a.stack),a},p.prototype.edit=function(){return j.show(Object.resolve(this.editorType,this),this.editorDialogOptions)},
p.prototype.hide=function(){Object.tryMethod(this,"beforeHide"),r(this).done(s.bind(null,this))};function r(a){y(a);var b=a.translate("CONFIRM_HIDE").replace("$0",a.widget.name()),c=a.translate("CONFIRMATION");return k.showOkCancel(b,c)}function s(a,b){y(a),o.isNumber(b),b||t(a)}function t(a){y(a),a.getHideRequested().raise(a)}p.prototype.getHideRequested=function(){return this.__private__.hideRequested},p.prototype.encodePath=function(a){var b="";return"undefined"!==encodeURI(a)&&(b=encodeURI(a)),b},p.prototype.remove=function(){Object.tryMethod(this,"beforeRemove"),u(this).done(v.bind(null,this))};function u(a){y(a);var b=a.translate("CONFIRM_REMOVE").replace("$0",a.widget.name()),c=a.translate("CONFIRMATION");return k.showOkCancel(b,c)}function v(a,b){y(a),o.isNumber(b),b||w(a)}function w(a){y(a),a.getRemoveRequested().raise(a)}p.prototype.getRemoveRequested=function(){return this.__private__.removeRequested},p.prototype.save=function(){this.widget.properties(this.serialize()),
this.getSaveRequested().raise(this)},p.prototype.getSaveRequested=function(){return this.__private__.saveRequested},p.prototype.notifyLayoutChanged=function(a,b){o.isString(a),o.isObject(b),x(this,a,b)};function x(a,b,c){a.getLayoutChanged().raise(a,{layoutType:b,attributes:c})}p.prototype.getLayoutChanged=function(){return this.__private__.layoutChanged},p.prototype.dispose=function(){Object.tryMethod(this,"beforeDispose"),this.getNameChanged().remove(),this.getSaveRequested().remove(),this.getLayoutChanged().remove()},p.prototype.getNameChanged=function(){return this.widget.nameChanged},p.prototype.serialize=function(){return this.widget.properties()},p.prototype.deserialize=function(){},p.prototype.uniqueID=function(){return this.widget.uniqueID()},p.prototype.widgetName=function(){return this.widget.name()},p.prototype.widgetType=function(){return this.widget.type()},p.prototype.widgetCaption=function(){return this.widget.caption()},p.prototype.icon=function(){
return"dashboard-icon-"+this.widget.type().toLowerCase()},p.prototype.localizationContext=function(a){return this.widget.localizationContext(a)};function y(a){o.instanceOf(a,p,"self")}return p});
define('system/lang/unique-id',['require','uuid'],function(require){"use strict";var a=require("uuid");function b(){return a.v1()}function c(){return a.v4()}return{createV1:b,createV4:c}});
define('dashboard/models/hyperlink',['require','lodash','knockout','system/lang/unique-id','./dashboard-user','mi-assert'],function a(require){"use strict";var b=require("lodash"),c=require("knockout"),d=require("system/lang/unique-id"),e=require("./dashboard-user"),f=require("mi-assert");function g(a,b,g,k,l){f.ok(a,"parent"),this.parent=a,this.user=new e,this.text=c.observable(b||""),this.url=c.observable(g||""),this.uniqueID=c.observable(k||d.createV4()),this.caption=c.observable(l||b||""),this.target=c.computed(i.bind(null,this)),this.translationContext=c.computed(h.bind(null,this)),this.text.subscribe(j.bind(null,this))}g.copy=function a(c){return f.isArray(c),b.invokeMap(c,"copy")},g.prototype.copy=function a(){return new g(this.parent,this.text(),this.url(),this.uniqueID(),this.caption())};function h(a){return a.parent.localizationContext(a.uniqueID())}function i(a){return f.instanceOf(a,g),0===a.url().indexOf("#")?"tab":"_blank"}function j(a,b){f.isString(b,"value"),a.user.usesDefaultLanguage()?a.caption(b):k(a,b)}function k(a,b){require(["../services/dashboard-service"],l.bind(null,a,b))}
function l(a,b,c){Object.resolve(c).getTranslation(a.user.language(),b,a.translationContext()).done(m.bind(null,a))}function m(a,b){a.caption(b)}return g});
define('dashboard/adapters/hyperlink-adapter',['require','../models/hyperlink','mi-assert'],function a(require){"use strict";var b=require("../models/hyperlink"),c=require("mi-assert");function d(a){return c.instanceOf(a,b),{text:a.text(),url:a.url(),uniqueID:a.uniqueID()}}function e(a){return c.isArray(a),a.map(d)}function f(a,d){return c.ok(a,"parent"),c.ok(d,"data"),c.ok(d.text,"data.text"),c.ok(d.url,"data.url"),new b(a,d.text,d.url,d.uniqueID,d.caption)}function g(a,b){return c.ok(b),b.map(f.bind(null,a))}return{serialize:d,serializeAll:e,deserialize:f,deserializeAll:g}});
define('system/lang/converter',['require','system/text/parser','globalize'],function(require){"use strict";var a=require("system/text/parser"),b=require("globalize");function c(){}c.prototype.toNullable=function a(b){return b?b:null},c.prototype.toObject=function a(b,c){return b?b:c},c.prototype.toString=function a(b,c){return void 0===b||null===b?void 0!==c?c:"":b.toString()},c.prototype.toNullableString=function a(b){return c.prototype.toString(b,null)},c.prototype.toBoolean=function a(b,c){return void 0!==b&&(b===c||b===!0)},c.prototype.toNullableBoolean=function a(b,c){return void 0!==c||void 0!==b&&null!==b?b===c||b===!0:null},c.prototype.toInteger=function a(b,c){var d=parseInt(b,10);return c=c||0,isNaN(d)?c:d},c.prototype.toFloat=function a(b,c){var d=parseFloat(b);return arguments.length<2&&(c=0),isNaN(d)?c:d},c.prototype.toDate=function a(b,c,e){return d(b,c,e)},c.prototype.toNullableDate=function a(b,c){return d(b,c,null)};function d(b,c,d){return c=c||"yyyy-MM-ddTHH:mm:ss.fff",d=Object.defaultValue(d,null),
null===b||void 0===b?d:b instanceof Date?b:a.parseDate(b,c)||a.parseDate(b,"yyyy-MM-ddTHH:mm:ss.fff")||d}return c.prototype.toDateString=function a(c,d){return d=d||"S",b.format(c,d)},c.prototype.toNullableInteger=function a(b){var c=parseFloat(b);return isNaN(c)?null:c},c.prototype.toNullableFloat=function a(b){return this.toFloat(b,null)},new c});
define('query/services/dto/rowset-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.columns=a.toObject(b.columns),this.familyMappings=a.toObject(b.familyMappings),this.rowColumns=a.toObject(b.rowColumns),this.rows=a.toObject(b.rows),this.totalRows=a.toInteger(b.totalRows)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('query/services/dto/column-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.caption=a.toString(b.caption),this.defaultCaption=a.toString(b.defaultCaption),this.dataType=a.toString(b.dataType),this.isInactive=a.toBoolean(b.isInactive),this.id=a.toString(b.id)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('query/services/dto/table-design-dto',['require','system/lang/converter','./column-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./column-dto");function c(c){c=c||{},c.showAllFields||c.showAllFields===!1||(c.showAllFields=!0),c.showDataFields||c.showDataFields===!1||(c.showDataFields=!1),c.showInactiveFields||c.showInactiveFields===!1||(c.showInactiveFields=!1),c.showSystemFields||c.showSystemFields===!1||(c.showSystemFields=!1),this.alias=a.toString(c.alias),this.caption=a.toString(c.caption),this.defaultCaption=a.toString(c.defaultCaption),this.datasheetId=a.toString(c.datasheetId),this.id=a.toString(c.id),this.key=a.toString(c.key),this.layoutX=a.toInteger(c.layoutX),this.layoutY=a.toInteger(c.layoutY),this.name=a.toString(c.name),this.queryColumns=b.fromDataCollection(c.queryColumns),this.showAllFields=a.toBoolean(c.showAllFields),this.showDataFields=a.toBoolean(c.showDataFields),this.showInactiveFields=a.toBoolean(c.showInactiveFields),this.showSystemFields=a.toBoolean(c.showSystemFields),
this.storedQueryPath=a.toString(c.storedQueryPath),this.tableType=a.toString(c.tableType),this.queryColumns&&(this.queryColumns=this.queryColumns.sort(d))}c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}};function d(a,b){var c=a.caption.toLowerCase(),d=b.caption.toLowerCase(),e=!1,f=!1;return c.indexOf("[")===-1&&c.indexOf("{")===-1||(e=!0,c=c.slice(1,c.length-1)),d.indexOf("[")===-1&&d.indexOf("{")===-1||(f=!0,d=d.slice(1,d.length-1)),e&&f||!e&&!f?c===d?0:c<d?-1:1:e?-1:1}return c});
define('query/services/dto/query-criteria-dto',['require','lodash','system/lang/converter'],function(require){"use strict";var a=require("lodash"),b=require("system/lang/converter");function c(b){b=b||{},this.expressions=a.isArray(b.expressions)?b.expressions:[b.expressions]}return c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=b[d]?new c(b[d]):null;return e}},c});
define('query/services/dto/column-design-dto',['require','lodash','system/lang/converter','./column-dto','./query-criteria-dto'],function(require){"use strict";var a=require("lodash"),b=require("system/lang/converter"),c=require("./column-dto"),d=require("./query-criteria-dto");function e(e){e=e||{},this.alias=b.toString(e.alias,null),this.caption=b.toString(e.caption,null),this.defaultCaption=b.toString(e.defaultCaption,null),this.criterias=a.isArray(e.criterias)?e.criterias:[e.criterias],this.crosstab=b.toString(e.crosstab),this.dataType=b.toString(e.dataType),this.display=b.toBoolean(e.display),this.expressionText=b.toString(e.expressionText),this.hyperlink=b.toString(e.hyperlink),this.id=b.toString(e.id,null),this.include=b.toBoolean(e.include),this.key=b.toString(e.key),this.layoutWidth=b.toInteger(e.layoutWidth,40),this.resultFilterExpression=b.toString(e.resultFilterExpression),this.sortIndex=b.toInteger(e.sortIndex),this.sortOrder=b.toString(e.sortOrder),this.tableDesignKey=b.toString(e.tableDesignKey),this.total=b.toString(e.total),this.resultSortIndex=b.toInteger(e.resultSortIndex),
this.resultSortOrder=b.toString(e.resultSortOrder),this.appendTo=new c(e.appendTo),this.updateTo=e.updateTo,this.simpleCriteria=d.fromDataCollection(e.simpleCriteria)}return e.fromDataCollection=function a(b){if(b){var c,d=[];for(c=0;c<b.length;c++)d[d.length]=new e(b[c]);return d}},e});
define('query/services/dto/operand-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.tableDesignKey=a.toString(b.tableDesignKey),this.columnId=a.toString(b.columnId),this.charOperand=a.toString(b.charOperand)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('query/services/dto/condition-dto',['require','system/lang/converter','./operand-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./operand-dto");function c(c){c=c||{},this.leftOperand=new b(c.leftOperand),this.operator=a.toString(c.operator),this.rightOperand=new b(c.rightOperand),this.nextOperator=a.toString(c.nextOperator)}return c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}},c});
define('query/services/dto/join-design-dto',['require','system/lang/converter','./condition-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./condition-dto");function c(c){c=c||{},this.conditions=b.fromDataCollection(c.conditions),this.isMiJoin=a.toBoolean(c.isMiJoin),this.joinSucc=a.toBoolean(c.joinSucc),this.joinType=a.toString(c.joinType),this.key=a.toInteger(c.key),this.leftDesignKey=a.toInteger(c.leftDesignKey),this.relDesignKey=a.toInteger(c.relDesignKey),this.rightDesignKey=a.toInteger(c.rightDesignKey),this.joinDesignKey=a.toInteger(c.joinDesignKey)}return c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}},c});
define('query/services/dto/parameter-value-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.value=a.toString(b.value),this.displayValue=a.toString(b.displayValue)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('query/services/dto/parameter-design-dto',['require','lodash','system/lang/converter','./parameter-value-dto'],function(require){"use strict";var a=require("lodash"),b=require("system/lang/converter"),c=require("./parameter-value-dto");function d(a){a=a||{},this.id=b.toString(a.id,null),this.dataType=b.toString(a.dataType),this.caption=b.toString(a.caption),this.defaultValue=b.toNullableString(a.defaultValue),this.isHidden=b.toBoolean(a.isHidden),this.familyId=b.toString(a.familyId),this.fieldId=b.toString(a.fieldId),this.isMultiValue=b.toBoolean(a.isMultiValue),this.list=b.toObject(a.list,[]),this.localizedCaption=b.toString(a.localizedCaption),this.codeTable=b.toString(a.codeTable),this.referenceCode=b.toString(a.referenceCode),this.referenceTable=b.toString(a.referenceTable),this.query=b.toString(a.query),this.isExclusive=b.toBoolean(a.isExclusive),this.parmValues=c.fromDataCollection(a.parmValues),this.parmPrompts=b.toObject(a.parmPrompts,[]),this.isAssetHierarchy=b.toBoolean(a.isAssetHierarchy),this.assetHierarchyCaption=b.toString(a.assetHierarchyCaption),
this.all=b.toBoolean(a.all),this.child=b.toBoolean(a.child),this.parent=b.toBoolean(a.parent),this.current=b.toBoolean(a.current),this.isGis=b.toBoolean(a.isGis),this.format=b.toBoolean(a.format),this.alias=b.toString(a.alias),this.distance=b.toString(a.distance),this.entyKey=b.toBoolean(a.entyKey),this.justTheDate=b.toBoolean(a.justTheDate)}return d.fromDataCollection=function a(b){if(b){var c,e=[];for(c=0;c<b.length;c++)e[e.length]=new d(b[c]);return e}},d.prototype.copyPromptValues=function b(c){this.parmPrompts=a.map(c.parmPrompts)},d});
define('query/services/dto/parameter-container-dto',['require','lodash','system/lang/converter','./parameter-design-dto'],function(require){"use strict";var a=require("lodash"),b=require("system/lang/converter"),c=require("./parameter-design-dto");function d(a){a=a||{},this.hasDependencies=b.toBoolean(a.hasDependencies),this.parmDesigns=c.fromDataCollection(a.parmDesigns)}d.prototype.copyPromptValues=function b(c){var d=e.bind(null,c);a.forEach(this.parmDesigns,d)};function e(b,c){var d=c.copyPromptValues.bind(c);a(b.parmDesigns).filter({id:c.id}).take(1).forEach(d)}return d});
define('query/services/dto/query-container-dto',['require','system/lang/converter','./table-design-dto','./column-design-dto','./join-design-dto','./parameter-container-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./table-design-dto"),c=require("./column-design-dto"),d=require("./join-design-dto"),e=require("./parameter-container-dto");function f(f){f=f||{},this.columnDesigns=c.fromDataCollection(f.columnDesigns),this.isCaseInsensitive=a.toBoolean(f.isCaseInsensitive),this.isChanged=a.toBoolean(f.isChanged),this.isDeleteForce=a.toBoolean(f.isDeleteForce),this.isDistinct=a.toBoolean(f.isDistinct),this.isFormatted=a.toBoolean(f.isFormatted),this.isTop=a.toBoolean(f.isTop),this.isUomVisible=a.toBoolean(f.isUomVisible),this.joinDesigns=d.fromDataCollection(f.joinDesigns),this.pageSize=a.toInteger(f.pageSize),this.parmContainer=new e(f.parmContainer),this.queryText=a.toString(f.queryText),this.queryType=a.toString(f.queryType),this.showTotals=a.toBoolean(f.showTotals),this.sqlChanged=a.toBoolean(f.sqlChanged),this.designChanged=a.toBoolean(f.designChanged),this.startPage=a.toInteger(f.startPage),
this.tableDesigns=b.fromDataCollection(f.tableDesigns),this.topRows=a.toInteger(f.topRows),this.uniqueId=a.toString(f.uniqueId),this.catalogPath=a.toString(f.catalogPath),this.asyncQueryRowLimit=a.toInteger(f.asyncQueryRowLimit),this.tableDesigns&&this.tableDesigns.sort(g),this.appendSource=new b(f.appendSource),this.predecessorSource=new b(f.predecessorSource),this.successorSource=new b(f.successorSource),this.designStatus=f.designStatus,this.loadStatus=f.loadStatus}function g(a,b){var c=a.caption.toLowerCase(),d=b.caption.toLowerCase();return c.indexOf("[")===-1&&c.indexOf("{")===-1||(c=c.slice(1,c.length-1)),d.indexOf("[")===-1&&d.indexOf("{")===-1||(d=d.slice(1,d.length-1)),c===d?0:c<d?-1:1}return f});
define('query/services/dto/query-result-dto',[],function(){"use strict";function a(){this.rowCount=0,this.columns=[],this.rows=[],this.timeoutExceeded=!1}return a});
define('system/lang/private',["require","exports"],function(require,exports){"use strict";function a(a){return a.__private__=a.__private__||{},a.__private__}return a});
define('query/model/query-result',['require','ramda','system/lang/private','mi-assert'],function(require){"use strict";var a=require("ramda"),b=require("system/lang/private"),c=require("mi-assert");function d(){b(this).rowCount=0,b(this).columns=[],b(this).rows=[],b(this).timeoutExceeded=!1}var e=d.prototype;e.getRowCount=function(){return b(this).rowCount},e.setRowCount=function(a){c.isNumber(a,"rowCount"),b(this).rowCount=a},e.getColumns=function(){return b(this).columns},e.setColumns=function(a){c.isArray(a,"columns"),b(this).columns=a},e.getVisibleColumns=function(){var c=b(this).columns;return a.filter(f,c)};function f(a){return a.getIsDisplayed()}return e.getRows=function(){return b(this).rows},e.setRows=function(a){c.isArray(a,"rows"),b(this).rows=a},e.getTimeoutExceeded=function(){return b(this).timeoutExceeded},e.setTimeoutExceeded=function(a){c.isBoolean(a,"timeoutExceeded"),b(this).timeoutExceeded=a},d});
define('query/services/dto/column-result-dto',[],function(){"use strict";function a(){this.typeName="",this.alias="",this.localizedAlias="",this.isDisplayed=!0,this.fieldDataType="",this.hyperlinkFormat="",this.columnDesignKey=-1,this.fieldKey="",this.fieldId="",this.caption="",this.defaultCaption="",this.displayUomCaption="",this.displayUomDefaultCaption="",this.storageUomCaption="",this.storageUomDefaultCaption=""}return a});
define('query/model/column-result',['require','system/lang/private','mi-assert'],function(require){"use strict";var a=require("system/lang/private"),b=require("mi-assert");function c(){a(this).typeName="",a(this).alias="",a(this).localizedAlias="",a(this).isDisplayed=!0,a(this).fieldDataType="",a(this).hyperlinkFormat="",a(this).columnDesignKey=-1,a(this).fieldKey="",a(this).fieldId="",a(this).caption="",a(this).defaultCaption="",a(this).displayUomCaption="",a(this).displayUomDefaultCaption="",a(this).storageUomCaption="",a(this).storageUomDefaultCaption="",a(this).format=""}var d=c.prototype;return d.getTypeName=function(){return a(this).typeName},d.setTypeName=function(c){b.isString(c,"typeName"),a(this).typeName=c},d.getAlias=function(){return a(this).alias},d.setAlias=function(c){b.isString(c,"alias"),a(this).alias=c},d.getLocalizedAlias=function(){return a(this).localizedAlias},d.setLocalizedAlias=function(c){b.isString(c,"localizedAlias"),a(this).localizedAlias=c},d.getIsDisplayed=function(){return a(this).isDisplayed},d.setIsDisplayed=function(c){
b.isBoolean(c,"isDisplayed"),a(this).isDisplayed=c},d.getFieldDataType=function(){return a(this).fieldDataType},d.setFieldDataType=function(c){b.isString(c,"fieldDataType"),a(this).fieldDataType=c},d.getHyperlinkFormat=function(){return a(this).hyperlinkFormat},d.setHyperlinkFormat=function(c){b.isString(c,"hyperlinkFormat"),a(this).hyperlinkFormat=c},d.getFormat=function(){return a(this).format},d.setFormat=function(c){b.isString(c,"format"),a(this).format=c},d.getColumnDesignKey=function(){return a(this).columnDesignKey},d.setColumnDesignKey=function(c){b.isNumber(c,"columnDesignKey"),a(this).columnDesignKey=c},d.getFieldKey=function(){return a(this).fieldKey},d.setFieldKey=function(c){b.isString(c,"fieldKey"),a(this).fieldKey=c},d.getFieldId=function(){return a(this).fieldId},d.setFieldId=function(c){b.isString(c,"fieldId"),a(this).fieldId=c},d.getCaption=function(){return a(this).caption},d.setCaption=function(c){b.isString(c,"caption"),a(this).caption=c},
d.getDefaultCaption=function(){return a(this).defaultCaption},d.setDefaultCaption=function(c){b.isString(c,"defaultCaption"),a(this).defaultCaption=c},d.getDisplayUomCaption=function(){return a(this).displayUomCaption},d.setDisplayUomCaption=function(c){b.isString(c,"displayUomCaption"),a(this).displayUomCaption=c},d.getDisplayUomDefaultCaption=function(){return a(this).displayUomDefaultCaption},d.setDisplayUomDefaultCaption=function(c){b.isString(c,"displayUomDefaultCaption"),a(this).displayUomDefaultCaption=c},d.getStorageUomCaption=function(){return a(this).storageUomCaption},d.setStorageUomCaption=function(c){b.isString(c,"storageUomCaption"),a(this).storageUomCaption=c},d.getStorageUomDefaultCaption=function(){return a(this).storageUomDefaultCaption},d.setStorageUomDefaultCaption=function(c){b.isString(c,"storageUomDefaultCaption"),a(this).storageUomDefaultCaption=c},d.setFormat=function(c){b.isString(c,"format"),a(this).format=c},c});
define('query/adapters/column-result-adapter',['require','ramda','mi-assert','system/lang/converter','../services/dto/column-result-dto','../model/column-result'],function(require){"use strict";var a=require("ramda"),b=require("mi-assert"),c=require("system/lang/converter"),d=require("../services/dto/column-result-dto"),e=require("../model/column-result");function f(a){var e=new d;return b.isObject(a,"data"),e.typeName=c.toString(a.typeName),e.alias=c.toString(a.alias),e.localizedAlias=c.toString(a.localizedAlias),e.isDisplayed=c.toBoolean(a.isDisplayed),e.fieldDataType=c.toString(a.fieldDataType),e.hyperlinkFormat=c.toString(a.hyperlink),e.columnDesignKey=c.toInteger(a.columnDesignKey,-1),e.fieldKey=c.toString(a.fieldKey),e.fieldId=c.toString(a.fieldId),e.caption=c.toString(a.caption),e.defaultCaption=c.toString(a.defaultCaption),e.displayUomCaption=c.toString(a.displayUomCaption),e.displayUomDefaultCaption=c.toString(a.displayUomDefaultCaption),e.storageUomCaption=c.toString(a.storageUomCaption),e.storageUomDefaultCaption=c.toString(a.storageUomDefaultCaption),e.format=c.toString(a.format),e}function g(a){var c=new e
;return b.instanceOf(a,d,"dto"),c.setTypeName(a.typeName),c.setAlias(a.alias),c.setLocalizedAlias(a.localizedAlias),c.setIsDisplayed(a.isDisplayed),c.setFieldDataType(a.fieldDataType),c.setHyperlinkFormat(a.hyperlinkFormat),c.setColumnDesignKey(a.columnDesignKey),c.setFieldKey(a.fieldKey),c.setFieldId(a.fieldId),c.setCaption(a.caption),c.setDefaultCaption(a.defaultCaption),c.setDisplayUomCaption(a.displayUomCaption),c.setDisplayUomDefaultCaption(a.displayUomDefaultCaption),c.setStorageUomCaption(a.storageUomCaption),c.setStorageUomDefaultCaption(a.storageUomDefaultCaption),c.setFormat(a.format),c}return{deserialize:f,deserializeArray:a.map(f),toModel:g,toModelArray:a.map(g)}});
define('query/services/dto/row-dto',[],function(){"use strict";function a(){this.cells=[]}return a});
define('query/model/row',['require','ramda','system/lang/private','mi-assert'],function(require){"use strict";var a=require("ramda"),b=require("system/lang/private"),c=require("mi-assert");function d(){b(this).cells=[]}var e=d.prototype;e.getCells=function(){return b(this).cells},e.setCells=function(a){c.isArray(a,"cells"),b(this).cells=a},e.getVisibleCells=function(){var c=b(this).cells;return a.filter(f,c)};function f(a){return a.isVisible()}return d});
define('query/services/dto/cell-dto',[],function(){"use strict";function a(){this.dbValue=null,this.value="",this.utcValue="",this.backColor=""}return a});
define('system/lang/string',[],function(){"use strict";String.prototype.toStaticHTML=function(){return window.toStaticHTML?window.toStaticHTML(this).trim():this.trim()},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.startsWith=function(a,b){void 0===b&&(b=!0);var c=b?a.toLowerCase():a,d=a.length;return(b?this.toLowerCase():this).substr(0,d)===c},String.prototype.format=function(){var a=arguments,b=/\{(\d|\d\d)\}/g,c=/\d+/;return this.replace(b,function(b){var d=1*b.match(c)[0];return void 0!==a[d]?a[d]:""===a[d]?"":b})},String.isNullOrWhitespace=function(a){return void 0===a||null===a||("string"!=typeof a&&(a=a.toString()),""===a.trim())},String.compare=function(a,b){return void 0!==a&&null!==a&&void 0!==b&&null!==b&&a.toLocaleLowerCase().localeCompare(b.toLocaleLowerCase())},String.escapeRegex=function(a){return String(a).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},String.prototype.endsWith=function(a,b){
var c=this.toString();("number"!=typeof b||!isFinite(b)||Math.floor(b)!==b||b>c.length)&&(b=c.length),b-=a.length;var d=c.lastIndexOf(a,b);return d!==-1&&d===b}});
define('query/model/cell',['require','system/lang/private','mi-assert','./column-result','system/lang/converter','system/text/formatter','application/application-context','system/lang/string'],function(require){"use strict";var a=require("system/lang/private"),b=require("mi-assert"),c=require("./column-result"),d=require("system/lang/converter"),e=require("system/text/formatter"),f=require("application/application-context");require("system/lang/string");function g(){a(this).column=null,a(this).dbValue=null,a(this).value="",a(this).utcValue="",a(this).backColor="",a(this).hyperlinkRoute="",a(this).formatter=Object.resolve(e)}var h=g.prototype;return h.getColumn=function(){return a(this).column},h.setColumn=function(d){b.instanceOf(d,c,"column"),a(this).column=d},h.getDbValue=function(){var b=a(this).column,c=a(this).dbValue;if(!b)return c;switch(b.getTypeName()){case"System.DateTime":return d.toDate(c);case"System.Integer":return d.toNullableInteger(c);case"System.Double":return d.toNullableFloat(c);case"System.Boolean":return d.toBoolean(c);case"System.String":return"Boolean"===b.getFieldDataType()?c===!0||"Y"===c:d.toString(c);default:return c}},
h.setDbValue=function(b){a(this).dbValue=b},h.getValue=function(){var b=a(this).value,c=this.getDbValue(),d=a(this).column,e=a(this).formatter,g=f.user.formats.dateTime;if(!d||b)return b;switch(d.getTypeName()){case"System.DateTime":return c?e.format(c,g):"";case"System.Integer":case"System.Double":return null===c?c:e.format(c,"g");default:return c?c.toString():""}},h.setValue=function(c){b.isString(c,"value"),a(this).value=c},h.getUtcValue=function(){return a(this).utcValue},h.setUtcValue=function(c){b.isString(c,"utcValue"),a(this).utcValue=c},h.getBackColor=function(){return a(this).backColor},h.setBackColor=function(c){b.isString(c,"backColor"),a(this).backColor=c},h.getHyperlinkRoute=function(){return a(this).hyperlinkRoute},h.setHyperlinkRoute=function(c){b.isString(c,"hyperlinkRoute"),a(this).hyperlinkRoute=c},h.isVisible=function(){return a(this).column.getIsDisplayed()},g});
define('query/adapters/cell-adapter',['require','ramda','mi-assert','system/lang/converter','../services/dto/cell-dto','../model/cell'],function(require){"use strict";var a=require("ramda"),b=require("mi-assert"),c=require("system/lang/converter"),d=require("../services/dto/cell-dto"),e=require("../model/cell");function f(a){var e=new d;return b.isObject(a,"data"),void 0===a.dbValue?e.dbValue=null:e.dbValue=a.dbValue,e.value=c.toString(a.value),e.utcValue=c.toString(a.utcValue),e.backColor=c.toString(a.backColor),e}var g=a.addIndex(a.map);function h(a,c){return b.isArray(c,"dtos"),g(i.bind(null,a),c)}function i(a,c,f){var g=new e;return b.instanceOf(c,d,"dto"),g.setDbValue(c.dbValue),g.setValue(c.value),g.setUtcValue(c.utcValue),g.setBackColor(c.backColor),g.setColumn(a[f]),g}return{deserialize:f,deserializeArray:a.map(f),toModel:i,toModelArray:h}});
define('query/adapters/row-adapter',['require','ramda','mi-assert','system/lang/converter','../services/dto/row-dto','../model/row','./cell-adapter'],function(require){"use strict";var a=require("ramda"),b=require("mi-assert"),c=require("system/lang/converter"),d=require("../services/dto/row-dto"),e=require("../model/row"),f=require("./cell-adapter");function g(a){var e=new d,g=c.toObject(a.cells,[]);return b.isObject(a,"data"),e.cells=f.deserializeArray(g),e}function h(c,d){return b.isArray(d,"dtos"),a.map(i.bind(null,c),d)}function i(a,c){var g=new e,h,i;for(b.instanceOf(c,d,"dto"),b.isArray(a,"columnResults"),h=f.toModelArray(a,c.cells),i=0;i<h.length;i++)j(h,a[i],h[i]);return g.setCells(h),g}function j(a,b,c){var d=k(b,a);c.setHyperlinkRoute(d)}function k(b,c){var d=b.getHyperlinkFormat(),e=l(c);return a.all(n,e)?"":d.format.apply(d,e)}function l(b){return a.map(m,b)}function m(a){return a.getValue()}function n(a){return!a}return{deserialize:g,deserializeArray:a.map(g),toModel:i,toModelArray:h}});
define('query/adapters/query-result-adapter',['require','ramda','mi-assert','system/lang/converter','../services/dto/query-result-dto','../model/query-result','./column-result-adapter','./row-adapter'],function(require){"use strict";var a=require("ramda"),b=require("mi-assert"),c=require("system/lang/converter"),d=require("../services/dto/query-result-dto"),e=require("../model/query-result"),f=require("./column-result-adapter"),g=require("./row-adapter");function h(a){var e=new d,h=c.toObject(a.columns,[]),i=c.toObject(a.rows,[]);return b.isObject(a,"data"),e.rowCount=c.toInteger(a.rowCount),e.columns=f.deserializeArray(h),e.rows=g.deserializeArray(i),e.timeoutExceeded=c.toBoolean(a.timeoutExceeded),e}function i(a){b.instanceOf(a,d,"dto");var c=new e;return c.setRowCount(a.rowCount),c.setColumns(f.toModelArray(a.columns)),c.setRows(g.toModelArray(c.getColumns(),a.rows)),c.setTimeoutExceeded(a.timeoutExceeded),c}return{deserialize:h,deserializeArray:a.map(h),toModel:i,toModelArray:a.map(i)}});
define('query/services/dto/table-dto',['require','system/lang/converter','./column-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./column-dto");function c(c){c=c||{},this.caption=a.toString(c.caption),this.defaultCaption=a.toString(c.defaultCaption),this.id=a.toString(c.id),this.queryColumns=b.fromDataCollection(c.queryColumns),this.tableType=a.toString(c.tableType),this.queryColumns&&(this.queryColumns=this.queryColumns.sort(d))}c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}};function d(a,b){var c=a.caption.toLowerCase(),d=b.caption.toLowerCase(),e=!1,f=!1;return c.indexOf("[")===-1&&c.indexOf("{")===-1||(e=!0,c=c.slice(1,c.length-1)),d.indexOf("[")===-1&&d.indexOf("{")===-1||(f=!0,d=d.slice(1,d.length-1)),e&&f||!e&&!f?c===d?0:c<d?-1:1:e?-1:1}return c});
define('query/services/dto/join-source-dto',['require','system/lang/converter','./table-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./table-dto");function c(c){c=c||{},this.entFamilyCaption=a.toString(c.entFamilyCaption),this.entFamilyId=a.toString(c.entFamilyId),this.joinSucc=a.toBoolean(c.joinSucc),this.relFamilyCaption=a.toString(c.relFamilyCaption),this.relFamilyId=a.toString(c.relFamilyId),this.entTableData=new b(c.entTableData),this.relTableData=new b(c.relTableData)}return c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}},c});
define('query/services/dto/hyperlink-route-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.featureKey=a.toString(b.featureKey),this.sortOrder=a.toInteger(b.sortOrder),this.caption=a.toString(b.caption),this.pattern=a.toString(b.pattern),this.parm1Caption=a.toString(b.parm1Caption),this.parm2Caption=a.toString(b.parm2Caption),this.parm3Caption=a.toString(b.parm3Caption)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('query/services/dto/hyperlink-feature-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.id=a.toString(b.id),this.sortOrder=a.toInteger(b.sortOrder),this.caption=a.toString(b.caption)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('query/services/dto/hyperlink-container-dto',['require','system/lang/converter','./hyperlink-route-dto','./hyperlink-feature-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./hyperlink-route-dto"),c=require("./hyperlink-feature-dto");function d(a){a=a||{},this.features=c.fromDataCollection(a.features),this.routes=b.fromDataCollection(a.routes)}return d});
define('query/services/query-service',['require','lodash','jquery','system/http/ajax-client','./dto/rowset-dto','./dto/query-container-dto','../adapters/query-result-adapter','./dto/table-dto','./dto/table-design-dto','./dto/column-dto','./dto/join-source-dto','./dto/hyperlink-container-dto','system/lang/converter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/http/ajax-client"),d=require("./dto/rowset-dto"),e=require("./dto/query-container-dto"),f=require("../adapters/query-result-adapter"),g=require("./dto/table-dto"),h=require("./dto/table-design-dto"),i=require("./dto/column-dto"),j=require("./dto/join-source-dto"),k=require("./dto/hyperlink-container-dto"),l="api/core/queryengine",m="api/core/url",n=require("system/lang/converter");function o(a){this.ajaxClient=a}o.dependsOn=[c],o.prototype.evaluateQuerySql=function a(c){var d=b.Deferred(),e=l+"/evaluate/string",f=b.Deferred();return this.ajaxClient.post(e,{value:c}).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.getPromptArrayFromQueryString=function a(b){var c=/^p\d+$/,d=[],e,f,g=[],h=0,i=0;for(var j in b)b.hasOwnProperty(j)&&c.test(j)&&d.push(j);for(d.sort(),h=0;h<d.length;h++){if(e=d[h],f=e.match(/\d+/)[0],h.toString()!==f)for(i=h,
i=0;i<f;i++)g.push(null);g.push(b[e])}return g},o.prototype.evaluateQueryContainer=function a(c){var d=b.Deferred(),e=l+"/evaluate/container",f=b.Deferred();return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.executeQuerySql=function a(c){var e=b.Deferred(),f=l+"/execute/string",g=b.Deferred();return this.ajaxClient.post(f,{value:c}).done(function(a){e.resolve(new d(a))}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.executeQueryContainer=function a(c){var e=b.Deferred(),f=l+"/execute/container",g=b.Deferred();return this.ajaxClient.post(f,c).done(function(a){e.resolve(new d(a))}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.executeQueryContainerSync=function a(c){var d=b.Deferred(),e=l+"/executesync/container";return this.ajaxClient.post(e,c).done(function(a){d.resolve(f.deserialize(a))}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.getEntitySources=function c(){
var d=l+"/entitysources/all",e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(b){var c=a.map(b,function(a){return new g(a)});c.sort(p),e.resolve(c)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.getEntitySource=function a(c){var d=l+"/entitysource?entityFamilyId="+c,e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(a){var b=new h(a);e.resolve(b)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.getJoinSources=function a(c){var d=l+"/joinsources?entFamilyId="+c,e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(a){var c=b.map(a,function(a){return new j(a)});e.resolve(c)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.joinsourcesForRf=function a(c){var d=l+"/joinsources_for_rf?relFamilyId="+c,e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(a){var c=b.map(a,function(a){return new j(a)});e.resolve(c)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.getJoinSource=function a(c,d,e,f){var g,h=b.Deferred()
;return f=f!==!1||f,g=l+"/joinsource?predFamilyId="+c+"&relFamilyId="+d+"&succFamilyId="+e+"&getSuccessor="+f,this.ajaxClient.get(g,{}).done(function(a){var b=new j(a);h.resolve(b)}).fail(function(a){h.reject(a)}),h.promise()},o.prototype.getRelSources=function a(){var c,d=b.Deferred();return c=l+"/relsources/all",this.ajaxClient.get(c,{}).done(function(a){var c=b.map(a,function(a){return new g(a)});c.sort(p),d.resolve(c)}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.getRelSource=function a(c){var d=l+"/relsource?relFamilyId="+c,e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(a){var b=new h(a);e.resolve(b)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.compileString=function a(c){var d=b.Deferred(),f=l+"/compilestring/",g=b.Deferred(),h;return this.ajaxClient.post(f,{value:c}).done(function(a){h=new e(a),d.resolve(h)}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.compileContainer=function a(c){
var d=b.Deferred(),e=l+"/compilecontainer/",f=b.Deferred();return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.recompileContainer=function a(c){var d=b.Deferred(),f=l+"/recompilecontainer/",g=b.Deferred();return this.ajaxClient.post(f,c).done(function(a){d.resolve(new e(a))}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.compileContainerParameters=function a(c){var d=b.Deferred(),f=l+"/compileparameters/",g=b.Deferred();return this.ajaxClient.post(f,c).done(function(a){d.resolve(new e(a))}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.compileParameterDesign=function a(c){var d=b.Deferred(),e=l+"/compileparamdesign/",f=b.Deferred();return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.getQueryAsSource=function a(c){var d=l+"/querysource?catalogItemPath="+encodeURIComponent(c),e=b.Deferred()
;return this.ajaxClient.get(d,{}).done(function(a){var b=new h(a);e.resolve(b)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.getDatasheets=function a(c){var d=l+"/datasheets?fmlyId="+c,e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.getDatasheetColumns=function a(c,d){var e=l+"/datasheetColumns?fmlyId="+c+"&datasheetCaption="+d,f=b.Deferred();return this.ajaxClient.get(e,{}).done(function(a){var c=b.map(a,function(a){return new i(a)});c.sort(p),f.resolve(c)}).fail(function(a){f.reject(a)}),f.promise()},o.prototype.convertSimpleCriteria=function a(c,d,e){var f=b.Deferred(),g=l+"/convertcriteria?columnIdx="+d.toString()+"&criteriaIdx="+e.toString();return this.ajaxClient.post(g,c).done(function(a){f.resolve(a)}).fail(function(a){f.reject(a)}),f.promise()},o.prototype.convertSimpleCriteriaText=function a(c,d,e,f,g){var h=b.Deferred(),i=l+"/convertsimplecriteriatext"
;return this.ajaxClient.post(i,{queryContainer:c,toDisplay:d,columnKey:e,criteriaIndex:f,factorTexts:g}).done(function(a){h.resolve(a)}).fail(function(a){h.reject(a)}),h.promise()},o.prototype.convertCriteriaText=function a(c,d,e,f,g){var h=b.Deferred(),i=l+"/convertcriteriatext";return this.ajaxClient.post(i,{queryContainer:c,toDisplay:d,columnKey:e,criteriaIndex:f,factorText:g}).done(function(a){h.resolve(a)}).fail(function(a){h.reject(a)}),h.promise()},o.prototype.convertExpressionText=function a(c,d,e,f,g){var h=b.Deferred(),i=l+"/convertexpressiontext";return this.ajaxClient.post(i,{queryContainer:c,toDisplay:d,columnKey:e,criteriaIndex:f,factorText:g}).done(function(a){h.resolve(a)}).fail(function(a){h.reject(a)}),h.promise()},o.prototype.getUrlContainer=function a(){var c=m+"/hyperlink/container",d=b.Deferred();return this.ajaxClient.get(c,{}).done(function(a){var b=new k(a);d.resolve(b)}).fail(function(a){d.reject(a)}),d.promise()};function p(a,b){
var c=a.caption.toLowerCase(),d=b.caption.toLowerCase();return c.indexOf("[")===-1&&c.indexOf("{")===-1||(c=c.slice(1,c.length-1)),d.indexOf("[")===-1&&d.indexOf("{")===-1||(d=d.slice(1,d.length-1)),c===d?0:c<d?-1:1}return o});

define('text!dashboard/view-models/url-builder/view-models/views/url-format.html',[],function () { return '<div class="padded">\r\n    <input type="radio" name="urlFormat" value="apm" data-bind="\r\n        checked: builder.urlFormat,\r\n        event: { change: onChecked }\r\n        "\r\n    />\r\n    <label class="label" data-bind="text: translate(\'MERIDIUM_URL\')"/>\r\n</div>\r\n<div class="padded"></div>';});


define('text!ui/elements/radio/radio-template.html',[],function () { return '<script id="mi-radio-tmpl" type="text/html">\r\n    <div class="radio-container" tabindex="0">\r\n        <input type="radio" data-bind="checked: $root.checked,disable: $root.disable,value:$root.value, attr:{id:$data.id , name:$root.name, required:$root.required} " />\r\n        <label data-bind="attr:{for:$data.id}"></label>\r\n        <span class="radio-text" data-bind="text: $root.text, click: $data.textClick"></span>\r\n    </div>\r\n</script>';});

define('ui/elements/radio/radio-view-model',['require','lodash','jquery','text!./radio-template.html','knockout'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./radio-template.html"),d=require("knockout");d.bindingHandlers.miRadioProperty={createNodes:function(a,b){document.getElementById("mi-radio-tmpl")||document.body.insertAdjacentHTML("beforeend",c),d.applyBindingsToNode(a,{template:{name:"mi-radio-tmpl"}},b)},init:function(a,c){var e=c();return e.id=d.bindingHandlers.miRadioProperty.getGuid(),e.textClick=function a(c,d){if(b(d.target).parent().find('input[type="radio"]').prop("disabled"))return!1;b(d.target).parent().find("input").prop("checked",!0),b(d.target).parent().find("input").trigger("change"),"function"==typeof this.checked&&this.checked(this.value)},d.bindingHandlers.miRadioProperty.createNodes(a,e),{controlsDescendantBindings:!0}},getGuid:function a(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},s4:function a(){
for(var b="",c="abcdefghijklmnopqrstuvwxyz",d=0;d<4;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},update:function(c,e){var f;a.each(e(),function(a,e){f=d.unwrap(a),"disable"===e?b(c).find('input[type="radio"]').prop("disabled",f):"text"===e&&b(c).find(".radio-text").html(f)})}};var e=Object.create(HTMLElement.prototype);document.registerElement("mi-radio",{prototype:e})});
define('dashboard/view-models/url-builder/view-models/url-format-view-model',['require','jquery','application/application-events','spa/conductor','system/error/error-message','spa/ko/knockout-view-model','knockout','system/knockout/knockout-manager','spa/region','system/globalization/translator','text!./views/url-format.html','system/lang/string','system/lang/object','ui/elements/radio/radio-view-model'],function(require){"use strict";var a=require("jquery"),b=require("application/application-events"),c=require("spa/conductor"),d=require("system/error/error-message"),e=require("spa/ko/knockout-view-model"),f=require("knockout"),g=require("system/knockout/knockout-manager"),h=require("spa/region"),i=require("system/globalization/translator"),j=require("text!./views/url-format.html");require("system/lang/string"),require("system/lang/object"),require("ui/elements/radio/radio-view-model");function k(a,b){l.call(this,j),this.kom=a,this.applicationEvents=b,this.translator=Object.resolve(i),this.region=null,this.builder=null}var l=Object.inherit(e,k);k.factory=function(){return new k(Object.resolve(g),Object.resolve(b))},k.prototype.load=function(b){var c=new a.Deferred,d=this;return this.builder=b,c.promise()},k.prototype.unload=function(){this.kom.disposeObservables()},k.prototype.activate=function(){},k.prototype.deactivate=function(a){this.kom.disposeSubscriptions(),
this.kom.disposeComputeds()},k.prototype.attach=function(a){this.region=new h,this.region.setElement(a.$element.find(".content")),l.prototype.attach.call(this,this.region),this.builder.urlFormat&&this.builder.urlFormat()&&this.builder.urlFormat().length>0?this.builder.wizard.setAttribute("data-valid",!0):this.builder.wizard.setAttribute("data-valid",!1)},k.prototype.detach=function(a){l.prototype.detach.call(this,a)},k.prototype.canUnload=function(){return!0},k.prototype.onChecked=function(a,b){this.builder.wizard.setAttribute("data-valid",!0),this.builder.onFormatSelected(b.target.value)},k.prototype.translate=function(a){return this.translator.translate(a)};function m(a,b){var c=2,e=b,f=new d(c,e);a.applicationEvents.errorOccured.raise(a,f)}function n(a,b){m(a,b.statusText)}return k});

define('text!dashboard/view-models/url-builder/view-models/views/url-feature.html',[],function () { return '<mi-list-group class="feature-list"\r\n               selector="none"\r\n                multiselect="false"\r\n                key="key"\r\n                description="caption"\r\n                page="1"\r\n                page-size="25"\r\n                scroll-percent="0.75"\r\n                custom-filter="false"\r\n                custom-search="false"\r\n                allow-add="false"\r\n                has-children="false"\r\n                data-bind="event: {\'selected\':$root.onFeatureSelected}">\r\n</mi-list-group>\r\n';});

define('dashboard/view-models/url-builder/view-models/url-feature-view-model',['require','jquery','application/application-events','spa/conductor','system/error/error-message','spa/ko/knockout-view-model','knockout','system/knockout/knockout-manager','spa/region','system/globalization/translator','text!./views/url-feature.html','system/lang/string','system/lang/object'],function(require){"use strict";var a=require("jquery"),b=require("application/application-events"),c=require("spa/conductor"),d=require("system/error/error-message"),e=require("spa/ko/knockout-view-model"),f=require("knockout"),g=require("system/knockout/knockout-manager"),h=require("spa/region"),i=require("system/globalization/translator"),j=require("text!./views/url-feature.html");require("system/lang/string"),require("system/lang/object");function k(a,b){l.call(this,j),this.kom=a,this.applicationEvents=b,this.translator=Object.resolve(i),this.region=null,this.builder=null,this.featureList=null}var l=Object.inherit(e,k);k.factory=function(){return new k(Object.resolve(g),Object.resolve(b))},k.prototype.load=function(b){var c=new a.Deferred,d=this;return this.builder=b,c.promise()},k.prototype.unload=function(a){this.kom.disposeObservables()},k.prototype.activate=function(){},k.prototype.deactivate=function(a){this.kom.disposeSubscriptions(),this.kom.disposeComputeds()},
k.prototype.attach=function(a){this.region=new h,this.region.setElement(a.$element.find(".content")),l.prototype.attach.call(this,this.region),this.featureList=this.region.$element.find("mi-list-group")[0],Element.upgrade(this.featureList),this.featureList.items=this.builder.features,this.builder.selectedFeature()?(this.featureList.value=this.builder.selectedFeature(),this.builder.wizard.setAttribute("data-valid",!0)):this.builder.wizard.setAttribute("data-valid",!1)},k.prototype.detach=function(a){l.prototype.detach.call(this,a)},k.prototype.canUnload=function(){return!0},k.prototype.translate=function(a){return this.translator.translate(a)},k.prototype.onFeatureSelected=function(a,b){this.builder.onFeatureSelected(b.target.value),this.builder.wizard.setAttribute("data-valid",!0)};function m(a,b){var c=2,e=b,f=new d(c,e);a.applicationEvents.errorOccured.raise(a,f)}function n(a,b){m(a,b.statusText)}return k});

define('text!dashboard/view-models/url-builder/view-models/views/url-type.html',[],function () { return '<mi-list-group class="route-list"\r\n               selector="none"\r\n               multiselect="false"\r\n               key="key"\r\n               description="caption"\r\n               page="1"\r\n               page-size="25"\r\n               scroll-percent="0.75"\r\n               custom-filter="false"\r\n               custom-search="false"\r\n               allow-add="false"\r\n               has-children="false"\r\n               data-bind="event: {\'selected\':$root.onRouteSelected}">\r\n</mi-list-group>\r\n';});

define('dashboard/view-models/url-builder/view-models/url-type-view-model',['require','jquery','application/application-events','spa/conductor','system/error/error-message','spa/ko/knockout-view-model','knockout','system/knockout/knockout-manager','spa/region','system/globalization/translator','text!./views/url-type.html','system/lang/string','system/lang/object'],function(require){"use strict";var a=require("jquery"),b=require("application/application-events"),c=require("spa/conductor"),d=require("system/error/error-message"),e=require("spa/ko/knockout-view-model"),f=require("knockout"),g=require("system/knockout/knockout-manager"),h=require("spa/region"),i=require("system/globalization/translator"),j=require("text!./views/url-type.html");require("system/lang/string"),require("system/lang/object");function k(a,b){l.call(this,j),this.kom=a,this.applicationEvents=b,this.translator=Object.resolve(i),this.region=null,this.builder=null,this.routeList=null}var l=Object.inherit(e,k);k.factory=function(){return new k(Object.resolve(g),Object.resolve(b))},k.prototype.load=function(b){var c=new a.Deferred,d=this;return this.builder=b,c.promise()},k.prototype.unload=function(){this.kom.disposeObservables()},k.prototype.activate=function(){},k.prototype.deactivate=function(a){this.kom.disposeSubscriptions(),this.kom.disposeComputeds()},
k.prototype.attach=function(a){this.region=new h,this.region.setElement(a.$element.find(".content")),l.prototype.attach.call(this,this.region),this.routeList=this.region.$element.find("mi-list-group")[0],Element.upgrade(this.routeList),this.routeList.items=this.builder.routes,this.builder.selectedRoute()?(this.routeList.value=this.builder.selectedRoute(),this.builder.wizard.setAttribute("data-valid",!0)):this.builder.wizard.setAttribute("data-valid",!1)},k.prototype.detach=function(a){l.prototype.detach.call(this,a)},k.prototype.canUnload=function(){return!0},k.prototype.translate=function(a){return this.translator.translate(a)},k.prototype.onRouteSelected=function(a,b){this.builder.onRouteSelected(b.target.value),this.builder.wizard.setAttribute("data-valid",!0)};function m(a,b){var c=2,e=b,f=new d(c,e);a.applicationEvents.errorOccured.raise(a,f)}function n(a,b){m(a,b.statusText)}return k});

define('text!dashboard/view-models/url-builder/view-models/views/url-parm.html',[],function () { return '<div>\r\n    <table data-bind="visible: $root.builder.canShowAPM">\r\n        <tbody>\r\n            <!--ko if: $root.builder.parm2Valid-->\r\n            <tr>\r\n                <td class="padded">\r\n                    <label class="label" data-bind="text: $root.builder.selectedRoute().parm2Caption"></label>\r\n                </td>\r\n                <td class="select">\r\n                    <select data-bind="\r\n                        options: columns,\r\n                        optionsText: \'caption\',\r\n                        optionsValue: \'key\',\r\n                        optionsCaption: $root.translate(\'SELECT_A_VALUE\'),\r\n                        value: $root.builder.parm2Value,\r\n                        event: { change: onSelected }\r\n                    " />\r\n                </td>\r\n            </tr>\r\n            <!--/ko-->\r\n            <tr>\r\n                <label class="label" data-bind="text: $root.translate(\'HYPERLINK\')"></label>\r\n                <input style="width:100%;" data-bind="value: $root.builder.urlInput"/>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n\r\n    <div class="form-group" data-bind="visible: $root.builder.canShowManual">\r\n        <label data-bind="text: $root.translate(\'HYPERLINK\')"></label>\r\n        <input type="text"\r\n               class="form-control"\r\n               data-bind="value: $root.builder.manualURL" />\r\n    </div>\r\n</div>';});

define('dashboard/view-models/url-builder/view-models/url-parm-view-model',['require','jquery','application/application-events','spa/conductor','system/error/error-message','spa/ko/knockout-view-model','knockout','system/knockout/knockout-manager','spa/region','system/globalization/translator','text!./views/url-parm.html','system/lang/string','system/lang/object'],function(require){"use strict";var a=require("jquery"),b=require("application/application-events"),c=require("spa/conductor"),d=require("system/error/error-message"),e=require("spa/ko/knockout-view-model"),f=require("knockout"),g=require("system/knockout/knockout-manager"),h=require("spa/region"),i=require("system/globalization/translator"),j=require("text!./views/url-parm.html");require("system/lang/string"),require("system/lang/object");function k(a,b){l.call(this,j),this.kom=a,this.applicationEvents=b,this.translator=Object.resolve(i),this.region=null,this.builder=null,this.columns=null}var l=Object.inherit(e,k);k.factory=function(){return new k(Object.resolve(g),Object.resolve(b))},k.prototype.load=function(b){var c=new a.Deferred,d=this;return this.builder=b,this.columns=this.kom.observableArray(),c.promise()},k.prototype.unload=function(){this.kom.disposeObservables()},k.prototype.deactivate=function(a){this.kom.disposeSubscriptions(),this.kom.disposeComputeds()},
k.prototype.attach=function(a){this.region=new h,this.region.setElement(a.$element.find(".content")),l.prototype.attach.call(this,this.region),this.builder.setInitialUrl(),this.builder.wizard.setAttribute("data-valid",!0)},k.prototype.detach=function(a){l.prototype.detach.call(this,a)},k.prototype.canUnload=function(){return!0},k.prototype.translate=function(a){return this.translator.translate(a)},k.prototype.onSelected=function(){this.builder.isParmValid()?this.builder.wizard.setAttribute("data-valid",!0):this.builder.wizard.setAttribute("data-valid",!1)};function m(a,b){var c=2,e=b,f=new d(c,e);a.applicationEvents.errorOccured.raise(a,f)}function n(a,b){m(a,b.statusText)}return k});
define('ui/elements/wizard/view-model',['require','system/globalization/translator'],function(require){"use strict";var a=Object.create(HTMLElement.prototype),b=require("system/globalization/translator");a.createdCallback=function(){var a=Element.build("header",this,["header"]),c=Element.build("div",this,["content"]),d=Element.build("footer",this,["footer"]),f=Element.build("button",d,["next","btn","btn-primary","btn-text"],{name:"next"}),g=Element.build("button",d,["hidden","finish","btn","btn-primary","btn-text"],{name:"finish"}),h=Element.build("button",d,["hidden","back","btn","btn-primary","btn-text"],{name:"back"});if(this.steps=null,this.steps_length=null,this.stepItems=[],this.translator=Object.resolve(b),this.getAttribute("title")){Element.build("h1",a).textContent=this.getAttribute("title")}this.getAttribute("data-steps")&&e(this,this.getAttribute("data-steps")),h.innerHTML=this.translator.translate("PREVIOUS"),f.innerHTML=this.translator.translate("NEXT"),g.innerHTML=this.translator.translate("FINISH")},a.attachedCallback=function(){
this.querySelector("footer").addEventListener("click",this)},a.detachedCallback=function(){this.querySelector("footer").removeEventListener("click",this)},a.handleEvent=function(a){"click"===a.type&&"BUTTON"===a.target.tagName&&(a.target.classList.contains("next")||a.target.classList.contains("back")?c(this,a):a.target.classList.contains("finish")&&this.dispatchEvent(new CustomEvent("completed",{bubbles:!0})))},a.attributeChangedCallback=function(a,b,c){switch(a){case"title":var d=this.querySelector("h1")||document.createElement("h1"),f=this.querySelector("header");d.textContent=c,f.querySelector("header")||f.insertBefore(d,f.querySelector("ul"));break;case"data-steps":e(this,c);break;case"data-active":var g=this.querySelector(".active");g&&g.classList.remove("active"),parseInt(c)>0&&"0"===b&&this.querySelector(".back").classList.remove("hidden"),"0"===c&&parseInt(b)>0&&this.querySelector(".back").classList.add("hidden"),
parseInt(c)===this.steps_length-2&&(this.querySelector(".next").classList.remove("hidden"),this.querySelector(".finish").classList.add("hidden")),parseInt(c)===this.steps_length-1&&(this.querySelector(".finish").classList.remove("hidden"),this.querySelector(".next").classList.add("hidden")),this.hasAttribute("data-valid")&&this.setAttribute("data-valid","false"),this.stepItems[c].classList.add("active"),this.dispatchEvent(new CustomEvent("active-changed",{bubbles:!0}));break;case"data-valid":"true"===c?(this.querySelector(".next").removeAttribute("disabled"),this.querySelector(".finish").removeAttribute("disabled")):(this.querySelector(".next").setAttribute("disabled",!0),this.querySelector(".finish").setAttribute("disabled",!0))}};function c(a,b){d(a,b.target)}function d(a,b){var c=parseInt(a.getAttribute("data-active"));b.classList.contains("cancel")?console.log("Wizard Canceled"):(b.classList.contains("next")&&(c++,a.setAttribute("data-active",c)),b.classList.contains("back")&&(c--,
a.setAttribute("data-active",c)))}function e(a,b){var c=a.querySelector("header"),d=Element.build("ul",c);a.steps=b.split(","),a.steps_length=a.steps.length,a.step_width=(100-.4*a.steps_length)/a.steps_length,a.steps.forEach(function(b){var c=Element.build("li",d),e=Element.build("div",c);c.setAttribute("style","width: "+a.step_width+"%;"),e.innerHTML=b,a.stepItems.push(c)}),a.stepItems[0].classList.add("active")}return Element.registerElement("mi-wizard",{prototype:a}),a});

define('text!dashboard/view-models/url-builder/view-models/views/url-builder.html',[],function () { return '<div class="url-builder-shell block-group">\r\n    <div class="region">\r\n        <div class="url-builder-block block-group">\r\n            <div class="wizard-container url-builder-content block">\r\n                <mi-wizard data-bind=\'\r\n                     event: {\r\n                        "active-changed": activeChanged,\r\n                        "completed": wizardCompleted\r\n                     },\r\n                     attr: {\r\n                \t    "title": $root.wizardTitle\r\n                    }\' data-active="0"/>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="controls">\r\n        <div class="pull-right">\r\n            <button type="button" class="btn btn-primary" data-bind="event: {click: done}, text: translate(\'DONE\').capitalize(), visible: false"></button>\r\n            <button type="button" class="btn btn-default" data-bind="event: {click: cancel}, text: translate(\'CANCEL\')"></button>\r\n        </div>\r\n    </div>\r\n</div>';});

define('dashboard/view-models/url-builder/url-builder',['require','lodash','jquery','application/application-events','spa/conductor','system/error/error-message','spa/ko/knockout-view-model','knockout','system/knockout/knockout-manager','spa/region','system/ui/dialog-view-model','system/globalization/translator','query/services/query-service','dashboard/view-models/url-builder/view-models/url-format-view-model','dashboard/view-models/url-builder/view-models/url-feature-view-model','dashboard/view-models/url-builder/view-models/url-type-view-model','dashboard/view-models/url-builder/view-models/url-parm-view-model','ui/elements/wizard/view-model','text!dashboard/view-models/url-builder/view-models/views/url-builder.html','system/lang/string','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("application/application-events"),d=require("spa/conductor"),e=require("system/error/error-message"),f=require("spa/ko/knockout-view-model"),g=require("knockout"),h=require("system/knockout/knockout-manager"),i=require("spa/region"),j=require("system/ui/dialog-view-model"),k=require("system/globalization/translator"),l=require("query/services/query-service"),m=require("dashboard/view-models/url-builder/view-models/url-format-view-model"),n=require("dashboard/view-models/url-builder/view-models/url-feature-view-model"),o=require("dashboard/view-models/url-builder/view-models/url-type-view-model"),p=require("dashboard/view-models/url-builder/view-models/url-parm-view-model"),q=require("ui/elements/wizard/view-model"),r=require("text!dashboard/view-models/url-builder/view-models/views/url-builder.html");require("system/lang/string"),require("system/lang/object");function s(a,b){t.call(this,r),
this.kom=a,this.applicationEvents=b,this.translator=Object.resolve(k),this.queryService=Object.resolve(l),this.region=null,this.canClickDone=null,this.steps={names:[],viewModels:[]},this.wizard=null,this.urlFormatVM=null,this.urlFeatureVM=null,this.urlTypeVM=null,this.urlParmVM=null,this.urlFormat=null,this.parm1Valid=null,this.parm2Valid=null,this.parm3Valid=null,this.parm1Value=null,this.parm2Value=null,this.parm2Value=null,this.pattern=null,this.manualURL=null,this.queryContainer=null,this.columnDesign=null,this.columnIdx=this.kom.observable(),this.designProperty=this.kom.observable(),this.canShowAPM=null,this.canShowManual=null,this.container=null,this.selectedFeature=null,this.selectedRoute=null,this.features=null,this.routes=null,this.columns=null,this.dfd=null,this.dialog=null,this.result=null,this.urlInput=this.kom.observable()}var t=Object.inherit(f,s);s.factory=function(){return new s(Object.resolve(h),Object.resolve(c))},s.prototype.show=function(){var a={height:"90%",
width:"90%"},c=this.translate("URL_BUILDER");return this.dialog=new j(this,c,a),this.dialog.show(),this.dfd=b.Deferred(),this.dfd.promise()},s.prototype.close=function(){this.dialog=null},s.prototype.open=function(){},s.prototype.load=function(a){var c=new b.Deferred,d=this;return this.canClickDone=this.kom.observable(!0),this.steps.names=this.kom.observableArray(),this.steps.viewModels=this.kom.observableArray(),this.urlFeatureVM=Object.resolve(n),this.urlFeatureVM.load(this),this.steps.names.push(this.translate("SELECT_URL_FEATURE")),this.steps.viewModels.push(this.urlFeatureVM),this.urlTypeVM=Object.resolve(o),this.urlTypeVM.load(this),this.steps.names.push(this.translate("SELECT_URL_TYPE")),this.steps.viewModels.push(this.urlTypeVM),this.urlParmVM=Object.resolve(p),this.urlParmVM.load(this),this.steps.names.push(this.translate("SPECIFY_PARMS")),this.steps.viewModels.push(this.urlParmVM),this.urlFormat=this.kom.observable(),this.selectedFeature=this.kom.observable(),
this.selectedRoute=this.kom.observable(),this.columns=this.kom.observableArray(),this.parm1Valid=this.kom.observable(!1),this.parm2Valid=this.kom.observable(!1),this.parm3Valid=this.kom.observable(!1),this.parm1Value=this.kom.observable(),this.parm2Value=this.kom.observable(),this.parm3Value=this.kom.observable(),this.pattern=this.kom.observable(),this.queryService.getUrlContainer().done(x.bind(null,d)).fail(A.bind(null,d)),c.promise()},s.prototype.unload=function(){this.dfd=null,this.result=null,this.kom.disposeObservables()},s.prototype.activate=function(){this.canShowAPM=this.kom.pureComputed(u.bind(null,this)),this.canShowManual=this.kom.pureComputed(v.bind(null,this))},s.prototype.deactivate=function(a){this.kom.disposeSubscriptions(),this.kom.disposeComputeds()},s.prototype.attach=function(a){t.prototype.attach.call(this,a),this.region=a,this.wizard=this.region.element.querySelector("mi-wizard"),Element.upgrade(this.wizard),this.region=a,this.urlFormat("apm")},
s.prototype.detach=function(a){t.prototype.detach.call(this,a)},s.prototype.canUnload=function(){return!0},s.prototype.setInitialUrl=function(){var a="{"+this.selectedRoute().parm1Caption+"}",b="{"+this.selectedRoute().parm2Caption+"}",c="{"+this.selectedRoute().parm3Caption+"}",d=this.pattern().replace("{1}",a).replace("{2}",b).replace("{3}",c);this.urlInput(d)},s.prototype.translate=function(a){return this.translator.translate(a)},s.prototype.cancel=function(){this.dialog.closeDialog()},s.prototype.done=function(){y(this)&&this.dialog.closeDialog()},s.prototype.onFormatSelected=function(a){var b=this;this.urlFormat(a),"ext"===a&&this.wizard.setAttribute("data-active",3)},s.prototype.onFeatureSelected=function(b){var c=this;b&&(this.selectedFeature&&this.selectedFeature()&&b.key===this.selectedFeature().key||(this.selectedFeature(b),this.routes=a.filter(this.container.routes,w.bind(null,c)),this.selectedRoute(null)))},s.prototype.onRouteSelected=function(a){var b=this
;a&&(this.selectedRoute(a),this.selectedRoute().parm1Caption.length>0?this.parm1Valid(!0):this.parm1Valid(!1),this.selectedRoute().parm2Caption.length>0?this.parm2Valid(!0):this.parm2Valid(!1),this.selectedRoute().parm3Caption.length>0?this.parm3Valid(!0):this.parm3Valid(!1),this.pattern(this.selectedRoute().pattern))},s.prototype.isParmValid=function(){return!0},s.prototype.activeChanged=function(a){if(this.region){this.features=this.container.features;var b=parseInt(this.region.$element.find("mi-wizard").attr("data-active"));"ext"===this.urlFormat()?2===b?(this.wizard.setAttribute("data-active",0),this.steps.viewModels()[0].attach(this.region)):1===b?(this.wizard.setAttribute("data-active",3),this.steps.viewModels()[3].attach(this.region)):this.steps.viewModels()[b].attach(this.region):this.steps.viewModels()[b].attach(this.region)}},s.prototype.wizardCompleted=function(a){this.dfd.resolve(this.urlInput()),this.done()};function u(a){return!!a.urlFormat&&"apm"===a.urlFormat()}
function v(a){return!!a.urlFormat&&"ext"===a.urlFormat()}function w(a,b){return b.featureKey===a.selectedFeature().key}function x(a,b){a.container=b,a.features=a.container.features,a.steps.viewModels()[0].attach(a.region),a.region.$element.find("h1").attr("hidden",!0),a.wizard.setAttribute("data-steps",a.steps.names().toString())}function y(a){if(!a.urlFormat||!a.urlFormat()||0===a.urlFormat().length)return void z(a,a.translate("ERROR_SELECT_URL_FORMAT"));if("ext"===a.urlFormat())return!0;if(!a.selectedFeature||!a.selectedFeature())return void z(a,a.translate("ERROR_SELECT_URL_FEATURE"));if(!a.selectedRoute||!a.selectedRoute())return void z(a,a.translate("ERROR_SELECT_URL_TYPE"));var b=a.selectedRoute().pattern;return b=b.replace(/\{key/g,"{"),!0}function z(a,b){var c=2,d=b,f=new e(c,d);a.applicationEvents.errorOccured.raise(a,f)}function A(a,b){z(a,b.statusText)}return s});

define('text!dashboard/views/hyperlinks-widget/hyperlinks-widget-editor.html',[],function () { return '<div class="hyperlinks-widget-editor">\r\n    <!-- ko with: widgetVM -->\r\n        <div data-bind="with: widget">\r\n            <div class="form-group">\r\n                <label data-bind="text: $parent.translate(\'NAME\')"></label>\r\n                <div class="input-group localize">\r\n                    <input type="text" class="form-control" data-bind="value: name">\r\n                    <mi-localize type="20" data-bind="attr: { phrase: name, context: translationContext }, value: caption">\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <nav>\r\n            <button type="button" class="btn btn-link" data-bind="click: $parent.add.bind($parent), text: translate(\'ADD_NEW\')"></button>\r\n            <button type="button" class="btn btn-link" data-bind="click: $parent.browse.bind($parent), text: translate(\'BROWSE\')"></button>\r\n        </nav>\r\n\r\n        <!-- ko with: hyperlinks -->\r\n        <ul class="hyperlinks list-group" data-bind="foreach: { data: items, afterRender : $parent.upgradeElements }" style="min-height: 150px;">\r\n            <li class="list-group-item block-group"\r\n                data-bind="click: $root.select.bind($root),\r\n                           css: { selected: $root.selectedHyperlink() === $data }">\r\n                <form class="block">\r\n\r\n                    <div class="form-group">\r\n                        <label data-bind="text: $root.translate(\'TEXT\')"></label>\r\n                        <div class="input-group localize">\r\n                            <input type="text" class="hyperlink-text form-control" data-bind="value: text">\r\n                            <mi-localize type="20" data-bind="attr: { phrase: text, context: translationContext }, value: caption">\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div class="form-group">\r\n                        <label data-bind="text: $root.translate(\'URL\')"></label>\r\n                        <input type="text" class="form-control" data-bind="value: url">\r\n                    </div>\r\n                </form>\r\n                <nav class="block">\r\n                    <button class="btn btn-default btn-icon"\r\n                            data-bind="click: $root.remove.bind($root), attr: { title: $root.translate(\'REMOVE\') }">\r\n                        <i class="icon-bin"></i>\r\n                    </button>\r\n                </nav>\r\n                <nav class="block">\r\n                    <button class="btn btn-default btn-icon"\r\n                            data-bind="click: $root.moveUp.bind($root), attr: { title: $root.translate(\'MOVE_UP\') }">\r\n                        <i class="icon-up-arrow"></i>\r\n                    </button>\r\n                    <button class="btn btn-default btn-icon"\r\n                            data-bind="click: $root.moveDown.bind($root), attr: { title: $root.translate(\'MOVE_DOWN\') }">\r\n                        <i class="icon-arrow"></i>\r\n                    </button>\r\n                </nav>\r\n            </li>\r\n        </ul>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n    <!-- /ko -->\r\n</div>\r\n';});

define('dashboard/views/hyperlinks-widget/hyperlinks-widget-editor-view',['require','jquery','text!dashboard/views/hyperlinks-widget/hyperlinks-widget-editor.html','mi-assert'],function a(require){"use strict";var b=require("jquery"),c=require("text!dashboard/views/hyperlinks-widget/hyperlinks-widget-editor.html"),d=require("mi-assert");function e(){this.region=null,this.hyperlinkList=null}e.html=c,e.prototype.attach=function a(c){d.ok(c),this.region=c,this.hyperlinkList=b("ul.hyperlinks",c.element)},e.prototype.detach=function a(){this.region=null,this.hyperlinkList=null},e.prototype.scrollTo=function a(b){d.isNumber(b),this.hyperlinkList.scrollTop(h(this,b))},e.prototype.focus=function a(b){d.isNumber(b),f(this,b).focus()};function f(a,b){return d.instanceOf(a,e),d.isNumber(b),g(a,b).find("input.hyperlink-text")}function g(a,b){return d.instanceOf(a,e),d.isNumber(b),a.hyperlinkList.children().eq(b)}function h(a,b){return d.instanceOf(a,e),d.isNumber(b),g(a,b).offset().top-a.hyperlinkList.offset().top+a.hyperlinkList.scrollTop()}return e});
define('system/lang/mixin',['require','lodash','ramda'],function(require){"use strict";var a=require("lodash"),b=require("ramda");function c(a){return{mixinProperties:b.partial(d,[a]),mixinMethods:e(a.prototype)}}function d(a,b){a.call(b)}function e(b){return function c(){return void 0!==arguments[0]?c.call(arguments[0]):(a.extend(this,b),this)}}return{create:c,mixin:e}});
define('application/mixins/has-app-events',['require','ramda','system/lang/event','application/application-events','system/lang/mixin','system/lang/private'],function(require){"use strict";var a=require("ramda"),b=require("system/lang/event"),c=require("application/application-events"),d=require("system/lang/mixin"),e=require("system/lang/private");function f(){e(this).appEvents=Object.resolve(c)}f.prototype.getAppEvents=function(){return e(this).appEvents},f.prototype.setApplicationTitle=function(a){this.getAppEvents().titleChanged.raise(a,this)},f.prototype.reportError=function(a,b){b&&b.error(a.stack),this.getAppEvents().errorOccured.raise(this,{code:a.name||"",message:a.message,detail:a.stack||""})},f.prototype.removeFromAppEvents=function(){a.forEach(g(this),h(this))};var g=a.invoker(1,"remove");function h(c){var d=i(c.getAppEvents());return a.filter(a.is(b),d)}function i(b){return a.props(a.keys(b),b)}return f.prototype.navigate=function(a,b){this.getAppEvents().navigate.raise(a,b)},d.create(f)});
define('spa/mithril/mithril-view-model',['require','mithril','application/mixins/has-app-events','system/globalization/translator','logging/error-notification-handler'],function(require){"use strict";var a=require("mithril"),b=require("application/mixins/has-app-events"),c=require("system/globalization/translator"),d=require("logging/error-notification-handler");function e(a){b.mixinProperties(this),this.view=a,this.translator=Object.resolve(c),this.errorNotificationHandler=Object.resolve(d),this.mithrilRoot=null}b.mixinMethods(e.prototype),e.prototype.attach=function b(c){Object.tryMethod(this,"beforeAttach",c),this.mithrilRoot=Element.build("div",null,["mithril-root"]),c.attach(this.mithrilRoot),a.mount(this.mithrilRoot,{controller:f.bind(null,this),view:this.view}),Object.tryMethod(this,"afterAttach",c)},e.prototype.detach=function b(c){Object.tryMethod(this,"beforeDetach",c),a.mount(this.mithrilRoot,null),this.mithrilRoot=null,c.clear(),Object.tryMethod(this,"afterDetach",c)},e.prototype.translate=function a(b){return this.translator.translate(b)};function f(a){return a}return e});
define('ui/elements/localize/models/localized-value',['require','mithril','mi-assert'],function(require){"use strict";var a=require("mithril"),b=require("mi-assert");function c(c,d){b.ok(c,"culture"),b.isString(d,"phrase"),this.culture=a.prop(c),this.phrase=a.prop(d),this.selected=a.prop(!1)}return c.fromCulture=function a(b){return new c(b,"")},c.getPhraseOrDefault=function(a,b){return c.hasPhrase(a)?a.phrase():b},c.hasPhrase=function(a){return!!a&&!!a.phrase()},c});
define('ui/elements/localize/models/localization',['require','ramda','mithril','mi-assert','application/application-context','./localized-value'],function(require){"use strict";var a=require("ramda"),b=require("mithril"),c=require("mi-assert"),d=require("application/application-context"),e=require("./localized-value");function f(a,d,e,f,g){c.isNumber(d,"type"),c.stringNotEmpty(e,"phrase"),c.isString(f,"key"),c.isString(g,"context"),i(f,g),this.cultures=b.prop(),this.type=b.prop(d),this.phrase=b.prop(e||""),this.key=b.prop(f),this.context=b.prop(g),this.values=b.prop(),this.updateCultures(a)}f.prototype.updateCultures=function b(c){this.cultures(c),this.values(a.map(e.fromCulture,this.cultures()))},f.prototype.add=function b(c){var d=a.find(g(c.cultureId),this.values());d&&d.phrase(c.value||"")};function g(a){return function(b){return c.stringNotEmpty(a,"culture"),c.instanceOf(b,e,"value"),a===b.culture().id}}f.prototype.addAll=function b(c){a.forEach(this.add.bind(this),c)},f.prototype.currentPhrase=function a(){var b,c=d.session.licensedCultureId;return c?(b=h(this,c),e.getPhraseOrDefault(b,this.phrase())):this.phrase()}
;function h(b,d){return c.ok(b,"self"),c.stringNotEmpty(d,"culture"),a.find(g(d),b.values())}function i(a,b){c.assert(a.length+b.length>0,"Either key or context must be populated: key = "+a+", context = "+b)}return f});
define('system/http/es6-ajax-request',['require','./ajax-request','bluebird'],function(require){"use strict";var a=require("./ajax-request"),b=require("bluebird");function c(a,b,c,e){d.call(this,a,b,c,e),this.xhr=null}var d=Object.inherit(a,c);c.get=function(a,b){return new c("get",a,null,b)},c.post=function(a,b,d){return new c("post",a,b,d)},c.put=function(a,b,d){return new c("put",a,b,d)},c.delete=function(a,b){return new c("delete",a,null,b)},c.prototype.send=function(){return this.xhr=d.prototype.send.call(this),b.resolve(this.xhr).catch(e.bind(null,this))};function e(a,b){return{request:a,response:b}}return c});
define('system/globalization/culture',['require','lodash'],function(require){"use strict";var a=require("lodash");function b(a,b){this.id=a,this.name=b}return b.fromJson=function a(c){return new b(c.id,c.name)},b.fromJsonArray=function c(d){return a.map(d,b.fromJson)},b.prototype.toString=function a(){return this.name+" ("+this.id+")"},b});
define('ui/elements/localize/services/localization-service',['require','lodash','system/http/es6-ajax-request','bluebird','system/globalization/culture','mi-assert'],function(require){"use strict";var a=require("lodash"),b=require("system/http/es6-ajax-request"),c=require("bluebird"),d=require("system/globalization/culture"),e=require("mi-assert"),f="api/core/localizer",g=f+"/languages?transType={0}",h=f+"/translations/objectKey/{0}?localizableType={1}&defaultValue={2}",i=f+"/translations?localizableType={0}&defaultValue={1}&objectContext={2}";function j(){}j.prototype.getLanguages=function a(c){var e=arguments.length>0?c:1;return b.get(g.replace("{0}",e)).send().then(d.fromJsonArray)},j.prototype.getTranslationValues=function(a,c,d,e){var f=k(a,c,d,e);return b.get(f).send()};function k(a,b,c,d){return n(c,d),c?h.replace("{0}",encodeURIComponent(c)).replace("{1}",encodeURIComponent(a)).replace("{2}",encodeURIComponent(b)):i.replace("{0}",encodeURIComponent(a)).replace("{1}",encodeURIComponent(b)).replace("{2}",encodeURIComponent(d))}j.prototype.saveTranslationValues=function(d,e,f,g,h){var i,j=k(d,e,f,g);return h=l(h),
h.length?b.put(j,h).send():(i=c.resolve(),a.defer(i.resolve.bind(i)),i)};function l(b){return a(b).map(m).value()}function m(a){return{cultureId:a.culture().id,translation:a.phrase()}}function n(a,b){e.assert(a.length+b.length>0,"Either key or context must be populated: key = "+a+", context = "+b)}return j});
define('system/mithril/mithril-extensions',['require','lodash','mithril'],function(require){"use strict";var a=require("lodash"),b=require("mithril");function c(b,c,d){return b=f(b),b?a.isFunction(c)?c():c:d?a.isFunction(d)?d():d:void 0}function d(a,b,c){return a=f(a),a?b(a):c?c():void 0}function e(b,c,d){return b=f(b),a.size(b)?a.map(b,c):d?d():void 0}function f(b){return a.isFunction(b)?b():b}function g(){b.endComputation(),b.startComputation()}function h(a,b){return{currentTarget:a,args:b}}return{iif:c,exists:d,map:e,value:f,restartComputation:g,event:h}});
define('system/mithril/html-tags',['require','mithril','./mithril-extensions'],function(require){"use strict";var a=require("mithril"),b=require("./mithril-extensions");function c(b){return a("i"+b)}function d(b,c){return a(".inline",b,c)}function e(c,d,e){return a("video[controls]",{width:b.value(d),height:b.value(e),src:b.value(c)})}return{icon:c,idiv:d,video:e,header:a.bind(null,"header"),h1:a.bind(null,"h1"),h2:a.bind(null,"h2"),span:a.bind(null,"span"),div:a.bind(null,"div"),section:a.bind(null,"section"),label:a.bind(null,"label"),table:a.bind(null,"table"),thead:a.bind(null,"thead"),tbody:a.bind(null,"tbody"),tr:a.bind(null,"tr"),th:a.bind(null,"th"),td:a.bind(null,"td"),ul:a.bind(null,"ul"),li:a.bind(null,"li"),a:a.bind(null,"a"),output:a.bind(null,"output")}});
define('system/mithril/bootstrap-tags',['require','mithril','./mithril-extensions'],function(require){"use strict";var a=require("mithril"),b=require("./mithril-extensions");function c(c,d,e,f){return a("a.list-group-item",{href:b.value(c),class:b.value(e||!1)?"active":"",onclick:f},b.value(d))}return{aListGroupItem:c,button:a.bind(null,"button.btn.btn-default"),primaryButton:a.bind(null,"button.btn.btn-primary"),iconButton:a.bind(null,"button.btn.btn-icon"),panel:a.bind(null,".panel.panel-default"),panelHeading:a.bind(null,".panel-heading"),panelBody:a.bind(null,".panel-body.container"),layoutRow:a.bind(null,".row"),divListGroup:a.bind(null,".list-group"),inputGroupButton:a.bind(null,"span.input-group-btn"),formGroup:a.bind(null,".form-group"),textBox:a.bind(null,'input.form-control[type="text"]'),table:a.bind(null,"table.table"),dropdown:a.bind(null,".dropdown"),dropdownMenu:a.bind(null,"ul.dropdown-menu")}});
define('system/mithril/devex-tags',['require','mithril'],function(require){"use strict";var a=require("mithril");return{dataGrid:a.bind(null,".dx-datagrid.dx-datagrid-headers"),table:a.bind(null,"table.dx-datagrid-table.dx-datagrid-table-fixed"),rowsView:a.bind(null,"tbody.dx-datagrid-rowsview.dx-widget"),dataRow:a.bind(null,"tr.dx-row dx-data-row.dx-column-lines")}});
define('system/ui/busy-indicator',['require','scopedQuerySelector'],function(require){"use strict";require("scopedQuerySelector");function a(a){this.container=null,this.loaderClassName=a||null,this.displayCache=null,this.positionCache=null}a.prototype.attachTo=function(a){a&&(this.displayCache=a.style.overflow,this.positionCache=a.style.position,b(this,a))},a.prototype.detach=function(){this.container=null,this.loaderClassName=null,this.displayCache=null,this.positionCache=null},a.prototype.show=function(){var a,b;if(this.container)for(this.container.style.overflow="hidden",this.container.style.position=this.positionCache?this.positionCache:"relative",a=this.container.querySelectorAll(":scope > .busy-indicator-wrap"),b=0;b<a.length;b++)a[b].style.display="block"},a.prototype.hide=function(){var a,b;if(this.container)for(this.displayCache?this.container.style.overflow=this.displayCache:this.container.style.overflow="",this.positionCache?this.container.style.position=this.positionCache:this.container.style.position="",
a=this.container.querySelectorAll(":scope > .busy-indicator-wrap"),b=0;b<a.length;b++)a[b].style.display="none"};function b(a,b){if(a.container=b,!a.container.querySelector(":scope > .busy-indicator-wrap")){var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div"),f=a.container.getBoundingClientRect();c.classList.add("busy-indicator-wrap"),c.style.display="none",d.classList.add("busy-indicator"),a.loaderClassName?e.classList.add(a.loaderClassName):a.container.offsetWidth<640?e.classList.add("loading-small"):a.container.offsetWidth<1024&&a.container.offsetWidth>641?e.classList.add("loading-med"):a.container.offsetWidth<1440&&a.container.offsetWidth>1025?e.classList.add("loading-large"):a.container.offsetWidth>1441?e.classList.add("loading-extra-large"):e.classList.add("loading-med"),c.appendChild(d),d.appendChild(e),a.container.appendChild(c),c.style.top=a.container.clientTop+"px",c.style.left=a.container.clientLeft+"px"}}return a});
define('ui/elements/localize/views/localize-dialog-view',['require','exports','module','mithril','system/mithril/mithril-extensions','system/mithril/html-tags','system/mithril/bootstrap-tags','system/mithril/devex-tags','system/diagnostics/log-manager','system/ui/busy-indicator','mi-assert'],function(require,exports,module){"use strict";var a=require("mithril"),b=require("system/mithril/mithril-extensions"),c=require("system/mithril/html-tags"),d=require("system/mithril/bootstrap-tags"),e=require("system/mithril/devex-tags"),f=require("system/diagnostics/log-manager"),g=f.getLogger(module.id),h=require("system/ui/busy-indicator"),i=require("mi-assert");function j(a){try{return i.isObject(a,"vm"),k(a,[l(a),m(a),n(a)])}catch(a){throw g.error(a.stack),a}}function k(a,b){return c.div({className:"localize-dialog",config:r.bind(null,a)},b)}function l(a){return u(a),c.h1(a.text("SPECIFY_LOCALIZED_VALUES"))}function m(a){return u(a),d.formGroup([c.label(a.text("DEFAULT_VALUE")),d.textBox({value:a.localization.phrase(),disabled:!0})])}function n(a){return u(a),e.dataGrid([e.table([c.thead([e.dataRow([c.td(a.text("CULTURE")),c.td(a.text("VALUE_LABEL"))])]),e.rowsView(b.map(a.localization.values(),o,q.bind(null,a)))])])}function o(b){return i.isObject(b,"value"),
i.ok(b.culture(),"value.culture"),i.isString(b.phrase(),"value.phrase"),e.dataRow(p(b),[c.td(b.culture().toString()),c.td([d.textBox({onchange:a.withAttr("value",b.phrase),onfocus:b.selected.bind(null,!0),onblur:b.selected.bind(null,!1),value:b.phrase()})])])}function p(a){return a.selected()?{className:"dx-selection"}:{}}function q(a){return u(a),c.tr([c.td({colspan:2,className:"text-center"},a.text("NO_LICENSED_CULTURES"))])}function r(a,b,c,d){var e=s(b,d);a.working()?e.show():e.hide()}function s(a,b){return b.indicator||(b.indicator=Object.resolve(h,"loading-large"),b.indicator.attachTo(a)),b.onunload||(b.onunload=t.bind(null,b)),b.indicator}function t(a){a.indicator.container=null,a.indicator=null}function u(a){i.isObject(a,"vm"),i.isFunction(a.text,"vm.text"),i.isObject(a.localization,"vm.localization"),i.isFunction(a.localization.phrase,"vm.localization.phrase")}return j});
define('system/http/ajax-error',[],function(){"use strict";function a(a,b){this.response=a,this.request=b}a.prototype.toError=function a(){return this.response.status?b(this)?c(this):d(this):new Error(this.response)};function b(a){return a.response.status>=500}function c(a){var b,c,d;return b=JSON.parse(a.response.responseText),b.exceptionMessage?(c=b.exceptionMessage,d=new Error(c),b.exceptionType&&(d.name=b.exceptionType),d.stack=d.stack?d.stack+"":"",b.stackTrace&&(d.stack=d.stack+"\n\nFrom Server: "+b.exceptionMessage+"\n"+b.stackTrace)):d=new Error(b),d}function d(a){var b=a.response.statusText;return a.request&&(b=a.request.url+" "+b),new Error(b+" ("+a.response.status+")")}return a});
define('ui/elements/localize/view-models/localize-dialog-view-model',['require','exports','module','jquery','mithril','spa/mithril/mithril-view-model','../models/localization','../services/localization-service','system/globalization/translator','system/diagnostics/log-manager','../views/localize-dialog-view','system/http/ajax-error','mi-assert'],function(require,exports,module){"use strict";var a=require("jquery"),b=require("mithril"),c=require("spa/mithril/mithril-view-model"),d=require("../models/localization"),e=require("../services/localization-service"),f=require("system/globalization/translator"),g=require("system/diagnostics/log-manager"),h=g.getLogger(module.id),i=require("../views/localize-dialog-view"),j=require("system/http/ajax-error"),k=require("mi-assert");function l(a,c,g,h){m.call(this,i),this.translator=Object.resolve(f),this.service=Object.resolve(e),this.localization=new d([],a,c,g,h),this.working=b.prop(!0)}var m=Object.inherit(c,l);l.prototype.load=function a(){try{o(this),p(this).then(q.bind(null,this)).then(r.bind(null,this)).then(w.bind(null,this)).then(y.bind(null,this)).then(n.bind(null,this)).catch(x).catch(y.bind(null,this))}catch(a){x(a)}};function n(a,b){if(0===a.localization.cultures().length){var c=document.querySelector(".btn-localize-save");c.className=c.className+" disabled"}}
function o(a){a.working(!0),b.redraw()}function p(a){return a.service.getLanguages()}function q(a,b){a.localization.updateCultures(b)}function r(a){return a.service.getTranslationValues(s(a),t(a),u(a),v(a))}function s(a){return a.localization.type()}function t(a){return a.localization.phrase()}function u(a){return a.localization.key()}function v(a){return a.localization.context()}function w(a,b){a.localization.addAll(b)}function x(a){throw a.response&&(a=new j(a.response,a.request).toError()),a.stack?h.error(a.stack):h.error(a),a}function y(a){a.working(!1),b.redraw()}l.prototype.save=function b(){try{var c=a.Deferred();return o(this),z(this).then(c.resolve.bind(c)).then(y.bind(null,this)).catch(B.bind(null,c)).catch(y.bind(null,this)),c.promise()}catch(a){x(a)}};function z(a){return a.service.saveTranslationValues(s(a),t(a),u(a),v(a),A(a))}function A(a){return a.localization.values()}function B(a,b){x(b),a.reject()}return l.prototype.title=function a(){
return this.text("LOCALIZE_PHRASE").replace("{0}",this.localization.phrase())},l.prototype.text=function a(b){return k.stringNotEmpty(b,"key"),this.translator.translate(b)},l});
define('ui/elements/localize/localize-dialog',['require','exports','module','jquery','system/ui/dialog-box','./view-models/localize-dialog-view-model','system/diagnostics/log-manager','mi-assert'],function(require,exports,module){"use strict";var a=require("jquery"),b=require("system/ui/dialog-box"),c=require("./view-models/localize-dialog-view-model"),d=require("system/diagnostics/log-manager"),e=d.getLogger(module.id),f=require("mi-assert");function g(b,d,e,g,j){var k,n,o;try{return f.isNumber(b,"type"),f.stringNotEmpty(d,"phrase"),f.isString(e,"key"),f.isString(g,"context"),m(e,g),j=j||{},k=a.Deferred(),n=Object.resolve(c,b,d,e,g),o=h(n,j),o.show().done(i.bind(null,k,n)),k.promise()}catch(a){l(a)}}function h(a,c){return f.isObject(a,"vm"),f.isObject(c,"options"),new b(a,a.title(),{buttons:[{name:a.text("SAVE"),value:"save",cssClass:"btn-primary btn-localize-save"},{name:a.text("CANCEL"),value:"cancel",cssClass:"btn-default"}],height:c.height||"60%",width:c.width||"50%"})}function i(a,b,c){try{f.isNumber(c,"cancelled"),c?j(a):k(a,b)}catch(a){l(a)}}function j(a){f.isDeferred(a,"dfd"),a.reject()}function k(a,b){f.isDeferred(a,"dfd"),f.isObject(b,"vm"),
a.resolve(b.localization.currentPhrase())}function l(a){throw e.error(a.stack),a}function m(a,b){f.assert(a.length+b.length>0,"Either key or context must be populated: key = "+a+", context = "+b)}return{show:g}});
define('ui/elements/localize/view-models/localize-view-model',['require','exports','module','jquery','application/application-context','../localize-dialog','system/lang/event','system/diagnostics/log-manager','mi-assert'],function(require,exports,module){"use strict";var a=require("jquery"),b=require("application/application-context"),c=require("../localize-dialog"),d=require("system/lang/event"),e=require("system/diagnostics/log-manager"),f=e.getLogger(module.id),g=require("mi-assert");function h(){this.type=Object.prop(),this.phrase=Object.prop(""),this.key=Object.prop(""),this.context=Object.prop(""),this.dialogClosed=Object.resolve(d)}h.prototype.localize=function(){var b;try{return b=a.Deferred(),c.show(parseInt(this.type(),10),this.phrase(),this.key(),this.context()).done(i.bind(null,this,b)).fail(b.reject.bind(b)),b.promise()}catch(a){k(a)}},h.prototype.dispose=function a(){try{this.dialogClosed&&(this.dialogClosed.remove(),this.dialogClosed=null)}catch(a){k(a)}},h.prototype.visible=function a(){return b.user.isSuperUser},h.prototype.disabled=function a(){return 0===this.phrase().length};function i(a,b,c){var d;try{j(a),g.isDeferred(b,"dfd"),g.stringNotEmpty(c,"phrase"),d={phrase:c},
a.dialogClosed.raise(a,d),b.resolve(d)}catch(a){k(a)}}function j(a){g.instanceOf(a,h,"self")}function k(a){throw f.error(a.stack),a}return h});
define('ui/elements/localize/views/localize-view',['require','mithril','system/mithril/html-tags','system/mithril/bootstrap-tags','system/globalization/translator'],function(require){"use strict";var a=require("mithril"),b=require("system/mithril/html-tags"),c=require("system/mithril/bootstrap-tags"),d=require("system/globalization/translator");function e(a){return a.visible()?f(a):b.span()}function f(a){var e=a.localize.bind(a),f=a.disabled(),g=Object.resolve(d),h=g.translate("LOCALIZE_PHRASE").replace("{0}",a.phrase());return c.inputGroupButton([c.iconButton({onclick:e,disabled:f,title:h},[b.icon(".icon-translation")])])}return e});
define('ui/elements/localize/localize-element',['require','exports','module','mi-assert','mithril','system/diagnostics/log-manager','./view-models/localize-view-model','./views/localize-view'],function(require,exports,module){"use strict";var a=require("mi-assert"),b=require("mithril"),c=require("system/diagnostics/log-manager"),d=c.getLogger(module.id),e=require("./view-models/localize-view-model"),f=require("./views/localize-view"),g={};g.prototype=Object.create(HTMLElement.prototype),g.prototype.createdCallback=function a(){this._root=Object.prop(null),this._vm=Object.prop(null),this.value=null},g.prototype.attachedCallback=function a(){try{h(this),m(this),n(this)}catch(a){v(a)}};function h(a){s(a),a._vm(Object.resolve(e)),a._vm().type(a.getAttribute("type")||""),a._vm().phrase(a.getAttribute("phrase")||""),a._vm().key(a.getAttribute("key")||""),a._vm().context(a.getAttribute("context")||""),a._vm().dialogClosed.add(i,a,a)}function i(b,c,d){try{s(b),a.ok(c,"sender"),a.ok(d,"result"),a.stringNotEmpty(d.phrase,"result.phrase"),j(b,d.phrase)}catch(a){v(a)}}function j(b,c){s(b),a.stringNotEmpty(c,"value"),k(b,c)&&(b.value=c,l(b))}function k(b,c){return s(b),
a.stringNotEmpty(c,"value"),b.value!==c}function l(a){s(a),Element.raiseEvent(a,"change",{value:a.value})}function m(a){s(a);var b=a.querySelector(".localize-root");b||(b=Element.build("div",a,["localize-root"])),a._root(b)}function n(a){s(a),u(a._root()),t(a._vm()),b.mount(a._root(),{controller:a._vm,view:f})}g.prototype.detachedCallback=function a(){try{o(this),p(this),q(this)}catch(a){v(a)}};function o(a){s(a),u(a._root()),b.mount(a._root(),null)}function p(a){s(a),u(a._root()),a.removeChild(a._root()),a._root(null)}function q(a){s(a),t(a._vm()),a._vm().dialogClosed.remove(a),a._vm().dispose(),a._vm(null)}g.prototype.attributeChangedCallback=function a(b,c,d){try{r(this,b,d)}catch(a){v(a)}};function r(a,c,d){if(s(a),a._vm()){t(a._vm());var e=a._vm()[c];e&&(e(d||""),b.redraw())}}function s(b){a.instanceOf(b,HTMLElement,"self"),a.isFunction(b._root,"self._root"),a.isFunction(b._vm,"self._vm")}function t(b){a.instanceOf(b,e,"self._vm()")}function u(b){
a.instanceOf(b,HTMLElement,"self._root()")}function v(a){throw d.error(a.stack),a}return Element.registerElement("mi-localize",{prototype:g.prototype}),g});
define('dashboard/view-models/hyperlinks-widget/hyperlinks-widget-editor',['require','dashboard/view-models/widget-editor','dashboard/models/hyperlink','system/ui/message-box','dashboard/view-models/url-builder/url-builder','dashboard/views/hyperlinks-widget/hyperlinks-widget-editor-view','mi-assert','ui/elements/localize/localize-element'],function a(require){"use strict";var b=require("dashboard/view-models/widget-editor"),c=require("dashboard/models/hyperlink"),d=require("system/ui/message-box"),e=require("dashboard/view-models/url-builder/url-builder"),f=require("dashboard/views/hyperlinks-widget/hyperlinks-widget-editor-view"),g=require("mi-assert");require("ui/elements/localize/localize-element");function h(a){i.call(this,a,f.html),this.editorView=Object.resolve(f),this.selectedHyperlink=this.kom.observable(),this.backup.hyperlinks=this.kom.observableArray()}var i=Object.inherit(b,h);h.prototype.afterLoad=function a(){m(this)},h.prototype.afterSave=function a(){n(this)},h.prototype.afterCancel=function a(){o(this)},h.prototype.afterAttach=function(a){g.ok(a),this.editorView.attach(a),Element.upgrade(a.element.querySelectorAll("mi-localize"))},h.prototype.afterDetach=function a(){this.editorView.detach()},h.prototype.select=function a(b){g.assert(b instanceof c||null===b),this.selectedHyperlink(b)},
h.prototype.add=function a(b){var d=new c(this.widgetVM);j(d,b),l(this).add(d),this.select(d),r(this,d),s(this,d),this.widgetVM.setLayout()};function j(a,b){return b&&"string"==typeof b&&(a.text(b),a.url(b)),a}h.prototype.browse=function(){var a=e.factory(),b=this;a.show().done(k.bind(null,this))};function k(a,b){a.add(b)}h.prototype.remove=function a(b){g.instanceOf(b,c),p(this,b).done(q.bind(null,this,b))},h.prototype.moveUp=function a(b){g.instanceOf(b,c),l(this).moveUp(b),r(this,b)},h.prototype.moveDown=function a(b){g.instanceOf(b,c),l(this).moveDown(b),r(this,b)};function l(a){return g.instanceOf(a,h),a.widgetVM.hyperlinks}function m(a){g.instanceOf(a,h),a.backup.hyperlinks(c.copy(l(a).items()))}function n(a){g.instanceOf(a,h),a.backup.hyperlinks([])}function o(a){g.instanceOf(a,h),l(a).items(a.backup.hyperlinks())}function p(a,b){g.instanceOf(a,h),g.instanceOf(b,c);var e=a.translate("CONFIRM_REMOVE").replace("$0",b.text()),f=a.translate("CONFIRMATION")
;return d.showOkCancel(e,f,"icon-questionmark-popup")}function q(a,b,d){g.instanceOf(a,h,"self"),g.instanceOf(b,c,"hyperlink"),g.isNumber(d),d||(l(a).remove(b),a.select(null))}function r(a,b){g.instanceOf(a,h),g.instanceOf(b,c);var d=l(a).indexOf(b);a.editorView.scrollTo(d)}function s(a,b){g.instanceOf(a,h),g.instanceOf(b,c);var d=l(a).indexOf(b);a.editorView.focus(d)}return h});

define('text!dashboard/views/hyperlinks-widget/hyperlinks-widget.html',[],function () { return '<div class="hyperlink-widget">\r\n    <ul class="list-group" data-bind="foreach: hyperlinks.items">\r\n        <li class="hyperlink-item">\r\n            <a data-bind="text: caption, attr: { href: $root.cleanHref(url()), target: target }, click: $root.openHyperlink"></a>\r\n        </li>\r\n    </ul>\r\n</div>\r\n';});

define('dashboard/view-models/hyperlinks-widget/hyperlinks-layout',["require","exports","jquery"],function(require,exports,a){"use strict";return function(){function b(){}return b.prototype.setLayout=function(a){this.setLayoutBase(a)},b.prototype.setLayoutHandler=function(a){this.setLayoutBase(a.target)},b.prototype.setLayoutBase=function(b){var c="horizontal-layout",d=a("div.dashboard-content").width()/2,e=a(b).find("li.hyperlink-item");a(b).width()>=d?e.addClass(c):e.removeClass(c)},b}()});
define('dashboard/view-models/hyperlinks-widget/href-cleaner',["require","exports"],function(require,exports){"use strict";return function(){function a(){}return a.prototype.clean=function(a){if(a){var b=/^([^:]+):|^#|^(.\/)|^(..\/)|^!/gm,c=/^(%20|\s)*(data|javascript)/im,d=/[^\x20-\x7E]/gim,e=a.replace(d,""),f=e.match(b),g=void 0;if(!f)return"";g=f[0];if(c.test(g))return"";a=e}return a},a}()});
define('dashboard/view-models/hyperlinks-widget/hyperlinks-widget',['require','exports','module','dashboard/view-models/widget-view-model','dashboard/adapters/hyperlink-adapter','dashboard/view-models/hyperlinks-widget/hyperlinks-widget-editor','text!dashboard/views/hyperlinks-widget/hyperlinks-widget.html','dashboard/view-models/hyperlinks-widget/hyperlinks-layout','system/lang/property','system/hardware/device','logging/error-notification-handler','system/diagnostics/log-manager','dashboard/view-models/hyperlinks-widget/href-cleaner','mi-assert'],function a(require,exports,module){"use strict";var b=require("dashboard/view-models/widget-view-model"),c=require("dashboard/adapters/hyperlink-adapter"),d=require("dashboard/view-models/hyperlinks-widget/hyperlinks-widget-editor"),e=require("text!dashboard/views/hyperlinks-widget/hyperlinks-widget.html"),f=require("dashboard/view-models/hyperlinks-widget/hyperlinks-layout"),g=require("system/lang/property"),h=require("system/hardware/device"),i=require("logging/error-notification-handler"),j=require("system/diagnostics/log-manager"),k=require("dashboard/view-models/hyperlinks-widget/href-cleaner"),l=j.getLogger(module.id),m=require("mi-assert");function n(a){o.call(this,a,e,d,q()),g.set(this,"minWidth",6),g.set(this,"minHeight",2),g.set(this,"allowRefresh",!1),g.set(this,"allowGoTo",!1),g.readOnly(this,"hyperlinks",this.kom.observableList()),this.region=null,this.layoutHandler=null,this.gridLayoutElement=null,this.errorNotificationHandler=Object.resolve(i)}
var o=Object.inherit(b,n);n.prototype.deserialize=function a(){var b=this.widget.properties();m.ok(b,"properties"),this.hyperlinks.items(c.deserializeAll(this,b.hyperlinks||[]))},n.prototype.afterAttach=function(a){var b=new f;this.region=a,p(this),b.setLayout(a.element),this.layoutHandler=b.setLayoutHandler.bind(b),this.gridLayoutElement=a.$element.closest("mi-grid-layout-item"),this.gridLayoutElement.on("element-resized",this.layoutHandler)};function p(a){a.region.activeContainer.style.height="auto"}n.prototype.beforeDetach=function(){this.gridLayoutElement.off("element-resized",this.layoutHandler)},n.prototype.setLayout=function(){(new f).setLayout(this.region.element)},n.prototype.serialize=function a(){return{hyperlinks:c.serializeAll(this.hyperlinks.items())}};function q(){var a="95%";return{width:a,height:a}}n.prototype.icon=function a(){return"dashboard-icon-hyperlink"},n.prototype.upgradeElements=function a(b){try{r(b)}catch(a){x(this,a)}};function r(a){var b,c
;for(b=0;b<a.length;b++)c=a[b],c.querySelector&&Element.upgrade(c.querySelector("mi-localize"))}n.prototype.cleanHref=function(a){return(new k).clean(a)},n.prototype.openHyperlink=function(a,b){try{return s(a,b)}catch(b){x(a.parent,b)}};function s(a,b){var c=new h;return(new k).clean(a.url())?c.isMobileApp()?t(a):w():(b.preventDefault(),!1)}function t(a){return u(a)?w():v(a)}function u(a){return a.url().startsWith("#")}function v(a){return window.openInExternalBrowser(a.url()),!1}function w(){return!0}function x(a,b){y(b),a.errorNotificationHandler.addError({errorMessage:b.message,errorDetail:b.stack})}function y(a){l.error(a.stack)}return n});
define('catalog/services/dto/catalog-item-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.id=a.toString(b.id),this.caption=a.toString(b.caption),this.defaultCaption=a.toString(b.defaultCaption),this.description=a.toString(b.description),this.path=a.toString(b.path),this.folderKey=a.toString(b.folderKey),this.itemType=a.toInteger(b.itemType),this.ownerKey=a.toString(b.ownerKey),this.ownerId=a.toString(b.ownerId),this.lockSeq=a.toString(b.lockSeq),this.query=a.toObject(b.query),this.dataset=a.toObject(b.dataset),this.createDate=a.toDate(b.createDate),this.createUser=a.toString(b.createUser),this.updateDate=a.toDate(b.updateDate),this.updateUser=a.toString(b.updateUser),this.ownerDisplay=a.toString(b.ownerDisplay),this.creatorDisplay=a.toString(b.creatorDisplay),this.updatorDisplay=a.toString(b.updatorDisplay)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('catalog/services/dto/folder-dto',['require','jquery','system/lang/converter','./catalog-item-dto'],function(require){"use strict";var a=require("jquery"),b=require("system/lang/converter"),c=require("./catalog-item-dto");function d(c){var e=[];c=c||{},this.key=b.toString(c.key),this.id=b.toString(c.id),this.description=b.toString(c.description),this.caption=b.toString(c.caption),this.folderType=b.toInteger(c.folderType),this.hasChildren=b.toBoolean(c.hasChildren),this.ownerKey=b.toString(c.ownerKey),this.ownerId=b.toString(c.ownerId),this.parentKey=b.toString(c.parentKey),this.path=b.toString(c.path),this.privilege=b.toInteger(c.privilege),this.spread=b.toInteger(c.spread),this.updateDate=b.toDate(c.updateDate),this.updateUser=b.toString(c.updateUser),this.lockSeq=b.toString(c.lockSeq),this.ownerDisplay=b.toString(c.ownerDisplay),this.updatorDisplay=b.toString(c.updatorDisplay),c.children&&(e=a.map(c.children,function(a){return new d(b.toObject(a,{}))})),this.children=e}return d});
define('catalog/services/dto/folder-priv-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key,"0"),this.userKey=a.toString(b.userKey,"0"),this.userDisplay=a.toString(b.userDisplay),this.groupKey=a.toString(b.groupKey,"0"),this.groupDisplay=a.toString(b.groupDisplay),this.folderKey=a.toString(b.folderKey,"0"),this.privilege=a.toInteger(b.privilege),this.spread=a.toInteger(b.spread)}return b});
define('catalog/services/dto/user-pref-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.userKey=a.toString(b.userKey),this.prefType=a.toInteger(b.prefType),this.name=a.toString(b.name),this.value=a.toString(b.value)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('catalog/services/dto/nav-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.caption=a.toString(b.caption)}return b.fromDataCollection=function a(c){if(void 0!==c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('catalog/services/dto/catalog-item-result-grid-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.type="",this.linkValue="",b.itemType===-1?(this.type="#query/",this.linkValue=b.key):b.itemType===-2?(this.type="#graph/",this.linkValue=b.key):b.itemType===-3?(this.type="#ssrs/viewer/",this.linkValue=b.path+"\\"+a.toString(b.id)):b.itemType===-5?(this.type="#dataset/",this.linkValue=b.key):b.itemType===-9&&(this.type="#dashboard/",this.linkValue=b.key),this.name=a.toString(b.id),this.path="<a href='"+this.type+a.toString(this.linkValue)+"'>"+a.toString(b.path)+"</a>",this.creator=a.toString(b.ownerId),this.date=a.toDate(b.createDate)}return b.fromDataCollection=function a(c){var d,e=[];for(d=0;d<c.length;d++)e[d]=new b(c[d]);return e},b});
define('catalog/services/catalog-service',['require','lodash','jquery','system/http/ajax-client','./dto/folder-dto','./dto/catalog-item-dto','./dto/folder-priv-dto','./dto/user-pref-dto','./dto/nav-dto','./dto/catalog-item-result-grid-dto'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/http/ajax-client"),d=require("./dto/folder-dto"),e=require("./dto/catalog-item-dto"),f=require("./dto/folder-priv-dto"),g=require("./dto/user-pref-dto"),h=require("./dto/nav-dto"),i=require("./dto/catalog-item-result-grid-dto"),j="api/core/userpref/",k="api/core/command/",l="api/core/catalog/",m="22",n="api/core/localizer",o=n+"/translations/objectKey/{0}?localizableType={1}&defaultValue={2}";function p(a){this.ajaxClient=a}p.dependsOn=[c],p.prototype.getAllFolders=function a(){var c=l+"folders/all/",e=b.Deferred();return this.ajaxClient.get(c,{}).done(function(a){var c=b.map(a,function(a){return new d(a)});e.resolve(c)}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.getFolder=function a(c){var e=l+"folder/"+c,f=b.Deferred();return this.ajaxClient.get(e,{}).done(function(a){f.resolve(new d(a))}).fail(function(a){f.reject(a)}),f.promise()},
p.prototype.getFoldersPaginate=function a(c,e,f){var g=l+"folders/"+c+"/pageSize/"+e+"/pageNum/"+f,h=b.Deferred();return this.ajaxClient.get(g,{}).done(function(a){a&&a.length&&0!==a.length?h.resolve(b.map(a,function(a){return new d(a)})):h.resolve(null)}).fail(function(a){h.reject(a)}),h.promise()},p.prototype.getFolderRoots=function a(){var c=b.Deferred(),e=l+"folder/roots";return this.ajaxClient.get(e,{}).done(function(a){a&&a.length&&0!==a.length?c.resolve(b.map(a,function(a){return new d(a)})):c.resolve(null)}).fail(function(a){c.reject(a)}),c.promise()},p.prototype.getPublicFolder=function a(){var c=l+"folder/public/",e=b.Deferred();return this.ajaxClient.get(c,{}).done(function(a){e.resolve(new d(a))}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.getPersonalFolder=function a(){var c=l+"folder/personal/",e=b.Deferred();return this.ajaxClient.get(c,{}).done(function(a){e.resolve(new d(a))}).fail(function(a){e.reject(a)}),e.promise()},
p.prototype.getBaselineFolder=function a(){var c=l+"folder/baseline/",e=b.Deferred();return this.ajaxClient.get(c,{}).done(function(a){e.resolve(new d(a))}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.getFolderParents=function a(c){var e=b.Deferred(),f=l+"folder/parents?path="+c;return this.ajaxClient.get(f,{}).done(function(a){e.resolve(b.map(a,function(a){return new d(a)}))}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.searchFolders=function a(c,e,f){var g=l+"folders/search?searchValue="+c+"&pageSize="+e+"&pageNum="+f,h=b.Deferred();return this.ajaxClient.get(g,{}).done(function(a){a&&a.length?h.resolve(b.map(a,function(a){return new d(a)})):h.resolve(null)}).fail(function(a){h.reject(a)}),h.promise()},p.prototype.postFolder=function a(c){var d=b.Deferred(),e=l+"folder/";return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.postQuery=function a(c){var d=b.Deferred(),e=k+"discover"
;return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.putFolder=function a(c){var d=b.Deferred(),e=l+"folder/";return this.ajaxClient.put(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.deleteFolder=function a(c){var d=b.Deferred(),e=l+"folder/";return this.ajaxClient.delete(e+c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.copyFolder=function a(c,d){var e=b.Deferred(),f=l+"folder/copy/"+c+"/"+d;return this.ajaxClient.post(f).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.moveFolder=function a(c,d){var e=b.Deferred(),f=l+"folder/move/"+c+"/"+d;return this.ajaxClient.post(f).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.getCatalogItems=function a(d){var f=b.Deferred(),g=l+"items/"+d;return this.ajaxClient.get(g,{}).done(function(a){
c.isMultiTenant()&&(a=a.filter(function(a){return a.itemType!==-12||"Role"!==a.id})),f.resolve(b.map(a,function(a){return new e(a)}))}).fail(function(a){f.reject(a)}),f.promise()},p.prototype.getCatalogItem=function a(b){var c=l+"item/";return this.ajaxClient.get(c+b)},p.prototype.getCatalogItemId=function a(b,c){var d=l+"item/"+b+"?id="+c;return this.ajaxClient.get(d)},p.prototype.getCatalogItemKey=function a(b){var c=l+"itemkey?path="+b;return this.ajaxClient.get(c)},p.prototype.getCatalogItemByPath=function a(b){var c=l+"item?path="+encodeURIComponent(b);return this.ajaxClient.get(c)},p.prototype.CanUpdateCatalogItem=function a(b){var c=l+"item/can-update/"+b;return this.ajaxClient.get(c)},p.prototype.postCatalogItem=function a(c){var d=b.Deferred(),e=l+"item/";return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.putCatalogItem=function a(c){var d=b.Deferred(),e=l+"item/"
;return this.ajaxClient.put(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.copyCatalogItems=function a(c,d){var e=b.Deferred(),f=l+"items/copy/"+d;return this.ajaxClient.post(f,c).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.moveCatalogItems=function a(c,d){var e=b.Deferred(),f=l+"items/move/"+d;return this.ajaxClient.post(f,c).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.deleteCatalogItem=function a(c){var d=b.Deferred(),e=l+"item/";return this.ajaxClient.delete(e+c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.searchCatalogItems=function a(c,d,e,f){var g=b.Deferred(),h,i,j,k;return c=c||"0",d=d||"",e=void 0===e||e,e=e?"True":"False",f=f||0,h="?searchValue="+d,i="&searchSubFolders="+e,j="&itemType="+f,k=l+"items/search/"+c+h+i+j,this.ajaxClient.get(k,{}).done(q.bind(null,this,g)).fail(function(a){g.reject(a)}),
g.promise()};function q(a,b,c){b.resolve(e.fromDataCollection(c))}p.prototype.getFolderPrivs=function a(c){var d=l+"privs/"+c,e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(a){var c=b.map(a,function(a){return new f(a)});e.resolve(c)}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.postFolderPriv=function a(c){var d=b.Deferred(),e=l+"priv";return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.putFolderPriv=function a(c){var d=b.Deferred(),e=l+"priv";return this.ajaxClient.put(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.deleteFolderPriv=function a(c){var d=b.Deferred(),e=l+"priv/"+c;return this.ajaxClient.delete(e).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.getPreference=function a(c,d){var e=b.Deferred(),f=j+"get/"+c+"/1?name="+d;return this.ajaxClient.get(f,{}).done(function(a){e.resolve(new g(a))
}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.setPreference=function a(c){var d=b.Deferred(),e=j+"set";return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()};function r(a,b){a.resolve(i.fromDataCollection(b))}p.prototype.getTranslation=function(a,c,d){var e=b.Deferred(),f=s(a,d);return this.ajaxClient.get(f,{}).done(t.bind(null,e,c,d)).fail(function(a){e.reject(a)}),e.promise()};function s(a,b){return o.replace("{0}",encodeURIComponent(a)).replace("{1}",encodeURIComponent(m)).replace("{2}",encodeURIComponent(b))}function t(b,c,d,e){var f=a.find(e,{cultureId:c});f&&(d=f.value),b.resolve(d)}return p});
define('catalog/model/catalog-item-types',['require'],function(require){"use strict";function a(){return[{value:-12,text:"DataLoaderTemplate"},{value:-11,text:"Script"},{value:-10,text:"RScript"},{value:-9,text:"Dashboard"},{value:-5,text:"Dataset"},{value:-7,text:"Explorer"},{value:-2,text:"Graph"},{value:-6,text:"MetricView"},{value:-8,text:"Project"},{value:-1,text:"Query"},{value:-3,text:"Report"},{value:-4,text:"Search"}]}return a()});
define('catalog/model/catalog-item-model',['require','lodash','knockout','./catalog-item-types'],function(require){"use strict";var a=require("lodash"),b=require("knockout"),c=require("./catalog-item-types");function d(a){a=a||{},this.isSelected=b.observable(!1),this.key=b.observable(a.key),this.id=b.observable(a.id),this.caption=b.observable(a.caption),this.defaultCaption=b.observable(a.defaultCaption),this.description=b.observable(a.description),this.path=b.observable(a.path),this.folderKey=b.observable(a.folderKey),this.ownerKey=b.observable(a.ownerKey),this.ownerId=b.observable(a.ownerId),this.createDate=b.observable(a.createDate),this.createDateDisplay=b.computed(g.bind(null,this)),this.createUser=b.observable(a.createUser),this.updateDate=b.observable(a.updateDate),this.updateDateDisplay=b.computed(f.bind(null,this)),this.updateUser=b.observable(a.updateUser),this.ownerDisplay=b.observable(a.ownerDisplay),this.creatorDisplay=b.observable(a.creatorDisplay),this.updatorDisplay=b.observable(a.updatorDisplay),this.itemType=b.observable(a.itemType),
this.itemTypeDisplay=b.computed(e.bind(null,this)),this.lockSeq=b.observable(a.lockSeq)}function e(b){var d=a.find(c,{value:b.itemType()});if(d)return d.text}function f(a){return void 0===a.updateDate()?"":a.updateDate().toLocaleDateString()+" "+a.updateDate().toLocaleTimeString()}function g(a){return void 0===a.createDate()?"":a.createDate().toLocaleDateString()+" "+a.createDate().toLocaleTimeString()}return d});
define('catalog/adapters/catalog-item-adapter',['require','../services/dto/catalog-item-dto','../model/catalog-item-model'],function(require){"use strict";var a=require("../services/dto/catalog-item-dto"),b=require("../model/catalog-item-model");function c(){}return c.toModelObject=function a(c){return new b(c)},c.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},c.toDTO=function b(c){var d=new a;return d.key=c.key(),d.id=c.id(),d.caption=c.caption(),d.defaultCaption=c.defaultCaption(),d.description=c.description(),d.folderKey=c.folderKey(),d.ownerKey=c.ownerKey(),d.ownerId=c.ownerId(),d.path=c.path(),d.createDate=c.createDate(),d.createUser=c.createUser(),d.updateDate=c.updateDate(),d.updateUser=c.updateUser(),d.itemType=c.itemType(),d.lockSeq=c.lockSeq(),d},c.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},c});
define('catalog/services/catalog-constants',[],function(){"use strict";function a(){this.FOLDER_TYPE_PERSONAL=0,this.FOLDER_TYPE_BASELINE=1,this.FOLDER_TYPE_PUBLIC=2,this.FOLDER_PRIV_NONE=0,this.FOLDER_PRIV_CREATE=1,this.FOLDER_PRIV_VIEW=2,this.FOLDER_PRIV_EDIT_OWN=4,this.FOLDER_PRIV_EDIT_ALL=8,this.FOLDER_PRIV_DELETE_OWN=16,this.FOLDER_PRIV_DELETE_ALL=32,this.ITEM_TYPE_NONE=0,this.ITEM_TYPE_QUERY=-1,this.ITEM_TYPE_GRAPH=-2,this.ITEM_TYPE_REPORT=-3,this.ITEM_TYPE_SEARCH=-4,this.ITEM_TYPE_DATASET=-5,this.ITEM_TYPE_METRICVIEW=-6,this.ITEM_TYPE_EXPLORER=-7,this.ITEM_TYPE_PROJECT=-8,this.ITEM_TYPE_DASHBOARD=-9,this.ITEM_TYPE_R_SCRIPT=-10,this.ITEM_TYPE_SCRIPT=-11,this.QUERY_TYPE_NONE=0,this.QUERY_TYPE_SELECT=1,this.QUERY_TYPE_UPDATE=2,this.QUERY_TYPE_DELETE=3,this.QUERY_TYPE_APPEND=4,this.QUERY_TYPE_TRANSFORM=5,this.QUERY_TYPE_IN=6,this.QUERY_TYPE_AGGREGATE=7,this.GRP_CATALOG_ADMIN="MI Catalog Administrator",this.GRP_POWER_USER="MI Power User Role",this.KEY_PUBLIC_FOLDER="-1",this.KEY_BASELINE_FOLDER="-41",
this.KEY_PERSONAL_FOLDER="-999999999",this.CATALOG_PREFERENCE=1}return a});
define('catalog/model/folder-model',['require','jquery','knockout','application/application-context','catalog/services/catalog-constants'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("application/application-context"),d=require("catalog/services/catalog-constants");function e(h){this.constants=new d,this.user=c.user;var k=[];h=h||{},this.key=b.observable(h.key),this.id=b.observable(h.id),this.description=b.observable(h.description),this.caption=b.observable(h.caption),this.folderType=b.observable(h.folderType),this.hasChildren=b.observable(h.hasChildren),this.parentKey=b.observable(h.parentKey),this.ownerKey=b.observable(h.ownerKey),this.ownerId=b.observable(h.ownerId),this.path=b.observable(h.path),this.privilege=h.privilege,this.spread=h.spread,this.updateDate=b.observable(h.updateDate),this.updateUser=b.observable(h.updateUser),this.lockSeq=b.observable(h.lockSeq),h.children&&h.children.length>0&&(k=a.map(h.children,function(a){return new e(a)})),this.children=b.observableArray(k),this.canCreate=b.observable(!1),this.canCreateSpread=b.observable(!1),
this.canView=b.observable(!1),this.canViewSpread=b.observable(!1),this.canEditAll=b.observable(!1),this.canEditOwn=b.observable(!1),this.canEditSpread=b.observable(!1),this.canDeleteAll=b.observable(!1),this.canDeleteOwn=b.observable(!1),this.canDeleteSpread=b.observable(!1),this.setPrivilege(this,h.privilege),this.isNew=b.computed(f.bind(null,this)),this.isProtectedFolder=b.computed(g.bind(null,this)),this.parent=b.observable(),this.hierarchyLevel=b.computed(i.bind(null,this)),this.pathArray=b.computed(j.bind(null,this))}function f(a){return a.key()&&"0"===a.key().toString()}function g(a){var b=a.constants,c=a.key(),d=a.folderType(),e=a.parentKey();if(c&&"0"!==c)return c=c.toString(),e=e?e.toString():null,d===b.FOLDER_TYPE_BASELINE||(c===b.KEY_PUBLIC_FOLDER.toString()||c===b.KEY_PERSONAL_FOLDER.toString()||(e===b.KEY_PERSONAL_FOLDER.toString()||!h(a)&&!a.canEditAll()))}function h(a){if(a.user.isSuperUser)return!0;if(void 0===a.user.groups||null===a.user.groups)return!1
;for(var b=0;b<a.user.groups.length;b++)if(a.user.groups[b].id===a.constants.GRP_CATALOG_ADMIN||a.user.groups[b].id===a.constants.GRP_POWER_USER)return!0;return!1}function i(a){return a.parent()?a.parent().hierarchyLevel()+1:1}function j(a){var b=[];return a.parent()&&(b=a.parent().pathArray().slice()),b.push(a),b}return e.prototype.setPrivilege=function a(){this.canCreate(this.privilege===(this.privilege|this.constants.FOLDER_PRIV_CREATE)),this.canView(this.privilege===(this.privilege|this.constants.FOLDER_PRIV_VIEW)),this.canEditAll(this.privilege===(this.privilege|this.constants.FOLDER_PRIV_EDIT_ALL)),this.canEditOwn(this.privilege===(this.privilege|this.constants.FOLDER_PRIV_EDIT_OWN)),this.canDeleteAll(this.privilege===(this.privilege|this.constants.FOLDER_PRIV_DELETE_ALL)),this.canDeleteOwn(this.privilege===(this.privilege|this.constants.FOLDER_PRIV_DELETE_OWN)),this.canCreateSpread(this.spread===(this.spread|this.constants.FOLDER_PRIV_CREATE)),
this.canViewSpread(this.spread===(this.spread|this.constants.FOLDER_PRIV_VIEW)),this.canEditSpread(this.spread===(this.spread|this.constants.FOLDER_PRIV_EDIT_ALL||this.spread|this.constants.FOLDER_PRIV_EDIT_OWN&&this.ownerKey===this.user)),this.canDeleteSpread(this.spread===(this.spread|this.constants.FOLDER_PRIV_DELETE_ALL||this.spread|this.constants.FOLDER_PRIV_DELETE_OWN&&this.ownerKey===this.user))},e.prototype.extractPrivilege=function a(b){var c=0;this.canCreate&&(c+=1),this.canView&&(c+=2),this.canEditOwn&&(c+=4),this.canEditAll&&(c+=8),this.canDeleteOwn&&(c+=16),this.canDeleteAll&&(c+=32),b.privilege=c;var d=0;this.canCreateSpread&&(d+=1),this.canViewSpread&&(d+=2),this.canEditOwn&&this.canEditSpread&&(d+=4),this.canEditAll&&this.canEditSpread&&(d+=8),this.canDeleteOwn&&this.canDeleteSpread&&(d+=16),this.canDeleteAll&&this.canDeleteSpread&&(d+=32),b.spread=d},e});
define('catalog/adapters/folder-adapter',['require','jquery','../services/dto/folder-dto','../model/folder-model'],function(require){"use strict";var a=require("jquery"),b=require("../services/dto/folder-dto"),c=require("../model/folder-model");function d(){}return d.toModelObject=function a(b){return new c(b)},d.toDTO=function a(c){var d=new b;return d.parentKey=c.parentKey(),d.key=c.key(),d.id=c.id(),d.caption=c.caption(),d.path=c.path(),d.folderType=c.folderType(),d.ownerKey=c.ownerKey(),d.ownerId=c.ownerId(),d.description=c.description(),d.updateDate=c.updateDate(),d.updateUser=c.updateUser(),d.lockSeq=c.lockSeq(),c.extractPrivilege(d),d},d.toModelObjectArray=function b(c){return null===c?null:a.map(c,function(a){return d.toModelObject(a)})},d});
define('catalog/catalog-events',['require','system/lang/event'],function(require){"use strict";var a=require("system/lang/event");function b(){this.beforeFolderNavigated=new a,this.folderNavigated=new a,this.folderAdded=new a,this.folderUpdated=new a,this.folderDeleted=new a,this.navigationRequested=new a}return b.singleton=!0,b});

define('text!catalog/views/catalog-nav.html',[],function () { return '<mi-collapsible class="cat-collapsible">\r\n    <section class="expanded">\r\n        <div class="list-group-item cat-root">\r\n            <span data-bind="text: translate(\'CATALOG\')"></span>\r\n        </div>\r\n\r\n        <mi-tree key="key"\r\n                 description="caption"\r\n                 root-name="Home"\r\n                 page-size="25"\r\n                 data-bind="attr: { \'allow-add\': canCreateNew}">\r\n        </mi-tree>\r\n    </section>\r\n    <section class="collapsed">\r\n        <i class="icon-expand"></i>\r\n        <div class="block-group">\r\n            <div class="verticle-block-group">\r\n                <span class="title" data-bind="text: translate(\'CATALOG\')"></span>\r\n            </div>\r\n        </div>\r\n    </section>\r\n</mi-collapsible>ï»¿';});


define('text!ui/elements/collapsible/template.html',[],function () { return '<section class="expanded active border-right">\r\n\t<i class="icon-collapse"></i>\r\n</section>\r\n<section class="collapsed">\r\n    <i class="icon-expand"></i>\r\n    <div class="block-group">\r\n        <div class="verticle-block-group">\r\n            <span class="title"></span>\r\n        </div>\r\n    </div>\r\n</section>';});

define('ui/elements/collapsible/collapsible-element',['require','jquery','text!./template.html','system/globalization/translator'],function(require){"use strict";var a=require("jquery"),b=require("text!./template.html"),c=Object.resolve(require("system/globalization/translator")),d={};d.prototype=Object.create(HTMLElement.prototype),d.prototype.createdCallback=function(){var d=null,i=null,j=this,k="",l=!1,m=!1,n=null,o=c.translate("HIDE"),p=c.translate("SHOW");this.element=this,l=a(this.element).find("section.expanded").length>0,m=a(this.element).find("section.collapsed").length>0,l||m?(d=a(this.element).find("section.expanded").children().detach(),i=a(this.element).find("section.collapsed").children().detach()):d=a(this.element).children().detach(),this.element.innerHTML=b,a(this.element).find("section.expanded").append(d),m&&(a(this.element).find("section.collapsed").empty(),a(this.element).find("section.collapsed").append(i)),k=a(this.element).attr("caption"),this.private={caption:"",expanded:!0},Object.defineProperty(j,"caption",{get:function(){return j.private.caption}.bind(j),set:function(a){
e.call(null,j,a)}.bind(j)}),Object.defineProperty(j,"expanded",{get:function(){return j.private.expanded}.bind(j),set:function(a){f.call(null,j,a)}.bind(j)}),k&&(this.caption=k),a(this.element).find("i.icon-collapse").attr("title",o).on("click",g.bind(null,this)),a(this.element).find("i.icon-expand").attr("title",p).on("click",h.bind(null,this))},d.prototype.attachedCallback=function(){},d.prototype.detachedCallback=function(){},d.prototype.attributeChangedCallback=function(a,b,c){"caption"===a&&e.call(null,this,c)},d.prototype.show=function(){h(this)},d.prototype.hide=function(){g(this)};function e(a,b){a.private.caption!==b&&(a.private.caption=b,a.element.querySelector("section.collapsed span.title").innerHTML=b)}function f(a,b){a.private.expanded!==b&&(a.private.expanded=b,b===!0?h(a):b===!1&&g(a))}function g(b){j(b,!1)&&(a(b.element).find("section.expanded").removeClass("active"),a(b.element).find("section.collapsed").addClass("active"),b.private.expanded=!1,i(b))}function h(b){
j(b,!0)&&(a(b.element).find("section.collapsed").removeClass("active"),a(b.element).find("section.expanded").addClass("active"),b.private.expanded=!0,i(b))}function i(a){return a.dispatchEvent(new CustomEvent("change",{detail:{expanded:a.private.expanded}}))}function j(a,b){return a.changingEvent=new CustomEvent("changing",{detail:{expanding:b},cancelable:!0,bubbles:!0}),a.dispatchEvent(a.changingEvent)}return document.registerElement("mi-collapsible",{prototype:d.prototype}),d});
define('catalog/catalog-nav-view-model',['require','jquery','application/application-events','./catalog-events','system/error/error-message','spa/ko/knockout-view-model','system/knockout/knockout-manager','./services/catalog-service','./services/catalog-constants','./adapters/folder-adapter','system/globalization/translator','system/lang/event','text!./views/catalog-nav.html','ui/elements/collapsible/collapsible-element'],function(require){"use strict";var a=require("jquery"),b=require("application/application-events"),c=require("./catalog-events"),d=require("system/error/error-message"),e=require("spa/ko/knockout-view-model"),f=require("system/knockout/knockout-manager"),g=require("./services/catalog-service"),h=require("./services/catalog-constants"),i=require("./adapters/folder-adapter"),j=require("system/globalization/translator"),k=require("system/lang/event"),l=require("text!./views/catalog-nav.html");require("ui/elements/collapsible/collapsible-element");function m(a,b,c,d){n.call(this,l),this.kom=a,this.applicationEvents=b,this.catalogService=d,this.events=c,this.navCollapsed=new k,this.navExpanded=new k,this.requestAddFolder=new k,this.translator=Object.resolve(j),this.constants=Object.resolve(h),this.$treeControl=null,this.$collapsible=null,this.canCreateNew=null,this.allowAdd="true",this.flatFolders=null}var n=Object.inherit(e,m);m.dependsOn=[f,b,c,g],m.prototype.load=function b(c){
var d=new a.Deferred;return c&&c.allowAdd&&(this.allowAdd=c.allowAdd),d.promise()},m.prototype.unload=function a(){},m.prototype.canUnload=function a(){return!0},m.prototype.activate=function a(){this.events.folderAdded.add(this.onFolderAdded,this),this.events.folderUpdated.add(this.onFolderUpdated,this),this.events.folderDeleted.add(this.onFolderDeleted,this),this.events.navigationRequested.add(this.onNavigationRequested,this),this.canCreateNew=this.kom.pureComputed(o.bind(null,this))},m.prototype.deactivate=function a(b){this.events.folderAdded.remove(this),this.events.folderUpdated.remove(this),this.events.folderDeleted.remove(this),this.events.navigationRequested.remove(this)},m.prototype.attach=function a(b){var c,d;n.prototype.attach.call(this,b),this.region=b,this.$treeControl=this.region.$element.find("mi-tree"),c=this.$treeControl.get(0),Element.upgrade(c),this.$collapsible=this.region.$element.find("mi-collapsible"),d=this.$collapsible.get(0),Element.upgrade(d),
this.$treeControl.on("selecting",s.bind(null,this)),this.$treeControl.on("navigated",t.bind(null,this)),this.$treeControl.on("add-item",u.bind(null,this)),c.searchCallback=this.onSearchFolders.bind(this),this.$collapsible.on("change",v.bind(null,this)),c.loader=p.bind(null,this)},m.prototype.detach=function a(b){n.prototype.detach.call(this,b),this.$treeControl.off("selecting"),this.$treeControl.off("navigated"),this.$treeControl.off("add-item"),this.$collapsible.off("change")};function o(a){return a.allowAdd}m.prototype.translate=function a(b){return this.translator.translate(b)},m.prototype.onFolderAdded=function a(b,c){var d=this.$treeControl.get(0);!c&&d.refresh();var e=d.listGroup.items;e.push(b),c&&(d.listGroup.items=e,this.preventRefresh=!0),d.listGroup.value=b},m.prototype.onFolderUpdated=function a(b){var c=this.$treeControl.get(0);w(this,c).caption=b.id(),c.refresh()},m.prototype.onFolderDeleted=function a(b){var c=this.$treeControl.get(0);c.backInHistory(),c.refresh()},
m.prototype.onNavigationRequested=function a(b){var c=this.$treeControl.get(0);b&&b.length&&(b[0].key&&b[0].key&&b.splice(0,0,{caption:this.translate("CATALOG_NAV_ROOT")}),c.value=b)},m.prototype.onSearchFolders=function b(c,d,e,f){return c?this.catalogService.searchFolders(c,f,e).fail(x.bind(null,this)):a.Deferred().resolve().promise()};function p(b,c,d,e){var f=a.Deferred(),g,h,i;return g=b.$treeControl.get(0),h=g.value[c],h&&h.key&&(i=h.key),b.preventRefresh?q(b,f,[]):h.key?b.catalogService.getFoldersPaginate(i,e,d).done(q.bind(null,b,f)).fail(x.bind(null,b)):b.catalogService.getFolderRoots().done(r.bind(null,b,f)).fail(x.bind(null,b)),f}function q(a,b,c){b.resolve(c)}function r(a,b,c){b.resolve(c)}function s(a,b){a.events.beforeFolderNavigated.raise(b)}function t(a,b){var c=b.target,d,e;c&&(d=w(a,c),e=d.key?d.key:null,a.preventRefresh?delete a.preventRefresh:a.events.folderNavigated.raise(e,b))}function u(a,b){a.requestAddFolder.raise(b)}function v(a,b){var c=b.originalEvent.detail
;c&&(c.expanded?a.navExpanded.raise():a.navCollapsed.raise())}function w(a,b){if((b=b||a.$treeControl.get(0))&&b.value&&!(b.value.length<1))return b.value[b.value.length-1]}function x(a,b){var c=2,e=d.fromHttpResponse(c,b);a.applicationEvents.errorOccured.raise(a,e)}return m});

define('text!catalog/views/catalog-dialog-details.html',[],function () { return '<div class="catalog-dialog-details">\r\n    <!-- ko if: selectedFolderKey -->\r\n\r\n    <div class="folder-header" data-bind="visible: $root.visibleHeaders">\r\n        <div class="folder-title">\r\n            <h2 data-bind="text: $root.selectedFolder().caption()" />\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Set visible state for items icons -->\r\n    <div class="catalog-header" data-bind="visible: $root.visibleHeaders">\r\n        <div class="catalog-title">\r\n            <h3 data-bind="text: translate(\'CATALOG_ITEMS\') + \' - \' + $root.filteredCatalogItems().length + \'/\' +  $root.catalogItemCount()" />\r\n        </div>\r\n    </div>\r\n\r\n    <div class="cat-item-group">\r\n\r\n        <table class="table table-bordered table-condensed">\r\n            <thead>\r\n                <tr>\r\n                    <td>\r\n                        <div id="hdrName" class="column-header" data-bind="click: onHeaderClick">\r\n                            <span data-bind="text: translate(\'NAME\')" />\r\n                            <i class="header-sort-img",\r\n                               data-bind="css: headerSortImgName" />\r\n                            <!-- <a class="header-sort-img">\r\n                                <i data-bind="css: headerSortImgName"></i>\r\n                            </a> -->\r\n                        </div>\r\n                    </td>\r\n                    <td>\r\n                        <div id="hdrCaption" class="column-header" data-bind="click: onHeaderClick">\r\n                            <span data-bind="text: translate(\'CAPTION\')" />\r\n                            <i class="header-sort-img",\r\n                               data-bind="css: headerSortImgCaption" />\r\n                            <!-- <a class="header-sort-img">\r\n                                <i data-bind="css: headerSortImgCaption "></i>\r\n                            </a> -->\r\n                        </div>\r\n                    </td>\r\n                    <td>\r\n                        <div id="hdrDesc" class="column-header" data-bind="click: onHeaderClick">\r\n                            <span data-bind="text: translate(\'DESCRIPTION\')" />\r\n                            <i class="header-sort-img",\r\n                               data-bind="css: headerSortImgDesc" />\r\n                            <!-- <a class="header-sort-img">\r\n                                <i data-bind="css: headerSortImgDesc "></i>\r\n                            </a> -->\r\n                        </div>\r\n                    </td>\r\n                    <td>\r\n                        <div id="hdrType" class="column-header" data-bind="click: onHeaderClick">\r\n                            <span data-bind="text: translate(\'TYPE\')" />\r\n                            <i class="header-sort-img",\r\n                               data-bind="css: headerSortImgType" />\r\n                            <!-- <a class="header-sort-img">\r\n                                <i data-bind="css: headerSortImgType "></i>\r\n                            </a> -->\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n            </thead>\r\n            <tbody class="catalog-dialog-detail-items"\r\n                   data-bind="foreach: filteredCatalogItems,\r\n                              scrollToSelectedItem: filteredCatalogItems,\r\n                              click: onItemClicked">\r\n                <tr data-bind="css: { \'info\': isSelected }">\r\n                    <td data-bind="text: id" />\r\n                    <td data-bind="text: caption" />\r\n                    <td data-bind="text: description" />\r\n                    <td data-bind="text: itemTypeDisplay" />\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n\r\n    </div>\r\n\r\n    <!-- /ko -->\r\n\r\n</div>';});

define('catalog/catalog-dialog-details',['require','jquery','application/application-events','application/application-context','knockout','system/globalization/translator','./catalog-events','./model/folder-model','./model/catalog-item-model','system/error/error-message','spa/ko/knockout-view-model','system/knockout/knockout-manager','./adapters/catalog-item-adapter','./adapters/folder-adapter','./services/dto/user-pref-dto','./services/catalog-service','./services/catalog-constants','text!./views/catalog-dialog-details.html'],function(require){"use strict";var a=require("jquery"),b=require("application/application-events"),c=require("application/application-context"),d=require("knockout"),e=require("system/globalization/translator"),f=require("./catalog-events"),g=require("./model/folder-model"),h=require("./model/catalog-item-model"),i=require("system/error/error-message"),j=require("spa/ko/knockout-view-model"),k=require("system/knockout/knockout-manager"),l=require("./adapters/catalog-item-adapter"),m=require("./adapters/folder-adapter"),n=require("./services/dto/user-pref-dto"),o=require("./services/catalog-service"),p=require("./services/catalog-constants"),q=require("text!./views/catalog-dialog-details.html");function r(a,b,d,f){s.call(this,q),this.applicationEvents=b,this.events=d,this.kom=a,this.service=f,this.constants=new p,this.translator=Object.resolve(e),this.user=c.user,this.session=c.session,this.catalogService=f,this.intendedTypes=[],this.initPath="",this.isItemPath=!1,
this.selectedFolderKey=null,this.selectedFolder=null,this.catalogItems=null,this.catalogItemCount=null,this.sortColumn=null,this.sortOrder=null,this.headerSortImgName=null,this.headerSortImgCaption=null,this.headerSortImgDesc=null,this.headerSortImgType=null,this.visibleHeaders=null,this.selectedItemVm=null}var s=Object.inherit(j,r);r.dependsOn=[k,b,f,o],r.prototype.load=function b(c){var d=new a.Deferred;return this.selectedFolderKey=this.kom.observable(),this.selectedFolder=this.kom.observable(),this.catalogItems=this.kom.observableArray(),this.catalogItemCount=this.kom.observable(),this.filteredCatalogItems=this.kom.computed(t.bind(null,this)),this.selectedItemVm=this.kom.observable(null),this.sortColumn=this.kom.observable("hdrName"),this.sortOrder=this.kom.observable("asc"),this.headerSortImgName=this.kom.computed(z.bind(null,this,"hdrName")),this.headerSortImgCaption=this.kom.computed(z.bind(null,this,"hdrCaption")),
this.headerSortImgDesc=this.kom.computed(z.bind(null,this,"hdrDesc")),this.headerSortImgType=this.kom.computed(z.bind(null,this,"hdrType")),this.visibleHeaders=this.kom.observable(!1),d.promise()},r.prototype.activate=function a(){this.events.folderNavigated.add(this.onFolderNavigated,this),this.events.beforeFolderNavigated.add(this.onBeforeFolderNavigated,this)},r.prototype.navigateToPath=function b(c){var d=this,e=new a.Deferred;return this.initPath=c||"",this.initPath?d.catalogService.getFolderParents(c).done(u.bind(null,d,e)).fail(y.bind(null,d)):d.catalogService.getFolderRoots(c).done(u.bind(null,d,e)).fail(y.bind(null,d)),e.promise()},r.prototype.attach=function a(b){s.prototype.attach.call(this,b),this.region=b},r.prototype.detach=function a(b){s.prototype.detach.call(this,b)},r.prototype.canUnload=function a(){return!0},r.prototype.deactivate=function a(b){this.kom.disposeSubscriptions(),this.kom.disposeComputeds(),this.events.folderNavigated.remove(this),
this.events.beforeFolderNavigated.remove(this)},r.prototype.unload=function a(){this.kom.disposeObservables()},r.prototype.translate=function a(b){return this.translator.translate(b)},r.prototype.onBeforeFolderNavigated=function a(b){},r.prototype.onFolderNavigated=function a(b){b?v(this,b):(this.selectedFolderKey(null),this.selectedFolder(null),this.selectedItemVm(null))},r.prototype.onItemClicked=function a(b,c){var e=d.dataFor(c.target);e&&e instanceof h&&(this.selectedItemVm()&&this.selectedItemVm().isSelected(!1),this.selectedItemVm(e),this.selectedItemVm().isSelected(!0))},r.prototype.isAdmin=function a(){if(this.user.isSuperUser)return!0;if(void 0===this.user.groups||null===this.user.groups)return!1;for(var b=0;b<this.user.groups.length;b++)if(this.user.groups[b].id===this.constants.GRP_CATALOG_ADMIN||this.user.groups[b].id===this.constants.GRP_POWER_USER)return!0;return!1},r.prototype.onHeaderClick=function a(b,c){var d=c.target.id;""===d&&(d=c.target.parentElement.id),
""===d&&(d=c.target.parentElement.parentElement.id),""===d&&(d=c.target.parentElement.parentElement.parentElement.id),this.sortColumn()===d?"asc"===this.sortOrder()?this.sortOrder("desc"):this.sortOrder("asc"):(this.sortColumn(d),this.sortOrder("asc")),this.catalogItems&&this.catalogItems()&&this.catalogItems.sort(A.bind(null,this))},r.prototype.isIntendedType=function a(b){var c=!1,d=0;for(c=0===this.intendedTypes.length,d=0;d<this.intendedTypes.length;d++)if(b.toLowerCase()===this.intendedTypes[d].toString().toLowerCase()){c=!0;break}return c},d.bindingHandlers.scrollToSelectedItem={update:function(b,c){d.utils.unwrapObservable(c()),a("tr.info")&&a("tr.info")[0]&&a("tr.info")[0].scrollIntoView()}};function t(a){var b,c;return c=a.catalogItems(),0===a.intendedTypes.length?b=c:(c=d.utils.arrayFilter(c,function(b){return a.isIntendedType(b.itemTypeDisplay())}),b=c),b}function u(a,b,c){a.events.navigationRequested.raise(c),v(a,c[c.length-1].key),b.resolve()}function v(b,c){
var d=new a.Deferred,e=new a.Deferred;a.when(d,e).then(function(){b.selectedFolderKey(c)}),b.service.getFolder(c).done(w.bind(null,b,d)).fail(y.bind(null,b)),b.service.getCatalogItems(c).done(x.bind(null,b,e)).fail(y.bind(null,b))}function w(a,b,c){a.selectedFolder(m.toModelObject(c)),b.resolve()}function x(a,b,c){var e,f;if(a.catalogItems(l.toModelObjectArray(c)),a.selectedItemVm(null),void 0===c||null===c?a.catalogItemCount(0):a.catalogItemCount(c.length),a.catalogItems&&a.catalogItems()&&(a.catalogItems.sort(A.bind(null,a)),a.isItemPath&&(null!==a.initPath&&(e=a.initPath.split("\\").pop().toLowerCase()),f=d.utils.arrayFirst(a.catalogItems(),function(a){return a.id().toLowerCase()===e})))){f.isSelected(!0),a.selectedItemVm(f);var g=f.$element}b.resolve()}function y(a,b){var c=2,d=i.fromHttpResponse(c,b);a.applicationEvents.errorOccured.raise(a,d)}function z(a,b){return a.sortColumn()===b?"asc"===a.sortOrder()?"icon-up-arrow":"icon-up-arrow rotate-180":""}function A(a,b,c){
var d="",e="";switch(a.sortColumn()){case"hdrName":d=b.id().toLowerCase(),e=c.id().toLowerCase();break;case"hdrCaption":d=b.caption().toLowerCase(),e=c.caption().toLowerCase();break;case"hdrDesc":d=b.description().toLowerCase(),e=c.description().toLowerCase();break;case"hdrType":d=b.itemTypeDisplay().toLowerCase(),e=c.itemTypeDisplay().toLowerCase()}switch(a.sortOrder()){case"asc":return d<e?-1:d>e?1:0;case"desc":return d>e?-1:d<e?1:0}}return r});

define('text!catalog/views/catalog-dialog.html',[],function () { return '<div class="catalog-dialog block-group">\r\n    <div class="catalog-nav-container block">&nbsp;</div>\r\n    <div class="catalog-details-container block">&nbsp;</div>\r\n    <div class="controls block">\r\n        <div class="pull-right">\r\n            <button type="button" class="btn btn-primary" data-bind="click: openSelectedItem.bind($root), enable: detailsViewModel.selectedItemVm(), text: translate(\'OPEN\').capitalize()"></button>\r\n            <button type="button" class="btn btn-default" data-bind="event: {click: cancel}, text: translate(\'CANCEL\')"></button>\r\n        </div>\r\n    </div>\r\n</div>';});

define('catalog/catalog-dialog',['require','jquery','application/application-events','spa/conductor','system/error/error-message','spa/ko/knockout-view-model','knockout','system/knockout/knockout-manager','spa/region','system/ui/dialog-view-model','./services/catalog-service','./adapters/catalog-item-adapter','./adapters/folder-adapter','./catalog-events','./catalog-nav-view-model','./catalog-dialog-details','system/globalization/translator','text!./views/catalog-dialog.html','system/lang/string','system/lang/object'],function(require){"use strict";var a=require("jquery"),b=require("application/application-events"),c=require("spa/conductor"),d=require("system/error/error-message"),e=require("spa/ko/knockout-view-model"),f=require("knockout"),g=require("system/knockout/knockout-manager"),h=require("spa/region"),i=require("system/ui/dialog-view-model"),j=require("./services/catalog-service"),k=require("./adapters/catalog-item-adapter"),l=require("./adapters/folder-adapter"),m=require("./catalog-events"),n=require("./catalog-nav-view-model"),o=require("./catalog-dialog-details"),p=require("system/globalization/translator"),q=require("text!./views/catalog-dialog.html");require("system/lang/string"),require("system/lang/object");function r(a,b,c,d,e,f){s.call(this,q),this.applicationEvents=a,this.events=b,this.navRegion=c,this.navViewModel=d,this.detailsRegion=e,this.detailsViewModel=f,this.translator=Object.resolve(p),this.preferences=null,this.dfd=null,this.dialog=null,this.result=null}
var s=Object.inherit(e,r);r.factory=function(){return new r(Object.resolve(b),Object.resolve(m),Object.resolve(h),Object.resolve(n),Object.resolve(h),Object.resolve(o))};function t(a,b){if("a"===b)return a.translator.translate("KPI_DATASOURCE_MODEL_TYPE_MERIDIUM_ARTICLE")}function u(a,b){if("query"===b)return a.translator.translate("KPI_DATASOURCE_MODEL_TYPE_MERIDIUM_QUERY")}r.prototype.show=function b(c){var d={height:"90%",width:"90%"},e="";if(this.preferences=c,this.preferences||(this.preferences={itemTypes:[]}),this.preferences.itemTypes||(this.preferences.itemTypes=[]),this.detailsViewModel.intendedTypes=this.preferences.itemTypes,this.preferences.itemTypes)if(0!==this.preferences.itemTypes.length){for(var f="",g=0;g<this.preferences.itemTypes.length;g++)f+=t(this,String.articleFor(this.preferences.itemTypes[g]))+" "+u(this,this.preferences.itemTypes[g].toString().toLowerCase()),g!==this.preferences.itemTypes.length-1&&(f+=", "),g===this.preferences.itemTypes.length-2&&(f+="or ")
;e=String.format(this.translate("CATALOG_DIALOG_SELECT_ITEM_SPECIFIC"),f)}else e=this.translate("CATALOG_DIALOG_SELECT_ITEM");else e=this.translate("CATALOG_DIALOG_SELECT_ITEM");return this.dialog=new i(this,e,d),this.dialog.show(),this.dfd=a.Deferred(),this.dfd.promise()},r.prototype.close=function a(){this.dialog=null},r.prototype.open=function a(){},r.prototype.load=function b(c){var d=new a.Deferred;return c||(c={allowAdd:"false"}),this.navViewModel.load(c),this.detailsViewModel.load(c),d.promise()},r.prototype.activate=function a(){this.navViewModel.activate(),this.detailsViewModel.activate(),this.detailsViewModel.navigateToPath(this.preferences.path)},r.prototype.attach=function a(b){s.prototype.attach.call(this,b),this.region=b,this.navRegion.setElement(this.region.$element.find("div.catalog-nav-container")),this.navViewModel.attach(this.navRegion),this.detailsRegion.setElement(this.region.$element.find("div.catalog-details-container")),
this.detailsViewModel.attach(this.detailsRegion)},r.prototype.detach=function a(b){this.navViewModel.detach(this.navRegion),this.navRegion.clear(),this.detailsViewModel.detach(this.detailsRegion),this.detailsRegion.clear(),s.prototype.detach.call(this,b)},r.prototype.canUnload=function a(){return this.navViewModel.canUnload()&&this.detailsViewModel.canUnload()},r.prototype.deactivate=function a(b){this.navViewModel.deactivate(this.navRegion),this.detailsViewModel.deactivate(this.detailsRegion)},r.prototype.unload=function a(){this.navViewModel.unload(),this.detailsViewModel.unload(),this.dfd=null,this.result=null},r.prototype.translate=function(a){return this.translator.translate(a)},r.prototype.openSelectedItem=function a(){this.detailsViewModel.selectedItemVm()&&(this.result=k.toDTO(this.detailsViewModel.selectedItemVm()),this.dfd.resolve(this.result),this.detailsViewModel.selectedItemVm().isSelected(!1)),this.dialog.closeDialog()},r.prototype.cancel=function a(){
this.detailsViewModel.selectedItemVm()&&this.detailsViewModel.selectedItemVm().isSelected(!1),this.result=this.result=null,this.dfd.reject("cancelled"),this.dialog.closeDialog()};function v(a){}return r}),String.format=function(){"use strict";for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+(b-1)+"\\}","gm");a=a.replace(c,arguments[b])}return a},String.articleFor=function(a){"use strict";return"a"===a.charAt(0)||"A"===a.charAt(0)||"e"===a.charAt(0)||"E"===a.charAt(0)||"i"===a.charAt(0)||"I"===a.charAt(0)||"o"===a.charAt(0)||"O"===a.charAt(0)||"u"===a.charAt(0)||"U"===a.charAt(0)?"an":"a"};

define('text!dashboard/views/query-widget-editor.html',[],function () { return '<div class="hyperlinks-widget-editor" style="height: 100%;">\r\n    <div style="height: 60px;" data-bind="with: widget">\r\n        <div class="form-group">\r\n            <label data-bind="text: $parent.translate(\'NAME\')"></label>\r\n            <div class="input-group localize">\r\n                <input type="text" class="form-control" data-bind="value: name">\r\n                <mi-localize type="20" data-bind="attr: { phrase: name, context: translationContext }, value: caption">\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <form style="height: 60px;" data-bind="with: widgetVM">\r\n        <label data-bind="text: translate(\'PATH\')"></label>\r\n        <div class="input-group">\r\n            <input disabled type="text" class="form-control disabled" data-bind="value: path">\r\n            <span class="input-group-btn">\r\n                <button  class="btn btn-default path-button" type="button"\r\n                         data-bind="click: $parent.choosePathFromCatalog.bind($parent),\r\n                                    attr: { title: translator.translate(\'CHOOSE_QUERY_TITLE\') }">...</button>\r\n            </span>\r\n        </div>\r\n    </form>\r\n</div>';});

define('dashboard/views/query-widget-editor-view',['require','text!../views/query-widget-editor.html'],function(require){"use strict";var a=require("text!../views/query-widget-editor.html");function b(){this.region=null}return b.html=a,b.prototype.attach=function(a){this.region=a},b.prototype.detach=function(){this.region=null},b});
define('dashboard/view-models/query-widget-editor',['require','./widget-editor','catalog/catalog-dialog','../views/query-widget-editor-view','ui/elements/localize/localize-element'],function(require){"use strict";var a=require("./widget-editor"),b=require("catalog/catalog-dialog"),c=require("../views/query-widget-editor-view");require("ui/elements/localize/localize-element");function d(a){e.call(this,a,c.html),this.editorView=Object.resolve(c),this.backup.path=this.kom.observable(),this.catalogDialog=Object.resolve(b)}var e=Object.inherit(a,d);d.prototype.afterLoad=function(){try{h(this)}catch(a){e.prototype.onError.call(this,a)}},d.prototype.afterSave=function(){try{i(this)}catch(a){e.prototype.onError.call(this,a)}},d.prototype.afterCancel=function(){try{j(this)}catch(a){e.prototype.onError.call(this,a)}},d.prototype.afterAttach=function(a){try{this.editorView.attach(a),e.prototype.handleRequiredFields.call(this,this.widgetVM.path),Element.upgrade(a.element.querySelectorAll("mi-localize"))}catch(a){e.prototype.onError.call(this,a)}},d.prototype.afterDetach=function(){try{this.editorView.detach()}catch(a){e.prototype.onError.call(this,a)}},
d.prototype.choosePathFromCatalog=function(){try{this.catalogDialog.show({path:this.widgetVM.path(),itemTypes:["Query"]}).done(f.bind(null,this)).fail(g.bind(null,this))}catch(a){e.prototype.onError.call(this,a)}};function f(a,b){var c=a.widgetVM.translator.translate("QUERY_WIDGET");a.widgetVM.path(b.path),a.widgetVM.widget.name(b.id)}function g(a,b){if("cancelled"!==b)throw new Error("Unable to retrieve catalog item because: "+b)}function h(a){a.backup.path(a.widgetVM.path())}function i(a){a.backup.path()}function j(a){a.widgetVM.path(a.backup.path())}return d});
define('ui/elements/page-filter/page-filter-remote',['require','jquery'],function(require){"use strict";var a=require("jquery");function b(){this.pageFilter=null}b.prototype.connect=function a(b){this.pageFilter=c(b)};function c(b){var c;return c=a(b).closest("mi-page-filter").get(0)||null,null===c?a(b).closest("mi-et-page-filter").get(0)||null:c}return b.prototype.isConnected=function a(){return null!==this.pageFilter},b});
define('ui/elements/page-filter/page-filter-connection',['require','./page-filter-remote'],function(require){"use strict";var a=require("./page-filter-remote");function b(){this.callback=null,this.element=null,this.filter=null,this.remote=Object.resolve(a)}return b.prototype.open=function a(b,c){this.callback=b,this.element=c,this.remote.connect(c),this.filter=this.remote.pageFilter,this.remote.isConnected()?this.filter.connect(this):this.publish()},b.prototype.close=function a(){this.filter&&this.filter.disconnect(this),this.filter=null,this.element=null,this.callback=null},b.prototype.publish=function a(b){this.callback(b)},b.prototype.isSame=function a(b){return this===b},b});

define('text!dashboard/views/query-widget.html',[],function () { return '<section class="query-widget">\r\n    <mi-resultgrid allowcolumnresizing="true"\r\n                   allowcolumnreordering="false"\r\n                   selectionmode="single"\r\n                   showgroupingpanel="false"\r\n                   showrowfilter="false"\r\n                   hascolumnchooser="false"\r\n                   columnautowidth="true"\r\n                   queryexecutionmode="catalogItemPath"\r\n                   data-bind="attr:{data:query}">\r\n    </mi-resultgrid>\r\n</section>';});


define('text!ui/elements/resultgrid/resultgrid-template.html',[],function () { return '\r\n<div class="rg-header">\r\n    <div data-bind="halt-bindings" class="rg-pager" >\r\n        <mi-select data-bind="miproperty:{\r\n                           options: listObjects,\r\n                           optionsText: \'displayName\',\r\n                           optionsValue: optionsValue,\r\n                           value: selectedValue,\r\n                           editable: false\r\n                           }">\r\n        </mi-select>\r\n        <div class="totalCount">\r\n            <div data-bind="text: $root.translator.translate(\'OF\')"></div>\r\n            <div data-bind="text: customTotalCount"></div> \r\n            <div data-bind="text: $root.translator.translate(\'RECORDS\')"></div>\r\n         </div>\r\n      </div>\r\n   \r\n        <!--<button class="btn btn-icon pull-right rg-filter" data-bind="attr: {title : \'Filter\'}">\r\n            <i class="icon-collection-filter" ></i>\r\n        </button>-->\r\n    </div>\r\n<div class="gridContainer" style="display:block;height:100%;width:100%;"></div>\r\n<div class="rg-footer">\r\n    <div class="rg-controls" >\r\n        <span class="dxDataGridTotalCount pull-left" style="height: 25px;display:none;"></span>\r\n    </div>\r\n\r\n</div>';});

define('ui/elements/resultgrid/resultgrid-service',['require','jquery','system/lang/object','system/http/ajax-client'],function(require){"use strict";var a=require("jquery");require("system/lang/object");var b=require("system/http/ajax-client");function c(a){this.ajaxClient=a,this.API_URL="api/core/command/query"}return c.dependsOn=[b],c.prototype.getData=function(b){var c=a.Deferred(),d=this.API_URL,e={CommandText:b.query,Parameters:[],StartRow:b.startRow,MaxRows:b.maxRows};return this.ajaxClient.post(d,e).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a.statusText)}),c.promise()},c});
define('query/services/dto/query-state-dto',['require','system/lang/converter','./query-container-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./query-container-dto");function c(a){a=a||{},this.version=2,this.queryContainer=new b(a.queryContainer)}return c});
define('query/model/parameter-value-model',['require','knockout'],function(require){"use strict";var a=require("knockout");function b(b){b=b||{},this.value=a.observable(b.value),this.displayValue=a.observable(b.displayValue)}return b});
define('query/adapters/parameter-value-adapter',['require','../services/dto/parameter-value-dto','../model/parameter-value-model'],function(require){"use strict";var a=require("../services/dto/parameter-value-dto"),b=require("../model/parameter-value-model");function c(){}return c.toModelObject=function a(c){return new b(c)},c.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},c.toDTO=function b(c){var d=new a;return c=c||{},d.value=c.value(),d.displayValue=c.displayValue(),d},c.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},c});
define('query/model/parameter-design-model',['require','knockout','../adapters/parameter-value-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/parameter-value-adapter");function c(c){c=c||{},this.id=a.observable(c.id),this.dataType=a.observable(c.dataType),this.caption=a.observable(c.caption),this.defaultValue=a.observable(c.defaultValue),this.isHidden=a.observable(c.isHidden),this.familyId=a.observable(c.familyId),this.fieldId=a.observable(c.fieldId),this.isMultiValue=a.observable(c.isMultiValue),this.list=a.observableArray(c.list),this.localizedCaption=a.observable(c.localizedCaption),this.codeTable=a.observable(c.codeTable),this.referenceCode=a.observable(c.referenceCode),this.referenceTable=a.observable(c.referenceTable),this.query=a.observable(c.query),this.isExclusive=a.observable(c.isExclusive),this.parameterValues=a.observableArray(b.toModelObjectArray(c.parmValues)),this.parameterPrompts=a.observableArray(c.parmPrompts),this.isAssetHierarchy=a.observable(c.isAssetHierarchy),this.child=a.observable(c.child),
this.parent=a.observable(c.parent),this.all=a.observable(c.all),this.current=a.observable(c.current),this.isGis=a.observable(c.isGis),this.format=a.observable(c.foramt),this.alias=a.observable(c.alias),this.distance=a.observable(c.distance),this.entyKey=a.observable(c.entyKey),this.justTheDate=a.observable(c.justTheDate),this.defaultValues=a.computed({read:e.bind(null,this),write:f.bind(null,this),owner:this}),this.isExclusive.subscribe(d.bind(null,this))}function d(a,b){b||a.isMultiValue(!1)}function e(a){var b=a.defaultValue();return b?b.toString().split("|"):[]}function f(a,b){b.length>1?a.defaultValue(b.join("|")):a.defaultValue(b[0])}return c});
define('query/adapters/parameter-design-adapter',['require','../services/dto/parameter-design-dto','../model/parameter-design-model','./parameter-value-adapter'],function(require){"use strict";var a=require("../services/dto/parameter-design-dto"),b=require("../model/parameter-design-model"),c=require("./parameter-value-adapter");function d(){}return d.toModelObject=function a(c){return new b(c)},d.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},d.toDTO=function b(d){var e=new a,f=d.parameterPrompts();return d=d||{},e.id=d.id()||null,e.dataType=d.dataType(),e.caption=d.caption(),e.defaultValue=d.defaultValue(),e.isHidden=d.isHidden(),e.familyId=d.familyId(),e.fieldId=d.fieldId(),e.isMultiValue=d.isMultiValue(),e.list=d.list(),e.localizedCaption=d.localizedCaption(),e.codeTable=d.codeTable(),e.referenceCode=d.referenceCode(),e.referenceTable=d.referenceTable(),e.query=d.query(),e.isExclusive=d.isExclusive(),e.parmValues=c.toDTOArray(d.parameterValues()),e.isAssetHierarchy=d.isAssetHierarchy(),e.isAssetHierarchy?(e.parmPrompts="0"===f[0]||0===f[0]?["-1"]:f,
e.assetHierarchyCaption=d.assetHierarchyCaption):e.parmPrompts=f,e.child=d.child(),e.parent=d.parent(),e.all=d.all(),e.current=d.current(),e.isGis=d.isGis(),e.format=d.format(),e.alias=d.alias(),e.distance=d.distance(),e.entyKey=d.entyKey(),e.justTheDate=d.justTheDate(),e},d.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},d});

define('text!query/execution/views/query-prompt.html',[],function () { return '<div class="query-prompt"\r\n     data-bind="foreach: prompts">\r\n    <div class="form-group"\r\n         data-bind="css: { \'has-error\': !$root.validatePrompt($data) }">\r\n        <!-- ko ifnot: isHidden -->\r\n            <label data-bind="text: caption"></label>\r\n            <!-- ko if: options && options.length -->\r\n                <!-- ko if: isExclusive -->\r\n                    <!-- ko if: isMultiValue -->\r\n                        <mi-select data-bind="miproperty: {\r\n                                                  options: options,\r\n                                                  multiple: true,\r\n                                                  optionsText: \'displayValue\',\r\n                                                  optionsValue: \'value\',\r\n                                                  optionsCaption: \'\',\r\n                                                  selectedOptions: values\r\n                                              },\r\n                                              event: {\r\n                                                  selected: $root.multiSelectValueChanged.bind($root)\r\n                                   }">\r\n                        </mi-select>\r\n                    <!-- /ko -->\r\n                    <!-- ko ifnot: isMultiValue -->\r\n                        <mi-select data-bind="miproperty: {\r\n                                                  options: options,\r\n                                                  multiple: false,\r\n                                                  optionsText: \'displayValue\',\r\n                                                  optionsValue: \'value\',\r\n                                                  optionsCaption: \'\',\r\n                                                  value: value\r\n                                    }">\r\n                        </mi-select>\r\n                    <!-- /ko -->\r\n                <!-- /ko -->\r\n                <!-- ko ifnot: isExclusive -->\r\n                    <!-- ko if: isMultiValue -->\r\n                        <mi-select data-bind="miproperty: {\r\n                                                  options: options,\r\n                                                  multiple: true,\r\n                                                  optionsText: \'displayValue\',\r\n                                                  optionsValue: \'value\',\r\n                                                  optionsCaption: \'\',\r\n                                                  selectedOptions: values\r\n                                              },\r\n                                              event: {\r\n                                                  selected: $root.multiSelectValueChanged.bind($root)\r\n                                   }">\r\n                        </mi-select>\r\n                    <!-- /ko -->\r\n                    <!-- ko ifnot: isMultiValue -->\r\n                        <mi-multi-value data-bind="miproperty: {\r\n                                                  options: cboOptions,\r\n                                                  multiple: false,\r\n                                                  optionsText: \'displayValue\',\r\n                                                  optionsValue: \'value\',\r\n                                                  optionsCaption: \'\',\r\n                                                  value: value\r\n                                    }">\r\n                        </mi-multi-value>\r\n                    <!-- /ko -->\r\n                <!-- /ko -->\r\n            <!-- /ko -->\r\n            <!-- ko ifnot: (options && options.length) -->\r\n                <!-- ko if: isAssetHierarchy -->\r\n                    <mi-asset-context dialog data-bind="value: value"></mi-asset-context>\r\n                <!-- /ko -->\r\n                <!-- ko ifnot: isAssetHierarchy -->\r\n                    <div data-bind="template: valueTemplate"></div>\r\n                <!-- /ko -->\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n    <!-- ko if: validationMessage -->\r\n        <p class="invalid-value bg-danger text-danger">\r\n            <button type="button"\r\n                    class="close"\r\n                    data-bind="click: $root.clearPromptValidationMessage($data),\r\n                               attr: { \'aria-label\': $root.translate(\'CLOSE\')}">\r\n                <span aria-hidden="true">&times;</span>\r\n            </button>\r\n            <span data-bind="text: validationMessage" />\r\n        </p>\r\n    <!-- /ko -->\r\n</div>\r\n\r\n<script type="text/html" id="prompt-text-template">\r\n    <input type="text" class="form-control" data-bind="value: value" />\r\n</script>\r\n<script type="text/html" id="prompt-number-template">\r\n    <input type="text"\r\n           class="form-control"\r\n           data-bind="textInput: value" />\r\n</script>\r\n<script type="text/html" id="prompt-datetime-template">\r\n    <mi-date-time pick-time="true"\r\n                  use-seconds="true"\r\n                  data-bind="value: value,\r\n                             attr: { format: $root.format }" />\r\n</script>\r\n<script type="text/html" id="prompt-date-template">\r\n    <mi-date-time pick-time="false"\r\n                  data-bind="value: value,\r\n                             attr: { format: $root.dateFormat }" />\r\n</script>';});

define('assets/services/asset-context-dto',['require','system/globalization/translator','system/lang/converter'],function(require){"use strict";var a=require("system/globalization/translator"),b=require("system/lang/converter");function c(a){a=a||{},this.entityKey=b.toString(a.entityKey),this.description="-1"===this.entityKey?d("ASSET_HIERARCHY_ROOT"):b.toString(a.description),this.type=b.toString(a.type),this.familyId=b.toString(a.familyId),this.siteKey=b.toString(a.siteKey)}c.fromDataCollection=function a(b){for(var d=[],e=0;e<b.length;e++)d[d.length]=new c(b[e]);return d},c.fromHierarchyDTO=function a(b){return b?new c({entityKey:b.entityKey,description:b.description,type:"Hierarchy",familyId:b.familyId,siteKey:b.siteKey}):c.default()},c.fromGroupDTO=function a(b){return new c(b?{entityKey:b.entityKey,description:b.groupid,type:"Group",siteKey:b.siteKey}:{type:"Group"})},c.default=function a(b){var e=d("ASSET_HIERARCHY_ROOT");return new c({entityKey:b||"-1",description:e,type:"Hierarchy"})};function d(b){return Object.resolve(a).translate(b)}return c});

define('text!ui/elements/select/template.html',[],function () { return '<div class="mi-select-container" data-bind="event:{click:toggleOptions,\r\n                                                    mousedown:handleMouseDown},\r\n    css:{\'disabled\':disabled,\'open\':isOpen,\'required\': isRequired }">\r\n    <div data-bind="css:{\'active\':isOpen}" class="mi-dropdown-selector">\r\n        <div data-bind="visible:multiple,\r\n    event:{click:toggleSelectAll},\r\n    css:{\'dx-checkbox-indeterminate\':selectedOptions().length && selectedOptions().length !== options().length ,\r\n        \'dx-checkbox-checked\':selectedOptions().length === options().length}" \r\n             class="pull-left dx-select-checkbox dx-datagrid-checkbox-size dx-widget dx-checkbox" tabindex="0" onclick="void(0)">\r\n            <div class="dx-checkbox-container">\r\n                <span class="dx-checkbox-icon"></span>\r\n            </div>\r\n        </div>\r\n        <input type="text" class="mi-selected-value-text pull-left"\r\n               data-bind="value:text,\r\n    valueUpdate:\'keyup\',\r\n    attr:{\'readonly\':(!editable() || disabled() || multiple() || isMobile),\r\n           \'title\': text},\r\n    css:{\'multi\':multiple},\r\n    event: {keyup: handleKeyUpOnTextInput,\r\n            keydown:handleKeyDownOnTextInput,\r\n            click:handleKeyUpOnTextInput,\r\n            mousedown:handleKeyUpOnTextInput},\r\n    hasFocus:textFocus" /> \r\n        <i class="icon-arrow pull-right"></i>\r\n        <!--disable:(!editable() || disabled() || multiple())<span class="mi-selected-value-text pull-left" data-bind="text:selectedValueText()"></span> <span class="fa fa-angle-down pull-right"></span>-->\r\n    </div>\r\n\r\n</div>';});


define('text!ui/elements/select/options-template.html',[],function () { return '<div data-bind="visible:isOpen(),event:{mousedown:$root.handleMouseDown}" class="mi-select-options-container">\r\n\r\n    <p class="mi-select-caption" data-bind="visible:optionsCaption() && optionsCaption().trim(),text:optionsCaption,event:{\r\n                                    click:function(data,event){selectValue($root,null,event);}},\r\n                                    css:{\'mi-select-option\':optionsCaption}\r\n                                "></p>\r\n\r\n    <!-- ko ifnot:optionsGroup -->\r\n    <!-- ko foreach:filteredOptions -->\r\n    <p class="mi-select-option" data-bind="html:$parent.wrapOptionText($data),event:{\r\n                                                    click:function(data,event){$parent.selectValue($parent,data,event);}},\r\n                                                    css:{\'active\':$parent.isActive($data)},\r\n                                                    attr:{\'data-index\':$index()}">\r\n    </p>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- ko if:optionsGroup -->\r\n    <!-- ko foreach:Object.keys(filteredOptions()) -->\r\n\r\n    <strong class="mi-select-group-title" data-bind="text:$data,visible:$data !== \'undefined\',click:$root.handleMouseDown"></strong>\r\n    <!-- ko foreach:$root.filteredOptions()[$data] -->\r\n    <p class="mi-select-option" data-bind="html:$root.wrapOptionText($data),event:{\r\n                                                                            click:function(data,event){$root.selectValue($root,data,event);}},\r\n                                                                            css:{\'active\':$root.isActive($data)},\r\n                                                                            attr:{\'data-index\':$index()}">\r\n    </p>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</div>\r\n';});

define('system/knockout/bindings/halt-bindings',['require','knockout'],function(require){"use strict";var a=require("knockout");a.bindingHandlers["halt-bindings"]||(a.bindingHandlers["halt-bindings"]={init:function(){return{controlsDescendantBindings:!0}}});function b(a){return Element.build("div",a,null,{"data-bind":"halt-bindings: true"})}return{createElement:b}});
define('ui/elements/select/mi-property',['require','lodash','jquery','knockout'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d="property-changed-event-handlers",e=1;if(!c.bindingHandlers.miproperty){c.bindingHandlers.miproperty={init:function(e,f){var h,i=b(e),j={},k=g(f());a.each(k,function(b,c){h=function(b,d){var e=f()[c];a.isFunction(e)&&e(d)},j[c]=h,i.on("attributes."+c+":changed",h),i.on("properties."+c+":changed",h)}),c.utils.domData.set(e,d,j),c.utils.domNodeDisposal.addDisposeCallback(e,function(){var b=c.utils.domData.get(e,d);a.each(f(),function(a,c){i.off("attributes."+c+":changed",b[c]),i.off("properties."+c+":changed",b[c])})})},update:function(d,h){var i,j=g(h());f(d,!1),a.each(j,function(f,g){i=c.unwrap(f),"object"==typeof i&&!a.isEqual(b(d).data(g.toLowerCase()),i)||""===i?(b(d).data(g.toLowerCase(),i),b(d).attr("data-"+g.toLowerCase(),e),e++):(b(d).data(g.toLowerCase(),i),b(d).attr("data-"+g.toLowerCase(),i))}),f(d,!0)}};var f=function(a,d){if(b(a).find(".mi-select-container")[0]){
var e=c.contextFor(b(a).find(".mi-select-container")[0]).$data;e.propertiesUpdateDone&&e.propertiesUpdateDone(d)}},g=function(a){for(var b={},c=["addCaption","multiple","editable","value","selectedOptions","optionsCaption","optionsText","optionsValue","optionsGroup","disabled","required","options"],d=0;d<c.length;d++)void 0!==a[c[d]]&&(b[c[d]]=a[c[d]]);return b}}});
define('ui/elements/select/element',['require','lodash','jquery','jquery','knockout','system/lang/converter','system/knockout/knockout-manager','system/knockout/bindings/halt-bindings','./mi-property'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("jquery"),d=require("knockout"),e=require("system/lang/converter"),f=require("system/knockout/knockout-manager");require("system/knockout/bindings/halt-bindings"),require("./mi-property");function g(a,b){var c=Object.create(HTMLElement.prototype);c.createdCallback=function(){this.implementation=Object.resolve(b,this),this.implementation.element=this,Object.tryMethod(this.implementation,"created")},c.attachedCallback=function(){this.implementation&&Object.tryMethod(this.implementation,"attached")},c.detachedCallback=function(){this.implementation&&(Object.tryMethod(this.implementation,"detached"),this.implementation=null)},c.attributeChangedCallback=function(a,b,c){Object.tryMethod(this.implementation,a.toLowerCase()+"Changed",b,c)},c.getControl=function(){return this.implementation},Element.registerElement(a,{prototype:c})}var h=function(){function a(a,b,c){this.kom=Object.resolve(f),
this.properties=[],this.view=a,this.preserveContext=b||!1,this.appendAfterBindings=c||!1,this.container=null,this.element=null,this.state=null}a.prototype.created=function(){Object.tryMethod(this,"beforeCreated"),c(this),Object.tryMethod(this,"afterCreated")},a.prototype.attached=function(){Object.tryMethod(this,"beforeAttached"),e(this),Object.tryMethod(this,"afterAttached")},a.prototype.detached=function(){Object.tryMethod(this,"beforeDetached"),g(this),Object.tryMethod(this,"afterDetached"),this.kom.dispose(),this.kom=null,this.properties=null,this.view=null,this.preserveContext=null,this.appendAfterBindings=null,this.state=null,this.container=null},a.prototype.bindAttribute=function(a,c,d,e){var f=e||!1;this["data-"+a.toLowerCase()+"Changed"]=function(c,d){var e=b(this.element).data(a.toLowerCase());this[a]&&this[a](e)}.bind(this),this.kom.subscribe(this[a],function(c){f||b(this.element).trigger("attributes."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),
void 0===b(this.element).attr("data-"+a.toLowerCase())?this.element.setAttribute("data-"+a.toLowerCase(),c):this[a](b(this.element).data(a.toLowerCase()))},a.prototype.bindProperty=function(a,c,d,e){this[a]=this.kom.observable();var f=e||!1;Object.defineProperty(this.element,a,{get:function(){return this[a]()}.bind(this),set:function(b){this[a]&&this[a](b)}.bind(this)}),this.properties.push(a),this.kom.subscribe(this[a],function(c){f||b(this.element).trigger("properties."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),this[a](Object.defaultValue(this.element[a],c))},a.prototype.bindArrayProperty=function(a,c,d,e){this[a]=this.kom.observableArray();var f=e||!1;Object.defineProperty(this.element,a,{get:function(){return this[a]()}.bind(this),set:function(b){this[a](b)}.bind(this)}),this.properties.push(a),this.kom.subscribe(this[a],function(c){f||b(this.element).trigger("properties."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),
this[a](Object.defaultValue(this.element[a],c))};function c(a){a.state="created";var c=document.createElement("div"),d=b(c),e=b(a.view);a.preserveContext||d.attr("data-bind","halt-bindings"),d.append(e),a.appendAfterBindings||b(a.element).empty().append(d),a.container=c}function e(a){if("detached"===a.state){var c=document.createElement("div"),e=b(c),f=b(a.view);a.preserveContext||e.attr("data-bind","halt-bindings"),e.append(f),a.appendAfterBindings||b(a.element).empty().append(e),a.container=c}a.state="attached",d.applyBindingsToDescendants(a,a.container),a.appendAfterBindings&&b(a.element).empty().append(a.container)}function g(a){a.state="detached",d.cleanNode(a.container),b(a.container).remove()}function h(a,b){delete a[b]}return a}();function i(b,d){window.CustomElements&&(window.CustomElements.useNative||(a.isArray(b)?j(b,d):a.isString(b)?k(b,d):b instanceof c?l(b):m(b)))}function j(a,b){for(var c=0;c!==a.length;c++)i(a[c],b)}function k(a,c){c&&c.$element&&(c=c.$element),
l(b(a,c))}function l(a){a.each(function(a,b){m(b)})}function m(a){window.CustomElements.upgrade(a)}function n(b,c,d,e){var f,g=document.createElement(b);if(c&&c.appendChild(g),d)for(f=0;f!==d.length;f++)g.classList.add(d[f]);return e&&a.each(e,function(a,b){e.hasOwnProperty(b)&&g.setAttribute(b,a)}),g}function o(a,b,c){var d=a.getAttribute(b);return d?e.toBoolean(d,"true"):c}function p(a,b,c){var d=a.getAttribute(b);return d?e.toInteger(d):c}function q(a,b,c){var d=a.getAttribute(b);return d?e.toString(d):c}function r(a){for(;a.firstChild;)a.removeChild(a.firstChild)}return{register:g,ViewModel:h,upgrade:i,build:n,booleanAttribute:o,intAttribute:p,stringAttribute:q,clearDom:r}});
define('ui/elements/select/view-model',['require','lodash','jquery','text!./template.html','text!./options-template.html','knockout','spa/region','./element','system/hardware/device','system/lang/string','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./template.html"),d=require("text!./options-template.html"),e=require("knockout"),f=require("spa/region"),g=require("./element"),h=Object.resolve(require("system/hardware/device"));require("system/lang/string"),require("system/lang/object");function i(a){j.call(this,c,!1,!1);var b=this;this.element=a,this.isOpen=null,this.selectedItem=null,this.text=null,this.showAllOptions=null,this.textFocus=null,this.keyPressed=null,this.optionsValue=null,this.optionsText=null,this.optionsGroup=null,this.multiple=null,this.optionsCaption=null,this.options=null,this.value=null,this.required=null,this.disabled=null,this.editable=null,this.selectedOptions=null,this.isRequired=null,this.currentText=null,this.currentMatchedOptions=null,this._selectedOptions=[],this.updated_selectedOptions=!1,this.propertiesUpdateDone=!0,this.selectedValueText=null,this.filteredOptions=null,this.isMobile=h.isMobile(),
this.optionsRegion=new f("","blah"),b.optionsContainerDiv=null,this.isClicked=!1,this.documentHandlerFn=w.bind(null,b),this.isRequiredSubscriber=null,this.filteredOptionsSubscriber=null}var j=Object.inherit(g.ViewModel,i);function k(b){if(!b.options)return[];var c=[].concat(b.options()),d=b.text(),f=[],g=b.optionsGroup(),h=c,i=[],j,k=b.optionsCaption(),n,o;if(c&&c.length)if(i=m(b,h,d),j=k!==d,!b.showAllOptions()&&("object"!=typeof b.options()[0]||b.optionsText())&&b.text()&&"object"!=typeof b.text()&&j&&b.keyPressed()&&(d=l(d),n=new RegExp(d.trim(),"i"),o=e.utils.arrayFilter(c,function(a){var c=b.getOptionText(a);return n.test(c)}),(!i||i&&o.length>1)&&(h=o.length?o:c)),"object"==typeof h[0]&&g){var p=a.groupBy(h,g),q={undefined:[]};f=p?p:q}else f=h;return f}function l(a){return a=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}i.prototype.beforeAttached=function(){var c=this;this.init(),b(document).off("mousedown",this.documentHandlerFn).on("mousedown",this.documentHandlerFn),
this.bindAttribute("multiple",!1,C.bind(null,this),!0),this.bindAttribute("editable",!0,null,!0),this.bindAttribute("value",null,D.bind(null,this),!0),this.bindAttribute("selectedOptions",[],E.bind(null,this),!0),this.bindAttribute("optionsCaption",null,null,!0),this.bindAttribute("optionsText",null,null,!0),this.bindAttribute("optionsValue",null,null,!0),this.bindAttribute("optionsGroup",null,null,!0),this.bindAttribute("disabled",!1,q.bind(null,c),!0),this.bindAttribute("required",!1,null,!0),this.bindAttribute("options",[],B.bind(null,c),!0),this.resizeProxy=b.proxy(a.debounce(this.resize,100),this),this.scrollProxy=b.proxy(this.resize,this)},i.prototype.init=function a(){var b=this;this.isOpen=e.observable(!1),this.keyPressed=e.observable(),this.selectedItem=e.observable(),this.text=e.observable(),this.showAllOptions=e.observable(!1),this.textFocus=e.observable(),this.optionsValue=e.observable(),this.optionsText=e.observable(),this.optionsGroup=e.observable(),
this.multiple=e.observable(!1),this.optionsCaption=e.observable(""),this.options=e.observableArray([]),this.value=e.observable(),this.required=e.observable(!1),this.disabled=e.observable(!1),this.editable=e.observable(!0),this.selectedOptions=e.observableArray([]),this.propertiesUpdateDone=e.observable(!0),this.isRequired=e.computed(o.bind(b,b)),this.isRequiredSubscriber=this.isRequired.subscribe(r.bind(b,b)),this.selectedValueText=e.computed(y.bind(null,this)),this.filteredOptions=e.computed(k.bind(null,this)),this.filteredOptionsSubscriber=this.filteredOptions.subscribe(p.bind(b,b))};function m(b,c,d){return d!==b.currentText&&(b.currentText=d,b.currentMatchedOptions=a.find(c,n.bind(b,b,d))),b.currentMatchedOptions}function n(a,b,c){var d=a.getOptionText(c);return d&&d.toString()===b.toString()}function o(a){return a.required()&&!a.hasValue()}function p(a,b){a.setOptionContainerPosition.bind(null,a)(b),M.bind(null,a)(b)}function q(a,c){
c?b(a.element).addClass("mi-select-disabled"):b(a.element).removeClass("mi-select-disabled")}function r(a,c){a.isRequired()?b(a.element).addClass("mi-select-required"):b(a.element).removeClass("mi-select-required")}i.prototype.afterAttached=function(){var a=this},i.prototype.afterDetached=function(){this.isOpen(!1),b(this.optionsContainerDiv).remove(),this.isOpen=null,this.selectedItem=null,this.text=null,this.showAllOptions=null,this.textFocus=null,this.optionsValue=null,this.optionsText=null,this.optionsGroup=null,this.multiple=null,this.optionsCaption=null,this.options=null,this.value=null,this.required=null,this.disabled=null,this.editable=null,this.selectedOptions=null,this.isRequired=null,this.keyPressed=null,this.selectedValueText=null,this.filteredOptions=null,b(document).off("mousedown",this.documentHandlerFn),this.isRequiredSubscriber&&this.isRequiredSubscriber.dispose(),this.filteredOptionsSubscriber&&this.filteredOptionsSubscriber.dispose()},
i.prototype.selectValue=function(c,d,e){if(e&&(e.preventDefault(),e.stopPropagation()),c.disabled())return!1;if(c.multiple()){if(c.multiple()){if(!d)return!0;var f=c.selectedOptions(),g=f||[],h=c.getOptionValue(d);b.inArray(h,c.selectedOptions())===-1?(c._selectedOptions.push(d),g.push(h)):(c._selectedOptions=b.grep(c._selectedOptions,function(a){return c.getOptionValue(a)!==h}),g=b.grep(g,function(a){return a!==h})),c.updated_selectedOptions=!0,c.selectedOptions(g),b(c.element).trigger("properties.selectedOptions:changed",[g]),c.textFocus(!0)}}else{var i;if(c.selectedItem(d),a.isEqual(d,c.value()))y(c);else{if(d){var j=c.getOptionValue(d);return i=j,c.isOpen(!1),u(c),c.value&&c.value(j),b(c.element).trigger("properties.value:changed",[i]),b(c.element).trigger("selected",[c.value?c.value():c.value]),!0}c.value("");var k=c.optionsCaption()?c.optionsCaption():"";c.text(k),i="",b(c.element).trigger("properties.value:changed",[i])}c.textFocus(!0),c.isOpen(!1),u(c),
b(c.element).trigger("selected",[c.value()])}return!0},i.prototype.toggleSelectAll=function(a,c){var d=this;if(d.disabled())return!0;if(d.selectedOptions().length||d.selectedOptions().length===d.options().length)d._selectedOptions=[],d.updated_selectedOptions=!0,d.selectedOptions([]),b(d.element).trigger("properties.selectedOptions:changed",[[]]);else if(!d.selectedOptions().length){var e=s(d.options(),d.getOptionValue.bind(d));d._selectedOptions=d.options(),d.updated_selectedOptions=!0,d.selectedOptions(e),b(d.element).trigger("properties.selectedOptions:changed",[e])}return!0};function s(a,b){var c=[],d;for(d=0;d<a.length;d++)c.push(b(a[d]));return c}i.prototype.toggleOptions=function(a,c){c.stopPropagation();var d=this;return!(d.disabled()||d.options()&&!d.options().length)&&(d.isClicked=!0,b(document).trigger("mousedown",[d.element]),this.showAllOptions(!0),d.isOpen()?(u(d),b(d.element).trigger("selected",[d.multiple()?d.selectedOptions():d.value()])):(F(d),t(d)),
d.isOpen()||b(d.optionsContainerDiv).css("visibility","hidden"),d.textFocus()||d.textFocus(!0),d.isOpen(!d.isOpen()),!0)};function t(a){b(a.element).parents().on("scroll",a.scrollProxy)}function u(a){b(a.optionsContainerDiv).css("visibility","hidden"),b(a.element).parents().off("scroll",a.scrollProxy),L(a)}i.prototype.showOptions=function(a){var c=this;this.showAllOptions(c.multiple()),this.isOpen()||13===a.keyCode||c.disabled()||(b(c.optionsContainerDiv).css("visibility","hidden"),c.isClicked=!0,b(document).trigger("mousedown",[c.element]),this.isOpen(!0),F(this),t(c))},i.prototype.handleMouseDown=function a(b,c){return c.stopPropagation(),!0},i.prototype.handleKeyUpOnTextInput=function a(b,c){return c.stopPropagation(),this.isOpen()||this.keyPressed(!1),"keyup"===c.type&&this.keyPressed(!0),this.showOptions(c),!0},i.prototype.handleKeyDownOnTextInput=function a(c,d){var e=this,f;if(d.stopPropagation(),b(e.element).trigger("textChange",[d]),9===d.keyCode)e.isOpen(!1),u(e),f=!e.text(),
y(e),b(e.element).trigger("selected",[e.multiple()?e.selectedOptions():e.value()]),x(e,f);else{if(8===d.keyCode&&(e.multiple()||e.disabled()))return!1;this.showAllOptions(e.multiple()),J.bind(null,e)(d)}return!0},i.prototype.getValue=function(a){return"function"==typeof a?a():a},i.prototype.getReturnValue=function(a,b){return"function"==typeof a?b?a.call(b,b):b:b?b[a]:b},i.prototype.getOptionText=function(a){var b=this;return a&&b.optionsText()?b.getValue(b.getReturnValue(b.optionsText(),a)):a},i.prototype.getOptionValue=function(a){var b=this;return a&&b.optionsValue()?b.getValue(b.getReturnValue(b.optionsValue(),a)):a},i.prototype.hasValue=function(){var a=this;if(a.multiple()){if(a.selectedOptions()&&0===a.selectedOptions().length)return!1}else if(!a.value())return!1;return!0},i.prototype.isActive=function(c){var d=this
;return d.multiple()?b.inArray(d.getOptionValue(c),d.selectedOptions())!==-1:"object"!=typeof d.value()||d.optionsValue()?d.getOptionValue(c)===d.value():a.isEqual(c,d.value())},i.prototype.resize=function(){this.isOpen(!1),v(this)},i.prototype.wrapOptionText=function(a){var b=this,c=b.getOptionText(a),d=b.text(),e,f=c,g=b.options(),h;return h=m(b,g,d),c&&d&&d.trim()&&!h&&(d=l(d),e=new RegExp(d,"gi"),c&&"string"==typeof c&&(c=R(c)),f=c.replace(e,function(a){return"<b>"+a+"</b>"}),f=f.replace(/ /g,"&nbsp;")),f&&"string"==typeof f&&(f=R(f)),f},i.prototype.setFocus=function b(){var c=this;a.defer(c.showOptions.bind(c,{}))};function v(a){u(a)}function w(a,c){var d;a.isClicked?a.isClicked=!1:(a.isOpen&&a.isOpen()&&(a.isOpen(!1),u(a),b(a.element).trigger("selected",[a.multiple()?a.selectedOptions():a.value()]),d=!a.text()),y(a),x(a,d))}function x(a,c){
if(c)if(a.multiple()||null!==a.optionsCaption()&&""!==a.optionsCaption()||!a.options()||!a.options().length)!a.multiple()&&a.options()&&a.options().length&&(a.value(""),b(a.element).trigger("properties.value:changed",[""]));else{var d=a.getOptionValue(a.options()[0]);a.value(d),b(a.element).trigger("properties.value:changed",[d])}}function y(a,c){if(a.options){var d=null,e=a.options(),f=null,g=null,h="";if(!a.multiple()&&(null===a.optionsCaption()||""===a.optionsCaption())&&!a.value()&&a.options()&&e.length&&a.propertiesUpdateDone()){var i=a.getOptionValue(e[0]);a.value(i),b(a.element).trigger("properties.value:changed",[i])}if(a.multiple()){if(a.options()&&e.length&&a.selectedOptions()&&a.selectedOptions().length){var j=a.selectedOptions(),k="",l;return k=s(a._selectedOptions,a.getOptionText.bind(a)).join(" | "),h=k,a.text(h),h}}else if((null!==a.value()||""!==a.value())&&a.options()&&e.length){for(var m=0;m<e.length;m++)if(g=A(a,e[m],a.value())){d=g;break}
if(d)return h=a.getOptionText(d),a.text(h),h}return h=a.optionsCaption()||"",a.text(h),h}}function z(a,b,c){for(var d=[],e,f=0;f<c.length;f++){var g=c[f];if(null!==g)for(var h=0;h<b.length;h++)if(e=A(a,b[h],g)){d.push(e);break}}return d}function A(b,c,d){var e=b.getOptionValue(c),f=null;return void 0===d||null===d||void 0===e||null===e?f:("function"==typeof d.numericValue&&null!==d.numericValue()&&(d=d.numericValue()),b.optionsValue()?e.toString()===d.toString()&&(f=c):c===d.toString()?f=c:"object"==typeof d&&a.isEqual(d,c)&&(f=c),f)}function B(a,b){b.length||(a.value,a.selectedOptions&&a.selectedOptions([])),a.multiple()&&a.selectedOptions&&(a.updated_selectedOptions||(a._selectedOptions=z(a,b,a.selectedOptions()),y(a)),a.updated_selectedOptions=!1)}function C(a){}function D(a,c){null!==c&&b(a.element).trigger("valueChange",[c])}function E(a,c){if(a.multiple()){var d=a.options();a.updated_selectedOptions||(a._selectedOptions=z(a,d,c)),a.updated_selectedOptions=!1,
b(a.element).trigger("valueChange",[c])}}function F(a){a.optionsCaption()===a.text()&&a.text(""),G(a),a.setOptionContainerPosition(a),setTimeout(function(a){if("function"==typeof a.options&&"function"==typeof a.text){var c=m(a,a.options(),a.text());a.text()&&a.optionsCaption()!==a.text()&&c&&!a.isMobile&&b(a.element).find(".mi-selected-value-text").select()}}.bind(a,a),100)}function G(a){var c,f;b("body").find(".select-outer-container").length?c=b("body").find(".select-outer-container"):(c=document.createElement("div"),b(c).addClass("select-outer-container"),document.body.appendChild(c)),a.optionsContainerDiv||(f=document.createElement("div"),a.optionsContainerDiv=f,b(f).css("visibility","hidden"),b(c).append(f),a.optionsRegion.setElement(f),a.optionsRegion.attach(d),e.applyBindings(a,a.optionsRegion.activeContainer))}i.prototype.setOptionContainerPosition=function(a){var c,d,e,f,g,h,i,j=a.optionsContainerDiv;if(j){if(e=b(a.element).outerHeight(),
c=b(a.container).find(".mi-dropdown-selector").offset(),d=b(a.container).find(".mi-dropdown-selector").width(),!c)return;a.topOffset=c?c.top:0,a.leftOffset=c?c.left:0,b(j).css({position:"absolute","min-width":d,"z-index":1e5}),b(a.element).closest(".dialog-wrapper").length>0&&b(j).css({"max-width":d}),setTimeout(H.bind(null,a,j,c,d,e),1)}};function H(a,c,d,e,f){var g=b(c).outerWidth(),i=b(c).outerHeight(),j,k,l=b(c).find(".mi-select-options-container");l.removeClass("top-left top-right bottom-left bottom-right"),!a.isMobile&&h.innerHeight()<700&&b(".select-outer-container .mi-select-options-container").css("max-height","200px"),d.top+i+50>=b(window).height()?(j=d.top-i-20,d.left+e-g<80?(k=d.left,l.addClass("top-left")):(k=d.left-Math.abs(e-g),l.addClass("top-right"))):(j=a.topOffset+f+10,d.left+e-g<80?(k=d.left,l.addClass("bottom-left")):(k=d.left-Math.abs(e-g)+7,l.addClass("bottom-right"))),b(c).css({left:k,top:j,visibility:"visible"}),
b(c).find(".mi-select-option").hasClass("focus")||!a.multiple||a.multiple()||Q(a,"active")}function I(a){}function J(a,b){switch(b.keyCode){case 40:b.preventDefault(),O(a,b);break;case 38:b.preventDefault(),P(a,b);break;case 13:b.preventDefault(),K(a,b);break;default:return}}function K(a,c){var d=a.optionsContainerDiv,f=b(d).find(".mi-select-option.focus");if(f.length&&e.contextFor(b(f[0]).get(0))){var g=e.contextFor(b(f[0]).get(0)).$data;b(f[0]).hasClass("mi-select-caption")&&(g=null),a.selectValue(a,g,c),a.multiple()||(a.isOpen(!1),v(a),b(a.element).trigger("selected",[a.value()]),a.textFocus(!0))}}function L(a){var c=a.optionsContainerDiv;b(c).find(".mi-select-option").removeClass("focus")}function M(a){setTimeout(N.bind(null,a),10)}function N(a){if(!a.options||a.multiple&&a.multiple()||a.isOpen&&!a.isOpen())return!1;var c=a.options(),d=a.text(),e=!1,f=a.optionsContainerDiv;if(c&&c.length&&(e=m(a,c,d)),!e&&d&&d!==a.optionsCaption()){L(a);var g=a.optionsCaption()?1:0
;b(b(f).find(".mi-select-option")[g]).addClass("focus"),Q(a)}else e&&d&&d!==a.optionsCaption()&&(L(a),b(b(f).find(".mi-select-option")).filter(function(){return b(this).text()===d}).addClass("focus"),Q(a));!d&&a.value()&&(L(a),a.value()&&Q(a,"active"))}function O(a){var c=a.optionsContainerDiv,d=b(c).find(".mi-select-option.focus"),e=b(c).find(".mi-select-option.active"),f;b(c).find(".mi-select-option").removeClass("focus"),f=d.length&&b(d).nextAll(".mi-select-option:first").length?b(d).nextAll(".mi-select-option:first"):d.length&&!b(d).nextAll(".mi-select-option:first").length?b(b(c).find(".mi-select-option")[0]):e.length?b(e).nextAll(".mi-select-option:first"):b(b(c).find(".mi-select-option")[0]),f.addClass("focus");var g=a.options(),h=a.text(),i;g&&g.length&&((i=m(a,g,h))||a.optionsCaption()&&a.optionsCaption()===h)&&a.text(f.text()),Q(a)}function P(a){var c=a.optionsContainerDiv,d=b(c).find(".mi-select-option.focus"),e=b(c).find(".mi-select-option.active"),f
;b(c).find(".mi-select-option").removeClass("focus"),f=d.length&&b(d).prevAll(".mi-select-option:first").length?b(d).prevAll(".mi-select-option:first"):d.length&&!b(d).prevAll(".mi-select-option:first").length?b(c).find(".mi-select-option").last():e.length?b(e).prevAll(".mi-select-option:first"):b(b(c).find(".mi-select-option")[0]),f.addClass("focus");var g=a.options(),h=a.text(),i;g&&g.length&&((i=m(a,g,h))||a.optionsCaption()&&a.optionsCaption()===h)&&a.text(f.text()),Q(a)}function Q(a,c){var d=a.optionsContainerDiv,e=c||"focus",f=b(d).find(".mi-select-option."+e);f&&f[0]&&(f[0].parentNode.scrollTop=f[0].offsetTop)}function R(a){return a.replace(/<([a-z]+)([^>]*[^\/])?>(?![\s\S]*<\/\1)/gi,function(a){return b("<div/>").text(a).html()})}return g.register("mi-select",i),i});

define('text!ui/elements/multi-value/template.html',[],function () { return '<div class="mi-multi-value-container" data-bind="visible:visible,css:{\'disabled\':disabled,\'open\':isOpen,\'required\':isRequired}">\r\n    <div data-bind="css:{\'active\':isOpen},clickBubble: false, hasFocus:textFocus, event:{\r\n            keyup: handleKeyUpOnTextInput,\r\n            keydown:handleKeyDownOnTextInput,\r\n            click:handleKeyUpOnTextInput,\r\n            mousedown:handleKeyUpOnTextInput\r\n         }" class="mi-multi-value-selector">\r\n        <input type="text" class="mi-multi-value-selected-value-text pull-left" data-bind="value:text,\r\n                                                                                            valueUpdate:\'keyup\',\r\n             \r\n                                                                                            attr:{\'readonly\':(disabled() || multiple() || isMobile),\r\n                                                                                                   \'disabled\':disabled()},\r\n                                                                                            event:{keyup: handleKeyUpOnTextInput}" />\r\n        <!--<span class="mi-multi-value-selected-value-text pull-left" data-bind="text:selectedValueText"></span>-->\r\n        <i class="icon-arrow pull-right"></i>\r\n    </div>\r\n</div>';});


define('text!ui/elements/multi-value/options-template.html',[],function () { return '<div data-bind="visible:isOpen(),event:{mousedown:function(data,event){event.stopPropagation();}}" class="mi-multi-value-options-container">\r\n    <p class="mi-multi-value-option mi-multi-value-input" data-bind="event:{mousedown:inputMouseDown}">\r\n        <input type="text" data-bind="attr:{ placeholder: addCaptionText}, value:addValue,event:{\'keydown\':addValueUpdate}" />\r\n    </p>\r\n\r\n   <!-- ko if:optionsCaption -->\r\n    <p class="mi-multi-value-option mi-multi-value-caption" data-bind="text:optionsCaption,\r\n                                                                       event:{click:function(data,event){$root.selectValue($root,null,event);}}"></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko foreach:filteredOptions -->\r\n    <p class="mi-multi-value-option" data-bind="text:$parent.getOptionText($data),\r\n                                            event:{click:function(data,event){$root.selectValue($root,data,event);}},\r\n                                            css:{\'active\':$parent.isActive($data)}">\r\n\r\n    </p>\r\n    <!-- /ko -->\r\n     \r\n   \r\n\r\n  \r\n\r\n</div>\r\n';});

define('ui/elements/multi-value/view-model',['require','lodash','jquery','text!./template.html','text!./options-template.html','knockout','spa/region','system/globalization/translator','../select/element','system/hardware/device'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./template.html"),d=require("text!./options-template.html"),e=require("knockout"),f=require("spa/region"),g=require("system/globalization/translator"),h=require("../select/element"),i=Object.resolve(require("system/hardware/device"));function j(){k.call(this,c,!1,!0);var a=this;this.translator=Object.resolve(g),this.optionsValue=e.observable(),this.optionsText=e.observable(),this.multiple=e.observable(!1),this.optionsCaption=e.observable(""),this.options=e.observableArray([]),this.value=e.observable(),this.required=e.observable(!1),this.disabled=e.observable(!1),this.visible=e.observable(!0),this.selectedOptions=e.observableArray([]),this.autoAdd=e.observable(!0),this.onOptionAdd=e.observable(),this.addCaption=e.observable(this.translator.translate("MULTI_VALUE_ADD_OPTION_PLACEHOLDER")),this.text=e.observable(),this.textFocus=e.observable(!1),this.keyPressed=e.observable(!1),
this.currentText=null,this.isOpen=e.observable(!1),this.selectedItem=e.observable(),this.addValue=e.observable(),this.optionsRegion=new f,this.isClicked=!1,this.isMobile=i.isMobile(),this.isRequired=e.computed(p.bind(a,a)),this.isRequiredSubscriber=this.isRequired.subscribe(q.bind(a,a)),this.addCaptionText=e.computed(o.bind(null,this)),this.selectedValueText=e.computed(u.bind(null,this)),this.filteredOptions=e.computed(l.bind(null,this)),this.addValueUpdate=r,this.addValueSubscription=this.addValue.subscribe(a.addOption,this),this.documentHandlerFn=s.bind(null,a),this.filteredOptionsSubscriber=null}var k=Object.inherit(h.ViewModel,j);j.prototype.beforeAttached=function(){var a=this;this.filteredOptionsSubscriber=this.filteredOptions.subscribe(n.bind(a,a)),b(document).on("mousedown",this.documentHandlerFn)},j.prototype.afterDetached=function(){var a=this;b(window).off("resize",a.resizeProxy),b(a.element).parents().off("scroll",a.scrollProxy),b(a.element).off(),
b(document).off("mousedown",a.documentHandlerFn),a.translator=null,a.optionsValue=null,a.optionsText=null,a.multiple=null,a.optionsCaption=null,a.options=null,a.value=null,a.required=null,a.disabled=null,a.visible=null,a.selectedOptions=null,a.autoAdd=null,a.onOptionAdd=null,a.addCaption=null,a.text=null,a.textFocus=null,a.keyPressed=null,a.currentText=null,a.isOpen=null,a.selectedItem=null,a.addValue=null,a.optionsRegion&&(a.optionsRegion.detach(),a.optionsRegion=null),a.isClicked=null,a.isMobile=null,a.isRequired&&(a.isRequired.dispose(),a.isRequired=null),a.isRequiredSubscriber&&(a.isRequiredSubscriber.dispose(),a.isRequiredSubscriber=null),a.addCaptionText&&(a.addCaptionText.dispose(),a.addCaptionText=null),a.selectedValueText&&(a.selectedValueText.dispose(),a.selectedValueText=null),a.filteredOptions&&(a.filteredOptions.dispose(),a.filteredOptions=null),a.addValueUpdate=null,a.addValueSubscription&&(a.addValueSubscription.dispose(),a.addValueSubscription=null),
a.documentHandlerFn=null,a.filteredOptionsSubscriber&&(a.filteredOptionsSubscriber.dispose(),a.filteredOptionsSubscriber=null),a.resizeProxy=null,a.scrollProxy=null,a.optionsContainerDiv=null},j.prototype.inputMouseDown=function(a,b){b.stopPropagation(),b.target.focus()};function l(a){if(!a.options)return[];var b=[].concat(a.options()),c=a.text(),d=[],f=b,g=[],h,i=a.optionsCaption(),j,k;return b&&b.length?(g=F(a,f,c),h=i!==c,a.text()&&h&&a.keyPressed()&&(c=m(c),j=new RegExp(c.trim(),"i"),k=e.utils.arrayFilter(b,function(b){var c=a.getOptionText(b);return j.test(c)}),(!g||g&&k.length>1)&&(f=k.length?k:b)),d=null!==f?f:b):void 0}function m(a){return null!==a&&(a=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")),a}function n(a,b){a.setOptionContainerPosition.bind(null,a)()}function o(a){return a.addCaption()||a.translator.translate("MULTI_VALUE_ADD_OPTION_PLACEHOLDER")}function p(a){return a.required()&&!a.hasValue()}function q(a,c){
a.isRequired()?b(a.element).addClass("mi-multi-value-required"):b(a.element).removeClass("mi-multi-value-required")}j.prototype.hasValue=function a(){var b=this;if(b.multiple()){if(b.selectedOptions()&&b.selectedOptions().length)return!1}else if(!b.value())return!1;return!0},j.prototype.addOption=function a(c){var d=c,e=this;if(c){if(("object"==typeof e.options()[0]||e.optionsText())&&(d={},d[e.optionsText()]=c,d[e.optionsValue()]=c),e.onOptionAdd(d),e.options.push(d),e.multiple()){if(e.multiple()){var f=e.selectedOptions();f.push(e.getOptionValue(d)),e.text(f),e.selectedOptions(f),b(e.element).trigger("properties.selectedOptions:changed",[e.selectedOptions()])}}else e.selectedItem(d),e.value(e.getOptionValue(d)),b(e.element).trigger("properties.value:changed",[e.value()]);e.addValue("")}};function r(a,b){switch(b.keyCode){case 13:b.target.blur(),b.target.focus();break;case 9:a.toggleOptions();break;case 40:b.preventDefault(),P(a,b,!0);break;case 38:b.preventDefault(),Q(a,b)}return!0}
function s(a){a.isClicked?a.isClicked=!1:(a.isOpen()&&(a.isOpen(!1),E(a),b(a.element).trigger("selected",[a.multiple()?a.selectedOptions():a.value()])),u(a))}j.prototype.afterAttached=function(){},j.prototype.afterCreated=function(){},j.prototype.beforeCreated=function(){var c=this;this.bindAttribute("optionsText",null),this.bindAttribute("optionsValue",null),this.bindAttribute("optionsCaption",null),this.bindAttribute("addCaption",null),this.bindAttribute("options",[],w.bind(null,this),!0),this.bindAttribute("value",null,z.bind(null,this),!0),this.bindAttribute("selectedOptions",[],null,!0),this.bindAttribute("disabled",!1),this.bindAttribute("required",!1),this.bindAttribute("visible",!0),this.bindAttribute("multiple",!1,x.bind(null,this)),this.bindAttribute("autoAdd",!0),this.bindAttribute("onOptionAdd",null),this.resizeProxy=b.proxy(a.debounce(this.resize.bind(null,this),100),this),this.scrollProxy=b.proxy(this.scrollHandler,this),
b(this.element).on("properties.options:changed",function(a,b){}.bind(this)),b(this.element).on("properties.value:changed",z.bind(null,this)),b(this.element).on("properties.multiple:changed",function(a,b){}.bind(this)),b(this.element).on("properties.size:changed",function(a,b){}.bind(this)),b(this.element).on("properties.selectedOptions:changed",A.bind(null,this))},j.prototype.selectValue=function(c,d,e){if(e&&(e.preventDefault(),e.stopPropagation()),c.disabled())return!1;if(c.multiple()){if(c.multiple()){if(!d)return!0;var f=c.selectedOptions(),g=f||[],h=c.getOptionValue(d);b.inArray(h,c.selectedOptions())===-1?g.push(h):g=b.grep(g,function(a){return a!==h}),c.selectedOptions(g),b(c.element).trigger("properties.selectedOptions:changed",[g]),c.textFocus(!0)}}else{var i;if(c.selectedItem(d),a.isEqual(d,c.value()))u(c);else{if(d){var j=c.getOptionValue(d);return i=j,c.textFocus(!0),c.isOpen(!1),E(c),c.value&&c.value(j),b(c.element).trigger("properties.value:changed",[i]),
b(c.element).trigger("selected",[c.value?c.value():c.value]),!0}c.value("");var k=c.optionsCaption()?c.optionsCaption():"";c.text(k),i="",b(c.element).trigger("properties.value:changed",[i])}c.textFocus(!0),c.isOpen(!1),E(c),b(c.element).trigger("selected",[c.value()])}return!0},j.prototype.toggleOptions=function(a,c){var d=this;return c&&c.stopPropagation(),d.disabled()||d.options()&&!d.options().length?(d.textFocus(!0),E(d),d.isOpen(!1),!1):(d.isClicked=!0,b(document).trigger("mousedown",[d.element]),d.isOpen()?(E(d),b(d.element).trigger("selected",[d.multiple()?d.selectedOptions():d.value()])):(C(d),D(d)),d.isOpen()||b(d.optionsContainerDiv).css("visibility","hidden"),d.textFocus()||d.textFocus(!0),d.isOpen(!d.isOpen()),!0)};function t(a){e.cleanNode(a.optionsRegion.activeContainer),b(".multi-value-outer-container").remove(),b(window).off("resize",a.resizeProxy),b(a.element).parents().off("scroll",a.scrollProxy)}function u(a){if(a.options){var b=null,c=a.options(),d=null,e=null,f=""
;if(a.multiple()){if(c&&a.selectedOptions()&&a.selectedOptions().length){for(var g=a.selectedOptions(),h="",i=0;i<g.length;i++){for(var j=g[i],k=0;k<c.length;k++)if(e=v(a,c[k],j)){b=e;break}var l=h?", ":"";h+=l+a.getOptionText(b)}return a.text(g),h}}else if(a.value()&&c){for(var m=0;m<c.length;m++)if(e=v(a,c[m],a.value())){b=e;break}if(b)return f=a.getOptionText(b),a.text(f),f}return f=a.optionsCaption()||"",a.text(f),f}}function v(b,c,d){var e=b.getOptionValue(c),f=null;return b.optionsValue()?e.valueOf()===d.valueOf()&&(f=c):c.valueOf()===d.valueOf()?f=c:"object"==typeof d&&a.isEqual(d,c)&&(f=c),f}j.prototype.getValue=function(a){var b=a;return"function"==typeof a&&(b=a()),b},j.prototype.getReturnValue=function(a,b){return"function"==typeof a?a.call(b,b):b?b[a]:b},j.prototype.getOptionText=function(a){var b=this;return b.optionsText()?b.getValue(b.getReturnValue(b.optionsText(),a)):a},j.prototype.getOptionValue=function(a){var b=this
;return b.optionsValue()?b.getValue(b.getReturnValue(b.optionsValue(),a)):a},j.prototype.isActive=function(c){var d=this;return d.multiple()?b.inArray(d.getOptionValue(c),d.selectedOptions())!==-1:null===d.getOptionValue(c)||null===d.value()?d.getOptionValue(c)===d.value():"object"!=typeof d.value()||d.optionsValue()?d.getOptionValue(c).valueOf()===d.value().valueOf():a.isEqual(c,d.value())},j.prototype.resize=function(a){a.isMobile||(a.isOpen(!1),t(a))},j.prototype.scrollHandler=function(){this.isOpen(!1),t(this)};function w(){}function x(a){}function y(a){}function z(a,c){b(a.element).trigger("valueChange",[c])}function A(a,b,c){}function B(a){this.option=a,this.isSelected=e.observable(!1)}function C(a){a.optionsRegion.$element.hasClass("multi-value-outer-container")&&a.optionsRegion.$element.remove();var c;c=document.createElement("div"),a.optionsContainerDiv=c,b(c).addClass("multi-value-outer-container"),document.body.appendChild(c),a.optionsRegion.setElement(c),
a.optionsRegion.attach(d),e.applyBindings(a,a.optionsRegion.activeContainer),a.setOptionContainerPosition(a)}j.prototype.setOptionContainerPosition=function(a){var c,d,e=30,f,g,h,i,j=a.optionsContainerDiv;j&&(c=b(a.container).find(".mi-multi-value-selector").offset(),d=b(a.container).find(".mi-multi-value-selector").width(),a.topOffset=c.top,a.leftOffset=c.left,b(j).css({position:"absolute","min-width":d,"z-index":1e5}),setTimeout(function(){f=b(j).width(),g=b(j).height(),b(j).find(".mi-multi-value-options-container").removeClass("top-left top-right bottom-left bottom-right"),c.top+g+50>=b(window).height()?(h=c.top-g-20,c.left+d-f<80?(i=c.left,b(j).find(".mi-multi-value-options-container").addClass("top-left")):(i=c.left-Math.abs(d-f),b(j).find(".mi-multi-value-options-container").addClass("top-right"))):(h=a.topOffset+e+10,c.left+d-f<80?(i=c.left,b(j).find(".mi-multi-value-options-container").addClass("bottom-left")):(i=c.left-Math.abs(d-f),
b(j).find(".mi-multi-value-options-container").addClass("bottom-right"))),b(j).css({left:i,top:h})},1))},j.prototype.showOptions=function a(c){var d=this;this.isOpen()||13===c.keyCode||d.disabled()||(b(d.optionsContainerDiv).css("visibility","hidden"),d.isClicked=!0,b(document).trigger("mousedown",[d.element]),this.isOpen(!0),C(this),D(d))},j.prototype.handleKeyUpOnTextInput=function a(b,c){return c.stopPropagation(),this.isOpen()||this.keyPressed(!1),"keyup"===c.type&&this.keyPressed(!0),this.showOptions(c),!0},j.prototype.handleKeyDownOnTextInput=function a(c,d){var e=this;if(d.stopPropagation(),b(e.element).trigger("textChange",[d]),9===d.keyCode)e.isOpen(!1),E(e),u(e),b(e.element).trigger("selected",[e.multiple()?e.selectedOptions():e.value()]);else{if(8===d.keyCode&&(e.multiple()||e.disabled()))return!1;H.bind(null,e)(d)}return!0};function D(a){b(a.element).parents().on("scroll",a.scrollProxy)}function E(a){b(a.optionsContainerDiv).css("visibility","hidden"),
b(a.element).parents().off("scroll",a.scrollProxy),J(a)}function F(b,c,d){return d!==b.currentText&&(b.currentText=d,b.currentMatchedOptions=a.find(c,G.bind(b,b,d))),b.currentMatchedOptions}function G(a,b,c){var d=a.getOptionText(c);return d&&d.toString()===b.toString()}function H(a,b){switch(b.keyCode){case 40:b.preventDefault(),P(a,b);break;case 38:b.preventDefault(),Q(a,b);break;case 13:b.preventDefault(),I(a,b);break;default:return}}function I(a,c){var d=a.optionsContainerDiv,f=b(d).find(".mi-multi-value-option.focus");if(f.length&&e.contextFor(b(f[0]).get(0))){var g=e.contextFor(b(f[0]).get(0)).$data;if(b(f[0]).hasClass("mi-multi-value-caption"))g=null;else if(K(a,f))return void L(a,f);a.selectValue(a,g,c),a.multiple()||(a.isOpen(!1),E(a),b(a.element).trigger("selected",[a.value()]),a.textFocus(!0))}}function J(a){var c=a.optionsContainerDiv;b(c).find("mi-multi-value-option").removeClass("focus")}function K(a,c){return b(c[0]).hasClass("mi-multi-value-input")}function L(a,c){
b(c[0]).find("input").focus()}function M(a,b){if(K(a,b))return L(a,b),!0;a.textFocus(!0)}function N(a){setTimeout(O.bind(null,a),10)}function O(a){if(!a.options||a.multiple&&a.multiple())return!1;var c=a.options(),d=a.selectedValueText(),e=!1,f=a.optionsContainerDiv;if(c&&c.length&&(e=F(a,c,d)),!e&&d&&d!==a.optionsCaption()){J(a);var g=a.optionsCaption()?1:0;b(b(f).find(".mi-multi-value-option")[g]).addClass("focus"),R(a)}else e&&d&&d!==a.optionsCaption()&&(J(a),b(b(f).find(".mi-multi-value-option")).filter(function(){return b(this).text()===d}).addClass("focus"),R(a));!d&&a.value()&&(J(a),a.value()&&R(a,"active"))}function P(a,c,d){var e=a.optionsContainerDiv,f=b(e).find(".mi-multi-value-option.focus"),g=b(e).find(".mi-multi-value-option.active"),h;b(e).find(".mi-multi-value-option").removeClass("focus"),
h=f.length&&b(f).nextAll(".mi-multi-value-option:first").length?b(f).nextAll(".mi-multi-value-option:first"):f.length&&!b(f).nextAll(".mi-multi-value-option:first").length?b(b(e).find(".mi-multi-value-option")[0]):g.length?b(g).nextAll(".mi-multi-value-option:first"):b(b(e).find(".mi-multi-value-option")[d?1:0]),h.addClass("focus"),M(a,h);var i=a.options(),j=a.selectedValueText(),k;i&&i.length&&((k=F(a,i,j))||a.optionsCaption()&&a.optionsCaption()),R(a)}function Q(a){var c=a.optionsContainerDiv,d=b(c).find(".mi-multi-value-option.focus"),e=b(c).find(".mi-multi-value-option.active"),f;b(c).find(".mi-multi-value-option").removeClass("focus"),f=d.length&&b(d).prevAll(".mi-multi-value-option:first").length?b(d).prevAll(".mi-multi-value-option:first"):d.length&&!b(d).prevAll(".mi-multi-value-option:first").length?b(c).find(".mi-multi-value-option").last():e.length?b(e).prevAll(".mi-multi-value-option:first"):b(b(c).find(".mi-multi-value-option")[0]),f.addClass("focus"),M(a,f)
;var g=a.options(),h=a.selectedValueText(),i;g&&g.length&&((i=F(a,g,h))||a.optionsCaption()&&a.optionsCaption()),R(a)}function R(a,c){var d=a.optionsContainerDiv,e=c||"focus",f=b(d).find(".mi-multi-value-option."+e);f&&f[0]&&(f[0].parentNode.scrollTop=f[0].offsetTop)}function S(a){return a.replace(/<([a-z]+)([^>]*[^\/])?>(?![\s\S]*<\/\1)/gi,function(a){return b("<div/>").text(a).html()})}return h.register("mi-multi-value",j),j});
define('assets/services/hierarchy-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){this.entityKey=a.toString(b.entityKey),this.description=a.toString(b.description),this.familyKey=a.toString(b.familyKey),this.familyId=a.toString(b.familyId),this.siteKey=a.toNullableString(b.siteKey),this.hasChildren=null,b.childCount&&(this.hasChildren=a.toInteger(b.childCount)>0),b.hierarchyPath&&(this.hierarchyPath=a.toString(b.hierarchyPath))}return b.fromDataCollection=function a(c){for(var d=[],e=0;e<c.length;e++)d[d.length]=new b(c[e]);return d},b});
define('assets/services/hierarchy-paging-dto',[],function(){"use strict";function a(a){this.page=a.page||1,this.pageSize=a.per_page||25,this.data=null}return a});
define('assets/services/taxonomy-dto',['require','lodash','system/lang/converter'],function(require){"use strict";var a=require("lodash"),b=require("system/lang/converter");function c(a,c){this.code=b.toString(a),this.description=b.toString(c),this.children=[]}return c.fromDataCollection=function b(d){for(var e=[],f=a.values(a.groupBy(d,"categoryCode")),g,h,i,j,k=0;k<f.length;k++){g=new c(f[k][0].categoryCode,f[k][0].categoryDescription),e[e.length]=g,h=a.values(a.groupBy(f[k],"classCode"));for(var l=0;l<h.length;l++){i=new c(h[l][0].classCode,h[l][0].classDescription),g.children[g.children.length]=i;for(var m=0;m<h[l].length;m++)j=new c(h[l][m].typeCode,h[l][m].typeDescription),i.children[i.children.length]=j}}return e},c});
define('assets/models/family',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.id=a.toString(b.id),this.caption=a.toString(b.caption)}return b.fromDataCollection=function a(c){var d,e=[];for(d=0;d<c.length;d++)e[d]=new b(c[d]);return e},b});
define('assets/models/field',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){this.key=a.toString(b.key),this.caption=a.toString(b.caption)}return b});
define('assets/models/hierarchy-configuration',['require','system/lang/converter','assets/models/family','assets/models/field','system/knockout/knockout-manager'],function(require){"use strict";var a=require("system/lang/converter"),b=require("assets/models/family"),c=require("assets/models/field"),d=require("system/knockout/knockout-manager");function e(e){var h,i;if(e=e||{},this.kom=Object.resolve(d),this.entityKey=a.toString(e.entityKey),this.displayFieldKey=this.kom.observable(a.toString(e.displayFieldKey)),this.parentDisplayFieldKey=this.kom.observable(a.toString(e.parentDisplayFieldKey)),this.parentKey=this.kom.observable(a.toString(e.parentKey)),this.childKey=this.kom.observable(a.toString(e.childKey)),i=[],e.children)for(h=0;h<e.children.length;h++)i[i.length]=new b(e.children[h]);if(this.children=this.kom.observableArray(i),this.relationshipKey=this.kom.observable(a.toString(e.relationshipKey)),i=[],e.relationships)for(h=0;h<e.relationships.length;h++)i[i.length]=new b(e.relationships[h]);if(this.relationships=this.kom.observableArray(i),this.taxonomyCategoryFieldKey=this.kom.observable(a.toString(e.taxonomyCategoryFieldKey)),
this.parentTaxonomyCategoryFieldKey=this.kom.observable(a.toString(e.parentTaxonomyCategoryFieldKey)),this.taxonomyClassFieldKey=this.kom.observable(a.toString(e.taxonomyClassFieldKey)),this.parentTaxonomyClassFieldKey=this.kom.observable(a.toString(e.parentTaxonomyClassFieldKey)),this.taxonomyTypeFieldKey=this.kom.observable(a.toString(e.taxonomyTypeFieldKey)),this.parentTaxonomyTypeFieldKey=this.kom.observable(a.toString(e.parentTaxonomyTypeFieldKey)),this.level=this.kom.observable(a.toInteger(e.level)),i=[],e.fields)for(h=0;h<e.fields.length;h++)i[i.length]=new c(e.fields[h]);if(this.fields=this.kom.observableArray(i),i=[],e.parentFields)for(h=0;h<e.parentFields.length;h++)i[i.length]=new c(e.parentFields[h]);this.parentFields=this.kom.observableArray(i),this.isNotRecursive=this.kom.computed(g.bind(null,this)),this.kom.tracker.hashFunction=f.bind(null,this),this.kom.tracker.markCurrentStateAsClean()}e.prototype.isDirty=function(){return this.kom.isDirty()},
e.prototype.markClean=function(){this.kom.tracker.markCurrentStateAsClean()},e.prototype.dispose=function(){this.kom.dispose()};function f(a){var b;return b={level:a.level(),displayField:a.displayFieldKey(),parentFamilyKey:a.parentKey(),childFamilyKey:a.childKey(),relationshipKey:a.relationshipKey(),taxonomyCategeoryField:a.taxonomyCategoryFieldKey(),taxonomyClassField:a.taxonomyClassFieldKey(),taxonomyTypeField:a.taxonomyTypeFieldKey(),parentDisplayField:a.parentDisplayFieldKey(),parentTaxonomyCategeoryField:a.parentTaxonomyCategoryFieldKey(),parentTaxonomyClassField:a.parentTaxonomyClassFieldKey(),parentTaxonomyTypeField:a.parentTaxonomyTypeFieldKey()},JSON.stringify(b)}function g(a){return 0===a.level()&&a.parentKey()!==a.childKey()}return e});
define('assets/models/hierarchy-config-dto',[],function(){"use strict";function a(a){a=a||{},this.entityKey=a.entityKey,this.displayFieldKey=a.displayFieldKey(),this.parentKey=a.parentKey(),this.childKey=a.childKey(),this.relationshipKey=a.relationshipKey(),this.taxonomyCategoryFieldKey=a.taxonomyCategoryFieldKey(),this.taxonomyClassFieldKey=a.taxonomyClassFieldKey(),this.taxonomyTypeFieldKey=a.taxonomyTypeFieldKey(),this.level=a.level(),this.parentDisplayFieldKey=a.parentDisplayFieldKey(),this.parentTaxonomyCategoryFieldKey=a.parentTaxonomyCategoryFieldKey(),this.parentTaxonomyClassFieldKey=a.parentTaxonomyClassFieldKey(),this.parentTaxonomyTypeFieldKey=a.parentTaxonomyTypeFieldKey()}return a});
define('assets/adapters/hierarchy-config-adapter',['require','assets/models/hierarchy-configuration','assets/models/hierarchy-config-dto'],function(require){"use strict";var a=require("assets/models/hierarchy-configuration"),b=require("assets/models/hierarchy-config-dto");function c(){}return c.fromDTOArray=function(b){var c,d,e=[];for(c=0;c<b.length;c++)d=new a(b[c]),e[e.length]=d;return e},c.toDTO=function(a){return new b(a)},c});
define('assets/services/hierarchy-service',['require','jquery','system/http/ajax-client','assets/services/hierarchy-dto','assets/services/hierarchy-paging-dto','assets/services/taxonomy-dto','assets/services/asset-context-dto','assets/adapters/hierarchy-config-adapter','assets/models/family','assets/models/field','system/globalization/translator','application/application-context'],function(require){"use strict";var a=require("jquery"),b=require("system/http/ajax-client"),c=require("assets/services/hierarchy-dto"),d=require("assets/services/hierarchy-paging-dto"),e=require("assets/services/taxonomy-dto"),f=require("assets/services/asset-context-dto"),g=require("assets/adapters/hierarchy-config-adapter"),h=require("assets/models/family"),i=require("assets/models/field"),j=require("system/globalization/translator"),k=require("application/application-context"),l="api/common/assethierarchy/",m="MI_AST_GRP",n="api/core/userpref",o="asset-hierarchy-key",p=7;function q(a,b){this.ajaxClient=a,this.request=null,this.translator=b}q.dependsOn=[b,j],q.prototype.get=function(){var b=a.Deferred();return this.ajaxClient.get(l).done(A.bind(null,b)).fail(b.reject.bind(b)),b},q.prototype.children=function b(c,d,e,f,g,h){var i=a.Deferred(),j=l+"children";return c&&(j+="/"+c.toString()),
j+="?taxonomyCategory="+d+"&taxonomyClass="+e+"&taxonomyType="+f+"&page="+g+"&pageSize="+h,this.request=this.ajaxClient.get(j),this.request.done(v.bind(null,this,i)),this.request.fail(t.bind(null,i)),i.promise()},q.prototype.childrenFilteredBySites=function(b,c,d,e,f,g,h){var i=a.Deferred(),j=l+"children";return b&&(j+="/"+b.toString()),j+="?taxonomyCategory="+c+"&taxonomyClass="+d+"&taxonomyType="+e+"&page="+f+"&pageSize="+g,this.request=this.ajaxClient.post(j,h),this.request.done(v.bind(null,this,i)),this.request.fail(t.bind(null,i)),i.promise()},q.prototype.search=function b(c,d,e){var f=a.Deferred(),g=l;return g+="search?term="+encodeURIComponent(c)+"&page="+d+"&pageSize="+e,this.ajaxClient.get(g).done(w.bind(null,this,f)).fail(f.reject.bind(f)),f.promise()},q.prototype.searchFilteredBySites=function(b,c,d,e){var f=a.Deferred(),g=l;return g+="search?term="+encodeURIComponent(b)+"&page="+c+"&pageSize="+d,this.ajaxClient.post(g,e).done(w.bind(null,this,f)).fail(f.reject.bind(f)),
f.promise()},q.prototype.assets=function b(c,d){var e,f=a.Deferred(),g=l+"assets/"+c.toString();if(d&&d.length>0)for(e=0;e<d.length;e++)g+=(0===e?"?":"&")+"families="+d[e].toString();return this.ajaxClient.get(g).done(u.bind(null,f)).fail(f.reject.bind(f)),f.promise()},q.prototype.assetsFilteredBySites=function b(c,d){var e=a.Deferred(),f=l+"assets/"+c.toString();return this.ajaxClient.post(f,d).done(u.bind(null,e)).fail(e.reject.bind(e)),e.promise()},q.prototype.abort=function a(){this.request&&this.request.abort()},q.prototype.taxonomy=function b(){var c=a.Deferred();return this.ajaxClient.get(l+"taxonomy").done(x.bind(null,c)).fail(c.reject.bind(c)),c.promise()},q.prototype.path=function b(c){var d=a.Deferred();return c&&"-1"!==c&&"0"!==c?(this.request=this.ajaxClient.get(l+"path/"+c),this.request.done(y.bind(null,this,d)),this.request.fail(d.reject.bind(d)),d.promise()):(setTimeout(y.bind(null,this,d,[]),0),d.promise())},q.prototype.pathAll=function b(c,d){
var e=a.Deferred(),f=l+"pathAll/"+d;return this.ajaxClient.post(f,c).done(z.bind(null,this,e)).fail(e.reject.bind(e)),e.promise()},q.prototype.families=function(){var b=a.Deferred();return this.ajaxClient.get(l+"families").done(B.bind(null,b)).fail(b.reject.bind(b)),b.promise()},q.prototype.relationships=function(b){var c=a.Deferred();return this.ajaxClient.get(l+"families/"+b.toString()).done(B.bind(null,c)).fail(c.reject.bind(c)),c.promise()},q.prototype.getPartialFamily=function(b){var c=a.Deferred();return this.ajaxClient.get(l+"family/"+b.toString()).done(D.bind(null,c)).fail(c.reject.bind(c)),c.promise()},q.prototype.relationshipsById=function(){var b=a.Deferred();return this.ajaxClient.get(l+"families/"+m).done(B.bind(null,b)).fail(b.reject.bind(b)),b.promise()},q.prototype.relatedFamilies=function(b,c){var d=l+"families/"+b.toString()+"/"+c.toString(),e=a.Deferred();return this.ajaxClient.get(d).done(B.bind(null,e)).fail(e.reject.bind(e)),e.promise()},
q.prototype.familyFields=function(b){var c=a.Deferred();return this.ajaxClient.get(l+"families/"+b.toString()+"/fields").done(C.bind(null,c)).fail(c.reject.bind(c)),c.promise()},q.prototype.updateConfiguration=function(a){return this.ajaxClient.put(l,a)},q.prototype.rebuild=function(){return this.ajaxClient.post(l+"rebuild")},q.prototype.storeAssetHierarchyKey=function(a){return this.ajaxClient.post(n+"/set",r(a))};function r(a){return{userKey:s(),prefType:p,name:o,value:a}}function s(){return k.user.key}function t(a,b,c,d){"abort"!==c&&a.reject(b,c,d)}function u(a,b){a.resolve(c.fromDataCollection(b))}function v(a,b,e){var f;a.request=null,f=new d(e),f.data=c.fromDataCollection(e.data),b.resolve(f)}function w(a,b,e){var f;f=new d(e),f.data=c.fromDataCollection(e.data),b.resolve(f)}function x(a,b){a.resolve(e.fromDataCollection(b))}function y(a,b,c){var d=f.fromDataCollection(c);d.unshift({description:a.translator.translate("ASSET_HIERARCHY_ROOT"),entityKey:"-1"}),b.resolve(d)}
function z(a,b,c){b.resolve(f.fromDataCollection(c))}function A(a,b){a.resolve(g.fromDTOArray(b))}function B(a,b){var c,d=[];for(c=0;c<b.length;c++)d[d.length]=new h(b[c]);a.resolve(d)}function C(a,b){var c,d=[];for(c=0;c<b.length;c++)d[d.length]=new i(b[c]);a.resolve(d)}function D(a,b){var c={},d=0;for(c.relationships=[],c.parentFields=[],d=0;d<b.parentFields.length;d++)c.parentFields[c.parentFields.length]=new i(b.parentFields[d]);for(d=0;d<b.relationships.length;d++)c.relationships[c.relationships.length]=new h(b.relationships[d]);a.resolve(c)}return q});

define('text!assets/views/asset-hierarchy-control-filter.html',[],function () { return '<div class="filter-trigger-container">\r\n    <button class="btn btn-default btn--bare actionable actionable--secondary filter-trigger-btn">\r\n        <i class="icon-collection-filter"></i>\r\n        <span class="filter-txt label--inline" for="filter-icon">Filter</span>\r\n    </button>\r\n    <button class="ahc-filters-clear-btn pull-right hide">Clear</button>\r\n</div>\r\n<div class="uacb-filter-popup hide"></div>';});

define('assets/asset-hierarchy-control-filter',['require','jquery','assets/services/hierarchy-service','spa/ko/knockout-view-model','system/knockout/knockout-manager','system/globalization/translator','text!./views/asset-hierarchy-control-filter.html'],function(require){"use strict";var a=require("jquery"),b=require("assets/services/hierarchy-service"),c=require("spa/ko/knockout-view-model"),d=require("system/knockout/knockout-manager"),e=require("system/globalization/translator"),f=require("text!./views/asset-hierarchy-control-filter.html");function g(a,c,g){h.call(this,f),this.service=Object.resolve(b),this.translator=Object.resolve(e),this.categories=null,this.classes=null,this.types=null,this.currentCategory=a,this.currentClass=c,this.currentType=g,this.kom=Object.resolve(d)}var h=Object.inherit(c,g);g.prototype.load=function a(){this.categories=this.kom.observableArray(),this.classes=this.kom.computed(m.bind(null,this)),this.types=this.kom.computed(n.bind(null,this)),this.service.taxonomy().done(l.bind(null,this))},g.prototype.attach=function b(c){c.attach(a(f)),h.prototype.attach.call(this,c),c.element.querySelector(".apply").addEventListener("click",this),c.$element.addClass("asset-hierarchy-filter-popover")},
g.prototype.detach=function(a){a.element.querySelector(".apply").removeEventListener("click",this),h.prototype.detach(a)},g.prototype.unload=function a(){this.kom.dispose()},g.prototype.translate=function a(b){return this.translator.translate(b)},g.prototype.handleEvent=function b(c){"click"===c.type&&c.target.classList.contains("apply")&&(a(".hierarchy-control-filter")[0].closeFilter(),a(".hierarchy-control-filter").trigger("filter-closed"))};function i(a,b){var c,d;for(c=a.currentCategory().code,d=0;d<b.length;){if(b[d].code===c){a.currentCategory(b[d]);break}d++}}function j(a){var b,c,d;for(b=a.currentCategory(),c=a.currentClass().code,d=0;d<b.children.length;){if(b.children[d].code===c){a.currentClass(b.children[d]);break}d++}}function k(a){var b,c,d;for(b=a.currentClass(),c=a.currentType().code,d=0;d<b.children.length;){if(b.children[d].code===c){a.currentType(b.children[d]);break}d++}}function l(a,b){a.currentCategory()&&i(a,b),a.currentClass()&&j(a),a.currentType()&&k(a),
a.categories(b)}function m(a){return a.currentCategory()?a.currentCategory().children:[]}function n(a){return a.currentClass()?a.currentClass().children:[]}return g});

define('text!assets/views/asset-hierarchy-control.html',[],function () { return '<asset-hierarchy-control data-bind="attr:{enableMultiSelect:settings.multiSelect}"></asset-hierarchy-control>\r\n';});


define('text!assets/views/asset-hierarchy-control-search.html',[],function () { return '<input placeholder="Search" type="text" class="ahc-search-input text-input" />\r\n<i class="ahc-search-icon icon-global-search"></i>\r\n<i class="ahc-search-clear-icon icon-multiply icon-close hide"></i>';});

define('ui/elements/list-group-item/view-model',['system/globalization/translator'],function(){"use strict";var a=require("system/globalization/translator"),b=Object.create(HTMLElement.prototype);b.createdCallback=function(){var b,d,e,f,g;this.translator=Object.resolve(a),this.className="list-group-item",b=document.createElement("div"),b.classList.add("background-div"),this.appendChild(b),d=document.createElement("div"),d.classList.add("block-group"),d.classList.add("mi-li-body"),this.appendChild(d),e=document.createElement("div"),e.setAttribute("name","selector"),d.appendChild(e),l(this),e=document.createElement("div"),g=document.createElement("span"),f=document.createElement("span"),g.setAttribute("name","text"),f.setAttribute("name","custom-icon"),g.classList.add("system-ellipsis-text"),e.appendChild(f),e.appendChild(g),d.appendChild(e),this._listItemIcon=f,m(this),c(this)},b.attachedCallback=function(){this.querySelector(".mi-li-body").addEventListener("click",this)},b.attributeChangedCallback=function(a,b,c){
"selector"===a||"multiselect"===a||"radio-child-only"===a?l(this):"checked"===a?r(this,c):"description"===a&&this.value?q(this):"icon-class"===a?s(this,c):"has-children"===a?m(this):"use-html"===a?q(this):"disabled"===a?n(this,c):"disabledicon"===a&&o(this,c)},b.handleEvent=function(a){"click"===a.type?t(this,a):"change"===a.type&&u(this,a)};function c(a){a._value=null,Element.defineProperty(a,"value",{get:f.bind(null,a),set:g.bind(null,a)}),Element.defineProperty(a,"listItemIcon",{get:d.bind(null,a),set:e.bind(null,a)})}function d(a){return a._listItemIcon}function e(a,b){}function f(a){return a._value}function g(a,b){a._value=b,q(a),m(a)}function h(a,b,c){var d=document.createElement("span"),e=document.createElement("input");"true"===a.getAttribute("multiselect")?(e.type="checkbox",d.classList.add("custom-checkbox")):e=i(a,e),a.getAttribute("checked")?e.checked="true"===a.getAttribute("checked"):e.checked=!1,e.setAttribute("selector",!0),b.appendChild(d),b.appendChild(e),
c.classList.add("selector-seperator")}function i(a,b){var c=!!a.querySelector("i.icon-right-arrow"),d=a.getAttribute("radio-child-only");return b=j(b),d&&c&&(b.style.visibility="hidden"),b}function j(a){return a.type="radio",a.name="list-group-radio",a}function k(a,b,c){var d=document.createElement("i");d.className="icon-plus",d.title=a.translator.translate("ADD_ASSET"),b.appendChild(d),c.classList.add("selector-seperator")}function l(a){var b=a.getAttribute("selector"),c,d=a.querySelector('[name="selector"]'),e=a.querySelector('[name="text"]');d.hasChildNodes()&&(c=d.querySelector("input"),c&&c.removeEventListener("checked",a),d.innerHTML=""),"toggle"===b?h(a,d,e):"addOnly"===b&&k(a,d,e)}function m(a){var b,c,d,e,f=a.querySelector(".mi-li-body");c=a.getAttribute("has-children"),c?"true"===c?d=!0:(e=a.value[c],d=e instanceof Function?e():e):d=!1,d&&!f.querySelector('i[name="icon"]')?(b=document.createElement("i"),b.className=a.getAttribute("icon-class"),
b.title=a.translator.translate("EXPAND"),b.setAttribute("name","icon"),f.appendChild(b)):d||(b=f.querySelector('i[name="icon"]'))&&f.removeChild(b)}function n(a,b){b===!0||"true"===b?a.classList.add("disabled"):b!==!1&&"false"!==b||a.classList.remove("disabled")}function o(a,b){b===!0||"true"===b?a.classList.add("disabledIcon"):b!==!1&&"false"!==b||a.classList.remove("disabledIcon")}function p(a){var b,c=a.querySelector(".mi-li-body");c.querySelector('i[name="icon"]')||(b=document.createElement("i"),b.className=a.getAttribute("icon-class"),b.setAttribute("name","icon"),c.appendChild(b))}function q(a){var b,c,d=a.getAttribute("description")||"description",e=a.getAttribute("use-html");a.value&&(b=a.value[d],c=b instanceof Function?b.call(a.value):b,e?a.querySelector('[name="text"]').innerHTML=c:a.querySelector('[name="text"]').textContent=c)}function r(a,b){var c=a.querySelector('[name="selector"] input');c&&(c.checked="false"!==b,
c.checked?c.previousSibling.classList.add("checked"):c.previousSibling.classList.remove("checked"))}function s(a,b){var c=a.querySelector('[name="icon"]');null!==c?c.className=b:(p(a),c=a.querySelector('[name="icon"]'),c.className=b)}function t(a,b){var c;if(b.cancelBubble=!0,b.preventDefault=!0,c=new CustomEvent("click",{bubbles:!0,cancelable:!0}),"selector"===b.target.getAttribute("name")||"selector"===b.target.parentElement.getAttribute("name"))if("INPUT"===b.target.tagName)"radio"!==b.target.getAttribute("type")&&"checkbox"!==b.target.getAttribute("type")||(c.selecting=b.target.checked);else if("I"===b.target.tagName){if("true"===a.getAttribute("disabledicon"))return;c.selecting=!0}a.dispatchEvent(c)}function u(a,b){var c,d;c=b.target.checked,a.setAttribute("checked",b.target.checked),d=b.target.checked,c!==d&&(b.target.checked=c)}return document.registerElement("mi-li",{prototype:b}),b});
define('ui/elements/searchbox/view-model',['lodash','jquery','system/globalization/translator'],function(){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/globalization/translator"),d=Object.create(HTMLElement.prototype),e=["key","description","page","page-size","scroll-percent","use-html","multiselect","selector"];d.createdCallback=function(){var b;this.classList.add("btn"),this.classList.add("btn-icon"),b=document.createElement("i"),b.className="icon-search",this.appendChild(b),this.search=a.debounce(q,500),this._searchDiv=null,this._searchList=null,this._value="",Element.defineProperty(this,"value",{get:o.bind(null,this),set:p.bind(null,this)}),this._closeSearchBind=this.closeSearch.bind(this),this._resizeBind=i.bind(null,this),this.isInToolbar=!1,this.disabled=!1,this.translator=null},d.attachedCallback=function(){this.addEventListener("click",this),window.addEventListener("resize",this._resizeBind),this.translator=Object.resolve(c),this.title=f(this,"SEARCH")},d.detachedCallback=function(){this._searchDiv&&j(this),
window.removeEventListener("resize",this._resizeBind),this.isInToolbar&&this._searchList&&k(this)},d.handleEvent=function(a){"input"===a.type?(this._value=a.target.value,n(this)):"click"===a.type&&"I"===a.target.tagName&&(a.target.classList.contains("icon-multiply")?r(this):a.target.classList.contains("icon-search")&&!this.disabled&&(w(this,a),g(this)))},d.attributeChangedCallback=function(b,c,d){var f;"delay"===b?this.search=a.debounce(q,d):"disabled"===b?this.disabled="true"===d:this.searchDiv&&(f=this.searchDiv.querySelector(".search-list"))&&e.indexOf(b)>-1&&f.setAttribute(b,d)},d.closeSearch=function(a){if(""===this._value)if(this._searchList&&"none"!==b(this._searchList).css("display")){if(a.target===this._searchDiv.querySelector("input"))return;this._searchDiv&&""===this._searchDiv.querySelector("input").value&&(j(this),k(this))}else{
if(a&&"blur"!==a.type&&(a.target===this||a.target.parentElement===this||a.target===this._searchDiv||a.target.parentElement===this._searchDiv))return;j(this)}},d.toggleEnabled=function(a){var b=this.querySelector("Search");b.disabled="true"===a},d.toggleSearch=function(){g(this)};function f(a,b){return a.translator.translate(b.toUpperCase())}function g(a){var b;a._searchDiv||a.isInToolbar&&a._searchList?(r(a),j(a),k(a)):(a._searchDiv=document.createElement("div"),a._searchDiv.className="mi-searchbox","MI-TOOL-BAR"!==a.parentElement.tagName?a.parentElement.appendChild(a._searchDiv):a.parentElement.parentElement.insertBefore(a._searchDiv,a.parentElement.nextElementSibling),b=document.createElement("input"),b.setAttribute("type","text"),b.className="form-control mi-searchbox",b.value=a.value,b.addEventListener("blur",a._closeSearchBind),a._searchDiv.appendChild(b),b.focus(),b=document.createElement("i"),b.className="icon-multiply",a._searchDiv.appendChild(b),b.addEventListener("click",a),
"true"!==a.getAttribute("custom-search")&&(b=document.createElement("mi-list-group"),Element.upgrade(b),b.classList.add("search-list"),b.classList.add("dropdown-menu-left"),s(a,b),b.loader=t.bind(null,a),"MI-TOOL-BAR"!==a.parentElement.tagName?a._searchDiv.appendChild(b):(a.isInToolbar=!0,a._searchDiv.parentElement.insertBefore(b,a._searchDiv.nextElementSibling),a._searchList=b,a._searchList.searchResult=a._searchList.parentElement.searchResult,h(a,b)),i(a)),m(a),l(a),a._searchDiv.addEventListener("input",a))}function h(a){a._searchList.addEventListener("click",function(b){b.target===this?g(a):"MI-LI"===b.target.tagName&&w(a,b)})}function i(a){var c;"true"!==a.getAttribute("custom-search")&&(c=a.parentElement)&&("MI-TOOL-BAR"===c.nodeName&&(c=c.parentElement),a._searchDiv&&(a.isInToolbar?a._searchList&&(a._searchList.style.height=(c.clientHeight-77).toString()+"px",b(a._searchList).css("position","absolute"),"relative"===b(c).css("position")?(b(a._searchList).css("top",77),
b(a._searchList).css("left",0)):(b(a._searchList).css("top",b(c).position().top+77),b(a._searchList).css("left",b(c).position().left)),a._searchList.style.width=c.clientWidth.toString()+"px"):(a._searchList=a._searchDiv.querySelector(".search-list"),a._searchList.style.height=(c.clientHeight-46-35).toString()+"px")))}function j(a){a._searchDiv&&(a._searchDiv.removeEventListener("click",a),a._searchDiv.removeEventListener("input",a),a._searchDiv.querySelector("input").removeEventListener("blur",a._closeSearchBind),Element.clearDom(a._searchDiv),a._searchDiv.parentElement.removeChild(a._searchDiv),a._searchDiv=null,l(a))}function k(a){a._searchList&&(a._searchList.removeEventListener("click",a),Element.clearDom(a._searchList),b(a._searchList).remove(),a._searchList=null,l(a))}function l(a){var b=new CustomEvent("resize",{bubbles:!0});b.open=null!==a._searchDiv,a.dispatchEvent(b)}function m(a){
a.value.length>0?a._searchDiv.querySelector("i").style.display="inline-block":a._searchDiv.querySelector("i").style.display="none"}function n(a){m(a),a.search(a)}function o(a){return a._value}function p(a,b){a._value=b||"",""===a._value||a._searchDiv||g(a),a._searchDiv&&(a._searchDiv.querySelector("input").value=a._value,n(a))}function q(a){var b;a.searchCallback&&a._searchDiv&&("true"===a.getAttribute("custom-search")?(b=a._searchDiv.querySelector("input"),a.searchCallback(b.value)):(a._searchList.value=null,a._searchList.reload()))}function r(a){a.value="",q(a),a._searchDiv.querySelector(".mi-searchbox input").focus()}function s(a,b){var c,d;for(c=0;c<e.length;c++)(d=a.getAttribute(e[c]))&&b.setAttribute(e[c],d)}function t(a,c,d){var e=a._searchDiv.querySelector("input");return e&&a.searchCallback?a.searchCallback(e.value,c,d).done(u.bind(null,a)):b.Deferred().resolve().promise()}function u(a,b){var c
;a._searchDiv&&(c=a.isInToolbar?a._searchList:a._searchDiv.querySelector(".search-list"))&&(b&&b.length>0?c.classList.add("open"):c.classList.remove("open"))}function v(a){for(var b=a.hasAttribute("multiselect")?a.querySelectorAll("mi-li[checked]"):a.querySelectorAll(".active"),c=[],d=0;d<b.length;d++)c.push(b[d].value);return c}function w(a,b){var c;c=new CustomEvent("search-selected",{bubbles:!0}),c.searchResult=v(b.currentTarget),a.dispatchEvent(c)}return document.registerElement("mi-searchbox",{prototype:d}),d});
define('ui/elements/tool-bar/view-model',['lodash','jquery'],function(){"use strict";var a=require("lodash"),b=require("jquery"),c=Object.create(HTMLElement.prototype);c.createdCallback=function(){var b,c;this._closeOverflowBind=m.bind(null,this),this.$filter=null,this.popoverId=null,b=document.createElement("button"),b.className="more-options-icon btn btn-primary btn-icon dropdown-toggle",this.appendChild(b),c=document.createElement("icon"),c.className="icon-options",b.appendChild(c),this.throttledPositionEllipsis=a.throttle(this.positionEllipsis.bind(this),650)},c.attachedCallback=function(){a.defer(q.bind(null,this)),window.addEventListener("resize",this),document.querySelector("body").addEventListener("click",this._closeOverflowBind),this.addEventListener("click",this)},c.detachedCallback=function(){var a;window.removeEventListener("resize",this),document.querySelector("body").removeEventListener("click",this._closeOverflowBind),this.$filter&&(a=document.querySelector(this.popOverId),a&&a.parentElement.removeChild(a),
this.$filter=null)},c.showElement=function(a,b){for(var c=this.firstElementChild;c;)d(c,a)&&e(c,b),null!==c&&(c=c.nextElementSibling)};function d(a,b){return a.className.split(" ").indexOf(b)>=0}function e(a,c){c?b(a).addClass("overflow").removeClass("no-access"):b(a).addClass("no-access").removeClass("overflow")}c.handleEvent=function(b){var c,d,e,f;if("resize"===b.type&&b.target===window)this.throttledPositionEllipsis(),a.defer(q.bind(null,this));else if("click"===b.type){if(c=this.querySelector(".more-options-icon"),d=document.querySelector(this.popOverId),b.target===c||c.contains(b.target))l(this);else if(d&&d.contains(b.target)){for(f=b.target;f&&!e;)f.original&&(e=f.original),f=f.parentElement;e&&(b.cancelBubble=!0,e.dispatchEvent(new CustomEvent("click",{bubble:!0})))}b.target.parentElement.classList.contains("tool-bar-overflow")&&this._closeOverflowBind(this,b)}},c.positionEllipsis=function(){
var a=this.firstElementChild,b=this.querySelector(".more-options-icon"),c=document.querySelector(".content").getBoundingClientRect(),d=0,e=5,l,m=!1,n,o,p,q,r;if(r=this,null!==this.offsetParent)if(p=this.parentElement.getBoundingClientRect(),l="MI-TREE"===this.parentElement.tagName,this.$filter&&this.$filter.popover("hide"),a&&a!==b){for(n=b.getBoundingClientRect(),q=c.width===p.width||l?p.width-n.width-e:p.left+p.width-n.width-e,o=a.getBoundingClientRect(),d=h(r,b,o,p),a=this.firstElementChild;a;)o=a.getBoundingClientRect(),j(a,b,o,p)&&(i(a)?d>0?(m=!0,a.classList.add("overflow"),f(a),d--,d=h(r,b,o,p)):(g(a),a.classList.remove("overflow")):k(a,this)?(m=!0,a.classList.add("overflow")):(g(a),a.classList.remove("overflow"))),null!==a&&(a=a.nextElementSibling);m?(b.style.visibility="visible",b.style.left=q.toString()+"px"):b.style.visibility="hidden"}else;};function f(a){var c=b(a);""===c.next().text()||c.hasClass("more-options-icon")||c.next().css({"margin-right":"20px"})}function g(a){
var c=b(a),d=[];c.hasClass("overflow")&&c.attr("style",""),c.parent().children().each(function(a,c){"right"!==b(this).css("float")||b(this).hasClass("overflow")||d.push(b(this))}),b.each(d,function(a){0!==a&&b(this).attr("style","")})}function h(a,b,c,d){var e,f=0;for(e=a.firstElementChild;e;)j(e,b,c,d)&&k(e,a)&&i(e)&&f++,e=e.nextElementSibling;return f}function i(a){return"right"===b(a).css("float")}function j(a,b,c,d){var e="addItem"===a.getAttribute("data-action");return a!==b&&c.width!==d.width&&!e}function k(a,c){var d=b(a).position().top>b(c).position().top+b(c).height();return a.classList.contains("overflow")&&!a.classList.contains("dropdown-toggle")&&(b(a).removeClass("overflow"),d=b(a).position().top>b(c).position().top+b(c).height(),b(a).addClass("overflow")),d}function l(a){if(!a.$filter){var c,d;a.$filter=b(a.querySelector(".more-options-icon")),a.$filter.popover({placement:"bottom",container:"body",content:" "}),a.$filter.on("shown.bs.popover",a,n),
a.$filter.on("hide.bs.popover",a,o),a.$filter.on("hidden.bs.popover",a,p),a.$filter.popover("show"),setTimeout(function(){c=parseInt(b(a.popOverId).css("left")),d=parseInt(b(a.popOverId).width()),b(a.popOverId).css("left",c-(d-30))},250)}}function m(a,b){var c;if(a.$filter){if(!(c=document.querySelector(a.popOverId))||c.contains(b.target)||b.target===a)return;a.$filter.popover("hide")}}function n(a){var b=a.data,c,d=b.querySelectorAll(".overflow"),e,f;for(b.popOverId="#"+a.target.attributes["aria-describedby"].value,c=document.querySelector(b.popOverId+" .popover-content"),c.classList.add("tool-bar-overflow"),e=0;e<d.length;e++)f=d[e].cloneNode(),f.original=d[e],c.appendChild(f),f.textContent=f.getAttribute("title");c.addEventListener("click",b)}function o(a){var b=a.data,c;c=document.querySelector(b.popOverId+" .popover-content"),c&&c.addEventListener("click",b),b.$filter.off("shown.bs.popover",n),b.$filter.off("hide.bs.popover",o)}function p(a){var b=a.data
;b.$filter&&(b.$filter.off("hidden.bs.popover",p),b.$filter.popover("destroy"),b.$filter=null,b.popoverId=null)}function q(a){a&&a.positionEllipsis&&a.positionEllipsis instanceof Function&&a.positionEllipsis()}return document.registerElement("mi-tool-bar",{prototype:c}),c});
define('ui/elements/tool-bar-filter/view-model',['require','jquery','spa/conductor','spa/region','system/globalization/translator'],function(require){"use strict";var a=require("jquery"),b=require("spa/conductor"),c=require("spa/region"),d=require("system/globalization/translator"),e=Object.create(HTMLElement.prototype);e.createdCallback=function(){var a;h(this),this.classList.add("btn"),this.classList.add("btn-default"),this.classList.add("btn-icon"),a=document.createElement("i"),a.className="icon-collection-filter",this.appendChild(a),this.region=null,this.translator=null},e.attachedCallback=function(){this.addEventListener("click",this),document.querySelector("body").addEventListener("click",this._closeFilterBind),this.translator=Object.resolve(d),this.title=f(this,"FILTER")},e.detachedCallback=function(){var a;"true"!==this.getAttribute("custom-filter")&&(this.$filter&&(a=document.querySelector(this.popOverId),a&&a.parentElement.removeChild(a),this.$filter=null),this.conductor.unloadScreen(this.filterViewModel),this.conductor.closeScreen(this.filterViewModel)),
document.querySelector("body").removeEventListener("click",this._closeFilterBind)},e.handleEvent=function(a){"click"===a.type&&(a.target!==this&&a.target.parentElement!==this||g(this))},e.openFilter=function(){g(this)},e.closeFilter=function(){i(this)};function f(a,b){return a.translator.translate(b.toUpperCase())}function g(b){if("true"===b.getAttribute("custom-filter"))b.filterViewModel();else{if(b.$filter)return;b.$filter=a(b),b.$filter.popover({placement:"bottom",content:" ",container:"body"}),b.$filter.on("shown.bs.popover",b,l),b.$filter.on("hide.bs.popover",b,m),b.$filter.on("hidden.bs.popover",b,n),b.$filter.popover("show")}}function h(a){a.conductor=Object.resolve(b),a._closeFilterBind=i.bind(null,a),a.$filter=null,a.popoverId=null,a._filterViewModel=null,Element.defineProperty(a,"filterViewModel",{get:j.bind(null,a),set:k.bind(null,a)})}function i(a,b){var c;if(a.$filter){if(!(c=document.querySelector(a.popOverId))||c.contains(b.target)||b.target===a)return
;a.$filter.popover("hide")}}function j(a){return a._filterViewModel}function k(a,b){b?(a._filterViewModel=b,"true"!==a.getAttribute("custom-filter")&&(a.conductor.openScreen(a._filterViewModel),a.conductor.loadScreen(a._filterViewModel))):a._filterViewModel=null}function l(b){var d=b.data;d.region=new c,d.popOverId="#"+b.target.getAttribute("aria-describedby"),d.region.setElement(a(d.popOverId+" .popover-content")),d.conductor.activateScreen(d.filterViewModel),d.conductor.attachScreen(d.filterViewModel,d.region)}function m(a){var b=a.data;b.conductor.deactivateScreen(b.filterViewModel),b.conductor.detachScreen(b.region),b.$filter.off("shown.bs.popover",l),b.$filter.off("hide.bs.popover",m)}function n(a){var b=a.data;b.$filter&&(b.$filter.off("hidden.bs.popover",n),b.$filter.popover("destroy"),b.$filter=null,b.popoverId=null,b.dispatchEvent(new CustomEvent("filter-closed",{bubbles:!0})))}return document.registerElement("mi-tool-bar-filter",{prototype:e}),e});
define('ui/elements/list-group/view-model',['require','jquery','ramda','lodash','system/lang/converter','system/globalization/translator','ui/elements/list-group-item/view-model','ui/elements/searchbox/view-model','ui/elements/tool-bar/view-model','ui/elements/tool-bar-filter/view-model'],function(require){"use strict";var a=require("jquery"),b=require("ramda"),c=require("lodash"),d=require("system/lang/converter"),e=require("system/globalization/translator"),f=["key","description","selector","multiselect","has-children","use-html","delay","custom-search","radio-child-only"];require("ui/elements/list-group-item/view-model"),require("ui/elements/searchbox/view-model"),require("ui/elements/tool-bar/view-model"),require("ui/elements/tool-bar-filter/view-model");var g=Object.create(HTMLElement.prototype);g.selectRadioButton=function(a,b){E(this,a,b,!0)},g.createdCallback=function(){var a,b,c,d,e,f,g;j(this),this.classList.add("nav-list-group"),c=this.querySelector("mi-tool-bar"),c||(c=document.createElement("mi-tool-bar"),this.appendChild(c)),this.filterViewModel&&this.classList.add("show-filter"),e=document.createElement("mi-tool-bar-filter"),e.filterViewModel=this.filterViewModel,f=this.getAttribute("custom-filter"),
"true"===f&&e.setAttribute("custom-filter","true"),c.insertBefore(e,c.firstChild),this.searchCallback&&this.classList.add("show-search-button"),d=document.createElement("mi-searchbox"),d.searchCallback=this.searchCallback,c.insertBefore(d,c.firstChild),B(this,d),"false"!==this.getAttribute("allow-add")&&this.classList.add("allow-add"),c.insertBefore(N(this,"addItem","NEWITEM","icon-plus"),c.firstChild),a=document.createElement("div"),a.className="list-group",b=this.getAttribute("selector"),"addOnly"!==b&&"toggle"!==b||(a.className+=" selectable"),this.appendChild(a),g=document.createElement("div"),g.className="loading-small",this.appendChild(g),this.loader&&this.reload(),this.addEventListener("search-selected",this)},g.attachedCallback=function(){var a=U(this),b=this.querySelector("mi-tool-bar");a.addEventListener("scroll",this),a.addEventListener("click",this),b.addEventListener("click",this),b.addEventListener("resize",this),b.addEventListener("filter-closed",this),T(this)},
g.attributeChangedCallback=function(a,b,c){var d=U(this),e;"selector"===a&&d&&("addOnly"===c||"toggle"===c?d.classList.add("selectable"):d.classList.remove("selectable")),"allow-add"===a&&("false"===c?this.classList.remove("allow-add"):this.classList.add("allow-add")),"custom-filter"===a&&(e=this.querySelector("mi-tool-bar mi-tool-bar-filter"))&&e.setAttribute(a,c),A(this,a,c,d)},g.handleEvent=function(a){var b;"scroll"===a.type?J(this,a):"click"===a.type?C(a.target)?(E(this,D(a.target).value,a.selecting),h(this,a)):"BUTTON"===a.target.nodeName?(b=a.target.getAttribute("data-action"),S(this,b,a)):"I"===a.target.tagName&&"BUTTON"===a.target.parentElement.tagName&&(b=a.target.parentElement.getAttribute("data-action"),S(this,b,a)):"resize"===a.type?T(this):"filter-closed"===a.type?this.reload():"search-selected"===a.type&&(W.call(null,this,a.searchResult),x.call(null,this,this.searchResult))};function h(a,b){F(a)&&D(b.target).value&&!b.selecting&&i(a)&&l(a,k(a))}function i(a){
return t(a)&&c.includes(t(a),k(a))}g.reload=function(){var a=U(this);a&&(this.resume(),Element.clearDom(a),this.setAttribute("page","1"),a.scrollTop=0,this.loader&&this.load().done(M.bind(null,this)))},g.pause=function(){this.paused=!0},g.resume=function(){this.paused=!1},g.load=function(){var b=this.getAttribute("page"),c=L(this),d;return this.loader?(this.pause(),this.classList.add("loading"),T(this),d=this.loader(b,c),d.done(I.bind(null,this)),d.always(V.bind(null,this)),d.promise()):a.Deferred().done().promise()},g.scrollIntoView=function(){var a,b,c,d,e=U(this);e&&(a=e.querySelector("mi-li.active"),a?(b=a.parentNode,d=a.getBoundingClientRect(),c=b.getBoundingClientRect(),(d.top<c.top||d.top>c.bottom)&&(b.scrollTop=a.offsetTop-b.offsetTop)):e.firstElementChild&&(e.firstElementChild.scrollTop=0))},g.addItem=function(){this.dispatchEvent(new CustomEvent("add-item",{bubbles:!0}))},g.loadState=function(a){var b=this.querySelector("mi-tool-bar mi-searchbox");a=a||{},
a.value&&(this.value=a.value),a.searchTerm&&(b.value=a.searchTerm)},g.saveState=function(){var a=this.querySelector("mi-tool-bar mi-searchbox");return{value:this.value,searchTerm:a.value}};function j(a){a.translator=Object.resolve(e),a.paused=!1,a.searchResult=[],a._loader=null,Element.defineProperty(a,"loader",{get:q.bind(null,a),set:r.bind(null,a)}),a._value=null,Element.defineProperty(a,"value",{get:s.bind(null,a),set:E.bind(null,a)}),Element.defineProperty(a,"items",{get:t.bind(null,a),set:u.bind(null,a)}),Element.defineProperty(a,"selectedItems",{get:v.bind(null,a),set:x.bind(null,a)}),a._filterViewModel=null,Element.defineProperty(a,"filterViewModel",{get:O.bind(null,a),set:P.bind(null,a)}),a._searchCallback=null,Element.defineProperty(a,"searchCallback",{get:Q.bind(null,a),set:R.bind(null,a)}),a._listItemIconCallback=null,Element.defineProperty(a,"listItemIconCallback",{get:o.bind(null,a),set:p.bind(null,a)})}function k(a){var b=m(a);if(b)return b.selectedRadioButton}
function l(a,b){var c=m(a);c&&(c.selectedRadioButton=b)}function m(a){var b=n(a);if(b)return b[0]}function n(b){var c=b.parentElement,d;if(c)return d=a(c).siblings()}function o(a){return a._listItemIconCallback}function p(a,b){a._listItemIconCallback=b||null}function q(a){return a._loader}function r(a,b){a._loader=b,a.reload()}function s(a){return a._value}function t(a){var b=U(a),c,d=[],e;if(b)for(c=b.querySelectorAll("mi-li"),e=0;e<c.length;e++)d[d.length]=c[e].value;return d}function u(a,b){var c=U(a);c&&(Element.clearDom(c),b&&y(a,b))}function v(a){var b=U(a),c,d=[],e;if(b)for(c=b.querySelectorAll('mi-li[checked="true"]'),e=0;e<c.length;e++)d[d.length]=c[e].value;return d}function w(a){var b,c,d=U(a);if(d&&(b=d.querySelectorAll('mi-li[checked="true"]'),b.length>0))for(c=0;c<b.length;c++)b[c].setAttribute("checked","false")}function x(a,b){var c,d;if(w(a),b)for(c=0;c<b.length;c++)(d=H(a,b[c]))&&d.setAttribute("checked","true")}function y(a,b){var c,d,e=U(a),f;if(e){
for(f=document.createDocumentFragment(),z(b,e),c=0;c<b.length;c++)d=document.createElement("mi-li"),d.setAttribute("icon-class","icon-right-arrow"),f.appendChild(d),d.value=b[c],d.value.hasOwnProperty("disabled")&&d.setAttribute("disabled","true"===d.value.disabled||d.value.disabled),d.value.hasOwnProperty("disabledIcon")&&d.setAttribute("disabledIcon","true"===d.value.disabledIcon||d.value.disabledIcon),Object.tryMethod(a,"_listItemIconCallback",d.listItemIcon,b[c]),B(a,d);var g=new CustomEvent("loaded",{bubbles:!0,cancelable:!0,detail:{frag:f}});a.dispatchEvent(g),e.appendChild(f),a.searchResult.length&&x(a,a.searchResult)}}function z(a,b){if(0===a.length){var c=b.parentElement,d,e;c&&(c.parentElement&&(c=c.parentElement,c.previousSibling&&(c=c.previousSibling)),"MI-PATH-HISTORY"===c.nodeName&&(d=c.children[0].children,e=d[d.length-1],e.setAttribute("icon-class","")))}}function A(a,b,c,d){var e,g,h;if(d&&f.indexOf(b)>-1){for(e=d.getElementsByTagName("mi-li"),
g=0;g<e.length;g++)e[g].setAttribute(b,c);h=a.querySelector("mi-tool-bar mi-searchbox"),h&&h.setAttribute(b,c)}}function B(a,b){var c,d;for(c=0;c<f.length;c++)(d=a.getAttribute(f[c]))&&b.setAttribute(f[c],d)}function C(a){return"MI-LI"===a.tagName||"MI-LI"===a.parentNode.tagName||"MI-LI"===a.parentNode.parentNode.tagName||"MI-LI"===a.parentNode.parentNode.parentNode.tagName}function D(a){for(var b=a;"MI-LI"!==b.tagName;)b=b.parentNode;return b}function E(a,b,c,d){if(b){var e,f,g;if(g=new CustomEvent("selecting",{bubbles:!0,cancelable:!0}),g.selecting=c,g.newValue=b,a.dispatchEvent(g)){if(f=a.getElementsByClassName("active"),f&&f.length>0&&f[0].classList.remove("active"),a._value=b,b)if(F(a)&&b&&c&&l(a,b),void 0!==(e=H(a)))a._value=e.value,e.classList.add("active"),a.scrollIntoView();else{var h=a.querySelector("mi-list-group");h&&void 0!==h&&(a._value=h.value,h.classList.add("active"),a.scrollIntoView())}
return a.value&&void 0!==e?(e.getAttribute("multiselect")&&("true"===e.getAttribute("checked")?e.setAttribute("checked","false"):e.setAttribute("checked","true")),d?(e.setAttribute("checked","true"),G(a,c,!0),!0):(F(a)?G(a,c,!0):G(a,c),!0)):(null!==a.value&&void 0!==a.value||G(a,c),!1)}}}function F(a){return b.any(b.propEq("name","radio-child-only"),a.attributes)}function G(a,b,c){var d=new CustomEvent("change",{bubbles:!0,cancelable:!0});a.dispatchEvent(d),d=new CustomEvent("selected",{bubbles:!0,cancelable:!0}),d.preventListGroupNull=c,d.selecting=b,a.dispatchEvent(d)}function H(a,b){var c=0,d=U(a),e,f,g;if(d&&(e=d.querySelectorAll("mi-li"))&&0!==e.length){for(b=b||a.value,f=a.getAttribute("key")||"entityKey",g=b[f];c<e.length&&g!==e[c].value[f];)c++;return e[c]}}function I(a,b){var c=U(a);c&&"1"===a.getAttribute("page")&&Element.clearDom(c),b&&(y(a,b),b.length===L(a)&&a.resume())}function J(a,b){
var c=b.target,e=d.toFloat(a.getAttribute("scroll-percent")||"0.75"),f=(c.offsetHeight+c.scrollTop)/c.scrollHeight;!a.paused&&f>=e&&(K(a),a.load())}function K(a){var b=d.toInteger(a.getAttribute("page")||"1");b++,a.setAttribute("page",b.toString())}function L(a){var b=a.getAttribute("page-size")||"25";return d.toInteger(b)}function M(a){a.value&&(E(a,a.value)||(a.paused?a.value=null:(K(a),a.load().done(M.bind(null,a)))))}function N(a,b,c,d){var e=document.createElement("button"),f=document.createElement("i");return e.className="btn btn-default btn-icon",e.setAttribute("data-action",b),e.title=a.translator.translate(c),f.className=d,e.appendChild(f),e}function O(a){return a._filterViewModel}function P(a,b){var c=a.querySelector("mi-tool-bar mi-tool-bar-filter");b?a.classList.add("show-filter"):a.classList.remove("show-filter"),c&&(c.filterViewModel=b),a._filterViewModel=b}function Q(a){return a._searchCallback}function R(a,b){var c=a.querySelector("mi-tool-bar mi-searchbox")
;b?a.classList.add("show-search-button"):a.classList.remove("show-search-button"),c&&(c.searchCallback=b),a._searchCallback=b}function S(a,b,c){b&&a[b]&&a[b](c)}function T(a){var b,c=a.querySelector("mi-tool-bar"),d=U(a);c&&(b=a.querySelector("mi-tool-bar").clientHeight,a.classList.contains("loading")&&(b+=16),d.style.height="calc(100% - "+(b+1)+"px)")}function U(a){var b=a.querySelectorAll(".list-group");return 0===b.length?null:b[b.length-1]}function V(a){a.classList.remove("loading"),T(a)}function W(a,b){var c,d,e=0;for(c=0;c<b.length;c++){for(d=0;d<a.searchResult.length;d++)if(a.searchResult[d].key===b[c].key){e++;break}0===e&&a.searchResult.push(b[c])}}return document.registerElement("mi-list-group",{prototype:g}),g});
define('ui/elements/path-history/view-model',['require','lodash','jquery','ui/elements/list-group-item/view-model','ui/elements/list-group/view-model'],function(require){"use strict";var a=require("lodash"),b=require("jquery");require("ui/elements/list-group-item/view-model"),require("ui/elements/list-group/view-model");var c=["key","description","selector","multiselect","checked","has-children","use-html","page-size","delay","radio-child-only"],d=Object.create(HTMLElement.prototype);d.createdCallback=function(){var a;this.style.display="block",a=document.createElement("div"),a.className="list-group",this.appendChild(a),Element.defineProperty(this,"value",{get:k.bind(null,this),set:l.bind(null,this)}),Element.defineProperty(this,"listGroup",{get:m.bind(null,this),set:n}),this._loader=null,Element.defineProperty(this,"loader",{get:o.bind(null,this),set:p.bind(null,this)}),this._listItemIconCallback=null,Element.defineProperty(this,"listItemIconCallback",{get:g.bind(null,this),set:h.bind(null,this)}),this._selectedRadioButton=null,Element.defineProperty(this,"selectedRadioButton",{get:e.bind(null,this),set:f.bind(null,this)})}
;function e(a){return a._selectedRadioButton}function f(a,b){a._selectedRadioButton=b}function g(a){return a._listItemIconCallback}function h(a,b){a._listItemIconCallback=b||null}d.attachedCallback=function(){this.firstElementChild.addEventListener("click",this)},d.attributeChangedCallback=function(a,b,d){var e,f;if(c.indexOf(a)>-1)for(f=this.firstElementChild.getElementsByTagName("mi-li"),e=0;e<f.length;e++)"description"!==a&&"use-html"!==a||f[e].setAttribute(a,d),f[e].listGroup.setAttribute(a,d)},d.handleEvent=function(a){var b;"click"===a.type&&(a.cancelBubble=!0,a.preventDefault=!0,b=new CustomEvent("click",{bubbles:!0}),b.data=a.target.value,this.dispatchEvent(b),i(this))};function i(a){if(a.selectedRadioButton){var c=b(a).siblings(),d,f,g;c&&(d=b(a).siblings()[0]),d&&(f=d.children),f&&(g=f[0]),g&&e(a)&&j(a,g)}}d.contains=function(a){var b,c=this.value;for(b=0;b<c.length;b++)if(a===c[b].value)return!0;return!1},d.push=function(a){var b;b=document.createElement("mi-li"),
this.firstElementChild.appendChild(b),b.classList.add("selected"),null!==a.hasChildren&&b.setAttribute("icon-class","icon-arrow"),this.getAttribute("description")&&b.setAttribute("description",this.getAttribute("description")),this.getAttribute("use-html")&&b.setAttribute("use-html",this.getAttribute("use-html")),b.setAttribute("has-children",!0),b.value=a,b.listGroup=r(this,a),Object.tryMethod(this,"_listItemIconCallback",b.listItemIcon,a),q(this),j(this,b.listGroup)};function j(b,c){c&&b.selectedRadioButton&&a.includes(c.items,b.selectedRadioButton)&&c.selectRadioButton(b.selectedRadioButton,!0)}d.pop=function(){var a=this.firstElementChild,b=a.getElementsByTagName("mi-li");b.length>1&&(a.removeChild(b[b.length-1]),q(this))},d.moveBack=function(a){var b=this.firstElementChild,c=b.getElementsByTagName("mi-li"),d,e;if(a instanceof Object)for(;c&&c[c.length-1].value!==a;)b.removeChild(c[c.length-1]),q(this);else for(c=c.splice(a+1),d=0;d<c.length;d++)b.removeChild(c[d]),q(this)
;(e=b.querySelector("mi-li:last-of-type").listGroup)&&(e._value=null)},d.clear=function(){this.firstElementChild.innerHTML=""};function k(a){var b=a.firstElementChild.getElementsByTagName("mi-li"),c=[],d;for(d=0;d<b.length;d++)c[c.length]=b[d].value;return c}function l(a,b){var c,d,e=a.firstElementChild,f=!1;if(b instanceof Array){for(d=e.getElementsByTagName("mi-li"),c=0;c<b.length;c++)c>=d.length?(a.push(b[c]),f=!0):b[c]!==d[c].value&&(d[c].value=b[c],d[c].listGroup.reload(),f=!0);if(b.length<d.length){for(f=!0,c=d.length-1;c>b.length-1;c--)e.removeChild(d[c]);d[d.length-1].listGroup.value=null}f&&q(a)}else a.firstChild.innerHTML="",b&&a.push(b),q(a)}function m(a){var b=a.firstElementChild.getElementsByTagName("mi-li"),c=[],d;for(d=0;d<b.length;d++)c[c.length]=b[d].listGroup;return c}function n(){}function o(a){return a._loader}function p(a,b){var c,d=a.firstElementChild.getElementsByTagName("mi-li");for(a._loader=b,
c=0;c<d.length;c++)d[c].listGroup.listItemIconCallback=a.listItemIconCallback,d[c].listGroup.loader=b?b.bind(null,c):null}function q(a){var b=new CustomEvent("change",{bubbles:!0});a.dispatchEvent(b)}function r(a,b){var d=document.createElement("mi-list-group"),e=a.firstElementChild.getElementsByTagName("mi-li").length-1,f;for(f=0;f<c.length;f++)t(a,d,c[f]);return d.setAttribute("allow-add","false"),b&&b.loader?d.loader=b.loader.bind(null,e):a.loader&&(d.loader=a.loader.bind(null,e)),d.listItemIconCallback=a.listItemIconCallback,d.addEventListener("change",s),d}function s(a){a.cancelBubble=!0,a.preventDefault()}function t(a,b,c){var d=a.getAttribute(c);d&&b.setAttribute(c,d)}return document.registerElement("mi-path-history",{prototype:d}),d});
define('ui/elements/tree/view-model',['require','jquery','system/globalization/translator','ui/elements/path-history/view-model','ui/elements/searchbox/view-model','ui/elements/list-group/view-model','ui/elements/tool-bar/view-model','ui/elements/tool-bar-filter/view-model'],function(require){"use strict";var a=require("jquery"),b=require("system/globalization/translator"),c=["key","description","page","page-size","scroll-percent","selector","multiselect","checked","has-children","use-html","delay","radio-child-only"];require("ui/elements/path-history/view-model"),require("ui/elements/searchbox/view-model"),require("ui/elements/list-group/view-model"),require("ui/elements/tool-bar/view-model"),require("ui/elements/tool-bar-filter/view-model");var d=Object.create(HTMLElement.prototype);d.createdCallback=function(){var a,b,c,d,f,h;g(this),b=this.querySelector("mi-tool-bar"),b||(b=document.createElement("mi-tool-bar"),Element.upgrade(b),this.appendChild(b)),this.filterViewModel&&this.classList.add("show-filter"),d=document.createElement("mi-tool-bar-filter"),Element.upgrade(d),d.classList.add("default-buttons-left"),d.filterViewModel=this.filterViewModel,f=this.getAttribute("custom-filter"),"true"===f&&d.setAttribute("custom-filter","true"),
b.insertBefore(d,b.firstChild),this.searchCallback&&this.classList.add("show-search-button"),c=document.createElement("mi-searchbox"),Element.upgrade(c),c.classList.add("default-buttons-left"),c.searchCallback=e.bind(null,this),c.setAttribute("custom-search","true"),c.setAttribute("no-auto-close","true"),b.insertBefore(c,b.firstChild),p(this,c),"false"!==this.getAttribute("allow-add")&&this.classList.add("allow-add"),b.insertBefore(C(this,"addItem","NEWITEM","icon-plus"),b.firstChild),b.insertBefore(C(this,"togglePathHistory","HIDE","icon-up-arrow","hide-button"),b.firstChild),b.insertBefore(C(this,"backInHistory","BACK","icon-back-arrow","back-button"),b.firstChild),a=document.createElement("section"),a.className="nav-list-group",this.appendChild(a),this.pathHistory=document.createElement("mi-path-history"),Element.upgrade(this.pathHistory),this.pathHistory.loader=this._loader,this.pathHistory.value=this._value,this.pathHistory.className="expanded",a.appendChild(this.pathHistory),
p(this,this.pathHistory),h=document.createElement("div"),h.className="tree-list-control",a.appendChild(h),this._value&&x(this)},d.attachedCallback=function(){var a=this.querySelector("section.nav-list-group"),b=this.querySelector("mi-tool-bar");a.addEventListener("selecting",this),a.addEventListener("selected",this),a.addEventListener("click",this),b.addEventListener("click",this),b.addEventListener("resize",this),b.addEventListener("filter-closed",this),this.pathHistory.addEventListener("change",this),B(this)},d.attributeChangedCallback=function(a,b,d){var e,f;"root-name"===a?B(this,d):"allow-add"===a?"false"===d?this.classList.remove("allow-add"):this.classList.add("allow-add"):"custom-filter"===a?(f=this.querySelector("mi-tool-bar mi-tool-bar-filter"))&&f.setAttribute(a,d):c.indexOf(a)>-1&&(this.pathHistory.setAttribute(a,d),(e=this.querySelector("mi-tool-bar mi-searchbox"))&&e.setAttribute(a,d))},d.handleEvent=function(a){
"selecting"===a.type?D(this,a):"selected"===a.type?E(this,a):"click"===a.type?q(this,a):"change"===a.type?x(this):"resize"===a.type&&a.target!==window?t(this,a):"filter-closed"===a.type?this.refreshAll():"focus"===a.type&&a.target.parentElement.classList.contains("mi-searchbox")?(this.pathHistory.value=this.pathHistory.value[0],this.pathHistory.firstElementChild.firstElementChild.style.display="none",setTimeout(t.bind(null,this),0)):"blur"===a.type&&a.target.classList.contains("mi-searchbox")&&t(this)},d.togglePathHistory=function(){var a=!this.pathHistory.classList.contains("expanded"),b=this.querySelector('button[data-action="togglePathHistory"]');b.firstElementChild.className=a?"icon-up-arrow":"icon-arrow",b.title=this.translator.translate(a?"HIDE":"SHOW"),this.pathHistory.className=a?"expanded":"collapsed",t(this)},d.backInHistory=function(){var a=this.value;a.length>1&&w(this,a[a.length-2])},d.refresh=function(){var a=this.value,b=a[a.length-1]
;1===a.length?this.reload():(this.pathHistory.pop(),this.pathHistory.push(b))},d.refreshAll=function(){var a=this.pathHistory.listGroup,b;if(a.length<=1)this.reload();else{for(b=0;b<a.length;b++)a[b].items=null,a[b].resume();a[a.length-1].reload()}},d.reload=function(){A(this)&&this.pathHistory.clear(),B(this)},d.addItem=function(){this.dispatchEvent(new CustomEvent("add-item",{bubble:!0}))},d.loadState=function(a){var b;a=a||{},a.searchTerm&&(b=this.querySelector("mi-searchbox"),b._value=a.searchTerm,b.toggleSearch(),this.searchTerm=a.searchTerm,t(this),this.preSearchValue=a.preSearchValue),this.value=a.value,a.searchTerm&&(this.pathHistory.firstElementChild.firstElementChild.style.display="none")},d.saveState=function(){return{preSearchValue:this.preSearchValue,value:this.value,searchTerm:this.searchTerm}};function e(a,b){a.pathHistory.clear(),a.pathHistory.value={description:b,loader:a._searchCallback.bind(null,b)},a.searchTerm=b,
a.pathHistory.firstElementChild.firstElementChild.style.display="none",t(a)}function f(a){var b,c;a.preSearchValue&&(a.pathHistory.clear(),a.pathHistory.value=a.preSearchValue,a.preSearchValue=null,a.searchTerm="",a.querySelector("mi-searchbox").value=null,b=a.pathHistory.firstElementChild.firstElementChild,b&&(b.style.display="block"),c=new CustomEvent("search-closed",{bubbles:!0}),a.dispatchEvent(c),t(a))}function g(a){a.translator=Object.resolve(b),a._loader=null,a.preSearchValue=null,a.searchTerm="",Element.defineProperty(a,"loader",{get:j.bind(null,a),set:k.bind(null,a)}),a._value=null,Element.defineProperty(a,"value",{get:l.bind(null,a),set:m.bind(null,a)}),Element.defineProperty(a,"listGroup",{get:n.bind(null,a),set:o}),a._filterViewModel=null,Element.defineProperty(a,"filterViewModel",{get:F.bind(null,a),set:G.bind(null,a)}),a._searchCallback=null,Element.defineProperty(a,"searchCallback",{get:H.bind(null,a),set:I.bind(null,a)}),a._listItemIconCallback=null,
Element.defineProperty(a,"listItemIconCallback",{get:h.bind(null,a),set:i.bind(null,a)})}function h(a){return a._listItemIconCallback}function i(a,b){a._listItemIconCallback=b||null,a.pathHistory&&(a.pathHistory.listItemIconCallback=b)}function j(a){return a.pathHistory?a.pathHistory.loader:a._loader}function k(a,b){a.pathHistory&&(a.pathHistory.listItemIconCallback=a._listItemIconCallback,a.pathHistory.loader=b),a._loader=b}function l(a){return a.pathHistory?a.pathHistory.value:a._value}function m(a,b){a.pathHistory&&b&&(a.pathHistory.value=b),a._value=b}function n(a){return a.querySelector(".tree-list-control mi-list-group")}function o(){}function p(a,b){var d,e;for(d=0;d<c.length;d++)(e=a.getAttribute(c[d]))&&b.setAttribute(c[d],e)}function q(a,b){var c;"BUTTON"===b.target.nodeName?(c=b.target.getAttribute("data-action"),r(a,c,b)):"I"===b.target.tagName&&"BUTTON"===b.target.parentElement.tagName?(c=b.target.parentElement.getAttribute("data-action"),
r(a,c,b)):"MI-PATH-HISTORY"===b.target.tagName&&b.data&&w(a,b.data)}function r(a,b,c){b&&a[b]&&a[b](c)}function s(a,b){a.preSearchValue=a.pathHistory.value,b.target._searchDiv&&(b.target._searchDiv.querySelector("input").addEventListener("focus",a),b.target._searchDiv.querySelector("input").addEventListener("blur",a))}function t(b,c){var d=b.querySelector(".tree-list-control"),e=b.querySelector("section.nav-list-group"),g=e.firstElementChild,h=b.children,i=b.querySelector("mi-tool-bar"),j=0,k;if(d){if(c&&(c.open===!1?f(b):s(b,c)),i){for(k=0;k<h.length;k++)h[k]!==e&&(j+=a(h[k]).outerHeight());e.style.height="calc(100% - "+j+"px)"}for(j=0;g;)g!==d&&(j+=g.clientHeight),g=g.nextElementSibling;j=j.toString()+"px",d.style.height="calc(100% - "+j+")"}}function u(a,b){var c,d;for(c=new CustomEvent("navigating",{bubbles:!0,cancelable:!0}),c.newValue=[],d=0;d<a.length&&a[d]!==b;)c.newValue[c.newValue.length]=a[d],d++;return void 0!==b&&(c.newValue[c.newValue.length]=b),c}function v(a,b){
var c,d=a.pathHistory.listGroup[a.pathHistory.listGroup.length-1];b&&b.preventListGroupNull||(d.selectedItems=null),c=new CustomEvent("navigated",{bubbles:!0}),a.dispatchEvent(c)}function w(a,b){var c;c=u(a.value,b),a.dispatchEvent(c)&&(a.pathHistory.moveBack(b),v(a))}function x(a){y(a),z(a)}function y(b){var c=a("button.hide-button",b),d=a("button.back-button",b);c.addClass("pull-right"),1===b.pathHistory.value.length?(d.addClass("disabled"),c.addClass("disabled")):(d.removeClass("disabled"),c.removeClass("disabled"))}function z(a){var b=a.pathHistory.listGroup[a.pathHistory.listGroup.length-1],c=a.querySelector(".tree-list-control");b&&(c.firstElementChild&&c.removeChild(c.firstElementChild),c.appendChild(b),t(a),0!==b.items.length||b.paused?b.scrollIntoView():b.load())}function A(a){return a.getAttribute("root-name")||a.getAttribute("title")}function B(a,b){var c,d,e=a.getAttribute("description")||"description",f=b||A(a);if(f)d=a.value,0===d.length?(c={},c[e]=f,
a.value=c):(d[0]instanceof Object||(d[0]={}),d[0][e]=f,a.value=d);else if(a.value.length>0)return void(a.value=a.value[0])}function C(a,b,c,d,e){var f=document.createElement("button"),g=document.createElement("i");return f.className="btn btn-default btn-icon default-buttons-left "+(e||""),f.setAttribute("data-action",b),f.title=a.translator.translate(c),g.className=d,f.appendChild(g),f}function D(a,b){var c;b.selecting!==!0&&b.selecting!==!1&&(b.cancelBubble=!0,c=u(a.value,b.newValue),a.dispatchEvent(c)||b.preventDefault())}function E(a,b){var c;if(b.target.classList.contains("search-list"))return void(b.cancelBubble=!0);null!==b.selecting&&void 0!==b.selecting||(b.cancelBubble=!0,a.pathHistory.push(b.target.value),v(a,b),a.preSearchValue&&(c=new CustomEvent("search-selected",{bubbles:!0}),c.searchResult=[b.target.value],a.dispatchEvent(c)))}function F(a){return a._filterViewModel}function G(a,b){var c=a.querySelector("mi-tool-bar mi-tool-bar-filter")
;b?a.classList.add("show-filter"):a.classList.remove("show-filter"),c&&(c.filterViewModel=b),a._filterViewModel=b}function H(a){return a._searchCallback}function I(a,b){b?a.classList.add("show-search-button"):a.classList.remove("show-search-button"),a._searchCallback=b}return Element.registerElement("mi-tree",{prototype:d}),d});

define('text!ui/elements/filter/filter-btn-no-ko-view.html',[],function () { return '<div class="icon-filter-container">\r\n    <button class="icon-container btn btn-icon">\r\n        <i class="icon-collection-filter"></i>\r\n    </button>\r\n</div>\r\n';});


define('text!ui/elements/filter/filter-body-no-ko-view.html',[],function () { return '<!--<mi-select data-optionscaption="Select" data-selectedoptions="" data-disabled="false" data-required="false" data-visible="true" data-multiple="false"></mi-select>-->\r\n<div class="filter-container">\r\n\r\n    <div class="filters-noko">\r\n        <!--<div class="clear-all">\r\n            <a></a>\r\n        </div>-->\r\n        <div class="tag-section tag-area">\r\n        </div>\r\n        <div class="filter-content">\r\n            <div class="sort-header ">\r\n                \r\n            </div>\r\n        </div>\r\n        <div class="filter-header">\r\n            <header></header>\r\n            <header class="dotted-border"> </header>\r\n        </div>\r\n        <div class="filter-body">\r\n            \r\n        </div>\r\n    </div>\r\n</div>\r\n';});


define('text!ui/elements/filter/filter-group-no-ko-view.html',[],function () { return '<div class="filter-section">\r\n    <header></header>\r\n    <div class="filter-item">\r\n        <form class="form-item">\r\n            <div>\r\n                <!--<mi-checkbox data-bind="miCheckboxProperty: {checked: isSelected, text: text}"></mi-checkbox>-->\r\n            </div>\r\n        </form>\r\n        <div class="second-dotted-border"></div>\r\n    </div>\r\n</div>';});

define('ui/elements/filter/filter-item-no-ko',['require'],function(require){"use strict";function a(a,b){a=a||null,this.caption=b,this.value=a.value,this.text=a.text,this.isSelected=a.isSelected}return a});
define('ui/elements/filter/filter-group-no-ko',['require','./filter-item-no-ko'],function(require){"use strict";var a=require("./filter-item-no-ko");function b(b){var c;for(b=b||null,this.caption=b.caption,this.type=b.type,this.items=[],this.hideCaption=b.hideCaption,c=0;c<b.options.length;c++)this.items.push(new a(b.options[c].option,this.caption))}return b});
define('ui/elements/filter/filter-collection-no-ko',['require','./filter-group-no-ko'],function(require){"use strict";var a=require("./filter-group-no-ko");function b(){this.filterGroups=[]}return b.prototype.populateGroups=function(b){var c,d;for(c=0;c<b.filteroptions.length;c++)d=new a(b.filteroptions[c]),this.filterGroups.push(d)},b.prototype.clear=function(){this.filterGroups=[]},b});

define('text!ui/elements/checkbox/template.html',[],function () { return '<div class="checkbox-noko-container">\r\n    <input type="checkbox" />\r\n    <label class="">\r\n        <span class="checkbox-label"></span>\r\n        <span class="chkbox-text"></span>\r\n    </label>\r\n   \r\n</div>';});

define('ui/elements/checkbox/view-model',['require','jquery','text!./template.html','knockout'],function(require){"use strict";var a=require("jquery"),b=require("text!./template.html"),c=require("knockout"),d=Object.create(HTMLElement.prototype);d.createdCallback=function(){this.implementation=Object.resolve(e),this.implementation.element=this,this.implementation.$element=a(this),Object.tryMethod(this.implementation,"created")},d.attachedCallback=function(){Object.tryMethod(this.implementation,"attached")},d.detachedCallback=function(){Object.tryMethod(this.implementation,"detached")},d.attributeChangedCallback=function(a,b,c){Object.tryMethod(this.implementation,a+"Changed",b,c)};function e(){this.element=null,this.$element=null,this.$input=null,this.$container=b,this.inputChangeHandler=f.bind(null,this),this.init={}}e.prototype.created=function b(){var c=this;this.Node=document.createElement("div"),a(this.Node).append(),a(this.element).empty().append(this.$container),this.$input=this.$element.find('input[type="checkbox"]'),this.$label=this.$element.find("label")
;var d=this.getGuid();this.$input.attr("id",d),this.$label.attr("for",d),this.setAccessor("text",g.bind(this,this,"text")),this.setAccessor("checked",g.bind(this,this,"checked")),this.setAccessor("disabled",g.bind(this,this,"disabled")),this.setAccessor("value",g.bind(this,this,"value")),this.setAccessor("name",g.bind(this,this,"name"))},e.prototype.attached=function a(){this.$input.on("change",this.inputChangeHandler)},e.prototype.detached=function a(){this.$input.off("change",this.inputChangeHandler)};function f(a,b){a.$element.parents("mi-widget").length&&b.stopPropagation(),a.checked(b.currentTarget.checked),a.$element.trigger("checkedChange",[b.currentTarget.checked,a.value()])}function g(a,b,c){return"text"===b?void a.$element.find(".chkbox-text").html(c):"checked"===b?void(a.$input.get(0).checked="checked"===c||h(c)):"disabled"===b?void a.$input.prop("disabled",h(c)):void(a.$input&&a.$input.prop(b,c))}function h(a){return"false"!==a&&a!==!1&&("true"===a||a===!0)}
e.prototype.setAccessor=function(a,b){this[a]=c.observable(),Object.defineProperty(this.element,a,{get:i.bind(this,this,a),set:j.bind(this,this,a)}),this[a+"Changed"]=k.bind(this,this,a),this[a].subscribe(l.bind(this,this,b)),this[a](this.element.getAttribute(a))};function i(a,b){return a[b]()}function j(a,b,c){a[b](c)}function k(a,b,c,d){a[b](d)}function l(a,b,c){b&&b.call(a,c)}return e.prototype.getGuid=function a(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},e.prototype.s4=function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},Element.registerElement("mi-checkbox-noko",{prototype:d}),e});

define('text!ui/elements/radio/template.html',[],function () { return '<div class="radio-noko-container">\r\n    <input type="radio" tabindex="0" />\r\n    <label class="">\r\n        <span class="radio-label"></span>\r\n        <span class="radio-text"></span>\r\n    </label>\r\n\r\n</div>';});

define('ui/elements/radio/view-model',['require','jquery','text!./template.html','knockout'],function(require){"use strict";var a=require("jquery"),b=require("text!./template.html"),c=require("knockout"),d=Object.create(HTMLElement.prototype);d.createdCallback=function(){this.implementation=Object.resolve(e),this.implementation.element=this,this.implementation.$element=a(this),Object.tryMethod(this.implementation,"created")},d.attachedCallback=function(){Object.tryMethod(this.implementation,"attached")},d.detachedCallback=function(){Object.tryMethod(this.implementation,"detached")},d.attributeChangedCallback=function(a,b,c){Object.tryMethod(this.implementation,a+"Changed",b,c)};function e(){this.element=null,this.$element=null,this.$input=null,this.$container=b,this.init={}}e.prototype.created=function(){var b=this;this.Node=document.createElement("div"),a(this.Node).append(this.$container),a(this.element).html(this.Node),this.$input=this.$element.find('input[type="radio"]'),this.$label=this.$element.find("label");var c=this.getGuid();this.$input.attr("id",c),
this.$label.attr("for",c),this.$input.on("change",function(a){b.checked(a.currentTarget.checked),b.$element.trigger("checkedChange",[a.currentTarget.checked,b.value(),b.name()])}),this.setAccessor("text",f.bind(this,this,"text")),this.setAccessor("checked",f.bind(this,this,"checked")),this.setAccessor("value",f.bind(this,this,"value")),this.setAccessor("name",f.bind(this,this,"name"))};function f(a,b,c){return a.init[b]&&"null"!==c?"text"===b?void a.$element.find(".radio-text").html(c):"checked"===b?void(a.$input.get(0).checked=g(c)):"disabled"===b?void a.$input.prop("disabled",g(c)):void(a.$input&&a.$input.prop(b,c)):void(a.init[b]=!0)}function g(a){if(!a)return!1;var b=a.toString();return"false"!==b&&"true"===b}return e.prototype.setAccessor=function(a,b){this[a]=c.observable(),this[a+"_canSet"]=!0,Object.defineProperty(this.element,a,{get:function(){return this[a]()}.bind(this),set:function(b){this[a+"_canSet"]=!1,this[a](b),this.element.setAttribute(a,b)}.bind(this)}),
this[a+"Changed"]=function(b,c){this[a+"_canSet"]=!1,this[a](c),this.element[a]=c}.bind(this),this[a].subscribe(function(c){b&&b.call(this,c),this.element.setAttribute(a,c),this.element[a]=c}.bind(this)),this[a](this.element.getAttribute(a)),b&&b.call(this,this.element.getAttribute(a))},e.prototype.attached=function(){},e.prototype.getGuid=function a(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},e.prototype.s4=function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},Element.registerElement("mi-radio-noko",{prototype:d}),e});
define('ui/elements/filter/filter-no-ko',['require','lodash','jquery','text!./filter-btn-no-ko-view.html','text!./filter-body-no-ko-view.html','text!./filter-group-no-ko-view.html','./filter-collection-no-ko','system/lang/converter','system/globalization/translator','spa/conductor','spa/region','ui/elements/select/view-model','ui/elements/checkbox/view-model','ui/elements/radio/view-model'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./filter-btn-no-ko-view.html"),d=require("text!./filter-body-no-ko-view.html"),e=require("text!./filter-group-no-ko-view.html"),f=require("./filter-collection-no-ko"),g=require("system/lang/converter"),h=require("system/globalization/translator"),i=require("spa/conductor"),j=require("spa/region");require("ui/elements/select/view-model"),require("ui/elements/checkbox/view-model"),require("ui/elements/radio/view-model");var k=Object.create(HTMLElement.prototype);k.createdCallback=function(){var c=this;this.resizeProxy=b.proxy(a.debounce(this.resize,100),this),this.scrollProxy=b.proxy(this.scroll,this),this.translator=Object.resolve(h),this.isClicked=!1,this.element=this,this.$element=null,this.isVisible=!1,this.isFilterScrollable=this.getFilterScrollable(),this.loader=null,this.filterOptions=[],this.filterCollection=new f,this.filterVMRegion=null,this.tags=[],
this.customHTML=this.getAttribute("custom-html"),this.customFilter=this.getAttribute("custom-filter"),this.documentClickHandlerFn=r.bind(null,this),c.conductor=Object.resolve(i),c._filterViewModel=null,Element.defineProperty(c,"filterViewModel",{get:n.bind(null,c),set:o.bind(null,c)}),this._loader=null,Element.defineProperty(c,"loader",{get:t.bind(null,c),set:u.bind(null,c)}),this.callback=null,Element.defineProperty(c,"filterCB",{get:function(){return c.callback},set:function(a){c.callback=a}}),this._popupWidth=null,Element.defineProperty(c,"popupWidth",{get:function(){return c._popupWidth},set:function(a){c._popupWidth=a}}),this._showHeading=!0,Element.defineProperty(c,"showHeading",{get:function(){return c._showHeading},set:function(a){void 0!==a&&(c._showHeading=g.toBoolean(a,"true"))}}),this._showTags=!0,Element.defineProperty(c,"showTags",{get:function(){return c._showTags},set:function(a){void 0!==a&&(c._showTags=g.toBoolean(a,"true"))}}),this._maxHeight=null,
Element.defineProperty(c,"maxHeight",{get:function(){return c._maxHeight},set:function(a){c._maxHeight=a}}),this._internalIcon=null,Element.defineProperty(c,"icon",{get:function(){return c._internalIcon}.bind(c),set:function(a){l(c,a)}.bind(c)}),this._disabled=b(this).is("[disabled]"),Element.defineProperty(c,"disabled",{get:function(){return c._disabled}.bind(c),set:function(a){m(c,a)}.bind(c)}),c._internalIcon&&l(c,c._internalIcon)},k.attachedCallback=function(){this.setElement(),this.htmlToDisplay=this.element.innerHTML,this.element.innerHTML=c,this.attachClickHandlers(),l(this,this._internalIcon),m(this,this._disabled)},k.detachedCallback=function(){this.customFilter&&(q(this),this.conductor.unloadScreen(this.filterViewModel),this.conductor.closeScreen(this.filterViewModel)),b(document).find("#shell-screen").off("mousedown.mifilter touchstart click",this.documentClickHandlerFn),W(this),this.resizeProxy=null,this.scrollProxy=null,this.translator=null,this.isClicked=null,
this.isVisible=!1,this.isFilterScrollable=null,this.loader=null,this.filterOptions=null,this.filterCollection&&(this.filterCollection.clear(),this.filterCollection=null),this.filterVMRegion=null,this.tags=null,this.customHTML=null,this.customFilter=null,this.documentClickHandlerFn=null,this.conductor=null,this._loader=null,this.callback=null,this._popupWidth=null,this._showHeading=null,this._showTags=null,this._maxHeight=null,this._internalIcon=null,this._disabled=null,this._filterViewModel=null,this.filterViewModel=null,this.$element=null},k.attributeChangedCallback=function(a,b,c){var d=this;"custom-html"===a?(d.customHTML=c,W(d),"true"===c&&z(d)):"custom-filter"===a?(d.customFilter=c,W(d),"true"===c&&d.isVisible&&(d.conductor.openScreen(d._filterViewModel),d.conductor.loadScreen(d._filterViewModel),z(d))):"icon"===a?l(d,c):"disabled"===a&&m(d,c)};function l(a,c){a._internalIcon=c?c.trim():"icon-collection-filter",b(a).find("button i").removeAttr("class").addClass(a._internalIcon)}
function m(a,c){void 0!==c&&(a._disabled=c),a._disabled?b(a).find("button").addClass("disabled"):b(a).find("button").removeClass("disabled")}k.load=function(){var a;return this.loader?(a=this.loader(),a.promise()):b.Deferred().done().promise()},k.setElement=function(){this.$element=b(this.element)},k.attachClickHandlers=function(){this.$element.find(".icon-container").on("click",v.bind(null,this)),b(document).find("#shell-screen").on("mousedown.mifilter touchstart click",this.documentClickHandlerFn),this.find=s.bind(null,this)},k.detachClickHandlers=function(){},k.resize=function(a){b(a).find(".icon-container").is(":visible")&&a.isVisible&&X(this)},k.scroll=function(a){g.toBoolean(a.isFilterScrollable,"true")?a.resize(a):(w(a),a.isVisible=!1)},k.getFilterScrollable=function(){return this.getAttribute("isfilterscrollable")||!0},k.closeFilter=function(){w(this)};function n(a){return a._filterViewModel}function o(a,b){b?(a._filterViewModel=b,
"true"===a.getAttribute("custom-filter")&&(a.conductor.openScreen(a._filterViewModel),a.conductor.loadScreen(a._filterViewModel))):a._filterViewModel=null}function p(a){var c=new j;a.filterVMRegion=c,c.setElement(b(".filter-outer-container .filters-noko")),a.conductor.activateScreen(a.filterViewModel),a.conductor.attachScreen(a.filterViewModel,c)}function q(a){a.conductor.deactivateScreen(a.filterVMRegion),a.conductor.detachScreen(a.filterVMRegion)}function r(a,c,d){a.isClicked?a.isClicked=!1:b(".filter-outer-container").find(c.target).length||b(".filter-outer-container").find(d).length||b(c.target).closest(".icon-filter-container").length||w(a)}function s(a,c){return b(a.htmlToDisplay).find(c)[0]}function t(a){return a._loader}function u(a,b){a._loader=b,a.isPopulated=!1,a.filterCollection&&a.filterCollection.clear()}function v(a,b){b.stopPropagation(),a._disabled||(a.isVisible?w(a):x(a))}function w(a){a.isVisible=!1,b(window).off("resize",a.resizeProxy.bind(null,a)),
b(a).parents().off("scroll",a.scrollProxy.bind(null,a)),a.contentContainer&&b(a.contentContainer).off(" click","**"),"true"===a.customFilter&&q(a),W(a)}function x(a){a.isClicked=!0,a.isVisible=!0,b(document).find("#shell-screen").trigger("mousedown.mifilter"),"true"===a.customHTML||"true"===a.customFilter?z(a):a.load().done(y.bind(null,a))}function y(a,b){a.filterOptions=b,z(a)}function z(a){V(a),"true"===a.customHTML?b(".filter-outer-container .filters-noko").empty().append(a.htmlToDisplay):"true"===a.customFilter?p(a):(a.filterOptions.sortOptions&&a.filterOptions.sortOptions.length?B(a):b(".filter-outer-container .sort-header").hide(),E(a)),Y(a),X(a),A(a)}function A(a){null!==a._maxHeight&&b(".filter-outer-container .filter-body").css({"max-height":a._maxHeight+"px"})}function B(a){var c=b(".filter-outer-container .sort-header")[0],d,e;for(b(c).append('<mi-select class="sort-dropdown"></mi-select>'),d=b(c).find(".sort-dropdown")[0],e=0;e<a.filterOptions.sortOptions.length;e++);
b(d).data("options",a.filterOptions.sortOptions),b(d).attr("data-options",JSON.stringify(a.filterOptions.sortOptions)),C(a)}function C(a){b(".filter-outer-container .sort-header .sort-dropdown").on("valueChange",function(c){c.preventDefault(),D(a,"sort",b(this).val())})}function D(a,b,c){Object.tryMethod(a,"callback",b,c)}function E(a){a.isPopulated||(F(a),a.isPopulated=!0),G(a),L(a),a.contentContainer.find(".clear-all a").on("click",Q.bind(null,a))}function F(a){a.filterCollection.populateGroups(a.filterOptions)}function G(a){var b,c=a.filterCollection,d=c.filterGroups;for(a.tags=[],b=0;b<d.length;b++)H(a,d[b],b)}function H(a,c,d){var f=a.contentContainer.find(".filter-body").get(0),g=b(e),h,i,j;if(g.data("group-index",d),i=g.find("header"),j=g.find(".form-item div").get(0),I(i,c.caption),"select"===a.filterCollection.filterGroups[d].type)J(a,j,c,d);else for(h=0;h<c.items.length;h++)K(a,j,c.items[h],h,d);b(f).append(g)}function I(a,c){b(a).append(c)}function J(a,c,d,e){
for(var f=d.hideCaption?b('<mi-select data-optionsvalue="value" data-optionstext="text"></mi-select><br />').data({"group-index":e}):b('<mi-select data-optionsvalue="value" data-optionstext="text" data-optionscaption="'+a.filterCollection.filterGroups[e].caption+'"></mi-select><br />').data({"group-index":e}),g=0;g<d.items.length;g++)if(d.items[g].isSelected){b(f[0]).data("value",d.items[g].value),b(f[0]).attr("data-value",d.items[g].value),T(a,{target:f[0]},d.items[g].value,d.caption,d.items[g].text);break}b(f).data("options",d.items),b(f).attr("data-options",JSON.stringify(d.items)),b(c).append(f)}function K(a,c,d,e,f){var g,h;"checkbox"===a.filterCollection.filterGroups[f].type?g=b('<mi-checkbox-noko  value="'+d.value+'" text="'+d.text+'" ></mi-checkbox-noko><br />').data({"group-index":f,"item-index":e,item:d
}):"radio"===a.filterCollection.filterGroups[f].type&&(g=b('<mi-radio-noko  value="'+d.value+'" text="'+d.text+'" name="'+a.filterCollection.filterGroups[f].caption+'" ></mi-radio-noko>').data({"group-index":f,"item-index":e,item:d})),b(c).append(g),d.isSelected&&"checkbox"===a.filterCollection.filterGroups[f].type?(T(a,{target:g[0]},d.value,h,d.text),b(g[0]).attr("checked",d.isSelected)):d.isSelected&&"radio"===a.filterCollection.filterGroups[f].type&&(h=a.filterCollection.filterGroups[f].caption,T(a,{target:g[0]},d.value,h,d.text),g[0].setAttribute("checked",d.isSelected)),b(c).append(g)}function L(a){var b=a.contentContainer.find(".filter-body"),c,d,e;c=b.find("mi-checkbox-noko"),c&&(Element.upgrade(c),c.on("checkedChange",O.bind(null,a))),d=b.find("mi-radio-noko"),d&&(Element.upgrade(d),d.on("checkedChange",N.bind(null,a))),(e=b.find("mi-select"))&&(Element.upgrade(e),e.on("valueChange",M.bind(null,a)))}function M(c,d,e){d.preventDefault()
;var f=b(d.target).data(),g=parseInt(f["group-index"]),h=c.filterCollection.filterGroups[g],i=h.caption;if(e){R(c,i);var j=a.find(h.items,function(a){if(a&&a.value===e)return a});T(c,d,e,i,j.text)}else{P(c,e);var k=b(d.target).data("tag");k&&k.remove()}for(var l=h.type,m=c.filterCollection.filterGroups[g].items,n,o=0;o<m.length;o++)m[o].isSelected=!1,void 0!==m[o].value&&null!==m[o].value&&void 0!==e&&null!==e&&m[o].value.toString()===e.toString()&&(m[o].isSelected=!0,n=m[o]);c.filterCollection.filterGroups[g].items=m,S(c,l,n)}function N(a,c,d,e,f){if(d)R(a,f),T(a,c,e,f,e);else{P(a,e);b(c.target).data("tag").remove()}for(var g=b(c.target).data(),h=parseInt(g["group-index"]),i=a.filterCollection.filterGroups[h],j=i.type,k=a.filterCollection.filterGroups[h].items,l,m=0;m<k.length;m++)k[m].isSelected=!1;a.filterCollection.filterGroups[h].items=k,a.filterCollection.filterGroups[h].items[g["item-index"]].isSelected=d,g.item.isSelected=d,S(a,j,g.item)}function O(a,c,d,e){var f=c.target.text
;if(d)T(a,c,e,null,f);else{P(a,e);b(c.target).data("tag").remove()}var g=b(c.target).data(),h=parseInt(g["group-index"]),i=a.filterCollection.filterGroups[h],j=i.type;a.filterCollection.filterGroups[h].items[parseInt(g["item-index"])].isSelected=d,g.item.isSelected=d,S(a,j,g.item)}function P(a,b){var c=a.tags.indexOf(b);c>=0&&a.tags.splice(c,1),a.tags.length||(a.contentContainer.find(".tag-section").hide(),a.contentContainer.find(".clear-all").hide(),Y(a),X(a))}function Q(a){for(var c=a.contentContainer.find(".tag-section").find(".tag"),d=0;d<c.length;d++){var e=b(c[d]).data();U(a,e.value,e.item,{target:c[d]})}}function R(a,b){var c=a.contentContainer.find(".tag-section").find('.tag[name="'+b+'"]'),d=c.data("value"),e=a.tags.indexOf(d);a.tags.splice(e,1),c.remove()}function S(a,b,c){var d,e=a.filterCollection,f=e.filterGroups;Object.tryMethod(a,"callback",b,c,a.tags)}function T(a,c,d,e,f){a.contentContainer.find(".tag-section").show(),a.contentContainer.find(".clear-all").show(),
a.tags.push(d);var g=b('<div class="tag tag-style"><span><span>'+f+'</span></span><i class="icon-node-error icon-style"></i></div>');g.attr("name",e).data({value:d,item:c}).find(".icon-style").on("click",U.bind(null,a,d,c)),b(c.target).data("tag",g),g.appendTo(a.contentContainer.find(".tag-section"))}function U(a,c,d,e){b(e.target).closest(".tag").remove(),P(a,c);var f=b(d.target).data(),g=parseInt(f["group-index"]),h=a.filterCollection.filterGroups[g],i=h.type;if("checkbox"===i||"radio"===i?d.target.checked=!1:(b(d.target).data("value",""),b(d.target).attr("data-value","")),"checkbox"===i)a.filterCollection.filterGroups[g].items[parseInt(f["item-index"])].isSelected=!1;else if("radio"===i||"select"===i){for(var j=a.filterCollection.filterGroups[g].items,k=0;k<j.length;k++)j[k].isSelected=!1;a.filterCollection.filterGroups[g].items=j}S(a,i,b(d.target).data().item)}function V(a){var c,e;e=b(".content-wrapper"),c=document.createElement("div"),b(c).addClass("filter-outer-container"),
a.contentContainer=b(c),b(e).after(c),b(c).append(d).on("mousedown.mifilter",function a(b){b.stopPropagation()}),b(c).find(".clear-all a").html(a.translator.translate("MF_CLEAR_ALL")),b(b(c).find(".filter-header header")[0]).text(a.translator.translate("FILTER_HEADER_CAPTION")),b(b(c).find(".filter-header")[0]).removeClass("hide"),a.contentContainer.find(".tag-section").removeClass("hide"),a.showHeading||b(b(c).find(".filter-header")[0]).addClass("hide"),a.showTags||a.contentContainer.find(".tag-section").hide().addClass("hide")}function W(a){b(".filter-outer-container").remove()}function X(a){var c=50,d,e;Y(a),Z(a),a.ctrlOffset&&a.ctrlOffset.top+a.filtersHeight+c>=b(window).height()?$(a):_(a),b(window).on("resize",a.resizeProxy.bind(null,a)),b(a).parents().on("scroll",a.scrollProxy.bind(null,a))}function Y(a){a.outerContainer=b(a.contentContainer),a.ctrlOffset=b(a).find(".icon-container").offset(),a.ctrlWidth=b(a).find(".icon-container").width()+25,
null!==a._popupWidth&&b(a.outerContainer).find(".filters-noko").css("width",a._popupWidth+"px"),b(a.outerContainer).css({position:"absolute"}),a.filtersWidth=b(a.outerContainer).find(".filters-noko").width(),a.filtersHeight=b(a.outerContainer).find(".filters-noko").height()}function Z(a){b(a.outerContainer).find(".filters-noko").removeClass("top-left top-right bottom-left bottom-right")}function $(a){var b;a.ctrlOffset&&(b=a.ctrlOffset.top-a.filtersHeight-10,a.ctrlOffset&&a.ctrlOffset.left+a.ctrlWidth-a.filtersWidth<80?aa(a,"top-left",b):ba(a,"top-right",b))}function _(a){var b;a.ctrlOffset&&(b=a.ctrlOffset.top+50-6,a.ctrlOffset&&a.ctrlOffset.left+a.ctrlWidth-a.filtersWidth<80?aa(a,"bottom-left",b):ba(a,"bottom-right",b))}function aa(a,b,c){var d;d=a.ctrlOffset.left,ca(a,b),da(a,d,c)}function ba(a,b,c){var d;d=a.ctrlOffset.left-Math.abs(a.ctrlWidth-a.filtersWidth),null!==a._popupWidth&&(d-=12),ca(a,b),da(a,d,c)}function ca(a,c){var d;d=b(a.outerContainer).find(".filters-noko"),
b(d).addClass(c)}function da(a,c,d){b(a.outerContainer).css({left:c,top:d})}return document.registerElement("mi-filter-no-ko",{prototype:k}),k});
define('assets/asset-hierarchy-control',['require','jquery','spa/ko/knockout-view-model','system/knockout/knockout-manager','spa/region','application/application-events','application/application-context','assets/services/hierarchy-service','assets/asset-hierarchy-control-filter','assets/services/asset-context-dto','system/globalization/translator','toastr','text!./views/asset-hierarchy-control.html','text!./views/asset-hierarchy-control-filter.html','text!./views/asset-hierarchy-control-search.html','ramda','devExWebJS','ui/elements/tree/view-model','ui/elements/filter/filter-no-ko','ui/elements/searchbox/view-model','unified-asset-context-browser'],function(require){"use strict";var a=require("jquery"),b=require("spa/ko/knockout-view-model"),c=require("system/knockout/knockout-manager"),d=require("spa/region"),e=require("application/application-events"),f=require("application/application-context"),g=require("assets/services/hierarchy-service"),h=require("assets/asset-hierarchy-control-filter"),i=require("assets/services/asset-context-dto"),j=require("system/globalization/translator"),k=require("toastr"),l=require("text!./views/asset-hierarchy-control.html"),m=require("text!./views/asset-hierarchy-control-filter.html"),n=require("text!./views/asset-hierarchy-control-search.html"),o=require("ramda");require("devExWebJS"),require("ui/elements/tree/view-model"),require("ui/elements/filter/filter-no-ko"),require("ui/elements/searchbox/view-model"),require("unified-asset-context-browser");var p={selector:"none",multiSelect:!1},q=500,r=500,s=1;function t(a,b,c){u.call(this,l),this.service=a,this.tree=null,this.translator=b,
this.kom=c,this.filter=null,this.category=null,this.class=null,this.type=null,this.applyingFilter=!1,this.errorOccured=Object.resolve(e).errorOccured,this.sites=null,this.searchSelectedKey=null,this.selectChildren=null,this.disableSelectAllChildren=null,this.searchTerm=null,this.currentContext=[],this.contextNodes={},this.selectedAsset=null,this.filterConfigLoaded=!1}var u=Object.inherit(b,t);t.dependsOn=[g,j,c],t.create=function b(c){var d=Object.resolve(t);return d.settings=a.extend(null,p,c),d},t.prototype.load=function(){var a=this;this.category=this.kom.observable(),this.class=this.kom.observable(),this.type=this.kom.observable(),this.filter=new h(this.category,this.class,this.type),this.selectChildren=this.kom.observable(this.settings.selectChildren),this.disableSelectAllChildren=this.kom.observable(!0)},t.prototype.attach=function a(b,c){var e=this;this.settings.contentArea?(this.region=new d,this.region.setElement(b.$element.find(this.settings.contentArea))):this.region=b,
u.prototype.attach.call(this,this.region),this.contextBrowser=this.region.$element.find("asset-hierarchy-control")[0],this.isFirstLoad=!0,this.filterConfigLoaded=!1,Element.upgrade(this.contextBrowser),this.contextBrowser.filterTemplate=m,this.contextBrowser.searchTemplate=n,this.contextBrowser.spinnerTemplate='<span class="loading-med loading-active center-block" ></span>',this.contextBrowser.enableMultiSelect="addOnly"===this.settings.selector,this.contextBrowser.itemSelectorIcon='<i class="icon-plus"></i>',this.contextBrowser.addToolbarButton(v(this)),this.contextBrowser.itemExpandCB=G.bind(null,this),this.contextBrowser.filterConfig=y.bind(null,this),this.contextBrowser.filterCB=w.bind(null,this),this.contextBrowser.searchCB=F.bind(null,this),this.contextBrowser.addEventListener("selected",this),this.contextBrowser.addEventListener("search-cleared",this),!c&&z(this),this.disableSelectAllChildren.subscribe(function(a){
e.region&&e.region.$element&&e.region.$element.find(".add-all-children-btn").attr("disabled",!!a)})};function v(b){var c=a('<button><i class="icon-plus"></i></button>').addClass("btn btn-default btn-icon add-all-children-btn").attr("title",b.translate("ADD_ALL_CHILDREN")).attr("disabled",b.disableSelectAllChildren()).on("click",b.addAllChildren.bind(null,b));return b.settings.enableAddAllChildren&&!b.selectChildren()?c[0]:a("<span></span>")[0]}function w(a,b,c){var d,e,f;c&&(d=c[0],e=c[1],f=c[2]),a.applyingFilter=!0,a.category(d||null),a.class(e||null),a.type(f||null),!c&&a.contextBrowser.selected&&"-1"!==a.contextBrowser.selected&&"0"!==a.contextBrowser.selected?a.service.path(a.contextBrowser.selected).done(x.bind(null,a)):z(a)}function x(a,b){if(a.contextBrowser){if(b.length>1){for(var c=[],d=0;d<b.length;d++)b[d].name=b[d].description,b[d].key=b[d].entityKey,b[d].parentKey="-1",b[d].hasChildren=!0,c.push(b[d]);a.currentContext=[].concat(c),a.isFirstLoad=!0,
a.pathToNavigateInitial=c,J(a,a.pathToNavigateInitial).then(function(){z(a).done(function(){a.contextBrowser.navigate(c)})})}}else z(a)}function y(a,b){a.service.taxonomy().done(function(c){a.filterConfigLoaded=!0;var d=[{id:"CATEGORY",title:a.translate("TAXONOMY_CATEGORY"),defaultCaption:a.translate("SEL_TAX_CAT_CAP"),visible:!0},{id:"CLASS",title:a.translate("TAXONOMY_CLASS"),defaultCaption:a.translate("SEL_TAX_CLS_CAP"),visible:!0},{id:"TYPE",title:a.translate("TAXONOMY_TYPE"),defaultCaption:a.translate("SEL_TAX_TYP_CAP"),visible:!0}];b.resolve(c,d);var e=[a.category(),a.class(),a.type()];e[0]&&a.contextBrowser.filter(e)})}function z(b,c,d){var e=a.Deferred(),f=[{name:"Home",description:"Home",entityKey:"-1",key:"-1",hasChildren:!0,canOpen:!1,isExpanded:void 0===d}];return f=c===!1?[]:f,b.contextBrowser&&b.contextBrowser.init(f,!0),e.resolve(f),e}t.prototype.handleEvent=function(a){"selected"!==a.type||this.searchTerm?"filter-closed"===a.type?(this.applyingFilter=!0,
z(this)):"selected"===a.type&&this.searchTerm?B(this,a):"search-cleared"===a.type&&C(this):(this.service.abort(),this.disableSelectAllChildren(!this.settings.multiSelect))};function A(a){return 1===a.newValue.length}function B(a,b){var c=a.contextBrowser.selectedAsset,d=c.entityKey;a.searchSelectedKey=d}function C(a){var b=null===a.contextBrowser.selectedAsset||"-1"===a.contextBrowser.selectedAsset.key&&a.contextBrowser.selectedAsset.key!==a.contextBrowser.selectedAssetKey?a.selectedAsset:a.contextBrowser.selectedAsset,c=b?b.entityKey:"-1";O(a)&&(c="-1"),a.searchTerm=null,a.service.path(c).done(D.bind(null,a))}function D(a,b){if(a.contextBrowser)if(b.length>1){for(var c=[],d=0;d<b.length;d++)b[d].name=b[d].description,b[d].key=b[d].entityKey,b[d].parentKey="-1",b[d].hasChildren=!0,c.push(b[d]);a.currentContext=[].concat(c),a.isFirstLoad=!0,a.pathToNavigateInitial=c,J(a,a.pathToNavigateInitial).then(function(){z(a).done(function(){a.contextBrowser.navigate(c)})})}else z(a)}
t.prototype.detach=function a(){this.service.abort(),this.region.$element.find(".hierarchy-control-filter").off("filter-closed"),this.contextBrowser.removeEventListener("selected",this),this.contextBrowser=null,this.toolbar=null,this.filterElem=null,this.searchElem=null,this.searchTerm=null,this.applyingFilter=!1,this.currentContext=[],this.contextNodes={},this.category(null),this.class(null),this.type(null),u.prototype.detach.call(this,this.region),this.region=null,this.filterConfigLoaded=!1},t.prototype.unload=function a(){this.kom.dispose()},t.prototype.translate=function(a){return this.translator.translate(a)},t.prototype.loadcontext=function(a){this.contextBrowser.selected=a,this.service.path(a).done(N.bind(null,this)).fail(P.bind(null,this))};var E=o.cond([[o.or(o.equals("0"),o.equals(0)),o.always(null)],[o.T,o.identity()]]);t.prototype.setSiteFilter=function(a){a&&(this.sites=o.map(E,a))},t.prototype.loadState=function(a){a=a||{tree:{value:i.default()}},
this.category(a.category),this.class(a.class),this.type(a.type),this.searchTerm=a.searchTerm,this.selectedAsset=a.context},t.prototype.saveState=function(){var a=null===this.contextBrowser.selectedAsset||null!==this.contextBrowser.selectedAsset&&"-1"===this.contextBrowser.selectedAsset.key&&this.contextBrowser.selectedAsset.key!==this.contextBrowser.selectedAssetKey;return{category:this.category(),class:this.class(),type:this.type(),context:a?this.selectedAsset:this.contextBrowser.selectedAsset,searchTerm:this.searchTerm}},t.prototype.getContextValue=function(){var a=null===this.contextBrowser.selectedAsset||"-1"===this.contextBrowser.selectedAsset.key&&this.contextBrowser.selectedAsset.key!==this.contextBrowser.selectedAssetKey;return i.fromHierarchyDTO(a?this.selectedAsset:this.contextBrowser.selectedAsset)},t.prototype.addAllChildren=function(a,b){var c=new CustomEvent("selectallchildren",{bubbles:!0,cancelable:!0,detail:a.contextBrowser.selectedAsset})
;a.contextBrowser&&a.contextBrowser.dispatchEvent(c)};function F(b,c,d,e,f){var g=a.Deferred();return e=s,f=r,b.searchTerm=c,c&&o.isNil(b.sites)?b.service.search(c,e,f).done(L.bind(null,b,g)).fail(P.bind(null,b)):c&&!o.isNil(b.sites)?b.service.search(c,e,f).done(M.bind(null,b,g,b.sites)).fail(P.bind(null,b)):g.resolve(),g}function G(b,c,d,e,g){var h="",i="",j="",k=d||a.Deferred(),l;return b.contextBrowser?(l=c||f.assetcontext)?b.contextNodes[l.entityKey]?(o.isNil(b.sites)?H(b,k,l,b.contextNodes[l.entityKey]):I(b,k,l,b.sites,b.contextNodes[l.entityKey]),delete b.contextNodes[l.entityKey],k):(b.category()&&(h=b.category().code),b.class()&&(i=b.class().code),b.type()&&(j=b.type().code),o.isNil(b.sites)?b.service.children(l.entityKey,h,i,j,s,q).done(H.bind(null,b,k,l)).fail(P.bind(null,b)):b.service.children(l.entityKey,h,i,j,s,q,b.sites).done(I.bind(null,b,k,l,b.sites)).fail(P.bind(null,b)),k):(setTimeout(H.bind(null,b,k,{data:[]})),k):(setTimeout(k.reject.bind(k),0),k)}
function H(a,b,c,d){for(var e=!1,f=a.currentContext&&a.currentContext.length>1,g=!1,h=0,i=0;i<a.currentContext.length-1;i++)a.currentContext[i].entityKey===c.entityKey&&(g=!0,h=i);var j=d.data.map(function(b){return b.name=b.description,b.key=a.searchTerm?R():b.entityKey,b.parentKey=a.searchTerm?c.key:c.entityKey,b.hasChildren=!!b.hasChildren,g&&!e&&f&&!a.searchTerm&&a.currentContext[h].entityKey===b.parentKey&&a.currentContext[h+1].entityKey===b.entityKey&&(e=!0),b});if(!e&&f&&g&&!a.searchTerm&&!a.applyingFilter){var k=a.currentContext[h+1];j.push(k)}if(j.length>=q){var l=a.searchTerm?c.key:c.entityKey,m={key:l.toString()+"_more_data",isAlertMessage:!0,name:a.translate("ASSET_HIERARCHY_TOO_MANY_MSG"),pathLabel:a.translate("ASSET_HIERARCHY_TOO_MANY_SUGGESTION"),parentKey:l};j.push(m)}b.resolve(j),a.category()&&0===d.data.length&&a.applyingFilter?z(a,!1):a.applyingFilter=!1}function I(a,b,c,d,e){o.forEach(K.bind(null,d),e.data)
;for(var f=!1,g=a.currentContext&&a.currentContext.length>1,h=!1,i=0,j=0;j<a.currentContext.length-1;j++)a.currentContext[j].entityKey===c.entityKey&&(h=!0,i=j);var k=e.data.map(function(b){return b.name=b.description,b.key=a.searchTerm?R():b.entityKey,b.parentKey=a.searchTerm?c.key:c.entityKey,b.hasChildren=!!b.hasChildren,b.canOpen=!b.disabledIcon,h&&!f&&g&&!a.searchTerm&&a.currentContext[i].entityKey===b.parentKey&&a.currentContext[i+1].entityKey===b.entityKey&&(f=!0),b});if(!f&&g&&h&&!a.searchTerm&&!a.applyingFilter){var l=a.currentContext[i+1];k.push(l)}if(k.length>=q){var m=a.searchTerm?c.key:c.entityKey,n={key:m.toString()+"_more_data",isAlertMessage:!0,name:a.translate("ASSET_HIERARCHY_TOO_MANY_MSG"),pathLabel:a.translate("ASSET_HIERARCHY_TOO_MANY_SUGGESTION"),parentKey:m};k.push(n)}b.resolve(k),a.category()&&0===e.data.length&&a.applyingFilter?z(a,!1):a.applyingFilter=!1}function J(b,c){var d=c.filter(function(a){return a.entityKey!==c[c.length-1].entityKey})
;return a.when.apply(a,d.map(function(a){return b.service.children(a.entityKey,"","","",s,q)})).then(function(){for(var a=0;a<d.length;a++)b.contextNodes[d[a].key]=arguments[a]})}function K(a,b){b.disabledIcon=!o.contains(b.siteKey,a)}function L(a,b,c){if(b.resolve(c.data),a.searchSelectedKey=null,a.contextBrowser){var d=c.data.map(function(a){return a.name=a.description,a.key=R(),a.parentKey="-1",a.hasChildren=!!a.hasChildren,a.pathLabel=a.hierarchyPath,a});if(d.length>=r){var e={key:R()+"_more_data",isAlertMessage:!0,name:a.translate("ASSET_HIERARCHY_TOO_MANY_MSG"),pathLabel:a.translate("ASSET_HIERARCHY_TOO_MANY_SUGGESTION"),parentKey:"-1"};d.push(e)}a.contextBrowser.init(d)}}function M(a,b,c,d){if(o.forEach(K.bind(null,c),d.data),b.resolve(d.data),a.searchSelectedKey=null,a.contextBrowser){var e=d.data.map(function(a){return a.name=a.description,a.key=R(),a.parentKey="-1",a.hasChildren=!!a.hasChildren,a.canOpen=!a.disabledIcon,a.pathLabel=a.hierarchyPath,a});if(e.length>=r){var f={
key:R()+"_more_data",isAlertMessage:!0,name:a.translate("ASSET_HIERARCHY_TOO_MANY_MSG"),pathLabel:a.translate("ASSET_HIERARCHY_TOO_MANY_SUGGESTION"),parentKey:"-1"};e.push(f)}a.contextBrowser.init(e)}}function N(a,b){var c;if(a&&a.contextBrowser){for(var d=[],e=0;e<b.length;e++)b[e].name=b[e].description,b[e].key=b[e].entityKey,b[e].parentKey="-1",b[e].hasChildren=!0,d.push(b[e]);c=[a.category(),a.class(),a.type()],a.currentContext=[].concat(d),a.pathToNavigateInitial=d,a.searchTerm&&null!==a.searchTerm?a.contextBrowser.search(a.searchTerm):c[0]?(z(a,!0,!1),a.filterConfigLoaded&&a.contextBrowser.filter(c)):J(a,a.pathToNavigateInitial).then(function(){z(a).done(function(){a.isFirstLoad?a.contextBrowser.navigate(d):a.pathToNavigateInitial=d})})}}function O(b){return!!a(b.region.element).parents(".asset-finder-screen").length}function P(a,b,c,d){d&&"abort"!==d&&k.error(d,void 0,{positionClass:"toast-top-right "})}function Q(){
return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function R(){return Q()+Q()+""+Q()+Q()+Q()+Q()+Q()+Q()}return t});
define('assets/services/asset-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.entityKey=a.toString(b.entityKey),this.equipmentId=a.toString(b.equipmentId),this.groupid=a.toString(b.equipmentId),this.familyId=a.toString(b.familyId),this.siteKey=a.toInteger(b.siteKey)}return b.fromDataCollection=function a(c){var d,e=[];for(d=0;d<c.length;d++)e[d]=new b(c[d]);return e},b.fromSelectedAsset=function a(c){return new b({entityKey:c.entityKey,equipmentId:c.description,familyId:c.familyId,siteKey:c.siteKey})},b.fromSelectedAssetArray=function a(c){return c.map(b.fromSelectedAsset)},b});
define('assets/services/asset-group-dto',['require','system/lang/converter','assets/services/asset-dto','assets/services/hierarchy-dto','assets/models/family','system/lang/string'],function(require){"use strict";var a=require("system/lang/converter"),b=require("assets/services/asset-dto"),c=require("assets/services/hierarchy-dto"),d=require("assets/models/family");require("system/lang/string");function e(e){e=e||{},this.entityKey=a.toString(e.entityKey),this.groupid=a.toString(e.groupid),this.createdBy=a.toString(e.createdBy),this.modifiedBy=a.toString(e.lastUpdatedBy),this.modifiedOn=a.toDate(e.lastUpdatedDate),this.groupdesc=a.toString(e.groupdesc),this.catalogKey=a.toInteger(e.catalogKey),this.catalogPath=a.toString(e.catalogPath),this.siteKey=a.toInteger(e.siteKey),this.equipmentCount=a.toInteger(e.equipmentCount),this.relationships=e.relationships?d.fromDataCollection(e.relationships):[],this.equipments=e.equipments?b.fromDataCollection(e.equipments):[],this.corrosionloops=e.corrosionloops?f(e.corrosionloops):[],this.hierarchyparents=e.hierarchyparents?c.fromDataCollection(e.hierarchyparents):[],this.selected=null}e.fromDataCollection=function a(b){
var c,d=[];for(c=0;c<b.length;c++)d[c]=new e(b[c]);return d},e.fromAssetContextDTO=function a(b){return new e({entityKey:b.entityKey,createdBy:b.createdBy,groupid:b.description})};function f(b){var c,d=[];for(c=0;c<b.length;c++)d[c]=a.toString(b[c]);return d}return e});
define('security/services/usersite-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key)||"0",this.siteKey=a.toString(b.siteKey)||"0",this.userKey=a.toString(b.userKey)||"0",this.viewOnly=a.toBoolean(b.viewOnly)||!1,this.siteName=a.toString(b.siteName),this.userName=a.toString(b.userName),this.lockSeq=a.toString(b.lockSeq)||"0"}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('security/services/site-dto',['require','./usersite-dto','system/lang/converter'],function(require){"use strict";var a=require("./usersite-dto"),b=require("system/lang/converter");function c(c){c=c||{},this.name=b.toString(c.name),this.key=b.toString(c.key)||"0",this.lockSeq=b.toString(c.lockSeq),this.users=a.fromDataCollection(c.users)}return c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}},c});
define('system/lang/url-codec',["require","exports"],function(require,exports){"use strict";var a=[],b=/\[\]$/,c=/\[/,d=/\]$/,e=function(){function b(){}return b.encode=function(b){return a=[],h("",b).join("&")},b.decode=function(a){return i(a)},b}();function f(a){return"[object Array]"===Object.prototype.toString.call(a)}function g(b,c){c="function"==typeof c?c():null===c?"":void 0===c?"":c,a[a.length]=encodeURIComponent(b)+"="+encodeURIComponent(c)}function h(c,d){var e,i;if(c)if(f(d))for(e=0,i=d.length;e<i;e++)b.test(c)?g(c,d[e]):h(c+"["+("object"==typeof d[e]?e:"")+"]",d[e]);else if(d&&"[object Object]"===String(d))for(var j in d)d.hasOwnProperty(j)&&h(c+"["+j+"]",d[j]);else g(c,d);else if(f(d))for(e=0,i=d.length;e<i;e++)g(d[e].name,d[e].value);else for(var j in d)d.hasOwnProperty(j)&&h(j,d[j]);return a}function i(a){var b={};return a?(a.split("&").forEach(j.bind(null,b)),b):b}function j(a,b){var e=b.split("="),f=decodeURIComponent(e[0]),g=typeof a,h=f.split("]["),i=h.length-1
;if(c.test(h[0])&&d.test(h[i])){h[i]=h[i].replace(d,"");var j=h.shift();null!==j&&(h=j.split("[").concat(h),i=h.length-1)}else i=0;if(2===e.length){var k=decodeURIComponent(e[1]);if(i)for(var l=0;l<=i;l++)f=""===h[l]?g.length:h[l],g=g[f]=l<i?g[f]||(h[l+1]&&isNaN(h[l+1])?{}:[]):k;else"[object Array]"===Object.prototype.toString.call(a[f])?a[f].push(k):!{}.hasOwnProperty.call(a,f)?a[f]=k:a[f]=[a[f],k]}}return e});
define('assets/services/group-service',['require','jquery','system/http/ajax-client','assets/services/asset-group-dto','assets/services/asset-dto','assets/services/hierarchy-dto','security/services/site-dto','catalog/services/dto/user-pref-dto','system/lang/url-codec'],function(require){"use strict";var a=require("jquery"),b=require("system/http/ajax-client"),c=require("assets/services/asset-group-dto"),d=require("assets/services/asset-dto"),e=require("assets/services/hierarchy-dto"),f="api/common/assetgroup",g="api/core/security",h=require("security/services/site-dto"),i=require("catalog/services/dto/user-pref-dto"),j="api/core/userpref/",k=require("system/lang/url-codec");function l(a){this.ajaxClient=a,this.request=null}l.dependsOn=[b],l.prototype.abort=function a(){this.request&&this.request.abort()},l.prototype.getAllGroups=function(b,c,d,e,g,h){var i=a.Deferred(),j="",k="",l;for(d=d||[],l=0;l<d.length;l++)j+="&keys="+d[l];return h=h?"&searchterm="+h:"",e=e?"&relationshipId="+e:"",g=g?"&byCurrUser="+g:"",k="?page="+b+"&pageSize="+c+j+e+g+h,this.ajaxClient.get(f+k).done(n.bind(null,i)).fail(i.reject.bind(i)),i.promise()},l.prototype.getGroupDetails=function b(c){var d=a.Deferred()
;return this.ajaxClient.get(f+"/"+c.toString()).done(o.bind(null,d)).fail(u.bind(null,d)),d.promise()},l.prototype.assets=function b(c,d,e){var g=a.Deferred();return this.ajaxClient.get(f+"/"+c+"/assets?page="+d+"&pageSize="+e).done(q.bind(null,g)).fail(g.reject.bind(g)),g.promise()},l.prototype.allAssets=function b(c){var d=a.Deferred();return this.ajaxClient.get(f+"/"+c+"/assets").done(q.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.assetsByKey=function b(c){var d=a.Deferred();return this.ajaxClient.get(f+"/"+c+"/assetsbykey").done(q.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.getGroupDetailsWithPaging=function(b,c,d){var e=a.Deferred(),g=this;return this.request=this.ajaxClient.get(f+"/"+b.toString()+"?page="+c.toString()+"&pageSize="+d.toString()).done(o.bind(null,e)).fail(e.reject.bind(e)).always(p.bind(null,g)),e.promise()},l.prototype.addGroup=function b(c){var d=a.Deferred()
;return this.ajaxClient.post(f,c).done(o.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.editGroup=function b(c){var d=a.Deferred();return this.ajaxClient.put(f,c).done(t.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.removeGroup=function b(c){var d=a.Deferred();return this.ajaxClient.delete(f+"/"+c.toString()).done(t.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.addAssets=function b(c,d,e){var g=a.Deferred();return e=e?"?contextKey="+e.toString():"",this.ajaxClient.post(f+"/"+c.toString()+"/assets"+e,d).done(t.bind(null,g)).fail(g.reject.bind(g)),g.promise()},l.prototype.removeAssets=function b(c,d){var e=a.Deferred(),g=null,h,i=[],j;for(j=d.splice(0,50);j&&j.length>0;)h=j.map(m),g=k.encode({keys:h}),i[i.length]=this.ajaxClient.delete(f+"/"+c.toString()+"/assets?"+g),j=d.splice(0,50);return a.when.apply(a,i).done(t.bind(null,e)).fail(e.reject.bind(e)),e.promise()},l.prototype.addAssociations=function b(c,d){var e=a.Deferred()
;return this.ajaxClient.post(f+"/"+c+"/hierarchy",d).done(t.bind(null,e)).fail(e.reject.bind(e)),e.promise()},l.prototype.removeAssociations=function b(c,d){var e=a.Deferred(),g=null;return g=k.encode({keys:d}),this.ajaxClient.delete(f+"/"+c+"/hierarchy?"+g).done(t.bind(null,e)).fail(e.reject.bind(e)),e.promise()},l.prototype.getAssociations=function b(c){var d=a.Deferred();return this.ajaxClient.get(f+"/"+c.toString()+"/hierarchy").done(s.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.getSites=function b(){var c=a.Deferred();return this.ajaxClient.get(g+"/sites",{}).done(r.bind(null,c)).fail(c.reject.bind(c)),c.promise()},l.prototype.getPreference=function b(c,d){var e=a.Deferred(),f=j+"get/"+c+"/1?name="+d;return this.ajaxClient.get(f,{}).done(t.bind(null,e)).fail(e.reject.bind(e)),e.promise()},l.prototype.setPreference=function b(c){var d=a.Deferred(),e=j+"set";return this.ajaxClient.post(e,c).done(t.bind(null,d)).fail(d.reject.bind(d)),d.promise()},
l.prototype.copyGroup=function b(c){var d=a.Deferred();return this.ajaxClient.post(f+"/copy",c).done(o.bind(null,d)).fail(u.bind(null,d)),d.promise()},l.prototype.checkPermission=function(){var b=a.Deferred();return this.ajaxClient.get(f+"/permission").done(b.resolve.bind(b)).fail(b.reject.bind(b)),b.promise()};function m(a){return a.entityKey||a}function n(a,b){a.resolve(c.fromDataCollection(b))}function o(a,b){a.resolve(new c(b))}function p(a){a.request=null}function q(a,b){a.resolve(d.fromDataCollection(b))}function r(a,b){a.resolve(h.fromDataCollection(b))}function s(a,b){a.resolve(e.fromDataCollection(b))}function t(a,b){a.resolve(b)}function u(a,b,c,d){a.reject(b,c,d)}return l});

define('text!assets/views/asset-group-control.html',[],function () { return '<div data-bind="if: settings.loadAssets, style: { height: settings.loadAssets ? \'100%\' : 0 }">\r\n    <mi-tree description="groupid"\r\n             custom-filter="true"\r\n             data-bind="attr: { \'root-name\': translate(\'ASSET_GROUPS\'), multiselect: settings.multiSelect, \'allow-add\': settings.allowAdd, \'has-children\': settings.hasChildren }">\r\n        <mi-tool-bar>\r\n            <!-- ko if: settings.enableAddAllChildren === true -->\r\n            <button class="btn btn-default btn-icon" data-bind="click: addAllChildren, attr: { title: translate(\'ADD_ALL_CHILDREN\'), disabled: disableSelectAllChildren }">\r\n                <i class="icon-plus"></i>\r\n            </button>\r\n            <!-- /ko -->\r\n        </mi-tool-bar>\r\n    </mi-tree>\r\n</div>\r\n\r\n<div data-bind="ifnot: settings.loadAssets, style: { height: !settings.loadAssets ? \'100%\' : 0 }">\r\n<mi-list-group description="groupid"\r\n               custom-filter="true"\r\n               data-bind="attr: { selector: settings.selector, multiselect: settings.multiSelect, \'allow-add\': settings.allowAdd, \'has-children\': settings.hasChildren }">\r\n</mi-list-group>\r\n</div>\r\n';});


define('text!assets/views/hierarchy-finder.html',[],function () { return '<section class="asset-hierarchy-finder">\r\n    <section class="hierarchy-control"></section>\r\n    <section class="well tag-section" data-bind="foreach: results">\r\n        <span class="tag" data-bind="click: $root.removeSelection.bind($root)">\r\n            <span class="block-group">\r\n                <span data-bind="text: description"></span>\r\n                <i class="icon-multiply"></i>\r\n            </span>\r\n        </span>\r\n    </section>\r\n    <div class="controls">\r\n        <button type="button" class="btn  btn-text  btn-secondary" data-bind="click: cancel, text: translate(\'CANCEL\')"></button>\r\n        <button type="button" class="btn btn-text" data-bind="click: done, text: translate(\'OK\'), enable: hasSelection"></button>        \r\n    </div>\r\n</section>\r\n';});

define('assets/models/selected-asset',[],function(){"use strict";function a(a,b,c,d,e){this.entityKey=a,this.description=b,this.family=c,this.familyId=d,this.siteKey=e?e:0}return a});
define('assets/adapters/selected-asset-adapter',['require','assets/models/selected-asset'],function(require){"use strict";var a=require("assets/models/selected-asset");function b(){}return b.fromAssetDTO=function b(c){return new a(c.entityKey,c.equipmentId,"",c.familyId,c.siteKey)},b.fromAssetDTOArray=function a(c){return c.map(b.fromAssetDTO)},b.fromHierarchyDTO=function b(c){return new a(c.entityKey,c.description,c.family,c.familyId,c.siteKey)},b.fromAssetGroupDTO=function b(c){return new a(c.entityKey,c.groupid,"","",c.siteKey)},b.fromHierarchyDTOArray=function a(c){return c.map(b.fromHierarchyDTO)},b});
define('assets/hierarchy-finder',['require','jquery','knockout','system/knockout/knockout-manager','spa/ko/knockout-view-model','assets/asset-hierarchy-control','system/ui/dialog-view-model','text!./views/hierarchy-finder.html','system/globalization/translator','assets/adapters/selected-asset-adapter'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("system/knockout/knockout-manager"),d=require("spa/ko/knockout-view-model"),e=require("assets/asset-hierarchy-control"),f=require("system/ui/dialog-view-model"),g=require("text!./views/hierarchy-finder.html"),h=require("system/globalization/translator"),i=require("assets/adapters/selected-asset-adapter");function j(){k.call(this,g),this.dialog=null,this.dfd=null,this.translator=Object.resolve(h),this.kom=Object.resolve(c),this.results=null,this.existing=[],this.assetHierarchyControl=null,this.settings={multiSelect:!0,contentArea:".hierarchy-control",selector:"addOnly"}}var k=Object.inherit(d,j);j.prototype.show=function b(c,d){var e={height:"90%",width:"40%"};return d===!1&&(this.settings.multiSelect=d),c=c||[],c.map instanceof Function?this.existing=c.map(i.fromHierarchyDTO):this.existing=[i.fromHierarchyDTO(c)],this.dialog=new f(this,this.translator.translate("HIERARCHY_FINDER"),e),
this.dialog.show(),this.dfd=a.Deferred(),this.dfd.promise()},j.prototype.close=function a(){this.dialog=null},j.prototype.load=function a(){this.results=this.kom.observableArray(this.existing),this.hasSelection=this.kom.computed(l.bind(null,this)),this.assetHierarchyControl=e.create(this.settings),this.assetHierarchyControl.load()},j.prototype.attach=function a(b){k.prototype.attach.apply(this,arguments),this.assetHierarchyControl.attach(b),this.assetHierarchyControl.loadState(),this.assetHierarchyControl.contextBrowser.addEventListener("multiSelected",this),this.assetHierarchyControl.contextBrowser.addEventListener("search-selected",this)},j.prototype.detach=function a(){this.assetHierarchyControl.contextBrowser.removeEventListener("multiSelected",this),this.assetHierarchyControl.contextBrowser.removeEventListener("search-selected",this),this.assetHierarchyControl.detach(),k.prototype.detach.apply(this,arguments)},j.prototype.unload=function a(){this.kom.dispose(),
"resolved"!==this.dfd.state()&&this.dfd.reject(),this.dfd=null,this.assetHierarchyControl.unload(),this.assetHierarchyControl=null,this.existing=null},j.prototype.handleEvent=function(a){"multiSelected"===a.type?o(this,a.detail):"search-selected"===a.type&&o(this,a.searchResult[0])},j.prototype.done=function a(){this.settings.multiSelect?this.dfd.resolve(this.results()):this.dfd.resolve(this.results()[0]),this.dialog.closeDialog()},j.prototype.cancel=function a(){this.dialog.closeDialog()},j.prototype.translate=function a(b){return this.translator.translate(b)},j.prototype.removeSelection=function a(c,d){var e=b.dataFor(d.target);d.target.classList.contains("icon-multiply")&&e.entityKey&&n(this,e.entityKey)};function l(a){return a.results().length>0}function m(a,b){for(var c=0;c<a.length&&a[c].entityKey!==b;)c++;return c===a.length?-1:c}function n(a,b){var c=0;(c=m(a.results(),b))>-1&&a.results.splice(c,1)}function o(a,b){
b&&(a.settings.multiSelect?m(a.results(),b.entityKey)===-1&&a.results.push(i.fromHierarchyDTO(b)):a.results.splice(0,1,i.fromHierarchyDTO(b)))}return j});

define('text!assets/views/group-filter.html',[],function () { return '<section class="group-filter">\r\n    <section class="form-group">\r\n        <label class="control-label" for="relationships" data-bind="text: $root.translate(\'ASSET_HIERARCHY_RELATIONSHIP_FIELD\')"></label>\r\n        <select class="form-control"\r\n                name="relationships"\r\n                data-bind="options: relationships, optionsText: \'caption\', optionsValue: \'id\', value: $root.selectedFamily, optionsCaption: $root.translate(\'ASSET_HIERARCHY_RELATIONSHIP_CAPTION\')"></select>\r\n    </section>\r\n\r\n    <section class="hierarchy">\r\n        <button class="hierarchy-filter btn btn-default" data-bind="click: editHierarchy, text: translate(\'HIERARCHY_FILTER\')"></button>\r\n        <div class="hierarchy-list">\r\n            <ul data-bind="foreach: results, click: removeHierarchyFilter">\r\n                <li class="list-group-item"><i class="icon-multiply"></i><span data-bind="text: description"></span></li>\r\n            </ul>\r\n        </div>\r\n    </section>\r\n\r\n    <section class="my-groups">\r\n        <mi-checkbox data-bind="miCheckboxProperty: {\r\n                            checked: filterByCurrUser,\r\n                            disable: false,\r\n                            value: filterByCurrUser,\r\n                            text: translate(\'MY_GROUPS\')}">\r\n        </mi-checkbox>\r\n    </section>\r\n\r\n    <div class="controls">\r\n        <button type="button" class="btn  btn-text  btn-secondary" data-bind="click: cancel, text: translate(\'CLOSE\')"></button>\r\n        <button type="button" class="btn btn-text" data-bind="click: done, text: translate(\'DONE\')"></button>\r\n    </div>\r\n</section>\r\n';});


define('text!ui/elements/checkbox/checkbox-template.html',[],function () { return '<script id="mi-checkbox-tmpl" type="text/html">\r\n    <div class="checkbox-container">\r\n        <input type="checkbox" data-bind="checked: $root.checked,disable: $root.disable,value:$root.value, attr:{id:$data.id, required: $root.required}, checkedValue: $root.checkedValue " />\r\n        <label data-bind="attr:{for:$data.id}">\r\n            <span class="checkbox-label" ></span>\r\n            <span class="chkbox-text" data-bind="text:$root.text"></span>\r\n        </label>       \r\n    </div>\r\n</script>';});

define('ui/elements/checkbox/checkbox-view-model',['require','lodash','jquery','text!./checkbox-template.html','knockout'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./checkbox-template.html"),d=require("knockout");d.bindingHandlers.miCheckboxProperty={createNodes:function(a,b){document.getElementById("mi-checkbox-tmpl")||document.body.insertAdjacentHTML("beforeend",c),d.applyBindingsToNode(a,{template:{name:"mi-checkbox-tmpl"}},b)},init:function(a,c){var e=c();return e.id=d.bindingHandlers.miCheckboxProperty.getGuid(),e.textClick=function a(c,d){if(this.disable)return!1;"function"==typeof this.checked?this.checked(!this.checked()):"boolean"==typeof this.checked&&(b(d.target).parent().find("input").prop("checked",!this.checked),this.checked=!this.checked)},d.bindingHandlers.miCheckboxProperty.createNodes(a,e),{controlsDescendantBindings:!0}},getGuid:function a(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},s4:function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},
update:function(c,e){var f,g=b(c).find('input[type="checkbox"]');a.each(e(),function(a,e){f=d.unwrap(a),"disable"===e?g.prop("disabled",f):"checked"===e?f!==!0&&f!==!1||g.prop("checked",f):"text"===e&&b(c).find(".chkbox-text").html(f)})}};var e=Object.create(HTMLElement.prototype);document.registerElement("mi-checkbox",{prototype:e})});
define('assets/group-filter-view-model',['require','jquery','knockout','spa/ko/knockout-view-model','system/ui/dialog-view-model','system/globalization/translator','assets/hierarchy-finder','assets/services/hierarchy-service','text!./views/group-filter.html','ui/elements/checkbox/checkbox-view-model'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("spa/ko/knockout-view-model"),d=require("system/ui/dialog-view-model"),e=require("system/globalization/translator"),f=require("assets/hierarchy-finder"),g=require("assets/services/hierarchy-service"),h=require("text!./views/group-filter.html");require("ui/elements/checkbox/checkbox-view-model");function i(){j.call(this,h),this.dialog=null,this.dfd=null,this.existing=[],this.relationships=[],this.family=null,this.selectedFamily=null,this.service=Object.resolve(g),this.translator=Object.resolve(e),this.results=null,this.finder=null,this.byCurrUser=null,this.filterByCurrUser=!1}var j=Object.inherit(c,i);i.prototype.show=function b(c,e,f){var g={height:"70%",width:"40%"};return c&&c instanceof Array?this.existing=c:this.existing=c?[c]:[],this.family=e,this.byCurrUser=f,this.dialog=new d(this,this.translator.translate("GROUP_FILTER"),g),this.dialog.show(),this.dfd=a.Deferred(),this.dfd.promise()},
i.prototype.close=function a(){this.dialog=null},i.prototype.load=function c(){this.finder=new f,a.isArray(this.existing)?this.results=b.observableArray(this.existing):this.results=b.observableArray([this.existing]),this.selectedFamily=b.observable(this.family),this.relationships=b.observableArray([]),this.filterByCurrUser=b.observable(this.byCurrUser),this.service.relationshipsById().done(k.bind(null,this))},i.prototype.attach=function a(){j.prototype.attach.apply(this,arguments)},i.prototype.detach=function a(){j.prototype.detach.apply(this,arguments)},i.prototype.unload=function a(){this.dialog=null,this.dfd=null,this.existing=[],this.existing=null,this.results([]),this.results=null,this.finder.close(),this.finder=null,this.selectedFamily(null),this.family=null,this.filterByCurrUser(null)},i.prototype.done=function a(){var b={family:this.selectedFamily(),results:this.results(),byCurrUser:this.filterByCurrUser()};this.dfd.resolve(b),this.dialog.closeDialog()},
i.prototype.cancel=function a(){this.dialog.closeDialog()},i.prototype.translate=function a(b){return this.translator.translate(b)},i.prototype.editHierarchy=function a(){this.finder.show(this.results()).done(l.bind(null,this))},i.prototype.removeHierarchyFilter=function c(d,e){var f=b.dataFor(e.target),g=0;if(a(e.target).hasClass("icon-multiply"))for(g=0;g<this.results().length;g++)this.results()[g].entityKey===f.entityKey&&this.results.splice(g,1)};function k(a,b){a.relationships(b),a.selectedFamily(a.family),a.filterByCurrUser(a.byCurrUser)}function l(a,b){a.results(b)}return i});
define('assets/asset-group-control',['require','jquery','bluebird','system/http/es6-ajax-request','spa/ko/knockout-view-model','spa/region','assets/services/group-service','assets/services/hierarchy-service','assets/services/asset-group-dto','assets/services/asset-context-dto','text!./views/asset-group-control.html','system/globalization/translator','assets/group-filter-view-model','system/error/error-message','application/application-events','application/application-context','catalog/services/dto/user-pref-dto','system/knockout/knockout-manager','catalog/services/catalog-constants','ui/elements/list-group/view-model','ui/elements/tree/view-model','ui/elements/tool-bar/view-model'],function(require){"use strict";var a=require("jquery"),b=require("bluebird"),c=require("system/http/es6-ajax-request"),d=require("spa/ko/knockout-view-model"),e=require("spa/region"),f=require("assets/services/group-service"),g=require("assets/services/hierarchy-service"),h=require("assets/services/asset-group-dto"),i=require("assets/services/asset-context-dto"),j=require("text!./views/asset-group-control.html"),k=require("system/globalization/translator"),l=require("assets/group-filter-view-model"),m=require("system/error/error-message"),n=require("application/application-events"),o=require("application/application-context"),p=require("catalog/services/dto/user-pref-dto"),q=require("system/knockout/knockout-manager"),r=require("catalog/services/catalog-constants");require("ui/elements/list-group/view-model"),require("ui/elements/tree/view-model"),require("ui/elements/tool-bar/view-model");var s={multiSelect:!1,selector:"none",contentArea:"",allowAdd:!1,loadAssets:!0,
hasChildren:!1};function t(a,b,c,d){u.call(this,j),this.user=o.user,this.constants=new r,this.groupService=a,this.hierarchyService=Object.resolve(g),this.translator=b,this.settings=null,this.selectedHierarchy=null,this.selectedFamily=null,this.filter=null,this.groupElement=null,this.appEvents=c,this.delayed=!1,this.filterByCurrUser=!1,this.kom=d,this.selectChildren=null,this.disableSelectAllChildren=null}var u=Object.inherit(d,t,q);t.dependsOn=[f,k,n,q],t.create=function b(c){var d=Object.resolve(t);return d.settings=a.extend(null,s,c),d.filter=new l,d},t.prototype.addAllChildren=function(){var a=new CustomEvent("selectallchildren",{bubbles:!0,cancelable:!0});this.groupElement.dispatchEvent(a)},t.prototype.attach=function a(b){var c;this.disableSelectAllChildren=this.kom.observable(!0),this.settings.contentArea?(c=new e,c.setElement(b.$element.find(this.settings.contentArea))):c=b,u.prototype.attach.call(this,c),this.groupElement=c.$element.find("mi-tree, mi-list-group")[0],
Element.upgrade(this.groupElement),v(this).then(E.bind(null,this)).then(w.bind(null,this))};function v(a){return b.resolve(a.groupService.getPreference(a.user.key,"groups-by-user"))}function w(a){null!==a.groupElement&&(a.groupElement.loader=a.loadGroup.bind(a),a.groupElement.addEventListener("search-selected",a),a.groupElement.addEventListener("filter-closed",a),a.groupElement.addEventListener("navigating",a),a.groupElement.addEventListener("navigated",a),a.settings.loadAssets?a.groupElement.searchCallback=a.searchGroupTree.bind(a):a.groupElement.searchCallback=a.searchGroupList.bind(a),a.groupElement.filterViewModel=a.editFilter.bind(a),a.groupElement.setAttribute("allow-add",a.settings.allowAdd))}t.prototype.handleEvent=function(a){"navigating"===a.type?(3===a.newValue.length&&a.preventDefault(),
this.disableSelectAllChildren(x(a))):"navigated"===a.type&&2===a.target.pathHistory.listGroup.length?a.target.pathHistory.listGroup[1].setAttribute("has-children","false"):"search-selected"===a.type?this.loadcontext(a.searchResult[0]):"filter-closed"===a.type&&(this.applyingFilter=!0)};function x(a){return 1===a.newValue.length}t.prototype.detach=function a(b){var c;this.groupElement.removeEventListener("search-selected",this),this.groupElement.removeEventListener("filter-closed",this),this.groupElement.removeEventListener("navigating",this),this.groupElement.removeEventListener("navigated",this),this.groupElement=null,this.settings.contentArea?(c=new e,c.setElement(b.$element.find(this.settings.contentArea))):c=b,this.filter&&this.filter.close(),c.screen&&u.prototype.detach.call(this,c)},t.prototype.unload=function a(){this.filter&&(this.filter.close(),this.filter=null)},t.prototype.translate=function a(b){return this.translator.translate(b)},t.prototype.editFilter=function a(){
this.filter.show(this.selectedHierarchy,this.selectedFamily,this.filterByCurrUser).done(y.bind(null,this)).fail(B.bind(null,this))},t.prototype.searchGroupTree=function(a,b,c,d){return this.groupService.getAllGroups(c,d,z(this),this.selectedFamily,this.filterByCurrUser,a).fail(B.bind(null,this)).promise()},t.prototype.searchGroupList=function(a,b,c){return this.groupService.getAllGroups(b,c,z(this),this.selectedFamily,this.filterByCurrUser,a).fail(B.bind(null,this)).promise()},t.prototype.loadGroup=function b(c,d,e){var f=a.Deferred();return void 0===e?this.groupService.getAllGroups(c,d,z(this),this.selectedFamily,this.filterByCurrUser).done(f.resolve.bind(f)).fail(B.bind(null,this)):0===c?this.groupService.getAllGroups(d,e,z(this),this.selectedFamily,this.filterByCurrUser).done(f.resolve.bind(f)).fail(B.bind(null,this)):this.groupService.assets(this.groupElement.value[c].entityKey,d,e).done(f.resolve.bind(f)).fail(B.bind(null,this)),f.promise()},t.prototype.loadcontext=function(a){
a&&(this.settings.loadAssets?C(this,a):D(this,a))},t.prototype.getContextValue=function(){return this.loadAssets?i.fromGroupDTO(this.groupElement.value[this.groupElement.value.length-1]):i.fromGroupDTO(this.groupElement.value||this.groupElement.items[0])},t.prototype.setValue=function(a,b){var c=b.originalEvent.searchResult[0];c&&(this.groupElement.value=c,this.groupElement.reload())},t.prototype.loadState=function(a){a=a||{},this.selectedHierarchy=a.hierarchy,this.selectedFamily=a.family,this.filterByCurrUser=a.byCurrUser,this.groupElement.loadState(a.groupElement)},t.prototype.saveState=function(){return{hierarchy:this.selectedHierarchy,family:this.selectedFamily,byCurrUser:this.filterByCurrUser,groupElement:this.groupElement.saveState()}};function y(a,b){a.selectedFamily=b.family,a.selectedHierarchy=b.results,a.filterByCurrUser!==b.byCurrUser&&(a.filterByCurrUser=b.byCurrUser,F(a)),a.groupElement.reload()}function z(a){
return a.selectedHierarchy?a.selectedHierarchy instanceof Array?0===a.selectedHierarchy.length?null:a.selectedHierarchy.map(A):[a.selectedHierarchy.entityKey]:null}function A(a){return a.entityKey}function B(a,b,c,d){if("abort"!==d){var e=new m("AG1",d,(new Error).stack);a.appEvents.errorOccured.raise(a,e)}}function C(a,b){"-1"===b.entityKey?a.groupElement.value&&a.groupElement.value.length>0&&(a.groupElement.value=a.groupElement.value[0]):a.groupElement.value[1]=h.fromAssetContextDTO(b)}function D(a,b){var c=h.fromAssetContextDTO(b);a.groupElement.value=c,a.groupElement.reload();var d=a.groupElement.querySelector("mi-list-group");d&&(Element.upgrade(d),d.value=c,d.reload())}function E(a,b){b&&b.value&&(a.filterByCurrUser="True"===b.value)}function F(a){var b=new p;b.userKey=a.user.key,b.prefType=a.constants.CATALOG_PREFERENCE,b.name="groups-by-user",b.value=a.filterByCurrUser,a.groupService.setPreference(b)}return t});
define('assets/models/selected-asset-results',['require','knockout'],function(require){"use strict";var a=require("knockout");function b(){this.existing=null,this.selected=null,this.arrayChangeSubscription=null,this.added=[],this.removed=[]}b.prototype.init=function b(d){var e,f=[];if(this.existing=d,d)for(e=0;e<d.length;e++)f[f.length]=d[e];this.selected=a.observableArray(f),this.arrayChangeSubscription=this.selected.subscribe(c.bind(null,this),null,"arrayChange")},b.prototype.dispose=function a(){this.selected([]),this.selected=null,this.arrayChangeSubscription.dispose(),this.arrayChangeSubscription=null};function c(a,b){var c;for(c=0;c<b.length;c++)"added"===b[c].status?f(a,b[c].value):e(a,b[c].value.entityKey)}function d(a,b){for(var c=0,d=!1;c<a.length&&!d;)d=a[c].entityKey===b,c++;return d?a[c-1]:void 0}function e(a,b){var c=0,e=!1,f;if(f=d(a.existing,b))a.removed.push(f);else for(c=0,e=!1;c<a.added.length&&!e;)e=a.added[c].entityKey===b,e&&a.added.splice(c,1),c++}function f(a,b){var c=0,e=!1;if(d(a.existing,b.entityKey))for(c=0,
e=!1;c<a.removed.length&&!e;)e=a.removed[c].entityKey===b.entityKey,e&&a.removed.splice(c,1),c++;else d(a.added,b.entityKey)||a.added.push(b)}return b});

define('text!ui/elements/asset-context/template.html',[],function () { return '<div class="asset-context-selection static">\r\n  <div class="navigation">\r\n    <ul class="nav nav-pills assetMenu pull-left" data-bind="click: menuClick">\r\n      <li data-bind="css: {active: activePill() === hierarchy.url }">\r\n        <a data-bind="attr: { \'data-menu-item\': hierarchy.url, href: hierarchy.href, title: translator.translate(\'ASSET_HIERARCHY\') }, text: translator.translate(\'ASSET_HIERARCHY\')">\r\n        </a>\r\n      </li>\r\n      <li data-bind="css: {active: activePill() === group.url }">\r\n        <a data-bind="attr: { href: group.href, \'data-menu-item\': group.url, title: translator.translate(\'ASSET_GROUP\') }, text: translator.translate(\'ASSET_GROUP\')">\r\n        </a>\r\n      </li>\r\n    </ul>          \r\n  </div>\r\n  <section class="block-group context-select">\r\n    <section class="asset-content">\r\n      <section class="asset-hierarchy-control" data-bind="visible: $root.activePill() === \'hierarchy\'"></section>\r\n      <section class="asset-group-explorer" data-bind="visible: $root.activePill() === \'group\'"></section>\r\n    </section>\r\n  </section>\r\n</div>\r\n';});

define('assets/services/asset-context-service',['require','lodash','jquery','system/http/ajax-client','assets/services/asset-context-dto','application/application-context'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/http/ajax-client"),d=require("assets/services/asset-context-dto"),e=require("application/application-context"),f="api/common/assetcontext/";function g(a){this.ajaxClient=a,this.request=null}g.dependsOn=[c],g.prototype.getcontext=function c(d){var e=b.Deferred();return this.request&&this.abort(),d&&"-1"!==d&&"0"!==d?this.request=this.ajaxClient.get(f+d).done(k.bind(null,this,e)).fail(l.bind(null,this,e)):(this.request="home",a.defer(j,this,e,"-1")),e.promise()},g.prototype.abort=function(){this.request&&this.request.abort?this.request.abort():"home"===this.request&&(this.request="home-abort")},g.prototype.getAssetContextPreference=function(){var a=f+"preference/"+i(),c=b.Deferred();return this.ajaxClient.get(a).done(k.bind(null,this,c)).fail(l.bind(null,this,c)),c.promise()},g.prototype.getAssetContextAppHub=function(){var a=f+"apphub/"+i(),c=b.Deferred()
;return this.ajaxClient.get(a).done(h.bind(null,c)).fail(l.bind(null,this,c)),c.promise()};function h(a,b){return a.resolve(b)}g.prototype.setAssetContextAppHub=function(a){var c=f+"apphub/"+a,d=b.Deferred();return this.ajaxClient.put(c).done(k.bind(null,this,d)).fail(l.bind(null,this,d)),d.promise()};function i(){return e.user.key}function j(a,b,c){"home-abort"!==a.request&&b.resolve(d.default(c)),a.request=null}function k(a,b,c){a.request=null,b.resolve(new d(c))}function l(a,b,c,e){a.request=null,404===c.status?b.resolve(d.default()):"abort"!==e&&b.reject()}return g});
define('ui/elements/asset-context/view-model',['require','lodash','jquery','assets/asset-hierarchy-control','assets/asset-group-control','system/ui/dialog-box','system/globalization/translator','assets/models/selected-asset-results','knockout','text!./template.html','spa/region','application/application-context','assets/services/asset-context-dto','assets/services/hierarchy-dto','assets/services/asset-group-dto','assets/services/asset-context-service','ramda'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("assets/asset-hierarchy-control"),d=require("assets/asset-group-control"),e=require("system/ui/dialog-box"),f=require("system/globalization/translator"),g=require("assets/models/selected-asset-results"),h=require("knockout"),i=require("text!./template.html"),j=require("spa/region"),k=require("application/application-context"),l=require("assets/services/asset-context-dto"),m=require("assets/services/hierarchy-dto"),n=require("assets/services/asset-group-dto"),o=require("assets/services/asset-context-service"),p=require("ramda"),q=["selector","multiselect","allowAdd"],r={};r.prototype=Object.create(HTMLElement.prototype),r.prototype.createdCallback=function(){this.element=this,this.translator=Object.resolve(f),this.results=null,this.dialog=null,this.existing=[],this.activePill=null,this.internalvalue=null,this.showAsDialog=null,this.assetContextService=Object.resolve(o),this.group={
href:"#assets/group",title:this.translator.translate("ASSET_GROUP"),url:"group",screen:null},this.hierarchy={href:"#assets/hierarchy",title:this.translator.translate("ASSET_HIERARCHY"),url:"hierarchy",screen:null},Object.defineProperty(this,"value",{get:K.bind(null,this),set:this.setContext.bind(this)}),this.delayload=Element.booleanAttribute(this,"delayload")},r.prototype.setContext=function(c){var d=new b.Deferred,e;return c&&(e=c.entityKey||c)?this.internalvalue&&"-1"!==this.internalvalue.entityKey&&L(this.internalvalue.entityKey,e)?(a.defer(d.resolve,this.internalvalue),d.promise()):(s(this,c),z(this,c,d),d.promise()):(a.defer(d.resolve,this.internalvalue),d.promise())};function s(a,b){"string"==typeof b&&B(a,b)}r.prototype.attachedCallback=function(){Element.clearDom(this),"true"===this.getAttribute("data-open")?(this.load(),this.attach(new j(b(this)))):T(this)},r.prototype.disableStuff=function(a,b){if(a!==!1||b!==!1){var c=this.region.element.querySelector(".assetMenu")
;a===!0?(P(this),M(this),this.region.element.querySelector(".asset-hierarchy-control").style.display="none",c.removeChild(c.firtElementChild),this.activePill("hierarchy")):b===!0&&(R(this),N(this),this.region.element.querySelector(".asset-group-explorer").removeAttribute("data-bind"),c.removeChild(c.lastElementChild),this.activePill("group")),c.classList.add("not-active")}},r.prototype.detachedCallback=function(){this.region&&(this.detach(),this.unload())},r.prototype.attributeChangedCallback=function(a,b,c){this.delayload===!1&&("entitykey"===a?z(this,c):"loadassets"===a?(this.group.screen.settings.loadAssets="true"===c,this.group.screen.settings.hasChildren="true"===c,this.group.screen.detach(this.region),this.group.screen.attach(this.region)):"selectchildren"===a?this.hierarchy.screen.selectChildren(c):"multiselect"===a&&(this.hierarchy.screen.settings.multiSelect="true"===c),H(this,a,c))},r.prototype.menuClick=function a(b,c){var d,e,f;c.preventDefault(),
c.stopImmediatePropagation(),f=c.target.getAttribute("data-menu-item"),e="hierarchy"===f?this.hierarchy:this.group,d=new CustomEvent("menu-changing",{bubbles:!0,cancelable:!0,detail:{menu:e}}),this.dispatchEvent(d),d.returnValue===!1||d.defaultPrevented||("hierarchy"===f?this.showHierarchy():this.showGroup())},r.prototype.load=function(){var a,b,e,f;for(this.results=new g,this.results.init(),this.results.existing=this.existing,this.activePill=h.observable("hierarchy"),f=this.getAttribute("data-open"),this.showAsDialog=h.observable(!f),a=0;a<this.existing.length;a++)this.results.selected.push(this.existing[a]);b={multiSelect:!1,selectedItems:this.results.selected,selectable:!1,contentArea:".asset-hierarchy-control",enableAddAllChildren:null!==this.getAttribute("enableAddAllChildren"),selectChildren:null!==this.getAttribute("selectChildren")},e={multiSelect:!1,selectedItems:this.results.selected,selectable:!1,contentArea:".asset-group-explorer",
loadAssets:null!==this.getAttribute("loadassets"),enableAddAllChildren:null!==this.getAttribute("enableAddAllChildren"),allowAdd:null!==this.getAttribute("allow-add")},this.hierarchy.screen=c.create(b),this.hierarchy.screen.load(),this.group.screen=d.create(e)},r.prototype.attach=function(a){this.region=a,this.region.attach(b(i)),this.region.$element.find(".region").attr("data-bind","halt-bindings"),this.region.element.addEventListener("change",this),this.delayload===!1&&(h.applyBindingsToDescendants(this,this.region.element.querySelector(".region")),O(this),Q(this),I(this),Element.raiseEvent(this.group.screen.groupElement.querySelector("mi-tool-bar"),"resize",{}))},r.prototype.detach=function(){P(this),R(this),h.cleanNode(this.region.element),this.region.clear(),this.region=null},r.prototype.handleEvent=function(a){
"navigated"===a.type?this.group.screen&&a.target===this.group.screen.groupElement?w(this):u(this):"selected"===a.type&&"group"!==this.activePill()&&this.group.screen&&a.target!==this.group.screen.groupElement?u(this):"selected"===a.type&&"group"===this.activePill()?v(this):"loaded"===a.type?J(this,a):"click"===a.type?x(this):"change"===a.type&&a.target!==this&&a.stopImmediatePropagation()},r.prototype.unload=function a(){M(this),N(this)},r.prototype.translateText=function a(b){return this.translator.translate(b)},r.prototype.done=function a(){this.dialog||y(this)},r.prototype.showHierarchy=function a(){this.activePill(this.hierarchy.url),Element.raiseEvent(this,"menu-change",{menu:this.hierarchy})},r.prototype.showGroup=function a(){this.activePill(this.group.url),Element.raiseEvent(this,"menu-change",{menu:this.group}),Element.raiseEvent(this.group.screen.groupElement.querySelector("mi-tool-bar"),"resize",{})},r.prototype.setSiteFilter=function(a){
this.hierarchy.screen.setSiteFilter(a)},r.prototype.loadState=function(a){var c,d;return a=a||{},a.hierarchy=a.hierarchy||{},a.group=a.group||{},a.hierarchy.value=null,a.group.value=null,this.hierarchy.screen.loadState(a.hierarchy),this.group.screen.loadState(a.group),c=a.value,c?d=this.setContext(c):(d=b.Deferred(),d.resolve(),a.menu===this.group.url?(this.activePill(this.group.url),this.group.screen.groupElement.addEventListener("loaded",this),this.group.screen.groupElement.reload()):(this.activePill(this.hierarchy.url),this.value=t(this)?k.assetcontext:l.default())),d.promise()},r.prototype.saveState=function(){return{hierarchy:this.hierarchy.screen.saveState(),group:this.group.screen.saveState(),value:this.internalvalue,menu:this.activePill()}},r.prototype.href=function(){return this.activePill()===this.hierarchy.url?this.hierarchy.href+"/"+this.value.entityKey:this.group.href+"/"+this.value.entityKey};function t(a){if(p.isNil(a.parentElement))return!1
;if(p.isNil(a.parentElement.parentElement))return!1;if(p.isNil(a.parentElement.parentElement.parentElement))return!1;var b=a.parentElement.parentElement.parentElement;return b.classList.contains("assets-shell-screen")&&!b.classList.contains("asset-finder-screen")}function u(a){var c=a.hierarchy.screen.contextBrowser.selectedAsset;A(a,l.fromHierarchyDTO(c)),b(a.element).find("span.context-id").text(a.internalvalue.description)}function v(a){a.group.screen.groupElement.value&&(A(a,l.fromGroupDTO(a.group.screen.groupElement.value)),b(a.element).find("span.context-id").text(a.internalvalue.description))}function w(a){var c=a.group.screen.groupElement.value.length-1,d=a.group.screen.groupElement.value[c];A(a,l.fromGroupDTO(d)),b(a.element).find("span.context-id").text(a.internalvalue.description)}function x(a){var c={height:"90%",width:"auto",buttons:[{name:a.translator.translate("DONE"),value:"done",cssClass:"btn-primary"}]},d=a.translator.translate("ASSET_HIERARCHY")
;null!==a.getAttribute("dialog")?(a.dialog=new e(a,d,c),a.dialog.show(),a.loadState()):(a.region||a.attach(new j(b(a.querySelector(".asset-context-selection")))),b(a.element).find("div.asset-context-selection").show())}function y(a){b(a.element).find("div.asset-context-selection").removeAttr("style")}function z(a,b,c){var d;b instanceof l?setTimeout(F.bind(null,a,c,b),0):b instanceof m?(d=l.formHierarchyDTO(b),setTimeout(F.bind(null,a,c,d),0)):b instanceof n?(d=l.fromGroupDTO(b),setTimeout(F.bind(null,a,c,d),0)):b.entityKey?a.assetContextService.getcontext(b.entityKey).done(F.bind(null,a,c)).fail(c.reject.bind(c)):a.assetContextService.getcontext(b).done(F.bind(null,a,c)).fail(c.reject.bind(c))}function A(a,b){(!a.internalvalue&&a.internalvalue!==b||a.internalvalue.entityKey!==b.entityKey)&&(a.internalvalue=b,G(a))}function B(a,b){(!a.internalvalue&&a.internalvalue!==b||a.internalvalue.entityKey!==b.entityKey)&&(a.internalvalue=b)}function C(a){var b=a.value||[{}]
;return 0===b.length?"":b[b.length-1].entityKey||""}function D(a){var b=a.selectedAsset;return b?b.entityKey:""}function E(a,b){var c,d,e,f;(a.region||a.dialog)&&(c="Hierarchy"===b.type,f=a.hierarchy.screen.contextBrowser,c?(a.activePill(a.hierarchy.url),D(f)!==b.entityKey&&a.hierarchy.screen.loadcontext(b.entityKey)):(a.activePill(a.group.url),e=a.group.screen.groupElement,e.value&&e.value.entityKey===b.entityKey||a.group.screen.loadcontext(b)))}function F(a,c,d){null===d&&(d=k.assetcontext||l.default()),E(a,d),A(a,d),a.internalvalue&&b(a.element).find("span.context-id").text(a.internalvalue.description),c&&c.resolve(d)}function G(a){Element.raiseEvent(a,"change",a.internalvalue)}function H(a,b,c){var d,e,f,g,h;if(q.indexOf(b)>-1){for(h=a.querySelector("asset-hierarchy-control"),"selector"===b&&h&&(h.enableMultiSelect="addOnly"===c),d=a.getElementsByTagName("mi-list-group"),e=0;e<d.length;e++)null!==c?d[e].setAttribute(b,c):d[e].removeAttribute(b)
;for(f=a.querySelectorAll("mi-tool-bar mi-searchbox"),e=0;e<f.length;e++)null!==c?f[e].setAttribute(b,c):f[e].removeAttribute(b);for(g=a.getElementsByTagName("mi-tree"),e=0;e<g.length;e++)"groupid"===g[e].getAttribute("description")&&"selector"===b&&(c="none"),null!==c?g[e].setAttribute(b,c):g[e].removeAttribute(b)}}function I(a){var b;for(b=0;b<q.length;b++)H(a,q[b],a.getAttribute(q[b]))}function J(a,b){if(null!==b.detail.frag.querySelector("mi-li")){var c=b.detail.frag.querySelector("mi-li").value;a.value=c,a.group.screen&&a.group.screen.groupElement.removeEventListener("loaded",a)}}function K(a){return a.internalvalue}function L(a,b){return a="0"===a?"-1":a,b="0"===b?"-1":b,a===b}function M(a){a.hierarchy.screen&&(a.hierarchy.screen.unload(),a.hierarchy.screen=null)}function N(a){a.group.screen&&(a.group.screen.unload(),a.group.screen=null)}function O(a){a.hierarchy.screen.attach(a.region,!0),a.hierarchy.screen.contextBrowser.addEventListener("selected",a)}function P(a){
a.hierarchy.screen&&(a.hierarchy.screen.contextBrowser.removeEventListener("selected",a),a.hierarchy.screen.detach(a.region))}function Q(a){var b;a.group.screen.attach(a.region),b=null!==a.getAttribute("loadassets"),b?a.group.screen.groupElement.addEventListener("navigated",a):a.group.screen.groupElement.addEventListener("selected",a)}function R(a){a.group.screen&&(a.group.screen.groupElement.removeEventListener("navigated",a),a.group.screen.groupElement.removeEventListener("selected",a),a.group.screen.detach(a.region))}function S(a){var c=k.assetcontext||l.default();F(a,b.Deferred(),c)}function T(a){var b,c,d,e,f;f=document.createElement("div"),f.className="region",b=document.createElement("div"),f.appendChild(b),c=document.createElement("button"),c.className="btn btn-default",b.appendChild(c),e=document.createElement("span"),e.className="context-id",c.appendChild(e),c.addEventListener("click",a),d=document.createElement("i"),d.className="ds ds-assethierachy ds-dashboard-style",
c.appendChild(d),a.appendChild(f),b=document.createElement("div"),b.className="asset-context-selection",a.appendChild(b),S(a)}return document.registerElement("mi-asset-context",{prototype:r.prototype}),r});
!function(a){"use strict";if("function"==typeof define&&define.amd)define('ui/elements/date-time/bootstrap-datetimepicker',["jquery","moment","lodash","system/text/formatter","system/lang/converter","system/globalization/translator","system/hardware/device","system/text/parser"],a);else{if(!jQuery)throw"bootstrap-datetimepicker requires jQuery to be loaded first";if(!moment)throw"bootstrap-datetimepicker requires moment.js to be loaded first";a(jQuery,moment,_)}}(function(a,b,c,d,e,f,g,h){"use strict";if(void 0===b)throw alert("momentjs is required"),new Error("momentjs is required");var i=0,j=b,k=Object.resolve(d),l=Object.resolve(f),m=function(b,d){var e=a.fn.datetimepicker.defaults,f={time:"icon-time-units",date:"icon-calendar",up:"icon-up-arrow",down:"icon-arrow"},m=new g,n=this,o=!1,p=function(){var b=!1,c;if(t(),c=k.cultureInfo().calendar.patterns,r(c),n.use24hours=n.format.toLowerCase().indexOf("t")<1,null===k.cultureInfo().calendar.AM&&null===k.cultureInfo().calendar.AM&&(n.use24hours=!0),
n.component&&(b=n.component.find("span")),n.options.pickTime&&b&&b.addClass(n.options.icons.time),n.options.pickDate&&b&&(b.removeClass(n.options.icons.time),b.addClass(n.options.icons.date)),n.options.widgetParent="string"==typeof n.options.widgetParent&&n.options.widgetParent||n.element.parents().filter(function(){return"scroll"===a(this).css("overflow-y")}).get(0)||"body",n.widget=a(da()).appendTo(n.options.widgetParent),n.options.useSeconds&&!n.use24hours&&n.widget.width(300),s(),n.options.disabledDates=ba(n.options.disabledDates),n.options.enabledDates=ba(n.options.enabledDates),q(),""!==n.options.defaultDate&&""===u().val()&&n.setValue(n.options.defaultDate),1!==n.options.minuteStepping){var d=n.options.minuteStepping;n.date.minutes(Math.round(n.date.minutes()/d)*d%60).seconds(0)}},q=function(){n.startViewMode=n.viewMode,n.setMinDate(n.options.minDate),n.setMaxDate(n.options.maxDate),E(),F(),H(),I(),J(),D(),T(),U()},r=function(a){n.format||(n.format=n.options.pickDate?a.d:"",
n.options.pickDate&&n.options.pickTime&&(n.format+=" "),n.format+=n.options.pickTime?a.t:"",n.options.useSeconds&&(~a.t.indexOf(" tt")?n.format=n.format.split(" tt")[0]+":ss tt":~a.t.indexOf(" t")?n.format=n.format.split(" t")[0]+":ss t":n.format+=":ss"))},s=function(){if(n.minViewMode=n.options.minViewMode||0,"string"==typeof n.minViewMode)switch(n.minViewMode){case"months":n.minViewMode=1;break;case"years":n.minViewMode=2;break;default:n.minViewMode=0}if(n.viewMode=n.options.viewMode||0,"string"==typeof n.viewMode)switch(n.viewMode){case"months":n.viewMode=1;break;case"years":n.viewMode=2;break;default:n.viewMode=0}},t=function(){if(n.options=a.extend({},e,d),n.options.icons=a.extend({},f,n.options.icons),n.element=a(b),n.elementZIndexOrig=n.element.css("z-index"),n.elementPosOrig=n.element.css("position"),n.blockout=a('<div class="datepicker-screen-freeze"></div>'),v(),!n.options.pickTime&&!n.options.pickDate)throw new Error("Must choose at least one picker");n.id=i++,
j.locale(n.options.language),n.date=j(),n.unset=!1,n.isInput=n.element.is("input"),n.component=!1,n.element.hasClass("input-group")&&(0===n.element.find(".datepickerbutton").size()?n.component=n.element.find("[class^='input-group-']"):n.component=n.element.find(".datepickerbutton")),n.format=n.options.format,n.placePosition=""},u=function(){var a;if(n.isInput)return n.element;if(a=n.element.find(".datepickerinput"),0===a.size())a=n.element.find("input");else if(!a.is("input"))throw new Error('CSS class "datepickerinput" cannot be applied to non input element');return a},v=function(){var a;a=n.element.is("input")?n.element.data():n.element.find("input").data(),void 0!==a.dateFormat&&(n.options.format=a.dateFormat),void 0!==a.datePickdate&&(n.options.pickDate=a.datePickdate),void 0!==a.datePicktime&&(n.options.pickTime=a.datePicktime),void 0!==a.dateUseminutes&&(n.options.useMinutes=a.dateUseminutes),void 0!==a.dateUseseconds&&(n.options.useSeconds=a.dateUseseconds),
void 0!==a.dateUsecurrent&&(n.options.useCurrent=a.dateUsecurrent),void 0!==a.dateMinutestepping&&(n.options.minuteStepping=a.dateMinutestepping),void 0!==a.dateMindate&&(n.options.minDate=a.dateMindate),void 0!==a.dateMaxdate&&(n.options.maxDate=a.dateMaxdate),void 0!==a.dateShowtoday&&(n.options.showToday=a.dateShowtoday),void 0!==a.dateCollapse&&(n.options.collapse=a.dateCollapse),void 0!==a.dateLanguage&&(n.options.language=a.dateLanguage),void 0!==a.dateDefaultdate&&(n.options.defaultDate=a.dateDefaultdate),void 0!==a.dateDisableddates&&(n.options.disabledDates=a.dateDisableddates),void 0!==a.dateEnableddates&&(n.options.enabledDates=a.dateEnableddates),void 0!==a.dateIcons&&(n.options.icons=a.dateIcons),void 0!==a.dateUsestrict&&(n.options.useStrict=a.dateUsestrict),void 0!==a.dateDirection&&(n.options.direction=a.dateDirection),void 0!==a.dateSidebyside&&(n.options.sideBySide=a.dateSidebyside)},w=function(){
var b="absolute",c=n.component?n.component.offset():n.element.offset(),d=a(window);n.width=n.component?n.component.outerWidth():n.element.outerWidth(),c.top=c.top+n.element.outerHeight(),n.placePosition,y(c,d),z(c),void 0!==n.options.width&&n.widget.width(n.options.width),"left"===n.options.orientation&&(n.widget.addClass("left-oriented"),c.left=c.left-n.widget.width()+20),Y()&&(b="fixed",c.top-=d.scrollTop(),c.left-=d.scrollLeft()),d.width()<c.left+n.widget.outerWidth()?(c.right=d.width()-c.left-n.width,c.left="auto",n.widget.addClass("pull-right")):(c.right="auto",n.widget.removeClass("pull-right")),n.widget.css({position:b,top:c.top,left:c.left,right:c.right})},x=function(){c.defer(function(){window.scrollTo(0,0),n.widget.css("top",Math.max(0,(a(window).height()-n.widget.outerHeight())/2+a(window).scrollTop())+"px"),n.widget.css("left",Math.max(0,(a(window).width()-n.widget.outerWidth())/2+a(window).scrollLeft())+"px")})},y=function(b,c){
var d=b.top+n.widget.height()>c.height()+c.scrollTop()&&n.widget.height()+n.element.outerHeight()<b.top,e=!(b.top>0&&b.left>0&&b.top+n.widget.height()<c.height());"up"===n.options.direction?n.placePosition="top":"bottom"===n.options.direction?n.placePosition="bottom":"auto"===n.options.direction&&(d?n.placePosition="top":e?(x(),a(n.widget).addClass("remove-arrow")):n.placePosition="bottom")},z=function(a){"top"===n.placePosition?(a.top-=n.widget.height()+n.element.outerHeight()+15,n.widget.addClass("top").removeClass("bottom")):(a.top+=1,n.widget.addClass("bottom").removeClass("top"))},A=function(a){n.element.trigger({type:"dp.clear",date:j(n.date),oldDate:j(a)})},B=function(a,b){if(o)o=!1;else if(j(n.date).isSame(j(a)))return;n.element.trigger({type:"dp.change",date:j(n.date),oldDate:j(a)}),"change"!==b&&n.element.change()},C=function(a){o=!0,n.element.trigger({type:"dp.error",date:j(a)})},D=function(a){j.locale(n.options.language);var b=a,c;b||(b=u().val(),b&&(c=S(b,n.format,b),
c instanceof Date||!n.options.oldFormat||n.format===n.options.oldFormat||(c=S(b,n.options.oldFormat,b)),n.date=j(c)),n.date||(n.date=j())),n.viewDate=j(n.date).startOf("month"),G(),K()},E=function(){j.locale(n.options.language);var b=a("<tr>"),c=j.weekdaysMin(),d;if(0===j().localeData()._week.dow)for(d=0;d<7;d++)b.append('<th class="dow">'+c[d]+"</th>");else for(d=1;d<8;d++)7===d?b.append('<th class="dow">'+c[0]+"</th>"):b.append('<th class="dow">'+c[d]+"</th>");n.widget.find(".datepicker-days thead").append(b)},F=function(){j.locale(n.options.language);for(var a="",b=0,c=j.monthsShort();b<12;)a+='<span class="month">'+c[b++]+"</span>";n.widget.find(".datepicker-months td").append(a)},G=function(){if(n.options.pickDate){j.locale(n.options.language);var b=n.viewDate.year(),c=n.viewDate.month(),d=n.options.minDate.year(),e=n.options.minDate.month(),f=n.options.maxDate.year(),g=n.options.maxDate.month(),h,i,k,l=[],m,o,p,q,r,s,t=j.months()
;for(n.widget.find(".datepicker-days").find(".disabled").removeClass("disabled"),n.widget.find(".datepicker-months").find(".disabled").removeClass("disabled"),n.widget.find(".datepicker-years").find(".disabled").removeClass("disabled"),n.widget.find(".datepicker-days th:eq(1)").text(t[c]+" "+b),i=j(n.viewDate).subtract(1,"months"),q=i.daysInMonth(),i.date(q),i.startOf("week"),(b===d&&c<=e||b<d)&&n.widget.find(".datepicker-days th:eq(0)").addClass("disabled"),(b===f&&c>=g||b>f)&&n.widget.find(".datepicker-days th:eq(2)").addClass("disabled"),k=j(i).add(42,"d");i.isBefore(k);){if(i.weekday()===j().startOf("week").weekday()&&(m=a("<tr>"),l.push(m)),o="",i.year()<b||i.year()===b&&i.month()<c?o+=" old":(i.year()>b||i.year()===b&&i.month()>c)&&(o+=" new"),i.isSame(j({y:n.date.year(),M:n.date.month(),d:n.date.date()}))&&(o+=" active"),!_(i,"day")&&aa(i)||(o+=" disabled"),n.options.showToday===!0&&i.isSame(j(),"day")&&(o+=" today"),
n.options.daysOfWeekDisabled)for(p in n.options.daysOfWeekDisabled)if(i.day()===n.options.daysOfWeekDisabled[p]){o+=" disabled";break}m.append('<td class="day'+o+'">'+i.date()+"</td>"),h=i.date(),i.add(1,"d"),h===i.date()&&i.add(1,"d")}for(n.widget.find(".datepicker-days tbody").empty().append(l),s=n.date.year(),t=n.widget.find(".datepicker-months").find("th:eq(1)").text(b).end().find("span").removeClass("active"),s===b&&t.eq(n.date.month()).addClass("active"),s-1<d&&n.widget.find(".datepicker-months th:eq(0)").addClass("disabled"),s+1>f&&n.widget.find(".datepicker-months th:eq(2)").addClass("disabled"),p=0;p<12;p++)b===d&&e>p||b<d?a(t[p]).addClass("disabled"):(b===f&&g<p||b>f)&&a(t[p]).addClass("disabled");for(l="",b=10*parseInt(b/10,10),r=n.widget.find(".datepicker-years").find("th:eq(1)").text(b+"-"+(b+9)).end().find("td"),n.widget.find(".datepicker-years").find("th").removeClass("disabled"),d>b&&n.widget.find(".datepicker-years").find("th:eq(0)").addClass("disabled"),
f<b+9&&n.widget.find(".datepicker-years").find("th:eq(2)").addClass("disabled"),b-=1,p=-1;p<11;p++)l+='<span class="year'+(p===-1||10===p?" old":"")+(s===b?" active":"")+(b<d||b>f?" disabled":"")+'">'+b+"</span>",b+=1;r.html(l)}},H=function(){j.locale(n.options.language);var a=n.widget.find(".timepicker .timepicker-hours table"),b="",c,d,e;if(a.parent().hide(),n.use24hours)for(c=0,d=0;d<6;d+=1){for(b+="<tr>",e=0;e<4;e+=1)b+='<td class="hour">'+ca(c.toString())+"</td>",c++;b+="</tr>"}else for(c=1,d=0;d<3;d+=1){for(b+="<tr>",e=0;e<4;e+=1)b+='<td class="hour">'+ca(c.toString())+"</td>",c++;b+="</tr>"}a.html(b)},I=function(){var a=n.widget.find(".timepicker .timepicker-minutes table"),b="",c=0,d,e,f=n.options.minuteStepping;for(a.parent().hide(),1===f&&(f=5),d=0;d<Math.ceil(60/f/4);d++){for(b+="<tr>",e=0;e<4;e+=1)c<60?(b+='<td class="minute">'+ca(c.toString())+"</td>",c+=f):b+="<td></td>";b+="</tr>"}a.html(b)},J=function(){
var a=n.widget.find(".timepicker .timepicker-seconds table"),b="",c=0,d,e;for(a.parent().hide(),d=0;d<3;d++){for(b+="<tr>",e=0;e<4;e+=1)b+='<td class="second">'+ca(c.toString())+"</td>",c+=5;b+="</tr>"}a.html(b)},K=function(){if(n.date){var a=n.widget.find(".timepicker span[data-time-component]"),b=n.date.hours(),c="AM";n.use24hours?(n.widget.find(".timepicker-hour").addClass("hour-fix"),n.widget.find(".timepicker-minute").addClass("hour-fix"),n.widget.find(".timepicker-second").addClass("hour-fix")):(b>=12&&(c="PM"),0===b?b=12:12!==b&&(b%=12),n.widget.find(".timepicker [data-action=togglePeriod]").text(c)),a.filter("[data-time-component=hours]").text(ca(b)),a.filter("[data-time-component=minutes]").text(ca(n.date.minutes())),a.filter("[data-time-component=seconds]").text(ca(n.date.second()))}},L=function(b){b.stopPropagation(),b.preventDefault(),n.unset=!1;var c=a(b.target).closest("span, td, th, button"),d,e,f,g,h=j(n.date);c.hasClass("close-button")&&n.hide(),
c.hasClass("clear-date-button")&&(n.setDate(S("",void 0,"")),n.hide(),A()),1===c.length&&M(b,c,d,e,f,g,h)},M=function(a,b,c,d,e,f,g){if(!b.is(".disabled"))switch(b[0].nodeName.toLowerCase()){case"th":switch(b[0].className){case"switch":T(1);break;case"prev":case"next":e=ea.modes[n.viewMode].navStep,"prev"===b[0].className&&(e*=-1),n.viewDate.add(e,ea.modes[n.viewMode].navFnc),G()}break;case"span":b.is(".month")?(c=b.parent().find("span").index(b),n.viewDate.month(c)):(d=parseInt(b.text(),10)||0,n.viewDate.year(d)),n.viewMode===n.minViewMode&&(n.date=j({y:n.viewDate.year(),M:n.viewDate.month(),d:n.viewDate.date(),h:n.date.hours(),m:n.date.minutes(),s:n.date.seconds()}),B(g,a.type),Z()),T(-1),G();break;case"td":b.is(".day")&&(f=parseInt(b.text(),10)||1,c=n.viewDate.month(),d=n.viewDate.year(),b.is(".old")?0===c?(c=11,d-=1):c-=1:b.is(".new")&&(11===c?(c=0,d+=1):c+=1),n.date=j({y:d,M:c,d:f,h:n.date.hours(),m:n.date.minutes(),s:n.date.seconds()}),n.viewDate=j({y:d,M:c,d:Math.min(28,f)}),
G(),Z(),B(g,a.type),n.hide())}},N={incrementHours:function(){$("add","hours",1)},incrementMinutes:function(){$("add","minutes",n.options.minuteStepping)},incrementSeconds:function(){$("add","seconds",1)},decrementHours:function(){$("subtract","hours",1)},decrementMinutes:function(){$("subtract","minutes",n.options.minuteStepping)},decrementSeconds:function(){$("subtract","seconds",1)},togglePeriod:function(){var a=n.date.hours();a>=12?a-=12:a+=12,n.date.hours(a)},showPicker:function(){n.widget.find(".timepicker > div:not(.timepicker-picker)").hide(),n.widget.find(".timepicker .timepicker-picker").show()},showHours:function(){n.widget.find(".timepicker .timepicker-picker").hide(),n.widget.find(".timepicker .timepicker-hours").show()},showMinutes:function(){n.widget.find(".timepicker .timepicker-picker").hide(),n.widget.find(".timepicker .timepicker-minutes").show()},showSeconds:function(){n.widget.find(".timepicker .timepicker-picker").hide(),
n.widget.find(".timepicker .timepicker-seconds").show()},selectHour:function(b){var c=n.widget.find(".timepicker [data-action=togglePeriod]").text(),d=parseInt(a(b.target).text(),10);"PM"===c&&(d+=12),n.date.hours(d),N.showPicker.call(n)},selectMinute:function(b){n.date.minutes(parseInt(a(b.target).text(),10)),N.showPicker.call(n)},selectSecond:function(b){n.date.seconds(parseInt(a(b.target).text(),10)),N.showPicker.call(n)}},O=function(b){var c=j(n.date),d=a(b.currentTarget).data("action"),e=N[d].apply(n,arguments);return P(b),n.date||(n.date=j({y:1970})),Z(),K(),B(c,b.type),e},P=function(a){a.stopPropagation(),a.preventDefault()},Q=function(a){27===a.keyCode&&n.hide()},R=function(b){j.locale(n.options.language);var c=a(b.target),d=j(n.date),e=j(S(c.val(),n.format,c.val()));e.isValid()&&!_(e)&&aa(e)?(D(),n.setValue(e),B(d,b.type),Z()):(n.viewDate=d,n.unset=!0,B(d,b.type),C(e))},S=function(a,b,c){return b=b||"yyyy-MM-ddTHH:mm:ss.fff",c=Object.defaultValue(c,null),
null===a||void 0===a?c:a instanceof Date?a:h.parseDate(a,b)||h.parseDate(a,"yyyy-MM-ddTHH:mm:ss.fff")||h.parseDate(a)||null},T=function(a){a&&(n.viewMode=Math.max(n.minViewMode,Math.min(2,n.viewMode+a))),n.widget.find(".datepicker > div").hide().filter(".datepicker-"+ea.modes[n.viewMode].clsName).show()},U=function(){var b,c,d,e,f;n.widget.on("click",".datepicker *, .close-button, .clear-date-button",a.proxy(L,this)),n.widget.on("click","[data-action]",a.proxy(O,this)),n.widget.on("mousedown",a.proxy(P,this)),n.element.on("keydown",a.proxy(Q,this)),n.options.pickDate&&n.options.pickTime&&n.widget.on("click.togglePicker",".accordion-toggle",function(g){if("top"===n.placePosition&&setTimeout(function(){w()},250),g.stopPropagation(),b=a(this),c=b.closest("ul"),d=c.find(".in"),e=c.find(".collapse:not(.in)"),d&&d.length){if((f=d.data("collapse"))&&f.transitioning)return;d.collapse("hide"),e.collapse("show"),b.find("span").toggleClass(n.options.icons.time+" "+n.options.icons.date),
n.element.find("[class^='input-group-'] span").toggleClass(n.options.icons.time+" "+n.options.icons.date)}}),n.isInput?m.isMobile()?n.element.on({focus:a.proxy(n.show,this),change:a.proxy(R,this)}):n.element.on({focus:a.proxy(n.show,this),change:a.proxy(R,this),blur:a.proxy(n.hide,this)}):(n.element.on({change:a.proxy(R,this)},"input"),n.component?n.component.on("click",a.proxy(n.show,this)):n.element.on("click",a.proxy(n.show,this)))},V=function(){a(window).on("resize.datetimepicker"+n.id,a.proxy(w,this)),n.isInput||a(document).on("mousedown.datetimepicker"+n.id,a.proxy(n.hide,this))},W=function(){n.widget.off("click",".datepicker *, .close-button, .clear-date-button",n.click),n.widget.off("click","[data-action]"),n.widget.off("mousedown",n.stopEvent),n.options.pickDate&&n.options.pickTime&&n.widget.off("click.togglePicker"),n.isInput?n.element.off({focus:n.show,change:n.change}):(n.element.off({change:n.change},"input"),
n.component?n.component.off("click",n.show):n.element.off("click",n.show))},X=function(){a(window).off("resize.datetimepicker"+n.id),n.isInput||a(document).off("mousedown.datetimepicker"+n.id)},Y=function(){if(n.element){var b=n.element.parents(),c=!1,d;for(d=0;d<b.length;d++)if("fixed"===a(b[d]).css("position")){c=!0;break}return c}return!1},Z=function(){j.locale(n.options.language);var a="";n.unset||(a=k.format(n.date.toDate(),n.format)),u().val(a),n.element.data("date",a),n.options.pickTime||n.hide()},$=function(a,b,c){j.locale(n.options.language);var d;if("add"===a?(d=j(n.date),23===d.hours()&&d.add(c,b),d.add(c,b)):d=j(n.date).subtract(c,b),_(j(d.subtract(c,b)))||_(d))return void C(k.format(d.toDate(),n.format));"add"===a?n.date.add(c,b):n.date.subtract(c,b),n.unset=!1},_=function(a,b){j.locale(n.options.language);var c=n.options.maxDate,d=n.options.minDate;return b&&(c=j(c).endOf(b),d=j(d).startOf(b)),
!(!a.isAfter(c)&&!a.isBefore(d))||n.options.disabledDates!==!1&&n.options.disabledDates[k.format(a,"yyyy-MM-dd")]===!0},aa=function(a){return j.locale(n.options.language),n.options.enabledDates===!1||n.options.enabledDates[k.format(a,"yyyy-MM-dd")]===!0},ba=function(a){var b,c={},d=0,e;for(e=0;e<a.length;e++)b=j(a[e]),b.isValid()&&(c[k.format(b.toDate(),"yyyy-MM-dd")]=!0,d++);return d>0&&c},ca=function(a){return a=a.toString(),a.length>=2?a:"0"+a},da=function(){if(n.options.pickDate&&n.options.pickTime){var a="";return a='<div class="bootstrap-datetimepicker-widget'+(n.options.sideBySide?" timepicker-sbs":"")+' dropdown-menu" style="z-index:99999 !important;">',
n.options.sideBySide?a+='<div class="row"><div class="col-sm-6 datepicker">'+ea.template+'</div><div class="col-sm-6 timepicker">'+fa.getTemplate()+"</div></div>":a+='<ul class="list-unstyled"><li'+(n.options.collapse?' class="collapse in"':"")+'><div class="datepicker">'+ea.template+'</div></li><li class="picker-switch accordion-toggle"><a class="btn btn-icon" style="width:100%; padding-top:5px;"><span class="'+n.options.icons.time+'"></span></a></li><li'+(n.options.collapse?' class="collapse"':"")+'><div class="timepicker">'+fa.getTemplate()+"</div></li></ul>"+ea.buttonsTemplate,a+="</div>"}return n.options.pickTime?'<div class="bootstrap-datetimepicker-widget dropdown-menu"><div class="timepicker">'+fa.getTemplate()+"</div>"+ea.buttonsTemplate+"</div>":'<div class="bootstrap-datetimepicker-widget dropdown-menu"><div class="datepicker">'+ea.template+"</div>"+ea.buttonsTemplate+"</div>"},ea={modes:[{clsName:"days",navFnc:"month",navStep:1},{clsName:"months",navFnc:"year",navStep:1},{
clsName:"years",navFnc:"year",navStep:10}],headTemplate:'<thead><tr><th class="prev"><i class="icon-back-arrow"></i></th><th colspan="5" class="switch"></th><th class="next"><i class="icon-right-arrow"></i></th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'},fa={hourTemplate:'<span data-action="showHours" data-time-component="hours" class="timepicker-hour"></span>',minuteTemplate:'<span data-action="showMinutes" data-time-component="minutes" class="timepicker-minute"></span>',secondTemplate:'<span data-action="showSeconds"  data-time-component="seconds" class="timepicker-second"></span>'};ea.template='<div class="datepicker-days"><table class="table-condensed">'+ea.headTemplate+'<tbody></tbody></table></div><div class="datepicker-months"><table class="table-condensed">'+ea.headTemplate+ea.contTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+ea.headTemplate+ea.contTemplate+"</table></div>",
ea.buttonsTemplate='<div class="block-group date-picker-buttons"><button class="clear-date-button btn btn-default block">'+l.translate("CLEAR")+'</button><button class="close-button btn btn-default block">'+l.translate("CLOSE")+"</button> </div>",fa.getTemplate=function(){
return'<div class="timepicker-picker"><table class="table-condensed"><tr><td><a href="#" class="btn  btn-icon" data-action="incrementHours"><span style="box-shadow:none; font-size:18px;" class="'+n.options.icons.up+'"></span></a></td><td class="separator"></td><td>'+(n.options.useMinutes?'<a href="#" class="btn btn-icon" data-action="incrementMinutes"><span style="box-shadow:none; font-size:18px;" class="'+n.options.icons.up+'"></span></a>':"")+"</td>"+(n.options.useSeconds?'<td class="separator"></td><td><a href="#" class="btn btn-icon" data-action="incrementSeconds"><span style="box-shadow:none; font-size:18px;" class="'+n.options.icons.up+'"></span></a></td>':"")+(n.use24hours?"":'<td class="separator"></td>')+"</tr><tr><td>"+fa.hourTemplate+'</td> <td class="separator">:</td><td>'+(n.options.useMinutes?fa.minuteTemplate:'<span class="timepicker-minute">00</span>')+"</td> "+(n.options.useSeconds?'<td class="separator">:</td><td>'+fa.secondTemplate+"</td>":"")+(n.use24hours?"":'<td class="separator"></td><td><button type="button" class="btn btn-primary" style="min-width: 0;" data-action="togglePeriod"></button></td>')+'</tr><tr><td><a href="#" class="btn btn-icon" data-action="decrementHours"><span style="box-shadow:none; font-size:18px;" class="'+n.options.icons.down+'"></span></a></td><td class="separator"></td><td>'+(n.options.useMinutes?'<a href="#" class="btn btn-icon" data-action="decrementMinutes"><span style="box-shadow:none; font-size:18px;" class="'+n.options.icons.down+'"></span></a>':"")+"</td>"+(n.options.useSeconds?'<td class="separator"></td><td><a href="#" class="btn btn-icon" data-action="decrementSeconds"><span class="'+n.options.icons.down+'"></span></a></td>':"")+(n.use24hours?"":'<td class="separator"></td>')+'</tr></table></div><div class="timepicker-hours" data-action="selectHour"><table class="table-condensed"></table></div><div class="timepicker-minutes" data-action="selectMinute"><table class="table-condensed"></table></div>'+(n.options.useSeconds?'<div class="timepicker-seconds" data-action="selectSecond"><table class="table-condensed"></table></div>':"")
},n.destroy=function(){W(),X(),n.widget.remove(),n.blockout&&n.blockout.remove(),n.element.removeData("DateTimePicker"),n.component&&n.component.removeData("DateTimePicker")},n.show=function(b){if(n.options.useCurrent&&""===u().val()){if(1!==n.options.minuteStepping){var c=j(),d=n.options.minuteStepping;c.minutes(Math.round(c.minutes()/d)*d%60).seconds(0),n.setValue(k.format(c.toDate(),n.format))}else n.setValue(k.format(new Date,n.format));B("",b.type)}n.blockout=a('<div class="datepicker-screen-freeze"></div>').appendTo("body"),m.isMobile()&&n.blockout.click(function(){a(n.blockout).remove(),n.hide()}),n.widget.hasClass("picker-open")?(n.widget.hide(),n.widget.removeClass("picker-open")):(n.widget.show(),n.blockout.show(),n.widget.css("visibility","visible"),n.element.css("z-index",99999),a("input.form-control").css("z-index",2),n.element.css("position","relative"),n.widget.addClass("picker-open")),n.height=n.component?n.component.outerHeight():n.element.outerHeight(),w(),
n.element.trigger({type:"dp.show",date:j(n.date)}),V(),b&&P(b)},n.disable=function(){var a=n.element.find("input");a.prop("disabled")||a.prop("disabled",!0)},n.enable=function(){var a=n.element.find("input");a.prop("disabled")&&a.prop("disabled",!1)},n.hide=function(a){m.isMobile()?setTimeout(n.hide_function.bind(null,this,a),500):n.hide_function(a)},n.hide_function=function(b){if(!b||!a(b.target).is("#"+n.element.attr("id"))){var c=n.widget.find(".collapse"),d,e;for(d=0;d<c.length;d++)if((e=c.eq(d).data("collapse"))&&e.transitioning)return;n.widget.hide(),n.widget.css("visiblity","hidden"),n.widget.removeClass("picker-open"),n.viewMode=n.startViewMode,n.blockout&&(n.blockout.remove(),m.isMobile()&&n.blockout.off("click")),m.isMobile()&&a(n.element).blur(),n.element.css("z-index",n.elementZIndexOrig),n.element.css("position",n.elementPosOrig),T(),n.element.trigger({type:"dp.hide",date:j(n.date)}),X()}},n.setValue=function(a){j.locale(n.options.language),a?n.unset=!1:(n.unset=!0,Z()),
j.isMoment(a)||(a=j(a instanceof Date?a:S(a,n.format,a))),a.isValid()?(n.date=a,Z(),n.viewDate=j({y:n.date.year(),M:n.date.month()}),G(),K()):C(a)},n.getDate=function(){return n.unset?null:j(n.date)},n.setDate=function(a){var b=j(n.date);a?n.setValue(a):n.setValue(null),B(b,"function")},n.setDisabledDates=function(a){n.options.disabledDates=ba(a),n.viewDate&&D()},n.setEnabledDates=function(a){n.options.enabledDates=ba(a),n.viewDate&&D()},n.setMaxDate=function(a){void 0!==a&&(n.options.maxDate=j(a),n.viewDate&&D())},n.setMinDate=function(a){void 0!==a&&(n.options.minDate=j(a),n.viewDate&&D())},p()};a.fn.datetimepicker=function(b){function c(c){var d=a(c);d.data("DateTimePicker")||d.data("DateTimePicker",new m(c,b))}return this.each(c.bind(null,this))},a.fn.datetimepicker.defaults={pickDate:!0,pickTime:!0,useMinutes:!0,useSeconds:!1,useCurrent:!0,minuteStepping:1,minDate:new j({y:1900}),maxDate:(new j).add(1e3,"y"),showToday:!0,collapse:!0,language:"en",defaultDate:"",disabledDates:!1,
enabledDates:!1,icons:{},useStrict:!1,direction:"auto",sideBySide:!1,daysOfWeekDisabled:!1,widgetParent:!1}});
define('ui/elements/date-time/date-time-control',['require','exports','module','lodash','jquery','logging/error-notification-handler','system/diagnostics/log-manager','system/lang/event','system/hardware/device','ui/elements/date-time/bootstrap-datetimepicker'],function(require,exports,module){"use strict";var a=require("lodash"),b=require("jquery"),c=require("logging/error-notification-handler"),d=require("system/diagnostics/log-manager"),e=d.getLogger(module.id),f=require("system/lang/event"),g=require("system/hardware/device");require("ui/elements/date-time/bootstrap-datetimepicker");function h(a){this.element=a,this.options=null,this.picker=null,this.changed=new f,this.invalid=new f,this.clear=new f,this.blur=new f,this.hide=new f,this.inputGroup=null,this.input=null,this.addon=null,this.button=null,this.icon=null,this.$input=null,this.$addon=null,this.markValid=!1,this.errorNotificationHandler=Object.resolve(c)}h.culture="",h.setCulture=function(a){try{h.culture=a}catch(a){B(this,a)}},h.prototype.initHTML=function(){try{i(this)}catch(a){B(this,a)}},h.prototype.initialize=function(a){try{j(this,a)}catch(a){B(this,a)}},h.prototype.setValue=function(a){try{this.picker&&this.picker.setDate(a)}catch(a){B(this,a)}},
h.prototype.enable=function(){try{r(this,!1)}catch(a){B(this,a)}},h.prototype.disable=function(){try{r(this,!0)}catch(a){B(this,a)}},h.prototype.dispose=function(){try{k(this)}catch(a){B(this,a)}finally{l(this)}};function i(a){Element.clearDom(a.element),a.inputGroup=Element.build("div",a.element,["input-group","date"]),a.input=Element.build("input",a.inputGroup,["form-control"],{type:"text"}),a.addon=Element.build("span",a.inputGroup,["input-group-btn"]),a.button=Element.build("button",a.addon,["btn","btn-icon"]),a.icon=Element.build("span",a.button),a.$input=b(a.input),a.$addon=b(a.addon)}function j(a,b){if(b){var c;a.options&&(c=a.options.format),a.options=b,a.options.oldFormat=c}l(a),o(a),p(a)}function k(a){a.changed.remove(),a.changed=null,a.invalid.remove(),a.invalid=null,a.clear.remove(),a.clear=null,l(a)}function l(a){m(a),n(a)}function m(a){a.$addon.off(),a.$input.off()}function n(a){a.picker&&(a.picker.destroy(),a.picker=null)}function o(a){
a.options.pickDate?(a.icon.classList.add("icon-calendar"),a.icon.classList.remove("icon-time-units")):(a.icon.classList.add("icon-time-units"),a.icon.classList.remove("icon-calendar"))}function p(a){a.picker=q(a),r(a,a.options.disabled),s(a)}function q(a){return a.$input.datetimepicker({pickDate:a.options.pickDate,pickTime:a.options.pickTime,useMinutes:a.options.useMinutes,useSeconds:a.options.useSeconds,minuteStepping:a.options.minuteStep,format:a.options.format,oldFormat:a.options.oldFormat,language:h.culture,useCurrent:a.options.useCurrent}),a.$input.data("DateTimePicker")}function r(a,b){a.picker&&b?a.picker.disable():a.picker&&!b&&a.picker.enable(),a.input.disabled=b,a.button.disabled=b}function s(a){a.$addon.click(u.bind(null,a)),a.$input.change(v),a.$input.on("dp.change",w.bind(null,a)),a.$input.on("blur",x.bind(null,a)),a.$input.on("dp.error",z.bind(null,a)),a.$input.on("dp.hide",y.bind(null,a)),a.$input.on("dp.clear",A.bind(null,a)),t(a)}function t(a){
Object.resolve(g).isMobile()&&(a.input.readOnly=!0)}function u(a){a.input.focus()}function v(a){a.stopPropagation()}function w(c,d){var e=d.oldDate?d.oldDate.toDate():null,f=d.date?d.date.toDate():null;a.defer(function(){b(c.input).removeClass("date-error"),c.input.style.border="1px solid #c0c5c5",c.input.style.padding="10px"}),c.changed.raise(c,e,f)}function x(a,b){a.blur.raise(a),b.stopPropagation()}function y(a,b){a.hide.raise(),b.stopPropagation()}function z(c,d){c.input.value||!c.input.value&&c.element.required?(c.invalid.raise(c,c.input.value),a.defer(function(){c.markValid||b(c.input).addClass("date-error")})):c.changed.raise(c,null,null)}function A(a,b){a.clear.raise(),b.stopPropagation()}function B(a,b){e.error(b.stack),a.errorNotificationHandler.addError({errorMessage:b.message,errorDetail:b.stack})}return h});
define('ui/elements/date-time/element',['require','exports','module','lodash','jquery','logging/error-notification-handler','system/diagnostics/log-manager','system/lang/converter','./date-time-control'],function(require,exports,module){"use strict";var a=require("lodash"),b=require("jquery"),c=require("logging/error-notification-handler"),d=require("system/diagnostics/log-manager"),e=d.getLogger(module.id),f=require("system/lang/converter"),g=require("./date-time-control"),h=Object.create(HTMLElement.prototype);h.createdCallback=function(){m(this),this.rebuild=a.debounce(U.bind(null,this),100),this.errorNotificationHandler=Object.resolve(c)},h.attachedCallback=function(){try{i(this)}catch(a){V(a,this)}},h.detachedCallback=function(){try{j(this)}catch(a){V(a,this)}finally{Element.clearDom(this)}},h.attributeChangedCallback=function(a,b,c){try{k(this,a,b,c)}catch(a){V(a,this)}};function i(a){a.control=new g(a),o(a),a.control.initHTML(),a.control.initialize({pickDate:a.pickDate,pickTime:a.pickTime,useMinutes:a.useMinutes,useSeconds:a.useSeconds,minuteStep:a.minuteStep,format:a.format,disabled:a.disabled,required:a.required,defaultDate:a.value,useCurrent:a.useCurrent}),
a.control.changed.add(E,null,a),a.control.blur.add(F,null,a),a.control.invalid.add(H,null,a),a.control.hide.add(G,null,a),a.control.clear.add(I,null,a)}function j(a){a.control.dispose(),a.control=null,Element.clearDom(a)}function k(a,b,c,d){"value"===b?(c=f.toNullableDate(c),d=f.toNullableDate(d),L(a,c,d)):"format"===b?a.format=p(a):"pick-date"===b?a.pickDate=q(a):"pick-time"===b?a.pickTime=r(a):"use-minutes"===b?a.useMinutes=s(a):"use-seconds"===b?a.useSeconds=t(a):"minute-step"===b?a.minuteStep=u(a):"disabled"===b?a.disabled=v(a):"required"===b?a.required=x(a):"populate-empty"===b&&(a.useCurrent=w(a)),l(a)}function l(a){a._properties.value&&a.control.picker.setValue(a.control.picker.date.toDate())}function m(b){b._properties={pickDate:!0,pickTime:!0,useMinutes:!0,useSeconds:!1,minuteStep:1,format:"",disabled:!1,required:!1,useCurrent:!0,oldValue:null},a.each(b._properties,n.bind(null,b)),b._properties.value=f.toDate(),Element.defineProperty(b,"value",{get:A.bind(null,b,"value"),
set:C.bind(null,b)})}function n(a,b,c){Object.defineProperty(a,c,{get:A.bind(null,a,c),set:B.bind(null,a,c)})}function o(a){a._properties.format=p(a),a._properties.pickDate=q(a),a._properties.pickTime=r(a),a._properties.useMinutes=s(a),a._properties.useSeconds=t(a),a._properties.minuteStep=u(a),a._properties.disabled=v(a),a._properties.value=f.toDate(z(a),void 0,z(a)),a._properties.required=x(a),a._properties.useCurrent=w(a),a._properties.oldValue=a._properties.value}function p(a){return Element.stringAttribute(a,"format",a.format)}function q(a){return y(a,"pick-date",a.pickDate)}function r(a){return y(a,"pick-time",a.pickTime)}function s(a){return y(a,"use-minutes",a.useMinutes)}function t(a){return y(a,"use-seconds",a.useSeconds)}function u(a){return Element.intAttribute(a,"minute-step",a.minuteStep)}function v(a){return Element.booleanAttribute(a,"disabled")}function w(a){return!Element.booleanAttribute(a,"populate-empty")}function x(a){return Element.booleanAttribute(a,"required")}
function y(a,b,c){var d=a.getAttribute(b);return d?f.toBoolean(d,"true"):c}function z(a){return Element.stringAttribute(a,"value",a.value)}function A(a,b){return a._properties[b]}function B(a,b,c){a._properties[b]=c,U(a)}function C(c,d){if(!window.CustomElements||window.CustomElements.useNative)D(c,d);else{var e,f=!1;c.parentNode&&c.parentNode.parentNode&&(e=c.parentNode.parentNode),e&&b(e).hasClass("layout-element-content")&&(f=!0),f?D(c,d):a.defer(function(){D(c,d)})}}function D(b,c){void 0!==c&&(""===c&&(c=null),null===c||void 0===c||a.isDate(c)||(c=f.toDate(c,void 0,c)),c=K(b,c),b._properties.value=c,b._properties.oldValue=c,b.control&&b.control.setValue(b.value))}function E(a,b,c,d){null===a.value&&null===d||L(a,a.value,d)}function F(a){M(a)}function G(a){N(a)}function H(a,b,c){var d=a._properties.value;if(c){var e;if(c=c.trim(),/AM|PM/.test(c.substr(c.length-2))&&(c=c.split(/AM|PM/)[0]),e=new Date(c.trim()),
!isNaN(e.getTime()))return void(a.value.getTime()!==e.getTime()&&(a.value=e,a.control.markValid=!0,P(a,d,a.value)))}a._properties.value=null,R(a,d)}function I(a){J(a)}function J(a){a.dispatchEvent(new CustomEvent("clear",{detail:{oldValue:null,newValue:null}}))}function K(a,b){if(b)return a.pickTime?!a.useSeconds&&b.setSeconds&&b.setSeconds(0,0):b.setHours(0,0,0,0),b}function L(a,b,c){T(b,c)&&(a._properties.value=c)}function M(a){T(a._properties.oldValue,a._properties.value)&&(P(a,a._properties.oldValue,a._properties.value),a._properties.oldValue=a._properties.value)}function N(a){O(a)&&T(a._properties.oldValue,a._properties.value)&&(Q(a,a._properties.oldValue,a._properties.value),a._properties.oldValue=a._properties.value)}function O(a){return a.getAttribute("update-on-close")}function P(a,b,c){a.dispatchEvent(new CustomEvent("change",{detail:{oldValue:b,newValue:c}}))}function Q(a,b,c){a.dispatchEvent(new CustomEvent("updateValueOnClose",{detail:{oldValue:b,newValue:c}}))}
function R(a,b){a.dispatchEvent(new CustomEvent("invalid",{detail:{oldValue:b,newValue:null}}))}function S(a){return Math.floor(a/1e3)}function T(a,b){return!a||(!b||S(a.valueOf())!==S(b.valueOf()))}function U(a){a.control&&(a.control.initialize({pickDate:a.pickDate,pickTime:a.pickTime,useMinutes:a.useMinutes,useSeconds:a.useSeconds,minuteStep:a.minuteStep,format:a.format,disabled:a.disabled,required:a.required,defaultDate:a.value,useCurrent:a.useCurrent}),a.disabled?a.control.disable():a.control.enable())}function V(a,b){e.error(a.stack),b.errorNotificationHandler.addError({errorMessage:a.message,errorDetail:a.stack})}return document.registerElement("mi-date-time",{prototype:h}),h});
define('query/execution/query-prompt-view-model',['require','lodash','jquery','knockout','application/application-events','application/application-context','system/knockout/knockout-manager','spa/ko/knockout-view-model','system/error/error-message','system/globalization/translator','../services/query-service','../services/dto/parameter-container-dto','../adapters/parameter-design-adapter','../adapters/parameter-value-adapter','text!./views/query-prompt.html','assets/services/asset-context-dto','system/lang/converter','moment','system/lang/object','ui/elements/select/view-model','ui/elements/multi-value/view-model','ui/elements/asset-context/view-model','ui/elements/date-time/bootstrap-datetimepicker','ui/elements/date-time/element'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("application/application-events"),e=require("application/application-context"),f=require("system/knockout/knockout-manager"),g=require("spa/ko/knockout-view-model"),h=require("system/error/error-message"),i=require("system/globalization/translator"),j=require("../services/query-service"),k=require("../services/dto/parameter-container-dto"),l=require("../adapters/parameter-design-adapter"),m=require("../adapters/parameter-value-adapter"),n=require("text!./views/query-prompt.html"),o=require("assets/services/asset-context-dto"),p=require("system/lang/converter"),q=require("moment");require("system/lang/object"),require("ui/elements/select/view-model"),require("ui/elements/multi-value/view-model"),require("ui/elements/asset-context/view-model"),require("ui/elements/date-time/bootstrap-datetimepicker"),require("ui/elements/date-time/element");function r(a,b){s.call(this,n),
this.kom=a,this.applicationEvents=b,this.translator=Object.resolve(i),this.queryService=Object.resolve(j),this.queryContainer=null,this.hasParamDependency=null,this.prompts=null,this.isLoading=!0,this.assetFinder=null,this.format=e.user.formats.dateTime,this.dateFormat=e.user.formats.shortDate}var s=Object.inherit(g,r);r.dependsOn=[f,d],r.prototype.open=function a(b){},r.prototype.load=function a(c){var d=new b.Deferred,e;return this.queryContainer=c.queryContainer,e=this.queryContainer.parmContainer,this.hasParamDependency=this.kom.observable(e.hasDependencies),this.prompts=this.kom.observableArray(t(this,e.parmDesigns)),d.promise()},r.prototype.activate=function a(){},r.prototype.attach=function a(b){s.prototype.attach.call(this,b),this.region=b,this.isLoading=!1},r.prototype.detach=function a(b){s.prototype.detach.call(this,b)},r.prototype.deactivate=function a(b){this.kom.disposeSubscriptions(),this.kom.disposeComputeds()},r.prototype.unload=function a(){
this.kom.disposeObservables()},r.prototype.validatePrompt=function a(b){return!b.value()||(b.isMultiValue?!b.options||!b.options.length||b.values().length>0:"Numeric"!==b.paramDesign.dataType()||b.isAssetHierarchy?"Date"!==b.paramDesign.dataType()||(G(this,b.value())?(this.clearPromptValidationMessage(b),!0):(b.validationMessage(this.translate("QUERY_INVALID_DATE")),!1)):F(this,b.value().replace(",",""))?(this.clearPromptValidationMessage(b),!0):(b.validationMessage(this.translate("QUERY_INVALID_NUMBER")),!1))},r.prototype.validate=function a(){var b=0;for(b=0;b<this.prompts().length;b++){var c=this.prompts()[b];if(!this.validatePrompt(c))return!1}return!0},r.prototype.clearPromptValidationMessage=function a(b){b.validationMessage(null)},r.prototype.getParameterValues=function b(){var c;return c=a.map(this.prompts(),H.bind(null,this)),new k({hasDependencies:this.hasParamDependency(),parmDesigns:l.toDTOArray(c)})},r.prototype.multiSelectValueChanged=function a(){
this.hasParamDependency()&&D(this,null)},r.prototype.translate=function(a){return this.translator.translate(a)};function t(b,c){var d,e;return d=l.toModelObjectArray(c),b.kom.disposeSubscriptions(),e=a.map(d,u.bind(null,b))}function u(b,c,d){var e,f=a.map(c.list(),B.bind(null,b,c)),g=f;return f&&f.length>0||(f=c.parameterValues(),g=m.toDTOArray(c.parameterValues())),"Boolean"===c.dataType()&&(f=[{displayValue:"All",value:"A"},{displayValue:"True",value:"Y"},{displayValue:"False",value:"N"}],g=f),e={caption:c.localizedCaption()||c.caption()||c.id()||b.translate("QUERY_EXEC_PROMPT_ENTER_VAL"),options:f,cboOptions:g||[],values:b.kom.observableArray(w(b,c,f)),value:b.kom.observable(v(b,c,f)),isExclusive:c.isExclusive()||"Boolean"===c.dataType(),isMultiValue:c.isMultiValue(),paramDesign:c,isAssetHierarchy:c.isAssetHierarchy(),child:c.child(),parent:c.parent(),valueTemplate:A(c),all:c.all(),current:c.current(),validationMessage:b.kom.observable(),isGis:c.isGis(),isHidden:c.isHidden(),
format:c.format(),alias:c.alias(),distance:c.distance(),entyKey:c.entyKey(),justTheDate:c.justTheDate()},b.hasParamDependency()&&(e.isExclusive||e.options.length||e.value.extend({rateLimit:{timeout:1200,method:"notifyWhenChangesStop"}}),e.isMultiValue||d+1<b.queryContainer.parmContainer.parmDesigns.length&&b.kom.subscribe(e.value,D.bind(null,b,d))),e}function v(b,d,f){var g,h=d.parameterPrompts();if(h&&h.length)return z(b,d,h[0]);if(null!==d.defaultValue()){if("Date"===d.dataType()){var i=a.find(b.queryContainer.parmContainer.parmDesigns,function(a,b){return a.caption===d.caption()});if(i&&i.parmValues.length)return C(b,d,d.defaultValue())}return z(b,d,d.defaultValue())}return f&&f.length?z(b,d,c.unwrap(f[0].value)):d.isAssetHierarchy()?(g=e.assetcontext||new o,g.entityKey&&"0"!==g.entityKey&&0!==g.entityKey||(g.entityKey="-1"),g):"Date"===d.dataType()?new Date:void 0}function w(a,b,c){var d=0,e=b.parameterPrompts(),f;if(b.isMultiValue()){if(e&&e.length){
for(d=0;d<e.length;d++)if(f=e[d],c&&c.length&&!x(c,f))return b.parameterPrompts.removeAll(),b.parameterPrompts();return b.parameterPrompts()}return b.defaultValues()}}function x(b,c){return a.find(b,y.bind(null,c))}function y(a,b){return c.utils.unwrapObservable(b.value)===a}function z(a,b,c){return"Date"===b.dataType()?p.toDate(c,"yyyy-MM-ddTHH:mm:ss.fff"):c}function A(a){switch(a.dataType()){case"Date":return a.justTheDate()?"prompt-date-template":"prompt-datetime-template";case"Numeric":return"prompt-number-template";default:return"prompt-text-template"}}function B(a,b,c){return{value:z(a,b,c),displayValue:C(a,b,c)}}function C(a,b,c){var d,e=c;return"Date"===b.dataType()&&(d=z(a,b,c),e=p.toDateString(d,a.format)),e}function D(b,c){var d=b.queryContainer,e;b.isLoading||(e=a.map(b.prompts(),H.bind(null,b)),d.parmContainer.parmDesigns=l.toDTOArray(e),b.queryService.compileContainerParameters(d).done(E.bind(null,b,c)).fail(J.bind(null,b)))}function E(a,b,c){var d,e;a.isLoading=!0,
e=t(a,c.parmContainer.parmDesigns),null!==b&&(d=e[b],!d.value()||d.isExclusive||x(d.cboOptions,d.value())||d.cboOptions.push({displayValue:d.value(),value:d.value()})),a.prompts(e),a.isLoading=!1}function F(a,c){return!!b.isNumeric(c)}function G(a,b){return q(p.toDate(b,a.format,b)).isValid()}function H(a,b){var c;return b.isMultiValue?b.options&&b.options.length?b.paramDesign.parameterPrompts(b.values()):b.paramDesign.parameterPrompts(I(b.value())):b.value()instanceof o?(b.paramDesign.parameterPrompts([b.value().entityKey]),b.paramDesign.assetHierarchyCaption=b.value().description):b.value()instanceof Date?b.paramDesign.parameterPrompts([p.toDateString(b.value(),"yyyy-MM-ddTHH:mm:ss.fff")]):"Date"===b.paramDesign.dataType()&&b.value()?(c=p.toDate(b.value(),"yyyy-MM-ddTHH:mm:ss.fff",b.value()),b.paramDesign.parameterPrompts([p.toDateString(c,"yyyy-MM-ddTHH:mm:ss.fff")])):b.value()?b.paramDesign.parameterPrompts([b.value().toString()]):b.paramDesign.parameterPrompts([null]),
b.paramDesign}function I(a){var b;if(!a)return[];b=a.split(",");for(var c=0;c<b.length;c++)b[c].trim();return b}function J(a,b){var c=2,d=h.fromHttpResponse(c,b);a.applicationEvents.errorOccured.raise(a,d)}return r});

define('text!query/execution/views/query-prompt-dialog.html',[],function () { return '<div class="query-prompt-dialog block-group">\r\n    <div class="query-prompt-container">\r\n        &nbsp;\r\n    </div>\r\n    <div class="controls">\r\n        <button type="button"\r\n                class="btn  btn-text  btn-secondary"\r\n                data-bind="click: cancel,\r\n                           text: translate(\'CANCEL\')"></button>\r\n        <button type="button"\r\n                class="btn btn-text"\r\n                data-bind="click: done,\r\n                           enable: isDoneButtonEnabled,\r\n                           text: translate(\'DONE\').capitalize()"></button>        \r\n    </div>\r\n</div>';});

define('query/execution/query-prompt-dialog',['require','jquery','spa/ko/knockout-view-model','application/application-events','system/error/error-message','system/knockout/knockout-manager','spa/region','system/ui/dialog-view-model','./query-prompt-view-model','system/globalization/translator','text!./views/query-prompt-dialog.html','system/lang/string','system/lang/object'],function(require){"use strict";var a=require("jquery"),b=require("spa/ko/knockout-view-model"),c=require("application/application-events"),d=require("system/error/error-message"),e=require("system/knockout/knockout-manager"),f=require("spa/region"),g=require("system/ui/dialog-view-model"),h=require("./query-prompt-view-model"),i=require("system/globalization/translator"),j=require("text!./views/query-prompt-dialog.html");require("system/lang/string"),require("system/lang/object");function k(a,b,c,d){l.call(this,j),this.kom=a,this.applicationEvents=b,this.queryPromptRegion=c,this.queryPromptViewModel=d,this.translator=Object.resolve(i),this.dialog=null,this.dfd=null,this.isDoneButtonEnabled=null,this.queryContainer=null}var l=Object.inherit(b,k);k.dependsOn=[e,c,f,h],k.prototype.show=function b(c){var d={height:"70%",width:"30%"};return c=c||{},c.title=c.title||this.translate("QUERY_EXEC_PROMPT_DLG_TITLE"),this.queryContainer=c.queryContainer,this.dialog=new g(this,c.title,d),
this.dialog.show(),this.dfd=a.Deferred(),this.dfd.promise()},k.prototype.close=function a(){this.dialog=null},k.prototype.open=function a(){},k.prototype.load=function b(c){var d=new a.Deferred;return c=c||{},c.queryContainer=this.queryContainer,this.queryPromptViewModel.load(c),d.promise()},k.prototype.activate=function a(){this.queryPromptViewModel.activate(),this.isDoneButtonEnabled=this.kom.computed(m.bind(null,this))},k.prototype.attach=function a(b){l.prototype.attach.call(this,b),this.region=b,this.queryPromptRegion.setElement(this.region.$element.find("div.query-prompt-container")),this.queryPromptViewModel.attach(this.queryPromptRegion)},k.prototype.detach=function a(b){this.queryPromptViewModel.detach(this.queryPromptRegion),this.queryPromptRegion.clear(),l.prototype.detach.call(this,b)},k.prototype.canUnload=function a(){return this.queryPromptViewModel.canUnload()},k.prototype.deactivate=function a(){this.queryPromptViewModel.deactivate(this.queryPromptRegion),
this.kom.disposeSubscriptions(),this.kom.disposeComputeds()},k.prototype.unload=function a(){this.queryPromptViewModel.unload(),this.kom.disposeObservables()},k.prototype.translate=function(a){return this.translator.translate(a)},k.prototype.done=function a(){var b;this.queryPromptViewModel.validate()&&(b=this.queryPromptViewModel.getParameterValues(),this.dfd.resolve(b),this.dialog.closeDialog())},k.prototype.cancel=function a(){this.dfd.reject(),this.dialog.closeDialog()};function m(a){return a.queryPromptViewModel.validate()}function n(a,b){b&&a.dfd.resolve(b),a.dialog.closeDialog()}function o(a,b){var c=2,e=d.fromHttpResponse(c,b);a.applicationEvents.errorOccured.raise(a,e)}return k});
define('query/model/column-model',['require','knockout'],function(require){"use strict";var a=require("knockout");function b(b){b=b||{},this.id=a.observable(b.id),this.caption=a.observable(b.caption),this.defaultCaption=a.observable(b.defaultCaption),this.dataType=a.observable(b.dataType),this.isInactive=a.observable(b.isInactive),this.captionDisplay=a.computed(c.bind(null,this)),this.idUndecorated=a.computed(d.bind(null,this))}function c(a){var b=a.caption();if(b)return 0===b.indexOf("[")?b.substring(1,b.length-1):b}function d(a){var b=a.id();if(b)return 0===b.indexOf("[")?b.substring(1,b.length-1):b}return b});
define('query/adapters/column-adapter',['require','../services/dto/column-dto','../model/column-model'],function(require){"use strict";var a=require("../services/dto/column-dto"),b=require("../model/column-model");function c(){}return c.toModelObject=function a(c){return new b(c)},c.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},c.toDTO=function c(d){var e=new a;return d=d||new b,e.id=d.id(),e.caption=d.caption(),e.defaultCaption=d.defaultCaption(),e.dataType=d.dataType(),e.isInactive=d.isInactive(),e},c.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},c});
define('query/model/table-design-model',['require','knockout','../adapters/column-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/column-adapter");function c(c){var h=[];c=c||{},c.showAllFields||c.showAllFields===!1||(c.showAllFields=!0),c.showDataFields||c.showDataFields===!1||(c.showDataFields=!1),c.showInactiveFields||c.showInactiveFields===!1||(c.showInactiveFields=!1),c.showSystemFields||c.showSystemFields===!1||(c.showSystemFields=!1),this.alias=a.observable(c.alias),this.caption=a.observable(c.caption),this.defaultCaption=a.observable(c.defaultCaption),this.datasheetId=a.observable(c.datasheetId),this.id=a.observable(c.id),this.key=a.observable(c.key),this.layoutX=a.observable(c.layoutX),this.layoutY=a.observable(c.layoutY),this.name=a.observable(c.name),h=b.toModelObjectArray(c.queryColumns),this.queryColumns=a.observableArray(h&&h.length?h:[]),this.showAllFields=a.observable(c.showAllFields),this.showDataFields=a.observable(c.showDataFields),this.showInactiveFields=a.observable(c.showInactiveFields),
this.showSystemFields=a.observable(c.showSystemFields),this.storedQueryPath=a.observable(c.storedQueryPath),this.tableType=a.observable(c.tableType),this.captionDisplay=a.computed(d.bind(null,this)),this.idUndecorated=a.computed(e.bind(null,this)),this.aliasDisplay=a.computed({read:f.bind(null,this),write:g.bind(null,this)})}function d(a){var b=a.caption();if(b)return 0===b.indexOf("[")||0===b.indexOf("{")?b.substring(1,b.length-1):b}function e(a){var b=a.id();if(b)return 0===b.indexOf("[")||0===b.indexOf("{")?b.substring(1,b.length-1):b}function f(a){return a.alias()||a.captionDisplay()}function g(a,b){b=b.replace(/ /g,"_").replace(/\(/g,"").replace(/\)/g,"").replace(/-/g,"_"),a.alias(b)}return c});
define('query/adapters/table-design-adapter',['require','../services/dto/table-design-dto','../model/table-design-model','./column-adapter'],function(require){"use strict";var a=require("../services/dto/table-design-dto"),b=require("../model/table-design-model"),c=require("./column-adapter");function d(){}return d.toModelObject=function a(c){return new b(c)},d.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},d.toDTO=function d(e){var f=new a;return e=e||new b,f.alias=e.alias()||null,f.caption=e.caption()||null,f.defaultCaption=e.defaultCaption()||null,f.datasheetId=e.datasheetId(),f.id=e.id(),f.key=e.key(),f.layoutX=e.layoutX(),f.layoutY=e.layoutY(),f.name=e.name(),f.queryColumns=c.toDTOArray(e.queryColumns()),f.showAllFields=e.showAllFields(),f.showDataFields=e.showDataFields(),f.showInactiveFields=e.showInactiveFields(),f.showSystemFields=e.showSystemFields(),f.storedQueryPath=e.storedQueryPath(),f.tableType=e.tableType(),f},d.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]))
;return d}},d});
define('query/services/dto/expression-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.conditionOperator=a.toString(b.conditionOperator),this.operator=a.toString(b.operator),this.value=b.dateValue?a.toDate(b.dateValue):a.toString(b.value),this.dateValue=a.toDate(b.dateValue)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});

define('text!query/expression-simple-operators.json',[],function () { return '{\r\n    "Character": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_NOT_EQUALS", "value": "NotEqual", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_CONTAINS", "value": "Contains", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_NOT_CONTAINS", "value": "DoesNotContain", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_STARTS_WITH", "value": "StartsWith", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_ENDS_WITH", "value": "EndsWith", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NULL", "value": "IsNull", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_NULL", "value": "IsNotNull", "valueNeeded": false }\r\n    ],\r\n\r\n    "Character-dh": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true }\r\n    ],\r\n\r\n    "Numeric": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_ATMOST", "value": "EqualOrLessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_ATLEAST", "value": "EqualOrGreaterThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_NOT_EQUALS", "value": "NotEqual", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_LESS_THAN", "value": "LessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_GREATER_THAN", "value": "GreaterThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NULL", "value": "IsNull", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_NULL", "value": "IsNotNull", "valueNeeded": false }\r\n    ],\r\n\r\n    "Numeric-dh": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_ATMOST", "value": "EqualOrLessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_ATLEAST", "value": "EqualOrGreaterThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_LESS_THAN", "value": "LessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_GREATER_THAN", "value": "GreaterThan", "valueNeeded": true }\r\n    ],\r\n\r\n    "Date": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_ON", "value": "DayOf", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_AT", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_AT_OR_BEFORE", "value": "EqualOrLessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_AT_OR_AFTER", "value": "EqualOrGreaterThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_AT", "value": "NotEqual", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_BEFORE", "value": "LessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_AFTER", "value": "GreaterThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NULL", "value": "IsNull", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_NULL", "value": "IsNotNull", "valueNeeded": false }\r\n    ],\r\n\r\n    "Date-dh": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_AT", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_AT_OR_BEFORE", "value": "EqualOrLessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_AT_OR_AFTER", "value": "EqualOrGreaterThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_BEFORE", "value": "LessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_AFTER", "value": "GreaterThan", "valueNeeded": true }\r\n    ],\r\n\r\n    "Boolean": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_TRUE", "value": "True", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_FALSE", "value": "False", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NULL", "value": "IsNull", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_NULL", "value": "IsNotNull", "valueNeeded": false }\r\n    ],\r\n\r\n    "Boolean-dh": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_TRUE", "value": "True", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_FALSE", "value": "False", "valueNeeded": false }\r\n    ],\r\n\r\n    "Text": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_NOT_EQUALS", "value": "NotEqual", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_CONTAINS", "value": "Contains", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_NOT_CONTAINS", "value": "DoesNotContain", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_STARTS_WITH", "value": "StartsWith", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_ENDS_WITH", "value": "EndsWith", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NULL", "value": "IsNull", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_NULL", "value": "IsNotNull", "valueNeeded": false }\r\n    ],\r\n\r\n    "Text-dh": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true }\r\n    ],\r\n\r\n    "Unknown": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_NOT_EQUALS", "value": "NotEqual", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NULL", "value": "IsNull", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_NULL", "value": "IsNotNull", "valueNeeded": false }\r\n    ],\r\n\r\n    "Unknown-dh": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true }\r\n    ]\r\n}\r\n';});

define('query/model/expression-simple-operator-model',['require','system/globalization/translator'],function(require){"use strict";var a=require("system/globalization/translator");function b(b){b=b||{};var c=Object.resolve(a);this.text=c.translate(b.text),this.value=b.value,this.valueNeeded=b.valueNeeded!==!1,this.dataType=b.dataType}return b});
define('query/model/expression-simple-operator-list',['require','ramda','text!../expression-simple-operators.json','./expression-simple-operator-model'],function(require){"use strict";var a=require("ramda"),b=require("text!../expression-simple-operators.json"),c=require("./expression-simple-operator-model");function d(a){a&&a.length?this.items=a.map(e):this.items=[]}function e(a){return new c(a)}d.loadOperatorsForDataType=function a(c){return c=c||"Unknown",f(c,JSON.parse(b)[c])};function f(b,c){var e=g(b);return new d(a.map(e,c))}var g=a.curry(function a(b,c){return c.dataType=b,c});return d});
define('query/adapters/expression-simple-operator-adapter',['require','ramda','../model/expression-simple-operator-list'],function(require){"use strict";var a=require("ramda"),b=require("../model/expression-simple-operator-list");function c(){}var d=a.propEq("value");return c.toModelObject=function c(e,f){var g=b.loadOperatorsForDataType(f);return a.find(d(e),g.items)},c.toModelObjectArray=function a(b,d){return b.map(function(a,b){return c.toModelObject(a,b)})},c});
define('query/model/expression-model',['require','knockout','../adapters/expression-simple-operator-adapter','system/lang/converter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/expression-simple-operator-adapter"),c=require("system/lang/converter");function d(b,d){b=b||{},this.conditionOperator=a.observable(b.conditionOperator),this.value=a.observable(b.value),this.dataType=a.observable(d),"Date"===d&&this.value(c.toDate(b.dateValue)),this.operator=a.observable(e(b,d)),this.valueNeeded=a.computed(f.bind(null,this)),this.operator.subscribe(g.bind(null,this)),this.template=a.computed(h.bind(null,this))}function e(a,c){return a.operator?b.toModelObject(a.operator,c):null}function f(a){return!a.operator()||a.operator().valueNeeded}function g(a,b){a.valueNeeded()?"Date"!==b.dataType||a.value()||a.value(new Date):a.value(null)}function h(a){switch(a.dataType()){case"Date":return a.operator()&&"DayOf"===a.operator().value?"exp-bld-simple-date-template":"exp-bld-simple-datetime-template";case"Boolean":return"exp-bld-simple-boolean-template";default:
return"exp-bld-simple-text-template"}}return d.prototype.toString=function a(){return this.operator()?(this.conditionOperator()?this.conditionOperator()+" ":"")+this.operator().value+(this.value()?" '"+this.value()+"'":""):""},d});
define('query/adapters/expression-adapter',['require','../services/dto/expression-dto','../model/expression-model','system/lang/converter'],function(require){"use strict";var a=require("../services/dto/expression-dto"),b=require("../model/expression-model"),c=require("system/lang/converter");function d(){}return d.toModelObject=function a(c,d){return new b(c,d)},d.toModelObjectArray=function a(b,c){var e=0,f=[];if(b&&b.length){for(e=0;e!==b.length;e++)f.push(d.toModelObject(b[e],c));return f}},d.toDTO=function b(d){var e=new a;return d=d||{},e.conditionOperator=d.conditionOperator()||"",e.operator=d.operator()?d.operator().value||"":"",e.value=d.value(),d.value()&&d.value()instanceof Date&&(e.dateValue=c.toDateString(d.value(),"yyyy-MM-ddTHH:mm:ss.fff")),e},d.toDTOArray=function a(b){var c=0,e=[];if(b&&b.length){for(c=0;c!==b.length;c++)e.push(d.toDTO(b[c]));return e}},d});
define('query/model/query-criteria-model',['require','knockout','../adapters/expression-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/expression-adapter");function c(c,d){c=c||{},this.expressions=a.observableArray(b.toModelObjectArray(c.expressions,d))}return c.prototype.toString=function a(){var b=0,c="",d="";for(b=0;b<this.expressions().length;b++)d=this.expressions()[b].toString(),c+=d.length>0?d+" ":"";return c},c});
define('query/adapters/query-criteria-adapter',['require','../services/dto/query-criteria-dto','../model/query-criteria-model','./expression-adapter'],function(require){"use strict";var a=require("../services/dto/query-criteria-dto"),b=require("../model/query-criteria-model"),c=require("./expression-adapter");function d(){}return d.toModelObject=function a(c,d){return c?new b(c,d):null},d.toModelObjectArray=function a(b,c){var e=0,f=[];if(!b||!b.length)return f;for(e=0;e!==b.length;e++)f.push(d.toModelObject(b[e],c));return f},d.toDTO=function b(d){if(!d)return null;var e=new a;return d=d||{},e.expressions=c.toDTOArray(d.expressions()),e},d.toDTOArray=function a(b){var c=0,d=[];if(!b||!b.length)return d;for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d},d});
define('query/model/column-design-model',['require','knockout','../adapters/column-adapter','../adapters/query-criteria-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/column-adapter"),c=require("../adapters/query-criteria-adapter");function d(d){d=d||{},this.alias=a.observable(d.alias),this.caption=a.observable(d.caption),this.defaultCaption=a.observable(d.defaultCaption),this.criterias=a.observableArray(d.criterias),this.crosstab=a.observable(d.crosstab),this.dataType=a.observable(d.dataType),this.display=a.observable(d.display),this.expressionText=a.observable(d.expressionText),this.hyperlink=a.observable(d.hyperlink),this.id=a.observable(d.id),this.include=a.observable(d.include),this.key=a.observable(d.key),this.layoutWidth=a.observable(d.layoutWidth),this.resultFilterExpression=a.observable(d.resultFilterExpression),this.sortIndex=a.observable(d.sortIndex),this.sortOrder=a.observable(d.sortOrder),this.tableDesignKey=a.observable(d.tableDesignKey),this.total=a.observable(d.total),this.appendTo=a.observable(b.toModelObject(d.appendTo)),
this.updateTo=a.observable(d.updateTo),this.simpleCriteria=a.observableArray([]),this.simpleCriteria(c.toModelObjectArray(d.simpleCriteria,this.dataType())),this.captionDisplay=a.computed(e.bind(null,this)),this.idUndecorated=a.computed(f.bind(null,this)),this.isSelected=a.observable(!1),this.include.subscribe(g.bind(null,this)),this.display.subscribe(h.bind(null,this)),this.expressionText.subscribe(i.bind(null,this))}function e(a){var b=a.caption();if(b)return 0===b.indexOf("[")?b.substring(1,b.length-1):b}function f(a){var b=a.id();if(b)return 0===b.indexOf("[")?b.substring(1,b.length-1):b}function g(a){a&&a.include&&null!==a.include()&&void 0!==a.include()&&(a.include()||a.display(!1))}function h(a){a&&a.display&&null!==a.display()&&void 0!==a.display()&&a.display()&&a.include(!0)}function i(a){a&&a.expressionText&&a.expressionText()&&a.tableDesignKey("")}return d});
define('query/adapters/column-design-adapter',['require','../services/dto/column-design-dto','../model/column-design-model','../adapters/column-adapter','./query-criteria-adapter'],function(require){"use strict";var a=require("../services/dto/column-design-dto"),b=require("../model/column-design-model"),c=require("../adapters/column-adapter"),d=require("./query-criteria-adapter");function e(){}return e.toModelObject=function a(c){return new b(c)},e.toModelObjectArray=function a(b){var c=0,d=[];if(!b||!b.length)return d;for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d},e.toDTO=function b(e){var f=new a;return e=e||{},f.alias=e.alias()||null,f.caption=e.caption()||null,f.defaultCaption=e.defaultCaption()||null,f.criterias=e.criterias(),f.crosstab=e.crosstab(),f.dataType=e.dataType(),f.display=e.display(),f.expressionText=e.expressionText(),f.hyperlink=e.hyperlink(),f.id=e.id()||null,f.include=e.include(),f.key=e.key(),f.layoutWidth=e.layoutWidth(),f.resultFilterExpression=e.resultFilterExpression(),f.sortIndex=e.sortIndex(),f.sortOrder=e.sortOrder(),f.tableDesignKey=e.tableDesignKey(),f.total=e.total(),f.appendTo=c.toDTO(e.appendTo()),
f.updateTo=e.updateTo(),f.simpleCriteria=d.toDTOArray(e.simpleCriteria()),f},e.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},e});
define('query/model/operand-model',['require','knockout'],function(require){"use strict";var a=require("knockout");function b(b){b=b||{},this.tableDesignKey=a.observable(b.tableDesignKey),this.columnId=a.observable(b.columnId),this.charOperand=a.observable(b.charOperand)}return b});
define('query/adapters/operand-adapter',['require','../services/dto/operand-dto','../model/operand-model'],function(require){"use strict";var a=require("../services/dto/operand-dto"),b=require("../model/operand-model");function c(){}return c.toModelObject=function a(c){return new b(c)},c.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},c.toDTO=function b(c){var d=new a;return c=c||{},d.tableDesignKey=c.tableDesignKey(),d.columnId=c.columnId(),d.charOperand=c.charOperand(),d},c.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},c});
define('query/model/condition-model',['require','knockout','../adapters/operand-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/operand-adapter");function c(c){c=c||{},this.leftOperand=a.observable(b.toModelObject(c.leftOperand)),this.operator=a.observable(c.operator),this.rightOperand=a.observable(b.toModelObject(c.rightOperand)),this.nextOperator=a.observable(c.nextOperator)}return c});
define('query/adapters/condition-adapter',['require','../services/dto/condition-dto','../model/condition-model','../adapters/operand-adapter'],function(require){"use strict";var a=require("../services/dto/condition-dto"),b=require("../model/condition-model"),c=require("../adapters/operand-adapter");function d(){}return d.toModelObject=function a(c){return new b(c)},d.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},d.toDTO=function b(d){var e=new a;return d=d||{},e.leftOperand=c.toDTO(d.leftOperand()),e.operator=d.operator(),e.rightOperand=c.toDTO(d.rightOperand()),e.nextOperator=d.nextOperator(),e},d.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},d});
define('query/model/join-design-model',['require','knockout','system/globalization/translator','../adapters/condition-adapter'],function(require){"use strict";var a=require("knockout"),b=require("system/globalization/translator"),c=require("../adapters/condition-adapter");function d(d){d=d||{},this.translator=Object.resolve(b),this.conditions=a.observableArray(c.toModelObjectArray(d.conditions)),this.isMiJoin=a.observable(d.isMiJoin),this.joinSucc=a.observable(d.joinSucc),this.joinType=a.observable(d.joinType),this.key=a.observable(d.key),this.leftDesignKey=a.observable(d.leftDesignKey),this.relDesignKey=a.observable(d.relDesignKey),this.rightDesignKey=a.observable(d.rightDesignKey),this.joinDesignKey=a.observable(d.joinDesignKey),this.jointLinkIds=[],this.leftDesignName=a.observable(this.leftDesignKey()),this.rightDesignName=a.observable(this.rightDesignKey()),this.relDesignName=a.observable(this.relDesignKey()),this.predDesignKey=a.computed(e.bind(null,this)),this.succDesignKey=a.computed(f.bind(null,this)),this.predDesignName=a.computed(g.bind(null,this)),
this.succDesignName=a.computed(h.bind(null,this)),this.innerDescription=a.computed(k.bind(null,this)),this.leftDescription=a.computed(l.bind(null,this)),this.rightDescription=a.computed(m.bind(null,this)),this.predColumnId=a.computed(i.bind(null,this)),this.succColumnId=a.computed(j.bind(null,this))}function e(a){return a.joinSucc()?a.leftDesignKey():a.rightDesignKey()}function f(a){return a.joinSucc()?a.rightDesignKey():a.leftDesignKey()}function g(a){return a.joinSucc()?a.leftDesignName():a.rightDesignName()}function h(a){return a.joinSucc()?a.rightDesignName():a.leftDesignName()}function i(a){if(a.conditions&&a.conditions()[0]&&a.conditions()[0].leftOperand&&a.conditions()[0].leftOperand()&&a.conditions()[0].leftOperand().columnId)return a.joinSucc()?a.conditions()[0].leftOperand().columnId():a.conditions()[0].rightOperand().columnId()}function j(a){
if(a.conditions&&a.conditions()[0]&&a.conditions()[0].rightOperand&&a.conditions()[0].rightOperand()&&a.conditions()[0].rightOperand().columnId)return a.joinSucc()?a.conditions()[0].rightOperand().columnId():a.conditions()[0].leftOperand().columnId()}function k(a){return a.isMiJoin()?n(a,"QUERY_EDITOR_INNER_MI_JOIN_DESC_PREFIX")+" '"+a.relDesignName()+"'":n(a,"QUERY_EDITOR_INNER_JOIN_DESC")}function l(a){return a.isMiJoin()?n(a,"QUERY_EDITOR_JOIN_INC_PRED_DESC_PREFIX")+" '"+a.leftDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_SUCC_DESC_PREFIX")+" '"+a.rightDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_MI_REL_DESC_PREFIX")+" '"+a.relDesignName()+"'":n(a,"QUERY_EDITOR_JOIN_INC_PRED_DESC_PREFIX")+" '"+a.leftDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_SUCC_DESC_PREFIX")+" '"+a.rightDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_REL_DESC")}function m(a){
return a.isMiJoin()?n(a,"QUERY_EDITOR_JOIN_INC_PRED_DESC_PREFIX")+" '"+a.rightDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_SUCC_DESC_PREFIX")+" '"+a.leftDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_MI_REL_DESC_PREFIX")+" '"+a.relDesignName()+"'":n(a,"QUERY_EDITOR_JOIN_INC_PRED_DESC_PREFIX")+" '"+a.rightDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_SUCC_DESC_PREFIX")+" '"+a.leftDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_REL_DESC")}function n(a,b){return a.translator.translate(b)}return d});
define('query/adapters/join-design-adapter',['require','../services/dto/join-design-dto','../model/join-design-model','../adapters/condition-adapter'],function(require){"use strict";var a=require("../services/dto/join-design-dto"),b=require("../model/join-design-model"),c=require("../adapters/condition-adapter");function d(){}return d.toModelObject=function a(c){return new b(c)},d.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},d.toDTO=function b(d){var e=new a;return d=d||{},e.conditions=c.toDTOArray(d.conditions()),e.isMiJoin=d.isMiJoin(),e.joinSucc=d.joinSucc(),e.joinType=d.joinType(),e.key=d.key(),e.leftDesignKey=d.leftDesignKey(),e.relDesignKey=d.relDesignKey(),e.rightDesignKey=d.rightDesignKey(),e.joinDesignKey=d.joinDesignKey(),e},d.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},d});
define('query/model/parameter-container-model',['require','knockout','../adapters/parameter-design-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/parameter-design-adapter");function c(c){c=c||{},this.hasDependencies=a.observable(c.hasDependencies),this.parameterDesigns=a.observableArray(b.toModelObjectArray(c.parmDesigns))}return c});
define('query/adapters/parameter-container-adapter',['require','../services/dto/parameter-container-dto','../model/parameter-container-model','../adapters/parameter-design-adapter'],function(require){"use strict";var a=require("../services/dto/parameter-container-dto"),b=require("../model/parameter-container-model"),c=require("../adapters/parameter-design-adapter");function d(){}return d.toModelObject=function a(c){return new b(c)},d.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},d.toDTO=function b(d){var e;return d?(e=new a,e.hasDependencies=d.hasDependencies(),e.parmDesigns=c.toDTOArray(d.parameterDesigns()),e):null},d.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},d});
define('query/model/query-container-model',['require','lodash','knockout','system/lang/unique-id','../adapters/table-design-adapter','../adapters/column-design-adapter','catalog/services/catalog-constants','../adapters/join-design-adapter','../adapters/parameter-container-adapter','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("knockout"),c=require("system/lang/unique-id"),d=require("../adapters/table-design-adapter"),e=require("../adapters/column-design-adapter"),f=require("catalog/services/catalog-constants"),g=require("../adapters/join-design-adapter"),h=require("../adapters/parameter-container-adapter");require("system/lang/object"),b.extenders.numeric=function(a,c){var d=b.computed({read:a,write:function(b){var d=a(),e=Math.pow(10,c),f=isNaN(b)?0:parseFloat(+b),g=Math.round(f*e)/e;g!==d?a(g):b!==d&&a.notifySubscribers(g)}}).extend({notify:"always"});return d(a()),d};function i(a){a=a||{},this.catalogConstants=Object.resolve(f),a.tableDesigns=j(a.tableDesigns,a.joinDesigns),this.columnDesigns=b.observableArray(e.toModelObjectArray(a.columnDesigns)),this.isCaseInsensitive=b.observable(a.isCaseInsensitive),this.isChanged=b.observable(a.isChanged),this.isDeleteForce=b.observable(a.isDeleteForce),
this.isDistinct=b.observable(a.isDistinct),this.isFormatted=b.observable(a.isFormatted),this.isTop=b.observable(a.isTop),this.isUomVisible=b.observable(a.isUomVisible),this.joinDesigns=b.observableArray(g.toModelObjectArray(a.joinDesigns)),this.pageSize=b.observable(a.pageSize),this.parameterContainer=b.observable(h.toModelObject(a.parmContainer)),this.queryText=b.observable(a.queryText),this.queryType=b.observable(a.queryType),this.showTotals=b.observable(a.showTotals),this.sqlChanged=b.observable(a.sqlChanged),this.designChanged=b.observable(a.designChanged),this.startPage=b.observable(a.startPage),this.catalogPath=b.observable(a.catalogPath),this.tableDesigns=b.observableArray(d.toModelObjectArray(a.tableDesigns)),this.topRows=b.observable(a.topRows).extend({numeric:0}),this.uniqueId=b.observable(a.uniqueId||c.createV1()),this.asyncQueryRowLimit=b.observable(a.asyncQueryRowLimit),this.appendSource=b.observable(d.toModelObject(a.appendSource)),
this.predecessorSource=b.observable(d.toModelObject(a.predecessorSource)),this.successorSource=b.observable(d.toModelObject(a.successorSource)),this.designStatus=b.observable(a.designStatus),this.loadStatus=b.observable(a.loadStatus),this.queryTypeInt=b.computed(l.bind(null,this)),this.isDesignable=b.computed(m.bind(null,this)),this.maxCriteria=b.computed(k.bind(null,this)),this.tableDesigns.subscribe(n.bind(null,this),null,"arrayChange"),this.columnDesigns.subscribe(t.bind(null,this),null,"arrayChange"),this.joinDesigns.subscribe(w.bind(null,this),null,"arrayChange"),this.showTotals.subscribe(y.bind(null,this)),this.showTotals.subscribe(x.bind(null,this)),this.isDistinct.subscribe(x.bind(null,this)),this.appendSource.subscribe(z.bind(null,this)),A(this)}function j(b,c){var d=0,e,f,g=[],h=[],i=[];if(b){if(!c||!c.length)return b;for(d=0;d<c.length;d++)e=c[d],g.push(e.leftDesignKey),e.isMiJoin&&g.push(e.relDesignKey),g.push(e.rightDesignKey)
;for(d=0;d<g.length;d++)f=a.find(b,C.bind(null,g[d])),h.push(f);return a.union(h,b)}}function k(a){var b=0,c=0,d=0;for(b=0;b!==a.columnDesigns().length;b++)(c=a.columnDesigns()[b].criterias().length)>d&&(d=c);return d}function l(a){switch(a.queryType()){case"Select":return a.catalogConstants.QUERY_TYPE_SELECT;case"Update":return a.catalogConstants.QUERY_TYPE_UPDATE;case"Delete":return a.catalogConstants.QUERY_TYPE_DELETE;case"Append":return a.catalogConstants.QUERY_TYPE_APPEND;case"Transform":return a.catalogConstants.QUERY_TYPE_TRANSFORM;case"Crosstab":return a.catalogConstants.QUERY_TYPE_TRANSFORM;case"Datahub":return a.catalogConstants.QUERY_TYPE_AGGREGATE;default:return a.catalogConstants.QUERY_TYPE_NONE}}function m(a){var b=a.designStatus();return!!(!b||"Loaded"===b)}function n(b,c){var d=a.filter(c,o.bind(null,b)),e=a.filter(c,p.bind(null,b)),f=0,g=[],h,i=q(b.tableDesigns()),j=!1;for(f=0;f<e.length;f++)h=e[f].value,(!h.key()||parseInt(h.key(),10)<=0)&&(h.key(i),i++),
g=a.filter(b.tableDesigns(),r.bind(null,b,h.aliasDisplay())),g.length>1&&h.aliasDisplay(h.captionDisplay()+" "+g.length),"Datahub"===h.tableType()&&(j=!0);for(j?b.queryType("Datahub"):"Datahub"===b.queryType()&&b.queryType("Select"),f=0;f<d.length;f++)b.columnDesigns.remove(s.bind(null,b,d[f].value.key()))}function o(a,b){return"deleted"===b.status}function p(a,b){return"added"===b.status}function q(a){var b=0,c=0,d=0;for(b=0;b<a.length;b++)d=parseInt(a[b].key(),10),c=c<d?d:c;return(c+1).toString()}function r(a,b,c){return b===c.captionDisplay()}function s(a,b,c){return!!c.tableDesignKey()&&c.tableDesignKey().toString()===b.toString()}function t(b,c){var d=a.filter(c,p.bind(null,b)),e,f=0,g=q(b.columnDesigns());for(f=0;f<d.length;f++)e=d[f].value,u(b,e),(!e.key()||parseInt(e.key(),10)<=0)&&(e.key(g),g++),e.sortOrder()&&""!==e.sortOrder()||e.sortOrder("None"),e.sortIndex()&&""!==e.sortIndex()||e.sortIndex("0")}function u(b,c){if(!c.alias())return void c.alias("")
;if(!(a.filter(b.columnDesigns(),function(a){return a.alias()||a.alias(""),a.alias().toLowerCase()===c.alias().toLowerCase()}).length<=1)){var d=0,e;for(e=v(b,c,d);e;)d++,e=v(b,c,d);c.alias(c.alias()+d.toString())}}function v(b,c,d){return a.find(b.columnDesigns(),function(a){return a.alias().toLowerCase()===c.alias().toLowerCase()+d.toString()})}function w(b,c){var d=a.filter(c,p.bind(null,b)),e,f=0,g=q(b.joinDesigns());for(f=0;f<d.length;f++)e=d[f].value,parseInt(e.key(),10)<=0&&(e.key(g),g++),B(b,e,b.tableDesigns()),e.leftDesignName(),e.relDesignName(),e.rightDesignName()}function x(a){a&&a.showTotals&&a.isDistinct&&(a.showTotals()||a.isDistinct())&&a.isFormatted(!1)}function y(a,b){var c=0,d;for(c=0;c<a.columnDesigns().length;c++)d=a.columnDesigns()[c],b?d.total(d.include()?"GroupBy":"Where"):d.total("")}function z(a){var b=0,c;for(b=0;b<a.columnDesigns().length;b++)c=a.columnDesigns()[b],c.appendTo(null)}function A(a){var b=0,c
;for(b=0;b<a.joinDesigns().length;b++)c=a.joinDesigns()[b],B(a,c)}function B(c,d){var e=c.tableDesigns();d.leftDesignName(b.unwrap(a.find(e,C.bind(null,d.leftDesignKey())).caption)),d.rightDesignName(b.unwrap(a.find(e,C.bind(null,d.rightDesignKey())).caption)),d.isMiJoin()&&d.relDesignName(b.unwrap(a.find(e,C.bind(null,d.relDesignKey())).caption))}function C(a,c){return b.unwrap(c.key).toString()===a.toString()}return i});
define('query/adapters/query-container-adapter',['require','../services/dto/query-container-dto','../model/query-container-model','./table-design-adapter','./column-design-adapter','./join-design-adapter','./parameter-container-adapter'],function(require){"use strict";var a=require("../services/dto/query-container-dto"),b=require("../model/query-container-model"),c=require("./table-design-adapter"),d=require("./column-design-adapter"),e=require("./join-design-adapter"),f=require("./parameter-container-adapter");function g(){}return g.toModelObject=function a(c){return new b(c)},g.toDTO=function b(g){var h=new a;return g=g||{},h.columnDesigns=d.toDTOArray(g.columnDesigns()),h.isCaseInsensitive=g.isCaseInsensitive(),h.isChanged=g.isChanged(),h.isDeleteForce=g.isDeleteForce(),h.isDistinct=g.isDistinct(),h.isFormatted=g.isFormatted(),h.isTop=g.isTop(),h.isUomVisible=g.isUomVisible(),h.joinDesigns=e.toDTOArray(g.joinDesigns()),h.pageSize=g.pageSize(),h.parmContainer=f.toDTO(g.parameterContainer()),h.queryText=g.queryText(),h.queryType=g.queryType(),h.showTotals=g.showTotals(),h.sqlChanged=g.sqlChanged(),h.designChanged=g.designChanged(),h.startPage=g.startPage(),h.catalogPath=g.catalogPath(),
h.tableDesigns=c.toDTOArray(g.tableDesigns()),h.topRows=g.topRows(),h.uniqueId=g.uniqueId(),h.asyncQueryRowLimit=g.asyncQueryRowLimit(),h.appendSource=c.toDTO(g.appendSource()),h.predecessorSource=c.toDTO(g.predecessorSource()),h.successorSource=c.toDTO(g.successorSource()),h.designStatus=g.designStatus(),h.loadStatus=g.loadStatus(),h},g.cloneDTO=function(b){var c=JSON.stringify(b);return new a(JSON.parse(c))},g});
define('query/model/query-state-model',['require','knockout','../adapters/query-container-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/query-container-adapter");function c(c){c=c||{},this.version=c.version||2,this.queryContainer=a.observable(b.toModelObject(c.queryContainer)),this.selectedTableDesign=a.observable(),this.selectedJoinDesign=a.observable()}return c});
define('query/adapters/query-state-adapter',['require','../services/dto/query-state-dto','../model/query-state-model','./query-container-adapter'],function(require){"use strict";var a=require("../services/dto/query-state-dto"),b=require("../model/query-state-model"),c=require("./query-container-adapter");function d(){}return d.toModelObject=function a(c){if(c&&c.version)return new b(c)},d.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},d.toDTO=function b(d){var e=new a;return d=d||{},e.version=d.version,e.queryContainer=c.toDTO(d.queryContainer()),e},d.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},d});
define('query/execution/query-execution-engine',['require','jquery','ramda','application/application-events','system/error/error-message','system/globalization/translator','../services/query-service','catalog/services/catalog-service','catalog/services/dto/catalog-item-dto','catalog/services/catalog-constants','../services/dto/query-state-dto','../services/dto/query-container-dto','./query-prompt-dialog','../adapters/query-state-adapter','../adapters/query-result-adapter'],function(require){"use strict";var a=require("jquery"),b=require("ramda"),c=require("application/application-events"),d=require("system/error/error-message"),e=require("system/globalization/translator"),f=require("../services/query-service"),g=require("catalog/services/catalog-service"),h=require("catalog/services/dto/catalog-item-dto"),i=require("catalog/services/catalog-constants"),j=require("../services/dto/query-state-dto"),k=require("../services/dto/query-container-dto"),l=require("./query-prompt-dialog"),m=require("../adapters/query-state-adapter"),n=require("../adapters/query-result-adapter");function o(a){this._appEvents=Object.resolve(c),this._translator=Object.resolve(e),this._catConstants=Object.resolve(i),this._promptDialog=Object.resolve(l),this.queryService=Object.resolve(f),this.catalogService=Object.resolve(g),this.executionMode=null,this._dfd=null,a&&(p(this,a),this._opt=a)}o.prototype.execute=function b(c){var d,e=c||{};switch(this._dfd=a.Deferred(),
this.executionMode){case"SqlStatement":d=e.evalOnly?y.bind(null,this,e,this._opt.sqlStatement):s.bind(null,this,e,this._opt.sqlStatement);break;case"CatalogItemKey":d=e.evalOnly?M.bind(null,this,e,this._opt.catalogItemKey):G.bind(null,this,e,this._opt.catalogItemKey);break;case"CatalogItem":d=e.evalOnly?D.bind(null,this,e,this._opt.catalogItem):A.bind(null,this,e,this._opt.catalogItem);break;case"QueryContainer":d=e.evalOnly?R.bind(null,this,e,this._opt.queryContainer):O.bind(null,this,e,this._opt.queryContainer);break;default:throw this._translator.translate("QUERY_EXEC_UNKNOWN_MODE")}return d(),this._dfd.promise()},o.prototype.prompt=function b(c){var d;switch(this._dfd=a.Deferred(),c=c||{},this.executionMode){case"SqlStatement":d=t.bind(null,this,c,this._opt.sqlStatement);break;case"CatalogItemKey":d=H.bind(null,this,c,this._opt.catalogItemKey);break;case"CatalogItem":d=B.bind(null,this,c,this._opt.catalogItem);break;case"QueryContainer":
d=P.bind(null,this,c,this._opt.queryContainer);break;default:throw this._translator.translate("QUERY_EXEC_UNKNOWN_MODE")}return d(),this._dfd.promise()},o.prototype.compile=function b(c){var d;switch(this._dfd=a.Deferred(),this.executionMode){case"SqlStatement":d=u.bind(null,this,{},this._opt.sqlStatement);break;case"CatalogItemKey":d=I.bind(null,this,{},this._opt.catalogItemKey);break;case"CatalogItem":d=C.bind(null,this,{},this._opt.catalogItem);break;case"QueryContainer":d=Q.bind(null,this,{},this._opt.queryContainer);break;default:throw this._translator.translate("QUERY_EXEC_UNKNOWN_MODE")}return d(),this._dfd.promise()};function p(a,b){return b.catalogItemKey?void(a.executionMode="CatalogItemKey"):b.catalogItem?(q(a,b.catalogItem),void(a.executionMode="CatalogItem")):b.queryContainer?(r(a,b.queryContainer),void(a.executionMode="QueryContainer")):b.sqlStatement?void(a.executionMode="SqlStatement"):void 0}function q(a,b){
if(!(b instanceof h))throw a._translator.translate("QUERY_EXEC_INVALID_CAT_ITEM");if(b.itemType!==a._catConstants.ITEM_TYPE_QUERY)throw a._translator.translate("QUERY_EXEC_INVALID_CAT_ITEM");if(!b.query)throw a._translator.translate("QUERY_EXEC_INVALID_CAT_ITEM");if(!b.query.source)throw a._translator.translate("QUERY_EXEC_INVALID_CAT_ITEM")}function r(a,b){if(!(b instanceof k))throw a._translator.translate("QUERY_EXEC_INVALID_QUERY_CONT")}function s(a,b,c){a.queryService.compileString(c).done(v.bind(null,a,b)).fail(ea.bind(null,a))}function t(a,b,c){a.queryService.compileString(c).done(w.bind(null,a,b)).fail(ea.bind(null,a))}function u(a,b,c){a.queryService.compileString(c).done(x.bind(null,a,b)).fail(ea.bind(null,a))}function v(a,b,c){O(a,b,c)}function w(a,b,c){P(a,b,c)}function x(a,b,c){a._dfd.resolve(c)}function y(a,b,c){a.queryService.compileString(c).done(z.bind(null,a,b)).fail(ea.bind(null,a))}function z(a,b,c){R(a,b,c)}function A(a,b,c){var d=c.query.layout,e=new j(d)
;d&&d.queryContainer?O(a,b,e.queryContainer):s(a,b,c.query.source)}function B(a,b,c){var d=c.query.layout,e=new j(d);d&&d.queryContainer?P(a,b,e.queryContainer):t(a,b,c.query.source)}function C(a,b,c){var d=c.query.layout,e=new j(d);d&&d.queryContainer?Q(a,b,e.queryContainer):u(a,b,c.query.source)}function D(a,b,c){var d=c.query.layout,e=new j(d);d&&d.queryContainer?R(a,b,e.queryContainer):y(a,b,c.query.source)}function E(a,b,c){s(a,b,"(! '"+c+"')")}function F(a,b,c){y(a,b,"(! '"+c+"')")}function G(a,b,c){a.catalogService.getCatalogItem(c).done(J.bind(null,a,b)).fail(ea.bind(null,a))}function H(a,b,c){a.catalogService.getCatalogItem(c).done(K.bind(null,a,b)).fail(ea.bind(null,a))}function I(a,b,c){a.catalogService.getCatalogItem(c).done(L.bind(null,a,b)).fail(ea.bind(null,a))}function J(a,b,c){A(a,b,c)}function K(a,b,c){B(a,b,c)}function L(a,b,c){C(a,b,c)}function M(a,b,c){a.catalogService.getCatalogItem(c).done(N.bind(null,a,b)).fail(ea.bind(null,a))}function N(a,b,c){D(a,b,c)}
function O(a,b,c){b.suppressPrompts?Y(a,b,c):S(a,b,c).done(W.bind(null,a,b,c)).fail(a._dfd.reject)}function P(a,b,c){b.parameters&&c.parmContainer&&c.parmContainer.copyPromptValues(b.parameters),S(a,b,c).done(X.bind(null,a,b,c)).fail(a._dfd.reject)}function Q(a,b,c){a._dfd.resolve(c)}function R(a,b,c){b.suppressPrompts?$(a,b,c):S(a,b,c).done(Z.bind(null,a,b,c)).fail(a._dfd.reject)}function S(b,c,d){var e=a.Deferred();return T(d)?b.queryService.compileContainerParameters(d).then(V.bind(null,b),ea.bind(null,b)):(e.resolve(d.parmContainer),e.promise())}function T(a){var c,d,e;return c=a.parmContainer,d=c?c.parmDesigns:null,(e=d?b.filter(U,d):null)&&e.length>0}function U(a){return!a.isHidden}function V(a,b){return a._promptDialog.show({queryContainer:b})}function W(a,b,c,d){c.parmContainer=d,Y(a,b,c)}function X(a,b,c,d){c.parmContainer=d,a._dfd.resolve(c)}function Y(a,b,c){b&&(c.pageSize=b.pageSize||c.pageSize,c.startPage=b.startPage||c.startPage,
c.parmContainer=b.parameters||c.parmContainer,b.queryContainer&&(c.columnDesigns=b.queryContainer.columnDesigns||c.columnDesigns)),"Select"===c.queryType||"Crosstab"===c.queryType?b.sync?a.queryService.executeQueryContainerSync(c).done(ca.bind(null,a,c)).fail(ea.bind(null,a)):a.queryService.executeQueryContainer(c).done(ba.bind(null,a,c)).fail(ea.bind(null,a)):a.queryService.evaluateQueryContainer(c).done(aa.bind(null,a,b,c)).fail(ea.bind(null,a))}function Z(a,b,c,d){c.parmContainer=d,$(a,b,c)}function $(a,b,c){b&&(c.parmContainer=b.parameters||c.parmContainer),a.queryService.evaluateQueryContainer(c).done(_.bind(null,a,c)).fail(ea.bind(null,a))}function _(a,b,c){a._dfd.resolve({queryContainer:b,rowCount:c})}function aa(a,b,c,d){b.sync?a.queryService.executeQueryContainerSync(c).done(da.bind(null,a,c,d)).fail(ea.bind(null,a)):a.queryService.executeQueryContainer(c).done(da.bind(null,a,c,d)).fail(ea.bind(null,a))}function ba(a,b,c){a._dfd.resolve({queryContainer:b,rowset:c})}
function ca(a,b,c){a._dfd.resolve({queryContainer:b,result:n.toModel(c)})}function da(a,b,c){a._dfd.resolve({queryContainer:b,rowCount:c})}function ea(a,b){var c=2,e=d.fromHttpResponse(c,b);a._appEvents.errorOccured.raise(a,e),a._dfd.reject()}return o});
define('system/lang/time-zone',['require','moment-timezone','system/lang/private'],function(require){"use strict";var a=require("moment-timezone"),b=require("system/lang/private"),c="Invalid time zone identifier",d="Expected a date to be passed";function e(a){f(a),b(this).timeZoneId=a}function f(b){if(!a.tz.zone(b))throw c}var g=e.prototype;g.getTimeZoneId=function(){return b(this).timeZoneId},g.applyUtcOffset=function(c){var d,e,f;return j(c),d=b(this).timeZoneId,e=h(c),f=-a.tz.zone(d).offset(e),i(f,c)};function h(a){return Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds())}function i(a,b){var c=new Date(b.valueOf());return c.setMinutes(b.getMinutes()+a),c}g.removeUtcOffset=function(c){var d,e,f;return j(c),d=b(this).timeZoneId,e=h(c),f=a.tz.zone(d).parse(e),i(f,c)};function j(a){if(!(a instanceof Date))throw d}return e});
define('system/lang/time-zone-factory',['require','system/lang/time-zone','bluebird'],function(require){"use strict";var a=require("system/lang/time-zone"),b=require("bluebird");function c(a){return b.resolve().then(d.bind(null,a)).catch(function(a){throw a})}function d(b){return new a(b)}return{fromIanaTimeZoneId:c,fromIanaTimeZoneIdSync:d}});
define('ui/elements/date-time/timezone-handler',['require','system/lang/time-zone-factory','application/application-context','bluebird'],function(require){"use strict";var a=require("system/lang/time-zone-factory"),b=require("application/application-context"),c=require("bluebird");function d(){this.timezone=null}d.singleton=!0;var e=d.prototype;e.getTimezone=function(){var d=this,e;return d.timezone?c.resolve(f(d,d.timezone)).catch(h):(e=a.fromIanaTimeZoneId(b.user.ianaTimezoneId),c.resolve(e).catch(h).then(f.bind(null,d)).catch(h))},e.getUserTzDate=function(d){var e=this,i;return e.timezone?c.resolve(g(e,d)).catch(h):(i=a.fromIanaTimeZoneId(b.user.ianaTimezoneId),c.resolve(i).catch(h).then(f.bind(null,e)).then(g.bind(null,e,d)).catch(h))};function f(a,b){return a.timezone=b,b}function g(a,b){return a.timezone.applyUtcOffset(b)}function h(a){throw a}return d});
define('application/export-service',['require','lodash','jquery','system/http/ajax-client','application/application-context','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c="api/core/uiexport",d=require("system/http/ajax-client"),e=require("application/application-context");require("system/lang/object");function f(){var a=this;a.ajaxClient=Object.resolve(d),a.baseURL=a.ajaxClient.url(c),a.sessionID=e.session.id}return f.prototype.exportPage=function c(d,e,f){var g=this;e=e?e:"pdf",f+="."+e;var h=b("#shell-screen > .content-wrapper > .content"),i=b(h).width();b(h).width("1200px"),b(document).trigger("resize"),a.delay(function(){var a=b(h)[0].outerHTML;b(h).width(i),b(document).trigger("resize"),g.exportCall(a,d,e,f)},100)},f.prototype.exportCall=function d(e,f,g,h){var i=b("link"),j={htmlString:e,cssLinks:a.map(i,function(a){return a.outerHTML}),hiddenHtmlSelector:["button"],avoidPageBreaks:[".avoid-page-break"],addPageBreakBefore:[".add-page-break-before"],addPageBreakAfter:[".add-page-break-after"],orientation:"landscape"}
;j.orientation=f.orientation?f.orientation:j.orientation,j.htmlString=f.htmlString?f.htmlString:j.htmlString,f.cssLinks&&b.each(f.cssLinks,function(a,b){j.cssLinks.push(b)}),f.hiddenHtmlSelector&&b.each(f.hiddenHtmlSelector,function(a,b){j.hiddenHtmlSelector.push(b)}),f.avoidPageBreaks&&b.each(f.avoidPageBreaks,function(a,b){j.avoidPageBreaks.push(b)}),f.addPageBreakBefore&&b.each(f.addPageBreakBefore,function(a,b){j.addPageBreakBefore.push(b)}),f.addPageBreakAfter&&b.each(f.addPageBreakAfter,function(a,b){j.addPageBreakAfter.push(b)});var k=b('<form method="POST" action="'+c+'">');b.each(j,function(a,b){var c=document.createElement("input");c.setAttribute("name",a),c.setAttribute("value",b),k.append(c)});var l=document.createElement("input");l.setAttribute("name","type"),l.setAttribute("value",g),k.append(l);var m=document.createElement("input");m.setAttribute("name","fileName"),m.setAttribute("value",h),k.append(m),b("body").append(k),k.submit()},f});
define('ui/elements/resultgrid/config/default-config',['require','lodash','jquery'],function(require){"use strict";var a=require("lodash"),b=require("jquery");function c(a){return{allowColumnReordering:a.allowColumnReordering(),allowColumnResizing:a.allowColumnResizing(),columnAutoWidth:a.columnAutoWidth(),selection:{mode:a.selectionMode(),selectAllMode:"page"},scrolling:{mode:a.scrollType()},sorting:d(a),loadPanel:f(a),noDataText:a.noDataCaptioin,editing:e(a),wordWrapEnabled:a.wordWrapEnabled(),onContextMenuPreparing:function(a){"header"===a.target&&(a.items=[])}}}function d(a){return{mode:a.sortingMode(),ascendingText:a.translator.translate("RG_SORT_ASCENDING_CAPTION"),descendingText:a.translator.translate("RG_SORT_DESCENDING_CAPTION"),clearText:a.translator.translate("RG_CLEAR_SORTING_CAPTION")}}function e(a){return{mode:a.editMode(),allowUpdating:a.allowRowEditing(),allowAdding:a.allowRowAdding(),allowDeleting:a.allowRowDeleting(),texts:{addRow:a.translator.translate("RG_ADD_ROW_HELP_TEXT"),
cancelAllChanges:a.translator.translate("RG_CANCEL_CHANGES_HELP_TEXT"),deleteRow:a.translator.translate("RG_DELETE"),saveAllChanges:a.translator.translate("RG_SAVE_CHANGES_HELP_TEXT"),undeleteRow:a.translator.translate("RG_UNDELETE")}}}function f(a){return{enabled:a.loaderPanelEnabled(),showPane:!1,text:""}}return c});
define('system/text/clean-href',[],function(){"use strict";var a=/^([^:]+):|^#|^(.\/)|^(..\/)|^!/gm,b=/^(%20|\s)*(data|javascript)/im,c=/[^\x20-\x7E]/gim;return function(d){var e,f,g,h;if(d){if(e=d.replace(c,""),!(f=e.match(a)))return"";if(g=f[0],h=b.test(g))return"";d=e}return d}});
define('ui/elements/resultgrid/helpers/utils',['require','lodash','jquery','xss','system/text/clean-href','system/lang/converter','system/text/parser','system/text/formatter','application/application-context','system/ui/message-box','query/services/dto/query-container-dto','query/execution/query-execution-engine'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("xss"),d=require("system/text/clean-href"),e=require("system/lang/converter"),f=require("system/text/parser"),g=require("system/text/formatter"),h=Object.resolve(g),i=require("application/application-context"),j=require("system/ui/message-box"),k=require("query/services/dto/query-container-dto"),l=require("query/execution/query-execution-engine");function m(){}m.prototype.handleRowPrepared=function a(b,c,d){"data"===c.rowType&&Object.tryMethod(b,"rowPreparedCallback",c,c)},m.prototype.handleCellTemplateForActionColumn=function a(c,d,e){try{var f=b(e.value),g=f.data()||{};f=n(f),g.hyperlinkText=f.text(),g.hyperlinkUrl=f.attr("href"),f.addClass("dx-link").on("click",function(a){a.preventDefault()}).on("dxclick",function(){Object.tryMethod(c,"cellHyperlinkCallback",g)}).appendTo(d)}catch(a){throw c.translator.translate("RG_INVALID_HYPERLINK_FORMAT_MSG")}};function n(a){return a.text(c(a.text())),
a.attr("href",d(a.attr("href"))),a}m.prototype.handleCustomCellTemplate=function a(b,c,d){Object.tryMethod(b,"cellTemplateCallback",c,d)},m.prototype.handleHeaderCellTemplate=function a(b,c,d){Object.tryMethod(b,"headerCellTemplateCallback",c,d)},m.prototype.formatNumberValue=function a(b){var c=b.value;if(!c||isNaN(parseInt(c)))return 0===c?c.toString():c;var d=c.toString().split(".")[1],f=d?d.length:0;return h.format(e.toFloat(c),"n"+f)},m.prototype.formatDateValue=function a(b){var c=i.user.formats.shortDate;return h.format(b,c)},m.prototype.configurePrint=function a(c,d){c.showPrint()?b(c.element).find(".rg-print").show():b(c.element).find(".rg-print").hide(),0===d?b(c.element).find(".rg-print").attr("disabled",!0):b(c.element).find(".rg-print").removeAttr("disabled")};function o(a){for(var b=[],c=a.aggregateQueryParams.parmDesigns.length,d=0;d<c;d++)b.push(a.aggregateQueryParams.parmDesigns[d].id)
;for(var e=a.queryParams.parmDesigns.length,f=0;f<e;f++)if(b.indexOf(a.queryParams.parmDesigns[f].id)>-1)for(var g=0;g<c;g++)a.aggregateQueryParams.parmDesigns[g].id===a.queryParams.parmDesigns[f].id&&(a.aggregateQueryParams.parmDesigns[g]=a.queryParams.parmDesigns[f]);else a.aggregateQueryParams.parmDesigns.push(a.queryParams.parmDesigns[f])}m.prototype.getMenuPaging=function a(c,d){var e={};c.aggregateQueryParams?(c.queryParams&&o(c),e.parameters=c.aggregateQueryParams,e.suppressPrompts=!0):c.queryParams&&(e.parameters=c.queryParams,e.suppressPrompts=!0),c.suppressPrompts(!0),e.suppressPrompts=!0,e.evalOnly=!0,c.cachedQueryContainer?(p(c,c._queryTotalCount),b(c.element).find(".rg-pager").show(),c.getTotalCount=!1,c._queryTotalCount=0):"static"===c.data()&&"standard"===c.scrollType()?(p(c,d||c._totalCount()),b(c.element).find(".rg-pager").show(),c.getTotalCount=!1):c.loadJSONData&&(p(c,d),c.showPaging?b(c.element).find(".rg-pager").show():b(c.element).find(".rg-pager").hide(),
c.getTotalCount=!1)};function p(a,b){var c="",d=[];if(0!==b){for(var e=b/a.pageSize(),f=0;f<e;f++)c=f*a.pageSize()+1+" - "+(f+1)*a.pageSize(),d.push({displayName:c,val:f});var g=d[d.length-1],h=g.displayName;h=h.substr(0,h.indexOf("-")+2),g.displayName=h+b,a.selectedValue(""),a.listObjects(d),a.customTotalCount(b)}else a.selectedValue(""),a.listObjects([{displayName:"0",val:0}]),a.customTotalCount(0)}m.prototype.changePage=function a(b,c){if(!b.getTotalCount){var d=b.selectedValue();b.pageNumber=d,b.gridInstance.pageIndex(b.pageNumber)}};function q(a,c){a._totalCount()<a.pageSize()?(b(a.element).find(".pageControls .firstPage").attr("disabled","disabled"),b(a.element).find(".pageControls .prevPage").attr("disabled","disabled"),b(a.element).find(".pageControls .nextPage").attr("disabled","disabled"),b(a.element).find(".pageControls .lastPage").attr("disabled","disabled")):(b(a.element).find(".pageControls .firstPage").removeAttr("disabled"),
b(a.element).find(".pageControls .prevPage").removeAttr("disabled"),b(a.element).find(".pageControls .nextPage").removeAttr("disabled"),b(a.element).find(".pageControls .lastPage").removeAttr("disabled")),a.gridInstance.pageIndex()?a.gridInstance.pageIndex()===Math.floor(a._totalCount()/a.pageSize())&&(b(a.element).find(".pageControls .nextPage").attr("disabled","disabled"),b(a.element).find(".pageControls .lastPage").attr("disabled","disabled")):(b(a.element).find(".pageControls .firstPage").attr("disabled","disabled"),b(a.element).find(".pageControls .prevPage").attr("disabled","disabled")),"standard"!==a.scrollType()||a._totalCount()<a.pageSize()?b(a.element).find(".pageControls ").hide():b(a.element).find(".pageControls ").show()}function r(a,b){if(!a.gridInstance)return void console.error("grid instance not available");switch(b){case"first":a.gridInstance.pageIndex(0);break;case"prev":a.gridInstance.pageIndex(a.gridInstance.pageIndex()-1);break;case"next":
a.gridInstance.pageIndex(a.gridInstance.pageIndex()+1);break;case"last":a.gridInstance.pageIndex(Math.ceil(a._totalCount()/a.pageSize()))}}function s(a,b){j.showOk("Error in executing Query","Error")}function t(a){if(b(a.element).find(".dx-datagrid-pager.dx-pager").length){var c=b(a.element).find(".gridContainer").height()-b(a.element).find(".dx-datagrid-headers").height();b(a.element).find(".dx-datagrid-rowsview").height(c)}}return m});
define('ui/elements/resultgrid/helpers/json-helper',['require','lodash','jquery','./utils','system/lang/converter','system/text/parser','system/text/formatter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./utils"),d=require("system/lang/converter"),e=require("system/text/parser"),f=require("system/text/formatter"),g=Object.resolve(f);function h(){}var i=Object.inherit(c,h);h.prototype.preSelectRows=function a(c,d){try{var e=b(c.element).find(".gridContainer").dxDataGrid("instance");e&&e.selectRows(d)}catch(a){}},h.prototype.handleCellPrepared=function a(b,c){"data"===c.rowType&&Object.tryMethod(b,"cellPreparedCallback",c.cellElement,c)},h.prototype.handleInitNewRow=function a(b,c,d){Object.tryMethod(b,"onInitNewRowCallback",c,d)},h.prototype.handleContentReadyActionForJSON=function c(d){var e=b(d.element).find(".gridContainer").dxDataGrid("instance");b(d.element).find(".rg-controls").show(),b(d.element).find(".rg-header").show();var f=e.totalCount()>0?e.totalCount():0,g=b(".dx-datagrid-filter-row .dx-editor-cell").index(b(".dx-editor-cell.dx-focused"));d.filterElIndex=g!==-1?g:d.filterElIndex,
a.delay(function(){b(b(".dx-datagrid-filter-row .dx-editor-cell")[d.filterElIndex]).find("input").focus()},100),d.gridInstance=e,Object.tryMethod(d,"gridLoadedCallback",e),d.customTotalCount()!==f&&(d.getTotalCount=!0),"standard"===d.scrollType()?d.getTotalCount&&this.getMenuPaging(d,f):b(d.element).find(".dxDataGridTotalCount").show().text(d._totalCount()+" "+d.translator.translate("RG_TOTAL_COUNT_MESSAGE")),b(d.element).find(".dx-datagrid-pager.dx-pager").hide(),d.showGridBorder&&b(d.element).find("#gridContainer").addClass("grid-border"),this.configurePrint(d,f)},h.prototype.handleSelectionChangedForJSON=function c(d,e){var f;"single"===d.selectionMode()?(f=e.selectedRowsData[0],Object.tryMethod(d,"callback",f)):(f=a.map(e.selectedRowsData,function(a){return a.FEdefine&&a.FEdefine===!0&&a._notReplaceable===!0?b.extend(!0,a,{illegal:!0}):a}),Object.tryMethod(d,"multiSelectCallback",f))},h.prototype.handleSelectionChangeForJsonWithoutColumns=function b(c,d){var e
;"single"===c.selectionMode()?(e=d.selectedRowsData[0],Object.tryMethod(c,"callback",e)):(e=a.map(d.selectedRowsData,function(a){if(!a.FEdefine||a.FEdefine!==!0)return a}),Object.tryMethod(c,"multiSelectCallback",e))},h.prototype.handleEditorPreparedForJson=function b(c,d){var f=this;if("filterRow"===d.parentType&&"number"===d.dataType)d.editorElement.empty().dxTextBox({value:f.formatNumberValue(d),valueChangeEvent:"keyup",onValueChanged:a.debounce(function(a){var b=a.value?e.parseFloat(a.value):a.value;d.setValue(b),j(f,d,b)},500)});else if("dataRow"===d.parentType&&"number"===d.dataType)var g=d.editorElement.dxTextBox({value:f.formatNumberValue(d),onValueChanged:function(a){d.setValue(e.parseFloat(a.value))}})};function j(a,b,c){var d=b.editorElement.dxTextBox("instance"),e=d.element().find("input"),f=a.formatNumberValue({value:c});e.val(f)}h.prototype.handleEditingStart=function a(b,c){Object.tryMethod(b,"onEditingStart",c)},h.prototype.getColumnsFromData=function c(e,f){
for(var g=[],h=0;h<f.columns.length;h++){var i=a.extend({},f.columns[h])||{};if(i.dataField=f.columns[h].dataField||f.columns[h].id,void 0!==f.columns[h].alias&&""!==f.columns[h].alias?i.caption=f.columns[h].alias:i.caption||(i.caption=f.columns[h].id),void 0!==f.columns[h].isActionColumn&&"true"===f.columns[h].isActionColumn){i.cellTemplate=this.handleCellTemplateForActionColumn.bind(null,e);var j=k(i.dataField,f.data);i.calculateSortValue=j,i.calculateFilterExpression=l.bind(null,j)}else void 0!==f.columns[h].hasCellTemplate&&"true"===f.columns[h].hasCellTemplate&&(i.cellTemplate=this.handleCustomCellTemplate.bind(null,e));void 0!==f.columns[h].hasHeaderCellTemplate&&"true"===f.columns[h].hasHeaderCellTemplate&&(i.headerCellTemplate=this.handleHeaderCellTemplate.bind(null,e)),void 0!==f.columns[h].dataType&&(i.dataType=f.columns[h].dataType,"number"===i.dataType&&(i.customizeText=this.formatNumberValue)),i.encodeHtml=!0,
void 0!==f.columns[h].encodeHtml&&(i.encodeHtml=d.toBoolean(f.columns[h].encodeHtml,!0)),m(f.columns[h],i,"precision"),m(f.columns[h],i,"format"),m(f.columns[h],i,"cssClass"),m(f.columns[h],i,"alignment"),m(f.columns[h],i,"width"),m(f.columns[h],i,"allowFiltering",d.toBoolean(f.columns[h].allowFiltering,"true")),m(f.columns[h],i,"allowEditing",d.toBoolean(f.columns[h].allowEditing,"true")),m(f.columns[h],i,"fixed",d.toBoolean(f.columns[h].fixed,"true")),m(f.columns[h],i,"visible",d.toBoolean(f.columns[h].visible,!0)),void 0!==f.columns[h].lookup&&f[f.columns[h].lookup.dataSource]&&(i.lookup=b.extend({},f.columns[h].lookup),i.lookup.dataSource=f[f.columns[h].lookup.dataSource]),g.push(i)}return g};function k(a,c){for(var d=a+"_linkText",e=0;e<c.length;e++)c[e][d]=b(c[e][a]).text();return d}function l(a,b,c){return[a,c||"=",b]}function m(a,b,c,d){void 0!==a[c]&&(b[c]=4===arguments.length?d:a[c])}return h});
define('ui/elements/resultgrid/config/json-config',['require','lodash','jquery','./default-config','../helpers/json-helper'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./default-config"),d=Object.resolve(require("../helpers/json-helper"));function e(a,e,g){var h={dataSource:e.data,columns:g,pager:{visible:!1},onCellPrepared:d.handleCellPrepared.bind(null,a),onInitNewRow:d.handleInitNewRow.bind(null,a),onRowPrepared:d.handleRowPrepared.bind(null,a),onContentReady:d.handleContentReadyActionForJSON.bind(d,a),onSelectionChanged:g?d.handleSelectionChangedForJSON.bind(null,a):d.handleSelectionChangeForJsonWithoutColumns.bind(null,a),onEditorPrepared:d.handleEditorPreparedForJson.bind(d,a),onEditingStart:d.handleEditingStart.bind(null,a)};return"standard"===a.scrollType()&&(h.paging=f(a)),e.config&&b.extend(h,e.config),b.extend(h,c(a)),h}function f(a){return{enabled:!0,pageSize:a.pageSize()}}return e});
define('ui/elements/resultgrid/helpers/static-helper',['require','lodash','jquery','./utils','system/lang/converter','system/text/parser','system/text/formatter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./utils"),d=require("system/lang/converter"),e=require("system/text/parser"),f=require("system/text/formatter"),g=Object.resolve(f);function h(a){}var i=Object.inherit(c,h);h.prototype.handleStaticDataLoad=function a(c,d,e){var f=b.Deferred(),g;g=b(".dx-datagrid-filter-row .dx-editor-cell").index(b(".dx-editor-cell.dx-focused")),c.filterElIndex=g!==-1?g:c.filterElIndex,f.done(j.bind(null,c,d,e)),Object.tryMethod(c,"onPageChangeCB",f,d)};function j(a,c,d,e){a.rawQueryData=e,a.currentFilter!==c.filter&&(a.currentFilter=c.filter,a.getTotalCount=!0,a._totalCount(e.totalCount),b(a.element).find(".dxDataGridTotalCount").html(e.totalCount+" "+a.translator.translate("RG_TOTAL_COUNT_MESSAGE"))),d.resolve(e.data,{totalCount:e.totalCount}),b(b(".dx-datagrid-filter-row .dx-editor-cell")[a.filterElIndex]).find("input").focus()}h.prototype.handleGetTotalRecordsCount=function a(c,d){var e=b.Deferred()
;return Object.tryMethod(c,"totalCountCallback",e),e.done(function(a){c._totalCount(a)}),e.promise()},h.prototype.getStaticColumns=function a(b,c){for(var e=b.rawQueryData,f,g,h=0;h<c.length;h++)f=e.columns[h],g=c[h],g.dataField=f.id,void 0!==f.alias&&""!==f.alias?g.caption=f.alias:g.caption=f.id,void 0!==f.isActionColumn&&"true"===f.isActionColumn?g.cellTemplate=this.handleCellTemplateForActionColumn.bind(null,b):void 0!==f.hasCellTemplate&&"true"===f.hasCellTemplate&&(g.cellTemplate=this.handleCustomCellTemplate.bind(null,b)),void 0!==f.hasHeaderCellTemplate&&"true"===f.hasHeaderCellTemplate&&(g.headerCellTemplate=this.handleHeaderCellTemplate.bind(null,b)),g.encodeHtml=!0,void 0!==f.encodeHtml&&(g.encodeHtml=d.toBoolean(f.encodeHtml,!0)),k(f,g,"dataType"),"number"===g.dataType&&(g.customizeText=this.formatNumberValue),k(f,g,"format"),k(f,g,"precision"),k(f,g,"cssClass"),k(f,g,"alignment"),k(f,g,"width"),k(f,g,"allowFiltering",d.toBoolean(f.allowFiltering,"true")),
k(f,g,"visible",!("false"===f.visible||f.visible===!1)),k(f,g,"allowEditing",d.toBoolean(f.allowEditing,"true")),void 0!==f.lookup&&e[f.lookup.dataSource]&&(g.lookup=f.lookup,g.lookup.dataSource=e[f.lookup.dataSource]);return c};function k(a,b,c,d){void 0!==a[c]&&(b[c]=4===arguments.length?d:a[c])}return h});
define('ui/elements/resultgrid/adapters/dtos/column-info-dto',['require','lodash','jquery','knockout','system/lang/converter','system/text/parser','system/text/formatter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("system/lang/converter"),e=require("system/text/parser"),f=require("system/text/formatter"),g=Object.resolve(f),h={"System.DateTime":"date","System.Double":"number","System.Boolean":"boolean"};function i(a,b){this.dataField=j(a),this.visible=a.getIsDisplayed(),b||(this.dataType=k(a)),this.hyperlinkFormat=a.getHyperlinkFormat(),this.displayUomCaption=a.getDisplayUomCaption(),this.format=a.getFormat(),this.id=a.getFieldId(),this.fieldId=a.getFieldId(),this.alias=a.getAlias(),this.typename=a.getTypeName(),this.columnDesignKey=a.getColumnDesignKey(),this.hasCellTemplate=!1,this.encodeHtml=!0,this.visible=!0,this.fixed=!1,this.width=null}function j(a){var b=a.getAlias()||a.getFieldId();return isNaN(b)||(b+="_"),b=b.replace(/\./g,"__")}function k(a){var b;return b=h[a.getTypeName()],"Boolean"===a.getFieldDataType()&&(b="boolean"),b}return i});
define('ui/elements/resultgrid/adapters/query-data-adapter',['require','lodash','jquery','knockout','system/text/clean-href','system/lang/converter','system/text/parser','system/text/formatter','application/application-context','./dtos/column-info-dto'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("system/text/clean-href"),e=require("system/lang/converter"),f=require("system/text/parser"),g=require("system/text/formatter"),h=Object.resolve(g),i=require("application/application-context"),j=require("./dtos/column-info-dto");function k(a){}var l=k.prototype;l.getColumnInfos=function(b,c){return a.map(b,function a(b){return new j(b,c)})},l.getRows=function b(c,d,e){return a.map(d,function a(b){for(var d={},f=b.getCells(),g=0;g<e.length;g++)d[e[g].dataField]=m(c,f,f[g],e[g]),f[g].getBackColor()&&(d[e[g].dataField+"_backColor"]=f[g].getBackColor());return d})};function m(a,b,c,d){var f=t(c),g=a.cachedQueryContainer.isFormatted;return d.hyperlinkFormat&&(f="date"===d.dataType?q(c.getDbValue(),d.format):f,f=r(f,c)),"date"===d.dataType&&""!==f&&(g?(a.formColumnArr.push(d.dataField),f=q(c.getDbValue(),d.format)):v(f)||(f=c.getDbValue())),
"boolean"===d.dataType?f=e.toBoolean(f.toString().toLowerCase(),"true"):"number"!==d.dataType||d.hyperlinkFormat||g?f&&"string"==typeof f&&(f=u(f)):f=n(c),f}function n(a){var b=o(a.getValue(),a.getDbValue()),c=a.getDbValue();return c&&b&&b.toString()===c.toString()?parseFloat(b):f.parseFloat(b)}function o(a,b){return p(b)&&!p(a)?b:a}function p(a){return null!==a&&void 0!==a&&""!==a}function q(a,b){if(a){var c=b?h.getFormatByCode(b):i.user.formats.dateTime;return h.format(a,c)}return a}function r(a,b){return s(b.getHyperlinkRoute(),a)}function s(a,c){var e="";return a?(e=b("<a/>").attr("href",d(a)).text(c),b("<div/>").append(e).html()):e}function t(a){return void 0!==a.getValue()&&""!==a.getValue()?a.getValue():void 0!==a.getDbValue()&&null!==a.getDbValue()?a.getDbValue():""}function u(a){return a.replace(/<([a-z]+)([^>]*[^\/])?>(?![\s\S]*<\/\1)/gi,function(a){return b("<div/>").text(a).html()})}function v(a){return a.toString().indexOf("<a")!==-1}function w(a,b){
return a.split("/").map(function(a){if(a.startsWith("{")){var c=a.substr(1,a.length-2);return b[c].getDbValue()}return a}).join("/")}return k});
define('ui/elements/resultgrid/helpers/query-helper',['require','lodash','jquery','ramda','bluebird','./static-helper','system/lang/converter','system/text/parser','system/text/formatter','application/application-context','query/services/dto/query-container-dto','query/services/dto/parameter-container-dto','query/execution/query-execution-engine','../adapters/query-data-adapter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("ramda"),d=require("bluebird"),e=require("./static-helper"),f=require("system/lang/converter"),g=require("system/text/parser"),h=require("system/text/formatter"),i=Object.resolve(h),j=require("application/application-context"),k=require("query/services/dto/query-container-dto"),l=require("query/services/dto/parameter-container-dto"),m=require("query/execution/query-execution-engine"),n=require("../adapters/query-data-adapter"),o={"System.DateTime":"date","System.Double":"number","System.Boolean":"boolean"};function p(){this.queryDataAdapter=Object.resolve(n)}var q=Object.inherit(e,p);p.prototype.handleDatasource=function a(b){var c=this;return{load:r.bind(null,b,c),totalCount:s.bind(null,b),paginate:!0,pageSize:b.pageSize()}};function r(a,c,d){var e=new b.Deferred,f=d.filter?d.filter.join(","):"",g=d.sort?JSON.stringify(d.sort):"",h=d.skip,i=d.take,j,k={filter:f,sort:g,
skip:a.gridInstance?a.gridInstance.pageIndex()*a.pageSize():0,take:a.pageSize(),searchFilter:d.filter},l=!(d.hasOwnProperty("filter")&&void 0===d.filter);return null===a.data()||void 0===a.data()?e.resolve([]):"static"===a.data()?(k.skip=h,k.take=i,c.handleStaticDataLoad(a,k,e)):(a.gridInstance&&a.gridInstance.clearSelection(),a.currentFilter!==k.filter?(a.currentFilter=k.filter,j=b(".dx-datagrid-filter-row .dx-editor-cell").index(b(".dx-editor-cell.dx-focused")),a.filterElIndex=j!==-1?j:a.filterElIndex,x(a,k,l).done(t.bind(null,a,c,k,e,!0)).fail(u.bind(null,a,c,e))):x(a,k,l).done(t.bind(null,a,c,k,e,!1))),e.promise()}function s(a,c){var d=b.Deferred(),e={};return"static"===a.data()&&a.totalCountCallback?Object.tryMethod(a,"totalCountCallback",d,e):d.resolve(),d.promise()}function t(a,b,c,d,e,f){var g;a.rawQueryData=f.result,g=v(a,b,f),a.queryDataColumns=g.columns,Object.tryMethod(a,"queryExecutedCB",f,c),d.resolve(g.dataRows),e&&w(a.filterElIndex)}function u(a,b,c){
var d=v(a,b,a.rawQueryData);c.resolve(d.dataRows),w(a.filterElIndex)}function v(a,b,c){var d=c.result,e=d.getRows(),f=d.getColumns(),g=b.queryDataAdapter.getColumnInfos(f,c.queryContainer.isFormatted);return{dataRows:b.queryDataAdapter.getRows(a,e,g),columns:g}}function w(a){b(b(".dx-datagrid-filter-row .dx-editor-cell")[a]).find("input").focus()}function x(a,c,d){var e=b.Deferred();if("function"!=typeof a.data||null!==a.data()&&void 0!==a.data()){var f={};if(a.aggregateQueryParams?(a.queryParams&&ha(a),f.parameters=a.aggregateQueryParams,f.suppressPrompts=!0):a.queryParams?(f.parameters=a.queryParams,f.suppressPrompts=!0):f.suppressPrompts=a.suppressPrompts(),f.suppressPrompts||b(".dialog-wrapper").find("mi-resultgrid").length||b(".dx-overlay-wrapper").addClass("suppressSpinner"),f.evalOnly=!1,f.pageSize=a.pageSize(),f.startPage=0!==a.pageNumber?a.pageNumber:"0",a.cachedQueryContainer)return f.queryContainer=new k(b.parseJSON(JSON.stringify(a.cachedQueryContainer))),
d?(c.sort&&(f.queryContainer=B(a,f.queryContainer,c.sort)),void 0!==a.prevFilter&&a.prevFilter!==c.filter&&(f.startPage="0",a.pageNumber=0,a.getTotalCount=!0),""!==c.filter&&void 0===a.prevFilter&&(a.getTotalCount=!0),a.prevFilter=c.filter,C(a,f.queryContainer,c.filter,c.searchFilter).done(function(b){f.queryContainer=b,y(a,f,e)})):y(a,f,e),e;if("catalogItemPath"===a.queryExecutionMode())a.catalogService.getCatalogItemKey(a.data()).done(function b(c){f.catalogItemKey=c,y(a,f,e)});else{switch(a.queryExecutionMode()){case"catalogItemKey":f.catalogItemKey=a.data();break;case"queryContainer":f.queryContainer=a.queryContainerObject,f.suppressPrompts=a.suppressPrompts();break;case"sqlStatement":f.sqlStatement=a.data();break;case"catalogItem":f.catalogItem=a.data()}y(a,f,e)}return e}}function y(a,b,c){a.queyExecutionEngine=new m(b),b.sync=!0,a.queyExecutionEngine.execute(b).done(z.bind(null,a,c)).fail(A)}function z(a,b,c){a.cachedQueryContainer=c.queryContainer,
a._totalCount(c.result.getRows().length),a._queryTotalCount=c.result.getRowCount(),c.result.getRows().splice(a.pageSize(),a.pageSize()),b.resolve(c)}function A(){b(".dx-loadindicator").hide()}function B(a,b,c){for(var d=JSON.parse(c),e=b,f=0;f<e.columnDesigns.length;f++)e.columnDesigns[f].resultSortOrder="None",e.columnDesigns[f].resultSortIndex=0;for(var g=0;g<d.length;g++)for(var h=0;e.columnDesigns&&h<e.columnDesigns.length;h++){var i=e.columnDesigns[h].alias||P(e.columnDesigns[h].id);if(d[g].selector===i){e.columnDesigns[h].resultSortOrder=d[g].desc?"Descending":"Ascending",e.columnDesigns[h].resultSortIndex=g+1;break}}return e}function C(a,c,e,f){var g=b.Deferred(),h,i,j,k,l,m,n;if("None"!==a.uomConversionSetId)if(f&&"string"==typeof f[0])j=0,m=(f.columnIndex+1).toString(),n=[f[2].toString()],l=a.queryService.convertSimpleCriteriaText.bind(a.queryService,c,!1,m,j,n),
d.resolve().then(l).then(E(a,c,e,f,h,g));else if(f&&f.length>0)for(h=0;h<f.length;h++)"object"==typeof(i=f[h])&&(j=h,m=(i.columnIndex+1).toString(),n=[i[2].toString()],l=a.queryService.convertSimpleCriteriaText.bind(a.queryService,c,!1,m,j,n),d.resolve().then(l).then(E(a,c,e,f,h,g)));else D(a,c,e,f,g);else D(a,c,e,f,g);return g}function D(a,b,c,d,e){var f=c.split(",and,"),g=b,h,i,j=d?d.join(","):"",k=!1,l=!1,m,n;j.indexOf(",or,")>-1&&(k=!0),(j.indexOf(",and,")>-1||""!==j&&j.indexOf(",or,")===-1)&&(l=!0),k&&l?(m=d[0].join(",").split(",and,"),n=d[2].join(",").split(",or,")):!l&&k?(m=[""],n=d.join(",").split(",or,")):!k&&l&&(n=[""],m=d.join(",").split(",and,")),J(a,g,f);var o="";if(l)for(var p=0;""!==m[0]&&p<m.length;p++)i=0,h={selector:m[p].split(",")[i],query:L(m[p])},h.selector&&(o!==h.selector&&M(a,g,h.selector,F.bind(a,a,g,h)),o=h.selector);if(k)for(var q=0;""!==n[0]&&q<n.length;q++)i=0,h={selector:n[q].split(",")[i],query:L(n[q])},
h.selector&&(o!==h.selector&&M(a,g,h.selector,G.bind(a,a,g,h)),o=h.selector);return e.resolve(g)}var E=c.curry(function a(b,c,d,e,f,g,h){return e&&"string"==typeof e[0]?e[2]=h[0]:e[f][2]=h[0],D(b,c,d,e,g)});function F(a,b,c,d){c.query&&(b.columnDesigns[d].resultFilterExpression=I(a,b.columnDesigns[d],c))}function G(a,b,c,d,e){c.query&&(b.columnDesigns[d].simpleCriteria=H(a,b.columnDesigns[d],c,d))}function H(a,b,c,d){for(var e=[],f=0;f<d;f++)e.push(null);var g=[{conditionOperator:"",dateValue:null,operator:"Contains",value:c.query}];return e.push({expressions:g}),e}function I(a,b,c){var d="",e="LAST_UPDT_DT"===b.id||"CRT_DT"===b.id,f=N(a,b),g=a.cachedQueryContainer.isFormatted;if("date"===f&&!g||e){var h=new Date(c.query),j=new Date(h);j.setHours(0,0,0,0);var k=new Date(h);k.setHours(23,59,59,999)
;var l=a.timezone.removeUtcOffset(j),m=a.timezone.removeUtcOffset(k),n=i.format(l,"yyyy-MM-dd HH:mm:ss"),o=i.format(m,"yyyy-MM-dd HH:mm:ss"),p="(>=(# :dt :utc '"+n+"')",q="<=(# :dt :utc '"+o+"'))";d=p+" And "+q,a.filtersArr.push(p),a.filtersArr.push(q)}else"boolean"===f?(d="true"===c.query?"'Y'":"false"===c.query?"'N'":"",a.filtersArr.push(d)):(d="(Like '%"+c.query+"%')",a.filtersArr.push(d));return d}function J(a,b,c){M(a,b,null,null,K.bind(a,a,b)),a.filtersArr=[]}function K(a,b,c){b.columnDesigns[c].resultFilterExpression=""}function L(a){var b="",c=a.split(",");if(c.length>2&&"contains"===c[1]){var d=a.indexOf(","),e=a.indexOf(",",d+1);b=a.substring(e+1).trim()}else b=void 0===c[2]?c[2]:c[2].trim();return b}function M(a,b,c,d,e){if(!b.columnDesigns)return!1;for(var f=0;f<b.columnDesigns.length;f++){if(d){c===(b.columnDesigns[f].alias||P(b.columnDesigns[f].id))&&d&&d.call(a,f)}e&&e.call(a,f)}}function N(b,c){var d=a.find(b.queryDataColumns,function(a){
return a.columnDesignKey.toString()===c.key.toString()});return d&&d.dataType?d.dataType:c.dataType.toLowerCase()}function O(a){return a.substring(1,a.length-1)}function P(a){return a&&a.indexOf("[")>-1?O(a):a}function Q(a){return a.toString().indexOf("<a")!==-1}function R(a){return a?a.substring(0,a.length):""}p.prototype.customizeColumns=function b(c,d){if("static"===c.data())return this.getStaticColumns(c,d);var e=this,f=c.rawQueryData,g=f.getRows(),h=f.getColumns(),i,k,l,m,n,o,p,q,r,s=c.cachedQueryContainer,t=j.user.formats.shortDate;c.uomConversionSetId=j.user.uomConversionSetId;var u=a.filter(d,function(a){return!a.dataField.match("_backColor")});a.map(a.filter(d,function(a){return a.dataField.match("_backColor")}),function(a){return a.visible=!1,a});for(var v=0;v<u.length;v++)i=h[v],k=u[v],i.setFieldId(P(i.getFieldId())),k.dataField=i.getAlias()||i.getFieldId(),k.caption=X(i),k.visible=i.getIsDisplayed(),k.trueText=c.translator.translate("TRUE"),
k.falseText=c.translator.translate("FALSE"),k.filterRow={showAllText:c.translator.translate("RG_ALL")},k.encodeHtml=!0,l=V(this,c,v),l||(k.encodeHtml=l),m=aa(i.getTypeName(),s.isFormatted),m&&(k.dataType=m),o=ba(this,k.dataType),o&&(k.format={formatter:o}),"number"===k.dataType?k.customizeText=T.bind(null,this,c,s,i):"number"===na(i)?k.customizeText=U.bind(c,s.isUomVisible,i.getDisplayUomCaption()):"date"===k.dataType&&(k.customizeText=S.bind(null,i.getFormat())),n=W(this,c,v),n&&(k.cellTemplate=n),_(s,k),p=Y(this,c,v),p||(k.visible=p),q=Z(this,c,v),q&&(k.fixed=q),(r=$(this,c,v))&&(k.width=r)};function S(a,b){if(b.value){var c=a?i.getFormatByCode(a):j.user.formats.dateTime;return i.format(b.value,c)}return b.value}function T(a,b,c,d,e){var f=a.formatNumberValue(e);return f=U(c.isUomVisible,d.getDisplayUomCaption(),{value:f})}function U(a,b,c){var d=c.value;return a&&b&&d&&(d+="("+b+")"),d}function V(a,b,c){
return b.queryDataColumns[c].encodeHtml&&"true"===b.queryDataColumns[c].encodeHtml.toString()}function W(a,b,c){var d;return b.queryDataColumns[c].hasCellTemplate&&"true"===b.queryDataColumns[c].hasCellTemplate.toString()&&(d=a.handleCustomCellTemplate.bind(null,b)),d}function X(a){var b="";return b=void 0!==a.getLocalizedAlias()&&""!==a.getLocalizedAlias()?a.getLocalizedAlias():void 0!==a.getAlias()&&""!==a.getAlias()&&a.getAlias()!==a.getFieldId()?a.getAlias():void 0!==a.getCaption()&&""!==a.getCaption()&&a.getCaption()!==a.getFieldId()?a.getCaption():a.getFieldId()}function Y(a,b,c){return b.queryDataColumns[c].visible}function Z(a,b,c){return b.queryDataColumns[c].fixed}function $(a,b,c){return b.queryDataColumns[c].width}function _(a,b){if(null!==a.columnDesigns&&void 0!==a.columnDesigns)for(var c=0;c<a.columnDesigns.length;c++){var d=a.columnDesigns[c],e=d.alias||P(d.id),f=d.defaultCaption&&P(d.caption)!==P(d.defaultCaption)&&b.caption===P(d.caption)
;(b.caption===e||f||b.dataField===e)&&(d.defaultCaption&&P(d.caption)===P(d.defaultCaption)&&(b.caption=b.caption||da(d,e)),b.dataType=d.hyperlink?"string":b.dataType),b=ca(d,b)}return b}function aa(a,b){var c;switch(a){case"System.DateTime":b||(c="date");break;case"System.Boolean":c="boolean";break;case"System.Double":b||(c="number")}return c}function ba(a,b){var c;return"date"===b&&(c=a.formatDateValue),c}function ca(a,b){var c=a.expressionText,d=c&&c.match(/^'.*'$/);return"Unknown"===a.dataType&&d&&(b.allowSorting=!1,b.cssClass="disable-cursor"),b}function da(a,b){return""===a.alias&&a.caption&&(a.caption=P(a.caption),b=a.caption),b}p.prototype.handleCellPreparedForQueryResult=function c(d,e,f){if("data"===f.rowType){var g=f,h=f.cellElement,i=g.value,j=i,k=a.find(d.queryDataColumns,function(a){var b=g.column;return void 0!==b&&void 0!==b.dataField&&(b.dataField=b.dataField.replace(/\./g,"__")),a.dataField===b.dataField});if(!k||!k.hasCellTemplate){
i&&"boolean"!=typeof i&&Q(i)&&g.column.encodeHtml&&k&&k.hyperlinkFormat&&(j=j.replace(/(<a [^>]+>)([^<]+)(<\/a>)/,function(){var a=arguments[2],b="number"===k.dataType?e.formatNumberValue({value:arguments[2]}):a;return arguments[1]+b+arguments[3]}),h.empty().append(j));var l=f.data[f.column.dataField+"_backColor"];l&&b(h).css("background-color",l);var m=b(h).find("a");m.length&&ea(i)&&d._openHyperLinkInNewTab!==!1&&m.attr("target","tab")}}};function ea(a){return/<[a-z\][\s\S]*>/i.test(a)}p.prototype.handleContentReadyAction=function a(c){var d=b(c.element).find(".gridContainer").dxDataGrid("instance");b(c.element).find(".rg-controls").show(),b(c.element).find(".rg-header").show();var e=d.totalCount()>0?d.totalCount():0;if(fa(c,d),c.gridInstance=d,Object.tryMethod(c,"gridLoadedCallback",d),
"standard"===c.scrollType()?c.getTotalCount&&this.getMenuPaging(c):"standard"!==c.scrollType()||"static"!==c.data()||c.currentFilter||b(c.element).find(".dxDataGridTotalCount").html(e+" "+c.translator.translate("RG_TOTAL_COUNT_MESSAGE")),b(c.element).find(".dx-datagrid-pager.dx-pager").hide(),b(c.element).find(".dx-datagrid-pager.dx-pager").append(b(c.element).find(".dxDataGridTotalCount")),c.showGridBorder){b(c.element).find("#gridContainer").addClass("grid-border");var f=b(c.element).find("#gridContainer").height();b(c.element).find(".grid-border").height(f)}this.configurePrint(c,e)};function fa(a,c){var d=a.showPaging?"calc(100% - 46px)":"calc(100% - 25px)",e=b(a.element).find(".gridContainer");c.totalCount()<=a.pageSize()&&e.css({height:d}),a.isFirstLoad&&(a.isFirstLoad=!1,c.totalCount()<=1&&(b(a.element).find(".rg-filter").attr("disabled",!0),c.option({sorting:{mode:"none"}})))}p.prototype.handleSelectionChanged=function a(b,c){var d
;"single"===b.selectionMode()?(d=c.selectedRowsData[0],Object.tryMethod(b,"callback",d)):(d=c.selectedRowsData,Object.tryMethod(b,"multiSelectCallback",d))},p.prototype.handleEditorPreparedForQuery=function b(c){var d=this;if("filterRow"===c.parentType&&"number"===c.dataType)c.editorElement.empty().dxTextBox({value:d.formatNumberValue(c),valueChangeEvent:"keyup",onValueChanged:a.debounce(function(a){var b=a.value?g.parseFloat(a.value):a.value;c.setValue(b),ga(d,c,b)},500)});else if("dataRow"===c.parentType&&"number"===c.dataType)var e=c.editorElement.dxNumberBox({value:d.formatNumberValue(c),onValueChanged:function(a){c.setValue(g.parseFloat(a.value))}})};function ga(a,b,c){var d=b.editorElement.dxTextBox("instance"),e=d.element().find("input"),f=a.formatNumberValue({value:c});e.val(f)}p.prototype.pageFilterHandler=function a(c,d){if(d&&d.parmDesigns&&d.parmDesigns.length&&(c.aggregateQueryParams=new l(b.parseJSON(JSON.stringify(d))),c.queryParams&&c.queryParams.parmDesigns)){
for(var e=0;e<c.queryParams.parmDesigns.length;e++)for(var f=0;f<d.parmDesigns.length;f++)if(c.queryParams.parmDesigns[e].id===d.parmDesigns[f].id){c.queryParams.parmDesigns.splice(e);break}for(var g=0;g<c.queryParams.parmDesigns.length;g++)c.aggregateQueryParams.parmDesigns.push(c.queryParams.parmDesigns[g])}c.data()&&c.refresh(c.data())};function ha(a){for(var b=[],c=a.aggregateQueryParams.parmDesigns.length,d=0;d<c;d++)b.push(a.aggregateQueryParams.parmDesigns[d].id);for(var e=a.queryParams.parmDesigns.length,f=0;f<e;f++)if(b.indexOf(a.queryParams.parmDesigns[f].id)>-1)for(var g=0;g<c;g++)a.aggregateQueryParams.parmDesigns[g].id===a.queryParams.parmDesigns[f].id&&(a.aggregateQueryParams.parmDesigns[g]=a.queryParams.parmDesigns[f]);else a.aggregateQueryParams.parmDesigns.push(a.queryParams.parmDesigns[f])}function ia(b,c,d){for(var e=a.map(b,d),f=b.length,g=c.length,h=0;h<g;h++)if(e.indexOf(c[h][d]>-1))for(var i=0;i<f;i++)b[i][d]===c[h][d]&&(b[i]=c[h]);else b.push(c[h]);return c}
function ja(a,c){if(a.length&&c){var d=c.split(" And "),e=d[d.length-1].toString().trim();return b.inArray(e,a)!==-1?ka(e)?la(c,2).trim():c.substring(0,c.lastIndexOf(" And ")).trim():c}return c}function ka(a){var b=a.replace("(>=(# :dt :utc ","").replace(" 00:00:00","").replace(/\)/g,"").replace(" 23:59:59","").replace("<=(# :dt :utc ","").replace(/'/g,"");return"Invalid Date"!==new Date(b).toString()}function la(a,b){for(var c=a,d=0;d<b;d++)c=c.substring(0,c.lastIndexOf(a));return c}function ma(a,b,c){for(var d=0;d<b.rows.length;d++)for(var e=0;e<c.length;e++)b.rows[d].displayInfos&&b.rows[d].displayInfos[e]&&b.rows[d].displayInfos[e].backColor&&(a.queryHasBackgroundColor(!0),c[e].cssClass=b.rows[d].displayInfos[e].backColor),b.rows[d].displayInfos&&b.rows[d].displayInfos[e]&&b.rows[d].displayInfos[e].format&&(c[e].format={formatter:a.formatDateValue.bind(null,b.rows[d].displayInfos[e].format)})}function na(a){return"Boolean"===a.getFieldDataType()?"boolean":o[a.getTypeName()]}
return p});
define('ui/elements/resultgrid/config/query-config',['require','lodash','jquery','./default-config','../helpers/query-helper'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./default-config"),d=Object.resolve(require("../helpers/query-helper"));function e(a){var e={dataSource:d.handleDatasource(a),customizeColumns:d.customizeColumns.bind(d,a),paging:f(a),onCellPrepared:d.handleCellPreparedForQueryResult.bind(null,a,d),onContentReady:d.handleContentReadyAction.bind(d,a),onSelectionChanged:d.handleSelectionChanged.bind(null,a),onRowPrepared:d.handleRowPrepared.bind(null,a),onEditorPrepared:d.handleEditorPreparedForQuery.bind(d),remoteOperations:{paging:!0,sorting:!0,filtering:!0},pager:{visible:!1}};return b.extend(e,c(a)),e}function f(a){return{enabled:!0,pageSize:a.pageSize()}}return e});
define('ui/elements/resultgrid/config/attr-config',['require','lodash','jquery','knockout','system/lang/converter','system/text/parser','system/text/formatter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("system/lang/converter"),e=require("system/text/parser"),f=require("system/text/formatter"),g=Object.resolve(f);function h(a){this.vm=a,a.data=c.observable(),a.allowColumnResizing=c.observable(!0),a.allowColumnReordering=c.observable(!0),a.hasColumnChooser=c.observable(!0),a.selectionMode=c.observable("multiple"),a.showRowFilter=c.observable(!1),a.hideEditControls=c.observable(!1),a.showGroupingPanel=c.observable(!0),a.allowRowEditing=c.observable(!1),a.allowRowAdding=c.observable(!1),a.allowRowDeleting=c.observable(!1),a.editMode=c.observable("batch"),a.sortingMode=c.observable("single"),a.pageSize=c.observable(100),a.scrollType=c.observable("standard"),a.queryExecutionMode=c.observable("sqlStatement"),a.suppressPrompts=c.observable(!1),a.columnAutoWidth=c.observable(!0),a.wordWrapEnabled=c.observable(!1),a.showFooter=!0,a.showPaging=!0,a.showPrint=c.observable(!1),
a.loaderPanelEnabled=c.observable(!0)}function i(b,c,e,f){var g=b.getAttribute(c),h;a.isNull(g)||(h=f?d.toBoolean(g,"true"):g,a.isFunction(e)?e(h):e=h)}return h.prototype.addAttributes=function a(b){i(b,"data",b.data),i(b,"allowcolumnresizing",b.allowColumnResizing,!0),i(b,"allowcolumnreordering",b.allowColumnReordering,!0),i(b,"hascolumnchooser",b.hasColumnChooser,!0),i(b,"selectionmode",b.selectionMode),i(b,"showrowfilter",b.showRowFilter,!0),i(b,"hideeditcontrols",b.hideEditControls,!0),i(b,"showgroupingpanel",b.showGroupingPanel,!0),i(b,"allowrowediting",b.allowRowEditing,!0),i(b,"allowrowadding",b.allowRowAdding,!0),i(b,"allowrowdeleting",b.allowRowDeleting,!0),i(b,"editmode",b.editMode),i(b,"sortingmode",b.sortingMode),i(b,"pagesize",b.pageSize),i(b,"scrolltype",b.scrollType),i(b,"queryexecutionmode",b.queryExecutionMode),i(b,"suppressprompts",b.suppressPrompts,!0),i(b,"columnautowidth",b.columnAutoWidth,!0),i(b,"wordwrapenabled",b.wordWrapEnabled,!0),
i(b,"showfooter",b.showFooter,!0),i(b,"showpaging",b.showPaging,!0),i(b,"showprint",b.showPrint,!0),i(b,"loaderpanelenabled",b.loaderPanelEnabled,!0)},h.prototype.handleAttributeChange=function a(b,c,e){var f=this.vm;switch(b){case"data":f.data(e),f._refreshList(f);break;case"allowcolumnresizing":f.allowColumnResizing(d.toBoolean(e,"true"));break;case"allowcolumnreordering":f.allowColumnReordering(d.toBoolean(e,"true"));break;case"hascolumnchooser":f.hasColumnChooser(d.toBoolean(e,"true"));break;case"selectionmode":f.selectionMode(e);break;case"showgroupingpanel":f.showGroupingPanel(d.toBoolean(e,"true"));break;case"allowrowediting":f.allowRowEditing(d.toBoolean(e,"true"));break;case"allowrowadding":f.allowRowAdding(d.toBoolean(e,"true"));break;case"allowrowdeleting":f.allowRowDeleting(d.toBoolean(e,"true"));break;case"editmode":f.editMode(d.toString(e));break;case"sortingmode":f.sortingMode(e);break;case"showrowfilter":f.showRowFilter(d.toBoolean(e,"true"));break
;case"hideeditcontrols":f.hideEditControls(d.toBoolean(e,"true"));break;case"pagesize":f.pageSize(d.toInteger(e,"true"));break;case"scrolltype":f.scrollType(e);break;case"queryexecutionmode":f.queryExecutionMode(e);break;case"suppressprompts":f.suppressPrompts(d.toBoolean(e,"true"));break;case"columnautowidth":f.columnAutoWidth(d.toBoolean(e,"true"));break;case"wordwrapenabled":f.wordWrapEnabled(d.toBoolean(e,"true"));break;case"showfooter":f.showFooter=d.toBoolean(e,"true");break;case"showpaging":f.showpaging=d.toBoolean(e,"true");break;case"showprint":f.showPrint(d.toBoolean(e,"true"));break;case"loaderpanelenabled":f.loaderPanelEnabled(d.toBoolean(e,"true"))}},h});
define('ui/elements/resultgrid/config/prop-config',['require','lodash','jquery','system/lang/converter','system/text/parser','system/text/formatter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/lang/converter"),d=require("system/text/parser"),e=require("system/text/formatter"),f=Object.resolve(e);function g(){}function h(a){return a._loadConfigurableButtons}function i(a,b){a._loadConfigurableButtons=b,a.toolbarHelper.renderToolbars(a)}function j(a){return a._loadJSONData}function k(a,b){a._loadJSONData=b,a.reload()}function l(a){return a._showGridBorder}function m(a,b){a._showGridBorder=b}return g.prototype.addProperties=function a(b){b._loadJSONData=null,Element.defineProperty(b,"loadJSONData",{get:j.bind(null,b),set:k.bind(null,b)}),b._queryParams=null,Element.defineProperty(b,"queryParams",{get:function(){return b._queryParams}.bind(b),set:function(a){b._queryParams=a}.bind(b)}),b._aggregateQueryParams=null,Element.defineProperty(b,"aggregateQueryParams",{get:function(){return b._aggregateQueryParams}.bind(b),set:function(a){b._aggregateQueryParams=a}.bind(b)}),
b._queryContainerObject=null,Element.defineProperty(b,"queryContainerObject",{get:function(){return b._queryContainerObject}.bind(b),set:function(a){b._queryContainerObject=a}.bind(b)}),Element.defineProperty(b.element,"onRowSelectCB",{get:function(){return b.callback}.bind(b),set:function(a){b.callback=a}.bind(b)}),Element.defineProperty(b.element,"onPageChangeCB",{get:function(){return b.pageChangeCallback}.bind(b),set:function(a){b.pageChangeCallback=a}.bind(b)}),Element.defineProperty(b.element,"onRowMultiSelectCB",{get:function(){return b.multiSelectCallback}.bind(b),set:function(a){b.multiSelectCallback=a}.bind(b)}),Element.defineProperty(b.element,"onCellHyperlinkClickCB",{get:function(){return b.cellHyperlinkCallback}.bind(b),set:function(a){b.cellHyperlinkCallback=a}.bind(b)}),Element.defineProperty(b.element,"onRowPreparedCB",{get:function(){return b.rowPreparedCallback}.bind(b),set:function(a){b.rowPreparedCallback=a}.bind(b)}),
Element.defineProperty(b.element,"cellTemplateCB",{get:function(){return b.celltTemplateCallback}.bind(b),set:function(a){b.cellTemplateCallback=a}.bind(b)}),Element.defineProperty(b.element,"cellPreparedCB",{get:function(){return b.cellPreparedCallback}.bind(b),set:function(a){b.cellPreparedCallback=a}.bind(b)}),Element.defineProperty(b.element,"onInitNewRowCB",{get:function(){return b.onInitNewRowCallback}.bind(b),set:function(a){b.onInitNewRowCallback=a}.bind(b)}),Element.defineProperty(b.element,"headerCellTemplateCB",{get:function(){return b.headerCellTemplateCallback}.bind(b),set:function(a){b.headerCellTemplateCallback=a}.bind(b)}),Element.defineProperty(b.element,"gridLoadedCB",{get:function(){return b.gridLoadedCallback}.bind(b),set:function(a){b.gridLoadedCallback=a}.bind(b)}),Element.defineProperty(b.element,"totalCountCB",{get:function(){return b.totalCountCallback}.bind(b),set:function(a){b.totalCountCallback=a}.bind(b)}),
Element.defineProperty(b.element,"queryExecutedCB",{get:function(){return b.queryExecutedCallback}.bind(b),set:function(a){b.queryExecutedCallback=a}.bind(b)}),Element.defineProperty(b.element,"totalCount",{get:function(){return b._totalCount()}.bind(b),set:function(a){b._totalCount(a)}.bind(b)}),b._loadConfigurableButtons=null,Element.defineProperty(b,"loadConfigurableButtons",{get:h.bind(null,b),set:i.bind(null,b)}),b._toolbarItemClickCallback=null,Element.defineProperty(b,"toolbarItemClickCallback",{get:function(a){return a._toolbarItemClickCallback}.bind(null,b),set:function(a,b){a._toolbarItemClickCallback=b}.bind(null,b)}),b._openHyperLinkInNewTab=!0,Element.defineProperty(b,"openHyperLinkInNewTab",{get:function(){return b._openHyperLinkInNewTab}.bind(b),set:function(a){b._openHyperLinkInNewTab=a}.bind(b)}),b._showGridBorder=!1,Element.defineProperty(b,"showGridBorder",{get:l.bind(null,b),set:m.bind(null,b)})},g});
define('ui/elements/resultgrid/helpers/print-helper',['require','lodash','jquery'],function(require){"use strict";var a=require("lodash"),b=require("jquery");function c(){}c.prototype.createCutomTable=function a(c){var e=c.vm,f="",g="",h="",i="",j="",k="",l=b(e).find(".dx-datagrid-text-content"),m=l.length;l.each(function(a){a!==m-1&&(h+="<th class='rg-print-header' style='"+b(this).closest("td").attr("style")+"'>"+b(this).text()+"</th>")}),f="<thead>"+h+"</thead>",b(e).find(".dx-datagrid-table").find(".dx-data-row").each(function(){j="",b(this).find(" > td:not(.dx-command-select)").each(function(){k=0===b(this).find("a").length?b(this).html():b(this).text(),j+="<td class='rg-print-col' style='"+b(this).attr("style")+"'>"+k+"</td>"}),i+="<tr>"+j+"</tr>"}),g="<tbody>"+i+"</tbody>",d(e,"<div class='rg-print-container'><table class='rg-print-table'>"+f+g+"</table>")};function d(c,d){var e=a.map(b("head > link"),function(a){return a.outerHTML}),f={htmlString:d,cssLinks:e};c.exportService.exportPage(f,"pdf","GridData")}function e(a){
var b=window.open("","","width=400,height=400"),c=b.document;c.open(),c.write(a+'<link type="text/css" rel="Stylesheet" href="styles/default.css" />'),c.close()}return c});
define('ui/elements/more-options-item/view-model',['jquery','system/lang/converter'],function(){"use strict";var a=require("jquery"),b=require("system/lang/converter"),c=Object.create(HTMLElement.prototype);c.createdCallback=function(){var b,c,e;this.$el=a(this),this.className="moreoptions-item",this.display="block",e=document.createElement("span"),e.className="icon",c=document.createElement("span"),c.className="text",this.appendChild(e),this.appendChild(c),d(this)},c.attachedCallback=function(){},c.attributeChangedCallback=function(a,b,c){};function d(a){a._value=null,Element.defineProperty(a,"value",{get:function(){return this._value}.bind(a),set:function(a){this._value=a,e(this,a)}.bind(a)})}function e(a,b){var c;a.value&&(a.querySelector(".text").textContent=b.text,a.querySelector(".icon").className=b.icon)}return document.registerElement("mi-more-options-item",{prototype:c}),c});
define('ui/elements/more-options/more-options',['require','lodash','jquery','system/lang/converter','system/globalization/translator','../more-options-item/view-model'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/lang/converter"),d=require("system/globalization/translator");require("../more-options-item/view-model");var e=Object.create(HTMLElement.prototype);e.createdCallback=function(){var c,d;c=this,c.internalIcon=null,c._disabled=b(c).is("[disabled]"),c._noaccess=null,c._text=null,this.isOpen=!1,this._options=[],o(this),b(this).empty(),d=i(this),this.appendChild(d),this.resizeProxy=b.proxy(a.debounce(this.resize,100),this),this.scrollProxy=b.proxy(this.scroll,this),this.ctrlOffset=null,this.ctrlWidth=null,this.optionsWidth=null,this.optionsHeight=null,this.optionsTop=null,this.optionsLeft=null,this.outerContainer=null,this.docClickHandler=h.bind(null,this),Element.defineProperty(c,"moreoptionsCB",{get:g.bind(null,c),set:c.handlemoreoptionsCB.bind(c)}),Element.defineProperty(c,"options",{get:function(){return c._options}.bind(c),set:function(a){f(c,a)}.bind(c)}),
Element.defineProperty(c,"icon",{get:function(){return c.internalIcon}.bind(c),set:function(a){j(c,a)}.bind(c)}),Element.defineProperty(c,"text",{get:function(){return c._text}.bind(c),set:function(a){k(c,a)}.bind(c)}),Element.defineProperty(c,"disabled",{get:function(){return c._disabled}.bind(c),set:function(a){l(c,a)}.bind(c)}),Element.defineProperty(c,"noaccess",{get:function(){return c._noaccess}.bind(c),set:function(a){m(c,a)}.bind(c)}),Element.defineProperty(c,"tooltip",{get:function(){}.bind(c),set:function(a){n.call(null,c,a)}.bind(c)}),c.internalIcon||j(c,null)},e.attachedCallback=function(){u(this).addEventListener("mousedown",this),b(document).on("mousedown.mi_opt",this.docClickHandler)},e.attributeChangedCallback=function(a,b,d){var e=this;if("disabled"===a){l(e,c.toBoolean(d,"true"))}else if("noaccess"===a){var f=c.toBoolean(d,"true");m(e,f)}else"icon"===a?j(e,d):"text"===a&&k(e,d)},e.handlemoreoptionsCB=function(a,b){this.callback=a};function f(a,b){a._options=b}
e.detachedCallback=function(){var a=u(this);a&&a.removeEventListener("mousedown",this),b(document).off("mousedown.mi_opt",this.docClickHandler),b(this.contentContainer).remove(),this.isOpen=!1},e.handleEvent=function(a){"mousedown"===a.type&&(a.stopPropagation(),this.loader&&this.reload())},e.optionClicked=function(a,b){b.stopPropagation(),a.disabled!==!0&&a.noaccess!==!0&&(s(this),Object.tryMethod(this,"callback",a))},e.reload=function(){this.load().done()},e.load=function(){var a;return this.disabled?b.Deferred().done().promise():this.loader?this.isOpen?(b(window).off("resize",this.resizeProxy),b(this).parents().off("scroll",this.scrollProxy),a=this.loader(),a.done(s.bind(null,this)),a.promise()):(b(window).on("resize",this.resizeProxy.bind(null,this)),b(this).parents().on("scroll",this.scrollProxy.bind(null,this)),a=this.loader(),a.done(r.bind(null,this)),a.promise()):b.Deferred().done().promise()},e.resize=function(a){b(a).find(".mi-more-options-icon").is(":visible")?v(this):s(a)},
e.deallocateMem=function(){var a=this;a.internalIcon=null,a.isOpen=null,a.ctrlOffset=null,a.ctrlWidth=null,a.optionsWidth=null,a.optionsHeight=null,a.optionsTop=null,a.optionsLeft=null,a.outerContainer=null,a.disabled=null,a.options=null,a.contentContainer&&(a.contentContainer=null),a.isClicked&&(a.isClicked=null),a.callback=null,a.loader=null,a.scrollProxy=null,a.resizeProxy=null,a.icon=null,a.tooltip=null},e.scroll=function(a){s(a),a.isOpen=!1};function g(a){return a.handlemoreoptionsCB}function h(a,c){a.isClicked?a.isClicked=!1:a.isOpen&&(b(c.target).hasClass("more-options-content")||(b(".more-options-outer-container").remove(),a.isOpen=!1))}function i(a){var b,c,d,e;return b=document.createElement("button"),b.className="mi-more-options-icon btn btn-icon",c=document.createElement("i"),b.appendChild(c),b}function j(a,c){a.internalIcon=c?c.trim():"icon-options",b(a).find("button i").removeAttr("class").addClass(a.internalIcon)}function k(a,c){c&&(a._text=c.trim(),
b(a).find("button").text(a._text),b(a).find("button").attr("title",a._text),b(a).find("button").append('<i class="icon-tree-collapse"></i>'),b(a).find("button").removeClass("btn-icon").addClass("btn-text"))}function l(a,c){void 0!==c&&(a._disabled=c),a._disabled?b(a).find("button").addClass("disabled"):b(a).find("button").removeClass("disabled")}function m(a,c){a._noaccess=c,c?b(a).find("button").addClass("no-access"):b(a).find("button").removeClass("no-access")}function n(a,c){c&&b(a).find("button").attr("title",c)}function o(a){a._loader=null,Element.defineProperty(a,"loader",{get:p.bind(null,a),set:q.bind(null,a)})}function p(a){return a._loader}function q(a,b){a._loader=b}function r(a,c){var d,e,f,g,h,i,j,k=u(a),l=0;if(a._options=c,!c.length)return void(a.isOpen=!1);if(a.isOpen=!a.isOpen,a.isClicked=!0,b(document).trigger("mousedown.mi_opt"),f=document.createElement("div"),b(f).addClass("more-options-outer-container"),a.contentContainer=b(f),g=document.createElement("ul"),
b(g).addClass("more-options-content"),k){for(d=0;d<c.length;d++)e=document.createElement("mi-more-options-item"),h=document.createElement("li"),c[d].disabled&&b(h).addClass("disabled"),c[d].noaccess?l++:(h.addEventListener("mousedown",function(a){a.stopPropagation()}.bind(a),!1),h.addEventListener("click",function(c){if("click"===c.type){var d=b(c.currentTarget).find("mi-more-options-item")[0].value;a.optionClicked(d,c)}}.bind(a),!1),t(a,e,d,c.length),h.appendChild(e),g.appendChild(h),e.value=c[d]);0!==c.length&&c.length===l&&(e=document.createElement("mi-more-options-item"),h=document.createElement("li"),b(h).addClass("no-access"),h.appendChild(e),g.appendChild(h))}f.appendChild(g),document.body.appendChild(f),v(a)}function s(a){a.isOpen=!a.isOpen,b(a.contentContainer).remove()}function t(a,b,c,d){var e,f;b.setAttribute("index",c)}function u(a){var b=a.querySelectorAll(".mi-more-options-icon");return 0===b.length?null:b[b.length-1]}function v(a){var c=50,d,e;w(a),x(a),
a.ctrlOffset&&a.ctrlOffset.top+a.optionsHeight+c>=b(window).height()?(y(a),b(a.outerContainer).find(".more-options-content").css({"box-shadow":"0px 0px 12px 6px rgba(0, 0, 0, 0.175)","-webkit-box-shadow":"0px 0px 12px 6px rgba(0, 0, 0, 0.175)"})):z(a),a.height&&b(a.outerContainer).find(".more-options-content").css({maxHeight:a.height})}function w(a){a.outerContainer=b(a.contentContainer),a.ctrlOffset=b(a).find(".mi-more-options-icon").offset(),a.ctrlWidth=b(a).find(".mi-more-options-icon").width(),b(a.outerContainer).css({position:"absolute"}),a.optionsWidth=b(a.outerContainer).width(),a.optionsHeight=b(a.outerContainer).height()}function x(a){b(a.outerContainer).find(".more-options-content").removeClass("top-left top-right bottom-left bottom-right")}function y(a){var b;a.ctrlOffset&&(b=a.ctrlOffset.top-a.optionsHeight-10,a.ctrlOffset&&a.ctrlOffset.left+a.ctrlWidth-a.optionsWidth<80?A(a,"top-left",b):B(a,"top-right",b))}function z(a){var b;a.ctrlOffset&&(b=a.ctrlOffset.top+50-6,
a.ctrlOffset&&a.ctrlOffset.left+a.ctrlWidth-a.optionsWidth<80?A(a,"bottom-left",b):B(a,"bottom-right",b))}function A(a,b,c){var d;d=a.ctrlOffset.left,C(a,b),D(a,d,c)}function B(a,b,c){var d;d=a.ctrlOffset.left-Math.abs(a.ctrlWidth-a.optionsWidth),d=a.text?d+37:d,C(a,b),D(a,d,c)}function C(a,c){var d;d=b(a.outerContainer).find(".more-options-content"),b(d).addClass(c)}function D(a,c,d){b(a.outerContainer).css({left:c,top:d})}return document.registerElement("mi-more-options-noko",{prototype:e}),e});
define('ui/elements/resultgrid/helpers/toolbar-helper',['require','lodash','jquery','./utils','system/lang/converter','system/text/parser','system/text/formatter','./print-helper','ui/elements/more-options/more-options'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./utils"),d=require("system/lang/converter"),e=require("system/text/parser"),f=require("system/text/formatter"),g=Object.resolve(f),h=Object.resolve(require("./print-helper"));require("ui/elements/more-options/more-options");function i(){this.rightToolbar=null,this.leftToolbar=null,this.vm=null,this.buttons=[]}var j=Object.inherit(c,i);i.prototype.init=function a(b,c){this.vm=b;var d,e,f;f=document.createElement("div"),d=document.createElement("mi-tool-bar"),d.className="rg-left-tool-bar pull-left",f.appendChild(d),e=document.createElement("mi-tool-bar"),e.className="rg-right-tool-bar pull-right",d.insertBefore(k(this,"showFilter",b.translator.translate("RG_SEARCH_CAPTION"),"icon-search","rg-filter"),d.firstChild),d.appendChild(n(this,b.translator.translate("PRINT"))),f.appendChild(e),c.insertBefore(f,c.firstChild),this.leftToolbar=d,this.rightToolbar=e,this.attachEventHandlers(),this.hide()},
i.prototype.handleVisibility=function a(){var c=this.vm;if(!c)return!1;c.showRowFilter()?this.show():2===b(this.leftToolbar).find("button").length&&b(this.leftToolbar).hide()},i.prototype.hide=function a(){b(this.leftToolbar).hide(),b(this.rightToolbar).hide()},i.prototype.show=function a(){b(this.leftToolbar).show(),b(this.rightToolbar).show()},i.prototype.attachEventHandlers=function a(){this.leftToolbar.addEventListener("click",this),this.rightToolbar.addEventListener("click",this)},i.prototype.handleEvent=function a(b){var c=this.vm,d;"click"===b.type&&("BUTTON"!==b.target.nodeName||b.target.disabled?"I"!==b.target.nodeName||"BUTTON"!==b.target.parentNode.nodeName||b.target.parentNode.disabled||(d=b.target.parentNode.getAttribute("data-action"),Object.tryMethod(c,"toolbarItemClickCallback",d,b)):(d=b.target.getAttribute("data-action"),Object.tryMethod(c,"toolbarItemClickCallback",d,b)))},i.prototype.disableButton=function a(b,c,d){var e,f=b.buttons
;if(f)for(e=0;e<f.length;e++)q(f[e],c)&&(f[e].disabled=d)},i.prototype.setNoAccess=function a(b,c,d){var e,f=b.buttons;if(f)for(e=0;e<f.length;e++)q(f[e],c)&&(f[e].tagName&&"mi-more-options-noko"===f[e].tagName.toLowerCase()?f[e].setAttribute("noaccess",d):d?f[e].className+=" no-access":f[e].className=f[e].className.replace(/ no-access/g,""))},i.prototype.showButton=function a(b,c,d){var e,f=b.buttons,g;if(f)for(e=0;e<f.length;e++)r(f[e])&&!q(f[e],c)?(g=s(f[e].items,c),t(g,d)):q(f[e],c)&&u(f[e],d)},i.prototype.renderToolbars=function a(b){var c,d,e,f;if(c=b.querySelector(".rg-left-tool-bar"),d=b.querySelector(".rg-right-tool-bar"),b._loadConfigurableButtons&&c&&d){for(e=0;e<b._loadConfigurableButtons().length;e++)f=b._loadConfigurableButtons()[e],
"left"===f.align?"more-options"===f.type?f.iconClass?c.insertBefore(m(this,"icon",f.iconClass,f),c.firstChild):c.insertBefore(m(this,"text",f.text,f),c.firstChild):f.text?c.insertBefore(l(this,f.action,f.title,f.text,f.btnClass),c.firstChild):c.insertBefore(k(this,f.action,f.title,f.iconClass,f.btnClass),c.firstChild):"right"===f.align&&("more-options"===f.type?f.iconClass?d.insertBefore(m(this,"icon",f.iconClass,f),d.firstChild):d.insertBefore(m(this,"text",f.text,f),d.firstChild):f.text?d.insertBefore(l(this,f.action,f.title,f.text,f.btnClass),d.firstChild):d.insertBefore(k(this,f.action,f.title,f.iconClass,f.btnClass),d.firstChild));this.show()}};function k(a,b,c,d,e){var f=document.createElement("button"),g="",h=document.createElement("i");return h.className=d,e&&(g=e),f.className="btn btn-icon "+g,f.title=c,f.setAttribute("data-action",b),f.appendChild(h),a.buttons||(a.buttons=[]),a.buttons.push(f),f}function l(a,b,c,d,e){var f=document.createElement("button"),g=""
;return f.innerHTML=d,e&&(g=e),f.className="btn btn-text "+g,f.title=c||d,f.setAttribute("data-action",b),a.buttons||(a.buttons=[]),a.buttons.push(f),f}function m(a,c,d,e){var f=document.createElement("mi-more-options-noko"),g="";return"icon"===c?f.setAttribute("icon",d):f.setAttribute("text",d),e.btnClass&&(g=e.btnClass),e.height&&b(f).prop("height",e.height),b(f).attr("class",g),window.CustomElements&&!window.CustomElements.useNative&&window.CustomElements.upgrade(f),f.items=e.options,f.loader=o.bind(null,f,e.options),f.moreoptionsCB(p.bind(null,a.vm)),a.buttons||(a.buttons=[]),a.buttons.push(f),f}function n(a,b){var c=document.createElement("button"),d=document.createElement("i");return d.className="icon-printer",c.className="btn btn-icon rg-print",c.title=b,c.style.display="none",c.onclick=function(){h.createCutomTable(a)},c.appendChild(d),a.buttons||(a.buttons=[]),a.buttons.push(c),c}function o(a,c){var d,e=[],f,g=b.Deferred(),h;for(d=0;d<c.length;d++)f={type:"text",
text:c[d].text,icon:c[d].iconClass,action:c[d].action,btnClass:c[d].btnClass},c[d].disabled&&(f.disabled="function"==typeof c[d].disabled?c[d].disabled():c[d].disabled),c[d].noaccess&&(f.noaccess="function"==typeof c[d].noaccess?c[d].noaccess():c[d].noaccess),(h=s(a.items,f.btnClass))&&h.show!==!1&&e.push(f);return g.resolve(e),g.promise()}function p(a,b){Object.tryMethod(a,"toolbarItemClickCallback",b.action)}function q(a,b){return a.className.split(" ").indexOf(b)>=0}function r(a){return!(!a||!a.tagName||"mi-more-options-noko"!==a.tagName.toLowerCase())}function s(a,b){var c;for(c=0;c<a.length;c++)if(a[c].btnClass===b)return a[c]}function t(a,b){a&&(a.show=b)}function u(a,b){a.style.display=b?"inline-block":"none"}return i});
define('ui/elements/resultgrid/resultgrid-view-model',['require','lodash','jquery','jquery','text!./resultgrid-template.html','knockout','application/application-events','system/ui/message-box','./resultgrid-service','ui/elements/page-filter/page-filter-connection','query/services/dto/query-container-dto','query/services/dto/parameter-container-dto','catalog/services/catalog-service','query/services/query-service','query/execution/query-execution-engine','system/lang/converter','system/text/parser','system/text/formatter','../date-time/timezone-handler','system/globalization/translator','application/application-context','application/export-service','./config/json-config','./config/query-config','./config/attr-config','./config/prop-config','./helpers/json-helper','./helpers/query-helper','./helpers/toolbar-helper','ui/elements/checkbox/checkbox-view-model','ui/elements/tool-bar/view-model'],function(require){"use strict"
;var a=require("lodash"),b=require("jquery"),c=require("jquery"),d=require("text!./resultgrid-template.html"),e=require("knockout"),f=require("application/application-events"),g=require("system/ui/message-box"),h=require("./resultgrid-service"),i=require("ui/elements/page-filter/page-filter-connection"),j=require("query/services/dto/query-container-dto"),k=require("query/services/dto/parameter-container-dto"),l=require("catalog/services/catalog-service"),m=require("query/services/query-service"),n=require("query/execution/query-execution-engine"),o=require("system/lang/converter"),p=require("system/text/parser"),q=require("system/text/formatter"),r=Object.resolve(q),s=require("../date-time/timezone-handler"),t=require("system/globalization/translator"),u=require("application/application-context"),v=require("application/export-service"),w=require("./config/json-config"),x=require("./config/query-config"),y=require("./config/attr-config"),z=require("./config/prop-config"),A=Object.resolve(require("./helpers/json-helper")),B=Object.resolve(require("./helpers/query-helper")),C=require("./helpers/toolbar-helper")
;require("ui/elements/checkbox/checkbox-view-model"),require("ui/elements/tool-bar/view-model");var D=Object.create(HTMLElement.prototype);D.createdCallback=function(){this.element=this,this.translator=Object.resolve(t),this.service=Object.resolve(h),this.catalogService=Object.resolve(l),this.queryService=Object.resolve(m),this.queryContainerDTO=Object.resolve(j),this.pageFilterConnection=Object.resolve(i),this.fields=e.observableArray(),this.cachedQueryContainer=null,this.attrConfig=Object.resolve(y,this),this.propConfig=Object.resolve(z,this),this.toolbarHelper=Object.resolve(C),this.exportService=Object.resolve(v),E(this);var a=this;a.filtersArr=[],a.filterElIndex=null,a.queryContainer=null,a.columnsSpecified=!1,a.totalCountDfd=new b.Deferred,a._totalCount=e.observable(0),a._totalCount.subscribe(function(b){a.totalCountDfd.resolve(b)}),a._queryTotalCount=0,a.currentFilter="",a.queryHasBackgroundColor=e.observable(!1),a.noDataCaptioin=a.translator.translate("RG_NO_DATA_CAPTION"),
a.attrConfig.addAttributes(this),a.propConfig.addProperties(this),a.getTotalCount=!0,a.customTotalCount=e.observable(),a.pageNumber=0,a.listObjects=e.observableArray([{displayName:"0",val:0}]),a.optionsValue="val",a.selectedValue=e.observable(0),a.formColumnArr=[],a.tzHandler=Object.resolve(s),a.timezone=null,a.tzHandler.getTimezone().done(function(b){a.timezone=b}),this.loadJSONData&&this.reload(),a.isFirstLoad=!0,this.appEvents=Object.resolve(f)},D.attachedCallback=function(){var a;this.element.innerHTML=d,this.pageFilterConnection.open(B.pageFilterHandler.bind(null,this),this.element),e.applyBindings(this,b(this.element).find("mi-select")[0]),e.applyBindings(this,b(this.element).find(".totalCount")[0]),a=this.querySelector(".rg-header"),this.toolbarHelper.init(this,a),this.appEvents&&this.appEvents.layoutChanged&&this.appEvents.layoutChanged.add(this.repaint,this)},D.detachedCallback=function(){this.pageFilterConnection.close(),this.cachedQueryContainer=null,
this.appEvents&&this.appEvents.layoutChanged&&this.appEvents.layoutChanged.remove(this.repaint,this)},D.attributeChangedCallback=function(a,b,c){return this.attrConfig&&this.attrConfig.handleAttributeChange(a,b,c)};function E(a){a.disableButton=a.toolbarHelper.disableButton.bind(null,a.toolbarHelper),a.setNoAccess=a.toolbarHelper.setNoAccess.bind(null,a.toolbarHelper),a.showButton=a.toolbarHelper.showButton.bind(null,a.toolbarHelper)}function F(a,b){H.bind(null,a)()}D._refreshList=F,D.refresh=function(a){this.data(a),F(this)},D.reload=function(){b(this.element).find(".rg-filter").data("isFilterEnabled",!1),"static"===this.data()&&this.gridInstance?this.refresh("static"):this.load().done()},D.repaint=function(){var a=this;try{b(a.element).find(".gridContainer").dxDataGrid("instance").repaint()}catch(a){}},D.load=function(){this.getTotalCount=!0;var a;return this.loadJSONData&&"function"==typeof this.loadJSONData?(a=this.loadJSONData(),a.done(G.bind(null,this)),
a.promise()):this.loadJSONData&&"object"==typeof this.loadJSONData?(G(this,this.loadJSONData),b.Deferred().done().promise()):b.Deferred().done().promise()},D.toggleLoaderPanel=function a(c){var d=this;if(d&&!d.element)return!1;try{var e=b(d.element).find(".gridContainer").dxDataGrid("instance"),f=null;return f=void 0!==c?!!c:!e.option("loadPanel.enabled"),e.option("loadPanel.enabled",f)}catch(a){return console.error(a),!1}};function G(a,b){void 0===b.columns||0===b.columns.length?J(a,b):I(a,b)}function H(a,b){if(null!==a.fields()&&a.data()){a.cachedQueryContainer=null,a.getTotalCount=!0;K(a,x(a))}}function I(a,b){var c=A.getColumnsFromData(a,b);a._totalCount(b.data?b.data.length:0),K(a,w(a,b,c),b,"json")}function J(a,b){a._totalCount(b.data?b.data.length:0),K(a,w(a,b),b,"json")}function K(b,c,d,e){require(["devExWebJS"],function f(){S(b);var g,h=M(b,g);b.hideEditControls()&&h.addClass("hide-edit-controls"),e?(O(b,h,c,g),
"json"===e&&void 0!==d.selectedRows&&a.defer(A.preSelectRows.bind(null,b,d.selectedRows))):"static"===b.data()?B.handleGetTotalRecordsCount(b).done(function a(){O(b,h,c,g),L(b)}):O(b,h,c),R(b,h)})}function L(a){b(a.element).find(".dxDataGridTotalCount").html(a._totalCount()+" "+a.translator.translate("RG_TOTAL_COUNT_MESSAGE"))}function M(a,c){var d="calc(100% - 46px)";return"infinite"===a.scrollType()&&(d=a.showFooter?"calc(100% - 25px)":"100%"),b('<div id="gridContainer" class="gridContainer" style=""></div>').css({display:"block",height:d,width:"100%"})}function N(a,b,c){a._totalCount()<a.pageSize()&&b.css({height:c})}function O(a,b,c,d){P(a,b).dxDataGrid(c),Q(),d&&N(a,b,d)}function P(a,c){return b(a.element).find(".gridContainer").remove().end().find(".rg-header").after(c).end().find(".gridContainer")}function Q(){b(".dx-loadpanel-indicator.dx-loadindicator.dx-widget").html('<div class="load-spinner"><span class="loading-med loading-active center-block"></span></div>')}
function R(a,c){a.showFooter||b(c).parent().find(".rg-footer").addClass("hide-rg-footer")}function S(a){b(a.element).find(".rg-filter").data("isFilterEnabled",!1),T(a),a.toolbarHelper.handleVisibility(),"infinite"===a.scrollType()?b(a.element).find(".dxDataGridTotalCount").show():"standard"===a.scrollType()&&(b(a.element).find("mi-select").show(),b(a.element).find(".totalCount").show()),a.selectedValue.subscribe(a.toolbarHelper.changePage.bind(null,a))}function T(a){b(a.element).find(".rg-filter").off().hide(),a.showRowFilter()&&b(a.element).find(".rg-filter").show().on("click",U.bind(null,a))}function U(a,c){var d=b(a.element).find(".rg-filter").data("isFilterEnabled");b(a.element).find(".rg-filter").data("isFilterEnabled",!d),b(a.element).find(".gridContainer").dxDataGrid({filterRow:{visible:!d,showOperationChooser:!1}})}return document.registerElement("mi-resultgrid",{prototype:D}),D});
define('dashboard/view-models/query-widget',['require','lodash','jquery','knockout','./widget-view-model','./query-widget-editor','mi-assert','ui/elements/page-filter/page-filter-connection','application/application-events','text!../views/query-widget.html','ui/elements/resultgrid/resultgrid-view-model'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("./widget-view-model"),e=require("./query-widget-editor"),f=require("mi-assert"),g=require("ui/elements/page-filter/page-filter-connection"),h=require("application/application-events"),i=require("text!../views/query-widget.html");require("ui/elements/resultgrid/resultgrid-view-model");function j(b){k.call(this,b,i,e),this.query=c.observable(),this.path=c.observable(),this.pathSubscription=null,this.resultGrid=null,this.pageFilterConnection=Object.resolve(g),this.gridInstance=null,this.$gridLayoutItem=null,this.debouncedWidgetResizeFunction=a.debounce(o.bind(null,this),250),this.applicationEvents=Object.resolve(h),this.queryParams=null}var k=Object.inherit(d,j);j.prototype.afterAttach=function a(c){try{Element.upgrade("mi-resultgrid",c),this.pathSubscription=this.path.subscribe(t.bind(null,this)),this.resultGrid=c.element.querySelector("mi-resultgrid"),
this.resultGrid.gridLoadedCB=p.bind(null,this),this.$gridLayoutItem=b("mi-grid-layout-item"),this.$gridLayoutItem.on("element-resized",this.debouncedWidgetResizeFunction),this.pageFilterConnection.open(q.bind(null,this),c.element),this.queryParams&&n(this)}catch(a){k.prototype.onError.call(this,a)}},j.prototype.beforeDetach=function a(){try{l(this),this.pathSubscription.dispose(),this.pathSubscription=null,this.pageFilterConnection.close(),this.resultGrid=null,this.gridInstance=null,this.$gridLayoutItem.off("element-resized"),this.$gridLayoutItem=null}catch(a){k.prototype.onError.call(this,a)}finally{this.pathSubscription=null,this.resultGrid=null,this.gridInstance=null,this.$gridLayoutItem=null}};function l(a){m(a)&&(a.queryParams=a.resultGrid.rawQueryData.queryContainer.parmContainer)}function m(a){return a.resultGrid&&a.resultGrid.rawQueryData&&a.resultGrid.rawQueryData.queryContainer&&a.resultGrid.rawQueryData.queryContainer.parmContainer}function n(a){
a.resultGrid&&(a.resultGrid.queryParams=a.queryParams,a.resultGrid.setAttribute("suppressprompts","true")),a.refresh()}j.prototype.deserialize=function a(){try{var b=this.widget.properties();f.ok(b,"properties"),b.path&&this.path(b.path),b.query&&b.query.path&&this.path(b.query.path)}catch(a){k.prototype.onError.call(this,a)}},j.prototype.serialize=function a(){try{return l(this),n(this),{path:this.path()}}catch(a){k.prototype.onError.call(this,a)}},j.prototype.refresh=function a(){try{s(this)&&this.resultGrid&&this.resultGrid.refresh(this.encodePath(this.path()))}catch(a){k.prototype.onError.call(this,a)}},j.prototype.redraw=function(){o(this)},j.prototype.goto=function a(){try{this.applicationEvents.navigate.raise("catalog-item/"+this.encodePath(this.path()),{tab:!0})}catch(a){k.prototype.onError.call(this,a)}};function o(a){a.gridInstance&&a.gridInstance.repaint()}function p(a,b){a.gridInstance=b}function q(a,b){b&&b.parmDesigns&&b.parmDesigns.length&&(a.resultGrid.queryParams=b),
a.resultGrid.refresh(a.encodePath(a.path()))}function r(a){s(a)&&a.query(a.encodePath(a.path()))}function s(b){if(a.isFunction(b.path)&&b.path()&&""!==b.path())return!0}function t(a,b){u(a),r(a)}function u(a){a.queryParams=null,a.resultGrid.queryParams=null}return j});

define('text!dashboard/views/chart-widget-editor.html',[],function () { return '<div class="hyperlinks-widget-editor" style="height: 100%;">\r\n    <div style="height: 60px;" data-bind="with: widget">\r\n        <div class="form-group">\r\n            <label data-bind="text: $parent.translate(\'NAME\')"></label>\r\n            <div class="input-group localize">\r\n                <input type="text" class="form-control" data-bind="value: name">\r\n                <mi-localize type="20" data-bind="attr: { phrase: name, context: translationContext }, value: caption">\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <form style="height: 60px;" data-bind="with: widgetVM">\r\n        <label data-bind="text: translate(\'PATH\')"></label>\r\n        <div class="input-group">\r\n            <input disabled type="text" class="form-control disabled" data-bind="value: path">\r\n            <span class="input-group-btn">\r\n                <button class="btn btn-default path-button" type="button"\r\n                        data-bind="click: $parent.choosePathFromCatalog.bind($parent),\r\n                                   attr: { title: translator.translate(\'CHOOSE_CHART\') }" >...</button>\r\n            </span>\r\n        </div>\r\n    </form>\r\n</div>';});

define('dashboard/views/chart-widget-editor-view',['require','text!../views/chart-widget-editor.html'],function(require){"use strict";var a=require("text!../views/chart-widget-editor.html");function b(){this.region=null}return b.html=a,b.prototype.attach=function(a){this.region=a},b.prototype.detach=function(){this.region=null},b});
define('dashboard/view-models/chart-widget-editor',['require','knockout','./widget-editor','system/ui/message-box','catalog/catalog-dialog','../views/chart-widget-editor-view','ui/elements/localize/localize-element'],function(require){"use strict";var a=require("knockout"),b=require("./widget-editor"),c=require("system/ui/message-box"),d=require("catalog/catalog-dialog"),e=require("../views/chart-widget-editor-view");require("ui/elements/localize/localize-element");function f(a){g.call(this,a,e.html),this.editorView=Object.resolve(e),this.backup.path=this.kom.observable(),this.catalogDialog=Object.resolve(d)}var g=Object.inherit(b,f);f.prototype.afterLoad=function(){try{j(this)}catch(a){g.prototype.onError.call(this,a)}},f.prototype.afterSave=function(){try{k(this)}catch(a){g.prototype.onError.call(this,a)}},f.prototype.afterCancel=function(){try{l(this)}catch(a){g.prototype.onError.call(this,a)}},f.prototype.afterAttach=function(a){try{this.editorView.attach(a),Element.upgrade(a.element.querySelectorAll("mi-localize")),g.prototype.handleRequiredFields.call(this,this.widgetVM.path)}catch(a){g.prototype.onError.call(this,a)}},f.prototype.afterDetach=function(){try{this.editorView.detach()
}catch(a){g.prototype.onError.call(this,a)}},f.prototype.choosePathFromCatalog=function(){try{this.catalogDialog.show({path:this.widgetVM.path(),itemTypes:["Graph"]}).done(h.bind(null,this)).fail(i.bind(null,this))}catch(a){g.prototype.onError.call(this,a)}};function h(a,b){var c=a.widgetVM.translator.translate("CHART_WIDGET");a.widgetVM.path(b.path),a.widgetVM.widget.name(b.id)}function i(a,b){if("cancelled"!==b)throw new Error("Unable to retrieve catalog item because: "+b)}function j(a){a.backup.path(a.widgetVM.path())}function k(a){a.backup.path()}function l(a){a.widgetVM.path(a.backup.path())}return f});
define('ui/elements/page-filter/models/filter-parameters',['require','exports','module','ramda'],function(require,exports,module){"use strict";var a=require("ramda");function b(a){a=a||{},a.parmDesigns=a.parmDesigns||[],this.__private__={},this.__private__.parameters=a}b.prototype.toQueryString=function(){var a="";return c(this)&&(a+=e(this)),a};function c(a){return!!d(a).parmDesigns.length}function d(a){return a.__private__.parameters}function e(b){var c=d(b).parmDesigns||[];return a.pipe(a.map(f),a.map(g),a.map(h),a.reduce(i,""))(c)}function f(a){return{id:a.id,value:a.parmPrompts||[]}}function g(a){return a.value=a.value.join(","),a}function h(a){return"%"===a.value&&(a.value="%25"),"&"+a.id+"="+a.value}function i(a,b){return a+b}return b});
define('dashboard/models/commands/goto-route-command',['require','mi-assert','ui/elements/page-filter/page-filter-connection','ui/elements/page-filter/models/filter-parameters','application/application-events'],function(require){"use strict";var a=require("mi-assert"),b=require("ui/elements/page-filter/page-filter-connection"),c=require("ui/elements/page-filter/models/filter-parameters"),d=require("application/application-events");function e(a){this.__private__={},this.__private__.connection=Object.resolve(b),this.__private__.applicationEvents=Object.resolve(d),this.__private__.element=null,this.__private__.parameters=null,this.__private__.route=a,this.__private__.path="",this.__private__.queryString=""}e.prototype.execute=function(a,b){f(this,a),g(this,b),h(this,k.bind(null,this))};function f(b,c){v(b),a.instanceOf(c,HTMLElement,"element"),b.__private__.element=c}function g(b,c){v(b),a.stringNotEmpty(c,"path"),b.__private__.path=c}function h(b,c){a.isFunction(c,"callback"),i(b).open(c,j(b))}function i(a){return v(a),a.__private__.connection}function j(a){return v(a),a.__private__.element}function k(a,b){l(a,b),m(a),n(a,o(a)),r(a)}function l(a,b){v(a),b=b||{},
b.parmDesigns=b.parmDesigns||[],a.__private__.parameters=b}function m(a){i(a).close()}function n(b,c){v(b),a.stringNotEmpty(c,"queryString"),b.__private__.queryString=c}function o(a){var b=new c(p(a));return"path="+q(a)+b.toQueryString()}function p(a){return v(a),a.__private__.parameters}function q(a){return v(a),a.__private__.path}function r(a){var b=t(a)+"?"+u(a);s(a).navigate.raise(encodeURI(b),{tab:!0})}function s(a){return v(a),a.__private__.applicationEvents}function t(a){return v(a),a.__private__.route}function u(a){return v(a),a.__private__.queryString}function v(c){a.enabled&&(a.instanceOf(c,e,"self"),a.instanceOf(c.__private__.connection,b,"self.__private__.connection"),a.instanceOf(c.__private__.applicationEvents,d,"self.__private__.applicationEvents"),a.isNotUndefined(c.__private__.element,"self.__private__.element"),a.isNotUndefined(c.__private__.parameters,"self.__private__.parameters"),a.stringNotEmpty(c.__private__.route,"self.__private__.route"),
a.isString(c.__private__.path,"self.__private__.path"),a.isString(c.__private__.path,"self.__private__.queryString"))}return e});

define('text!dashboard/views/chart-widget.html',[],function () { return '<section class="chart-widget">\r\n    <mi-chart hide-toolbar="true" hide-title="true"></mi-chart>\r\n</section>';});

define('ui/elements/chart/models/chart-config-dto',['require','ramda'],function(require){"use strict";var a=require("ramda"),b=a.defaultTo(!1),c=a.defaultTo([]),d=a.defaultTo(0),e=a.defaultTo(null);function f(b){b=b||{},this.title=b.title,this.stacked=b.stacked||!1,this.percentStacked=b.percentStacked||!1,this.polar=b.polar||!1,this.enable3d=b.enable3d||!1,this.stock=b.stock||!1,this.heatmap=g(b),this.series=[],this.pieSeries=b.pieSeries||[],this.pieSeriesAltered=b.pieSeriesAltered||!1,this.pieSeriesAllHyperlinksChecked=b.pieSeriesAllHyperlinksChecked||!1,this.axis=[],this.horizontalAxisProperty=b.horizontalAxisProperty,this.horizontalAxisPropertyAlias=b.horizontalAxisPropertyAlias,this.sizeProperty=b.sizeProperty,this.sizePropertyAlias=b.sizePropertyAlias,this.chartMethod=b.chartMethod,this.aggregateProperties=b.aggregateProperties,this.pointFormat=b.pointFormat||"",this.dataLabelFormat=b.dataLabelFormat||"",this.queryKey=b.queryKey,this.queryParams=b.queryParams,this.queryStrParams=b.queryStrParams,this.formattedQuery=b.formattedQuery||!1,
this.isUomVisible=b.isUomVisible||!1,this.categoryProperty=b.categoryProperty,this.categoryPropertyAlias=b.categoryPropertyAlias||"",this.categorySystemCodeTableId=b.categorySystemCodeTableId||"",this.categoryStatemachineFmlyId=b.categoryStatemachineFmlyId||"",this.chartType=b.chartType||"column",this.showLabels=b.showLabels||!1,this.truncateLabels=b.truncateLabels!==!1,this.legendPosition=a.isNil(b.legendPosition)?b.showLegend?1:0:b.legendPosition,this.showXaxisLabels=b.showXaxisLabels!==!1,this.showScrollBar=b.showScrollBar||!1,this.scrollMaximum=b.scrollMaximum||10,this.datasetKey=b.datasetKey||"",this.stackToolTips=b.stackToolTips||!1,this.xAxisStep=b.xAxisStep||1,b.categoryArray&&(this.categoryArray=b.categoryArray),b.evalMobile&&(this.evalMobile=b.evalMobile)}function g(a){return a.heatmap?i(a):h()}function h(){return{enabled:!1,yAxis:[],inverted:!1,labelColor:null,minColor:null,maxColor:null,minValue:0,maxValue:null,hoverColor:null,borderColor:null,borderWidth:null,steps:null,
hyperlinks:!1,specifyColors:!1,colorSeries:[]}}function i(a){return{enabled:b(a.heatmap.enabled),yAxis:c(a.heatmap.yAxis),inverted:b(a.heatmap.inverted),labelColor:e(a.heatmap.labelColor),minColor:e(a.heatmap.minColor),maxColor:e(a.heatmap.maxColor),minValue:d(a.heatmap.minValue),maxValue:e(a.heatmap.maxValue),hoverColor:e(a.heatmap.hoverColor),borderColor:e(a.heatmap.borderColor),borderWidth:d(a.heatmap.borderWidth),steps:e(a.heatmap.steps),hyperlinks:b(a.heatmap.hyperlinks),specifyColors:b(a.heatmap.specifyColors),colorSeries:c(a.heatmap.colorSeries)}}return f});
define('ui/elements/chart/models/series-dto',[],function(){"use strict";function a(a){a=a||{},this.name=a.name||"",this.alias=a.alias||"",this.defaultAlias=a.defaultAlias||"",this.uniqueId=a.uniqueId||"",this.chartType=a.chartType||"",this.hyperlink=a.hyperlink||"None",this.hyperlinkAlias=a.hyperlinkAlias||"",this.color=a.color||"",this.yAxis=a.yAxis||0}return a});
define('security/services/timezone-dto',[],function(){"use strict";function a(a){this.name=void 0===a?"":void 0===a.name?"":a.name,this.id=void 0===a?"":void 0===a.id?"":a.id,this.supportsDST=a&&a.supportsDST}return a.fromDataCollection=function b(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new a(c[d]);return e},a});
define('ui/elements/chart/services/chart-service',['require','ramda','jquery','system/lang/ioc','system/http/ajax-client','system/http/ajax-request','security/services/timezone-dto'],function(require){"use strict";var a=require("ramda"),b=require("jquery"),c=require("system/lang/ioc").resolve,d=require("system/http/ajax-client"),e=require("system/http/ajax-request"),f=require("security/services/timezone-dto"),g="api/core/localizer",h=g+"/translations?localizableType={0}&defaultValue={1}&objectContext={2}",i="api/core/globalization",j=null;function k(){this.ajaxClient=c(d)}k.prototype.getByKey=function(a){return this.ajaxClient.get("api/core/catalog/item/"+a)},k.prototype.getByPath=function(a){return this.ajaxClient.get("api/core/catalog/item?path="+a)},k.prototype.getTimezones=function(){return null===j&&(j=c(d).get(i+"/timezone",{}).done(f.fromDataCollection).fail(a.identity)),j.promise()},k.prototype.getTranslation=function(a,c,d){var f=b.Deferred(),g=l(c,d);return e.get(g).send(f).done(m.bind(null,f,a,c)),f.promise()};function l(a,b){return h.replace("{0}",encodeURIComponent(28)).replace("{1}",encodeURIComponent(a)).replace("{2}",encodeURIComponent(b))}
function m(b,c,d,e){var f=a.find(a.propEq("cultureId",c))(e);f&&(d=f.value),b.resolve(d)}return k});
define('ui/elements/chart/chart-utilities',['require','lodash','ramda','query/model/query-result','query/model/column-result','query/model/row','query/model/cell','system/globalization/translator','ui/elements/chart/services/chart-service','application/application-context','system/text/formatter'],function(require){"use strict";var a=require("lodash"),b=require("ramda"),c=require("query/model/query-result"),d=require("query/model/column-result"),e=require("query/model/row"),f=require("query/model/cell"),g=require("system/globalization/translator"),h=require("ui/elements/chart/services/chart-service"),i=require("application/application-context"),j=require("system/text/formatter"),k=/<a [^>]+>([^<]+)<\/a>/,l=/\[|\]/g,m=/[\s|\[|\]|_|\-|.]/g,n=/^[A-Z]/,o=/'([^']*)'/g,p=/[#']/g,q=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,r=/"/g,s=/href='(.*?)'/,t=/onclick='(.*?)'/,u=/^([^:]+):|^#|^(.\/)|^(..\/)|^!/gm,v=/^(%20|\s)*(data|javascript)/im,w=/[^\x20-\x7E]/gim;function x(){this.CHART_TYPE_COLUMN="column",this.CHART_TYPE_STACKED_COLUMN="stacked-column",this.CHART_TYPE_BAR="bar",this.CHART_TYPE_TIME_SERIES="timeSeries",this.CHART_TYPE_STACKED_BAR="stacked-bar",this.CHART_TYPE_AREA="area",this.CHART_TYPE_AREA_SPLINE="areaspline",this.CHART_TYPE_STACKED_AREA="stacked-area",
this.CHART_TYPE_RADAR="radar",this.CHART_TYPE_POLAR="polar",this.CHART_TYPE_LINE="line",this.CHART_TYPE_PIE="pie",this.CHART_TYPE_DONUT="donut",this.CHART_TYPE_BUBBLE="bubble",this.CHART_TYPE_SCATTER="scatter",this.CHART_TYPE_PYRAMID="pyramid",this.CHART_TYPE_STOCK="stock",this.CHART_TYPE_STOCK_AREA="stock-area",this.CHART_TYPE_STOCK_STACKED_AREA="stacked-stock",this.CHART_TYPE_HEATMAP="heatmap",this.CHART_METHOD_COUNT="count",this.CHART_METHOD_PERCENT="percent",this.CHART_METHOD_SUM="sum",this.translator=Object.resolve(g),this.chartService=Object.resolve(h),this.timezones=[],this.CHART_AXIS_FORMATS=[{format:"",display:this.translator.translate("CHART_NO_FORMAT")},{format:"n",display:this.translator.translate("CHART_NUMBER")},{format:"c",display:this.translator.translate("CHART_CURRENCY")},{format:"p",display:this.translator.translate("CHART_PERCENTAGE")}],
this.CHART_COLORS=["#61adff","#fa913c","#8ad998","#ffdc50","#ff5a4f","#c0deff","#fdd3b1","#d0f0d6","#fff1b9","#ffbdb9","#6999c7","#e08437","#84bb88","#e6c74a","#da524b","#a0ceff","#fcbd8a","#b9e8c1","#ffea96","#ff9c95","#5880a7","#b86c2b","#6d9e72","#bda53d","#b4443c","#81bdff","#fba763","#a1e1ad","#ffe373","#ff7b72","#42617f","#854e18","#4f7755","#8d7c2b","#953730"],this.CHART_INDICATOR_COLORS=["#007aff","#ff9500","#4cd964","#ffcc00","#ff3b30"],this.CHART_TYPES=[{display:this.translator.translate("BAR_CHART"),chartTypes:[{name:this.CHART_TYPE_COLUMN,display:this.translator.translate("CHART_COLUMN"),icon:"icons-mi-chart-column"},{name:this.CHART_TYPE_BAR,display:this.translator.translate("CHART_BAR"),icon:"icons-mi-chart-bar"},{name:this.CHART_TYPE_STACKED_COLUMN,display:this.translator.translate("CHART_STACkED_COLUMN"),icon:"icons-mi-chart-stacked-column"},{name:this.CHART_TYPE_STACKED_BAR,display:this.translator.translate("CHART_STACKED_BAR"),icon:"icons-mi-chart-stacked-bar"},{
name:this.CHART_TYPE_TIME_SERIES,display:this.translator.translate("COLOR_SCALE"),icon:"icons-mi-chart-time-series"}]},{display:this.translator.translate("LINE_CHART"),chartTypes:[{name:this.CHART_TYPE_LINE,display:this.translator.translate("CHART_LINE"),icon:"icons-mi-chart-line"},{name:this.CHART_TYPE_AREA,display:this.translator.translate("CHART_AREA"),icon:"icons-mi-chart-area"},{name:this.CHART_TYPE_STACKED_AREA,display:this.translator.translate("CHART_STACKED_AREA"),icon:"icons-mi-chart-stacked-area"}]},{display:this.translator.translate("PIE_CHART"),chartTypes:[{name:this.CHART_TYPE_PIE,display:this.translator.translate("CHART_PIE"),icon:"icons-mi-chart-pie"},{name:this.CHART_TYPE_DONUT,display:this.translator.translate("CHART_DONUT"),icon:"icons-mi-chart-donut"},{name:this.CHART_TYPE_PYRAMID,display:this.translator.translate("CHART_PYRAMID"),icon:"icons-mi-chart-pyramid"}]},{display:this.translator.translate("RADAR_CHART"),chartTypes:[{name:this.CHART_TYPE_RADAR,
display:this.translator.translate("CHART_RADAR"),icon:"icons-mi-chart-radar"},{name:this.CHART_TYPE_POLAR,display:this.translator.translate("CHART_POLAR"),icon:"icons-mi-chart-polar"}]},{display:this.translator.translate("SCATTER_CHART"),chartTypes:[{name:this.CHART_TYPE_SCATTER,display:this.translator.translate("CHART_SCATTER"),icon:"icons-mi-chart-scatter"},{name:this.CHART_TYPE_BUBBLE,display:this.translator.translate("CHART_BUBBLE"),icon:"icons-mi-chart-bubble"}]},{display:this.translator.translate("STOCK_CHARTS"),chartTypes:[{name:this.CHART_TYPE_STOCK,display:this.translator.translate("CHART_STOCK_LINE"),icon:"icons-mi-stock-chart-line"},{name:this.CHART_TYPE_STOCK_AREA,display:this.translator.translate("CHART_STOCK_AREA"),icon:"icons-mi-stock-chart-area"},{name:this.CHART_TYPE_STOCK_STACKED_AREA,display:this.translator.translate("CHART_STOCK_STACKED_AREA"),icon:"icons-mi-stock-chart-area-stacked"}]},{display:this.translator.translate("HEATMAP_CHARTS"),chartTypes:[{
name:this.CHART_TYPE_HEATMAP,display:this.translator.translate("CHART_HEATMAP"),icon:"icons-mi-heatmap-chart"}]}],this.PIE_LEGEND_TYPES=[{position:0,display:this.translator.translate("NO_LEGEND")},{position:1,display:this.translator.translate("TOP")}],this.LEGEND_TYPES=[{position:0,display:this.translator.translate("NO_LEGEND")},{position:1,display:this.translator.translate("TOP")},{position:2,display:this.translator.translate("TOP_RIGHT")},{position:3,display:this.translator.translate("RIGHT")},{position:4,display:this.translator.translate("BOTTOM_RIGHT")},{position:5,display:this.translator.translate("BOTTOM")},{position:6,display:this.translator.translate("BOTTOM_LEFT")},{position:7,display:this.translator.translate("LEFT")},{position:8,display:this.translator.translate("TOP_LEFT")}]}x.prototype.getLegendVerticalPosition=function(a){switch(a){case 0:case 8:case 1:case 2:return"top";case 7:case 3:return"middle";case 6:case 5:case 4:return"bottom"}},
x.prototype.getLegendHorizontalPosition=function(a){switch(a){case 0:case 8:case 7:case 6:return"left";case 1:case 5:return"center";case 2:case 3:case 4:return"right"}},x.prototype.allow3d=function(a){return[this.CHART_TYPE_COLUMN,this.CHART_TYPE_STACKED_COLUMN,this.CHART_TYPE_BAR,this.CHART_TYPE_STACKED_BAR,this.CHART_TYPE_PIE,this.CHART_TYPE_DONUT].indexOf(a)>-1},x.prototype.translateChartType=function(a){return a===this.CHART_TYPE_STACKED_COLUMN?this.CHART_TYPE_COLUMN:a===this.CHART_TYPE_STACKED_BAR?this.CHART_TYPE_BAR:a===this.CHART_TYPE_STACKED_AREA?this.CHART_TYPE_AREA:a===this.CHART_TYPE_RADAR?this.CHART_TYPE_LINE:a===this.CHART_TYPE_POLAR?this.CHART_TYPE_COLUMN:a===this.CHART_TYPE_TIME_SERIES?this.CHART_TYPE_COLUMN:a};var y=b.curry(function a(b,c,d){b!==d.getLocalizedAlias()&&b!==d.getAlias()||c.push(d)});x.prototype.getTranslatedColumnData=function(a,c){var d,e=[];return a.chart.state.rawData&&(d=a.chart.state.rawData.getColumns(),b.forEach(y(c,e),d)),b.head(e)},
x.getHyperlinkColumnIndexes=function(a){var b,c,d,e,f,g=[],h=a.getColumns(),i;for(c=0;c<a.getRows().length;c++)for(e=a.getRows()[c],d={},b=0;b<e.getCells().length;b++)h[b].getIsDisplayed()&&(i=h[b].getFieldId().replace(l,""),d[i]=e.getCells()[b].getDbValue(),""!==(f=e.getCells()[b].getHyperlinkRoute())&&(this.isInArray(b,g)||(g[g.length]=b)));return g};function z(a,c){for(var d=[],g=0;g<a.length;g++){for(var h=new e,i=[],j=Object.keys(a[g]),l,m=0;m<j.length;m++){var n=new f,o=a[g][j[m]]?a[g][j[m]].toString():"",p=b.map(b.invoker(0,"getAlias"),c),u=b.findIndex(b.equals(j[m]),p);o=q.test(o)?o.replace(q,""):o;if(k.test(o)&&(l=o.replace(r,"'"),l=l.replace(s,A),l=l.replace(t,""))){var v=s.exec(l);null!==v&&n.setHyperlinkRoute(v[1]);var w=k.exec(o||"");null!==w&&(o=w[1])}n.setColumn(c[u]),n.setDbValue(o),n.setValue(o),i.push(n)}h.setCells(i),d.push(h)}return d}function A(a,b){var c=b.replace(w,""),d=c.match(u),e;return d?(e=d[0],v.test(e)?"":"href='"+b+"'"):""}function B(a){
for(var b=[],c=0;c<a.length;c++){var e=new d;e.setAlias(a[c].alias),e.setLocalizedAlias(a[c].alias),e.setIsDisplayed(!0),"character"===a[c].dataType?e.setFieldDataType("System.String"):"number"===a[c].dataType?e.setFieldDataType("System.Integer"):"date"===a[c].dataType?e.setFieldDataType("System.DateTime"):"boolean"===a[c].dataType&&e.setFieldDataType("System.Boolean"),e.setFieldId(D(a[c].id)),b.push(e)}return b}x.formatDataset=function(a){var b=new c;return b.setRowCount(a.data.length),b.setColumns(B(a.columns)),b.setRows(z(a.data,b.getColumns())),b};function C(a){return a.toLowerCase()}function D(a){return a.replace(m,"").replace(n,C)}x.formatGridData=function(a){var c,d,e,f,g=[],h=[],i,j;for(a.data?j=b.keys(a.data[0]):a[0]&&(a.data=a[0].data,j=b.keys(a.data[0])),d=0;d<a.data.length;d++){for(f=a.data[d],e={},c=0;c<j.length;c++)if(i=D(j[c]),e[i]=f[j[c]],e[i]=F(e[i]),0===d){var k={},l=E(j[c],a.data);k.id=D(j[c]),k.alias=j[c],l&&(k.isActionColumn="true"),h.push(k)}g[g.length]=e}return{
columns:h,data:g}};function E(a,c){return b.compose(b.any(K),b.flatten,b.map(b.prop(a)))(c)}function F(b){var c=Object.resolve(j);return G(b)&&a.isFinite(b)&&(b=c.format(b,"g",i.user.cultureId)),b}function G(a){return a%1!=0}x.rowSetToJSON=function(a,b){var c,d,e,f,g=[],h=[],i=b.getColumns(),j,k,m,n,o;for(d=0;d<b.getRows().length;d++){for(f=b.getRows()[d],e={},c=0;c<f.getCells().length;c++)if(i[c].getIsDisplayed()&&(o=i[c].getTypeName(),j=i[c].getFieldId().replace(l,""),j=""!==j?j:D(i[c].getAlias().replace(l,"")),m=f.getCells()[c].getHyperlinkRoute(),n=x.getFormattedValueFromQuery(a,f,[c],0),e[j]=x.formatHyperlink(n,m),k=i[c].getLocalizedAlias()||i[c].getAlias(),0===d)){var p={};p.id=j,k&&(p.alias=k),""!==m&&(p.isActionColumn="true"),h.push(p)}g[g.length]=e}return{columns:h,data:g}};function H(a,b){var c=Object.resolve(j);return I(b)?a=c.format(a,"g",i.user.cultureId):J(b)&&!x.isHTML(a)&&""!==a&&null!==a&&(a=c.format(new Date(a),i.user.formats.dateTime,i.user.cultureId)),a}
function I(a){return"System.Int32"===a||"System.Double"===a}function J(a){return"System.DateTime"===a}x.extractHyperlinkValue=function(a){var b=k.exec(a||"");return null!==b&&(a=b[1]),a},x.extractHyperlinkHref=function(a,b,c){return a.getCells()[b[c]]?a.getCells()[b[c]].getHyperlinkRoute():""},x.extractChartName=function(a,b,c,d){var e=b[c[d]];return a.series[e]?a.series[e].name:""};function K(a){return a&&(a.indexOf("#")>-1||a.indexOf("http")>-1||a.indexOf("!")>-1)}return x.isHTML=function(a){var b=document.createElement("div");b.innerHTML=a;for(var c=b.childNodes,d=c.length;d--;)if(1===c[d].nodeType)return!0;return!1},x.isInArray=function(a,b){return b.indexOf(a)>-1},x.closestByNodeName=function(a,b){for(;a.nodeName!==b;)if(!(a=a.parentNode))return null;return a},x.prototype.showXAxisLabels=function(a){var b=[this.CHART_TYPE_BAR,this.CHART_TYPE_STACKED_BAR,this.CHART_TYPE_POLAR,this.CHART_TYPE_RADAR,this.CHART_TYPE_TIME_SERIES];return a.showXaxisLabels||b.indexOf(a.chartType)>-1},
x.prototype.typeOfPieChart=function(a){return[this.CHART_TYPE_PIE,this.CHART_TYPE_DONUT,this.CHART_TYPE_PYRAMID].indexOf(a)>-1},x.getRowValueFromQuery=function(a,b,c){return a.getCells()[b[c]]?a.getCells()[b[c]].getDbValue():null},x.getFormattedValueFromQuery=function(a,b,c,d){var e=b.getCells()[c[d]]?b.getCells()[c[d]].getValue():null,f=b.getCells()[c[d]]?b.getCells()[c[d]].getColumn().getDisplayUomCaption():null;return a&&a.isUomVisible&&""!==f&&e&&(e=e+" ("+f+")"),e},x.formatHyperlink=function(a,b){return""===b?a:a?"<a href='"+b+"'>"+a+"</a>":null},x.setYValueFromFormatted=function(a,b){return isNaN(b.replace(/['"]+/g,""))?a:b},x});
define('ui/elements/chart/models/axis-dto',[],function(){"use strict";function a(a){a=a||{},this.index=a.index,this.axis=a.axis,this.name=a.name||"",this.caption=a.caption||"",this.minimum=a.minimum||"",this.maximum=a.maximum||"",this.decimals=a.decimals||"2",this.format=a.format||"",this.tickInterval=a.tickInterval||null,this.gridLines=a.gridLines!==!1,this.logarithmic=!!a.logarithmic}return a});
define('ui/elements/chart/models/chart-config-adapter',['require','ui/elements/chart/models/chart-config-dto','ui/elements/chart/models/series-dto','system/globalization/translator','ui/elements/chart/chart-utilities','ui/elements/chart/models/axis-dto'],function(require){"use strict";var a=require("ui/elements/chart/models/chart-config-dto"),b=require("ui/elements/chart/models/series-dto"),c=require("system/globalization/translator"),d=require("ui/elements/chart/chart-utilities"),e=require("ui/elements/chart/models/axis-dto");function f(){}f.fromDTO=function(b){var c=new a(b);return h(c,b),i(c,b.chartType,b.chartTypes),g(c,b),c},f.deserialize=function(a){var b=JSON.parse(a);return f.fromDTO(b)},f.serialize=function(a){return JSON.stringify(a)};function g(a,b){var d;if(b.axis&&b.axis[0]instanceof e)return void(a.axis=b.axis);a.axis=[],b.axis?(a.axis[0]=new e(b.axis[0]),a.axis[1]=new e(b.axis[1]),a.axis[2]=new e(b.axis[2])):(a.axis[0]=new e({name:b.seriesName}),a.axis[1]=new e({index:1}),a.axis[2]=new e({index:2,gridLines:!1})),a.axis[0].index=0,a.axis[1].index=1,a.axis[2].index=2,d=Object.resolve(c),a.axis[0].axis=d.translate("CHART_LEFT_AXIS"),a.axis[1].axis=d.translate("CHART_RIGHT_AXIS"),
a.axis[2].axis=d.translate("CHART_BOTTOM_AXIS")}function h(a,c){var e,f=new d;if(a.series=[],c.series&&c.series[0]instanceof b)return void(a.series=c.series);if(c.series)for(e=0;e<c.series.length;e++)c.series[e].color||(c.series[e].color=f.CHART_COLORS[e]),a.series[e]=new b(c.series[e]);else{if(c.sliceProperty)return void(a.series=[new b({name:c.sliceProperty})]);if(c.sliceProperties&&c.sliceProperties.length>0)for(e=0;e<c.sliceProperties.length;e++)a.series[e]=new b({name:c.sliceProperties[e]});else;}}function i(a,b,c){var d;if(b){for(d=0;d<a.series.length;d++)a.series[d].chartType||(a.series[d].chartType=b);a.stacked=0===b.lastIndexOf("stacked",0),a.stock=0===b.lastIndexOf("stock",0),b.indexOf("stock")>-1?a.stock=!0:a.stock=!1}else if(c&&c.length>0)for(d=0;d<c.length;d++)a.series[d].chartType=c[d],a.stacked=a.stacked||0===c[d].lastIndexOf("stacked",0),
c[d].indexOf("stock")>-1?a.stock=!0:a.stock=!1;else for(d=0;d<a.series.length;d++)a.stacked=a.stacked||0===a.series[d].chartType.lastIndexOf("stacked",0),a.series[d].chartType.indexOf("stock")>-1?a.stock=!0:a.stock=!1}return f});
define('ui/elements/chart/formatters/base-chart-formatter',["require","exports","ramda","ui/elements/chart/chart-utilities","system/text/formatter","system/lang/object"],function(require,exports,a){"use strict";var b=require("lodash"),c=require("system/lang/object"),d=require("ui/elements/chart/chart-utilities"),e=require("system/text/formatter"),f=/{(.*?)}/g,g=/{|}/g,h=a.has("options"),i=a.has("formattedValue"),j=a.has("formattedValues"),k=a.has("point"),l=a.has("index"),m=a.has("series"),n=a.has("formattedXValue"),o=a.has("formattedYValue"),p=a.has("formattedZValue"),q=a.split("."),r=a.prop("formattedValue"),s=function(b){return a.propEq("x",b)},t=a.curry(function a(b,c){var d=this.series.options.dataLabels.pointFormat||"{point.y:g2}",e=E(b,d,this);if(F(b)){return'<div class="'+(b.config.truncateLabels?"data-label":"")+'" title="'+e+'">'+e+"</div>"}return e}),u=a.curry(function a(b,c){return E(b,this.series.tooltipOptions.pointFormat,this)}),v=function(){function a(a){this.axisFormatter=w,this.formatDataLabels=t,this.formatTooltip=u,
this.config=a,this.chartUtil=c.resolve(d)}return a.prototype.translateFormatting=function(a){return""!==a.format?a.format+a.decimals:""},a}();exports.BaseChartFormatter=v;function w(){var a=this.axis.options.labels.format||"g2";return x(this.value,a)}function x(a,b){return b?c.resolve(e).format(a,b):a}function y(a,b){var c,d=b.replace(g,"").split("."),e;for(e=a,c=0;c<d.length;c++)void 0!==e[d[c]]&&(e=e[d[c]]);return e}function z(a,b){return b.yAxis?b.yAxis.options.labels.format:F(a)?a.options.yAxis[0].labels.format:""}function A(a,c,d){var e,f,h,i,j,k,l,m=z(a,c.series);return f=d.replace(g,""),e=f.split(":"),l=f.split(".")[1]?f.split(".")[1]:"",f=e[0],h=e.length>1&&""===m?e[1]:m,j=y(c,f),i=D(c,j,h,d),k=isNaN(j)?null:Number(i),null!==i&&!a.config.formattedQuery&&b.isNumber(j)&&c.options&&(c.options.formattedValue=i),null!==k&&"name"!==l&&"percentage:n0"!==l&&(i=C(a,c,f,i)),i}function B(b,c,d){if(a.test(/\bstock\b/,b.config.chartType)){var e=b.chartData[0].data
;return a.compose(a.join("<br/>"),a.uniq,a.map(r),a.filter(s(c)))(e)}return d}function C(b,c,d,e){var f=q(d);return h(c)&&i(c)&&c.options.formattedValue?e=B(b,c.options.x,c.options.formattedValue):k(c)&&h(c.point)&&c.point.options.formattedValue?e=c.point.options.formattedValue:n(c)||o(c)||p(c)?a.any(a.equals("x"),f)&&c.formattedXValue?e=c.formattedXValue:a.any(a.equals("y"),f)&&c.formattedYValue?e=c.formattedYValue:a.any(a.equals("z"),f)&&c.formattedZValue&&(e=c.formattedZValue):l(c)&&m(c)&&l(c.series)&&b.chartData[c.series.index]&&j(b.chartData[c.series.index])?""!==b.chartData[c.series.index].formattedValues[c.index]&&(e=b.chartData[c.series.index].formattedValues[c.index]):null===e&&(e=""),e}function D(a,b,c,d){try{return x(b,c)}catch(b){return window.Highcharts.format(d,{point:a})}}exports.applyFormat=D;function E(a,b,c){var d=b.match(f),e,g,h=b;for(e=0;e<d.length;e++)g=A(a,c.point?c.point:c,d[e]),h=h.replace(d[e],g);return h}function F(a){
return a.chartUtil.CHART_TYPE_PIE===a.config.chartType||a.chartUtil.CHART_TYPE_DONUT===a.config.chartType||a.chartUtil.CHART_TYPE_PYRAMID===a.config.chartType}});
define('ui/elements/chart/formatters/standard-chart-formatter',["require","exports","./base-chart-formatter"],function(require,exports,a){"use strict";var b=function(a){__extends(b,a);function b(b){return a.call(this,b)||this}return b}(a.BaseChartFormatter);exports.StandardChartFormatter=b});
define('ui/elements/chart/formatters/stock-chart-formatter',["require","exports","./base-chart-formatter"],function(require,exports,a){"use strict";var b=function(a){__extends(b,a);function b(b){return a.call(this,b)||this}return b}(a.BaseChartFormatter);exports.StockChartFormatter=b});
define('ui/elements/chart/formatters/heatmap-chart-formatter',["require","exports","ramda","./base-chart-formatter"],function(require,exports,a,b){"use strict";var c=/{(.*?)}/g,d=/{|}/g,e=a.curry(function a(b,c){var d=b.options.plotOptions.series.dataLabels.pointFormat||"{point.value:g2}";return"<b>"+this.series.xAxis.categories[this.point.x]+"</b><br>"+this.series.yAxis.categories[this.point.y]+" | "+k(b,d,this)}),f=a.curry(function a(b,c){return k(b,this.series.options.dataLabels.pointFormat||"{point.value:g2}",this)}),g=function(a){__extends(b,a);function b(b){var c=a.call(this,b)||this;return c.formatDataLabels=f,c.formatTooltip=e,c}return b}(b.BaseChartFormatter);exports.HeatmapChartFormatter=g;function h(b,c){var e=c.replace(d,"").split(".");return a.path(e,b)}function i(a,c,e){var f,g,i,k,l,m;return g=e.replace(d,""),f=g.split(":"),g=f[0],i=f.length>1?f[1]:"g2",l=h(c,g),k=b.applyFormat(c,l,i,e),m=isNaN(k)?null:Number(k),null!==m&&(k=j(a,c,k)),k}function j(a,b,c){
var d=b.hasOwnProperty("point"),e=d&&b.point.hasOwnProperty("index"),f=b.hasOwnProperty("series"),g=f&&b.series.hasOwnProperty("index"),h=g&&a.chartData[b.series.index],i=d&&h&&a.chartData[b.series.index].hasOwnProperty("formattedValues");return e&&g&&h&&i&&""!==a.chartData[b.series.index].formattedValues[b.point.index]&&(c=a.chartData[b.series.index].formattedValues[b.point.index]),c}function k(a,b,d){var e=b.match(c),f=b,g,h;for(g=0;g<e.length;g++)h=i(a,d,e[g]),f=f.replace(e[g],h);return f}});
define('ui/elements/chart/formatters/chart-formatter-factory',["require","exports","./standard-chart-formatter","./stock-chart-formatter","./heatmap-chart-formatter"],function(require,exports,a,b,c){"use strict";return function(){function d(){}return d.create=function(d){return d&&d.stock===!0?new b.StockChartFormatter(d):d&&d.heatmap.enabled===!0?new c.HeatmapChartFormatter(d):d?new a.StandardChartFormatter(d):void 0},d}()});
define('ui/elements/chart/models/base-chart',["require","exports","lodash","ramda","application/application-events","ui/elements/chart/chart-utilities","ui/elements/chart/formatters/chart-formatter-factory","system/lang/converter"],function(require,exports,a,b,c){"use strict";var d=require("system/lang/converter"),e=require("ui/elements/chart/chart-utilities"),f=require("ui/elements/chart/formatters/chart-formatter-factory"),g=window,h=Object;return function(){function i(a,b,c){this.chartUtil=h.resolve(e),this.config=b,this.chartData=null,this.categoryArray=[],this.chartFormatter=f.create(this.config),this.options=this.newChartOptions(a,c),this.formatLegendOptions(),this.MSMoveFix()}return i.prototype.MSMoveFix=function(){if(g.MSPointerEvent&&g.Highcharts.Pointer&&!g.Highcharts.Pointer.MSHighChartMeridium){var a=g.Highcharts.Pointer.prototype.onContainerPointerMove;g.Highcharts.extend(g.Highcharts.Pointer.prototype,{onContainerPointerMove:this.deferMSClicks.bind(null,a),MSHighChartMeridium:!0})}},
i.prototype.deferMSClicks=function(c){var d=arguments;a.defer(c.bind(null,c,b.drop(1,d)))},i.prototype.formatLegendOptions=function(){var a=this.chartUtil.getLegendHorizontalPosition(this.config.legendPosition),b=this.chartUtil.getLegendVerticalPosition(this.config.legendPosition),c="bottom"===b,d="left"===a&&c,e="right"===a&&c,f=d||e,g="stock"===this.config.chartType||"stock-area"===this.config.chartType||"stacked-stock"===this.config.chartType,h="top"===b&&"right"===a&&g,i=f?this.config.series.length*-12:12,j=d?150:10,k=e?150:10,l=d?-150:e?150:0,m=f?{textOverflow:"ellipsis",width:110}:{},n="top"!==b?0:h?70:30;this.options.chart.spacingLeft=j,this.options.chart.spacingRight=k,this.options.legend.margin=i,this.options.legend.x=l,this.options.legend.y=n,this.options.legend.align=a,this.options.legend.verticalAlign=b,this.options.legend.itemStyle=m},i.prototype.newChartOptions=function(a,b){return{chart:{style:{fontFamily:"open_sansregular"},renderTo:a,backgroundColor:"transparent",
zoomType:"xy",panning:!0,panKey:"shift",options3d:{}},colors:this.chartUtil.CHART_COLORS,exporting:{enabled:!1},credits:{enabled:!1},title:{text:b},loading:{style:{}},scrollbar:{},legend:{enabled:0!==this.config.legendPosition,layout:"vertical",borderColor:"#CCC",borderWidth:1,backgroundColor:"#FFFFFF",shadow:!1},tooltip:{pointFormat:this.config.pointFormat||"{series.name}: {point.y:g2}",pointFormatter:this.chartFormatter.formatTooltip(this),shared:!1},plotOptions:{series:{turboThreshold:1e4,showInLegend:!0,pointWidth:35,pointPadding:5,cursor:null,dataLabels:{enabled:this.config.showLabels,pointFormat:this.config.dataLabelFormat||(this.isPieChart()?"{point.name}: {point.y:g2}":"{point.y:g2}"),formatter:this.chartFormatter.formatDataLabels(this),color:"black",distance:45,style:{textShadow:"none"}},point:{events:{click:this.pointClickEvent,mouseOver:this.mouseOverEvent}}},line:{marker:{enabled:!1}},column:{},bar:{},area:{marker:{enabled:!1},lineWidth:3},areaspline:{marker:{enabled:!1},
lineWidth:3}},yAxis:[],xAxis:{labels:{rotation:this.xAxisLabelAngle(this.chartUtil,this.config.chartType),enabled:this.config.showXaxisLabels}}}},i.prototype.pointClickEvent=function(){var a=this,b,d,f,g=!0;a.series&&a.series.chart&&a.series.chart.container&&(d=a.series.chart.container,f=e.closestByNodeName(d,"MI-DASHBOARD")),a.options&&a.options.url&&(b=a.options.url),b&&(g=b.indexOf("graph")<=-1,f&&(g=!0),h.resolve(c).navigate.raise(b,{tab:g}))},i.prototype.mouseOverEvent=function(){var a=this;(a.options&&a.options.url?a.options.url:null)&&a.graphic&&(a.graphic.element.style.cursor="pointer")},i.prototype.xAxisLabelAngle=function(a,b){return[a.CHART_TYPE_BAR,a.CHART_TYPE_STACKED_BAR,a.CHART_TYPE_POLAR,a.CHART_TYPE_RADAR].indexOf(b)>-1?0:-60},i.prototype.getOptions=function(a,b){return this.chartData=a,this.categoryArray=b,this.configureOptions(),this.formatChartData(),this.configureChartType(),this.setAxes(),this.options},i.prototype.formatChartData=function(){
this.options.series=this.chartData},i.prototype.configureChartType=function(){var a=(this.chartData||{}).length,b;for(b=0;b<a;b++)this.enable3D(),this.formatScrollBar(b),this.formatStacked(b)},i.prototype.enable3D=function(){this.options.chart.options3d.enabled=!1},i.prototype.setAxes=function(){this.setXAxis(),this.setYAxis(0),this.setYAxis(1)},i.prototype.setXAxis=function(){this.options.xAxis.title=this.options.xAxis.title||{},this.options.xAxis.title.text||(this.options.xAxis.title.text=this.config.axis[2].caption||this.config.axis[2].name),this.options.xAxis.gridLineWidth||(this.options.xAxis.gridLineWidth=this.config.axis[2].gridLines?1:0)},i.prototype.setYAxis=function(a){this.options.yAxis[this.options.yAxis.length]={type:this.calculateChartType(this.config.axis[a]),min:this.calculateYAxisMinimum(this.config.axis[a]),max:d.toNullableInteger(this.config.axis[a].maximum),title:{text:this.config.axis[a].caption||this.config.axis[a].name},labels:{
format:this.chartFormatter.translateFormatting(this.config.axis[a]),formatter:this.chartFormatter.axisFormatter,rotation:this.calculateLabelAngle(this.config),enabled:this.shouldLabelsBeEnabled(this.config)},opposite:1===a,tickInterval:d.toNullableInteger(this.config.axis[a].tickInterval),gridLineWidth:this.config.axis[a].gridLines?1:0,stackLabels:{enabled:!1}}},i.prototype.calculateYAxisMinimum=function(a){var b=d.toNullableInteger(a.minimum);return a.logarithmic?Math.max(1,b):b},i.prototype.calculateChartType=function(a){if(a.logarithmic)return"logarithmic"},i.prototype.calculateLabelAngle=function(a){return"bar"!==a.chartType&&"stacked-bar"!==a.chartType?0:-60},i.prototype.shouldLabelsBeEnabled=function(a){return"bar"!==a.chartType&&"stacked-bar"!==a.chartType||a.showXaxisLabels},i.prototype.isPieChart=function(){
return this.chartUtil.CHART_TYPE_PIE===this.config.chartType||this.chartUtil.CHART_TYPE_DONUT===this.config.chartType||this.chartUtil.CHART_TYPE_PYRAMID===this.config.chartType},i.prototype.formatScrollBar=function(a){},i.prototype.formatStacked=function(a){},i.prototype.configureOptions=function(){},i}()});
define('ui/elements/chart/models/standard-chart',['require','ui/elements/chart/chart-utilities','ui/elements/chart/models/base-chart','system/text/parser','ramda'],function(require){"use strict";var a=require("ui/elements/chart/chart-utilities"),b=require("ui/elements/chart/models/base-chart"),c=require("system/text/parser"),d=require("ramda");function e(a,b,c){f.call(this,a,b,c)}var f=Object.inherit(b,e);e.prototype.configureOptions=function(){this.options.chart.polar=this.config.polar,this.options.chart.options3d=t(this.config),this.options.legend=s(this.options.legend,this.chartUtil,this.config),this.options.plotOptions.column=k(),this.options.plotOptions.bar=k(),this.options.plotOptions.scatter=l(this.config),this.options.plotOptions.bubble=j(this.config),this.options.plotOptions.pie=i(this.config),this.options.plotOptions.pyramid=h(this.config),this.options.xAxis.categories=q(this.categoryArray),this.options.xAxis.labels.formatter=d.partial(r,[this.config]),this.options.plotOptions.series=g(this.config,this.chartUtil,this.options.plotOptions.series)};function g(a,b,c){return B(a,b)?(c.dataLabels.useHTML=!0,c.dataLabels.distance=10,
c):c}function h(a){var b={allowPointSelect:!0,depth:35,width:"50%",tooltip:{pointFormat:a.pointFormat||"{point.y:g2}"},dataLabels:{pointFormat:a.dataLabelFormat||"{point.y:g2}",connectorWidth:.3}};return a.truncateLabels&&(b.dataLabels.style={width:"100px"}),b}function i(a){var b={allowPointSelect:!0,depth:35,tooltip:{pointFormat:a.pointFormat||"{point.y:g2}"},dataLabels:{pointFormat:a.dataLabelFormat||"{point.name}: {point.y:g2}"}};return a.truncateLabels&&(b.dataLabels.style={width:"100px"}),b}function j(a){return{tooltip:{pointFormat:a.pointFormat||"({point.x:g2}, {point.y:g2}), size: {point.z:g2}"},dataLabels:{pointFormat:a.dataLabelFormat||"({point.x:g2}, {point.y:g2}), size: {point.z:g2}"}}}function k(){return{borderWidth:0,shadow:{opacity:.2,color:"#555555"}}}function l(a){return{tooltip:{pointFormat:a.pointFormat||"({point.x:g2}, {point.y:g2})"},dataLabels:{pointFormat:a.dataLabelFormat||"({point.x:g2}, {point.y:g2})"}}}e.prototype.formatChartData=function(){p(this),m(this),
f.prototype.formatChartData.call(this)};function m(a){var b,c=(a.chartData||{}).length||-1;for(b=0;b<c;b++)n(a.chartData[b].data)}function n(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.x?c.x=o(c.x):""===c.x&&(c.x=null),c.y?c.y=o(c.y):""===c.y&&(c.y=null),c.z?c.z=o(c.z):""===c.z&&(c.z=null)}function o(b){var e=a.extractHyperlinkValue(b),f=c.parseFloat(e);return d.is(Date,e)?e:isNaN(f)?null:Number(f)}function p(a){(a.chartData||{}).length&&a.chartUtil.typeOfPieChart(a.config.chartType)&&a.config.pieSeries.length>0&&(a.chartData[0].data=a.config.pieSeries)}function q(b){var c,d=(b||{}).length;for(c=0;c<d;c++)b[c]=a.extractHyperlinkValue(b[c]);return b}var r=d.curry(function a(b){var c=10,d=(this.value||"").toString();return d.length>c&&b.truncateLabels?d.substring(0,c)+" ...":this.value});function s(a,b,c){var d=B(c,b);return a.layout=d?"horizontal":"vertical",a.align=d?"center":a.align,a.verticalAlign=d?"top":a.verticalAlign,a.floating=!1,a.maxHeight=250,a}function t(a){return{
enabled:a.enable3d,alpha:"pie"===a.chartType||"donut"===a.chartType?40:4,beta:2,depth:50}}e.prototype.enable3D=function(){var a=this.options.chart.options3d.enabled;this.options.chart.options3d.enabled=!!this.chartUtil.allow3d(this.config.chartType)&&a,this.config.enable3d&&this.config.showScrollBar&&(this.options.chart.zoomType="",this.options.chart.panning=!1)};function u(a,b){var c=[a.chartUtil.CHART_TYPE_COLUMN,a.chartUtil.CHART_TYPE_STACKED_COLUMN,a.chartUtil.CHART_TYPE_BAR,a.chartUtil.CHART_TYPE_STACKED_BAR,a.chartUtil.CHART_TYPE_LINE,a.chartUtil.CHART_TYPE_AREA,a.chartUtil.CHART_TYPE_STACKED_AREA];return!!a.config.showScrollBar&&(!a.config.polar&&c.indexOf(a.chartData[b].type)!==-1)}function v(a){return a=Number(a),isNaN(a)?"":a-1}e.prototype.formatScrollBar=function(a){u(this,a)&&(this.options.scrollbar.enabled=!0,this.options.xAxis.max=v(this.config.scrollMaximum))},e.prototype.formatStacked=function(a){w(this,a),x(this,a),y(this,a),z(this,a),A(this,a)};function w(a,b){
a.chartData[b].type===a.chartUtil.CHART_TYPE_BAR&&a.config.stacked&&(a.options.plotOptions.bar.stacking="normal",a.options.tooltip.shared=a.config.stackToolTips,a.options.tooltip.pointFormat=a.config.pointFormat||'<span style="color:{series.color}">{series.name}</span>: <b>{point.y:g2}</b><br/>')}function x(a,b){a.chartData[b].type===a.chartUtil.CHART_TYPE_COLUMN&&a.config.stacked&&(a.options.plotOptions.column.stacking=a.config.percentStacked?"percent":"normal",a.options.tooltip.shared=a.config.stackToolTips,a.config.percentStacked?a.options.tooltip.pointFormat=a.config.pointFormat||'<span style="color:{series.color}">{series.name}</span>: <b>{point.y:g2}</b> ({point.percentage:n0}%)<br/>':a.options.tooltip.pointFormat=a.config.pointFormat||'<span style="color:{series.color}">{series.name}</span>: <b>{point.y:g2}</b><br/>')}function y(a,b){a.chartData[b].type===a.chartUtil.CHART_TYPE_AREA&&a.config.stacked&&(a.options.plotOptions.area.stacking="normal",
a.options.tooltip.shared=a.config.stackToolTips,a.options.tooltip.pointFormat=a.config.pointFormat||'<span style="color:{series.color}">{series.name}</span>: <b>{point.y:g2}</b><br/>')}function z(a,b){a.chartData[b].type===a.chartUtil.CHART_TYPE_DONUT&&(a.chartData[b].type=a.chartUtil.CHART_TYPE_PIE,a.chartData[b].innerSize="60%")}function A(a,b){a.config.percentStacked&&a.chartData[b].type!==a.chartUtil.CHART_TYPE_COLUMN&&(a.config.percentStacked=!1)}function B(a,b){var c=[b.CHART_TYPE_PIE,b.CHART_TYPE_DONUT,b.CHART_TYPE_PYRAMID];return d.any(d.equals(a.chartType),c)}return e});
define('spa/react/react-view-model',["require","exports","react","react-dom","system/lang/object","system/lang/private"],function(require,exports,a,b,c,d){"use strict";var e=function(a){return function(b){a[b]=a[b].bind(a)}},f=function(a){return function(b){var c=a[b];a[b]=function(){c.apply(a,arguments),a.updateView()}}};return function(){function g(a){d(this).view=a,d(this).mountNode=null,d(this).afterViewUpdate=null}return g.prototype.bindMethods=function(a){a.forEach(e(this))},g.prototype.updateViewAfter=function(a){a.forEach(f(this))},g.prototype.attach=function(a){c.tryMethod(this,"beforeAttach",a),a.attach(document.createElement("div")),d(this).mountNode=a.activeContainer,d(this).afterViewUpdate=this.afterViewUpdate.bind(this),this.updateView(),c.tryMethod(this,"afterAttach",a)},g.prototype.updateView=function(){var c=d(this).mountNode;if(c){var e=a.createElement(d(this).view,{vm:this}),f=d(this).afterViewUpdate;b.render(e,c,f)}},g.prototype.afterViewUpdate=function(){},g.prototype.detach=function(a){
c.tryMethod(this,"beforeDetach",a),b.unmountComponentAtNode(d(this).mountNode),d(this).afterViewUpdate=null,d(this).mountNode=null,c.tryMethod(this,"afterDetach",a)},g}()});
define('ui/elements/chart/views/point-detail-view',["require","exports","react"],function(require,exports,a){"use strict";var b=a.DOM,c=b.div,d=b.i,e=b.a;function f(a){var b=[];return a.vm.queryValues.forEach(function(a){b.push(c({className:"detail"},g(a)))}),c.apply(void 0,[{className:"form-group"},j(a.vm)].concat(b))}exports.PointDetailView=f;function g(a){return c({className:"row-wrapper"},h(a),i(a))}function h(a){return c({className:"row-name"},a.columnName.toString())}function i(a){return a.hyperlink?e({className:"row-value",href:a.hyperlink.toString()},a.rowValue.toString()):c({className:"row-value"},a.rowValue.toString())}function j(a){return d({className:"icon-close-popup",onClick:a.detach})}});
define('ui/elements/chart/view-models/point-detail-view-model',["require","exports","spa/react/react-view-model","ui/elements/chart/views/point-detail-view"],function(require,exports,a,b){"use strict";return function(a){__extends(c,a);function c(c){var d=a.call(this,b.PointDetailView)||this;return d.queryValues=c,d.region=null,d.updateViewAfter(["attach","detach"]),d}return c.prototype.attach=function(b){this.region=b,a.prototype.attach.call(this,b)},c.prototype.detach=function(){this.region&&this.region.element&&this.region.element.style&&(this.region.element.style.display="none"),a.prototype.detach.call(this,this.region),this.queryValues=null,this.region=null},c}(a)});
define('ui/elements/chart/models/time-series-chart',["require","exports","ui/elements/chart/models/base-chart","system/text/parser","ui/elements/chart/view-models/point-detail-view-model","spa/region","ramda","jquery","ui/elements/chart/chart-utilities"],function(require,exports,a,b,c,d,e,f){"use strict";var g=require("ui/elements/chart/chart-utilities"),h=e.curry(function a(b,e){if(b.renderTo.parentElement){var g=b.renderTo.parentElement.querySelector(".chart-detail-view");if(g){var h=new c(this.queryValues);g.style.display="block",h.attach(new d(f(g)))}}});return function(a){__extends(c,a);function c(b,c,d){var f=a.call(this,b,c,d)||this;return f.renderTo=b,f.truncateCat=e.curry(function a(b){var c=10,d=(this.value||"").toString();return d.length>c&&b.truncateLabels?d.substring(0,c)+" ...":this.value}),f}return c.prototype.configureOptions=function(){this.options.legend=this.formatBaseChartLegend(this.options.legend),this.options.plotOptions.column=this.barAndColumnConfiguration(),
this.options.plotOptions.bar=this.barAndColumnConfiguration(),this.options.xAxis.categories=this.convertCategoryArray(this.categoryArray),this.options.xAxis.labels.formatter=e.partial(this.truncateCat,[this.config]),this.options.plotOptions.series.colorByPoint=!0,this.options.plotOptions.series.point.events.click=h(this),this.options.xAxis.labels.step=this.config.xAxisStep||1},c.prototype.setYAxis=function(a){this.options.yAxis[this.options.yAxis.length]={type:this.calculateChartType(this.config.axis[a]),title:{text:this.config.axis[a].caption||this.config.axis[a].name},lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",labels:{enabled:!1},minorTickLength:0,tickLength:0}},c.prototype.formatChartData=function(){var b,c=(this.chartData||{}).length||-1;for(b=0;b<c;b++)this.convertPointValues(this.chartData[b].data);a.prototype.formatChartData.call(this)},c.prototype.barAndColumnConfiguration=function(){return{borderWidth:0,pointPadding:-1,animation:!1}},
c.prototype.convertPointValues=function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.x?c.x=this.getPointValue(c.x):""===c.x&&(c.x=null),c.z?c.z=this.getPointValue(c.z):""===c.z&&(c.z=null),c.y=100},c.prototype.getPointValue=function(a){var c=g.extractHyperlinkValue(a),d=b.parseFloat(c);return e.is(Date,c)?c:void 0!==d&&null!==d?isNaN(d)?null:Number(d):null},c.prototype.convertCategoryArray=function(a){var b,c=(a||{}).length;for(b=0;b<c;b++)a[b]=g.extractHyperlinkValue(a[b]);return a},c.prototype.formatBaseChartLegend=function(a){return a.layout="vertical",a.align="right",a.verticalAlign="top",a.floating=!1,a.maxHeight=250,a},c}(a)});
define('ui/elements/chart/models/stock-chart',['require','lodash','application/application-context','ui/elements/chart/models/base-chart','ui/elements/chart/chart-utilities','application/application-events','system/globalization/translator'],function(require){"use strict";var a=require("lodash"),b=require("application/application-context"),c=require("ui/elements/chart/models/base-chart"),d=require("ui/elements/chart/chart-utilities"),e=require("application/application-events"),f=require("system/globalization/translator"),g="%m/%d/%Y %H:%M",h=!1,i=!1;function j(a,b,c){k.call(this,a,b,c)}var k=Object.inherit(c,j);j.prototype.configureOptions=function(a){k.prototype.configureOptions.call(this,a);var c=b.user.formats.shortDate.toLowerCase().charAt(0);return"d"===c&&(g="%d/%m/%Y %H:%M",h=!0),"y"===c&&(g="%Y/%m/%d %H:%M",i=!0),this.translator=Object.resolve(f),this.options.rangeSelector=l(this),this.options.xAxis.ordinal=!1,this.options.xAxis.plotBands=[],this.options.tooltip.xDateFormat=g,this.options.plotOptions.series.point.events.click=n.bind(null,this),this.options.plotOptions.series.dataGrouping={enabled:!1},this.options};function l(a){return{buttons:[{type:"day",count:2,
text:a.translator.translate("STOCK_CHARTS_2D")},{type:"day",count:10,text:a.translator.translate("STOCK_CHARTS_10D")},{type:"month",count:1,text:a.translator.translate("STOCK_CHARTS_1M")},{type:"year",count:1,text:a.translator.translate("STOCK_CHARTS_1Y")},{type:"year",count:3,text:a.translator.translate("STOCK_CHARTS_3Y")},{type:"all",text:a.translator.translate("STOCK_CHARTS_MAX")}],inputEnabled:!0,selected:0,inputDateFormat:g,inputEditDateFormat:g,inputDateParser:m,inputBoxWidth:120}}function m(a){return a=a.split(/[ :\.\/]/),h?new Date(parseInt(a[2]),parseInt(a[1])-1,parseInt(a[0]),parseInt(a[3],10),parseInt(a[4],10)).getTime():i?new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]),parseInt(a[3],10),parseInt(a[4],10)).getTime():new Date(parseInt(a[2]),parseInt(a[0])-1,parseInt(a[1]),parseInt(a[3],10),parseInt(a[4],10)).getTime()}j.prototype.formatChartData=function(){var a,b=(this.chartData||{}).length;for(a=0;a<b;a++)o(this),
this.config.stock&&this.config.stock===!0&&(this.chartData[a].data.sort(q),p(this.chartData[a]),this.chartData[a].threshold=null,this.chartData[a].tooltip={},this.chartData[a].tooltip.valueDecimals=2);k.prototype.formatChartData.call(this)};function n(a,b){var c;if(b&&(c=d.closestByNodeName(b.target,"MI-DASHBOARD")),b.currentTarget){var f=b.currentTarget.url,g=!0;f&&""!==f&&(f.indexOf("graph")>-1&&(g=!1),c&&(g=!0),Object.resolve(e).navigate.raise(f,{tab:g}))}}function o(b,c){a.has(b.config.series[c],"hyperlink")&&"None"!==b.config.series[c].hyperlink&&(b.chartData[c].cursor="pointer")}function p(a){"stock"===a.type?a.type="line":"stock-area"===a.type&&(a.type="area",a.fillColor={},a.fillColor.linearGradient={},a.fillColor.linearGradient.x1=0,a.fillColor.linearGradient.y1=0,a.fillColor.linearGradient.x2=0,a.fillColor.linearGradient.y2=1,a.fillColor.stops=[[0,a.color],[1,window.Highcharts.Color(a.color).setOpacity(0).get("rgba")]])}function q(a,b){
return a instanceof Array&&b instanceof Array?a[0]-b[0]:a.x-b.x}return j.prototype.formatStacked=function(a){this.config.stock&&this.chartData[a].type===this.chartUtil.CHART_TYPE_STOCK_STACKED_AREA&&(this.chartData[a].type=this.chartUtil.CHART_TYPE_AREA_SPLINE,this.options.plotOptions.areaspline.stacking="normal",this.options.tooltip.pointFormat='<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b><br/>')},j});
define('ui/elements/chart/models/heat-map-chart',['require','ui/elements/chart/models/base-chart','ui/elements/chart/chart-utilities','application/application-events','ui/elements/chart/formatters/chart-formatter-factory','ramda'],function(require){"use strict";var a=require("ui/elements/chart/models/base-chart"),b=require("ui/elements/chart/chart-utilities"),c=require("application/application-events"),d=require("ui/elements/chart/formatters/chart-formatter-factory"),e=require("ramda");function f(a,b,c){g.call(this,a,b,c),this.chartFormatter=d.create(this.config)}var g=Object.inherit(a,f);f.prototype.configureOptions=function(){var a=[];return g.prototype.configureOptions.call(this),this.options.chart.type="heatmap",this.options.chart.inverted=this.config.heatmap.inverted,this.options.plotOptions.series.point.events.click=i.bind(null,this),this.options.plotOptions.series.point.events.mouseOver=k.bind(null,this),this.options.xAxis.categories=l(this.categoryArray),this.options.xAxis.labels.formatter=e.partial(j,[this.config]),this.options.tooltip.formatter=this.chartFormatter.formatTooltip(this),this.options.plotOptions.series.dataLabels={enabled:!0,
pointFormat:this.config.heatmap.pointFormat||"{point.value:g2}",formatter:this.chartFormatter.formatDataLabels(this)},this.options.plotOptions.heatmap={dataLabels:{},states:{hover:{}}},this.options.plotOptions.heatmap.dataLabels={enabled:!0,color:this.config.heatmap.labelColor?this.config.heatmap.labelColor:"#000000"},this.config.heatmap.hoverColor||(this.config.heatmap.hoverColor=window.Highcharts.getOptions().colors[0]),this.options.plotOptions.heatmap.states.hover.color=this.config.heatmap.hoverColor,this.options.plotOptions.heatmap.borderWidth=this.config.heatmap.borderWidth,this.config.heatmap.borderColor||(this.config.heatmap.borderColor=window.Highcharts.getOptions().colors[0]),this.options.plotOptions.heatmap.borderColor=this.config.heatmap.borderColor,this.options.yAxis={categories:this.config.heatmap.yAxis,title:null},this.config.heatmap.minColor||(this.config.heatmap.minColor="#FFFFFF"),
this.config.heatmap.maxColor||(this.config.heatmap.maxColor=window.Highcharts.getOptions().colors[0]),this.options.colorAxis={min:Number(this.config.heatmap.minValue),minColor:this.config.heatmap.minColor,maxColor:this.config.heatmap.maxColor},this.config.heatmap.maxValue&&(this.options.colorAxis.max=Number(this.config.heatmap.maxValue)),this.config.heatmap.maxValue||(this.options.colorAxis.tickPositions=this.config.heatmap.steps?h(this.config.heatmap.steps.split(",")):h()),this.config.heatmap.specifyColors&&this.config.heatmap.colorSeries.length>0&&(a[0]={data:this.config.heatmap.colorSeries},this.chartData=a),this.options};function h(a){var b=[],c=10,d;if(void 0===a)for(d=0;d<100;d++)d%c==0&&b.push(d);else for(d=0;d<a.length;d++)b.push(Number(a[d]));return b}function i(a,d){var e,f,g,h,i,j=a.config.heatmap.hyperlinks,k=a.config.heatmap.specifyColors;d&&(e=d.currentTarget.series._i,h=d.currentTarget.graphic.element,i=b.closestByNodeName(h,"MI-DASHBOARD")),
a.chartData[e]&&a.chartData[e].urls&&j&&!k?(f=a.chartData[e].urls[d.currentTarget.index],g=!0,f&&""!==f&&(g=f.indexOf("graph")<=-1,i&&(g=!0),Object.resolve(c).navigate.raise(f,{tab:g}))):j&&k&&(g=!0,d.currentTarget.options&&d.currentTarget.options.url&&(f=d.currentTarget.options.url),f&&(g=f.indexOf("graph")<=-1,i&&(g=!0),Object.resolve(c).navigate.raise(f,{tab:g})))}var j=e.curry(function a(b){var c=10,d=(this.value||"").toString();return d.length>c&&b.truncateLabels?d.substring(0,c)+" ...":this.value});function k(a,b){var c,d,e=a.config.heatmap.hyperlinks,f=a.config.heatmap.specifyColors;b&&(c=b.currentTarget.series._i),a.chartData[c]&&a.chartData[c].urls&&e&&!f?(d=a.chartData[c].urls[b.currentTarget.index])&&""!==d&&(b.currentTarget.graphic.element.style.cursor="pointer"):e&&f&&(b.currentTarget.options&&b.currentTarget.options.url&&(d=b.currentTarget.options.url),d&&""!==d&&(b.currentTarget.graphic.element.style.cursor="pointer"))}function l(a){
for(var c=0;c<a.length;c++)a[c]=b.extractHyperlinkValue(a[c]);return a}return f});
define('ui/elements/chart/models/chart-options-factory',['require','ui/elements/chart/models/standard-chart','ui/elements/chart/models/time-series-chart','ui/elements/chart/models/stock-chart','ui/elements/chart/models/heat-map-chart'],function(require){"use strict";var a=require("ui/elements/chart/models/standard-chart"),b=require("ui/elements/chart/models/time-series-chart"),c=require("ui/elements/chart/models/stock-chart"),d=require("ui/elements/chart/models/heat-map-chart");function e(){}return e.create=function(e,f,g){return f&&f.stock===!0?new c(e,f,g):f&&f.heatmap.enabled===!0?new d(e,f,g):f&&"timeSeries"===f.chartType?new b(e,f,g):f?new a(e,f,g):void 0},e});
define('dcm/models/system-table-model',['require','knockout','system/lang/converter','kobindings','knockoutvalidation','knockouteditables','system/globalization/translator'],function(require){"use strict";var a=require("knockout"),b=require("system/lang/converter");require("kobindings"),require("knockoutvalidation"),require("knockouteditables");var c=require("system/globalization/translator"),d=Object.resolve(c);function e(c,e){var f=this,g=c||{};this.caption=a.observable(g.caption||""),this.description=g.description||"",this.descriptionForValidation=a.observable(g.description||"").extend({required:{message:d.translate("SYS_TBL_DESC_REQ")}}),this.displayformat=a.observable(g.displayformat||0),this.updatedDate=a.observable(b.toNullableDate(g.lastUpdatedDate)),this.updatedUserId=a.observable(g.lastUpdatedUserId||0),this.id=g.id||"",this.idForValidation=a.observable(g.id||"").extend({required:{message:d.translate("SYS_TBL_ID_REQ")}}),this.key=g.key||0,this.displaytext=a.computed(function(){return f.id+" ("+f.description+")"}),this.listText=f.id+"("+f.description+")",this.isChecked=a.observable(!1),this.systemCodes=a.observableArray([]),
e&&(a.editable(this),this.beginEdit())}return e});
define('dcm/services/system-codes-and-tables-service',['require','jquery','lodash','system/http/ajax-client','dcm/models/system-table-model','system/lang/object'],function(require){"use strict";var a=require("jquery"),b=require("lodash"),c=require("system/http/ajax-client"),d=require("dcm/models/system-table-model"),e="api/core/security/user/",f="api/core/systemcode/";require("system/lang/object");function g(a){this.ajaxClient=a}return g.dependsOn=[c],g.prototype.getAllSystemTables=function(){var b=this,c=a.Deferred();return b.ajaxClient.get(f+"table").done(function(b){b.sort(function(a,b){return String.compare(a.id,b.id)}),a.each(b,function(a,b){b.displaytext=b.id+" ("+b.caption+")"}),c.resolve(b)}).fail(function(a){c.reject(a)}),c.promise()},g.prototype.getSystemCodes=function(b){var c=this,d=a.Deferred();return c.ajaxClient.get(f+"code/table?tableId="+b).done(function(a){a.sort(function(a,b){return String.compare(a.description,b.description)}),d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},g.prototype.getFilteredTablesAndCodes=function(b){var c=this,d=a.Deferred()
;return c.ajaxClient.get(f+"code/filteredcodes?term="+b).done(function(a){a.sort(function(a,b){return String.compare(a.description,b.description)}),d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},g.prototype.createTableItem=function(b){var c=a.Deferred();return this.ajaxClient.post(f+"table",b).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()},g.prototype.updateTableItem=function(b){var c=a.Deferred();return this.ajaxClient.put(f+"table",b).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()},g.prototype.deleteTableItem=function(b){var c=a.Deferred();return this.ajaxClient.delete(f+"table/"+b).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()},g.prototype.updateCode=function(b){var c=a.Deferred();return this.ajaxClient.put(f+"code",b).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()},g.prototype.createCode=function(b){var c=a.Deferred()
;return this.ajaxClient.post(f+"code",b).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()},g.prototype.deleteCode=function(b){var c=a.Deferred();return this.ajaxClient.delete(f+"code/"+b).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()},g.prototype.changeCodeSequence=function(b,c){var d=this,e=a.Deferred();return d.ajaxClient.put(f+"code/sequence/"+b,c).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},g.prototype.getReferenceCodes=function(b){var c=this,d=a.Deferred();return c.ajaxClient.get(f+"referencecode/"+b).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},g.prototype.createRefCode=function(b,c){var d=this,e=a.Deferred();return d.ajaxClient.post(f+"referencecode/"+b+"/"+c).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},g.prototype.createRefCodes=function(c,d){var e=this,g=[];b.each(d,function(a,b){g.push(b.key)}.bind(null,c));var h=a.Deferred()
;return e.ajaxClient.post(f+"referencecodes/"+c+"?refKeys="+g).done(function(a){h.resolve(a)}).fail(function(a){h.reject(a)}),h.promise()},g.prototype.deleteRefCode=function(b,c){var d=this,e=a.Deferred();return d.ajaxClient.delete(f+"referencecode/"+b+"/"+c).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},g.prototype.getUserInformation=function(a){return this.ajaxClient.get(e+a)},g});
define('dcm/services/state-configuration-service',['require','jquery','system/http/ajax-client','system/lang/object'],function(require){"use strict";var a=require("jquery"),b=require("system/http/ajax-client"),c="api/core/statemachine/",d="api/core/statemachine/save/",e="api/core/statemachine/enable/",f="api/core/statemachine/disable/";require("system/lang/object");function g(a){this.ajaxClient=a}return g.dependsOn=[b],g.prototype.getStateConfigData=function(b){var d=this,e=a.Deferred();return d.ajaxClient.get(c+b).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},g.prototype.getStateConfigDataWithFamilyId=function(b){var d=this,e=a.Deferred();return d.ajaxClient.get(c+b).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},g.prototype.saveStateConfigData=function(b,c){var e=this,f=a.Deferred(),g=d+c,h=b;return e.ajaxClient.post(g,h).done(function(a){f.resolve(a)}).fail(function(a){f.reject(a)}),f.promise()},g.prototype.disableStateConfigForFamily=function(b){var c=this,d=a.Deferred(),e=f+b;return c.ajaxClient.post(e).done(function(a){
d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},g.prototype.enableStateConfigForFamily=function(b,c,d){var f=this,g=a.Deferred(),h=e+b+"/"+c+"/"+d;return f.ajaxClient.post(h).done(function(a){g.resolve(a)}).fail(function(a){g.reject(a)}),g.promise()},g.prototype.getRoles=function(){var b=a.Deferred();return this.ajaxClient.get("api/core/security/roles").done(function(a){b.resolve(a)}).fail(function(a){b.reject(a)}),b.promise()},g});
define('ui/elements/chart/models/process-standard-chart',['require','ramda','ui/elements/chart/chart-utilities','system/text/parser','application/application-context'],function(require){"use strict";var a=require("ramda"),b=require("ui/elements/chart/chart-utilities"),c=require("system/text/parser"),d=require("application/application-context");function e(){}e.processData=function(a,c,d,e,g,h,i,j){var k,l,m,n,o,p,q,r,s={},t=c.chartData,u=c.categoryArray;for(k=0;k<e.length;k++){if(l=b.getRowValueFromQuery(g,e,k),r=b.getRowValueFromQuery(g,i,0),o=b.getFormattedValueFromQuery(d,g,e,k),n=b.extractHyperlinkHref(g,h,k),q=b.extractHyperlinkHref(g,e,k),m=a.chartUtilities.translateChartType(d.series[k].chartType),p=b.extractHyperlinkHref(g,i,0),s[d.categoryProperty]=b.getFormattedValueFromQuery(d,g,i,0),s[d.categoryProperty]=b.formatHyperlink(s[d.categoryProperty],p),"stock"===m||"stock-area"===m||"stacked-stock"===m)f(d,u,r,t,n,o,m,l,k);else{var v={y:l,url:n?n:""};o&&(v.y=b.setYValueFromFormatted(l,o),v.formattedValue=o),t[k]?t[k].data[t[k].data.length]=v:t[k]={type:m,data:[v],name:b.extractChartName(d,j,e,k),color:d.series[k].color,
yAxis:d.series[k].yAxis}}s[b.extractChartName(d,j,e,k)]=b.formatHyperlink(o,q)}c.gridData.data[c.gridData.data.length]=s};function f(a,b,c,d,e,f,i,j,k){void 0!==b[b.length-1]&&""!==b[b.length-1]&&null!==b[b.length-1]&&(d[k]?d[k].data[d[k].data.length]={x:h(c),y:Number(g(j)),formattedValue:f?f:"",url:e?e:""}:d[k]={type:i,data:[{x:h(c),y:Number(g(j)),formattedValue:f?f:"",url:e?e:""}],name:a.series[k].name,color:a.series[k].color,yAxis:a.series[k].yAxis})}function g(a){var b=c.parseFloat(a);return isNaN(b)?null:Number(b)}function h(a){return Date.parse(a)}return e});
define('ui/elements/chart/models/process-time-series-chart',["require","exports","ramda","ui/elements/chart/chart-utilities"],function(require,exports,a){"use strict";var b=require("ui/elements/chart/chart-utilities"),c="Color",d=function(){function a(){}return a.processData=function(a,d,g,h,i,j,k){var l,m,n,o,p,q,r,s,t={},u=d.chartData,v=f(c,d.rawData.getColumns()),w=v?b.getRowValueFromQuery(i,[v],0):null,x=[];for(d.rawData.getColumns().forEach(e.bind(null,x,i)),l=0;l<h.length;l++){m=b.getRowValueFromQuery(i,h,l),s=b.getRowValueFromQuery(i,k,0),p=b.getFormattedValueFromQuery(g,i,h,l),o=b.extractHyperlinkHref(i,j,l),r=b.extractHyperlinkHref(i,h,l),n=a.chartUtilities.translateChartType(g.series[l].chartType),q=b.extractHyperlinkHref(i,k,0),t[g.categoryProperty]=b.getFormattedValueFromQuery(g,i,k,0),t[g.categoryProperty]=b.formatHyperlink(t[g.categoryProperty],q);var y={y:m,url:o?o:"",formattedValue:null,color:w,queryValues:x};p&&(y.formattedValue=p),u[l]?u[l].data[u[l].data.length]=y:u[l]={type:n,data:[y],name:g.series[l].name,color:w,
yAxis:g.series[l].yAxis},t[g.series[l].name]=b.formatHyperlink(p,r)}d.gridData.data[d.gridData.data.length]=t},a}();function e(a,c,d,e){var f=d.getLocalizedAlias()||d.getAlias()||d.getCaption()||d.getDefaultCaption(),g=b.getRowValueFromQuery(c,[e],0),h=b.extractHyperlinkHref(c,[e],0);a.push({columnName:f,rowValue:g,hyperlink:h})}function f(b,c){return a.findIndex(function(a){return!!a&&a.getAlias()===b},c)}return d});
define('ui/elements/chart/models/process-pie-chart',['require','jquery','ramda','lodash','ui/elements/chart/chart-utilities','system/text/parser'],function(require){"use strict";var a=require("jquery"),b=require("ramda"),c=require("lodash"),d=require("ui/elements/chart/chart-utilities"),e=require("system/text/parser");function f(){}f.processData=function(a,c,f,h,i,j,k,l){var m,n,o,p,r,s,t,u=f.pieSeries,x={},A=c.chartData,B=c.rawData.getRows();for(m=0;m<h.length;m++){if(n=d.getRowValueFromQuery(i,h,m),s=d.getFormattedValueFromQuery(f,i,h,m),p=d.extractHyperlinkHref(i,h,m),r=s?s:e.parseFloat(n),o=a.chartUtilities.translateChartType(f.series[m].chartType),t=d.extractHyperlinkHref(i,[l],0),x[f.categoryProperty]=d.getFormattedValueFromQuery(f,i,[l],0),x[f.categoryProperty]=d.formatHyperlink(x[f.categoryProperty],t),0===A.length&&(A[0]={data:[],type:o}),f.pieSeries.length>0&&(0===k.length&&(g(f.pieSeries,k),w(a,f,j)),f.pieSeriesAltered===!1?f.pieSeries=[]:a.resetPieSeries&&(u=q(a,f,B,l,h),a.resetPieSeries=!1)),f.pieSeriesAltered===!1){var C=b.and(f.pieSeriesAllHyperlinksChecked,z(p));A[0].data[A[0].data.length]={
name:"string"==typeof d.getRowValueFromQuery(i,[l],0)?d.getRowValueFromQuery(i,[l],0):a.translator.translate("SLICE"),y:y(n),url:C?p:"",color:v(a,j),hyperlink:p?p:"",used:!1,checked:C},s&&(A[0].data[A[0].data.length-1].formattedValue=s)}x[f.series[m].name]=d.formatHyperlink(s,p)}c.gridData.data[c.gridData.data.length]=x};function g(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=d.name,f=!0,g;for(g=0;g<b.length;g++)b[g].name&&b[g].name===e.toString()&&(b[g].colors.push(d.color),f=!1);f&&(b[b.length]={name:e.toString(),colorUsed:0,catUsed:!1,colors:[d.color]})}}var h=b.addIndex(b.forEach),i=b.curry(function a(c,d,e,f){c=j(c,d,f),b.forEach(k(c,d),c.rawData)});function j(a,b,c){return a.sliceIndex=c,b.categoryStatemachineFmlyId||b.categorySystemCodeTableId?a.hasCat=o(a.rawData,"getValue"):a.hasCat=o(a.rawData,"getDbValue"),a}var k=b.curry(function a(b,c,d){b.found=!1,h(l(b,d,c),c.pieSeries)}),l=b.curry(function(a,c,f,g,h){
var i=d.getRowValueFromQuery(c,a.sliceIndexes,a.sliceIndex),j=d.getFormattedValueFromQuery(f,c,a.sliceIndexes,a.sliceIndex),k=d.getRowValueFromQuery(c,[a.categoryIndex],0),l="string"!=typeof k,o=l?k:a.sliceName,p;if(!(g=m(g,f,l,o,k))||g.name!==o||g.used||a.found){if(g&&!(p=n(f)?a.hasCat(g.originalName):a.hasCat(g.name))&&g.name!==a.sliceName){var q=b.findIndex(b.propEq("name",g.name),a.config.pieSeries);q!==-1&&a.config.pieSeries.splice(q,1)}}else{var r=b.find(b.propEq("name",g.name),a.config.pieSeries);r.y=y(e.parseFloat(d.extractHyperlinkValue(i))),r.found=!0,r.used=!0,j&&(r.formattedValue=j)}});function m(a,b,d,e,f){return a&&!c.has(a,"used")&&(a.used=!1),a&&d&&a.name!==e&&(a.name=e),b.pieSeriesAllHyperlinksChecked&&""!==a.hyperlink&&(a.url=a.hyperlink,a.checked=!0),n(b)&&(a.originalName=f),a}function n(a){return a.categoryStatemachineFmlyId||a.categorySystemCodeTableId}var o=b.curry(function a(c,d,e){
return b.compose(b.any(b.equals(e)),b.flatten,b.map(b.invoker(0,d)),b.flatten,b.map(b.invoker(0,"getCells")))(c)});function p(a){a.used=!1}function q(c,d,e,f,g){var j=a.extend(!0,{},d),k={sliceName:c.translator.translate("SLICE"),config:j,rawData:e,categoryIndex:f,sliceIndexes:g,sliceIndex:null,found:!1,hasCat:null};return b.forEach(p,k.config.pieSeries),b.forEach(p,d.pieSeries),h(i(k,d),g),d.pieSeries=k.config.pieSeries,d.pieSeries}f.setColorValues=function(a,b,c,e,f,g){var h,i,j,k=c.categoryArray,l=c.rawData.getRows();for(b.pieSeriesAltered===!1&&(b.pieSeries=0===c.chartData.length?[]:c.chartData[0].data),j=0;j<l.length;j++)for(i="string"==typeof d.getRowValueFromQuery(l[j],g,0)?d.getRowValueFromQuery(l[j],g,0):a.translator.translate("SLICE"),c.categoryArray[c.categoryArray.length]=r(a,i),h=0;h<f.length;h++)u(b.pieSeries,k,e)};function r(a,b){var d;return a.customCaptions.length>0?a.customCaptionSysCodeTable?(d=c.find(a.customCaptions,t.bind(null,b)),
d?d.caption:b):a.customCaptionStateMachine?(d=c.find(a.customCaptions,s.bind(null,b)),d?d.caption:b):void 0:b}function s(a,b){return b.defaultCaption===a||b.id===a}function t(a,b){return b.value===a||b.defaultDescription===a}function u(a,b,c){for(var d=0;d<a.length;d++){var e,f=a[d],g=f.name,h=b[b.length-1];if(g===h)for(e=0;e<c.length;e++){var i=c[e].name,j=c[e].catUsed;i!==h||j||(f.color=c[e].colors[c[e].colorUsed],c[e].colorUsed++,1===c.length&&c[e].colorUsed===a.length?c[e].catUsed=!0:c[e].colorUsed===c[e].colors.length?c[e].catUsed=!0:1===c[e].colors.length&&(c[e].catUsed=!0))}}}function v(a,b){var c;return 0===b.length&&b.push.apply(b,a.chartUtilities.CHART_COLORS),b.length>0&&(c=b[0],b.shift()),c}function w(a,b,c){var d,e=[];for(d=0;d<b.pieSeries.length;d++)e.push(b.pieSeries[d].color);if(e.length>0&&a.outOfPieColors===!1){for(d=0;d<e.length;d++)x(c,e[d]);0===c.length&&(a.outOfPieColors=!0)}0===c.length&&c.push.apply(c,a.chartUtilities.CHART_COLORS),c.length>0&&c.shift()}
function x(a,b){var c;for(c=0;c<a.length;c++)a[c]===b&&a.splice(c,1)}function y(a){return c.isNaN(Number(a))?0:null!==a?a:0}var z=b.compose(b.not,b.isEmpty);return f});
define('ui/elements/chart/models/process-scatter-chart',['require','ui/elements/chart/chart-utilities'],function(require){"use strict";var a=require("ui/elements/chart/chart-utilities");function b(){}b.processData=function(b,d,e,f,g,h,i,j,k,l){var m={},n,o={},p,q,r,s,t,u=a.getFormattedValueFromQuery(e,j,f,0),v=a.getRowValueFromQuery(j,h,0),w=i?a.getRowValueFromQuery(j,i,0):null;n=c(g,d.chartData),p=a.extractHyperlinkHref(j,k,0),q=a.extractHyperlinkHref(j,l,0),r=a.extractHyperlinkHref(j,h,0),s=a.extractHyperlinkHref(j,f,0),t=i?a.extractHyperlinkHref(j,i,0):null,void 0===n&&(n=d.chartData.length,d.chartData[n]={type:e.chartType,data:[],name:a.getFormattedValueFromQuery(e,j,[l],0),color:e.series[0].color,yAxis:e.series[0].yAxis}),m.y=u,m.x=v,i&&(m.z=w),m.url=p?p:"",m.formattedYValue=a.getFormattedValueFromQuery(e,j,f,0),h&&(m.formattedXValue=a.getFormattedValueFromQuery(e,j,h,0)),i&&(m.formattedZValue=a.getFormattedValueFromQuery(e,j,i,0)),d.chartData[n].data[d.chartData[n].data.length]=m,o[e.categoryProperty]=a.getFormattedValueFromQuery(e,j,[l],0),
o[e.categoryProperty]=a.formatHyperlink(o[e.categoryProperty],q),o[e.series[0].name]=a.formatHyperlink(m.formattedYValue,s),o[e.horizontalAxisProperty]=a.formatHyperlink(m.formattedXValue,r),i&&(o[e.sizeProperty]=a.formatHyperlink(m.formattedZValue,t)),d.gridData.data[d.gridData.data.length]=o};function c(a,b){var c,d;if(b.length>0)for(d=0;d<b.length;d++)if(b[d].name===a){c=d;break}return c}return b});
define('ui/elements/chart/models/process-heat-map-chart',['require','lodash','ui/elements/chart/chart-utilities'],function(require){"use strict";var a=require("lodash"),b=require("ui/elements/chart/chart-utilities");function c(){}c.processData=function(c,f,g,h,i,j,k){var l,m,n,o,p,q,r,s,t={},u=f.chartData,v=f.categoryArray;for(l=0;l<v.length;l++)if(0===u.length&&(u[0]={data:[],urls:[],formattedValues:[]}),!e(u[0].data,l))for(m=0;m<h.length;m++)n=b.getRowValueFromQuery(j,h,m),n=a.isNaN(Number(n))?0:Number(n),r=b.getFormattedValueFromQuery(g,j,h,m),p=b.extractHyperlinkHref(j,h,m),o=c.chartUtilities.translateChartType(g.series[m].chartType),s=b.extractHyperlinkHref(j,v,0),t[g.categoryProperty]=b.getFormattedValueFromQuery(g,j,k,0),t[g.categoryProperty]=b.formatHyperlink(t[g.categoryProperty],s),t[g.series[m].name]=b.formatHyperlink(r,p),u[0].data.push([l,m,n]),u[0].urls.push(p),u[0].formattedValues.push(r?r:""),q=d(i,l,m),g.heatmap.colorSeries.push({name:v[l]+" | "+g.heatmap.yAxis[m],x:l,y:m,value:n,color:q,url:p,formattedValue:r});f.gridData.data[f.gridData.data.length]=t};function d(a,b,c){
var d,e;if(a.length>0)for(d=0;d<a.length;d++)a[d]&&a[d].x===b&&a[d].y===c&&(e=a[d].color);return e?e:"#ffffff"}function e(a,b){var c,d=!1;for(c=0;c<a.length;c++)a[c][0]===b&&(d=!0);return d}return c});
define('ui/elements/chart/alternate-caption-manager',["require","exports","system/globalization/translator","../../../dcm/services/system-codes-and-tables-service","../../../dcm/services/state-configuration-service","toastr"],function(require,exports,a){"use strict";var b=require("../../../dcm/services/system-codes-and-tables-service"),c=require("../../../dcm/services/state-configuration-service"),d=require("toastr"),e=Object;return function(){function f(){this.systemCodesAndTablesService=e.resolve(b),this.stateConfigurationService=e.resolve(c),this.translator=e.resolve(a),this.alternateCaptionFamilyId="",this.alternateCaptionType=""}return f.prototype.getAlternateCaptions=function(a,b){
return b.categorySystemCodeTableId?this.systemCodesAndTablesService.getSystemCodes(b.categorySystemCodeTableId).done(this.getSystemCodesDone.bind(null,a)).fail(this.getCaptionsFailed.bind(null,this,a,"SYSTEM_CODE_CAPTION_FAIL")):b.categoryStatemachineFmlyId?this.stateConfigurationService.getStateConfigDataWithFamilyId(b.categoryStatemachineFmlyId).done(this.getStatemachineDone.bind(null,a)).fail(this.getCaptionsFailed.bind(null,this,a,"STATE_MACHINE_CAPTION_FAIL")):a.resolve(),a},f.prototype.getStatemachineDone=function(a,b){a.resolve(b.states)},f.prototype.getSystemCodesDone=function(a,b){a.resolve(b)},f.prototype.getCaptionsFailed=function(a,b,c){d.error(a.translator.translate(c)),b.reject()},f.prototype.altCaptionFamilyIdChanged=function(a){var b=!1;return"state"!==this.alternateCaptionType&&(b=this.alternateCaptionFamilyId===a.categoryStatemachineFmlyId),"systemCode"!==this.alternateCaptionType&&(b=this.alternateCaptionFamilyId===a.categorySystemCodeTableId),b},
f.prototype.setAlternateCaptionFamilyId=function(a){a.categorySystemCodeTableId?this.alternateCaptionFamilyId=a.categorySystemCodeTableId:a.categoryStatemachineFmlyId?this.alternateCaptionFamilyId=a.categoryStatemachineFmlyId:this.alternateCaptionFamilyId=""},f.prototype.setAlternateCaptionType=function(a){a.categorySystemCodeTableId?this.alternateCaptionType="systemCode":a.categoryStatemachineFmlyId?this.alternateCaptionType="state":this.alternateCaptionType=""},f.prototype.hasAlternateCaptions=function(a){return!(!a.categorySystemCodeTableId&&!a.categoryStatemachineFmlyId)},f}()});
define('ui/elements/chart/process-query',['require','jquery','ramda','lodash','query/execution/query-execution-engine','../../../dcm/services/system-codes-and-tables-service','../../../dcm/services/state-configuration-service','ui/elements/chart/chart-utilities','system/error/error-message','system/globalization/translator','application/application-events','system/ui/message-box','ui/elements/chart/models/process-standard-chart','ui/elements/chart/models/process-time-series-chart','ui/elements/chart/models/process-pie-chart','ui/elements/chart/models/process-scatter-chart','ui/elements/chart/models/process-heat-map-chart','ui/elements/chart/alternate-caption-manager'],function(require){"use strict";var a=require("jquery"),b=require("ramda"),c=require("lodash"),d=require("query/execution/query-execution-engine"),e=require("../../../dcm/services/system-codes-and-tables-service"),f=require("../../../dcm/services/state-configuration-service"),g=require("ui/elements/chart/chart-utilities"),h=require("system/error/error-message"),i=require("system/globalization/translator"),j=require("application/application-events"),k=require("system/ui/message-box"),l=require("ui/elements/chart/models/process-standard-chart"),m=require("ui/elements/chart/models/process-time-series-chart"),n=require("ui/elements/chart/models/process-pie-chart"),o=require("ui/elements/chart/models/process-scatter-chart"),p=require("ui/elements/chart/models/process-heat-map-chart"),q=require("ui/elements/chart/alternate-caption-manager");function r(a,b,d){this.queryKey=c.has(a,"queryKey")?a.queryKey:"",this.dataset=c.has(a,"dataset")?a.dataset:"",this.queryEngine=null,
this.queryContainer=null,this.translator=Object.resolve(i),this.errorOccured=Object.resolve(j).errorOccured,this.systemCodesAndTablesService=Object.resolve(e),this.stateConfigurationService=Object.resolve(f),this.deferred=null,this.chartUtilities=new g,this.parameters=b||null,this.missingParams=!0,this.isFiltered=d||!1,this.outOfPieColors=!1,this.resetPieSeries=!0,this.customCaptions=[],this.customCaptionSysCodeTable=!1,this.customCaptionStateMachine=!1,this.alternateCaptionManager=new q}r.prototype.load=function(b){return this.deferred=a.Deferred(),b=b||{},this.dataset?A(this,this.dataset,b):(this.queryKey=b.queryKey||this.queryKey,s(this,b)),this.deferred.promise()};function s(a,b){c.has(a.parameters,"queryString")?(a.queryEngine=Object.resolve(d,{catalogItemKey:a.queryKey}),a.queryEngine.compile().done(t.bind(null,a,b))):t(a,b)}function t(b,e,f){var g={},h={pageSize:-1,sync:!0,startPage:-1},i,j;if(c.has(b.parameters,"queryString"))if(i=f.parmContainer,i.parmDesigns){
for(j=0;j<i.parmDesigns.length;j++)i.parmDesigns[j]=x(b.parameters.queryStrParams,i.parmDesigns[j],j);if(Object.keys(b.parameters.queryStrParams).length<i.parmDesigns.length&&b.missingParams)return void v(b,e,i);b.parameters=i}else b.parameters=null;else b.parameters||(b.parameters=null);if((b.queryKey||b.queryContainer)&&(b.queryContainer?g.queryContainer=b.queryContainer:g.catalogItemKey=b.queryKey,(b.isFiltered||b.parameters)&&(h.suppressPrompts=!0),b.parameters&&(h.parameters=b.parameters),b.queryEngine=new d(g),b.queryEngine.execute(h).done(z.bind(null,b,e)).fail(H.bind(null,b)),e.evalMobile)){var k=new d(g),l=a.extend(!0,{},h);l.evalOnly=!0,l.suppressPrompts=!0,k.execute(l).done(u.bind(null,b)).fail(H.bind(null,b))}}function u(a,b){b.rowCount>500&&k.showOk(a.translator.translate("CHART_MOBILE_WARNING_MSG"),a.translator.translate("WARNING"))}function v(a,b,c){var e=a.parameters.queryStrParams,f={hasDependencies:!1,parmDesigns:[]},g,h=Object.resolve(d,{catalogItemKey:a.queryKey})
;for(g=0;g<c.parmDesigns.length;g++)e[c.parmDesigns[g].id]&&(c.parmDesigns[g]=x(e,c.parmDesigns[g],g)),f.parmDesigns.push(c.parmDesigns[g]);h.prompt({parameters:f}).done(w.bind(null,a,b))}function w(a,b,c){a.missingParams=!1,t(a,b,c)}function x(a,b,c){return y(b.id,a,b),y("p"+c,a,b),b}function y(a,b,c){var d=b[a];d&&(c.parmPrompts=[d])}function z(a,b,c){var d={},e=a.deferred;a.queryContainer=c.queryContainer,b.formattedQuery=c.queryContainer.isFormatted,b.isUomVisible=c.queryContainer.isUomVisible,d.rawData=c.result,P(d,b),a.alternateCaptionManager.hasAlternateCaptions(b)?a.processCategoryCaptions(a,d,b,e):D(a,e,d,b)}function A(a,b,c){var d={};d.rawData=g.formatDataset(b),a.processData(d,c),a.deferred.resolve(d)}r.prototype.processCategoryCaptions=function(a,b,c,d){a.alternateCaptionManager.hasAlternateCaptions(c)?B(a,b,c,d):D(a,d,b,c)};function B(b,c,d,e){var f=a.Deferred();b.alternateCaptionManager.setAlternateCaptionType(d),
b.alternateCaptionManager.altCaptionFamilyIdChanged(d)?b.alternateCaptionManager.getAlternateCaptions(f,d).done(C.bind(null,b,e,c,d)).fail(D.bind(null,b,e,c,d)):(b.alternateCaptionManager.setAlternateCaptionFamilyId(d),b.alternateCaptionManager.setAlternateCaptionType(d),D(b,e,c,d))}function C(a,b,c,d,e){d.categorySystemCodeTableId&&(a.customCaptionSysCodeTable=!0,a.customCaptions=e),d.categoryStatemachineFmlyId&&(a.customCaptionStateMachine=!0,a.customCaptions=e),a.alternateCaptionManager.setAlternateCaptionFamilyId(d),D(a,b,c,d)}function D(a,b,c,d){a.processData(c,d),b.resolve(c)}function E(a,b){return b.defaultCaption===a.name||b.id===a.name}function F(a,b){return b.value===a.name||b.defaultDescription===a.name}function G(a,b){var d;return a.customCaptionSysCodeTable?d=c.find(a.customCaptions,F.bind(null,b)):a.customCaptionStateMachine&&(d=c.find(a.customCaptions,E.bind(null,b))),d&&(b.name=d.caption),b}r.prototype.processData=function(a,b){
var c=a.rawData.getColumns(),d=I(c,b.series),e=I(c,[{name:b.categoryProperty}]),f=K(c,b.series),h=J(c,b.series),i=[],j=a.rawData.getRows(),k,q,r,s,t=[],u=[];if(a.totalRows=j.length,a.gridData={data:[]},a.chartData=[],i.push.apply(i,this.chartUtilities.CHART_COLORS),"scatter"===b.chartType||"bubble"===b.chartType?(r=I(c,[{name:b.horizontalAxisProperty}]),"bubble"===b.chartType&&(s=I(c,[{name:b.sizeProperty}]))):a.categoryArray=[],"heatmap"===b.chartType){var v;for(b.heatmap.yAxis=[],u=b.heatmap.colorSeries,b.heatmap.colorSeries=[],k=0;k<d.length;k++)v=c[d[k]].getLocalizedAlias()?c[d[k]].getLocalizedAlias():c[d[k]].getAlias(),b.heatmap.yAxis.push(v)}for(k=0;k<j.length;k++)q=j[k].getCells()[e[0]]?g.getFormattedValueFromQuery(b,j[k],e,0):null,"scatter"===b.chartType||"bubble"===b.chartType?o.processData(this,a,b,d,q,r,s,j[k],f,e):"heatmap"===b.chartType?(a.categoryArray[a.categoryArray.length]=q,
p.processData(this,a,b,d,u,j[k],e)):Q(b)?(q=j[k].getCells()[e[0]]?g.getRowValueFromQuery(j[k],e,0):null,a.categoryArray[a.categoryArray.length]=q,n.processData(this,a,b,d,j[k],i,t,e[0])):"timeSeries"===b.chartType?(a.categoryArray[a.categoryArray.length]=q,m.processData(this,a,b,d,j[k],f,e)):(a.categoryArray[a.categoryArray.length]=q,l.processData(this,a,b,d,j[k],f,e,h));Q(b)&&(b.pieSeriesAltered&&b.pieSeries.length>0?b.pieSeries=b.pieSeries.map(G.bind(null,this)):0!==a.chartData.length&&(a.chartData[0].data=a.chartData[0].data.map(G.bind(null,this))),n.setColorValues(this,b,a,t,d,e))};function H(a,b,c,d){var e;if(!d)return void a.deferred.resolve({});e=new h("AG1",d,(new Error).stack),a.errorOccured.raise(a,e)}function I(a,b){var c=[],d,e;if(b)for(e=0;e<b.length;e++)for(d=0;d<a.length;d++)if(b[e].name===a[d].getLocalizedAlias()||b[e].name===a[d].getAlias()){c[c.length]=d;break}return c}function J(a,b){var c,d,e={},f=[]
;if(b)for(d=0;d<b.length;d++)for(c=0;c<a.length;c++)if(b[d].name===a[c].getLocalizedAlias()||b[d].name===a[c].getAlias()){f[c]=d;break}return f}function K(a,b){var c=[],d,e;if(b)for(e=0;e<b.length;e++)for(d=0;d<a.length;d++){if(b[e].hyperlink===a[d].getLocalizedAlias()||b[e].hyperlink===a[d].getAlias()){c[c.length]=d;break}if("None"===b[e].hyperlink){c[c.length]=-1;break}}return c}function L(a,b,c,d){return b[c]===a.getLocalizedAlias()||b[c]===a.getAlias()||!(b[d]!==a.getDefaultCaption()||""===a.getDefaultCaption()||!a.fieldId)}var M=b.curry(function a(b,c){var d=L(b,c,"name","defaultAlias"),e=L(b,c,"hyperlink","hyperlinkAlias");d&&(c.name=b.getLocalizedAlias()?b.getLocalizedAlias():b.getAlias(),c.alias=b.getLocalizedAlias()?b.getLocalizedAlias():b.getAlias(),c.defaultAlias=b.getAlias()?b.getAlias():b.getDefaultCaption()?b.getDefaultCaption():"",c.uniqueId=b.getFieldId()),e&&"None"!==c.hyperlink&&(c.hyperlink=b.getLocalizedAlias()?b.getLocalizedAlias():b.getAlias(),
c.hyperlinkAlias=b.getAlias()?b.getAlias():b.getDefaultCaption()?b.getDefaultCaption():"")}),N=b.curry(function a(c,d){b.forEach(M(d),c.series),O(c,d,"categoryProperty","categoryPropertyAlias"),O(c,d,"horizontalAxisProperty","horizontalAxisPropertyAlias"),O(c,d,"sizeProperty","sizePropertyAlias")});function O(a,b,c,d){var e=!1;a[c]===b.getLocalizedAlias()||a[c]===b.getAlias()?e=!0:a[d]===b.getDefaultCaption()&&""!==b.getDefaultCaption()&&(e=!0),e&&(a[c]=b.getLocalizedAlias()?b.getLocalizedAlias():b.getAlias(),a[d]=b.getDefaultCaption()?b.getDefaultCaption():b.getAlias())}function P(a,c){var d=a.rawData.getColumns();b.forEach(N(c),d)}function Q(a){return"pie"===a.chartType||"donut"===a.chartType||"pyramid"===a.chartType}return r});
define('dataset/services/dataset-services',['require','exports','module','jquery','system/http/ajax-client','application/application-context'],function(require,exports,module){"use strict";var a=require("jquery"),b=require("system/http/ajax-client"),c=require("application/application-context"),d="api/core/dataset/";function e(a){this.ajaxClient=a}return e.dependsOn=[b],e.prototype.uploadFile=function b(d){var e=a.Deferred(),f={MeridiumToken:c.session.id},g={url:"api/core/dataset/CacheImport",method:"POST",data:d,headers:f,cache:!1,contentType:!1,processData:!1};return a.ajax(g).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e},e.prototype.fetchPreview=function b(c){var e=a.Deferred();return this.ajaxClient.post(d+"PreviewDataset",c,{}).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e},e.prototype.fetchDataset=function b(c){var e=a.Deferred();return this.ajaxClient.post(d+"RetrieveDataset",c,{}).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e},e.prototype.fetchDatasetKey=function a(b){var c=d+"RetrieveDatasetKey/";return this.ajaxClient.get(c+b)},
e.prototype.fetchDatasetPath=function a(b){var c=d+"RetrieveDatasetPath?path="+encodeURIComponent(b);return this.ajaxClient.get(c)},e.prototype.createDataset=function b(c){var e=a.Deferred();return this.ajaxClient.post(d+"CreateDataset",c,{}).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e},e.prototype.createDatasetCatalogItemFromQuery=function b(c){var e=a.Deferred();return this.ajaxClient.post(d+"CreateDatasetCatalogItem/query",c).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e},e.prototype.putDataset=function b(c){var e=a.Deferred(),f=d+"UpdateDataset";return this.ajaxClient.put(f,c).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},e});
define('ui/elements/chart/process-catalog-item',['require','jquery','ui/elements/chart/services/chart-service','ui/elements/chart/models/chart-config-adapter','ui/elements/chart/process-query','dataset/services/dataset-services','application/application-events'],function(require){"use strict";var a=require("jquery"),b=require("ui/elements/chart/services/chart-service"),c=require("ui/elements/chart/models/chart-config-adapter"),d=require("ui/elements/chart/process-query"),e=require("dataset/services/dataset-services"),f=require("application/application-events");function g(a,c,d){this.chartService=Object.resolve(b),this.errorOccured=Object.resolve(f).errorOccured,this.datasetService=Object.resolve(e),this.deferred=null,this.processQuery=null,this.catalogItem=a,this.config=null,this.parameters=c||null,this.isFiltered=d||!1,this.reload=!1}g.prototype.load=function(b,c,d){var e;return this.deferred=a.Deferred(),b&&(this.config=b),c&&(this.reload=!0,this.processQuery=null),d&&(this.parameters=null),this.catalogItem.graph&&this.config.datasetKey&&(this.catalogItem.graph.queryKey=null,this.catalogItem.graph.datasetKey=this.config.datasetKey),this.catalogItem.graph&&this.catalogItem.graph.queryKey?(e=a.Deferred(),
e.resolve()):this.catalogItem.graph&&this.catalogItem.graph.datasetKey?e=this.datasetService.fetchDatasetKey(this.catalogItem.graph.datasetKey):this.catalogItem.key?e=this.chartService.getByKey(this.catalogItem.key):this.catalogItem.path&&(e=this.chartService.getByPath(this.catalogItem.path)),e.done(i.bind(null,this)).fail(h.bind(null,this)),this.deferred.promise()},g.prototype.processData=function(b,c){var d=a.Deferred();return this.processQuery.processCategoryCaptions(this.processQuery,b,c,d),d};function h(a,b,c,d){a.deferred.reject(b,c,d)}function i(a,b){if(!b&&(void 0===a.catalogItem.key||null===a.catalogItem.key))return void h(a,{status:404});b&&b.resultGrid&&a.config.datasetKey?a.catalogItem.graph.dataset=b.resultGrid:b&&(a.catalogItem=b),a.catalogItem.graph&&a.reload===!1&&(a.config=c.deserialize(a.catalogItem.graph.config)),a.catalogItem.graph&&!a.catalogItem.graph.datasetKey&&a.config.datasetKey?(a.catalogItem.graph.datasetKey=a.config.datasetKey,
a.catalogItem.graph.queryKey="",a.datasetService.fetchDatasetKey(a.catalogItem.graph.datasetKey).done(i.bind(null,a)).fail(h.bind(null,a))):a.processQuery&&a.processQuery.queryKey===a.catalogItem.graph.queryKey||(a.processQuery=new d(a.catalogItem.graph,a.parameters,a.isFiltered)),a.config.queryKey&&(a.config.queryKey=null),a.processQuery&&a.processQuery.load(a.config).done(j.bind(null,a))}function j(a,b){b.config=a.config,b.catalogItem=a.catalogItem,a.deferred.resolve(b)}return g});
define('ui/elements/chart/process-json',['require','jquery','ui/elements/chart/chart-utilities'],function(require){"use strict";var a=require("jquery"),b=require("ui/elements/chart/chart-utilities");function c(a){this.rawData=a,this.chartUtilities=new b}c.prototype.load=function(b){var c,e=[],g={},h={totalRows:this.rawData?this.rawData.length:0,categoryArray:b&&b.categoryArray?b.categoryArray:[]};return this.rawData&&(d(this,h.categoryArray,b,e,g),h.gridData={data:this.rawData},f(this,h,b,e,g)),c=a.Deferred(),c.resolve(h),c.promise()};function d(a,b,c,d,f){var g=c.aggregateProperties,h=a.rawData,i,j,k,l,m;for(e(a,c),i=0;i<h.length;i++)if(c.categoryProperty&&(b[b.length]=h[i][c.categoryProperty]),j=h[i][c.series[0].name],d.indexOf(j)<0&&(d[d.length]=j),g)for(k=0;k<g.length;k++)l=g[k],void 0===f[l]&&(f[l]=[]),m=h[i][l]||0,void 0===f[l][j]&&(f[l][j]=[]),f[l][j][f[l][j].length]=m}function e(a,b){b.chartMethod===a.chartUtilities.CHART_METHOD_COUNT?(b.pointFormat=b.pointFormat||"{series.name}: <b>{point.y:g2}</b>",
b.dataLabelFormat=b.dataLabelFormat||"{point.y:g2}"):b.chartMethod===a.chartUtilities.CHART_METHOD_PERCENT?(b.pointFormat=b.pointFormat||"{series.name}: <b>{point.y:p2}%</b>",b.dataLabelFormat=b.dataLabelFormat||"{point.y:p2}%"):b.chartMethod===a.chartUtilities.CHART_METHOD_SUM&&"stacked-column"===b.chartType?(b.pointFormat=b.pointFormat||'<span style="color:{series.color}">{series.name}</span>: <b>{point.y:g2}</b><br/>',b.dataLabelFormat=b.dataLabelFormat||"{point.y:g2}"):b.chartMethod===a.chartUtilities.CHART_METHOD_SUM&&"stacked-column"!==b.chartType&&(b.pointFormat=b.pointFormat||"{series.name}: <b>{point.y:g2}</b>",b.dataLabelFormat=b.dataLabelFormat||"{point.y:g2}")}function f(a,b,c,d,e){var f;switch(f=a.chartUtilities.translateChartType(c.series[0].chartType),c.chartMethod){case a.chartUtilities.CHART_METHOD_PERCENT:b.chartData=h(f,d,c.aggregateProperties,e,b.totalRows);break;case a.chartUtilities.CHART_METHOD_COUNT:b.chartData=i(f,d,c.aggregateProperties,e);break
;case a.chartUtilities.CHART_METHOD_SUM:b.chartData=j(f,d,c.aggregateProperties,e);break;default:b.chartData=g(f,d,c.aggregateProperties,e)}}function g(a,b,c,d){var e,f,g,h=[];for(e=0;e<b.length;e++)for(f=b[e],g=0;g<c.length;g++)h[h.length]={name:f,data:d[c[g]][f],type:a};return h}function h(a,b,c,d,e){var f,g,h,i,j=[];for(g=0;g<b.length;g++){for(i=b[g],f=[],h=0;h<c.length;h++)f[f.length]=d[c[h]][i].length/e*100;"pie"===a?(0===j.length&&(j[0]={data:[],type:"pie"}),j[0].data[j[0].data.length]=[i,f[0]]):j.push({name:i,data:f,type:a})}return j}function i(a,b,c,d){var e,f,g,h,i=[];for(f=0;f<b.length;f++){for(h=b[f],e=[],g=0;g<c.length;g++)e[e.length]=d[c[g]][h].length;i.push({name:h,data:e,type:a})}return i}function j(a,b,c,d){var e,f,g,h,i=[],j,k,l;for(f=0;f<b.length;f++){for(e=[],h=b[f],g=0;g<c.length;g++){for(k=0,l=d[c[g]][h],j=0;j<l.length;j++)k+=l[j];e[e.length]=Number(k.toFixed(4))}i.push({name:h,data:e,type:a})}return i}return c});
define('ui/elements/chart/chart-view-model',['require','exports','module','highcharts','highcharts-exporting','highcharts-3d','highcharts-more','highcharts-funnel','highcharts-solid-guage','highcharts-rounded-corners','highcharts-heatmap','noData','lodash','jquery','application/application-context','ui/elements/chart/models/chart-config-adapter','catalog/services/catalog-constants','catalog/services/dto/catalog-item-dto','ui/elements/chart/models/chart-options-factory','ui/elements/chart/process-catalog-item','ui/elements/chart/process-query','ui/elements/chart/process-json','ui/elements/chart/chart-utilities','ui/elements/chart/services/chart-service','system/globalization/translator','system/error/error-message','system/diagnostics/log-manager','ui/elements/page-filter/page-filter-connection','application/application-events','system/ui/busy-indicator','ui/elements/tool-bar/view-model','ui/elements/resultgrid/resultgrid-view-model'],function(require,exports,module){"use strict";require("highcharts"),require("highcharts-exporting"),require("highcharts-3d"),require("highcharts-more"),require("highcharts-funnel"),require("highcharts-solid-guage"),require("highcharts-rounded-corners"),require("highcharts-heatmap"),require("noData")
;var a=require("lodash"),b=require("jquery"),c=require("application/application-context"),d=require("ui/elements/chart/models/chart-config-adapter"),e=require("catalog/services/catalog-constants"),f=require("catalog/services/dto/catalog-item-dto"),g=require("ui/elements/chart/models/chart-options-factory"),h=require("ui/elements/chart/process-catalog-item"),i=require("ui/elements/chart/process-query"),j=require("ui/elements/chart/process-json"),k=require("ui/elements/chart/chart-utilities"),l=require("ui/elements/chart/services/chart-service"),m=require("system/globalization/translator"),n=require("system/error/error-message"),o=require("system/diagnostics/log-manager"),p=o.getLogger(module.id),q=require("ui/elements/page-filter/page-filter-connection"),r=require("application/application-events"),s=require("system/ui/busy-indicator");require("ui/elements/tool-bar/view-model"),require("ui/elements/resultgrid/resultgrid-view-model");var t=Object.create(HTMLElement.prototype)
;t.createdCallback=function(){this.internal={chart:null,grid:null},this.state={options:null,config:null,rawData:null,chartData:null,gridData:null,totalRows:null,catalogItem:null,processData:null,timezoneOffset:null},Element.defineProperty(this,"catalogItem",{get:Z.bind(null,this),set:_.bind(null,this)}),this.chartUtilities=new k,this.errorOccured=Object.resolve(r).errorOccured,this.navigate=Object.resolve(r).navigate,this.translator=Object.resolve(m),this.constants=Object.resolve(e),this.pageFilterConnection=Object.resolve(q),this.chartService=Object.resolve(l),this.indicator=Object.resolve(s),this.user=c.user,Element.defineProperty(this,"options",{get:U.bind(null,this),set:V.bind(null,this)}),this._aggregateQueryParams=null,Element.defineProperty(this,"aggregateQueryParams",{get:function(){return this._aggregateQueryParams}.bind(this),set:function(a){this._aggregateQueryParams=a}.bind(this)}),this._isFiltered=null,Element.defineProperty(this,"isFiltered",{get:function(){
return this._isFiltered}.bind(this),set:function(a){this._isFiltered=a}.bind(this)}),this.evalMobile=!1,u()};function u(){window.Highcharts.setOptions({exporting:{enabled:!1}})}t.attachedCallback=function(){var a,b;a=document.createElement("mi-tool-bar"),null!==this.getAttribute("hide-toolbar")&&(a.style.display="none"),a.appendChild(S(this,"icon-map","toggleLegend","CHART_LEGEND")),a.appendChild(S(this,"icon-xi-tag","toggleLabels","CHART_LABELS")),a.appendChild(S(this,"icon-graph","showChart","CHART_CHART",!0)),a.appendChild(S(this,"icon-table-view","showGrid","CHART_GRID")),a.appendChild(S(this,"icon-refresh","reloadWithPrompts","CHART_REFRESH")),null!==this.getAttribute("has-print")&&a.appendChild(S(this,"icon-export","print","EXPORT_TO_PDF")),this.appendChild(a),null!==this.getAttribute("hide-toolbar-legend")&&(a.querySelector(".icon-map").parentNode.style.display="none"),
null!==this.getAttribute("hide-toolbar-labels")&&(a.querySelector(".icon-xi-tag").parentNode.style.display="none"),null!==this.getAttribute("hide-toolbar-graph")&&(a.querySelector(".icon-graph").parentNode.style.display="none"),null!==this.getAttribute("hide-toolbar-table")&&(a.querySelector(".icon-table-view").parentNode.style.display="none"),null!==this.getAttribute("hide-toolbar-refresh")&&(a.querySelector(".icon-refresh").parentNode.style.display="none"),a.addEventListener("click",this),b=document.createElement("div"),b.className="chart-container",a=document.createElement("div"),a.className="chart",b.appendChild(a),b.appendChild(R()),this.internal.grid=document.createElement("mi-resultgrid"),this.internal.grid.setAttribute("selectionmode","single"),this.internal.grid.setAttribute("showgroupingpanel","false"),this.internal.grid.setAttribute("showrowfilter","false"),this.internal.grid.setAttribute("hascolumnchooser","false"),this.internal.grid.loadJSONData=T.bind(null,this),
this.internal.grid.onCellHyperlinkClickCB=$.bind(null,this),b.appendChild(this.internal.grid),this.appendChild(b),this.indicator.attachTo(b),this.parentElement.addEventListener("resize",this),this.pageFilterConnection.open(K.bind(null,this),this),this.chartService.getTimezones().done(H.bind(null,this))},t.detachedCallback=function(){this.internal.chart&&this.internal.chart.destroy(),this.pageFilterConnection.close(),this.internal.grid.removeEventListener("click",this),this.parentElement&&this.parentElement.removeEventListener("resize",this),this.state&&this.state.processData&&this.state.processData.deferred&&this.state.processData.deferred.reject(null,"abort","abort"),this.chartUtilities=null,this.constants=null,this.translator=null,this.errorOccured=null,this.user=null,this.internal=null,this.indicator.detach(),this.chartService=null,this.pageFilterConnection=null,this.state=null,this.isFiltered=null,
this.querySelector("mi-tool-bar")&&this.querySelector("mi-tool-bar").removeEventListener("click",this)},t.attributeChangedCallback=function(a,b,c){var d=this.querySelector("mi-tool-bar");"hide-toolbar"===a?d&&(d.style.display=null===c?"block":"none"):"hide-title"===a?(this.state.options.title.text=O(this),this.redraw()):"hide-toolbar-legend"===a?d.querySelector(".icon-map").parentNode.style.display="none":"hide-toolbar-graph"===a?d.querySelector(".icon-graph").parentNode.style.display="none":"hide-toolbar-labels"===a?d.querySelector(".icon-xi-tag").parentNode.style.display="none":"hide-toolbar-table"===a?d.querySelector(".icon-table-view").parentNode.style.display="none":"hide-toolbar-refresh"===a&&(d.querySelector(".icon-refresh").parentNode.style.display="none")},t.optionsFromConfig=function(a){return this.state.config=d.fromDTO(a),this.state.chartData=a.chartData,this.state.gridData=a.gridData||a.chartData,this.state.options=P(this),this.state.options},t.draw=function(){
this.redraw()},t.redraw=function(){if(this.state&&this.state.options&&(this.state.options.credits=(this.state.options.credits||{}).enabled=!1,this.internal&&this.internal.chart&&this.internal.chart.renderTo&&this.internal.chart.destroy(),null===this.state.options.series&&this.state.config.stock===!0&&(this.state.options.series=this.state.chartData),this.state.options.chart&&this.state.options.chart.renderTo)){try{this.state.timezoneOffset&&window.Highcharts.setOptions({global:{timezoneOffset:this.state.timezoneOffset,useUTC:!1},lang:{noData:this.translator.translate("CHART_NO_DATA"),loading:this.translator.translate("CHART_LOADING"),resetZoom:this.translator.translate("CHART_RESET_ZOOM"),resetZoomTitle:this.translator.translate("CHART_RESET_ZOOM_TEXT")}}),this.state.config.stock&&this.state.config.stock===!0?this.internal.chart=new window.Highcharts.StockChart(this.state.options):this.internal.chart=new window.Highcharts.Chart(this.state.options)}catch(a){if(p.error(a),
this.internal&&(this.internal.chart=null),this.translator)throw this.translator.translate("CHART_RENDER_ERROR")}aa(this),this.classList.contains("show-grid")&&this.internal&&this.internal.grid.reload()}},t.saveState=function(){return this.state.showGrid=this.classList.contains("show-grid"),this.state},t.loadState=function(a){var b,c,d;this.state=a,this.state.options&&(b=this.state.options.legend.enabled,c=this.state.options.plotOptions.series.dataLabels.enabled,d=this.state.options.xAxis.categories),this.state.options=P(this,d),this.state.options.legend.enabled=b,this.state.options.plotOptions.series.dataLabels.enabled=c,X(this),Y(this),this.state.showGrid&&(this.showGrid(),this.state.showGrid=null),aa(this),this.draw()},t.load=function(b){var c=!1;this.indicator.show(),b&&(this.state.config=d.fromDTO(b),b.data&&(this.state.rawData=b.data),!b.queryParams||void 0!==this.isFiltered&&null!==this.isFiltered||(this.aggregateQueryParams=b.queryParams),
b.queryStrParams&&(this.aggregateQueryParams={queryString:!0,queryStrParams:b.queryStrParams}),this.state.catalogItem||(this.state.catalogItem={},this.state.catalogItem.itemType=this.constants.ITEM_TYPE_GRAPH),this.state.catalogItem.key=b.catalogKey,this.state.catalogItem.path=b.catalogPath,c=b.delegateLoadToFilter||!1,b.evalMobile&&(this.evalMobile=!0)),W(this,b?b.data:null),v(this,c)||a.isObject(this.state)&&(this.evalMobile&&(this.state.config.evalMobile=!0),this.state.processData.load(this.state.config).done(N.bind(null,this)).fail(Q.bind(null,this)))};function v(a,b){return!!b&&a.pageFilterConnection.remote.isConnected()}t.reload=function(){w(this)},t.print=function(){this.internal.chart.print()},t.reloadWithPrompts=function(){w(this,!0)};function w(a,b){var c=b||!1;a.indicator.show(),a.state&&a.state.processData?a.state.processData.load(a.state.config,!0,c).done(N.bind(null,a)).fail(Q.bind(null,a)):setTimeout(N.bind(null,a),0)}t.reConfigure=function(){var a={
rawData:this.state.rawData};this.state.processData||W(this,this.state.rawData),this.state.processData.processData(a,this.state.config).done(x.bind(null,this,a))};function x(a,b){M(a,b),a.redraw()}t.handleEvent=function(a){z(this,a),y(this,a)};function y(a,b){"resize"===b.type&&a.redraw()}function z(a,b){"click"!==b.type||B(b.target)||(A(a,b),C(b.target))}function A(a,b){var c=D(b.target);c&&Object.tryMethod(a,c)}function B(a){return a.disabled||a.parentElement.disabled}function C(a){"A"===a.nodeName&&(a.href||a.hash)&&a.setAttribute("target","tab")}function D(a){var b=a.getAttribute("data-action");return b?b:a.parentElement.getAttribute("data-action")}t.toggleLegend=function(){var a;this.state.options&&(a=!this.state.options.legend.enabled,this.state.options.legend.enabled=a,F(this.internal.chart,a),E(this.internal.chart,a),this.internal.chart.render(),X(this))};function E(a,b){a.options.legend.enabled=b,b||a.legend.destroy()}function F(a,b){var c,d
;for(c=0;c<a.series.length;c++)d=a.series[c],d.options.showInLegend=b,b||(d.legendIem=null,a.legend.destroyItem(d))}t.toggleLabels=function(){var a;this.state.options&&(a=!this.state.options.plotOptions.series.dataLabels.enabled,this.state.options.plotOptions.series.dataLabels.enabled=a,G(this.internal.chart.series,a),this.internal.chart.redraw(!1),Y(this))};function G(a,b){var c,d;for(c=0;c<a.length;c++)d=a[c].options,d.dataLabels.enabled=b,a[c].update(d,!1)}t.showChart=function(){this.classList.remove("show-grid"),this.querySelector('button[data-action="toggleLegend"]').disabled=!1,this.querySelector('button[data-action="toggleLabels"]').disabled=!1,this.querySelector('button[data-action="showChart"]').classList.add("active"),this.querySelector('button[data-action="showGrid"]').classList.remove("active"),this.redraw()},t.showGrid=function(){this.classList.add("show-grid"),this.querySelector('button[data-action="toggleLegend"]').disabled=!0,
this.querySelector('button[data-action="toggleLabels"]').disabled=!0,this.querySelector('button[data-action="showChart"]').classList.remove("active"),this.querySelector('button[data-action="showGrid"]').classList.add("active"),this.internal.grid.reload()};function H(a,b){var c,d,e;for(c=0;c<b.length;c++)if(a.user&&b[c].id===a.user.timezoneId){var f=/\(([^)]+)\)/,g=f.exec(b[c].name);null!==g&&(d=g[1].replace(/[UTC]/g,"")),d.indexOf(":")>-1?d=d.split(":"):e=0,d[0]&&d[0].indexOf("-")>-1?(d[0]=Number(d[0].replace("-","")),d[1].indexOf("30")>-1?d[1]=5:d[1].indexOf("45")>-1?d[1]=75:d[1]=0,e=60*Number(d[0]+"."+d[1])):d[0]&&d[0].indexOf("+")>-1&&(d[0]=Number(d[0].replace("+","")),d[1].indexOf("30")>-1?d[1]=5:d[1].indexOf("45")>-1?d[1]=75:d[1]=0,e=-(60*Number(d[0]+"."+d[1]))),I(a)&&(e=4),a.state.timezoneOffset=e}}function I(a){var b=c.user.timezoneId
;return"UTC"===b||J(a,b,"Morocco")||J(a,b,"Dublin")||J(a,b,"Edinburgh")||J(a,b,"Lisbon")||J(a,b,"London")||J(a,b,"Casablanca")||J(a,b,"Coordinated Universal Time")||J(a,b,"Monrovia")||J(a,b,"Reykjavik")||J(a,b,"GMT Standard Time")||J(a,b,"Greenwich Standard Time")}function J(a,b,c){return String.prototype.indexOf.call(b,c)!==-1}function K(b,c){b.pageFilterConnection.remote.isConnected()&&!b.skipFilterLoad&&(c&&c.parmDesigns&&c.parmDesigns.length?b.aggregateQueryParams=c:b.aggregateQueryParams=void 0,a.delay(b.load.bind(b),500))}function L(a){a.dispatchEvent(new CustomEvent("loaded",{bubble:!0}))}function M(a,b){a.state&&(a.state.rawData=b.rawData,a.state.gridData=b.gridData,a.state.chartData=b.chartData,a.state.totalRows=b.totalRows,b.catalogItem&&(a.state.catalogItem=b.catalogItem),b.config&&(a.state.config=b.config),a.state.options=P(a,b.categoryArray),Y(a),X(a))}function N(a,b){b&&M(a,b),L(a),a.draw(),a.indicator.hide()}function O(a){var b=null
;return null===a.getAttribute("hide-title")&&(a.state.catalogItem&&(b=a.state.catalogItem.caption||a.state.catalogItem.id),b=b||a.state.config.title),b}function P(a,b){var c=a.state.config,d=a.querySelector(".chart"),e=O(a),f=g.create(d,c,e);if(f)return f.getOptions(a.state.chartData,b)}function Q(a,b,c,d){if(b&&404===b.status){var e=a.querySelector(".chart-container");e&&(e.innerHTML=a.translator.translate("CHART_NOT_FOUND"),e.className=e.className+" not-found-message")}else{if("abort"===c||"abort"===d)return;var f=new n("AG1",d,(new Error).stack);a.errorOccured.raise(a,f)}}function R(){var a;return a=document.createElement("div"),a.className="chart-detail-view",a}function S(a,b,c,d,e){var f,g;return f=document.createElement("button"),f.className="btn btn-default btn-icon",f.setAttribute("data-action",c),f.setAttribute("title",a.translator.translate(d)),e&&f.classList.add("active"),g=document.createElement("i"),g.className=b,f.appendChild(g),f}function T(a){var c=b.Deferred()
;return a.state&&a.state.gridData&&c.resolve(k.formatGridData(a.state.gridData)),c}function U(a){return a.state.options}function V(b,c){a.isObject(b.state)&&(b.state.options=c),c&&b.state&&b.state.options&&b.state.options.chart&&(b.state.options.chart.renderTo=b.querySelector(".chart"),L(b)),b.redraw()}function W(b,c){
b.state&&b.state.catalogItem&&b.state.catalogItem.graph&&b.state.catalogItem.graph.queryKey?b.state.processData=new h(b.state.catalogItem,b.aggregateQueryParams,b.isFiltered):b.state&&b.state.catalogItem&&b.state.catalogItem.graph&&b.state.catalogItem.graph.datasetKey?b.state.processData=new h(b.state.catalogItem,b.aggregateQueryParams,b.isFiltered):b.state&&b.state.catalogItem&&(b.state.catalogItem.key||b.state.catalogItem.path)?b.state.processData=new h(b.state.catalogItem,b.aggregateQueryParams,b.isFiltered):b.state&&b.state.config&&b.state.config.queryKey?b.state.processData=new i(b.state.config,b.aggregateQueryParams,b.isFiltered):a.isObject(b.state)&&(b.state.processData=new j(c))}function X(a){var b;(b=a.querySelector('button[data-action="toggleLegend"]'))&&(a.state.options&&a.state.options.legend.enabled?b.classList.add("active"):b.classList.remove("active"),b.blur())}function Y(a){var b
;(b=a.querySelector('button[data-action="toggleLabels"]'))&&(a.state.options&&a.state.options.plotOptions.series&&a.state.options.plotOptions.series.dataLabels&&a.state.options.plotOptions.series.dataLabels.enabled?b.classList.add("active"):b.classList.remove("active"),b.blur())}function Z(a){return a.state.catalogItem||(a.state.catalogItem=new f,a.state.catalogItem.itemType=a.constants.ITEM_TYPE_GRAPH),a.state.catalogItem.graph||(a.state.catalogItem.graph={}),a.state.catalogItem.stock||(a.state.catalogItem.stock=!1),a.state.catalogItem.graph.config=d.serialize(a.state.config),a.state.catalogItem}function $(a,b){b.hyperlinkUrl.indexOf("http")>-1?window.open(b.hyperlinkUrl,"_blank"):b.hyperlinkUrl.indexOf("!")>-1?a.navigate.raise(b.hyperlinkUrl.replace("!",""),{isActionRoute:!0}):a.navigate.raise(b.hyperlinkUrl,{tab:!0})}function _(a,b){a.state.catalogItem=b,b&&b.graph&&b.graph.config?a.state.config=d.deserialize(b.graph.config):a.state.config=d.fromDTO({})}function aa(a){
a.state.options.chart.animation=!1,void 0!==a.state.options.plotOptions&&a.state.options.plotOptions.series?a.state.options.plotOptions.series.animation=!1:a.state.options.plotOptions={series:{animation:!1}}}return document.registerElement("mi-chart",{prototype:t}),t});
define('dashboard/view-models/chart-widget',['require','lodash','jquery','knockout','./widget-view-model','./chart-widget-editor','../models/commands/goto-route-command','mi-assert','application/application-events','text!../views/chart-widget.html','ui/elements/chart/chart-view-model'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("./widget-view-model"),e=require("./chart-widget-editor"),f=require("../models/commands/goto-route-command"),g=require("mi-assert"),h=require("application/application-events"),i=require("text!../views/chart-widget.html");require("ui/elements/chart/chart-view-model");function j(b){k.call(this,b,i,e),this.path=c.observable(),this.pathSubscription=null,this.region=null,this.chartElement=null,this.$gridLayoutItem=null,this.debouncedWidgetResizeFunction=a.debounce(p.bind(null,this),250),this.applicationEvents=Object.resolve(h),this.gotoRouteCommand=Object.resolve(f,"graph"),this.chartConfig=null}var k=Object.inherit(d,j);j.prototype.afterAttach=function a(c){try{Element.upgrade("mi-chart",c),this.pathSubscription=this.path.subscribe(u.bind(null,this)),this.region=c,this.chartElement=b(this.region.$element).find("mi-chart").get(0),this.$gridLayoutItem=b("mi-grid-layout-item"),
this.$gridLayoutItem.on("element-resized",this.debouncedWidgetResizeFunction),q(this)}catch(a){k.prototype.onError.call(this,a)}},j.prototype.beforeDetach=function a(){try{l(this),this.pathSubscription.dispose(),this.pathSubscription=null,this.$gridLayoutItem.off("element-resized"),this.$gridLayoutItem=null,this.chartElement=null}catch(a){k.prototype.onError.call(this,a)}finally{this.pathSubscription=null,this.$gridLayoutItem=null,this.chartElement=null}};function l(a){if(a.chartElement){var b=a.chartElement.saveState(),c,d;m(b)&&(d=b.processData.processQuery.queryContainer.parmContainer,c=b.config,c.queryParams=d,c.catalogPath=a.encodePath(a.path()),a.chartConfig=c)}}function m(a){return a.processData.processQuery&&a.processData.processQuery.queryContainer&&a.processData.processQuery.queryContainer.parmContainer}j.prototype.deserialize=function a(){try{var b=this.widget.properties();g.ok(b,"properties"),b.path&&this.path(b.path)}catch(a){k.prototype.onError.call(this,a)}},
j.prototype.serialize=function a(){try{return l(this),r(this),{path:this.path()}}catch(a){k.prototype.onError.call(this,a)}},j.prototype.refresh=function a(){try{n(this)}catch(a){k.prototype.onError.call(this,a)}};function n(a){o(a)&&a.chartElement.reload()}function o(a){return a.chartElement&&a.chartElement.state&&a.chartElement.state.chartData&&a.chartElement.state.chartData.length}j.prototype.redraw=function(){p(this)},j.prototype.goto=function a(){this.gotoRouteCommand.execute(this.region.element,this.encodePath(this.path()))},j.prototype.icon=function a(){try{return"dashboard-icon-chart2"}catch(a){k.prototype.onError.call(this,a)}};function p(a){a&&a.chartElement&&a.chartElement.draw()}function q(a){a.region&&(r(a),t(a,a.chartConfig||{catalogPath:a.encodePath(a.path()),delegateLoadToFilter:!0}))}function r(a){a.chartElement&&s(a)&&(a.chartElement.skipFilterLoad=!0)}function s(a){
return a.chartConfig&&a.chartConfig.queryParams.parmDesigns&&a.chartConfig.queryParams.parmDesigns.length}function t(a,b){a.chartElement.catalogItem={},a.chartElement.load(b)}function u(a,b){v(a)}function v(a){t(a,{catalogPath:a.encodePath(a.path()),delegateLoadToFilter:!1})}return j});
define('metrics/services/kpi-service',['require','lodash','system/http/ajax-client','application/application-context','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("system/http/ajax-client"),c="api/metrics/kpi",d="api/core/metadata/entityfamily",e=require("application/application-context"),f="api/core/security/user";require("system/lang/object");function g(a){this.ajaxClient=a,this.utcHeaderOption={headers:{MeridiumToken:e.session.id+";UTC"}}}return g.dependsOn=[b],g.prototype.getKpiList=function a(b,d,e,f){var g=this,h="?startRow="+b+"&maxRows="+d+"&isForSubIndicators="+f;return e&&(h+="&nameLike="+e),g.ajaxClient.get(c+h)},g.prototype.getKpiDetails=function a(b){return this.ajaxClient.get(c+"/"+b)},g.prototype.createKPI=function a(b){var d=this;return d.ajaxClient.post(c,b,d.utcHeaderOption)},g.prototype.updateKPI=function a(b){var d=this;return d.ajaxClient.put(c+"/"+b.key,b,d.utcHeaderOption)},g.prototype.removeKPI=function a(b){return this.ajaxClient.delete(c+"/"+b)},g.prototype.getUsersList=function a(){return this.ajaxClient.get(f)},
g.prototype.getKpiData=function b(d,e,f){var g=this,h=c+"/data?";return a.isArray(d)?(h+="kpiKey="+encodeURIComponent(d[0]),a.each(a.drop(d),function(a){h+="&kpiKey="+encodeURIComponent(a)})):h+="kpiKey="+encodeURIComponent(d),h+=e===!0?"&loadChildren=true":"&loadChildren=false",h+=f===!0?"&loadFullHistory=true":"&loadFullHistory=false",g.ajaxClient.get(h,g.utcHeaderOption)},g.prototype.getKpiDataByName=function a(b,d,e){var f=this,g=c+"/name?";return g+="kpiName="+b,g+=d===!0?"&loadChildren=true":"&loadChildren=false",g+=e===!0?"&loadFullHistory=true":"&loadFullHistory=false",f.ajaxClient.get(g,f.utcHeaderOption)},g.prototype.updatemesure=function a(b){return this.ajaxClient.put(c+"/"+b+"/updatemeasure")},g.prototype.getEntityFamilyByID=function(a){return this.ajaxClient.get(d+"?id="+a)},g.prototype.checkSubIndicator=function b(d,e){var f=this,g="data?parentKpiKey="+d,h=[];return a.each(e,function(a){h.push(a.key)}),g+="&kpiChildrenKeys="+h,f.ajaxClient.get(c+"/checkSubIndicator/"+g)
},g.prototype.checkParent=function b(d,e){var f=this,g="data?",h=[];return a.each(d,function(a){h.push(a.key)}),g+="kpiChildrenKeys="+h,f.ajaxClient.get(c+"/checkParent/"+g+"&parentKey="+e)},g});

define('text!metrics/views/kpi-list-view.html',[],function () { return '<div class="kpi-list-group">\r\n    <mi-list-group selector="toggle"\r\n                   multiselect="true"\r\n                   key="key"\r\n                   description="name"\r\n                   page="1"\r\n                   page-size="25"\r\n                   scroll-percent="0.75"\r\n                   custom-filter="false"\r\n                   custom-search="false"\r\n                   allow-add="false">\r\n    </mi-list-group>\r\n\r\n</div>\r\n';});

define('metrics/kpi-list-view-model',['require','jquery','lodash','spa/ko/knockout-view-model','text!metrics/views/kpi-list-view.html','knockout','toastr','metrics/services/kpi-service','system/ui/dialog-box','kobindings','system/lang/object','ui/elements/list-group/view-model'],function(require){"use strict";var a=require("jquery"),b=require("lodash"),c=require("spa/ko/knockout-view-model"),d=require("text!metrics/views/kpi-list-view.html"),e=require("knockout"),f=require("toastr"),g=require("metrics/services/kpi-service"),h=require("system/ui/dialog-box");require("kobindings"),require("system/lang/object"),require("ui/elements/list-group/view-model");function i(a){var b=this;j.call(b,d),b.isChildren=e.observable(!1),b.isForSubIndicators=e.observable(!1),b.selectedKpiList=e.observableArray([]),b.parentKey=e.observable(),b.childrenKey=e.observableArray([]),b.kpiService=a,b.list=null,b.isMultiselectOption=e.observable(!1)}var j=Object.inherit(c,i);i.dependsOn=[g],i.prototype.attach=function a(b){var c=this;j.prototype.attach.call(this,b),c.region=b,c.list=c.region.$element.find("mi-list-group")[0],c.isMultiselectOption()||(c.list.attributes.multiselect.value=!1,c.list.attributes.selector.value="none"),c.list.loader=l.bind(null,c),
c.list.addEventListener("selected",this),c.list.searchCallback=k.bind(null,c),Element.upgrade(c.list)},i.prototype.handleEvent=function(a){var b=this;"selected"===a.type&&null!==a.target.value&&void 0!==a.target.value&&(b.isMultiselectOption()?b.selectedKpiList(a.target.selectedItems):(b.selectedKpiList.removeAll(),b.selectedKpiList([a.target.value])))};function k(c,d,e,f){var g=a.Deferred();return c.kpiService.getKpiList((e-1)*f,f,a.trim(d),c.isForSubIndicators(),c.parentKey()).done(function(a){var d=b.remove(a,function(a){return a.key===c.parentKey()});g.resolve(a)}).fail(function(a){a.responseJSON&&a.responseJSON.modelState&&m(c,a.responseJSON.modelState,a.responseJSON.message)}),g.promise()}function l(c,d,e){var f=a.Deferred();return c.kpiService.getKpiList((d-1)*e,e,null,c.isForSubIndicators(),c.parentKey()).done(function(a){var d=b.remove(a,function(a){return a.key===c.parentKey()});f.resolve(a)}).fail(function(a){
a.responseJSON&&a.responseJSON.modelState&&m(c,a.responseJSON.modelState,a.responseJSON.message)}),f.promise()}i.prototype.ok=function a(){return this.selectedKpiList()};function m(a,b,c){var d;if(b instanceof Object)for(var e in b)if(b.hasOwnProperty(e))for(var g=0;g<b[e].length;g++)f.error(b[e][g],c)}return i});

define('text!dashboard/views/kpi-widget-editor.html',[],function () { return '<div class="kpi-widget-editor">\r\n    <!-- ko with: widgetVM -->\r\n    <div data-bind="with: widget">\r\n        <div class="form-group block-group">\r\n            <div class="block name-block">\r\n                <label data-bind="text: $parent.translate(\'NAME\')"></label>\r\n                <div class="input-group localize">\r\n                    <input type="text" class="form-control" data-bind="value: name">\r\n                    <mi-localize type="20" data-bind="attr: { phrase: name, context: translationContext }, value: caption">\r\n                </div>\r\n            </div>\r\n            <div class="block radio kpi-view-type">\r\n                <mi-radio data-bind="miRadioProperty:{\r\n                      checked: $root.widgetVM.kpiChartType,\r\n                      value: \'Dial\',\r\n                      name: \'KPI Dashboard\',\r\n                      disable: false,\r\n                      text: $parent.translate(\'METRICS_KPI_VIEWER_DIAL_VIEW\')\r\n                      }">\r\n                </mi-radio>\r\n            </div>\r\n            <div class="block radio kpi-view-type">\r\n                <mi-radio data-bind="miRadioProperty:{\r\n                      checked: $root.widgetVM.kpiChartType,\r\n                      value: \'Bullet\',\r\n                      name: \'KPI Dashboard\',\r\n                      disable: false,\r\n                      text: $parent.translate(\'METRICS_KPI_VIEWER_BULLET_VIEW\')\r\n                      }">\r\n                </mi-radio>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!-- /ko -->\r\n    <div class="availableKPIs block-group kpi-list-group">\r\n        <mi-list-group class="kpi-list" selector="toggle"\r\n                       multiSelect="true"\r\n                       key="key"\r\n                       description="name"\r\n                       page="1"\r\n                       page-size="35"\r\n                       custom-filter="true"\r\n                       allow-add="false"\r\n                       scroll-percent="0.75"\r\n                       custom-search="false"\r\n                       data-bind="event: { \'search-selected\': setValue }">\r\n            <mi-tool-bar>\r\n                <span data-bind="text: translator.translate(\'KPI_DASHBOARD_ALL_KPIS\')"></span>\r\n                <button class="btn btn-icon pull-right" data-bind="click: moveAvailableKPIs"><i class="icon-export"></i></button>\r\n            </mi-tool-bar>\r\n\r\n        </mi-list-group>\r\n    </div>\r\n    <div class="selectedKPIs block-group kpi-list-group">\r\n        \r\n        <mi-list-group class="kpi-list" selector="toggle"\r\n                       multiSelect="true"\r\n                       key="key"\r\n                       use-html="true"\r\n                       description="name"\r\n                       page="1"\r\n                       page-size="25"\r\n                       custom-filter="true"\r\n                       allow-add="false"\r\n                       scroll-percent="0.75"\r\n                       custom-search="false">\r\n            <mi-tool-bar class="kpi-tool-bar">\r\n                <span data-bind="text: translator.translate(\'KPI_DASHBOARD_DISPLAY_KPIS\') + \' (\' + $root.selectedKPIsOnRight().length + \')\'"></span>\r\n                <button class="btn btn-icon pull-right" data-bind="click: moveSelectedKPIs" style="transform:rotate(180deg)"><i class="icon-export"></i></button>\r\n            </mi-tool-bar>\r\n        </mi-list-group>\r\n    </div>\r\n    <div class="reorder-btn-group reorder-btn-vertical block-group" >\r\n        <button class="btn btn-icon block" data-bind="enable: $root.selectedKPIsOnRight().length > 1, click: moveKPIUp, attr: {title: translator.translate(\'UP\')}" title="Up"><i class="icon-up-arrow"></i></button>\r\n        <button class="btn btn-icon block" data-bind="enable: $root.selectedKPIsOnRight().length > 1, click: moveKPIDown, attr: {title: translator.translate(\'DOWN\')}" title="Down"><i class="icon-arrow"></i></button>\r\n    </div>\r\n</div>\r\n';});

define('dashboard/views/kpi-widget-editor-view',['require','text!../views/kpi-widget-editor.html'],function(require){"use strict";var a=require("text!../views/kpi-widget-editor.html");function b(){this.region=null}return b.html=a,b.prototype.attach=function(a){this.region=a},b.prototype.detach=function(){this.region=null},b});
define('dashboard/view-models/kpi-widget-editor',['require','lodash','jquery','./widget-editor','metrics/kpi-list-view-model','system/ui/dialog-box','system/globalization/translator','toastr','../views/kpi-widget-editor-view','ui/elements/localize/localize-element','ui/elements/list-group/view-model'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./widget-editor"),d=require("metrics/kpi-list-view-model"),e=require("system/ui/dialog-box"),f=require("system/globalization/translator"),g=require("toastr"),h=require("../views/kpi-widget-editor-view");require("ui/elements/localize/localize-element"),require("ui/elements/list-group/view-model");function i(a){j.call(this,a,h.html),this.editorView=Object.resolve(h),this.translator=Object.resolve(f),this.backup.key=this.kom.observable(),this.backup.kpiName=this.kom.observable(),this.toEnableSave=this.kom.observable(),this.availableKPIListGroup=null,this.selectedKPIListGroup=null,this.selectedKPIsOnLeft=[],this.selectedKPIsOnRight=this.kom.observableArray([]),this.availableitems=[]}var j=Object.inherit(c,i);function k(a,c,d){var e=b.Deferred();return e.resolve(l(a,a.availableitems,c,d)),e.promise()}function l(b,c,d,e){return a.take(a.drop(c,(d-1)*e),e)}i.prototype.setValue=function(a,b){
null!==b.target._searchList&&(b.target._searchList._value=null,b.target._searchList.searchResult=[])};function m(a){var c=b.Deferred(),e=Object.resolve(d);return"Dial"===a.widgetVM.kpiChartType()&&a.widgetVM.key()?e.kpiService.getKpiDetails(a.widgetVM.key()).done(function(b){a.selectedKPIListGroup.items=[b],a.selectedKPIsOnRight(a.selectedKPIListGroup.items),a.toEnableSave(a.selectedKPIsOnRight()[0])}).fail(function(a){}):(a.selectedKPIListGroup.items=a.widgetVM.selectedKpis(),a.selectedKPIsOnRight(a.selectedKPIListGroup.items),a.toEnableSave(a.selectedKPIsOnRight()[0])),c.resolve(a.selectedKPIListGroup.items),c.promise()}function n(c,d,e,f){var g=b.Deferred(),h=d.trim().toLowerCase(),i=[];return i=h?a.filter(c.availableitems,function(a){return a.name.toLowerCase().indexOf(h)!==-1}):c.availableitems,g.resolve(l(c,i,e,f)),g.promise()}i.prototype.moveAvailableKPIs=function c(){var d=b.Deferred(),e=this;if("Dial"===e.widgetVM.kpiChartType()){
if(e.selectedKPIsOnLeft.length>1||e.selectedKPIListGroup.items.length>0)return void g.warning(e.translator.translate("KPI_DASHBOARD_DIAL_SELECTION"))}else{if(a.uniqBy(a.union(e.selectedKPIListGroup.items,e.selectedKPIsOnLeft),function(a){return a.key}).length>10)return void g.warning(e.translator.translate("KPI_DASHBOARD_BULLET_SELECTION"))}e.selectedKPIListGroup.items=a.uniqBy(a.union(e.selectedKPIListGroup.items,e.selectedKPIsOnLeft),function(a){return a.key}),e.availableitems=a.filter(e.availableitems,function(a){return e.selectedKPIsOnLeft.indexOf(a)===-1}),e.availableKPIListGroup.items=a.filter(e.availableKPIListGroup.items,function(a){return e.selectedKPIsOnLeft.indexOf(a)===-1}),e.selectedKPIsOnRight(e.selectedKPIListGroup.items),e.availableKPIListGroup.selectedItems=[],e.selectedKPIsOnLeft=[],e.toEnableSave(e.selectedKPIsOnRight()[0]),b(".kpi-list > .search-list")[0]&&b(".kpi-list > .search-list")[0].reload(),d.resolve(e.selectedKPIListGroup.items)},
i.prototype.onSelectedKPIsFromLeft=function a(b){this.selectedKPIsOnLeft=b.target.selectedItems},i.prototype.moveSelectedKPIs=function b(){var c=this;c.availableKPIListGroup.items=a.uniqBy(a.union(c.availableKPIListGroup.items,c.selectedKPIListGroup.selectedItems),function(a){return a.key}),c.availableKPIListGroup.items=a.sortBy(c.availableKPIListGroup.items,function(a){return a.name.toLowerCase()}),c.availableitems=c.availableKPIListGroup.items,c.selectedKPIsOnRight(a.difference(c.selectedKPIListGroup.items,c.selectedKPIListGroup.selectedItems)),c.selectedKPIListGroup.items=c.selectedKPIsOnRight(),c.widgetVM.widget.name(""),c.toEnableSave(c.selectedKPIsOnRight()[0])},i.prototype.moveKPIUp=function b(){var c=this;if(1===c.selectedKPIListGroup.selectedItems.length){var d=c.selectedKPIListGroup.selectedItems[0],e=a.findIndex(c.selectedKPIsOnRight(),{key:d.key});if(e>0){var f=c.selectedKPIsOnRight()[e];c.selectedKPIsOnRight()[e]=c.selectedKPIsOnRight()[e-1],c.selectedKPIsOnRight()[e-1]=f}
c.selectedKPIListGroup.items=c.selectedKPIsOnRight(),c.selectedKPIListGroup.selectedItems=[d]}},i.prototype.moveKPIDown=function b(){var c=this;if(1===c.selectedKPIListGroup.selectedItems.length){var d=c.selectedKPIListGroup.selectedItems[0],e=a.findIndex(c.selectedKPIsOnRight(),{key:d.key});if(e<c.selectedKPIsOnRight().length-1){var f=c.selectedKPIsOnRight()[e];c.selectedKPIsOnRight()[e]=c.selectedKPIsOnRight()[e+1],c.selectedKPIsOnRight()[e+1]=f}c.selectedKPIListGroup.items=c.selectedKPIsOnRight(),c.selectedKPIListGroup.selectedItems=[d]}},i.prototype.afterLoad=function(){o(this)},i.prototype.afterSave=function(){var b=this,c=b.widgetVM.translator.translate("KPI_WIDGET");if("Bullet"===b.widgetVM.kpiChartType()){var d=[];a.each(b.selectedKPIListGroup.items,function(c){var e=a.pick(c,"name","key");e.chartType=b.widgetVM.kpiChartType(),d.push(e)}),b.widgetVM.selectedKpis(d),""===b.widgetVM.widget.name()?b.widgetVM.widget.name(c):b.widgetVM.widget.name(b.widgetVM.widget.name())
}else b.selectedKPIListGroup.items.length>0?(b.widgetVM.kpiName(b.selectedKPIListGroup.items[0].name),b.widgetVM.key(b.selectedKPIListGroup.items[0].key),b.widgetVM.widget.name()===c||""===b.widgetVM.widget.name()?b.widgetVM.widget.name(b.widgetVM.kpiName()):b.widgetVM.widget.name(b.widgetVM.widget.name()),b.widgetVM.selectedKpis([{name:b.widgetVM.kpiName(),key:b.widgetVM.key(),chartType:b.widgetVM.kpiChartType()}])):b.widgetVM.selectedKpis([]),b.selectedKPIListGroup.items.length>1&&g.warning(b.translator.translate("KPI_DASHBOARD_DIAL_SELECTION"));p(this)},i.prototype.afterCancel=function(){q(this)},i.prototype.afterAttach=function(a){var c=this;this.editorView.attach(a),j.prototype.handleRequiredFields.call(this,this.toEnableSave),Element.upgrade(a.element.querySelectorAll("mi-localize")),c.region=a,c.loadKPIList(),c.availableKPIListGroup=c.region.$element.find("mi-list-group")[0],Element.upgrade(c.availableKPIListGroup),c.availableKPIListGroup.loader=k.bind(null,c),
c.availableKPIListGroup.searchCallback=n.bind(null,c),b(this.availableKPIListGroup).on("selected",this.onSelectedKPIsFromLeft.bind(this)),c.selectedKPIListGroup=c.region.$element.find("mi-list-group")[1],Element.upgrade(c.selectedKPIListGroup),c.selectedKPIListGroup.loader=m.bind(null,c)},i.prototype.afterDetach=function(){this.editorView.detach()},i.prototype.loadKPIList=function(){var a=Object.resolve(d),b=this;a.kpiService.getKpiList(0,0,null,!1,null).done(function(a){b.availableitems=a,b.availableKPIListGroup.reload()}).fail(function(a){})};function o(a){a.backup.key(a.widgetVM.key()),a.backup.kpiName(a.widgetVM.kpiName())}function p(a){a.backup.key(null),a.backup.kpiName(null)}function q(a){a.widgetVM.key(a.backup.key()),a.widgetVM.kpiName(a.backup.kpiName())}return i});

define('text!dashboard/views/kpi-widget.html',[],function () { return '<section class="kpi-widget" data-bind="css : { \'kpi-bullet\' : $root.kpiChartType() === \'Bullet\'}">\r\n    <div class="kpi-widget-container" data-bind="foreach : selectedKpis">\r\n       \r\n        <a class="block label-text" data-bind="visible : $data.chartType === \'Bullet\',text:$root.abbreviateText($data.name), \r\n           css: { \'compare-kpi\' : $root.gridWidth && $root.gridWidth() !== 24 }, attr : {title: $data.name}, click:$root.goto.bind($parent, $data.name)" href="" target="tab"></a>\r\n        <kpi-widget class="block" params="properties:$data,resize:$root.isResized, refresh: $root.isRefreshed"\r\n                    data-bind="css : {  \'bullet-style\': $data.chartType === \'Bullet\', \'twoCol\': $root.gridWidth && $root.gridWidth() === 24}">\r\n        </kpi-widget>\r\n       \r\n    </div>\r\n    <div data-bind="visible:$root.kpiChartType() === \'Bullet\'" class="kpi-legend">\r\n        <i class="icon-constant legend-low-risk"></i><span class="legend-label" data-bind="text:$root.translator.translate(\'KPI_DASHBOARD_LOW_RISK_LEGEND\')"></span>\r\n        <i class="icon-constant legend-med-risk"></i><span class="legend-label" data-bind="text:$root.translator.translate(\'KPI_DASHBOARD_MED_RISK_LEGEND\')"></span>\r\n        <i class="icon-constant legend-high-risk"></i><span class="legend-label" data-bind="text:$root.translator.translate(\'KPI_DASHBOARD_HIGH_RISK_LEGEND\')"></span>\r\n        <i class="icon-constant legend-very-high-risk"></i><span class="legend-label" data-bind="text:$root.translator.translate(\'KPI_DASHBOARD_VHIGH_RISK_LEGEND\')"></span>\r\n    </div>\r\n</section>\r\n';});

define('metrics/models/kpi-data-model',['require','lodash','system/lang/converter','knockout'],function(require){"use strict";var a=require("lodash"),b=require("system/lang/converter"),c=require("knockout");function d(){var a=this;a.key=void 0,a.id=void 0,a.description=void 0,a.lastMeasurementDate=void 0,a.prevMeasurementDate=void 0,a.lastMeasurementValue=void 0,a.prevMeasurementValue=void 0,a.lastMeasurementScore=void 0,a.prevMeasurementScore=void 0,a.lastMeasurementColor=void 0,a.prevMeasurementColor=void 0,a.lastMeasurementRange=void 0,a.prevMeasurementRange=void 0,a.delta=void 0,a.deltaPercentage=void 0,a.deltaScore=void 0,a.deltaScorePercentage=void 0,a.measurementRange=[],a.history=[],a.lastUpdate=void 0,a.lastScheduledUpdate=void 0,a.nextScheduledUpdate=void 0,a.numberFormat="n0",a.children=[],a.canView=c.observable(),a.canUpdate=c.observable(),a.canDelete=c.observable(),a.scorecards=c.observableArray(),a.parent=c.observable(),a.lastUpdateDate=void 0,a.lastUpdateBy=void 0,a.showScore=!1,a.chartType="Dial"}d.prototype.loadFromDTO=function c(d){if(d){var g=this
;g.key=d.key,g.id=d.id,g.description=d.description,g.numberFormat=d.numberFormat?d.numberFormat:"n0",g.lastMeasurementDate=b.toNullableDate(d.lastMeasurementDate),g.prevMeasurementDate=b.toNullableDate(d.prevMeasurementDate),g.lastMeasurementValue=d.lastMeasurementValue,g.prevMeasurementValue=d.prevMeasurementValue,g.lastMeasurementScore=d.lastMeasurementScore,g.prevMeasurementScore=d.prevMeasurementScore,g.lastMeasurementColor=d.lastMeasurementColor,g.prevMeasurementColor=d.prevMeasurementColor,g.lastMeasurementRange=d.lastMeasurementRange,g.prevMeasurementRange=d.prevMeasurementRange,g.currentUserPrivilege=d.currentUserPrivilege,g.showScore=d.showScore,g.bestAndWorstEqual=d.bestAndWorstEqual,g.chartType=d.chartType,a.isFinite(g.lastMeasurementValue)&&a.isFinite(g.prevMeasurementValue)&&(g.delta=g.lastMeasurementValue-g.prevMeasurementValue,
0===g.prevMeasurementValue&&0!==g.lastMeasurementValue?g.deltaPercentage=1:0===g.delta?g.deltaPercentage=0:g.deltaPercentage=g.delta/Math.abs(g.prevMeasurementValue)),g.showScore&&a.isFinite(g.lastMeasurementScore)&&a.isFinite(g.prevMeasurementScore)&&(g.deltaScore=g.lastMeasurementScore-g.prevMeasurementScore,0===g.prevMeasurementScore&&0!==g.lastMeasurementScore?g.deltaScorePercentage=1:0===g.deltaScore?g.deltaScorePercentage=0:g.deltaScorePercentage=g.deltaScore/Math.abs(g.prevMeasurementScore)),g.lastUpdate=b.toNullableDate(d.lastUpdate),g.lastScheduledUpdate=b.toNullableDate(d.lastScheduledUpdate),g.nextScheduledUpdate=b.toNullableDate(d.nextScheduledUpdate),g.measurementRange=d.measurementRange,g.history=a.map(d.history,e),g.children=a.map(d.children,f),g.canView(d.currentUserPrivilege.canView||d.currentUserPrivilege.canDelete||d.currentUserPrivilege.canUpdate),g.canDelete(d.currentUserPrivilege.canDelete),
g.canUpdate(d.currentUserPrivilege.canUpdate||d.currentUserPrivilege.canDelete),g.scorecards(a.map(d.scorecards,function(a){return{name:a.name,key:a.entityKey}})),g.lastUpdateDate=b.toNullableDate(d.lastUpdateDate),g.lastUpdateBy=d.lastUpdateBy,d.parent&&g.parent({text:d.parent.id,value:d.parent.key})}};function e(a){return{date:b.toNullableDate(a.date),value:a.value,score:a.score,color:a.color,range:a.range}}function f(a){var b=new d;return b.loadFromDTO(a),b}return d});

define('text!system/error-handler/views/error-handler-view.html',[],function () { return '<div class="error-handler">\r\n\t<ul>\r\n\t\t<li>\r\n\t\t    <i class="icon-less-than previous"></i>\r\n\t\t</li>\r\n\t\t<li>\r\n\t    \t<span><span class="current-error-text">Error</span> <span class="current-error-number"></span> <span class="of-text">of</span> <span class="total-errors"></span></span>\r\n\t\t</li>\r\n\t\t<li>\r\n\t    \t<i class="icon-greater-than next"></i>\r\n\t\t</li>\r\n\t\t<li>\r\n\t    \t<span class="current-error"></span>\r\n\t\t</li>\r\n\t\t<li>\r\n\t    \t<span class="current-error-view-details link-txt">View Details</span> \r\n\t\t</li>\r\n\t\t<li>\r\n\t\t    <span class="vert-line"></span>\r\n\t\t</li>\r\n\t\t<li>\r\n\t    \t<span class="go-to-source-link link-txt">Go to source</span>\r\n\t\t</li>\r\n\t</ul>\r\n</div>';});

define('system/error-handler/error-handler',['require','lodash','jquery','text!./views/error-handler-view.html','system/ui/message-box','system/lang/event','system/globalization/translator'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./views/error-handler-view.html"),d=require("system/ui/message-box"),e=require("system/lang/event"),f=require("system/globalization/translator");function g(a,b){this.errorHandlerClosedEvent=new e,this.errorHandlerShowEvent=new e,this.translator=Object.resolve(f),this.init(a,b)}function h(a){a.currentErrorNumber=a.currentErrorNumber-1,a.updateView()}function i(a){a.currentErrorNumber=a.currentErrorNumber+1,a.updateView()}function j(a){d.showOk(a.errorArray[a.currentErrorNumber].longDesc,a.errorArray[a.currentErrorNumber].title,"fa fa-warning fa-2x")}function k(a){a.errorArray[a.currentErrorNumber].sourceCallBack()}return g.prototype.init=function a(d,e){d||(d=b("section.content-wrapper > section.content > div.region")),this.errorArray=e?e:[],this.currentErrorNumber=0,d.children("div.error-handler").remove(),0===d.children("div.error-handler").eq(0).length&&(d.prepend(c),
this.errorContainer=d.children("div.error-handler"),this.errorContainer.find("span.current-error-view-details").text(this.translate("VIEW_DETAILS")),this.errorContainer.find("span.go-to-source-link").text(this.translate("GO_TO_SOURCE")),this.errorContainer.find("span.current-error-text").text(this.translate("NOTIFICATION")),this.errorContainer.find("span.of-text").text(this.translate("OF")),this.errorContainer.find("i.previous").on("click",h.bind(null,this)),this.errorContainer.find("i.next").on("click",i.bind(null,this)),this.errorContainer.find("span.current-error-view-details").on("click",j.bind(null,this)),this.errorContainer.find("span.go-to-source-link").on("click",k.bind(null,this)),this.updateView())},g.prototype.showErrorHandler=function a(){this.errorContainer.show(),this.errorContainer.siblings().height("calc(100% - "+this.errorContainer.outerHeight()+"px)"),this.errorHandlerShowEvent.raise(this.errorContainer.outerHeight())},g.prototype.hideErrorHandler=function a(){
this.errorContainer.hide(),this.errorContainer.siblings().height("100%"),this.errorHandlerClosedEvent.raise(this.errorContainer.outerHeight())},g.prototype.addError=function a(b){this.errorArray.push(b),this.updateView()},g.prototype.removeError=function a(b){var c="object"==typeof b?this.errorArray.indexOf(b):b;this.errorArray.splice(c,1),this.errorArray.length===this.currentErrorNumber&&this.errorArray.length>0&&(this.currentErrorNumber=this.errorArray.length-1),this.updateView()},g.prototype.updateView=function b(c,d){var e;if(!(this.errorArray.length>0))return this.hideErrorHandler(),"No error to show";e=this.errorArray[this.currentErrorNumber]||null,this.showErrorHandler(),0===this.currentErrorNumber?this.errorContainer.find("i.previous").css("visibility","hidden"):this.errorContainer.find("i.previous").css("visibility","visible"),
this.currentErrorNumber===this.errorArray.length-1?this.errorContainer.find("i.next").css("visibility","hidden"):this.errorContainer.find("i.next").css("visibility","visible"),this.errorContainer.removeClass("error warning info").addClass(e.severity),this.errorContainer.find("span.current-error").text(e.title),this.errorContainer.find("span.current-error-number").text(this.currentErrorNumber+1),this.errorContainer.find("span.total-errors").text(this.errorArray.length),this.errorContainer.find(".current-error-view-details").css("display",e.longDesc?"inline":"none"),this.errorContainer.find(".go-to-source-link").css("display",a.isFunction(e.sourceCallBack)?"inline":"none"),this.handleDivider()},g.prototype.getTotalErrors=function b(c){return c?a.filter(this.errorArray,function(a){return a.severity===c}).length:this.errorArray.length},g.prototype.handleDivider=function a(b){
this.errorContainer.find(".current-error-view-details").is(":hidden")||this.errorContainer.find(".go-to-source-link").is(":hidden")?this.errorContainer.find("span.vert-line").hide():this.errorContainer.find("span.vert-line").show()},g.prototype.translate=function a(b){return this.translator.translate(b)},g});
define('system/knockout/knockout-helpers',['require','ramda','jquery','system/lang/object','knockout','xss','system/globalization/translator','system/error-handler/error-handler','system/text/parser','system/lang/functional','system/text/formatter','jquery-ui'],function(require){"use strict";var a=require("ramda"),b=require("jquery");require("system/lang/object");var c=require("knockout"),d=require("xss"),e=Object.resolve(require("system/globalization/translator")),f=require("system/error-handler/error-handler"),g=require("system/text/parser"),h=require("system/lang/functional"),i=require("system/text/formatter");require("jquery-ui");function j(a,d){c.bindingHandlers[a]={init:function(e,f,g,h){var i=new d(e,f,g,h);return b(e).data(a+"-binding",i),c.utils.domNodeDisposal.addDisposeCallback(e,function(){var c=b(e).data(a+"-binding");c.dispose&&c.dispose(e),b(e).removeData(a+"-binding")}),i.init&&i.init(e,f,g,h),c.applyBindingsToDescendants(i,e),{controlsDescendantBindings:!0}},update:function(c,d,e,f){var g=b(c).data(a+"-binding");g.update&&g.update(c,d,e,f)}}}c.appendTemplateScript=function(a,c){var d=b.Deferred();return document.getElementById(a)?d.resolve():b.ajax({url:c,dataType:"html"}).done(function(c){
var e=b("<script>").attr("id",a).attr("type","text/html").html(c);b("body").append(e),d.resolve()}),d.promise()},c.bindingHandlers.jqIconButton={init:function(a,d){var e=d(),f=c.unwrap(e.icon),g=c.unwrap(e.text),h=Object.defaultValue(c.unwrap(e.enabled),!0);f&&b(a).html('<i class="'+f+'"></i>')},update:function(a,d){var e=d(),f=c.unwrap(e.enabled),g=f?1:.5;b(a).find("i").css("opacity",g)}},c.bindingHandlers.toolTip={init:function(a,c){b(a).tooltip({content:c(),html:!0})},update:function(a,c){b(a).tooltip({content:c(),html:!0,tooltipClass:"datasheet-tooltip"})}},c.bindingHandlers.jqButton={init:function(a,d){var e=d(),f=c.unwrap(e.label),g=Object.defaultValue(c.unwrap(e.enabled),!0),h=c.unwrap(e.title);b(a).attr("title",h).button({disabled:!g}),e.label&&b(a).button("option","label",f)},update:function(a,d){var e=d(),f=c.unwrap(e.label),g=c.unwrap(e.enabled),h=c.unwrap(e.title);b(a).attr("title",h).button("option","disabled",g===!1),e.label&&b(a).button("option","label",f),
e.primaryIcon&&e.secondaryIcon?b(a).button("option","icons",{primary:e.primaryIcon,secondary:e.secondaryIcon}):e.primaryIcon&&b(a).button("option","icons",{primary:e.primaryIcon})}},c.bindingHandlers.localText={init:function(a,d){var f=c.utils.unwrapObservable(d());b(a).text(e.translate(f))},update:function(a,d){var f=c.utils.unwrapObservable(d());b(a).text(e.translate(f))}},c.bindingHandlers.localTitle={init:function(a,b){var d=c.utils.unwrapObservable(b());a.title=e.translate(d)},update:function(a,b){var d=c.utils.unwrapObservable(b());a.title=e.translate(d)}},c.bindingHandlers.xssHtml={update:function(a,e){var f=c.unwrap(e());b(a).html(d(f))}},c.bindingHandlers.required={init:function(a,d){c.unwrap(d())?b(a).attr("required","required"):b(a).removeAttr("required")},update:function(a,d){c.unwrap(d())?b(a).attr("required","required"):b(a).removeAttr("required")}},c.bindingHandlers.slide={init:function(a,d){var e=d(),f=c.unwrap(e.visible),g=c.unwrap(e.duration||"fast")
;f?b(a).slideDown(g):b(a).hide()},update:function(a,d){var e=d(),f=c.unwrap(e.visible),g=c.unwrap(e.duration||"fast");f?b(a).slideDown(g):b(a).slideUp(g)}},c.bindingHandlers.fade={init:function(a,d){var e=d(),f=c.unwrap(e.visible),g=c.unwrap(e.duration||"fast");f?b(a).fadeIn(g):b(a).hide()},update:function(a,d){var e=d(),f=c.unwrap(e.visible),g=c.unwrap(e.duration||"fast");f?b(a).fadeIn(g):b(a).fadeOut(g)}},c.utils.setOptionNodeSelectionState=function(a,b){navigator.userAgent.indexOf("MSIE 6")>=0?a.setAttribute("selected",b):a.selected=b},c.bindingHandlers.groupedOptions=function(){function a(a,f,g){var h,i,j;b(a);var k=[];for(h=0;h<a.childNodes.length;h++){var l=a.childNodes[h];if("OPTGROUP"===l.tagName){if(void 0!==l.childNodes)for(var m=0;m<l.childNodes.length;m++){var n=l.childNodes[m];n.tagName&&"OPTION"===n.tagName&&n.selected&&k.push(c.selectExtensions.readValue(n))}}else l.tagName&&"OPTION"===l.tagName&&l.selected&&k.push(c.selectExtensions.readValue(l))}
var o=a.scrollTop,p=c.utils.unwrapObservable(f());if(a.innerHTML="",p){var q=g();"number"!=typeof p.length&&(p=[p]),q.optionsCaption&&(j=document.createElement("OPTION"),j.innerHTML=q.optionsCaption,c.selectExtensions.writeValue(j,void 0),a.appendChild(j));var r=[],s=q.optionsGroup;for(h=0,i=p.length;h<i;h++){var t="";"function"==typeof s?t=s(p[h]):"string"==typeof s&&(t=c.utils.unwrapObservable(p[h][s])),t=t||"",void 0===r[t]&&(r[t]=[]),r[t].push(p[h])}for(var u in r)if(r.hasOwnProperty(u)){var v=null;for(""!==u&&(v=document.createElement("OPTGROUP"),v.label=u,a.appendChild(v)),h=0,i=r[u].length;h<i;h++){var w=r[u],x="string"==typeof q.optionsValue?w[h][q.optionsValue]:w[h],y=x;j=document.createElement("OPTION");var z=q.optionsText;"function"==typeof z?y=z(w[h]):"string"==typeof z&&(y=w[h][z]),x=c.utils.unwrapObservable(x),y=c.utils.unwrapObservable(y),c.selectExtensions.writeValue(j,x),j.innerHTML=y.toString(),null!==v?v.appendChild(j):a.appendChild(j)}}d(a,k),e(a,o)}}function b(a){
if("SELECT"!==a.tagName)throw new Error("groupedOptions binding applies only to SELECT elements")}function d(a,b){var d,e,f=a.getElementsByTagName("OPTION"),g=0;for(d=0,e=f.length;d<e;d++)c.utils.arrayIndexOf(b,c.selectExtensions.readValue(f[d]))>=0&&(c.utils.setOptionNodeSelectionState(f[d],!0),g++)}function e(a,b){b&&(a.scrollTop=b)}return{update:a}}(),c.extenders.validate=function(a,d){var g,h,i,j,k,l,m,n;b.isFunction(d)?g=d:(g=d.validationCallback,h=d.errorLevel,i=d.title,j=d.message,k=d.gotoCallback,l=d.controlSelector,m=d.errorHandler||Object.resolve(f),n=d.useValidationBar!==!0&&d.useValidationBar!==!1||d.useValidationBar),a.invalid=c.computed(function(){return a(),!g(a())}),a.validationError=void 0;function o(){n===!0&&(a.invalid()?a.validationError||(a.validationError={title:c.unwrap(i||e.translate("VALIDATION_ERROR")),longDesc:c.unwrap(j||void 0),severity:c.unwrap(h||"error"),sourceCallBack:k},
m.addError(a.validationError)):a.validationError&&(m.removeError(a.validationError),a.validationError=void 0))}return a.validationSubscription=a.invalid.subscribe(o),o(),a.dispose=function(){a.validationSubscription.dispose(),a.invalid.dispose(),n&&a.validationError&&(m.removeError(a.validationError),a.validationError=void 0)},a},c.extenders.preventChange=function(a,b){return c.computed({read:a,write:function(c){var d=a(),e=b.call(this,d,c);e!==!0&&e!==!1&&void 0!==e&&e.done?e.done(function(){a(c)}):e===!0&&a(c)}})},c.extenders.trackLastValue=function(a,b){var d=c.observable(b),e=c.computed({read:a,write:function(b){d(a()),a(b)}});return e.lastValue=d,e(a()),e},c.extenders.forceNumeric=function(a){var b=c.pureComputed({read:a,write:function(b){var c=a(),d,e;d=null===b||""===b||isNaN(b)?null:parseFloat(b),e=d,e!==c?a(e):b!==c&&a.notifySubscribers(e)}}).extend({notify:"always"});return b(a()),b},c.observableArray.fn.trackHasOneItem=function(){return this.hasOneItem=c.observable(),
this.subscribe(function(a){this.hasOneItem(!(!a||1!==a.length))},this),this.valueHasMutated(),this},c.observableArray.fn.trackHasItems=function(){return this.hasItems=c.observable(),this.subscribe(function(a){this.hasItems(!(!a||!a.length))},this),this.valueHasMutated(),this};var k=-1;function l(a,b){var d=this;k++,d.namespace=".combo-box-"+k,d.accessor=b(),d.optionsText=s(d.accessor.optionsText,null),d.value=s(d.accessor.value()),d.inputValue=c.observable(p(d,d.accessor.value())),d.options=s(d.accessor.options,[]),d.multiselect=!1,d.selectedOptions=s(d.accessor.selectedOptions,d.multiselect?[]:[d.value]),d.allowUnmatched=!1,d.allowNull=s(d.accessor.allowNull,!1),d.separator=s(d.accessor.separator,", "),d.allowUnmatched&&(d.multiselect=!1),d.maxOptions=s(d.accessor.maxOptions,"-1"),d.isListOpen=!1,d.updatingValueBinding=!1}l.prototype.init=function(a,d,e,f){var g=this;m(g,a,e,f),n(g,a),o(g),c.isObservable(g.accessor.value)&&(g.valueSubscription=g.accessor.value.subscribe(function(){
if(g.updatingValueBinding)return void(g.updatingValueBinding=!1);g.refresh()})),c.isObservable(g.accessor.options)&&(g.optionsSubscription=g.accessor.options.subscribe(function(){g.options=g.accessor.options()})),b(window).on("click"+g.namespace,a,r.bind(null,g))},l.prototype.dispose=function(a){var c=this;c.disableSubscription&&c.disableSubscription.dispose(),c.valueSubscription&&c.valueSubscription.dispose(),c.optionsSubscription&&c.optionsSubscription.dispose(),b(window).off(c.namespace),b(a).off(),b(a).empty(),b(a).parents(".mi-ui-scroll-y").off(c.namespace),b("body").off(c.namespace)},l.prototype.close=function(){var a=this;a.input.autocomplete("close"),a.isListOpen=!1},l.prototype.refresh=function(){var a=this;a.select(s(a.accessor.value()))},l.prototype.select=function(b){var c=this;c.value=b,c.selectedOptions.length>0&&!a.contains(c.Value,c.selectedOptions)&&c.selectedOptions.pop(),c.selectedOptions.push(c.value),c.inputValue(p(c,c.value))},l.prototype.buttonOnClick=function(){
var a=this;a.input.focus(),a.isListOpen?a.isListOpen=!1:(a.input.autocomplete("search",""),event.stopImmediatePropagation())};function m(a,d,e){d=b(d),a.inputAttrs={},e().attr&&e().attr.input&&(a.inputAttrs=e().attr.input),d.empty(),d.addClass("mi-ui-combo-box"),a.input=b('<input class="form-control" style="border-width:0px;height:20px" data-bind="value: inputValue, valueUpdate: \'input\', disable: accessor.disable, attr: inputAttrs" style="width: 100%">').appendTo(d);var f=b('<i class="input-group-addon icon-arrow" style="padding:0 10px 0 0" data-bind="click: buttonOnClick" tabindex="-1"/>').appendTo(d).button({disabled:s(a.accessor.disable)});f.removeClass("ui-widget ui-state-default ui-corner-all ui-button-disabled ui-state-disabled ui-button-text-only"),c.isObservable(a.accessor.disable)&&(a.disableSubscription=a.accessor.disable.subscribe(function(){f.button("option","disabled",a.accessor.disable())})),a.input.on("keydown",function(c){
c.keyCode===b.ui.keyCode.ESCAPE&&h.defer(function(){a.refresh(),a.isListOpen=!1})}),d.parents(".mi-ui-scroll-y").on("scroll"+a.namespace,a.close.bind(a)),b("body").on("scroll"+a.namespace,a.close.bind(a))}function n(c){function d(a,d){var e=!a.term,f=new RegExp(b.ui.autocomplete.escapeRegex(a.term),"i"),g=[];b.each(c.options,function(d,h){var i=p(c,h);if((e||f.test(i))&&(g.push({label:i.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.ui.autocomplete.escapeRegex(a.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"),value:i,option:h}),c.maxOptions!==-1&&g.length>=c.maxOptions))return!1}),d(g)}function e(a,d){a.keyCode!==b.ui.keyCode.TAB&&(c.isListOpen=!1,c.select(d.item.option),q(c))}function f(a,d){if(!d.item){var e=new RegExp("^"+b.ui.autocomplete.escapeRegex(c.inputValue())+"$","i"),f=!1;b.each(c.options,function(a,b){var d=p(c,b);if(e.test(d))return c.select(b),c.inputValue(d),f=!0,!1}),f||(c.allowUnmatched?c.select(c.inputValue()):c.select(c.value)),q(c)}}function g(){
c.isListOpen=!0}function h(){c.multiselect&&q(c)}function i(a,c){var d=b("<li>").appendTo(a).data("item.autocomplete",c);return j(d,c),d}function j(d,e){var f=b("<a>").appendTo(d).html(e.label).mouseover(e,k).mouseout(e,l);a.contains(e.option,c.selectedOptions)&&f.addClass("ui-state-highlight")}function k(d){a.contains(d.data.option,c.selectedOptions)&&b(d.currentTarget).removeClass("ui-state-highlight")}function l(d){a.contains(d.data.option,c.selectedOptions)&&b(d.currentTarget).addClass("ui-state-highlight")}c.input.autocomplete({appendTo:b("body"),delay:0,minLength:0,autoFocus:c.accessor.autoFocus,position:{my:"left top",at:"left bottom",collision:"flip"},source:d,select:e,change:f,open:g,close:h}),c.input.data("autocomplete").menu.element.addClass("mi-ui-combo-box"),c.input.data("autocomplete")._renderItem=i}function o(a){var b=null!==a.value,c=0===a.selectedOptions.length,d=a.options.length>0;!b&&c&&d&&!a.allowNull?(a.select(a.options[0]),q(a)):b&&a.select(a.value)}
function p(c,d){function e(a){return b.map(a,function(a){return p(c,a)}).join(c.separator)}function f(b){return b?c.allowUnmatched&&!a.contains(b,c.options)?b:c.optionsText?s(b[c.optionsText],"").toString():b.toString():""}return b.isArray(d)?e(d):f(d)}function q(a){c.isObservable(a.accessor.value)&&(a.updatingValueBinding=!0,a.accessor.value(a.value)),c.isObservable(a.accessor.selectedOptions)&&a.accessor.selectedOptions(a.selectedOptions)}function r(a,c){var d=c.data;b.contains(d,c.srcElement)||a.close()}function s(a,c){return(b.isFunction(a)?a():a)||c}j("combo-box",l),c.bindingHandlers.sort={init:function(a,c){var d=!1;a.style.cursor="pointer",a.onclick=function(){var a=c(),e=a.prop,f=a.arr;d?(b(this).parent().find(".icon-up-arrow, .icon-arrow").remove(),b(this).append('<div class="icon-arrow" style="float: right;"></div>')):(b(this).parent().find(".icon-up-arrow, .icon-arrow").remove(),b(this).append('<div class="icon-up-arrow" style="float: right;"></div>')),d=!d,
f.sort(function(a,b){var c=a,f=b;d||(c=b,f=a);var g=e.split(".");for(var h in g)if(g.hasOwnProperty(h)){var i=g[h],j=i.indexOf("()");j>0?(i=i.substring(0,j),c=c[i](),f=f[i]()):(c=c[i],f=f[i])}return c===f?0:c<f?-1:1})}}},c.bindingHandlers.datetime={init:function(a,d){a=b(a);var e=d(),f=c.unwrap(Object.defaultValue(e.ampm,!1)),g=c.unwrap(Object.defaultValue(e.format,"hh:mm:ss")),h=c.unwrap(Object.defaultValue(e.showHour,!0)),i=c.unwrap(Object.defaultValue(e.showMinute,!0)),j=c.unwrap(Object.defaultValue(e.showSecond,!0)),k=c.unwrap(Object.defaultValue(e.showMillisec,!1)),l=c.unwrap(Object.defaultValue(e.stepHour,.25)),m=c.unwrap(Object.defaultValue(e.stepMinute,.25)),n=c.unwrap(Object.defaultValue(e.stepSecond,.25)),o=c.unwrap(Object.defaultValue(e.stepMillisec,.5)),p={ampm:f,timeFormat:g,showHour:h,showMinute:i,showSecond:j,showMillisec:k,stepHour:l,stepMinute:m,stepSecond:n,stepMillisec:o};a.datetimepicker(p)}};function t(a,d,e){
var f=d(),g=c.utils.unwrapObservable(f),h=e(),j=c.utils.unwrapObservable(h.dataType),k,l=h.exponentMin||null,m=h.exponentMax||null,n=b(a),o=n.is(":focus"),p=Object.resolve(i),q;switch(j){case"integer":case"I":k=h.integerFormat,o&&h.integerFormatEdit&&(k=h.integerFormatEdit);break;case"decimal":case"N":k=h.decimalFormat,o&&h.decimalFormatEdit&&(k=h.decimalFormatEdit);break;case"dateTime":case"D":k=h.dateTimeFormat,o&&h.dateTimeFormatEdit&&(k=h.dateTimeFormatEdit);break;case"currency":case"C":k=h.currencyFormat,o&&h.currencyFormatEdit&&(k=h.currencyFormatEdit);break;default:k=h.integerFormat||h.decimalFormat||h.dateTimeFormat||h.currencyFormat}k=u(k,l,m,x(g)),q=p.format(x(g),k),n.val(q),n.text(q)}function u(a,b,c,d){return null===b||null===c?a:(v(a)&&w(b,c,d)&&(a=a.replace("e","")),a)}function v(a){return a=a||"",a.indexOf("e")>-1}function w(a,b,c){var d=Math.abs(c);return a=x(Math.abs(a)||0),b=x(Math.abs(b)||0),0===c||a<d&&d<b}function x(a){return isNaN(a)||""===a?a:parseFloat(a)}
c.bindingHandlers.formattedValue={init:function(a,d,e){if(c.isObservable(d())){var f=e(),h=f.valueUpdate||"change",i=b(a);i.on(h,function(){var a=d(),b=c.utils.unwrapObservable(f.dataType),e=i.val();if(b||(f.integerFormat?b="integer":f.decimalFormat?b="decimal":f.dateTimeFormat?b="dateTime":f.currencyFormat&&(b="currency")),""!==e)switch(b){case"integer":case"I":var h=g.parseInt(e);isNaN(h)||(e=h);break;case"decimal":case"N":case"currency":case"C":var j=g.parseFloat(e);isNaN(j)||(e=j);break;case"dateTime":case"D":e=g.parseDate(e)}a(e)}),c.utils.domNodeDisposal.addDisposeCallback(i,function(){b(i).off()}),i.focusin(function(){c.bindingHandlers.formattedValue.updateFormat(a,d,e)}),i.focusout(function(){c.bindingHandlers.formattedValue.updateFormat(a,d,e)})}},update:function(a,d,e){var f=e(),g="INPUT"===a.nodeName,h=Object.defaultValue(f.formatOnce,g),i=b(a);h&&i.val()||c.bindingHandlers.formattedValue.updateFormat(a,d,e)},updateFormat:t}});
define('ui/elements/kpi-widget/kpi-widget-view-model',['require','lodash','jquery','knockout','metrics/services/kpi-service','metrics/models/kpi-data-model','system/text/formatter','system/globalization/translator','highcharts','kobindings','system/knockout/knockout-helpers'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("metrics/services/kpi-service"),e=require("metrics/models/kpi-data-model"),f=require("system/text/formatter"),g=require("system/globalization/translator"),h=require("highcharts");require("kobindings"),require("system/knockout/knockout-helpers");var i={name:"",chartType:"Dial"};function j(h,j){var n=this;n.subscriptions=[],n.isBusy=c.observable(!1),n.rootElement=b(j),n.isResized=h.resize,n.isRefreshed=h.refresh,n.kpiModel=c.observable(Object.resolve(e)),n.kpiService=Object.resolve(d),n.formatter=Object.resolve(f),n.translator=Object.resolve(g),n.properties=c.unwrap(h.properties?a.defaults(c.unwrap(h.properties),i):a.clone(i)),n.kpiChartOptions="Bullet"===c.unwrap(n.properties.chartType)?c.computed(a.partial(p,n)):c.computed(a.partial(o,n)),m(n,c.unwrap(n.properties.name)),c.isObservable(n.properties.name)&&n.subscriptions.push(n.properties.name.subscribe(m.bind(null,n))),
c.isObservable(n.isResized)&&n.subscriptions.push(n.isResized.subscribe(k.bind(null,n))),c.isObservable(n.isRefreshed)&&n.subscriptions.push(n.isRefreshed.subscribe(l.bind(null,n)))}j.prototype.dispose=function b(){var c=this;a.each(c.subscriptions,function(a){a.dispose()}),c.subscriptions=null};function k(a){var b=a.rootElement.outerWidth(!0),d=a.rootElement.outerHeight(!0),e=Math.floor(Math.min(b/2,d))-1,f=a.rootElement.find(".kpi-widget-gauge").highcharts();f&&("Dial"===c.unwrap(a.properties.chartType)?f.setSize(2*e,e):f.setSize(.95*b,d))}function l(a){m(a,c.unwrap(a.properties.name))}function m(a,b){""!==b?(a.isBusy(!0),a.kpiService.getKpiDataByName(b).done(n.bind(null,a)).fail(function(b){a.isBusy(!1)})):a.kpiModel(null)}function n(b,d){b.isBusy(!1),b.kpiChartOptions="Bullet"===c.unwrap(b.properties.chartType)?c.computed(a.partial(p,b)):c.computed(a.partial(o,b)),b.kpiModel().loadFromDTO(d[0]),b.kpiModel.valueHasMutated(),k(b)}function o(b){var c={chart:{type:"gauge",
backgroundColor:"transparent",spacing:[20,10,40,10]},lang:{noData:b.translator.translate("NO_DATA_TO_DISPLAY")},title:null,pane:{center:["50%","95%"],size:"190%",startAngle:-90,endAngle:90,background:[{backgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#FaFaFa"],[.5,"#EeEeEe"],[.51,"rgba(255, 255, 255, 0)"]]},borderWidth:0,outerRadius:"100%",innerRadius:"20"}]},tooltip:{enabled:!1},plotOptions:{gauge:{animation:!1,dataLabels:{borderWidth:0,borderRadius:0,enabled:!0,zIndex:5,padding:0,style:{color:"black",fontSize:"26px",fontWeight:"normal",textShadow:null},crop:!1,overflow:"none",formatter:null},dial:{radius:"95%",backgroundColor:"black",borderWidth:0,baseWidth:16,topWidth:2,baseLength:"0.5%",rearLength:"0%"},pivot:{radius:6,backgroundColor:"#FFFFFF",borderColor:"black",borderWidth:4},overshoot:1}},yAxis:{min:null,max:null,lineWidth:0,minorTickInterval:null,tickPositions:[],tickWidth:0,plotBands:[],labels:{distance:10}},credits:{enabled:!1},series:[{name:"Current",data:[]
}]};if(b.kpiModel()){var d=b.kpiModel(),e=[],f=null,g=null,h=[];if(d.showScore)e=a.map(d.measurementRange,"startScore"),d.measurementRange.length>0&&(f=a.minBy(d.measurementRange,"startScore").startScore,g=a.maxBy(d.measurementRange,"endScore").endScore),e.push(g),h=a.map(d.measurementRange,function(a){return{from:a.startScore,to:a.endScore,color:r(a,d.lastMeasurementScore),thickness:"20%"}}),c.yAxis.labels.formatter=function(){return b.formatter.format(this.value,"N2")},c.series[0].data.push(d.lastMeasurementScore),c.plotOptions.gauge.dataLabels.formatter=function(){var c=b.formatter.format(d.lastMeasurementScore,"N2");return a.isFinite(d.deltaScorePercentage)&&(c+=" (",Math.abs(d.deltaScorePercentage)>=.005&&(d.deltaScorePercentage>=0?c+="+":c+="-"),c+=b.formatter.format(Math.abs(d.deltaScorePercentage),"P0"),c+=")"),c};else{e=a.map(d.measurementRange,"startValue"),d.measurementRange.length>0&&(f=a.minBy(d.measurementRange,"startValue").startValue,
g=a.maxBy(d.measurementRange,"endValue").endValue),e.push(g);var i=c.plotOptions.gauge.dial.radius.split("%");h=a.map(d.measurementRange,function(a){return{from:a.startValue,to:a.endValue,color:q(a,d.lastMeasurementValue),thickness:"20%"}}),c.yAxis.labels.formatter=function(){return b.formatter.format(this.value,d.numberFormat)},c.series[0].data.push(d.lastMeasurementValue),c.plotOptions.gauge.dataLabels.formatter=function(){var c=b.formatter.format(d.lastMeasurementValue,d.numberFormat);return a.isFinite(d.deltaPercentage)&&(c+=" (",Math.abs(d.deltaPercentage)>=.005&&(d.deltaPercentage>=0?c+="+":c+="-"),c+=b.formatter.format(Math.abs(d.deltaPercentage),"P0"),c+=")"),c}}c.yAxis.min=f,c.yAxis.max=g,c.yAxis.plotBands=h,c.yAxis.tickPositions=e,c.plotOptions.gauge.dataLabels.style.color=d.lastMeasurementColor}return c}function p(b){h.SVGRenderer.prototype.symbols.line=function(a,b,c,d){return["M",a/3-c/2,b+d/2,"L",2*a+c,b+d/2,"z"]};var c={chart:{type:"bar",backgroundColor:"transparent",
spacing:[20,10,10,40],marginBottom:50,marginTop:20},lang:{noData:b.translator.translate("NO_DATA_TO_DISPLAY")},credits:{enabled:!1},exporting:{enabled:!1},legend:{enabled:!1},title:{text:""},yAxis:{gridLineWidth:0,labels:{align:"center",style:{color:"black",fontSize:"26px",fontWeight:"normal",textShadow:null,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},tooltip:{enabled:!1},plotOptions:{bar:{color:"rgba(0, 0, 0, 0.5)",borderWidth:0},scatter:{marker:{symbol:"line",lineWidth:4,lineHeight:10,lineColor:"#000000"}}}};if(b.kpiModel()){var d=b.kpiModel(),e=[],f=null,g=null,i=[],j={},k=null;d.showScore?(e=a.map(d.measurementRange,"startScore"),d.measurementRange.length>0&&(f=a.minBy(d.measurementRange,"startScore").startScore,g=a.maxBy(d.measurementRange,"endScore").endScore),e.push(g),i=a.map(d.measurementRange,function(a){return{from:a.startScore,to:a.endScore,color:r(a,d.lastMeasurementScore),thickness:"3%"}}),j=a.find(d.measurementRange,function(a){
if("Stretch-Target"===a.name)return a.endScore}),k=j?j.endScore:null,j||(j=a.find(d.measurementRange,function(a){if("Target-Stretch"===a.name)return a.startScore}),k=j?j.startScore:null),c.yAxis={min:f,max:g,title:{enabled:!1},tickPositions:e,tickPositioner:function(){return e},plotBands:i,labels:{formatter:function(){return b.formatter.format(this.value,"N2")},rotation:-30}},c.series=[{type:"bar",data:[d.lastMeasurementScore],pointWidth:5},{type:"scatter",data:[k]}]):(e=a.map(d.measurementRange,"startValue"),d.measurementRange.length>0&&(f=a.minBy(d.measurementRange,"startValue").startValue,g=a.maxBy(d.measurementRange,"endValue").endValue),e.push(g),i=a.map(d.measurementRange,function(a){return{from:a.startValue,to:a.endValue,color:q(a,d.lastMeasurementValue),thickness:"3%"}}),j=a.find(d.measurementRange,function(a){if("Stretch-Target"===a.name)return a.endValue}),k=j?j.endValue:null,j||(j=a.find(d.measurementRange,function(a){if("Target-Stretch"===a.name)return a.startValue}),
k=j?j.startValue:null),c.yAxis={min:f,max:g,title:{enabled:!1},tickPositions:e,tickPositioner:function(){return e},plotBands:i,labels:{formatter:function(){return b.formatter.format(this.value,d.numberFormat)},rotation:-30}},c.series=[{type:"bar",data:[d.lastMeasurementValue],pointWidth:5},{type:"scatter",data:[k]}]),c.xAxis={labels:{enabled:!1},tickWidth:"0"}}return c}function q(a,b){return b>=a.startValue&&b<=a.endValue?h.Color(a.color).get("rgba"):h.Color(a.mutedColor).get("rgba")}function r(a,b){return b>=a.startScore&&b<=a.endScore?h.Color(a.color).get("rgba"):h.Color(a.mutedColor).get("rgba")}return j});
define('ui/elements/kpi-widget/component',['require','knockout','ui/elements/kpi-widget/kpi-widget-view-model'],function(require){"use strict";var a=require("knockout"),b=require("ui/elements/kpi-widget/kpi-widget-view-model");a.components.register("kpi-widget",{viewModel:{createViewModel:function(a,c){return new b(a,c.element)}},template:{require:"text!ui/elements/kpi-widget/kpi-widget-view.html"}})});
define('dashboard/view-models/kpi-widget',['require','lodash','jquery','knockout','./widget-view-model','metrics/services/kpi-service','mi-assert','system/lang/property','./kpi-widget-editor','application/application-events','text!../views/kpi-widget.html','ui/elements/kpi-widget/component'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("./widget-view-model"),e=require("metrics/services/kpi-service"),f=require("mi-assert"),g=require("system/lang/property"),h=require("./kpi-widget-editor"),i=require("application/application-events"),j=require("text!../views/kpi-widget.html");require("ui/elements/kpi-widget/component");function k(b){l.call(this,b,j,h),this.applicationEvents=Object.resolve(i),this.widgetElement=null,this.$gridLayoutItem=null,this.debouncedWidgetResizeFunction=a.debounce(m.bind(null,this),250),this.key=this.kom.observable(),this.kpiName=this.kom.observable(),this.isResized=this.kom.observable(),this.isRefreshed=this.kom.observable(),this.gridWidth=this.kom.observable(),this.kpiChartType=this.kom.observable(b.properties().kpiChartType||"Dial"),this.selectedKpis=this.kom.observableArray(),this.kpiService=Object.resolve(e),"Dial"!==this.kpiChartType()&&(g.set(this,"allowGoTo",!1),
g.set(this,"allowRefresh",!1),g.set(this,"minWidth",6),g.set(this,"minHeight",6)),g.set(this,"editorDialogOptions",{height:"70%",width:"60%"})}var l=Object.inherit(d,k);k.prototype.abbreviateText=function a(b){return b.length>38?b.substr(0,38)+"...":b},k.prototype.afterAttach=function a(c){var d=this;try{d.$gridLayoutItem=b("mi-grid-layout-item"),d.$gridLayoutItem.on("element-resized",d.debouncedWidgetResizeFunction),d.gridWidth(d.region.$element.parents("mi-grid-layout-item").first().get(0).controller.width_blocks())}catch(a){l.prototype.onError.call(d,a)}},k.prototype.beforeDetach=function a(){var b=this;try{b.$gridLayoutItem.off("element-resized"),b.$gridLayoutItem=null}catch(a){l.prototype.onError.call(b,a)}finally{b.$gridLayoutItem=null}},k.prototype.deserialize=function a(){var b=this.widget.properties();f.ok(b,"properties"),this.key(b.key),this.kpiName(b.kpiName),this.kpiChartType(b.kpiChartType||"Dial"),this.selectedKpis(b.selectedKpis)},k.prototype.serialize=function a(){
return{key:this.key(),kpiName:this.kpiName(),kpiChartType:this.kpiChartType(),selectedKpis:this.selectedKpis()}},k.prototype.refresh=function a(){"Dial"===this.kpiChartType()&&this.isRefreshed.valueHasMutated()},k.prototype.redraw=function(){m(this)},k.prototype.goto=function a(b){var c,d=this,e="Dial"===this.kpiChartType()?this.kpiName():b;this.kpiService.getKpiDataByName(e).done(function(a){c=a[0].key,d.getresult(c)})},k.prototype.getresult=function(a){this.applicationEvents.navigate.raise("metrics/kpi-viewer/"+a,{tab:!0})};function m(a){a.gridWidth(a.region.$element.parents("mi-grid-layout-item").first().get(0).controller.width_blocks()),a.gridWidth.valueHasMutated(),a.isResized.valueHasMutated()}return k});

define('text!dashboard/views/image-widget/image-widget-editor.html',[],function () { return '<div class="hyperlinks-widget-editor">\r\n    <div class="edit-widget-name-container" data-bind="with: widget">\r\n        <div class="form-group">\r\n            <label data-bind="text: $parent.translate(\'NAME\')"></label>\r\n            <div class="input-group localize">\r\n                <input type="text" class="form-control" data-bind="value: name">\r\n                <mi-localize type="20" data-bind="attr: { phrase: name, context: translationContext }, value: caption">\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <form class="secondary-input-container" data-bind="with: widgetVM">\r\n        <label data-bind="text: translate(\'URL\')"></label>\r\n        <div class="input-group secondary-input">\r\n            <input type="text" class="form-control" data-bind="value: path">\r\n        </div>\r\n    </form>\r\n</div>';});

define('dashboard/views/image-widget/image-widget-editor-view',['require','text!dashboard/views/image-widget/image-widget-editor.html'],function(require){"use strict";var a=require("text!dashboard/views/image-widget/image-widget-editor.html");function b(){}return b.html=a,b});
define('dashboard/view-models/image-widget/image-widget-editor',['require','dashboard/view-models/widget-editor','dashboard/views/image-widget/image-widget-editor-view','ui/elements/localize/localize-element'],function(require){"use strict";var a=require("dashboard/view-models/widget-editor"),b=require("dashboard/views/image-widget/image-widget-editor-view");require("ui/elements/localize/localize-element");function c(a){d.call(this,a,b.html),this.editorView=Object.resolve(b),this.widgetVM.path.subscribe(e.bind(null,this))}var d=Object.inherit(a,c);c.prototype.afterAttach=function(a){try{this.editorView.attach(a),Element.upgrade(a.element.querySelectorAll("mi-localize"))}catch(a){d.prototype.onError.call(this,a)}};function e(a){var b=a.widgetVM.path(),c=b.split("/"),d=f(c[c.length-1]);a.widget.name(d)}function f(a){return a=a.substr(0,a.lastIndexOf("."))}return c.prototype.afterDetach=function(){try{this.editorView.detach()}catch(a){d.prototype.onError.call(this,a)}},c});

define('text!dashboard/views/image-widget/image-widget.html',[],function () { return '<div>\r\n    <img class="image-container" data-bind="attr: { src: path }" />\r\n</div>';});

define('dashboard/view-models/image-widget/image-widget',['require','knockout','dashboard/view-models/widget-view-model','dashboard/view-models/image-widget/image-widget-editor','mi-assert','system/lang/property','text!dashboard/views/image-widget/image-widget.html'],function(require){"use strict";var a=require("knockout"),b=require("dashboard/view-models/widget-view-model"),c=require("dashboard/view-models/image-widget/image-widget-editor"),d=require("mi-assert"),e=require("system/lang/property"),f=require("text!dashboard/views/image-widget/image-widget.html");function g(b){h.call(this,b,f,c),this.path=a.observable(),e.set(this,"allowGoTo",!1),e.set(this,"allowRefresh",!1)}var h=Object.inherit(b,g);return g.prototype.deserialize=function a(){try{var b=this.widget.properties();d.ok(b,"properties"),b.path&&this.path(b.path)}catch(a){h.prototype.onError.call(this,a)}},g.prototype.serialize=function a(){try{return{path:this.path()}}catch(a){h.prototype.onError.call(this,a)}},g.prototype.icon=function(){return"dashboard-icon-image"},g});

define('text!dashboard/views/calendar-widget/calendar-widget-editor.html',[],function () { return '<div class="calendar-widget-editor" style="height: 100%;overflow:auto;">\r\n    <div style="height: 60px;" data-bind="with: widget">\r\n        <div class="form-group">\r\n            <label data-bind="text: $parent.translate(\'NAME\')"></label>\r\n            <div class="input-group localize">\r\n                <input type="text" class="form-control" required data-bind="value: name">\r\n                <mi-localize type="20" data-bind="attr: { phrase: name, context: translationContext }, value: caption">\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <form style="height: 60px;" data-bind="with: widgetVM">\r\n        <label data-bind="text: translate(\'PATH\')"></label>\r\n        <div class="input-group">\r\n            <input disabled type="text" class="form-control disabled" required data-bind="value: path">\r\n            <span class="input-group-btn">\r\n                <button class="btn btn-default path-button" type="button"\r\n                        data-bind="click: $parent.choosePathFromCatalog.bind($parent),\r\n                                    attr: { title: translator.translate(\'CHOOSE_QUERY_TITLE\') }">\r\n                    ...\r\n                </button>\r\n            </span>\r\n        </div>\r\n    </form>\r\n    <div data-bind="with: widgetVM.mappings">\r\n        <div class="form-group">\r\n            <h3 data-bind="text: $parent.translate(\'EVENT_MAPPINGS\')"></h3>\r\n        </div>\r\n        <div class="form-group b6">\r\n            <label data-bind="text: $parent.translate(\'TITLE_COLUMN\')"></label>\r\n            <div class="">\r\n                <mi-select  data-bind="miproperty:{required:true, options:$parent.widgetVM.queryColumns,optionsText:\'alias\',optionsValue:\'id\', optionsCaption: $parent.translate(\'SELECT_COLUMN\'),value:$data.title}"></mi-select>               \r\n            </div>\r\n        </div>\r\n        <div class="form-group b6">\r\n            <label data-bind="text: $parent.translate(\'START_DATE_COLUMN\')"></label>\r\n            <div class="">\r\n                <mi-select data-bind="miproperty:{required:true, options:$parent.widgetVM.queryColumns,optionsText:\'alias\',optionsValue:\'id\', optionsCaption: $parent.translate(\'SELECT_COLUMN\'),value:$data.start}"></mi-select>\r\n            </div>\r\n        </div>\r\n        <div class="form-group b6">\r\n            <label data-bind="text: $parent.translate(\'CATEGORY_COLUMN\')"></label>\r\n            <div class="">\r\n                <mi-select data-bind="miproperty:{options:$parent.widgetVM.queryColumns,optionsText:\'alias\',optionsValue:\'id\', optionsCaption: $parent.translate(\'SELECT_COLUMN\'),value:$data.category}"></mi-select>\r\n            </div>\r\n        </div>\r\n        <div class="form-group b6">\r\n            <label data-bind="text: $parent.translate(\'END_DATE_COLUMN\')"></label>\r\n            <div class="">\r\n                <mi-select data-bind="miproperty:{options:$parent.widgetVM.queryColumns,optionsText:\'alias\',optionsValue:\'id\', optionsCaption: $parent.translate(\'SELECT_COLUMN\'),value:$data.end}"></mi-select>\r\n            </div>\r\n        </div>\r\n        <div class="form-group b6">\r\n            <label data-bind="text: $parent.translate(\'COLOR_COLUMN\')"></label>\r\n            <div class="">\r\n                <mi-select data-bind="miproperty:{options:$parent.widgetVM.queryColumns,optionsText:\'alias\',optionsValue:\'id\', optionsCaption:$parent.translate(\'SELECT_COLUMN\'),value:$data.color}"></mi-select>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>';});

define('dashboard/views/calendar-widget/calendar-widget-editor-view',['require','text!dashboard/views/calendar-widget/calendar-widget-editor.html'],function(require){"use strict";var a=require("text!dashboard/views/calendar-widget/calendar-widget-editor.html");function b(){}return b.html=a,b});
define('dashboard/view-models/calendar-widget/calendar-widget-editor',['require','jquery','lodash','dashboard/view-models/widget-editor','catalog/catalog-dialog','dashboard/views/calendar-widget/calendar-widget-editor-view','ui/elements/localize/localize-element'],function(require){"use strict";var a=require("jquery"),b=require("lodash"),c=require("dashboard/view-models/widget-editor"),d=require("catalog/catalog-dialog"),e=require("dashboard/views/calendar-widget/calendar-widget-editor-view");require("ui/elements/localize/localize-element");function f(a){g.call(this,a,e.html),this.editorView=Object.resolve(e),this.catalogDialog=Object.resolve(d)}var g=Object.inherit(c,f);f.prototype.afterAttach=function(c){try{var d=this,e="input.form-control.disabled:eq(1)",f;Element.upgrade(c.element.querySelectorAll("mi-localize")),b.defer(function(){f=a("button.btn.pull-right.btn-primary"),f.attr("disabled",!d.widgetVM.isValid()),h(d,e),d.widgetVM.isValid.subscribe(function(a){f.attr("disabled",!a),h(d,e)})})}catch(a){g.prototype.onError.call(this,a)}};function h(b,c){a(c).css("border-color",b.widgetVM.path()?"#C0C5C5":"red")}f.prototype.afterLoad=function(){try{k(this)}catch(a){g.prototype.onError.call(this,a)}},f.prototype.afterCancel=function(){
try{m(this)}catch(a){g.prototype.onError.call(this,a)}},f.prototype.afterSave=function(a){try{l(this),this.widgetVM.reMountFC()}catch(a){g.prototype.onError.call(this,a)}},f.prototype.afterDetach=function(){try{this.editorView.detach()}catch(a){g.prototype.onError.call(this,a)}},f.prototype.choosePathFromCatalog=function(){try{this.catalogDialog.show({path:this.widgetVM.path(),itemTypes:["Query"]}).done(i.bind(null,this)).fail(j.bind(null,this))}catch(a){g.prototype.onError.call(this,a)}};function i(a,b){var c=a.widgetVM.translator.translate("CALENDAR");a.widgetVM.path(b.path),a.widgetVM.widget.name(b.id)}function j(a,b){if("cancelled"!==b)throw new Error("Unable to retrieve catalog item because: "+b)}function k(b){a.extend(b.backup,b.widgetVM.getConfig())}function l(a){a.backup.path=null,a.backup.mappings=null}function m(a){a.widgetVM.updateConfig(a.backup),l(a)}return f});
define('ui/react/calendar/services/calendar-service',['require','jquery','system/http/ajax-client','query/execution/query-execution-engine'],function(require){"use strict";var a=require("jquery"),b=require("system/http/ajax-client"),c=require("query/execution/query-execution-engine"),d="api/core/catalog";function e(a){this.ajaxClient=a,this.queryExecutionEngine=Object.resolve(c)}return e.dependsOn=[b],e.prototype.getCatalogItem=function(b){var c=a.Deferred();return this.ajaxClient.get(d+"/item?path="+encodeURIComponent(b)).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()},e.prototype.executeQueryEngine=function a(b){var d={catalogItemKey:b.key,pageSize:1,suppressPrompts:!0};return this.queryExecutionEngine=new c(d),this.queryExecutionEngine.execute(d)},e.prototype.getDataByPath=function b(c){var d=a.Deferred();return this.getCatalogItem(c).then(this.executeQueryEngine.bind(this)).done(d.resolve),d},e});

define('text!dashboard/views/calendar-widget/calendar-widget.html',[],function () { return '<div class="widget-container">\r\n</div>';});

define('ui/react/calendar/dtos/calendar-event-dto',['require','jquery'],function(require){"use strict";var a=require("jquery");function b(b,c,d,e,f){b=b||"";var g=b.match(/<a[^>]*>([\s\S]*?)<\/a>/);g?(this.title=g[1],this.navigationUrl=a(b)[0].getAttribute("href")):(this.title=b,this.navigationUrl=null),this.start=c,this.end=d,this.category=e,this.color=f||"#1761c2"}b.toEventDtos=function(a,d){if(a){var e,f,g=[],h,i,j,k,l=[],m,n,o,p,q,r,s;for(e=0;e<a.rows.length;e++)i=a.rows[e],m=c(a.columns,d.title),n=c(a.columns,d.start),o=c(a.columns,d.end),r=c(a.columns,d.category),s=c(a.columns,d.color),null===i.columnValues[n]&&null===i.columnValues[o]||g.push(new b(i.columnValues[m],i.columnValues[n],i.columnValues[o],i.columnValues[r],i.columnValues[s]));return g}};function c(a,b){var c;for(c=0;c<a.length;c++)if(a[c].fieldId===b)return c}return b});
define('ui/react/calendar/utils',['require','jquery','lodash','moment'],function(require){"use strict";var a=require("jquery"),b=require("lodash"),c=require("moment"),d=["#cdadd2","#ffcc99","#8ce2b9","#3e87e8","#11c8b1","#FF3B30","#ffcc00","#4cd964","#FF9500","#007AFF","#FF5A4F","#FFDC50","#8AD998","#FA913C","#61ADFF","#FFBDB9","#FFF1B9","#D0F0D6","#FDD3B1","#C0DEFF","#DA534B","#E6C74A","#84BB88","#E08437","#6999C7","#FF9C95","#FFEA96","#B9E8C1","#FCBD8A","#A0CEFF","#B4443C","#BDA53D","#6D9E72","#B86C2B","#5880A7","#FF7B72","#FFE373","#A1E1AD","#FBA763","#81BDFF","#953730","#8D7C2B","#4F7755","#854E18","#42617F"];function e(){}e.prototype.getRandomColor=function a(b){var c=f(0,255),e=f(0,255),h=f(0,255);return d[b]||g(c,e,h)};function f(a,b){return Math.floor(Math.random()*(b-a+1))+a}function g(a,b,c){return"#"+h(a)+h(b)+h(c)}function h(a){var b=a.toString(16);return 1===b.length?"0"+b:b}return e});
define('ui/react/calendar/calendar',['require','jquery','lodash','moment','full-calendar','react','react-dom','application/application-events','query/execution/query-execution-engine','./services/calendar-service','./dtos/calendar-event-dto','query/services/dto/parameter-container-dto','query/services/dto/query-container-dto','ui/elements/page-filter/page-filter-connection','./utils','system/globalization/translator','globalize','system/ui/busy-indicator'],function(require){"use strict";var a=require("jquery"),b=require("lodash"),c=require("moment"),d=require("full-calendar"),e=require("react"),f=require("react-dom"),g=require("application/application-events"),h=require("query/execution/query-execution-engine"),i=require("./services/calendar-service"),j=require("./dtos/calendar-event-dto"),k=require("query/services/dto/parameter-container-dto"),l=require("query/services/dto/query-container-dto"),m=require("ui/elements/page-filter/page-filter-connection"),n=require("./utils"),o=require("system/globalization/translator"),p=require("globalize"),q=require("system/ui/busy-indicator"),r=e.DOM.div,s=e.DOM.button,t=e.DOM.span;function u(a){v.call(this,a),this.appEvents=Object.resolve(g),this.calendarService=Object.resolve(i),this.utils=Object.resolve(n),this.translator=Object.resolve(o),this.pageFilterConnection=Object.resolve(m),this.aggregateQueryParams=null,this.queryExecutionEngine=null,this.catalogItemKey=null,
this.catalogItemPath=null,a.catalogItemKey?this.catalogItemKey=a.catalogItemKey:a.catalogItemPath&&(this.catalogItemPath=a.catalogItemPath),this.eventDtos=[],a.map&&(this.fieldNamingMap=a.map,window.sessionStorage.setItem("calendar-field-map",JSON.stringify(a.map))),this.isFcInitilized=!1,this.start="",this.end="",this.categories=[],this.selectedCategories=[],this.isCategoryUpdate=!1,this.queryContainer=null,this.showRefreshButton=a.showRefreshButton,this.showExpandButton=a.showExpandButton,this.indicator=Object.resolve(q)}var v=Object.inherit(e.Component,u);u.prototype.render=function(){return w([y(this),x(this),z(this)])},u.prototype.componentDidMount=function(){var a=this;a.element=f.findDOMNode(a),a.pageFilterConnection.open(O.bind(null,a),a.element)},u.prototype.componentWillUnmount=function(){this.pageFilterConnection.close(),this.pageFilterConnection=null};function w(a){return r({className:"calendar-widget-container",key:"widget-container",style:{height:"100%"}},a)}
function x(a){return r({className:"full-calendar-widget",key:"content",style:{height:"calc(100% - 30px)"}})}function y(a){return a.showRefreshButton&&a.showExpandButton?r({className:"calendar-widget-header",key:"widget-header"},t({},"LOG CALENDAR"),s({className:"btn btn-icon icon-refresh",key:"refresh-btn",onClick:B.bind(null,a)}),s({className:"btn btn-icon icon-open-in-new-window",key:"expand-btn",onClick:C.bind(null,a)})):r({className:"calendar-widget-header",key:"widget-header"})}function z(){return r({className:"calendar-widget-legend",key:"legend"})}function A(a,b){b.navigationUrl&&a.appEvents.navigate.raise(b.navigationUrl,{tab:!0})}function B(b){a(b.element).find(".full-calendar-widget").fullCalendar("refetchEvents")}function C(a){var b="#calendar-expanded-view?catalogItemKey="+a.catalogItemKey;a.appEvents.navigate.raise(b,{tab:!0})}function D(b){var c=a.Deferred()
;return null!==b.catalogItemKey?c.resolve():null===b.catalogItemKey&&null!==b.catalogItemPath&&b.calendarService.getCatalogItem(b.catalogItemPath).done(function(d){b.catalogItemKey=d.key,b.queryContainer=new l(a.parseJSON(JSON.stringify(d.query.layout.queryContainer))),c.resolve(d.key)}).fail(function(){c.reject()}),c}function E(a,d,e,f,g){var i=c(d).format("YYYY-MM-DD HH:mm:ss");if(a.catalogItemKey&&!a.isCategoryUpdate){var k=Q(a.queryContainer.columnDesigns,a.fieldNamingMap.start);k&&(a.fieldNamingMap.end?a.queryContainer.columnDesigns[k].resultFilterExpression=">= (# :dt '"+i+"') OR ("+a.fieldNamingMap.start+" < (# :dt '"+i+"') AND "+a.fieldNamingMap.end+" > (# :dt '"+i+"')) ":a.queryContainer.columnDesigns[k].resultFilterExpression=">= (# :dt '"+i+"')"),a.start=d,a.end=e;var l={suppressPrompts:!0};a.aggregateQueryParams&&(l.parameters=a.aggregateQueryParams,l.suppressPrompts=!0),a.queryExecutionEngine=new h({queryContainer:a.queryContainer}),
a.queryExecutionEngine.execute(l).done(function(c){a.eventDtos=j.toEventDtos(c.rowset,a.fieldNamingMap);var d=b.uniq(b.map(a.eventDtos,"category"));a.categories={},b.each(d,function(c,d){var e=b.filter(a.eventDtos,{category:c})[0].color,f=a.fieldNamingMap.color?e:a.utils.getRandomColor(d);a.categories[c]=f}),b.each(a.eventDtos,function(b){b.color=a.categories[b.category]}),F(a,d),g(a.eventDtos)})}else a.isCategoryUpdate&&(a.isCategoryUpdate=!1,g(J(a)))}function F(b,c){var d=a(b.element).find(".calendar-widget-legend");G(b,d),H(b,d,c)}function G(a,b){b.empty(),a.selectedCategories=[]}function H(b,c,d){for(var e=0;e<d.length;e++)if(d[e]&&0===c.find('[id="'+d[e]+'"]').length){var f=a('<mi-checkbox-noko value="'+d[e]+'" text="'+d[e]+'" id="'+(d[e]?d[e].split(" ").join("_"):"UNKNOWN")+'"></mi-checkbox-noko>');window.CustomElements&&!window.CustomElements.useNative&&window.CustomElements.upgrade(f.get(0)),f.on("checkedChange",I.bind(null,b)),c.append(f),
f.find(".checkbox-label").css("background-color",b.categories[d[e]])}}function I(c,d,e,f){e?c.selectedCategories.push(f):b.pull(c.selectedCategories,f),c.isCategoryUpdate=!0,a(c.element).find(".full-calendar-widget").fullCalendar("refetchEvents")}function J(a){var b=[];if(a.selectedCategories.length)for(var c=0;c<a.eventDtos.length;c++)a.selectedCategories.indexOf(a.eventDtos[c].category)!==-1&&b.push(a.eventDtos[c]);else b=a.eventDtos;return b}function K(b){b.element&&(a(b.element).find(".full-calendar-widget").fullCalendar({defaultView:"agendaDay",header:{left:"title, prev, next",center:"",right:"today"},buttonText:{today:b.translator.translate("TODAY"),month:b.translator.translate("CAL_MONTH"),week:b.translator.translate("CAL_WEEK"),day:b.translator.translate("CAL_DAY"),list:b.translator.translate("LIST")},monthNames:p.culture().calendar.months.names,monthNamesShort:p.culture().calendar.months.namesAbbr,dayNames:p.culture().calendar.days.names,
dayNamesShort:p.culture().calendar.days.namesAbbr,columnFormat:"dddd",eventLimit:!0,views:{month:{eventLimit:3}},events:E.bind(null,b),eventClick:A.bind(null,b),allDaySlot:!1,defaultTimedEventDuration:"00:30:00",height:a(b.element).find(".full-calendar-widget").height(),eventRender:L,viewRender:M.bind(null,b),loading:N.bind(null,b)}),b.isFcInitilized=!0)}function L(b,c,d){a(c).addClass("cal-event"),c.attr("title",b.title),"month"!==d.name?a(c).find(".fc-time").show():a(c).find(".fc-time").hide(),null===b.end&&a(c).addClass("cal-event-no-end-date-style1")}function M(a,b,c){a.indicator.attachTo(c[0])}function N(a,b,c){b?a.indicator.show():a.indicator.hide()}function O(a,c){a.pageFilterConnection.remote.isConnected()&&(c&&c.parmDesigns&&c.parmDesigns.length?a.aggregateQueryParams=c:a.aggregateQueryParams=void 0,P(a),a.isFcInitilized?b.delay(B.bind(null,a),500):D(a).done(K.bind(null,a)))}function P(b){var c=a(b.element).parents("mi-widget").attr("id")
;window.sessionStorage.setItem(c,JSON.stringify(b.aggregateQueryParams||""))}function Q(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id===b)return c;return null}return u});
define('dashboard/view-models/calendar-widget/calendar-widget',['require','jquery','lodash','knockout','dashboard/view-models/widget-view-model','dashboard/view-models/calendar-widget/calendar-widget-editor','mi-assert','system/lang/property','application/application-events','ui/react/calendar/services/calendar-service','text!dashboard/views/calendar-widget/calendar-widget.html','react','react-dom','ui/react/calendar/calendar'],function(require){"use strict";var a=require("jquery"),b=require("lodash"),c=require("knockout"),d=require("dashboard/view-models/widget-view-model"),e=require("dashboard/view-models/calendar-widget/calendar-widget-editor"),f=require("mi-assert"),g=require("system/lang/property"),h=require("application/application-events"),i=require("ui/react/calendar/services/calendar-service"),j=require("text!dashboard/views/calendar-widget/calendar-widget.html"),k=require("react"),l=require("react-dom"),m=require("ui/react/calendar/calendar");function n(a,b){return k.DOM.div({style:{height:b||"100%",width:"100%"}},o(a))}function o(a){return k.createElement(m,{catalogItemPath:a.getCatalogItemPath(),map:a.getFieldColumnMap()})}function p(a){q.call(this,a,j,e);var b=this;this.calendarService=Object.resolve(i),this.queryColumns=c.observableArray(),this.path=c.observable(),this.pathSubscription=null,this.mappings={},this.mappings.start=c.observable(),this.mappings.end=c.observable(),
this.mappings.category=c.observable(),this.mappings.title=c.observable(),this.mappings.color=c.observable(),this.isValid=c.computed(function(){return b.path()&&b.mappings&&b.mappings.start()&&b.mappings.title()}),this.applicationEvents=Object.resolve(h),g.set(this,"allowGoTo",!0),g.set(this,"allowRefresh",!0),g.set(this,"mappings",{})}var q=Object.inherit(d,p);p.prototype.afterAttach=function(a){this.region=a,r(this,this.path(),!0),this.pathSubscription=this.path.subscribe(r.bind(null,this)),t(this)},p.prototype.reMountFC=function(){t(this)};function r(a,b,c){a.calendarService.getDataByPath(b).done(function(b){a.queryColumns(s(b.rowset))}),c||u(a)}function s(a){var c=[];return c=b.map(a.columns,function(a){return{alias:a.alias||a.id,id:a.fieldId}})}function t(b){var c=b.region.element.querySelector(".widget-container"),d=c.querySelector("span.fc-mount-point");d?l.unmountComponentAtNode(d):(d=document.createElement("span"),d.classList.add("fc-mount-point"),c.appendChild(d)),
l.render(n(b,a(c).parent().height()),d)}p.prototype.deserialize=function a(){try{var b=this.widget.properties();f.ok(b,"properties"),this.updateConfig(b)}catch(a){q.prototype.onError.call(this,a)}},p.prototype.serialize=function a(){try{return this.getConfig()}catch(a){q.prototype.onError.call(this,a)}},p.prototype.icon=function(){return"icon-calendar"},p.prototype.refresh=function a(){try{this.region&&this.region.$element.find(".full-calendar-widget").fullCalendar("refetchEvents")}catch(a){q.prototype.onError.call(this,a)}},p.prototype.redraw=function(){},p.prototype.goto=function a(){try{this.applicationEvents.navigate.raise("calendar-expanded-view/db/"+this.widget.dashboard().key+"/"+this.widget.uniqueID(),{tab:!0})}catch(a){q.prototype.onError.call(this,a)}},p.prototype.getCatalogItemPath=function a(){return this.path()},p.prototype.getFieldColumnMap=function a(){return v(this)},p.prototype.getConfig=function a(){return{path:this.path(),mappings:v(this)}},
p.prototype.updateConfig=function a(b){b.path&&this.path(b.path),b.mappings&&(b.mappings.start&&this.mappings.start(b.mappings.start),b.mappings.end&&this.mappings.end(b.mappings.end),b.mappings.category&&this.mappings.category(b.mappings.category),b.mappings.title&&this.mappings.title(b.mappings.title),b.mappings.color&&this.mappings.color(b.mappings.color))};function u(a){return a.mappings.title(""),a.mappings.start(""),a.mappings.end(""),a.mappings.category(""),a.mappings.color(""),!0}function v(a){var b=a;return{title:b.mappings.title(),start:b.mappings.start(),end:b.mappings.end(),category:b.mappings.category(),color:b.mappings.color()}}return p});
define('dashboard/view-models/widget-view-model-factory',['require','../models/widget','./widget-view-model','system/lang/unique-id','dashboard/view-models/hyperlinks-widget/hyperlinks-widget','./query-widget','./chart-widget','./kpi-widget','dashboard/view-models/image-widget/image-widget','dashboard/view-models/calendar-widget/calendar-widget','mi-assert'],function a(require){"use strict";var b=require("../models/widget"),c=require("./widget-view-model"),d=require("system/lang/unique-id"),e=require("dashboard/view-models/hyperlinks-widget/hyperlinks-widget"),f=require("./query-widget"),g=require("./chart-widget"),h=require("./kpi-widget"),i=require("dashboard/view-models/image-widget/image-widget"),j=require("dashboard/view-models/calendar-widget/calendar-widget"),k=require("mi-assert"),l={Hyperlinks:e,Query:f,Chart:g,KPI:h,Image:i,Calendar:j};function m(a,b){return k.ok(b),o(a,l[b.type]||c,b)}function n(a,b,e){return k.isString(b,"type"),k.isString(e,"name"),o(a,l[b]||c,{type:b,name:e,caption:e,uniqueID:d.createV4(),properties:[]})}function o(a,c,d){k.isFunction(c),k.ok(d);var e=new b(a,d.type,d.name,d.uniqueID,d.properties,d.caption),f=Object.resolve(c,e);return f.deserialize(),f}return{create:m,createNew:n}});
define('dashboard/adapters/widget-adapter',['require','../dtos/widget-dto','../view-models/widget-view-model-factory','mi-assert'],function a(require){"use strict";var b=require("../dtos/widget-dto"),c=require("../view-models/widget-view-model-factory"),d=require("mi-assert");function e(a,b){return d.ok(b),c.create(a,b)}function f(a,b){return d.isArray(b),b.map(e.bind(null,a))}function g(a){d.ok(a);var c=new b;return c.type=a.widget.type(),c.name=a.widget.name(),c.uniqueID=a.widget.uniqueID(),c.properties=a.serialize(),c.caption=a.widget.caption(),c}function h(a){return d.isArray(a),a.map(g)}function i(a){d.ok(a);var c=new b;return c.type=a.type,c.name=a.name,c.uniqueID=a.uniqueID,c.properties=a.properties,c.caption=a.caption||a.name,c}function j(a){return d.isArray(a),a.map(i)}function k(a){return d.instanceOf(a,b),{type:a.type,name:a.name,uniqueID:a.uniqueID,properties:a.properties}}function l(a){return d.isArray(a),a.map(k)}return{toViewModel:e,toViewModels:f,toDTO:g,toDTOs:h,serializeAll:l,serialize:k,deserializeAll:j,deserialize:i}});
define('dashboard/models/widget-layout',['require','mi-assert','../view-models/i-widget-view-model'],function(require){"use strict";var a=require("mi-assert"),b=require("../view-models/i-widget-view-model");function c(a,b){k(a),l(b),this.__private__={dashboard:a,widgetVm:b}}c.prototype.setLayout=function b(c){var e=d(this),g=f(this);a.isObject(c,"layout"),e[g]=c};function d(b){j(b);var c=e(b).layout();return a.isObject(c),c}function e(a){j(a);var b=a.__private__.dashboard;return k(b),b}function f(a){return g(a).uniqueID()}function g(a){j(a);var b=a.__private__.widgetVm;return l(b),b}c.prototype.updateType=function b(c,d){var e;a.isString(c,"layoutType"),a.isObject(d,"attributes"),h(this),e=i(this),e[c]=d};function h(a){j(a),i(a)||a.clear()}function i(a){return d(a)[f(a)]}c.prototype.hide=function a(){j(this),this.setLayout({hidden:!0})},c.prototype.clear=function a(){j(this),this.setLayout({})},c.prototype.removeFromDashboardLayout=function a(){delete d(this)[f(this)]};function j(b){a.enabled&&(a.instanceOf(b,c,"this"),k(b.__private__.dashboard),l(b.__private__.widgetVm))}
function k(b){a.enabled&&a.isObject(b,"dashboard")}function l(c){a.enabled&&a.implementsInterface(c,b,"widget")}return c});
define('dashboard/models/dashboard-container',['require','lodash','system/knockout/knockout-manager','../view-models/i-widget-view-model','./widget-layout','system/lang/event','mi-assert'],function(require){"use strict";var a=require("lodash"),b=require("system/knockout/knockout-manager"),c=require("../view-models/i-widget-view-model"),d=require("./widget-layout"),e=require("system/lang/event"),f=require("mi-assert");function g(){this.kom=Object.resolve(b),this.saveRequested=Object.resolve(e),this.widgetRemoved=Object.resolve(e),this.widgetHidden=Object.resolve(e),this.key="0",this.content=this.kom.observableArray(),this.layout=this.kom.observable(),this.version=this.kom.observable(0),this.readOnly=this.kom.observable(!1),this.path=this.kom.observable(""),this.upgraded=this.kom.observable(!1),this.filter=this.kom.observable(""),this.caption=this.kom.observable("")}g.prototype.screenAttached=function a(){h(this)};function h(a){for(var b=0;b<a.content().length;b++)i(a,a.content()[b])}function i(a,b){j(b)||l(a,b)}function j(a){return 0!==a.getLayoutChanged().bindings.length}g.prototype.screenDetached=function a(){B(this),this.kom.disposeSubscriptions(),
this.kom.disposeComputeds()},g.prototype.addWidget=function a(b){k(this,b),l(this,b)};function k(a,b){B(a),G(b),a.content.push(b)}function l(a,b){G(b),b.getSaveRequested().add(m,a,a),b.getLayoutChanged().add(o,a,a),b.getRemoveRequested().add(p,a,a),b.getHideRequested().add(s,a,a)}function m(a){n(a)}function n(a){B(a),a.saveRequested.raise(a)}function o(a,b,c){G(b),new d(a,b).updateType(c.layoutType,c.attributes)}function p(a,b){B(a),G(b),new d(a,b).removeFromDashboardLayout(),q(a,b),r(a,b),b.dispose()}function q(a,b){a.content.remove(b)}function r(a,b){B(a),G(b),a.widgetRemoved.raise(a,b)}function s(a,b){t(a,b)}function t(a,b){B(a),new d(a,b).hide(),u(a,b)}function u(a,b){B(a),G(b),a.widgetHidden.raise(a,b)}g.prototype.showWidget=function a(b){v(this,b)};function v(a,b){new d(a,b).clear()}g.prototype.dispose=function a(){B(this),this.content().forEach(w.bind(null,this)),this.kom.dispose(),this.saveRequested.remove()};function w(a,b){G(b),x(a,b),b.unload()}function x(a,b){B(a),G(b),
b.getSaveRequested().remove(a),b.getLayoutChanged().remove(a),b.getRemoveRequested().remove(a),b.getHideRequested().remove(a)}g.prototype.visibleContent=function b(){return B(this),a.filter(this.content(),y.bind(null,this))};function y(a,b){return!z(a,b)}function z(a,b){var c=A(a,b);return!!c&&c.hidden}function A(a,b){return B(a),G(b),a.layout()[b.uniqueID()]}g.prototype.hiddenContent=function b(){return B(this),a.filter(this.content(),z.bind(null,this))},g.prototype.removeWidgetWithoutPrompt=function a(b){p(this,b)},g.prototype.name=function b(){return B(this),this.caption()?this.caption():this.path()?a.last(this.path().split("\\")):""};function B(a){f.enabled&&(C(a),D(a),E(a),F(a))}function C(a){f.instanceOf(a,g,"this"),f.instanceOf(a.kom,b,"this.kom")}function D(a){f.instanceOf(a.saveRequested,e,"this.saveRequested"),f.instanceOf(a.widgetRemoved,e,"this.widgetRemoved"),f.instanceOf(a.widgetHidden,e,"this.widgetHidden")}function E(a){f.isFunction(a.content,"this.content"),
f.isFunction(a.layout,"this.layout"),f.isFunction(a.version,"this.version"),f.isFunction(a.readOnly,"this.readOnly"),f.isFunction(a.path,"this.path"),f.isFunction(a.upgraded,"this.upgraded"),f.isFunction(a.filter,"this.filter")}function F(a){f.isString(a.key,"this.key"),f.isArray(a.content(),"this.content()"),f.isObject(a.layout(),"this.layout()"),f.isNumber(a.version(),"this.version()"),f.isBoolean(a.readOnly(),"this.readOnly()"),f.isString(a.path(),"this.path()"),f.isBoolean(a.upgraded(),"this.upgraded()"),f.isString(a.filter(),"this.filter()")}function G(a){f.enabled&&f.implementsInterface(a,c,"widget")}return g});
define('dashboard/dtos/dashboard-container-dto',[],function a(){"use strict";function b(){this.key="0",this.content=[],this.layout={},this.version=0,this.readOnly=!1,this.path="",this.upgraded=!1,this.folderKey="0",this.dashboardName="",this.caption=""}return b});
define('dashboard/adapters/dashboard-container-adapter',['require','./widget-adapter','../models/dashboard-container','../dtos/dashboard-container-dto','system/lang/converter','mi-assert'],function a(require){"use strict";var b=require("./widget-adapter"),c=require("../models/dashboard-container"),d=require("../dtos/dashboard-container-dto"),e=require("system/lang/converter"),f=require("mi-assert");function g(a){return f.ok(a),{key:a.key,content:b.serializeAll(a.content),layout:a.layout,version:a.version,dashboardName:a.dashboardName,folderKey:a.folderKey,filter:a.filter}}function h(a){f.isObject(a,"data"),f.isString(a.key,"data.key"),f.isArray(a.content,"data.content"),f.isObject(a.layout,"data.layout"),f.isNumber(a.version,"data.version"),f.isBoolean(a.readOnly,"data.readOnly"),f.isString(a.path,"data.path"),f.isBoolean(a.upgraded,"data.upgraded"),f.isString(a.caption,"data.caption");var c=new d;return c.key=a.key,c.content=b.deserializeAll(a.content),c.layout=a.layout,c.version=a.version,c.readOnly=a.readOnly,c.path=a.path,c.upgraded=a.upgraded,c.filter=e.toString(a.filter,""),c.caption=a.caption,c}function i(a){f.ok(a);var d=new c,e=b.toViewModels(d,a.content)
;return d.key=a.key,d.layout(a.layout),d.version(a.version),d.readOnly(a.readOnly),d.path(a.path),d.upgraded(a.upgraded),d.filter(a.filter),d.caption(a.caption),e.forEach(d.addWidget,d),d}function j(a){var c=new d;return c.key=a.key,c.content=b.toDTOs(a.content()),c.layout=a.layout(),c.version=a.version(),c.readOnly=a.readOnly(),c.path=a.path(),c.upgraded=a.upgraded(),c.filter=a.filter(),c}return{serialize:g,deserialize:h,toModel:i,toDTO:j}});
define('dashboard/services/dashboard-service',['require','lodash','jquery','application/application-context','system/http/ajax-request','../adapters/dashboard-container-adapter','mi-assert'],function a(require){"use strict";var b=require("lodash"),c=require("jquery"),d=require("application/application-context"),e=require("system/http/ajax-request"),f=require("../adapters/dashboard-container-adapter"),g=require("mi-assert"),h="api/core/dashboards",i="api/core/userpref",j=2,k="20",l="api/core/localizer",m=l+"/translations?localizableType={0}&defaultValue={1}&objectContext={2}";function n(){}n.prototype.createDashboard=function a(b){g.isObject(b);var d=c.Deferred(),i=f.serialize(b);return e.post(h,i).send(d).done(d.resolve.bind(d)),d.promise()},n.prototype.getDashboardByKey=function a(b){g.isString(b);var d=c.Deferred();return e.get(h+"/"+b).send(d).done(r.bind(null,this,d)),d.promise()},n.prototype.getDashboardByPath=function a(b){g.isString(b);var d=c.Deferred();return e.get(h+"?path="+encodeURIComponent(b)).send(d).done(r.bind(null,this,d)),d.promise()},n.prototype.save=function a(b){g.isObject(b);var d=f.serialize(b),i=c.Deferred()
;return e.put(h+"/"+b.key,d).send(i).done(i.resolve.bind(i)),i.promise()},n.prototype.setHomePage=function a(b){g.isString(b,"path");var f=c.Deferred(),h=e.post(w(),u(b));return d.homeRoute="home",h.send(f).done(s.bind(null,this,f)),f.promise()},n.prototype.getHomePage=function a(){var b=c.Deferred();return e.get(h+"/home").send(b).done(t.bind(null,this,b)),b.promise()},n.prototype.getDefaultHomeDashboard=function(){var a=c.Deferred();return e.get(h+"/retrieveDefaultHomeDashboard").send(a).done(o.bind(null,this,a)),a.promise()};function o(a,b,c){g.instanceOf(a,n),g.isObject(b,"dfd"),b.resolve(c)}n.prototype.saveDefaultHomeDashboard=function(a){g.isString(a,"path");var b=c.Deferred();return e.post(h+"/saveDefaultHomeDashboard?path="+encodeURIComponent(a)).send(b).done(p.bind(null,this,b)),b.promise()};function p(a,b){g.instanceOf(a,n),g.isObject(b,"dfd"),b.resolve()}n.prototype.getTranslation=function(a,b,d){var f=c.Deferred(),g=x(b,d);return e.get(g).send(f).done(q.bind(null,f,a,b)),
f.promise()};function q(a,c,d,e){var f=b.find(e,{cultureId:c});f&&(d=f.value),a.resolve(d)}function r(a,b,c){g.instanceOf(a,n),g.isObject(b,"dfd"),g.isObject(c,"data");var d=f.deserialize(c);b.resolve(d)}function s(a,b){g.instanceOf(a,n),g.isObject(b,"dfd"),b.resolve()}function t(a,b,c){g.instanceOf(a,n),g.isObject(b,"dfd"),b.resolve(c)}function u(a){return g.isString(a,"path"),{userKey:v(),prefType:j,name:"home-dashboard",value:a}}function v(){return g.ok(d.user),d.user.key}function w(){return i+"/set"}function x(a,b){return m.replace("{0}",encodeURIComponent(k)).replace("{1}",encodeURIComponent(a)).replace("{2}",encodeURIComponent(b))}return n});
define('dashboard/print/dashboard-print',["require","exports","application/application-events","system/hardware/device","lodash"],function(require,exports,a,b,c){"use strict";var d="dashboard-small-print-layout",e="dashboard-printable",f="dashboard-legacy-print-compat-mode";return function(){function g(){this.applicationEvents=Object.resolve(a),this.rootElement=document.querySelector("html"),this.debouncedTogglePrintClassOnBody=c.debounce(this.togglePrintLayoutClassOnBody.bind(null,this),250)}return g.prototype.addPrintSupport=function(){this.debouncedTogglePrintClassOnBody(this),this.addPrintClassToRoot(),this.addLegacyCompatClassToRoot(),this.addSmallPrintLayoutHandler()},g.prototype.addLegacyCompatClassToRoot=function(){var a=new b;this.rootElement&&(a.isIE()||a.isEdge())&&this.rootElement.classList.add(f)},g.prototype.addPrintClassToRoot=function(){this.rootElement&&this.rootElement.classList.add(e)},g.prototype.addSmallPrintLayoutHandler=function(){
this.applicationEvents.windowResized&&this.applicationEvents.windowResized.add(this.debouncedTogglePrintClassOnBody,this)},g.prototype.togglePrintLayoutClassOnBody=function(a){a.rootElement&&(window.innerWidth<1100?a.rootElement.classList.add(d):a.rootElement.classList.remove(d))},g.prototype.removePrintClasses=function(a){a.rootElement&&(a.rootElement.classList.remove(d),a.rootElement.classList.remove(e),a.rootElement.classList.remove(f))},g.prototype.removePrintSupport=function(){this.applicationEvents.windowResized&&(this.applicationEvents.windowResized.remove(this.debouncedTogglePrintClassOnBody,this),this.removePrintClasses(this))},g}()});

define('text!home/views/home.html',[],function () { return '<div class="home-screen overview">\r\n    <mi-page-filter>\r\n        <mi-dashboard toolbar hide-home data-bind="attr: { path: path }, event: { \'dashboard-changed\': dashboardChanged }"></mi-dashboard>\r\n    </mi-page-filter>\r\n</div>';});

define('ui/elements/page-filter/models/filter',['require','ramda','mithril'],function(require){"use strict";var a=require("ramda"),b=require("mithril");function c(a,c,d,e,f){this.id=b.prop(a),this.dataType=b.prop(c),this.caption=b.prop(d),this.value=b.prop(e),this.valueCaption=b.prop(f||e)}return c.remove=function b(c,d){a.reject(a.equals(d),c)},c.prototype.fullCaption=function a(){return this.caption()+" = "+this.valueCaption()},c.prototype.icon=function a(){switch(this.dataType()){case"A":return".icon-asset-hierarchy";default:return".icon-filter"}},c});
define('ui/elements/page-filter/services/page-filter-service',['require','jquery','application/application-context','system/http/ajax-client','mi-assert'],function(require){"use strict";var a=require("jquery"),b=require("application/application-context"),c=require("system/http/ajax-client"),d=require("mi-assert"),e=3,f="api/core/userpref/";function g(){this.ajaxClient=Object.resolve(c)}g.prototype.save=function b(c,e){d.ok(c,"id"),d.ok(e,"value");var f=a.Deferred();return this.ajaxClient.post(h("set"),i(c,e)).done(l.bind(null,this,f)).fail(m.bind(null,this,f)),f.promise()};function h(a){return d.ok(a),f+a}function i(a,b){return d.ok(a,"id"),d.ok(b,"value"),{userKey:j(),prefType:e,name:k(a),value:JSON.stringify(b)}}function j(){return d.ok(b.user),b.user.key}function k(a){return d.ok(a,"id"),"page-filter/"+a}function l(a,b){p(a),b.resolve()}function m(a,b,c){p(a),b.reject(c)}g.prototype.get=function b(c){d.ok(c,"id");var f=a.Deferred();return this.ajaxClient.get(h("get/"+j()+"/"+e+"?name="+k(c))).done(n.bind(null,this,f)).fail(o.bind(null,this,f)),f.promise()};function n(a,b,c){p(a),
c&&c.value?b.resolve(JSON.parse(c.value)):b.resolve(null)}function o(a,b,c){p(a),b.reject(c)}function p(a){d.instanceOf(a,g)}return g});
define('ui/elements/page-filter/view-models/page-filter-view-model',['require','ramda','jquery','mithril','../models/filter','catalog/services/catalog-service','query/execution/query-execution-engine','../services/page-filter-service','system/globalization/translator','application/application-context','assets/services/asset-context-dto','system/ui/message-box','mi-assert','system/lang/converter','moment','system/text/formatter','system/text/parser'],function(require){"use strict";var a=require("ramda"),b=require("jquery"),c=require("mithril"),d=require("../models/filter"),e=require("catalog/services/catalog-service"),f=require("query/execution/query-execution-engine"),g=require("../services/page-filter-service"),h=require("system/globalization/translator"),i=require("application/application-context"),j=require("assets/services/asset-context-dto"),k=require("system/ui/message-box"),l=require("mi-assert"),m=require("system/lang/converter"),n=require("moment"),o=require("system/text/formatter"),p=require("system/text/parser");function q(){this.catalogService=Object.resolve(e),this.pageFilterService=Object.resolve(g),this.translator=Object.resolve(h),this.formatter=Object.resolve(o),this.preferenceLoaded=c.prop(!1),this.id=c.prop(""),this.caption=c.prop(""),this.localizedCaption=c.prop(""),this.filter=c.prop(),this.filtersDisplayed=c.prop(!1),this.values=c.prop(),this.connections=c.prop([]),this.filterLoaded=c.prop(!1),
this.defaultAsset=j.default(),this.format=i.user.formats.dateTime,this.validateDashParameters=c.prop(!1),this.queryValue=c.prop(null)}q.prototype.loadState=function(a){r(this,a),s(this)};function r(a,b){b&&(a.id(b.id),a.caption(b.caption),a.localizedCaption(b.localizedCaption),a.filter(b.filter),a.filtersDisplayed(b.filtersDisplayed),a.values(b.values),a.preferenceLoaded(b.preferenceLoaded),a.validateDashParameters(b.validateDashParameters),a.queryValue(b.queryValue))}function s(a){!a.id()||a.values()?t(a):J(a)}function t(a){return Y(a),a.values()?void(a.validateDashParameters()&&u(a)?a.editFilters():v(a)):a.filter()?void w(a):void v(a)}function u(b){return!a.isNil(b.values())&&(!a.isNil(b.values().parmDesigns)&&a.any(a.either(a.isNil(),a.isEmpty()),a.pluck("parmPrompts",b.values().parmDesigns)))}function v(b,c){Y(b),c=c||b.connections(),a.map(a.invoker(1,"publish")(b.values()),c)}function w(a){Y(a);var c=b.Deferred()
;return a.filter()?a.catalogService.getCatalogItemKey(a.filter()).done(x.bind(null,a,c)):c.resolve(),c.promise()}function x(a,b,c){Y(a),Object.resolve(f,{catalogItemKey:c}).compile().done(y.bind(null,a,b))}function y(a,b,d){if(z(a,d),L(a,a.values()),a.validateDashParameters()&&u(a))return b.reject(),void a.editFilters();B(a),v(a),a.filterLoaded(!0),b.resolve(),c.redraw()}function z(a,b){a.setValues(A(a,b.parmContainer))}q.prototype.loadFilter=function(){w(this)},q.prototype.setValues=function(a){this.values(a)};function A(b,c){l.ok(c);var d=c.parmDesigns||[];return{hasDependencies:!1,parmDesigns:a.map(C.bind(null,b),d)}}function B(a){a.pageFilterService.save(a.id(),a.values())}function C(a,b){return{id:b.id,caption:b.caption,localizedCaption:b.localizedCaption,dataType:b.dataType,isAssetHierarchy:b.isAssetHierarchy||!1,assetHierarchyCaption:b.assetHierarchyCaption||a.defaultAsset.description,parmPrompts:D(a,b),promptDisp:I(b,b.isAssetHierarchy||!1),isMultiValue:b.isMultiValue||!1,
isHidden:b.isHidden||!1,validateDashParameters:b.validateDashParameters,queryValue:b.queryValue}}function D(a,b){l.ok(b,"parameter"),l.ok(b.parmPrompts,"parameter.parmPrompts");var c=i.assetcontext;return H(a.queryValue())||b.isAssetHierarchy||F(b,E(a)),b.parmPrompts.length?b.isAssetHierarchy?b.parmPrompts[0]?b.parmPrompts:[c.entityKey||"-1"]:b.parmPrompts:b.isAssetHierarchy?[b.defaultValue||c.entityKey||"-1"]:null!==b.defaultValue?[b.defaultValue]:[]}function E(b){return Object.keys(b.queryValue()).map(function(c){return{key:a.toLower(c),value:b.queryValue()[c]}})}function F(b,c){var d=a.toLower(a.prop("id",b)),e=a.filter(a.propEq("key",d),c);H(e)||a.map(G.bind(null,b),e)}function G(a,b){a.parmPrompts.indexOf(b.value)>=0||(a.isMultiValue?(a.parmPrompts.push(b.value),H(a.promptDisp)?a.promptDisp=[b.value]:a.promptDisp.push(b.value)):(a.parmPrompts[0]=b.value,a.promptDisp=[b.value]))}function H(b){return a.or(a.isNil(b),a.isEmpty(b))}function I(b,c){if(c)return null
;if(b.parmPrompts&&b.parmValues&&b.parmValues.length){var d=a.filter(a.compose(a.flip(a.contains)(b.parmPrompts),a.prop("value")),b.parmValues);return a.pluck("displayValue",d)}return b.parmPrompts}function J(a){a.preferenceLoaded()||a.pageFilterService.get(a.id()).done(K.bind(null,a))}function K(b,d){L(b,d),H(b.queryValue())||H(d)||a.map(D.bind(null,b),d.parmDesigns),b.setValues(d),b.setPreferenceLoaded(!0),c.redraw(),t(b)}q.prototype.setPreferenceLoaded=function(a){this.preferenceLoaded(a)};function L(b,c){var d=M.bind(null,b);c&&c.parmDesigns&&a.forEach(d,c.parmDesigns)}function M(b,c){var d=i.assetcontext;if(c.isAssetHierarchy)if(H(b.queryValue()))d&&(c.assetHierarchyCaption=d.description||b.defaultAsset.description,c.parmPrompts=[d.entityKey||"-1"]);else if(a.has("enty_key",b.queryValue())){var e=a.prop("enty_key",b.queryValue());c.parmPrompts=[e]}}q.prototype.saveState=function(){return{id:this.id(),caption:this.caption(),localizedCaption:this.localizedCaption(),
filter:this.filter(),filtersDisplayed:this.filtersDisplayed(),values:this.values(),preferenceLoaded:this.preferenceLoaded(),validateDashParameters:this.validateDashParameters(),queryValue:this.queryValue()}},q.prototype.collapseBody=function(){this.filtersDisplayed(!1)},q.prototype.expandBody=function(){this.filtersDisplayed(!0)},q.prototype.editFilters=function(){var a=b.Deferred();return this.filter()?this.catalogService.getCatalogItemKey(this.filter()).done(N.bind(null,this,a)):a.resolve(),a.promise()};function N(a,b,c){Y(a),Object.resolve(f,{catalogItemKey:c}).prompt({parameters:a.values()}).done(O.bind(null,a,b))}function O(a,b,d){Q(d)?(z(a,d),B(a),P(),v(a)):R(a),b.resolve(),c.redraw()}function P(){var a=document.getElementsByTagName("mi-page-filter"),b;if(a.length&&(b=a[0].getElementsByTagName("mi-chart")))for(var c=0;c<b.length;c++)b[c].skipFilterLoad=!1}function Q(a){return!(!a.parmContainer||!a.parmContainer.parmDesigns)}function R(a){
var b=a.translator.translate("NO_QUERY_PARAMETERS"),c=a.translator.translate("QUERY_EXEC_PROMPT_DLG_TITLE");k.showOk(b,c)}q.prototype.deleteFilter=function(a){d.remove(this.values(),a)},q.prototype.hasFiltersApplied=function(){return Y(this),!!this.values()&&(!!this.values().parmDesigns&&this.values().parmDesigns.length>0)},q.prototype.addConnection=function(a){l.ok(a),this.connections().push(a),(S(this)||T(this))&&v(this,[a])};function S(a){return!!a.values()}function T(a){var b=!a.filter();return a.filterLoaded()&&b}q.prototype.removeConnection=function(b){l.ok(b),this.connections(a.reject(b.isSame.bind(b),this.connections()))},q.prototype.reload=function(){J(this)},q.prototype.loadWithoutFilter=function(){this.setValues(null),this.filterLoaded(!0),v(this),c.redraw()},q.prototype.translate=function(a){return this.translator.translate(a)},q.prototype.assetName=function(){var b,c,d,e,f=[],g,h={};if(this.hasFiltersApplied()){
for(a.and(a.isNil(this.values().parmDesigns[0].localizedCaption),a.isNil(this.values().parmDesigns[0].caption))&&w(this),b=0;b!==this.values().parmDesigns.length;b++){if(c=this.values().parmDesigns[b],a.or(a.isNil(c),a.isEmpty(c)))return;if(d=(c.localizedCaption||c.caption||c.id)+": ",c.isAssetHierarchy)h={caption:d,prompts:c.assetHierarchyCaption},f.push(h);else{if(U(c.promptDisp)&&U(c.parmPrompts)||c.isHidden)continue;g=U(c.promptDisp)?c.parmPrompts:c.promptDisp,e=a.map(V.bind(null,this,c.dataType),g),h={caption:d,prompts:e.join()},f.push(h)}}return a.or(a.isNil(f),a.isEmpty(f))?null:f}return null};function U(b){return a.isNil(b)||a.isEmpty(b)||a.isEmpty(a.join("",b))}function V(a,b,c){switch(b){case"Date":return W(a,c)?a.formatter.format(m.toDate(c,a.format,c),a.format):c;case"Numeric":return X(c)?a.formatter.format(c):c;default:return c}}function W(a,b){return n(m.toDate(b,a.format,b)).isValid()}function X(a){return!a||!isNaN(p.parseFloat(a))}function Y(a){l.instanceOf(a,q)}
return q});
define('ui/elements/page-filter/views/page-filter-view',['require','system/text/formatter','system/mithril/mithril-extensions','system/mithril/html-tags','system/mithril/bootstrap-tags'],function(require){"use strict";var a=require("system/text/formatter"),b=require("system/mithril/mithril-extensions"),c=require("system/mithril/html-tags"),d=require("system/mithril/bootstrap-tags");function e(d){var e=d.filter(),g=d.assetName(),h=Object.resolve(a);return i(e,g,[c.div([b.iif(d.filter,k.bind(null,d)),c.h1({title:d.caption()},h.abbreviate(d.caption(),70))]),f(g)],d)}function f(a){return a?c.div({class:"parms-div",title:g(a)},h(a)):null}function g(a){if(!a)return null;var b="";return a.forEach(function(a){b+=a.caption+a.prompts}),b}function h(a){if(!a)return null;var b=[];return a.forEach(function(a){b=b.concat([c.span({class:"lbl-caption"},a.caption),c.span({class:"lbl-parms"},a.prompts)])}),b}function i(a,b,d,e){return c.header({class:j(a,b)},d)}function j(a,b){return a?b?"asset":"no-asset":"no-filter"}function k(a){return a.values()?d.iconButton({title:a.translate("EDIT_FILTERS"),onclick:a.editFilters.bind(a)},[c.icon(".icon-collection-filter")]):c.div({
className:"loading-small loading-active"})}return e});
define('ui/elements/page-filter/page-filter-element',['require','mi-assert','mithril','./view-models/page-filter-view-model','./views/page-filter-view','system/lang/url-codec'],function(require){"use strict";var a=require("mi-assert"),b=require("mithril"),c=require("./view-models/page-filter-view-model"),d=require("./views/page-filter-view"),e=require("system/lang/url-codec"),f={};f.prototype=Object.create(HTMLElement.prototype),f.prototype.createdCallback=function a(){this.private={vm:Object.resolve(c),view:d,root:null},Object.defineProperty(this,"filterId",{get:g.bind(null,this)}),Object.defineProperty(this,"caption",{get:i.bind(null,this)}),Object.defineProperty(this,"filter",{get:j.bind(null,this)}),Object.defineProperty(this,"validate-dash-parameters",{get:k.bind(null,this)}),Object.defineProperty(this,"query-string",{get:l.bind(null,this)})};function g(a){return r(a),h(a).id()}function h(a){return r(a),a.private.vm}function i(a){return r(a),h(a).caption()}function j(a){return r(a),h(a).filter()}function k(a){return r(a),h(a).validateDashParameters()}function l(a){return r(a),h(a).queryValue()}f.prototype.attachedCallback=function a(){
h(this).id(this.getAttribute("filter-id")),h(this).caption(this.getAttribute("caption")),h(this).filter(this.getAttribute("filter")),h(this).validateDashParameters(this.getAttribute("validate-dash-parameters")),h(this).queryValue(this.getAttribute("query-string")),m(this)};function m(a){r(a);var b=Element.build("div",null,["page-filter-root"]);a.insertBefore(b,a.firstChild),n(a,b)}function n(a,b){return r(a),void 0!==b&&(a.private.root=b),a.private.root}f.prototype.detachedCallback=function a(){o(this)};function o(a){r(a);var c=n(a);b.mount(c,null),c.parentNode.removeChild(c)}f.prototype.attributeChangedCallback=function a(b,c,d){Object.tryMethod(this,b.replace(/-/g,"_")+"_changed",c,d)},f.prototype.filter_id_changed=function a(c,d){h(this).id(d),b.redraw()},f.prototype.caption_changed=function a(c,d){h(this).caption(d),b.redraw()},f.prototype.filter_changed=function a(c,d){h(this).filter(d),b.redraw()},f.prototype.validate_dash_parameters_changed=function a(c,d){
h(this).validateDashParameters(null!==d),b.redraw()},f.prototype.query_string_changed=function a(c,d){h(this).queryValue(d?e.decode(decodeURIComponent(d)):null),b.redraw()},f.prototype.loadFilter=function a(c){h(this).loadFilter(c),b.redraw()},f.prototype.loadState=function a(c){h(this).loadState(c),b.mount(n(this),{controller:p.bind(null,this),view:q(this)})};function p(a){return r(a),h(a)}function q(a){return r(a),a.private.view}f.prototype.saveState=function a(){return h(this).saveState()},f.prototype.reload=function a(){h(this).reload()},f.prototype.connect=function a(b){h(this).addConnection(b)},f.prototype.disconnect=function a(b){h(this).removeConnection(b)},f.prototype.loadWithoutFilter=function a(){h(this).loadWithoutFilter()},f.prototype.editFilters=function a(){h(this).editFilters()},f.prototype.clearFilter=function(){h(this).filter(null),h(this).values(null),h(this).preferenceLoaded(!1),b.redraw()},f.prototype.getValues=function(){return h(this).values()};function r(b){
a.instanceOf(b,HTMLElement,"self"),a.isNotUndefined(b.private.vm,"self.vm"),a.isNotUndefined(b.private.view,"self.view"),a.isNotUndefined(b.private.root,"self.root")}return Element.registerElement("mi-page-filter",{prototype:f.prototype}),f});
define('ui/elements/dashboard/dashboard-error-handler',['require','exports','module','application/application-context','system/ui/message-box','logging/error-notification-handler','system/diagnostics/log-manager','lodash'],function(require,exports,module){"use strict";var a=require("application/application-context"),b=require("system/ui/message-box"),c=require("logging/error-notification-handler"),d=require("system/diagnostics/log-manager"),e=d.getLogger(module.id),f=require("lodash"),g="Meridium.Core.Exceptions.CatalogException",h="Cannot find the Catalog item.";function i(a){this.translator=a,this.DASHBOARD_PARSE_ERROR=this.translator.translate("DASHBOARD_PARSE_ERROR"),this.DASHBOARD_NOT_FOUND=this.translator.translate("CANNOT_FIND_DASHBOARD"),this.errorNotificationHandler=Object.resolve(c)}i.prototype.handleDashboardError=function(a,b){var c=p(this,b),d=!!c.exceptionMessage,e;if(j(c))return void r(this);if(m(this,c))return void s(this,a);throw e=d?n(this,b,c):new Error(c)},i.prototype.handleIISError=function(a,b){var c,d;if(404!==b.status)throw c=a.url+" "+b.statusText,d=new Error(c+" ("+status+")");q(this)},i.prototype.logError=function(a){e.error(a.stack),
this.errorNotificationHandler.addError({errorMessage:a.message,errorDetail:a.stack})};function j(a){return k(a)&&l(a)}function k(a){var b=!1;return a&&a.exceptionType&&(b=a.exceptionType.toUpperCase()===g.toUpperCase()),b}function l(a){var b=!1;return a&&a.exceptionMessage&&(b=a.exceptionMessage.toUpperCase()===h.toUpperCase()),b}function m(a,b){return b.exceptionType===g&&b.exceptionMessage===a.DASHBOARD_PARSE_ERROR}function n(a,b,c){var d=b.statusText+": "+c.exceptionMessage,e;return d=o(a,b,d),e=new Error(d),e.stack=e.stack?e.stack+"":"",c.stackTrace&&(e.stack=e.stack+"\n\nFrom Server: "+c.exceptionMessage+"\n"+c.stackTrace),e}function o(a,b,c){return"Cannot find the Catalog item."===b.responseJSON.exceptionMessage&&(c=a.translator.translate("DASHBOARD_POSSIBLY_DELETED")),c}function p(a,b){var c;try{c=JSON.parse(b.responseText)}catch(b){c=a.DASHBOARD_NOT_FOUND}return c}function q(c){var d=c.translator.translate("DASHBOARD_LOAD_ERROR")
;a.connectionStatus.connected||(d+=" - "+c.translator.translate("OFFLINE")),b.showOk(d,c.translator.translate("ERROR"))}function r(a){var c=a.translator.translate("DASHBOARD_POSSIBLY_DELETED");b.showOk(c,a.DASHBOARD_NOT_FOUND)}function s(a){var c=a.translator.translate("DASHBOARD_PARSE_ERROR");b.showOk(c,a.translator.translate("ERROR"))}return i});
define('ui/elements/dashboard/dashboard-controller',['require','lodash','dashboard/services/dashboard-service','dashboard/adapters/dashboard-container-adapter','ui/elements/dashboard/dashboard-error-handler','system/globalization/translator','system/ui/message-box','system/lang/event','system/lang/property','mi-assert'],function a(require){"use strict";var b=require("lodash"),c=require("dashboard/services/dashboard-service"),d=require("dashboard/adapters/dashboard-container-adapter"),e=require("ui/elements/dashboard/dashboard-error-handler"),f=require("system/globalization/translator"),g=require("system/ui/message-box"),h=require("system/lang/event"),i=require("system/lang/property"),j=require("mi-assert");function k(){var a=Object.resolve(c);i.readWrite(this,"dashboard",null),i.readOnly(this,"dashboardService",a),i.readOnly(this,"inEditMode",!1),i.readOnly(this,"throttledSave",b.debounce(a.save.bind(a),300)),i.readOnly(this,"dashboardChanged",Object.resolve(h)),i.readOnly(this,"editModeChanged",Object.resolve(h)),i.readOnly(this,"widgetAdded",Object.resolve(h)),i.readOnly(this,"widgetRemoved",Object.resolve(h)),i.readOnly(this,"widgetHidden",Object.resolve(h)),i.readOnly(this,"widgetUnhidden",Object.resolve(h)),this.dashboardErrorHandler=new e(Object.resolve(f))}
k.prototype.getCurrentDashboard=function(){try{return l(this)}catch(a){this.dashboardErrorHandler.logError(a)}};function l(a){return R(a),a.dashboard}k.prototype.setCurrentDashboard=function(a){try{m(this,a)}catch(a){this.dashboardErrorHandler.logError(a)}};function m(a,b){j.ok(b),n(a),o(a,b),l(a).saveRequested.add(r,null,a),l(a).widgetRemoved.add(p,null,a),l(a).widgetHidden.add(t,null,a),v(a)}function n(a){R(a),l(a)&&(l(a).saveRequested.remove(a),l(a).dispose())}function o(a,b){R(a),j.ok(b),a.dashboard=b}function p(a,b,c){R(a),j.assert(b===l(a)),j.ok(c),q(a,c),r(a)}function q(a,b){R(a),a.widgetRemoved.raise(a,b)}function r(a){R(a),s(a,d.toDTO(l(a)))}function s(a,b){R(a),j.ok(b),a.throttledSave(b)}function t(a,b,c){R(a),j.assert(b===l(a)),j.ok(c),u(a,c),r(a)}function u(a,b){R(a),a.widgetHidden.raise(a,b)}function v(a){R(a),a.dashboardChanged.raise(a,l(a))}k.prototype.loadDashboard=function a(b,c){try{w(this,b,c)}catch(a){this.dashboardErrorHandler.logError(a)}};function w(a,b,c){
b?x(a,b):c&&B(a,c)}function x(a,b){R(a),j.ok(b),y(a).getDashboardByKey(b).done(z.bind(null,a)).fail(A.bind(null,a))}function y(a){return R(a),a.dashboardService}function z(a,b){R(a),j.ok(b),a.setCurrentDashboard(d.toModel(b))}function A(a,b,c){R(a),j.ok(b,"request"),j.ok(c,"response"),c.status>=500?a.dashboardErrorHandler.handleDashboardError(b,c):a.dashboardErrorHandler.handleIISError(b,c)}function B(a,b){R(a),j.ok(b),y(a).getDashboardByPath(b).done(z.bind(null,a)).fail(A.bind(null,a))}k.prototype.toggleEditMode=function(){try{C(this)}catch(a){this.dashboardErrorHandler.logError(a)}};function C(a){a.inEditMode&&r(a),D(a,!a.inEditMode),E(a)}function D(a,b){R(a),j.isBoolean(b),i.set(a,"inEditMode",b)}function E(a){R(a),a.editModeChanged.raise(a,a.inEditMode)}k.prototype.addWidget=function(a){try{F(this,a)}catch(a){this.dashboardErrorHandler.logError(a)}};function F(a,b){j.ok(b),l(a).addWidget(b),G(a,b)}function G(a,b){R(a),a.widgetAdded.raise(a,b)}k.prototype.showWidget=function(a){try{
H(this,a)}catch(a){this.dashboardErrorHandler.logError(a)}};function H(a,b){j.ok(b),l(a).showWidget(b),I(a,b)}function I(a,b){R(a),a.widgetUnhidden.raise(a,b)}k.prototype.removeWidgetWithoutPrompt=function(a){try{l(this).removeWidgetWithoutPrompt(a)}catch(a){this.dashboardErrorHandler.logError(a)}},k.prototype.loadState=function(a,b,c){try{J(this,a,b,c)}catch(a){this.dashboardErrorHandler.logError(a)}};function J(a,b,c,d){b&&b.dashboard?a.setCurrentDashboard(b.dashboard):a.loadDashboard(c,d),b&&b.inEditMode&&!K(a)&&(D(a,b.inEditMode),E(a))}function K(a){return L(a)&&M(a)||L(a)&&N(a)}function L(a){return!l(a).readOnly()}function M(a){return 0===l(a).content().length}function N(a){return 0===l(a).visibleContent().length}k.prototype.saveState=function(){try{return O(this)}catch(a){this.dashboardErrorHandler.logError(a)}};function O(a){return a.inEditMode&&r(a),{dashboard:l(a),inEditMode:a.inEditMode}}k.prototype.setHomePage=function(){try{P(this)}catch(a){
this.dashboardErrorHandler.logError(a)}};function P(a){var b=Object.resolve(f),c=b.translate("HOME_PAGE_CONFIRMATION"),d=b.translate("SET_AS_HOME_PAGE");g.showYesNo(c,d).done(Q.bind(null,a))}function Q(a,b){b||a.dashboardService.setHomePage(l(a).path())}function R(a){j.instanceOf(a,k)}return k});
define('ui/elements/grid-layout/grid-layout-element',['require','mi-assert'],function a(require){"use strict";var b=require("mi-assert"),c={};return c.prototype=Object.create(HTMLElement.prototype),c.create=function a(c){b.instanceOf(c,HTMLElement);var d=Element.build("mi-grid-layout",c);return Element.upgrade(d),d},Element.registerElement("mi-grid-layout",{prototype:c.prototype}),c});
define('ui/elements/grid-layout/size',['require','mi-assert'],function a(require){"use strict";var b=require("mi-assert");function c(a,b){this.width=a,this.height=b}return c.prototype.update=function a(c,d){b.isNumber(c,"width"),b.isNumber(d,"height"),this.width=c,this.height=d},c.prototype.copy=function a(d){d&&(b.instanceOf(d,c),this.width=d.width,this.height=d.height)},c.prototype.clone=function a(){return new c(this.width,this.height)},c.prototype.minWidth=function a(c){return b.isNumber(c),c<this.width?this.width:c},c.prototype.minHeight=function a(c){return b.isNumber(c),c<this.height?this.height:c},c.prototype.equals=function a(d){return!!d&&(b.instanceOf(d,c),this.height===d.height&&this.width===d.width)},c});
define('system/lang/interval-timer',['require','./event'],function(require){"use strict";var a=require("./event");function b(b){this.interval=b,this.elapsed=new a,this.onIntervalInstance=null,this.id=null}b.prototype.start=function a(){c(this),e(this)},b.prototype.stop=function a(){d(this),f(this)},b.prototype.onInterval=function a(){this.elapsed.raise(this),e(this)};function c(a){a.onIntervalInstance=a.onInterval.bind(a)}function d(a){a.onIntervalInstance=null}function e(a){a.id=setTimeout(a.onIntervalInstance,a.interval)}function f(a){a.id&&(clearTimeout(a.id),a.id=null)}return b});
define('ui/elements/grid-layout/resize-watcher',['require','jquery','./size','system/lang/interval-timer','system/lang/event','mi-assert'],function a(require){"use strict";var b=require("jquery"),c=require("./size"),d=require("system/lang/interval-timer"),e=require("system/lang/event"),f=require("mi-assert");function g(){this.sizeChanged=new e,this.size=new c(0,0),this.newSize=new c(0,0),this.element=null,this.$element=null,this.timer=Object.resolve(d,300)}g.prototype.watch=function a(c){f.instanceOf(c,HTMLElement),this.element=c,this.$element=b(c),this.size.update(this.$element.width(),this.$element.height()),h(this)},g.prototype.timerElapsed=function a(){var b=j(this,this.element);!this.size.equals(b)&&(this.size.update(b.width,b.height),k(this))},g.prototype.stop=function a(){this.element=null,this.$element=null,this.size.update(0,0),i(this)};function h(a){f.instanceOf(a,g),a.timer.elapsed.add(a.timerElapsed,a),a.timer.start()}function i(a){f.instanceOf(a,g),a.timer.stop(),a.timer.elapsed.remove(a)}function j(a,b){return f.instanceOf(a,g),f.instanceOf(b,HTMLElement),
a.newSize.update(a.$element.width(),a.$element.height()),a.newSize}function k(a){f.instanceOf(a,g),a.sizeChanged.raise(a,a.size.height,a.size.width)}return g});
define('ui/elements/grid-layout/position',['require','lodash','mi-assert'],function a(require){"use strict";var b=require("lodash"),c=require("mi-assert");function d(a,b,c){this.x=a,this.y=b,this.z=c}return d.prototype.update=function a(d,e,f){c.isNumber(d,"x"),c.isNumber(e,"y"),c.assert(b.isNumber(f)||void 0===f),this.x=d,this.y=e,this.z=f},d.prototype.copy=function a(b){b&&(c.instanceOf(b,d),this.x=b.x,this.y=b.y,this.z=b.z)},d.prototype.clone=function a(){return new d(this.x,this.y,this.z)},d.prototype.equals=function a(b){return!!b&&(c.instanceOf(b,d),this.x===b.x&&(this.y===b.y&&this.z===b.z))},d});
define('ui/elements/grid-layout/rectangle',['require','./position','./size','mi-assert'],function a(require){"use strict";var b=require("./position"),c=require("./size"),d=require("mi-assert");function e(a,d){this.position=a?a.clone():new b(0,0),this.size=d?d.clone():new c(0,0)}return e.deserialize=function a(b){d.isObject(b);var c=new e;return c.updatePosition(b.x||0,b.y||0,b.z||1),c.updateSize(b.width||0,b.height||0),c},e.prototype.x=function a(){return this.position.x},e.prototype.y=function a(){return this.position.y},e.prototype.z=function a(){return this.position.z},e.prototype.width=function a(){return this.size.width},e.prototype.height=function a(){return this.size.height},e.prototype.left=function a(){return this.x()},e.prototype.right=function a(){return this.left()+this.width()},e.prototype.top=function a(){return this.y()},e.prototype.bottom=function a(){return this.top()+this.height()},e.prototype.updatePosition=function a(b,c,e){d.isNumber(b,"x"),d.isNumber(c,"y"),d.isNumber(e,"z"),this.position.update(b,c,e)},e.prototype.updateSize=function a(b,c){
d.isNumber(b,"width"),d.isNumber(c,"height"),this.size.update(b,c)},e.prototype.copy=function a(b){b&&(d.instanceOf(b,e),this.position.copy(b.position),this.size.copy(b.size))},e.prototype.equals=function a(b){return!!b&&(d.instanceOf(b,e),!!b.position&&(!!b.size&&(this.position.equals(b.position)&&this.size.equals(b.size))))},e.prototype.serialize=function a(){return{x:this.x(),y:this.y(),width:this.width(),height:this.height()}},e});
define('ui/elements/grid-layout/wrap-layout-strategy',['require','lodash','./rectangle','mi-assert'],function a(require){"use strict";var b=require("lodash"),c=require("./rectangle"),d=require("mi-assert");function e(a){this.grid=a,this.maxY=0,this.items=this.grid.items}e.prototype.defineRectangle=function a(b){var d=new c;return f(this,d,b),i(this,d,b),d},e.prototype.dispose=function a(){this.items=null,this.grid=null};function f(a,b,f){d.instanceOf(a,e,"self"),d.instanceOf(b,c,"r"),d.isObject(f,"item");var i=g(a),j=h(a);b.updateSize(i,j)}function g(a){var b=a.grid.columnCount>=16?8:6;return Math.min(b,a.grid.columnCount)}function h(a){return Math.min(6,a.grid.columnCount)}function i(a,b,f){d.instanceOf(a,e,"self"),d.instanceOf(b,c,"r"),d.isObject(f,"item");var g,h;g=j(a,f),b.position.y=l(a,g),h=n(a,g,b),b.position.x=p(a,h),r(a,b)&&s(a,h,b)}function j(a,c){return b.filter(a.items,k.bind(null,c))}function k(a,b){return b!==a}function l(a,c){return b.reduce(c,m.bind(null,a),0)}function m(a,b,c){return Math.max(b,x(a,c))}function n(a,c,d){return b.filter(c,o.bind(null,a,d))}
function o(a,b,c){return b.position.y===x(a,c)}function p(a,c){return b.reduce(c,q.bind(null,a),0)}function q(a,b,c){return Math.max(b,y(a,c)+z(a,c))}function r(a,b){return d.instanceOf(a,e,"self"),d.instanceOf(b,c,"r"),b.x()>a.grid.columnCount-b.width()}function s(a,b,c){c.position.x=0,c.position.y=t(a,b)}function t(a,c){return b.reduce(c,u.bind(null,a),0)}function u(a,b,c){return Math.max(b,x(a,c)+A(a,c))}function v(a,b,c){var d=b.rectangles[a.grid.currentLayout];return d?a.grid.toBlocks(d.position[c]):0}function w(a,b,c){var d=b.rectangles[a.grid.currentLayout];return d?a.grid.toBlocks(d.size[c]):0}function x(a,b){return v(a,b,"y")}function y(a,b){return v(a,b,"x")}function z(a,b){return w(a,b,"width")}function A(a,b){return w(a,b,"height")}return e});
define('ui/elements/grid-layout/grid-layout-collection-controller',['require','lodash','jquery','./resize-watcher','system/lang/event','./wrap-layout-strategy','mi-assert'],function a(require){"use strict";var b=require("lodash"),c=require("jquery"),d=require("./resize-watcher"),e=require("system/lang/event"),f=require("./wrap-layout-strategy"),g=require("mi-assert"),h=80,i=17;function j(a,b,c){this.element=a,this.columns=b,this.widths=c,this.columnCount=b.desktop,this.items=[],this.layerCount=1,this.resizeWatcher=Object.resolve(d),this.currentLayout="",this.resized=Object.resolve(e),this.heightChanged=Object.resolve(e),this.layoutChanged=Object.resolve(e),this.layoutStrategy=Object.resolve(f,this),this.width=0,this.height=0,this.heightCheckValue={value:0},this.deferredResize={active:!1,width:0,height:0},this.draggingItem=!1,this.inEditMode=!1,this.editModeChanged=Object.resolve(e)}j.prototype.init=function a(){this.resizeWatcher.sizeChanged.add(m,null,this),this.resizeWatcher.watch(document.querySelector("#shell-screen")),this.width=this.resizeWatcher.size.width-w(this),p(this,this.width)},j.prototype.dispose=function a(){
this.resizeWatcher.stop(),this.resizeWatcher.sizeChanged.remove(this),this.resizeWatcher=null,this.layoutStrategy.dispose(),this.layoutStrategy=null,this.resized=null,this.element=null},j.prototype.addItem=function a(b){g.ok(b),this.items.push(b),this.layerCount=r(this,this.layout())},j.prototype.removeItem=function a(c){g.ok(c),b.remove(this.items,function(a){return a===c}),this.notifyItemChanged()},j.prototype.addLayer=function a(){this.layerCount++},j.prototype.notifyDragStarted=function a(b){this.draggingItem=!0},j.prototype.notifyDragEnded=function a(b){this.draggingItem=!1,s(this),n(this)},j.prototype.notifyItemChanged=function a(b){k(this),this.height!==this.heightCheckValue.value&&(this.height=this.heightCheckValue.value,this.heightChanged.raise(this,this.height,this.blockSize()))};function k(a){g.instanceOf(a,j),a.heightCheckValue.value=0,b.each(a.items,l.bind(null,a))}function l(a,b){g.instanceOf(a,j),g.ok(b,"item"),g.ok(b.rectangle,"item.rectangle"),
g.isFunction(b.rectangle.bottom,"item.rectangle.bottom");var c=b.rectangle.bottom();a.heightCheckValue.value<c&&(a.heightCheckValue.value=c)}j.prototype.toPixels=function a(b){return g.isNumber(b),b*this.blockSize()},j.prototype.toBlocks=function a(b){return g.isNumber(b),Math.floor(b/this.blockSize())},j.prototype.blockSize=function a(){return Math.floor(this.width/this.columnCount)},j.prototype.layout=function a(){return this.currentLayout},j.prototype.defineRectangle=function a(b){return g.ok(b),this.layoutStrategy.items=this.items,this.layoutStrategy.defineRectangle(b)},j.prototype.toggleEditMode=function a(){this.inEditMode=!this.inEditMode,this.editModeChanged.raise(this,this.inEditMode)};function m(a,b,c,d){g.instanceOf(a,j),g.isNumber(c),g.isNumber(d),d-=w(a),a.draggingItem?(a.deferredResize.active=!0,a.deferredResize.height=c,a.deferredResize.width=d):o(a,d,c)}function n(a){if(g.instanceOf(a,j),a.deferredResize.active){var b=a.deferredResize.width,c=a.deferredResize.height
;a.deferredResize.active=!1,a.deferredResize.height=0,a.deferredResize.width=0,o(a,b,c)}}function o(a,b,c){g.instanceOf(a,j),g.isNumber(c),g.isNumber(b),a.width!==b&&(a.width=b,p(a,b),a.resized.raise(a,b,c))}function p(a,b){g.instanceOf(a,j),g.isNumber(b),b<=a.widths.phone?q(a,"phone"):b<=a.widths.smallTablet?q(a,"smallTablet"):b<=a.widths.tablet?q(a,"tablet"):b<=a.widths.desktop?q(a,"desktop"):q(a,"hd")}function q(a,b){g.instanceOf(a,j),g.isString(b),a.currentLayout=b,a.columnCount=a.columns[b],a.layerCount=r(a,b),a.layoutChanged.raise(a,b)}function r(a,c){return b.reduce(a.items,function(a,b){return Math.max(b.z(),a)},1)}function s(a){var c=b.invokeMap(a.items,"z"),d=b(a.items).invokeMap("z").uniq().sort(t).value(),e=b.map(c,u.bind(null,d));b.forEach(a.items,v.bind(null,e))}function t(a,b){return a-b}function u(a,c){return b.indexOf(a,c)+1}function v(a,b,c){b.updateZ(a[c]),b.notifyZIndexUpdated()}function w(a){var b=c("nav.leftnav"),d=Math.min(b.width(),h);return i+d}return j});
define('ui/elements/grid-layout/grid-layout-collection-element',['require','lodash','jquery','./grid-layout-collection-controller','mi-assert'],function a(require){"use strict";var b=require("lodash"),c=require("jquery"),d={},e=require("./grid-layout-collection-controller"),f=require("mi-assert");d.prototype=Object.create(HTMLElement.prototype),d.create=function a(b,c,d,e,f,g){return Element.build("mi-grid-layout-collection",b,null,{"phone-columns":c,"small-tablet-columns":d,"tablet-columns":e,"desktop-columns":f,"hd-columns":g})},d.prototype.createdCallback=function a(){g(this)};function g(a){var b=117,c=599-b,d=767-b,f=1023-b,g=1800-b,h={phone:Element.intAttribute(a,"phone-columns",4),smallTablet:Element.intAttribute(a,"small-tablet-columns",8),tablet:Element.intAttribute(a,"tablet-columns",12),desktop:Element.intAttribute(a,"desktop-columns",24),hd:Element.intAttribute(a,"hd-columns",24)},i={phone:Element.intAttribute(a,"phone-width",c),smallTablet:Element.intAttribute(a,"small-tablet-width",d),tablet:Element.intAttribute(a,"tablet-width",f),desktop:Element.intAttribute(a,"desktop-width",g)};a.controller=new e(a,h,i)
}d.prototype.attachedCallback=function a(){h(this)};function h(a){a.controller.resized.add(i,null,a),a.controller.heightChanged.add(j,null,a),a.controller.editModeChanged.add(n,null,a),o(a),a.controller.init()}function i(a,b,c,d){f.instanceOf(a,HTMLElement),f.isNumber(c,"width"),f.isNumber(d,"height"),Element.raiseEvent(a,"collection-element-resized",{height:d,width:c})}function j(a,b,c,d){f.instanceOf(a,HTMLElement),f.isNumber(c,"height"),k(a,c+16),a.controller&&a.controller.inEditMode&&l(a)}function k(a,b){f.instanceOf(a,HTMLElement),f.isNumber(b,"height"),a.style.height=b+"px"}function l(a){f.instanceOf(a,HTMLElement);var b=a.controller.blockSize(),c=b,d=b;for(m(a);c<a.controller.width;)Element.build("div",a,["v-line"],{style:"left: "+c+"px;"}),c+=b;for(;d<a.controller.height;)Element.build("div",a,["h-line"],{style:"top: "+d+"px;"}),d+=b}function m(a){c("div.v-line",a).remove(),c("div.h-line",a).remove()}function n(a,c,d){f.instanceOf(a,HTMLElement),f.isBoolean(d),d?(l(a),
a.classList.add("editable")):(m(a),a.classList.remove("editable")),b.invokeMap(a.querySelectorAll("mi-grid-layout-item"),"toggleEditMode")}function o(a){a.controller.inEditMode&&n(a,a,a.controller.inEditMode)}return d.prototype.detachedCallback=function a(){this.controller.dispose(),this.controller=null},d.prototype.currentLayout=function a(){return this.controller.currentLayout},d.prototype.toggleEditMode=function a(){this.controller.toggleEditMode()},Element.registerElement("mi-grid-layout-collection",{prototype:d.prototype}),d});
define('ui/elements/grid-layout/grid-layout-item-controller',['require','system/lang/event','./rectangle','./size','mi-assert'],function a(require){"use strict";var b=require("system/lang/event"),c=require("./rectangle"),d=require("./size"),e=require("mi-assert");function f(a){this.parent=a,this.moved=Object.resolve(b),this.resized=Object.resolve(b),this.layoutCreated=Object.resolve(b),this.zIndexUpdated=Object.resolve(b),this.rectangles={},this.rectangle=null,this.minSize=null,this.inEditMode=!1,this.editModeChanged=Object.resolve(b)}f.prototype.init=function a(b){e.isObject(b),this.minSize=j(this,b.minWidth||1,b.minHeight||1),this.rectangle=g(this,b),this.parent.addItem(this),this.parent.layoutChanged.add(q,null,this),l(this),n(this)},f.prototype.dispose=function a(){this.resized.remove(),this.moved.remove(),this.layoutCreated.remove(),this.zIndexUpdated.remove(),this.minSize=null,this.rectangle=null,this.resized=null,this.moved=null,this.parent.removeItem(this),this.parent=null},f.prototype.x=function a(){return this.rectangle.x()},f.prototype.x_blocks=function a(){return p(this,this.x())},
f.prototype.y=function a(){return this.rectangle.y()},f.prototype.y_blocks=function a(){return p(this,this.y())},f.prototype.z=function a(){return this.rectangle.z()},f.prototype.width=function a(){return this.rectangle.width()},f.prototype.width_blocks=function a(){return p(this,this.width())},f.prototype.height=function a(){return this.rectangle.height()},f.prototype.height_blocks=function a(){return p(this,this.height())},f.prototype.blockSize=function a(){return this.parent.blockSize()},f.prototype.bringToFront=function a(){this.parent.addLayer(),this.updateZ(s(this))},f.prototype.updateZ=function a(b){k(this,this.x(),this.y(),b)},f.prototype.move=function a(b,c){var d=u(this,Math.max(this.x()+b,0)),e=u(this,Math.max(this.y()+c,0)),f=this.z();d=v(this,d),k(this,d,e,f)},f.prototype.resize=function a(b,c){var d=this.width()+b,e=this.height()+c,f=o(this,this.minSize.width),g=o(this,this.minSize.height);d=Math.max(d,f),e=Math.max(e,g),
(d=w(this,d))===this.width()&&e===this.height()||m(this,d,e)},f.prototype.updateBlockPosition=function a(b,c,d){e.isNumber(b,"x"),e.isNumber(c,"y"),e.isNumber(d,"z"),k(this,o(this,b),o(this,c),d)},f.prototype.updateBlockSize=function a(b,c){e.isNumber(b,"width"),e.isNumber(c,"height"),m(this,o(this,b),o(this,c))},f.prototype.notifyDragStarted=function a(){this.parent.notifyDragStarted(this)},f.prototype.notifyDragEnded=function a(){this.parent.notifyDragEnded(this)},f.prototype.notifyZIndexUpdated=function a(){this.zIndexUpdated.raise(this)},f.prototype.layout=function a(){return this.parent.layout()},f.prototype.displayIndex=function a(){return 1e5*this.y_blocks()+this.x_blocks()},f.prototype.toggleEditMode=function a(){this.inEditMode=!this.inEditMode,this.editModeChanged.raise(this,this.inEditMode)},f.prototype.toString=function a(){return"GridLayoutItemController: "+JSON.stringify({x:this.rectangle?this.x_blocks():null,y:this.rectangle?this.y_blocks():null,
z:this.rectangle?this.z():null,height:this.rectangle?this.height_blocks():null,width:this.rectangle?this.width_blocks():null})};function g(a,b){return e.instanceOf(a,f),e.isObject(b),h(b.desktop)&&!h(b.hd)&&(b.hd={x:b.desktop.x,y:b.desktop.y,z:b.desktop.z,width:b.desktop.width,height:b.desktop.height}),a.rectangles={phone:i(a,b.phone),smallTablet:i(a,b.smallTablet),tablet:i(a,b.tablet),desktop:i(a,b.desktop),hd:i(a,b.hd)},a.rectangles[a.layout()]||(a.rectangles[a.layout()]=i(a,t(a,a.layout()))),a.rectangles[a.layout()]}function h(a){return a.width&&a.height}function i(a,b){return e.instanceOf(a,f),e.isObject(b),b.width&&b.height?c.deserialize({x:o(a,b.x||0),y:o(a,b.y||0),z:b.z||1,width:o(a,b.width),height:o(a,b.height)}):null}function j(a,b,c){return e.instanceOf(a,f),e.isNumber(b,"width"),e.isNumber(c,"height"),new d(b,c)}function k(a,b,c,d){e.instanceOf(a,f),e.isNumber(b,"x"),e.isNumber(c,"y"),e.isNumber(d,"z"),a.rectangle.updatePosition(b,c,d),l(a)}function l(a){e.instanceOf(a,f),
a.moved&&(a.moved.raise(a,a.x(),a.y(),a.z()),a.parent.notifyItemChanged(a))}function m(a,b,c){e.instanceOf(a,f),e.isNumber(b,"width"),e.isNumber(c,"height"),a.rectangle.updateSize(b,c),n(a)}function n(a){e.instanceOf(a,f),a.resized&&a.parent&&(a.resized.raise(a,a.width(),a.height()),a.parent.notifyItemChanged(a))}function o(a,b){return e.instanceOf(a,f),e.isNumber(b),a.parent.toPixels(b)}function p(a,b){return e.instanceOf(a,f),e.isNumber(b),a.parent.toBlocks(b)}function q(a,b,c){e.instanceOf(a,f),e.isString(c),a.rectangles[c]?a.rectangle=a.rectangles[c]:r(a,c),l(a),n(a)}function r(a,b){a.parent&&(a.rectangles[b]=i(a,t(a,b)),a.rectangle=a.rectangles[b],a.layoutCreated.raise(a))}function s(a){return e.instanceOf(a,f),a.parent.layerCount}function t(a,b){return e.instanceOf(a,f),a.parent.defineRectangle(a).serialize()}function u(a,b){return Math.floor(b/a.blockSize())*a.blockSize()}function v(a,b){return b+a.width()>a.parent.width?u(a,a.parent.width-a.width()):b}function w(a,b){
return a.x()+b>a.parent.width?u(a,a.parent.width-a.x()):b}return f});
define('ui/elements/grid-layout/grid-layout-item-element',['require','lodash','jquery','./grid-layout-item-controller','interact','mi-assert'],function a(require){"use strict";var b=require("lodash"),c=require("jquery"),d={},e=require("./grid-layout-item-controller"),f=require("interact"),g=require("mi-assert"),h="transform"in document.body.style?"transform":"webkitTransform"in document.body.style?"webkitTransform":"mozTransform"in document.body.style?"mozTransform":"oTransform"in document.body.style?"oTransform":"msTransform";d.sortByDisplayIndex=function(a){return g.isArray(a),b.sortBy(a,d.displayIndex)},d.displayIndex=function a(b){return g.instanceOf(b,HTMLElement),g.isFunction(b.displayIndex),b.displayIndex()},d.create=function(a,c,d,e){g.instanceOf(a,HTMLElement),g.isNumber(c,"minWidth"),g.isNumber(c,"minHeight"),g.isObject(e);var f=Element.build("mi-grid-layout-item",null,null,{"min-width":c,"min-height":d});return b.each(e,i.bind(null,f)),a.appendChild(f),f};function i(a,b,c){g.instanceOf(a,HTMLElement),g.isObject(b),g.isNumber(b.x,"layout.x"),g.isNumber(b.y,"layout.y"),g.isNumber(b.width,"layout.width"),
g.isNumber(b.height,"layout.height"),g.isString(c),a.setPositionAttributes(c,b.x,b.y,b.z||1),a.setSizeAttributes(c,b.width,b.height)}d.prototype=Object.create(HTMLElement.prototype),d.prototype.createdCallback=function(){this.controller=null,this.interactable=null,this.resizeHandleInteractable=null,this.parent_resized=null,this.drag_started=j.bind(null,this),this.drag_moved=k.bind(null,this),this.drag_ended=l.bind(null,this),this.resize_started=m.bind(null,this),this.resize_moved=n.bind(null,this),this.resize_ended=o.bind(null,this),this.resizeHandle=null};function j(a,b){g.instanceOf(a,HTMLElement),a.controller.notifyDragStarted(),a.controller.bringToFront(),c(a).addClass("dragging")}function k(a,b){g.instanceOf(a,HTMLElement),g.isObject(b),g.isNumber(b.dx,"e.dx"),g.isNumber(b.dy,"e.dy"),a.controller.move(b.dx,b.dy)}function l(a,b){g.instanceOf(a,HTMLElement),p(a,a.controller.layout()),a.controller.notifyDragEnded(),c(a).removeClass("dragging")}function m(a,b){
g.instanceOf(a,HTMLElement),a.controller.notifyDragStarted(),a.controller.bringToFront(),c(a).addClass("resizing")}function n(a,b){g.instanceOf(a,HTMLElement),g.isObject(b),g.isNumber(b.dx,"e.dx"),g.isNumber(b.dy,"e.dy"),a.controller.resize(b.dx,b.dy)}function o(a,b){g.instanceOf(a,HTMLElement),p(a,a.controller.layout()),r(a,a.controller.layout()),a.controller.notifyDragEnded(),c(a).removeClass("resizing")}function p(a,b){g.instanceOf(a,HTMLElement),g.isString(b);var c=a.controller.x_blocks(),d=a.controller.y_blocks(),e=a.controller.z();a.setPositionAttributes(b,c,d,e),q(a)}function q(a){g.instanceOf(a,HTMLElement),Element.raiseEvent(a,"change",{layout:a.controller.layout(),x:a.controller.x_blocks(),y:a.controller.y_blocks(),z:a.controller.z(),width:a.controller.width_blocks(),height:a.controller.height_blocks()})}function r(a,b){g.instanceOf(a,HTMLElement),g.isString(b);var c=a.controller.width_blocks(),d=a.controller.height_blocks();a.setSizeAttributes(b,c,d),q(a)}
d.prototype.attachedCallback=function(){this.resizeHandle=Element.build("i",this,["icon-tree-expand","resize-handle"]),s(this),t(this),R(this),B(this)};function s(a){g.instanceOf(a,HTMLElement),a.controller=new e(a.parentNode.controller)}function t(a){g.instanceOf(a,HTMLElement);var b=W(a);a.controller.moved.add(u,null,a),a.controller.resized.add(w,null,a),a.controller.layoutCreated.add(z,null,a),a.controller.editModeChanged.add(A,null,a),a.controller.zIndexUpdated.add(P,null,a),a.controller.init(b),Q(a),p(a,a.controller.layout()),r(a,a.controller.layout())}function u(a,b,c,d,e){g.instanceOf(a,HTMLElement),g.isNumber(c,"x"),g.isNumber(d,"y"),g.isNumber(e,"z"),a.style[h]=v(c,d),a.style.zIndex=e}function v(a,b){return g.isNumber(a,"x"),g.isNumber(b,"y"),"translate("+a+"px, "+b+"px)"}function w(a,b,c,d){g.instanceOf(a,HTMLElement),g.isNumber(c,"width"),g.isNumber(d,"height"),c-=x(a),d-=y(a),a.style.width=c+"px",a.style.height=d+"px",Element.raiseEvent(a,"element-resized",{width:c,height:d
})}function x(a){var b=c(a);return b.outerWidth(!0)-b.outerWidth()}function y(a){var b=c(a);return b.outerHeight(!0)-b.outerHeight()}function z(a,b){g.instanceOf(a,HTMLElement),p(a,a.controller.layout()),r(a,a.controller.layout())}function A(a,b,c){g.instanceOf(a,HTMLElement),g.isBoolean(c),c?(B(a),a.classList.add("editable")):(L(a),a.classList.remove("editable"))}function B(a){g.instanceOf(a,HTMLElement),a.controller.inEditMode&&(C(a),H(a))}function C(a){g.instanceOf(a,HTMLElement),b.defer(D.bind(null,a))}function D(a){var b=E(a);b.length?F(a,b):G(a,a)}function E(a){return a.querySelectorAll(".grid-layout-draggable")}function F(a,c){b.each(c,G.bind(null,a))}function G(a,b){b.interactable=f(b).draggable(!0).snap(I(a)).restrict(J(a)).preventDefault(!0).on("dragstart",a.drag_started).on("dragmove",a.drag_moved).on("dragend",a.drag_ended)}function H(a){
a.resizeHandle.interactable=f(a.resizeHandle).draggable(!0).snap(K(a)).restrict(J(a)).preventDefault(!0).on("dragstart",a.resize_started).on("dragmove",a.resize_moved).on("dragend",a.resize_ended)}function I(a){g.instanceOf(a,HTMLElement);var b=a.controller.blockSize();return{actions:["drag","resizex","resizey","resizexy","resize"],mode:"grid",range:1/0,grid:{x:b,y:b},gridOffset:{x:0,y:0}}}function J(a){return g.instanceOf(a,HTMLElement),{drag:a.parentNode,resize:a.parentNode}}function K(a){g.instanceOf(a,HTMLElement);var b=a.controller.blockSize();return{actions:["drag"],mode:"grid",range:1/0,grid:{x:b,y:b},gridOffset:{x:0,y:0}}}function L(a,b){g.instanceOf(a,HTMLElement),M(a,b),N(a,b,a),O(a,b)}function M(a,c){b.each(E(a),N.bind(null,a,c))}function N(a,b,c){c.interactable&&(c.interactable.draggable(!1).off("dragstart",a.drag_started).off("dragmove",a.drag_moved).off("dragend",a.drag_ended),b&&c.interactable.unset())}function O(a,b){
a.resizeHandle.interactable&&(a.resizeHandle.interactable=f(a.resizeHandle).draggable(!1).off("dragstart",a.resize_started).off("dragmove",a.resize_moved).off("dragend",a.resize_ended),b&&a.resizeHandle.interactable.unset())}function P(a,b){g.instanceOf(a,HTMLElement),p(a,a.controller.layout())}function Q(a){a.parentNode.controller.inEditMode&&a.controller.toggleEditMode()}function R(a){g.instanceOf(a,HTMLElement),a.parent_resized=S.bind(null,a),Y(a)}function S(a,b){if(g.instanceOf(a,HTMLElement),V(a),a.controller){var c=a.controller.layout(),d=W(a),e,f,h,i,j;d=T(c,d),e=d[c].x,f=d[c].y,h=d[c].z,i=d[c].width,j=d[c].height,a.controller.updateBlockPosition(e,f,h),a.controller.updateBlockSize(i,j),L(a),B(a)}Y(a)}function T(a,b){return"hd"!==a||U(b.hd)||(b.hd={x:b.desktop.x,y:b.desktop.y,z:b.desktop.z,width:b.desktop.width,height:b.desktop.height}),b}function U(a){return a.width&&a.height}function V(a){
a.parentNode&&a.parentNode.removeEventListener("collection-element-resized",a.parent_resized)}function W(a){g.instanceOf(a,HTMLElement);var b={};return b.phone=X(a,"phone"),b.smallTablet=X(a,"small-tablet"),b.tablet=X(a,"tablet"),b.desktop=X(a,"desktop"),b.hd=X(a,"hd"),b.minWidth=Element.intAttribute(a,"min-width"),b.minHeight=Element.intAttribute(a,"min-height"),b}function X(a,b){g.instanceOf(a,HTMLElement),g.isString(b);var c={};return c.x=Element.intAttribute(a,b+"-x",null),c.y=Element.intAttribute(a,b+"-y",null),c.z=Element.intAttribute(a,b+"-z",null),c.width=Element.intAttribute(a,b+"-width",null),c.height=Element.intAttribute(a,b+"-height",null),c}function Y(a){a.parentNode&&a.parentNode.addEventListener("collection-element-resized",a.parent_resized)}d.prototype.detachedCallback=function(){L(this,!0),V(this),this.controller.dispose(),this.resizeHandle&&this.removeChild(this.resizeHandle),this.parent_resized=null,this.interactable=null,this.controller=null},
d.prototype.getChangedAttributes=function(){return{layout:this.controller.layout(),x:this.controller.x_blocks(),y:this.controller.y_blocks(),z:this.controller.z(),width:this.controller.width_blocks(),height:this.controller.height_blocks()}},d.prototype.serialize=function(){var a=W(this);return delete a.minWidth,delete a.minHeight,a},d.prototype.setPositionAttributes=function(a,b,c,d){g.isString(a),g.isNumber(b,"x_blocks"),g.isNumber(c,"y_blocks"),g.isNumber(d,"z"),a=Z(a),this.setAttribute(a+"-x",b),this.setAttribute(a+"-y",c),this.setAttribute(a+"-z",d)};function Z(a){return g.isString(a),"smallTablet"===a?"small-tablet":a}return d.prototype.setSizeAttributes=function(a,b,c){g.isString(a),g.isNumber(b,"width_blocks"),g.isNumber(c,"height_blocks"),a=Z(a),this.setAttribute(a+"-width",b),this.setAttribute(a+"-height",c)},d.prototype.displayIndex=function(){return this.controller.displayIndex()},d.prototype.toggleEditMode=function(){this.controller&&this.controller.toggleEditMode()},
Element.registerElement("mi-grid-layout-item",{prototype:d.prototype}),d});
define('ui/elements/dashboard/widget-element',['require','spa/region','spa/conductor','system/globalization/translator','mi-assert'],function a(require){"use strict";var b=require("spa/region"),c=require("spa/conductor"),d=require("system/globalization/translator"),e=require("mi-assert"),f={};f.prototype=Object.create(HTMLElement.prototype),f.create=function a(b,c){e.instanceOf(b,HTMLElement),e.ok(c,"widget"),e.ok(c.uniqueID,"widget.uniqueID");var d=Element.build("mi-widget",b,null,{id:c.uniqueID(),caption:c.widgetCaption(),type:c.widgetType()});return d.value=c,d},f.prototype.createdCallback=function a(){this.attached=!1,this.conductor=Object.resolve(c),this.translator=Object.resolve(d),this._value=null,this.parent_resized=i.bind(null,this),this.parent_changed=j.bind(null,this),this.region=new b,this.nameSubscription=null,Element.defineProperty(this,"value",{get:g.bind(null,this),set:h.bind(null,this)})},f.prototype.attachedCallback=function a(){this.attached=!0,this._value&&k(this)},f.prototype.detachedCallback=function a(){A(this),C(this),this.attached=!1,this.conductor.changeScreen(null,this.region,{},{
isClosing:!1})},f.prototype.attributeChangedCallback=function a(b,c,d){Object.tryMethod(this,b+"Changed",c,d)};function g(a){return e.instanceOf(a,HTMLElement),a._value}function h(a,b){e.instanceOf(a,HTMLElement),a._value=b,a._value&&a.attached&&k(a)}function i(a,b){e.instanceOf(a,HTMLElement),e.isObject(b,"e"),b.detail&&b.detail.width&&b.detail.height&&(z(a),a.value.resize(b.detail.width,b.detail.height),y(a))}function j(a,b){e.instanceOf(a,HTMLElement),e.isObject(b,"e"),e.isObject(b.detail,"e.detail"),e.isString(b.detail.layout,"e.detail.layout"),x(a,b.detail.layout,b.detail)}function k(a){e.instanceOf(a,HTMLElement);var b,c,d;Element.clearDom(a),b=m(a),c=n(b,a.getAttribute("caption")),d=o(b),p(a,d),q(a,d),r(a,d),l(a),v(a),w(a),B(a,c)}function l(a){return e.instanceOf(a,HTMLElement),Element.build("div",a,["widget-overlay"])}function m(a){return e.instanceOf(a,HTMLElement),Element.build("header",a,["block-group"])}function n(a,b){return e.instanceOf(a,HTMLElement),e.isString(b),
Element.build("div",a,["block","name","grid-layout-draggable"],null,b)}function o(a){return e.instanceOf(a,HTMLElement),Element.build("div",a,["block","toolbar","dropdown"])}function p(a,b){var c;a.value.allowGoTo&&(c=Element.build("div",b,["goto-button"],{title:a.translator.translate("OPEN_IN_NEW_TAB")}),Element.build("i",c,["icon-open-in-new-window"]),c.addEventListener("click",a.value.goto.bind(a.value,a.parentElement)))}function q(a,b){var c;a.value.allowRefresh&&(c=Element.build("div",b,["refresh-button"],{title:a.translator.translate("REFRESH")}),Element.build("i",c,["icon-refresh"]),c.addEventListener("click",a.value.refresh.bind(a.value)))}function r(a,b){e.instanceOf(a,HTMLElement,"self"),e.instanceOf(b,HTMLElement,"parent"),s(a,b),t(a,b,a.value)}function s(a,b){e.instanceOf(b,HTMLElement);var c=Element.build("button",b,["btn","btn-default","btn-icon","dropdown-toggle","menu-button"],{"data-toggle":"dropdown",title:a.translator.translate("EDIT_OPTIONS")})
;return Element.build("i",c,["icon-options"]),c}function t(a,b,c){e.instanceOf(a,HTMLElement,"self"),e.instanceOf(b,HTMLElement,"parent"),e.ok(c);var d=Element.build("ul",b,["dropdown-menu","dropdown-menu-right"],{role:"menu"});u(d,a.translator.translate("EDIT"),c.edit.bind(c)),u(d,a.translator.translate("HIDE"),c.hide.bind(c)),u(d,a.translator.translate("REMOVE"),c.remove.bind(c))}function u(a,b,c){e.instanceOf(a,HTMLElement),e.isString(b),e.isFunction(c);var d=Element.build("li",a);Element.build("a",d,null,null,b).addEventListener("click",c)}function v(a){e.instanceOf(a,HTMLElement);var b=Element.build("section",a,["widget-body"]);a.region.setElement(b),a.conductor.changeScreen(a.value,a.region)}function w(a){e.instanceOf(a,HTMLElement);var b=a.parentElement,c=b.getChangedAttributes();y(a),b.addEventListener("change",a.parent_changed),x(a,c.layout,c)}function x(a,b,c){e.instanceOf(a,HTMLElement),e.isString(b),e.isObject(c);var d={x:c.x,y:c.y,z:c.z,width:c.width,height:c.height}
;a.value.notifyLayoutChanged(b,d)}function y(a){a.parentNode&&a.parentNode.addEventListener("element-resized",a.parent_resized)}function z(a){a.parentNode&&a.parentNode.removeEventListener("element-resized",a.parent_resized)}function A(a){e.instanceOf(a,HTMLElement),a.parentElement&&(z(a),a.parentElement.removeEventListener("change",a.parent_changed))}function B(a,b){e.instanceOf(a,HTMLElement,a),e.instanceOf(b,HTMLElement,b),a.value.getNameChanged().add(D,a,b)}function C(a){a.value.getNameChanged().remove(a)}function D(a,b,c){a.innerText=c}return Element.registerElement("mi-widget",{prototype:f.prototype}),f});

define('text!dashboard/views/widget-control-panel.html',[],function () { return '<div class="widget-control-panel">\r\n    <div class="block-group">\r\n        <div class="block">\r\n            <header data-bind="text: translator.translate(\'FILTER_QUERY\')"></header>\r\n            <div class="filter">\r\n                <div class="input-group">\r\n                    <input type="text" class="form-control disabled"\r\n                           data-bind="value: dashboardContainer.filter, event: {input: $root.changeFilterQuery}" style="height: 34px;">\r\n                    <span class="input-group-btn">\r\n                        <button class="btn btn-default" type="button"\r\n                                data-bind="click: selectFilterQuery,\r\n                                           attr: { title: translator.translate(\'CHOOSE_QUERY_TITLE\') }">...</button>\r\n                    </span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <br>\r\n\r\n    <header data-bind="text: translator.translate(\'ADD_NEW_WIDGET\')"></header>\r\n    <div class="block-group widget-types">\r\n        <div class="widget-number-warning" data-bind="text:widgetWarning"></div>\r\n        <div class="widget-icon-wrapper"></div>\r\n        <div class="widget-icon-container" data-bind="attr: { title: translator.translate(\'HYPERLINKS\') }">\r\n            <a class="block widget-type hyperlink" data-bind="click: addHyperlinksWidget">\r\n                <i class="dashboard-icon-hyperlink"></i>\r\n            </a>\r\n            <footer class="block" data-bind="text: translator.translate(\'HYPERLINKS\')"></footer>\r\n        </div>\r\n        <div class="widget-icon-container" data-bind="attr: { title: translator.translate(\'QUERY\') }">\r\n            <a class="block widget-type query"\r\n                data-bind="click: addQueryWidget, attr: { title: translator.translate(\'QUERY\') }">\r\n                <i class="dashboard-icon-query"></i>\r\n            </a>\r\n            <footer class="block" data-bind="text: translator.translate(\'QUERY\')"></footer>\r\n        </div>\r\n        <div class="widget-icon-container" data-bind="attr: { title: translator.translate(\'GRAPH\') }">\r\n            <a class="block widget-type chart"\r\n                data-bind="click: addChartWidget, attr: { title: translator.translate(\'GRAPH\') }">\r\n                <i class="dashboard-icon-chart2"></i>\r\n            </a>\r\n            <footer class="block" data-bind="text: translator.translate(\'GRAPH\')"></footer>\r\n        </div>\r\n        <div class="widget-icon-container" data-bind="attr: { title: translator.translate(\'KPI\') }">\r\n            <a class="block widget-type kpi"\r\n                data-bind="click: addKpiWidget, attr: { title: translator.translate(\'KPI\') }">\r\n                <i class="dashboard-icon-kpi"></i>\r\n            </a>\r\n            <footer class="block" data-bind="text: translator.translate(\'KPI\')"></footer>\r\n        </div>\r\n        <div class="widget-icon-container" data-bind="attr: { title: translator.translate(\'IMAGE\') }">\r\n            <a class="block widget-type hyperlink"\r\n                data-bind="click: addImageWidget, attr: { title: translator.translate(\'IMAGE\') }">\r\n                <i class="dashboard-icon-image"></i>\r\n            </a>\r\n            <footer class="block" data-bind="text: translator.translate(\'IMAGE\')"></footer>\r\n        </div>\r\n        <div class="widget-icon-container" data-bind="attr: { title: translator.translate(\'CALENDAR\') }">\r\n            <a class="block widget-type calendar"\r\n               data-bind="click: addCalendarWidget, attr: { title: translator.translate(\'CALENDAR\') }">\r\n                <i class="icon-Scheduling"></i>\r\n            </a>\r\n            <footer class="block" data-bind="text: translator.translate(\'CALENDAR\')"></footer>\r\n        </div>\r\n    </div>\r\n    <br>\r\n\r\n    <header data-bind="text: translator.translate(\'SHOW_HIDDEN_WIDGET\')"></header>\r\n    <!-- ko if: hiddenWidgets().length -->\r\n    <div class="hidden-widgets" data-bind="foreach: hiddenWidgets">\r\n        <div class="hidden-widgets-wrapper"></div>\r\n        <a class="hidden-widget"\r\n            data-bind="click: $parent.showWidget.bind($parent),\r\n                    attr: { title: translator.translate(\'SHOW_HIDDEN_WIDGET\') }">\r\n            <i data-bind="css: icon()"></i>\r\n            <span data-bind="text: widget.caption"></span>\r\n        </a>\r\n    </div>\r\n    <div style="clear: both"></div>\r\n    <!-- /ko -->\r\n    <!-- ko if: hiddenWidgets().length == 0 -->\r\n    <div class="block-group hidden-widgets" data-bind="text: translator.translate(\'NO_HIDDEN_WIDGETS\')"></div>\r\n    <!-- /ko -->\r\n</div>';});

define('dashboard/view-models/widget-control-panel',['require','exports','module','spa/ko/managed-view-model','./widget-view-model-factory','dashboard/services/dashboard-service','system/lang/event','catalog/catalog-dialog','mi-assert','system/globalization/translator','logging/error-notification-handler','system/diagnostics/log-manager','text!../views/widget-control-panel.html'],function(require,exports,module){"use strict";var a=require("spa/ko/managed-view-model"),b=require("./widget-view-model-factory"),c=require("dashboard/services/dashboard-service"),d=require("system/lang/event"),e=require("catalog/catalog-dialog"),f=require("mi-assert"),g=require("system/globalization/translator"),h=require("logging/error-notification-handler"),i=require("system/diagnostics/log-manager"),j=i.getLogger(module.id),k=require("text!../views/widget-control-panel.html");function l(){m.call(this,k),this.dashboardContainer=null,this.title=this.kom.observable("Widget Control Panel"),this.dashboardService=Object.resolve(c),this.hiddenWidgets=this.kom.observableArray(),this.widgetAdded=Object.resolve(d),this.widgetUnhidden=Object.resolve(d),this.translator=Object.resolve(g),this.numberOfWidgets=this.kom.observable(0),this.region=null,this.widgetWarning=this.kom.observable(),this.MAX_WIDGETS=12,this.WARNING_WIDGETS=8,this.errorNotificationHandler=Object.resolve(h)}
var m=Object.inherit(a,l);l.prototype.load=function(a){try{f.ok(a),this.dashboardContainer=a,this.dashboardContainer.widgetHidden.add(p,null,this),q(this)}catch(a){y(this,a)}},l.prototype.afterAttach=function(a){try{this.region=a,r(this)}catch(a){y(this,a)}},l.prototype.addHyperlinksWidget=function a(){try{var c=b.createNew(this.dashboardContainer,"Hyperlinks",this.translator.translate("HYPERLINKS_WIDGET"));this.widgetAdded.raise(this,c),r(this)}catch(a){y(this,a)}},l.prototype.addQueryWidget=function a(){try{var c=b.createNew(this.dashboardContainer,"Query",this.translator.translate("QUERY_WIDGET"));this.widgetAdded.raise(this,c),r(this)}catch(a){y(this,a)}},l.prototype.addChartWidget=function a(){try{var c=b.createNew(this.dashboardContainer,"Chart",this.translator.translate("CHART_WIDGET"));this.widgetAdded.raise(this,c),r(this)}catch(a){y(this,a)}},l.prototype.addKpiWidget=function a(){try{var c=b.createNew(this.dashboardContainer,"KPI",this.translator.translate("KPI_WIDGET"))
;this.widgetAdded.raise(this,c),r(this)}catch(a){y(this,a)}},l.prototype.addImageWidget=function(){try{var a=b.createNew(this.dashboardContainer,"Image",this.translator.translate("IMAGE"));this.widgetAdded.raise(this,a),r(this)}catch(a){y(this,a)}},l.prototype.addCalendarWidget=function(){try{var a=b.createNew(this.dashboardContainer,"Calendar",this.translator.translate("CALENDAR"));this.widgetAdded.raise(this,a),r(this)}catch(a){y(this,a)}},l.prototype.showWidget=function a(b){try{this.numberOfWidgets()<this.MAX_WIDGETS&&(this.widgetUnhidden.raise(this,b),q(this),r(this))}catch(a){y(this,a)}},l.prototype.beforeUnload=function(){try{this.dashboardContainer.widgetHidden.remove(this),this.widgetAdded.remove(),this.widgetUnhidden.remove()}catch(a){y(this,a)}},l.prototype.changeFilterQuery=function(a,b){a.dashboardContainer.filter(b.target.value)},l.prototype.selectFilterQuery=function(){var a=Object.resolve(e);try{a.show({path:this.dashboardContainer.filter(),itemTypes:["Query"]
}).done(n.bind(null,this)).fail(o.bind(null,this))}catch(a){y(this,a)}},l.prototype.updateNumberOfWidgets=function(){try{r(this)}catch(a){y(this,a)}};function n(a,b){a.dashboardContainer.filter(b.path)}function o(){console.log("Error retrieving catalog item")}function p(a){q(a)}function q(a){a.hiddenWidgets(a.dashboardContainer.hiddenContent())}function r(a){a.numberOfWidgets(a.dashboardContainer.visibleContent().length);var b=a.numberOfWidgets()>=a.WARNING_WIDGETS&&a.numberOfWidgets()<=a.MAX_WIDGETS-1,c=a.numberOfWidgets()>=a.MAX_WIDGETS,d=a.numberOfWidgets()<a.WARNING_WIDGETS;b?s(a):c?t(a):d&&u(a)}function s(a){var b=a.region.element.querySelector(".widget-number-warning");a.widgetWarning(a.translator.translate("WIDGET_LIMIT_WARNING").format(a.WARNING_WIDGETS)),b.style.display="block",b.style.color="orange",w(a)}function t(a){var b=a.region.element.querySelector(".widget-number-warning");a.widgetWarning(a.translator.translate("WIDGET_LIMIT_ALERT").format(a.MAX_WIDGETS)),
b.style.display="block",b.style.color="red",v(a)}function u(a){a.region.element.querySelector(".widget-number-warning").style.display="none"}function v(a){a.region.element.querySelector(".widget-icon-wrapper").classList.add("blocking-opacity"),a.region.$element.find(".widget-icon-container").css("padding-top","10px"),x(a)}function w(a){a.region.element.querySelector(".widget-icon-wrapper").classList.remove("blocking-opacity"),a.region.$element.find(".widget-icon-container").css("padding-top","5px");var b=document.querySelectorAll(".hidden-widget"),c;for(c=0;c<b.length;c+=1)b[c].classList.remove("blocking-opacity-hidden-widgets")}function x(a){if(a.dashboardContainer.hiddenContent().length){var b=document.querySelectorAll(".hidden-widget"),c;for(c=0;c<b.length;c+=1)b[c].classList.add("blocking-opacity-hidden-widgets")}}function y(a,b){j.error(b.stack),a.errorNotificationHandler.addError({errorMessage:b.message,errorDetail:b.stack})}return l});
define('ui/elements/dashboard/widget-control-panel-component',['require','dashboard/view-models/widget-control-panel','spa/conductor','spa/region','mi-assert','system/lang/property'],function(require){"use strict";var a=require("dashboard/view-models/widget-control-panel"),b=require("spa/conductor"),c=require("spa/region"),d=require("mi-assert"),e=require("system/lang/property");function f(){e.readOnly(this,"viewModel",Object.resolve(a)),e.readOnly(this,"conductor",Object.resolve(b)),e.readOnly(this,"region",Object.resolve(c)),e.readOnly(this,"widgetAdded",this.viewModel.widgetAdded),e.readOnly(this,"widgetUnhidden",this.viewModel.widgetUnhidden)}return f.prototype.bindToElement=function a(b){d.instanceOf(b,HTMLElement),this.region.setElement(b)},f.prototype.init=function a(b){d.ok(b),this.conductor.changeScreen(this.viewModel,this.region,{positional:[b]})},f.prototype.dispose=function a(){this.conductor.clearScreen(this.region)},f.prototype.addHyperlinksWidget=function a(){},f});
define('ui/elements/dashboard/dashboard-element',['require','exports','module','lodash','jquery','./dashboard-controller','system/knockout/bindings/halt-bindings','ui/elements/grid-layout/grid-layout-element','ui/elements/grid-layout/grid-layout-collection-element','ui/elements/grid-layout/grid-layout-item-element','./widget-element','./widget-control-panel-component','logging/error-notification-handler','system/diagnostics/log-manager','system/globalization/translator','mi-assert'],function a(require,exports,module){"use strict";var b=require("lodash"),c=require("jquery"),d=require("./dashboard-controller"),e=require("system/knockout/bindings/halt-bindings"),f=require("ui/elements/grid-layout/grid-layout-element"),g=require("ui/elements/grid-layout/grid-layout-collection-element"),h=require("ui/elements/grid-layout/grid-layout-item-element"),i=require("./widget-element"),j=require("./widget-control-panel-component"),k=require("logging/error-notification-handler"),l=require("system/diagnostics/log-manager"),m=l.getLogger(module.id),n=require("system/globalization/translator"),o=require("mi-assert"),p={prototype:{}},q={},r={};p.prototype.createdCallback=function a(){this.private={controller:Object.resolve(d),widgetControlPanel:Object.resolve(j),key:null,_path:null,gridLayoutCollection:null,controlPanel:null},this.translator=Object.resolve(n),this.errorNotificationHandler=Object.resolve(k)},p.prototype.attachedCallback=function a(){try{s(this)}catch(a){
ta(this,a)}};function s(a){t(a),fa(a),ia(a,a.getAttribute("key")),ja(a,a.getAttribute("path"))}function t(a){sa(a);var b=u(a);b.dashboardChanged.add(v.bind(null,a),a),b.editModeChanged.add(Y.bind(null,a),a),b.widgetAdded.add(Z.bind(null,a),a),b.widgetRemoved.add(aa.bind(null,a),a),b.widgetHidden.add(da.bind(null,a),a),b.widgetUnhidden.add(ea.bind(null,a),a)}function u(a){return sa(a),a.private.controller}function v(a,c,d){sa(a),o.ok(d);var f;Element.clearDom(a),f=e.createElement(a),y(a,f),L(a,f),b.defer(function(){w(a),Element.raiseEvent(a,"dashboard-changed",{dashboard:d})})}function w(a){var b=x(a),c=!R(a).readOnly(),d=0===Q(a).length,e=!u(a).inEditMode;b&&c&&d&&e&&u(a).toggleEditMode()}function x(a){return"MI-DASHBOARD-EDITOR"===a.tagName}function y(a,b){sa(a),A(a)&&(C(a,Element.build("div",b,["dashboard-control-panel","page-filter-tools"])),D(a),z(a))}function z(a){H(a)&&(J(a),I(a))}function A(a){return null!==a.getAttribute("toolbar")}function B(a){
return null!==a.getAttribute("hide-home")}function C(a,b){sa(a),o.instanceOf(b,HTMLElement),a.private.controlPanel=b}function D(a){var b=Element.build("button",F(a),["btn","btn-icon","edit"]),d=Element.build("mi-more-options-noko",F(a),["more-options","pull-right"]);b.addEventListener("click",G.bind(null,a)),d.moreoptionsCB(E.bind(null,a)),d.loader=function(){var b=c.Deferred(),d={id:"export-pdf",text:a.translateText("EXPORT_TO_PDF"),icon:"icon-export"},e={id:"set-home-page",text:a.translateText("SET_AS_HOME_PAGE"),icon:"icon-dashboard"},f=[d,e];return B(a)&&(f=[d],u(a).inEditMode&&(f=[])),u(a).inEditMode&&!B(a)&&(f=[e]),b.resolve(f),b.promise()}}function E(a,b){b&&b.id&&("set-home-page"===b.id&&G(a),"export-pdf"===b.id&&window.print())}function F(a){return sa(a),a.private.controlPanel}function G(a){u(a).setHomePage()}function H(a){return!u(a).dashboard.readOnly()}function I(a){Element.build("div",F(a),["divider"],{},"Â ")}function J(a){
var b=Element.build("button",F(a),["btn","btn-icon","edit"]);b.addEventListener("click",K.bind(null,a)),Element.build("span",b,["icon-edit","edit-dashboard-icon"],{title:a.translateText("EDIT_MODE")}),Element.build("span",b,["edit-mode-text"],{title:a.translateText("EDIT_MODE")},a.translateText("EDIT_MODE"))}function K(a){sa(a),u(a).toggleEditMode()}function L(a,b){var c=M(a,b),d=f.create(c);Element.upgrade(d),N(a,g.create(d,4,8,12,24,24)),Element.upgrade(O(a)),P(a),V(a,d),R(a).screenAttached()}function M(a,b){return sa(a),Element.build("div",b,["dashboard-content"])}function N(a,b){sa(a),o.instanceOf(b,HTMLElement),a.private.gridLayoutCollection=b}function O(a){return sa(a),a.private.gridLayoutCollection}function P(a){sa(a),Q(a).forEach(S.bind(null,a))}function Q(a){return sa(a),R(a).visibleContent()}function R(a){return sa(a),u(a).getCurrentDashboard()}function S(a,b){sa(a),o.ok(b);var c,d=T(a,b);return c=i.create(d,b),Element.upgrade(c),d}function T(a,b){sa(a),o.ok(b)
;var c=O(a),d=U(a)[b.uniqueID()]||{},e=h.create(c,b.minWidth,b.minHeight,d);return Element.upgrade(e),e}function U(a){return sa(a),R(a).layout()}function V(a,b){sa(a),o.instanceOf(b,HTMLElement,"parent");var c=Element.build("div",b,["widget-control-panel-container"]);W(a).bindToElement(c),W(a).init(R(a))}function W(a){return sa(a),a.private.widgetControlPanel}function X(a){return sa(a),R(a).content()}function Y(a,b,c){if(sa(a),o.isBoolean(c),F(a)){var d=F(a).querySelector("button.edit"),e=F(a).querySelector("span.edit-dashboard-icon");c?(a.classList.add("in-edit-mode"),d.classList.add("active")):(a.classList.remove("in-edit-mode"),d.classList.remove("active")),O(a).toggleEditMode(),Element.raiseEvent(a,"edit-mode-changed",{dashboard:u(a).getCurrentDashboard(),inEditMode:c})}}function Z(a,c,d){sa(a),o.ok(d);var e=S(a,d);b.defer($.bind(null,a,e,d))}function $(a,b,c){sa(a),o.ok(b,"element"),o.ok(c,"widget"),c.edit().done(_.bind(null,a,c))}function _(a,b,c){sa(a),o.ok(b),
c&&u(a).removeWidgetWithoutPrompt(b)}function aa(a,b,c){sa(a),o.instanceOf(b,d),o.ok(c),ba(a,c)}function ba(a,b){sa(a),o.ok(b);var c,d,e=ca(a,b);e&&(c=e.parentNode,d=c.parentNode,d.removeChild(c),W(a).__private__.viewModel.updateNumberOfWidgets())}function ca(a,c){var d=a.querySelectorAll("mi-widget");return b.find(d,function(a){return a.value===c})}function da(a,b,c){sa(a),o.instanceOf(b,d),o.ok(c),ba(a,c)}function ea(a,b,c){sa(a),o.ok(c),S(a,c)}function fa(a){var b=W(a);sa(a),b.widgetAdded.add(ga.bind(null,a)),b.widgetUnhidden.add(ha.bind(null,a))}function ga(a,b,c){sa(a),o.ok(c),u(a).addWidget(c)}function ha(a,b,c){sa(a),o.ok(c),u(a).showWidget(c)}function ia(a,c){sa(a),o.assert(b.isString(c)||null===c),a.private.key=c}function ja(a,c){sa(a),o.assert(b.isString(c)||null===c),a.private._path=c}p.prototype.detachedCallback=function a(){try{ka(this)}catch(a){ta(this,a)}};function ka(a){la(a),ma(a),W(a).dispose()}function la(a){sa(a);var b=u(a);b.dashboardChanged.remove(a),
b.editModeChanged.remove(a),b.widgetAdded.remove(a),b.widgetRemoved.remove(a),b.widgetHidden.remove(a),b.widgetUnhidden.remove(a)}function ma(a){sa(a),W(a).widgetAdded.remove(a)}p.prototype.attributeChangedCallback=function a(b,c,d){try{Object.tryMethod(this,b+"Changed",c,d)}catch(a){ta(this,a)}},p.prototype.keyChanged=function a(b,c){try{na(this,b,c)}catch(a){ta(this,a)}};function na(a,b,c){ia(a,c),ja(a,null)}p.prototype.pathChanged=function a(b,c){try{oa(this,b,c)}catch(a){ta(this,a)}};function oa(a,b,c){ia(a,null),ja(a,c)}p.prototype.refreshAll=function(){if(this.private.controller.dashboard)for(var a=this.private.controller.dashboard.content(),b=0;b<a.length;b++)pa(a[b])||a[b].refresh()};function pa(a){var b=a.widget.dashboard().layout()[a.uniqueID()];return!!b&&b.hidden}p.prototype.redrawAll=function(){if(this.private.controller.dashboard)for(var a=this.private.controller.dashboard.content(),b=0;b<a.length;b++)pa(a[b])||a[b].redraw()},p.prototype.loadState=function a(b){try{
u(this).loadState(b,qa(this),ra(this))}catch(a){ta(this,a)}};function qa(a){return sa(a),a.private.key}function ra(a){return sa(a),a.private._path}p.prototype.saveState=function a(){try{return u(this).saveState()}catch(a){ta(this,a)}},p.prototype.translateText=function a(b){try{return this.translator.translate(b)}catch(a){ta(this,a)}};function sa(a){o.instanceOf(a,HTMLElement,"self"),o.instanceOf(a.private.controller,d,"self.private.controller")}function ta(a,b){m.error(b.stack),a.errorNotificationHandler.addError({errorMessage:b.message,errorDetail:b.stack})}function ua(){var a=Object.create(HTMLElement.prototype);return b.extend(a,p.prototype)}return q.prototype=ua(),r.prototype=ua(),Element.registerElement("mi-dashboard",{prototype:q.prototype}),Element.registerElement("mi-dashboard-editor",{prototype:r.prototype}),q});
define('home/home-view-model',['require','exports','module','knockout','application/application-events','application/application-context','spa/ko/managed-view-model','dashboard/services/dashboard-service','logging/error-notification-handler','system/diagnostics/log-manager','dashboard/print/dashboard-print','text!./views/home.html','ui/elements/page-filter/page-filter-element','ui/elements/dashboard/dashboard-element'],function(require,exports,module){"use strict";var a=require("knockout"),b=require("application/application-events"),c=require("application/application-context"),d=require("spa/ko/managed-view-model"),e=require("dashboard/services/dashboard-service"),f=require("logging/error-notification-handler"),g=require("system/diagnostics/log-manager"),h=g.getLogger(module.id),i=require("dashboard/print/dashboard-print"),j=require("text!./views/home.html");require("ui/elements/page-filter/page-filter-element"),require("ui/elements/dashboard/dashboard-element");function k(a){l.call(this,j),this.titleChanged=a.titleChanged,this.errorNotificationHandler=Object.resolve(f),this.dashboardService=Object.resolve(e),this.pageFilterElement=null,this.pageFilterState=null,this.dashboardElement=null,this.dashboardState=null,this.dashboardPrint=Object.resolve(i),this.path=this.kom.observable()}k.dependsOn=[b];var l=Object.inherit(d,k);k.prototype.activate=function a(){c.help.helpContext=""},
k.prototype.open=function a(){this.titleChanged.raise("Dashboard",this)},k.prototype.afterAttach=function a(b){try{this.dashboardService.getHomePage().done(m.bind(null,this,b)).fail(n.bind(null,this))}catch(a){this.reportError(a)}},k.prototype.beforeDetach=function a(){try{this.pageFilterElement&&(this.pageFilterState=this.pageFilterElement.saveState(),this.pageFilterElement=null),this.dashboardElement&&(this.dashboardState=this.dashboardElement.saveState(),this.dashboardElement=null),this.dashboardPrint.removePrintSupport()}catch(a){this.reportError(a)}},k.prototype.dashboardChanged=function a(b,c){try{c=c.originalEvent?c.originalEvent:c;var d=c.detail.dashboard;this.pageFilterElement.setAttribute("filter-id","dashboard/"+d.key),this.pageFilterElement.setAttribute("caption",d.name()),d.filter()?(this.pageFilterElement.setAttribute("filter",d.filter()),this.pageFilterElement.reload()):this.pageFilterElement.loadWithoutFilter()}catch(a){this.reportError(a)}},
k.prototype.reportError=function a(b,c){l.prototype.reportError.call(this,b,h,c)};function m(a,b,c){try{a.dashboardState=null,a.path(c),a.pageFilterElement=o(b,"mi-page-filter",a.pageFilterState),a.dashboardElement=o(b,"mi-dashboard",a.dashboardState),a.dashboardPrint.addPrintSupport()}catch(b){a.reportError(b,h)}}function n(a,b,c){var d=b.url+" "+c.statusText,e=c.status,f=new Error(d+" ("+e+")");a.reportError(f,h,e)}function o(a,b,c){var d=a.element.querySelector(b);return Element.upgrade(d,a.element),d.loadState(c),d}return k});
