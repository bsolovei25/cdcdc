/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function(require,exports,module){"use strict";var a=require("mi-assert"),b=require("./i-task"),c=require("application/application-events"),d=require("application/application-context"),e=require("application/application-service"),f=require("ramda"),g=require("text!config/startup-tasks.json"),h=require("application/tasks/task-config-file"),i=require("application/tasks/scheduled-task-manager"),j=1e3;function k(){this.appEvents=Object.resolve(c),this.service=Object.resolve(e),a.implementsInterface(this,b,module.id),this.initialized=!1,this.configFile=Object.resolve(h,g),this.scheduledTaskManager=Object.resolve(i)}k.prototype.execute=function(){this.initialize(),l()&&q(this)};function l(){return(m()-n())/j>30}function m(){return new Date}function n(){return d.connectionStatus.lastResponse}k.prototype.initialize=function a(){this.initialized||(p(this,null,d.connectionStatus),this.appEvents.connectionChanged.add(p.bind(null,this)),this.appEvents.sessionChanged.add(o.bind(null,this)),
this.initialized=!0)};function o(a,b,c){c.isActive===!0&&d.connectionStatus.connected===!0?t(a):c.isActive===!1&&v(a)}function p(a,b,c){c.connected===!0&&d.sessionStatus.isActive===!0?t(a):c.connected===!1&&v(a)}function q(a){a.service.unauthorizedping()}var r=f.propEq("onlineOnly",!0);function s(a){return f.filter(r,a.configFile.getScheduledTasks())}function t(a){var b=s(a);f.forEach(u(a),b)}var u=f.curry(function a(b,c){b.scheduledTaskManager.enableTask(c.id)});function v(a){var b=s(a);f.forEach(w(a),b)}var w=f.curry(function a(b,c){b.scheduledTaskManager.disableTask(c.id)});return k});