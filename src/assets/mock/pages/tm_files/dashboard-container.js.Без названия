/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function(require){"use strict";var a=require("lodash"),b=require("system/knockout/knockout-manager"),c=require("../view-models/i-widget-view-model"),d=require("./widget-layout"),e=require("system/lang/event"),f=require("mi-assert");function g(){this.kom=Object.resolve(b),this.saveRequested=Object.resolve(e),this.widgetRemoved=Object.resolve(e),this.widgetHidden=Object.resolve(e),this.key="0",this.content=this.kom.observableArray(),this.layout=this.kom.observable(),this.version=this.kom.observable(0),this.readOnly=this.kom.observable(!1),this.path=this.kom.observable(""),this.upgraded=this.kom.observable(!1),this.filter=this.kom.observable(""),this.caption=this.kom.observable("")}g.prototype.screenAttached=function a(){h(this)};function h(a){for(var b=0;b<a.content().length;b++)i(a,a.content()[b])}function i(a,b){j(b)||l(a,b)}function j(a){return 0!==a.getLayoutChanged().bindings.length}g.prototype.screenDetached=function a(){B(this),this.kom.disposeSubscriptions(),
this.kom.disposeComputeds()},g.prototype.addWidget=function a(b){k(this,b),l(this,b)};function k(a,b){B(a),G(b),a.content.push(b)}function l(a,b){G(b),b.getSaveRequested().add(m,a,a),b.getLayoutChanged().add(o,a,a),b.getRemoveRequested().add(p,a,a),b.getHideRequested().add(s,a,a)}function m(a){n(a)}function n(a){B(a),a.saveRequested.raise(a)}function o(a,b,c){G(b),new d(a,b).updateType(c.layoutType,c.attributes)}function p(a,b){B(a),G(b),new d(a,b).removeFromDashboardLayout(),q(a,b),r(a,b),b.dispose()}function q(a,b){a.content.remove(b)}function r(a,b){B(a),G(b),a.widgetRemoved.raise(a,b)}function s(a,b){t(a,b)}function t(a,b){B(a),new d(a,b).hide(),u(a,b)}function u(a,b){B(a),G(b),a.widgetHidden.raise(a,b)}g.prototype.showWidget=function a(b){v(this,b)};function v(a,b){new d(a,b).clear()}g.prototype.dispose=function a(){B(this),this.content().forEach(w.bind(null,this)),this.kom.dispose(),this.saveRequested.remove()};function w(a,b){G(b),x(a,b),b.unload()}function x(a,b){B(a),G(b),
b.getSaveRequested().remove(a),b.getLayoutChanged().remove(a),b.getRemoveRequested().remove(a),b.getHideRequested().remove(a)}g.prototype.visibleContent=function b(){return B(this),a.filter(this.content(),y.bind(null,this))};function y(a,b){return!z(a,b)}function z(a,b){var c=A(a,b);return!!c&&c.hidden}function A(a,b){return B(a),G(b),a.layout()[b.uniqueID()]}g.prototype.hiddenContent=function b(){return B(this),a.filter(this.content(),z.bind(null,this))},g.prototype.removeWidgetWithoutPrompt=function a(b){p(this,b)},g.prototype.name=function b(){return B(this),this.caption()?this.caption():this.path()?a.last(this.path().split("\\")):""};function B(a){f.enabled&&(C(a),D(a),E(a),F(a))}function C(a){f.instanceOf(a,g,"this"),f.instanceOf(a.kom,b,"this.kom")}function D(a){f.instanceOf(a.saveRequested,e,"this.saveRequested"),f.instanceOf(a.widgetRemoved,e,"this.widgetRemoved"),f.instanceOf(a.widgetHidden,e,"this.widgetHidden")}function E(a){f.isFunction(a.content,"this.content"),
f.isFunction(a.layout,"this.layout"),f.isFunction(a.version,"this.version"),f.isFunction(a.readOnly,"this.readOnly"),f.isFunction(a.path,"this.path"),f.isFunction(a.upgraded,"this.upgraded"),f.isFunction(a.filter,"this.filter")}function F(a){f.isString(a.key,"this.key"),f.isArray(a.content(),"this.content()"),f.isObject(a.layout(),"this.layout()"),f.isNumber(a.version(),"this.version()"),f.isBoolean(a.readOnly(),"this.readOnly()"),f.isString(a.path(),"this.path()"),f.isBoolean(a.upgraded(),"this.upgraded()"),f.isString(a.filter(),"this.filter()")}function G(a){f.enabled&&f.implementsInterface(a,c,"widget")}return g});