/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("jquery"),d=require("knockout"),e=require("system/lang/converter"),f=require("system/knockout/knockout-manager");require("system/knockout/bindings/halt-bindings"),require("system/knockout/bindings/property"),Element.registeredElements={};function g(){var a=Array.prototype.slice.call(arguments,0),b=a[0];Element.registeredElements[b]?console.warn("Attemted to register element "+b+" after it was already registered"):(document.registerElement.apply(document,a),Element.registeredElements[b]=!0)}function h(a,b){var c=Object.create(HTMLElement.prototype);c.createdCallback=function(){this.implementation=Object.resolve(b),this.implementation.element=this,Object.tryMethod(this.implementation,"created")},c.attachedCallback=function(){Object.tryMethod(this.implementation,"attached")},c.detachedCallback=function(){Object.tryMethod(this.implementation,"detached")},c.attributeChangedCallback=function(a,b,c){
Object.tryMethod(this.implementation,a+"Changed",b,c)},document.registerElement(a,{prototype:c})}var i=function(){function a(a,b,c){this.kom=Object.resolve(f),this.properties=[],this.view=a,this.preserveContext=b||!1,this.appendAfterBindings=c||!1,this.container=null,this.element=null}a.prototype.created=function(){Object.tryMethod(this,"beforeCreated"),c(this),Object.tryMethod(this,"afterCreated")},a.prototype.attached=function(){Object.tryMethod(this,"beforeAttached"),e(this),Object.tryMethod(this,"afterAttached")},a.prototype.detached=function(){Object.tryMethod(this,"beforeDetached"),g(this),Object.tryMethod(this,"afterDetached")},a.prototype.bindAttribute=function(a,c,d){this[a]=this.kom.observable(),this[a+"Changed"]=function(b,c){this[a](c)}.bind(this),this.kom.subscribe(this[a],function(c){b(this.element).trigger("attributes."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),this[a](Object.defaultValue(this.element.getAttribute(a),c))},
a.prototype.bindProperty=function(a,c,d,e){this[a]=this.kom.observable();var f=e||!1;Object.defineProperty(this.element,a,{get:function(){return this[a]()}.bind(this),set:function(b){this[a](b)}.bind(this)}),this.properties.push(a),this.kom.subscribe(this[a],function(c){f||b(this.element).trigger("properties."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),this[a](Object.defaultValue(this.element[a],c))},a.prototype.bindArrayProperty=function(a,c,d,e){this[a]=this.kom.observableArray();var f=e||!1;Object.defineProperty(this.element,a,{get:function(){return this[a]()}.bind(this),set:function(b){this[a](b)}.bind(this)}),this.properties.push(a),this.kom.subscribe(this[a],function(c){f||b(this.element).trigger("properties."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),this[a](Object.defaultValue(this.element[a],c))};function c(a){var c=document.createElement("div"),d=b(c),e=b(a.view);a.preserveContext||d.attr("data-bind","halt-bindings"),d.append(e),
a.appendAfterBindings||b(a.element).empty().append(d),a.container=c}function e(a){d.applyBindingsToDescendants(a,a.container),a.appendAfterBindings&&b(a.element).empty().append(a.container)}function g(a){d.cleanNode(a.container),b(a.container).remove(),a.kom.dispose(),a.properties.forEach(h.bind(null,a))}function h(a,b){delete a[b]}return a}();function j(b,d){window.CustomElements&&(window.CustomElements.useNative||(a.isArray(b)?k(b,d):a.isString(b)?l(b,d):b instanceof c?m(b):n(b)))}function k(a,b){for(var c=0;c!==a.length;c++)j(a[c],b)}function l(a,c){c&&c.$element&&(c=c.$element),m(b(a,c))}function m(a){a.each(function(a,b){n(b)})}function n(a){window.CustomElements.upgrade(a)}function o(b,c,d,e,f){var g,h=document.createElement(b);if(d)for(g=0;g!==d.length;g++)h.classList.add(d[g]);return e&&a.each(e,function(a,b){e.hasOwnProperty(b)&&h.setAttribute(b,a)}),f&&(h.textContent=f),c&&c.appendChild(h),h}function p(a,b){return null!==a.getAttribute(b)}function q(a,b,c){
var d=a.getAttribute(b);return d?e.toInteger(d):c}function r(a,b,c){var d=a.getAttribute(b);return d?e.toString(d):c}function s(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function t(a,b,c){var d=a[b];Object.defineProperty(a,b,c),a[b]=d}function u(a,b,c){a.dispatchEvent(new CustomEvent(b,{detail:c}))}function v(a){a.parentNode&&a.parentNode.removeChild(a)}var w={registerElement:g,register:h,ViewModel:i,upgrade:j,build:o,booleanAttribute:p,intAttribute:q,stringAttribute:r,clearDom:s,defineProperty:t,raiseEvent:u,detach:v};return b.extend(Element,w),w});