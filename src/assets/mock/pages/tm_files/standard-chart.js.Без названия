/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function(require){"use strict";var a=require("ui/elements/chart/chart-utilities"),b=require("ui/elements/chart/models/base-chart"),c=require("system/text/parser"),d=require("ramda");function e(a,b,c){f.call(this,a,b,c)}var f=Object.inherit(b,e);e.prototype.configureOptions=function(){this.options.chart.polar=this.config.polar,this.options.chart.options3d=t(this.config),this.options.legend=s(this.options.legend,this.chartUtil,this.config),this.options.plotOptions.column=k(),this.options.plotOptions.bar=k(),this.options.plotOptions.scatter=l(this.config),this.options.plotOptions.bubble=j(this.config),this.options.plotOptions.pie=i(this.config),this.options.plotOptions.pyramid=h(this.config),this.options.xAxis.categories=q(this.categoryArray),this.options.xAxis.labels.formatter=d.partial(r,[this.config]),this.options.plotOptions.series=g(this.config,this.chartUtil,this.options.plotOptions.series)};function g(a,b,c){return B(a,b)?(c.dataLabels.useHTML=!0,c.dataLabels.distance=10,
c):c}function h(a){var b={allowPointSelect:!0,depth:35,width:"50%",tooltip:{pointFormat:a.pointFormat||"{point.y:g2}"},dataLabels:{pointFormat:a.dataLabelFormat||"{point.y:g2}",connectorWidth:.3}};return a.truncateLabels&&(b.dataLabels.style={width:"100px"}),b}function i(a){var b={allowPointSelect:!0,depth:35,tooltip:{pointFormat:a.pointFormat||"{point.y:g2}"},dataLabels:{pointFormat:a.dataLabelFormat||"{point.name}: {point.y:g2}"}};return a.truncateLabels&&(b.dataLabels.style={width:"100px"}),b}function j(a){return{tooltip:{pointFormat:a.pointFormat||"({point.x:g2}, {point.y:g2}), size: {point.z:g2}"},dataLabels:{pointFormat:a.dataLabelFormat||"({point.x:g2}, {point.y:g2}), size: {point.z:g2}"}}}function k(){return{borderWidth:0,shadow:{opacity:.2,color:"#555555"}}}function l(a){return{tooltip:{pointFormat:a.pointFormat||"({point.x:g2}, {point.y:g2})"},dataLabels:{pointFormat:a.dataLabelFormat||"({point.x:g2}, {point.y:g2})"}}}e.prototype.formatChartData=function(){p(this),m(this),
f.prototype.formatChartData.call(this)};function m(a){var b,c=(a.chartData||{}).length||-1;for(b=0;b<c;b++)n(a.chartData[b].data)}function n(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.x?c.x=o(c.x):""===c.x&&(c.x=null),c.y?c.y=o(c.y):""===c.y&&(c.y=null),c.z?c.z=o(c.z):""===c.z&&(c.z=null)}function o(b){var e=a.extractHyperlinkValue(b),f=c.parseFloat(e);return d.is(Date,e)?e:isNaN(f)?null:Number(f)}function p(a){(a.chartData||{}).length&&a.chartUtil.typeOfPieChart(a.config.chartType)&&a.config.pieSeries.length>0&&(a.chartData[0].data=a.config.pieSeries)}function q(b){var c,d=(b||{}).length;for(c=0;c<d;c++)b[c]=a.extractHyperlinkValue(b[c]);return b}var r=d.curry(function a(b){var c=10,d=(this.value||"").toString();return d.length>c&&b.truncateLabels?d.substring(0,c)+" ...":this.value});function s(a,b,c){var d=B(c,b);return a.layout=d?"horizontal":"vertical",a.align=d?"center":a.align,a.verticalAlign=d?"top":a.verticalAlign,a.floating=!1,a.maxHeight=250,a}function t(a){return{
enabled:a.enable3d,alpha:"pie"===a.chartType||"donut"===a.chartType?40:4,beta:2,depth:50}}e.prototype.enable3D=function(){var a=this.options.chart.options3d.enabled;this.options.chart.options3d.enabled=!!this.chartUtil.allow3d(this.config.chartType)&&a,this.config.enable3d&&this.config.showScrollBar&&(this.options.chart.zoomType="",this.options.chart.panning=!1)};function u(a,b){var c=[a.chartUtil.CHART_TYPE_COLUMN,a.chartUtil.CHART_TYPE_STACKED_COLUMN,a.chartUtil.CHART_TYPE_BAR,a.chartUtil.CHART_TYPE_STACKED_BAR,a.chartUtil.CHART_TYPE_LINE,a.chartUtil.CHART_TYPE_AREA,a.chartUtil.CHART_TYPE_STACKED_AREA];return!!a.config.showScrollBar&&(!a.config.polar&&c.indexOf(a.chartData[b].type)!==-1)}function v(a){return a=Number(a),isNaN(a)?"":a-1}e.prototype.formatScrollBar=function(a){u(this,a)&&(this.options.scrollbar.enabled=!0,this.options.xAxis.max=v(this.config.scrollMaximum))},e.prototype.formatStacked=function(a){w(this,a),x(this,a),y(this,a),z(this,a),A(this,a)};function w(a,b){
a.chartData[b].type===a.chartUtil.CHART_TYPE_BAR&&a.config.stacked&&(a.options.plotOptions.bar.stacking="normal",a.options.tooltip.shared=a.config.stackToolTips,a.options.tooltip.pointFormat=a.config.pointFormat||'<span style="color:{series.color}">{series.name}</span>: <b>{point.y:g2}</b><br/>')}function x(a,b){a.chartData[b].type===a.chartUtil.CHART_TYPE_COLUMN&&a.config.stacked&&(a.options.plotOptions.column.stacking=a.config.percentStacked?"percent":"normal",a.options.tooltip.shared=a.config.stackToolTips,a.config.percentStacked?a.options.tooltip.pointFormat=a.config.pointFormat||'<span style="color:{series.color}">{series.name}</span>: <b>{point.y:g2}</b> ({point.percentage:n0}%)<br/>':a.options.tooltip.pointFormat=a.config.pointFormat||'<span style="color:{series.color}">{series.name}</span>: <b>{point.y:g2}</b><br/>')}function y(a,b){a.chartData[b].type===a.chartUtil.CHART_TYPE_AREA&&a.config.stacked&&(a.options.plotOptions.area.stacking="normal",
a.options.tooltip.shared=a.config.stackToolTips,a.options.tooltip.pointFormat=a.config.pointFormat||'<span style="color:{series.color}">{series.name}</span>: <b>{point.y:g2}</b><br/>')}function z(a,b){a.chartData[b].type===a.chartUtil.CHART_TYPE_DONUT&&(a.chartData[b].type=a.chartUtil.CHART_TYPE_PIE,a.chartData[b].innerSize="60%")}function A(a,b){a.config.percentStacked&&a.chartData[b].type!==a.chartUtil.CHART_TYPE_COLUMN&&(a.config.percentStacked=!1)}function B(a,b){var c=[b.CHART_TYPE_PIE,b.CHART_TYPE_DONUT,b.CHART_TYPE_PYRAMID];return d.any(d.equals(a.chartType),c)}return e});