/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define('system/lang/event-binding',["require","exports"],function(require,exports){"use strict";var a=function(){function a(a,b,c){void 0===c&&(c=[]),this.handler=a,this.context=b,this.args=c}return a.prototype.execute=function(a){void 0===a&&(a=[]),a=this.args.concat(a),this.handler.apply(this.context,a)},a.prototype.dispose=function(){this.handler=null,this.context=null,this.args=null},a}();exports.EventBinding=a});
define('system/lang/event',["require","exports","./event-binding"],function(require,exports,a){"use strict";var b=function(){function b(){this.bindings=[]}return b.prototype.add=function(b,c){for(var d=[],e=2;e<arguments.length;e++)d[e-2]=arguments[e];if(null===b)throw"Event handler must not be null";if(void 0===b)throw"Event handler must not be undefined";var f=Array.prototype.slice.call(arguments,2),g=new a.EventBinding(b,c,f);return this.bindings.push(g),g},b.prototype.raise=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];for(var c=this.bindings.length,d=0;d!==c;d++)this.bindings[d].execute(a)},b.prototype.remove=function(a,b){arguments.length>1?c(this,a,b):arguments.length>0?(b=a,d(this,b)):e(this)},b}();function c(a,b,c){for(var d=[],e=a.bindings.length,f=0;f!==e;f++){var g=a.bindings[f];g.handler!==b||g.context!==c?d.push(g):g.dispose()}a.bindings=d}function d(a,b){for(var c=[],d=a.bindings.length,e=0;e!==d;e++){var f=a.bindings[e];f.context!==b?c.push(f):f.dispose()}
a.bindings=c}function e(a){for(var b=a.bindings.length,c=0;c!==b;c++)a.bindings[c].dispose();a.bindings=[]}return b});
define('system/lang/functional',['require','ramda'],function(require){"use strict";var a=require("ramda");function b(){}function c(b,c){return a.is(Function,c[b])?c[b]():c[b]}function d(a,b){return console[a](b),b}function e(a){return a}function f(){return Array.prototype.join.call(arguments,"")}function g(b){if(a.is(Function,b)){var c=Array.prototype.slice.call(arguments,1);return setTimeout(function(){b.apply(void 0,c)},1)}}var h=a.either(a.identity,function(){return{}}),i=a.either(a.identity,function(){return[]});return{noop:b,identity:a.identity,areSame:a.identical,result:a.curry(c),log:d.bind(null,"log"),trace:d.bind(null,"trace"),warn:d.bind(null,"warn"),error:d.bind(null,"error"),debug:e,str:f,defer:g,defaultToObject:h,defaultToArray:i}});
define('spa/url-manager',['require','ramda','bluebird','system/lang/event','system/lang/functional'],function(require){"use strict";var a=require("ramda"),b=require("bluebird"),c=require("system/lang/event"),d=require("system/lang/functional"),e="hashchange",f=/^#/;function g(a,b){this.eventSource=a,this.location=this.eventSource.location,this.strategy=b,this.routesChanged=new c,this.routeInfo=null}g.prototype.activate=function(){h(this),this.handleEvent()};function h(a){a.eventSource.addEventListener(e,a)}g.prototype.handleEvent=function(a){var b=this.parse(this.location.hash.replace(f,""));if(this.strategy.removeQueryString&&b.query)return this.overrideHash(b.routes,b.active).then(i.bind(null,this,b));i(this,b)},g.prototype.parse=function(a){return this.strategy.parse(a)};function i(a,b){a.routeInfo=b,a.onRoutesChanged()}g.prototype.overrideHash=function(a,c,e){var f=this;return new b(function(b){j(f),f.location.replace(f.strategy.getHash(a,c,e)),d.defer(k.bind(null,f,b))})};function j(a){a.eventSource.removeEventListener(e,a)}function k(a,b){h(a),b()}
g.prototype.onRoutesChanged=function(a){a=a||this.routeInfo,this.routesChanged.raise(a)},g.prototype.setHash=function(a,b,c,d){b=l(a,d,b),this.location.hash=this.strategy.getHash(a,b,c,d)},g.prototype.replaceHash=function(a,b,c,d){b=l(a,d,b);var e=this.strategy.getHash(a,b,c,d);this.location.replace(e)};function l(a,b,c){var d=a[a.length-1],e=a.indexOf(d),f=a.lastIndexOf(d),g=e!==f;return b&&b.reuseTab&&g&&(a.pop(),c=a.indexOf(d)),c}return g.prototype.refresh=function(){var b=a.clone(this.routeInfo);b.routes[b.active]="empty-page",this.onRoutesChanged(b),this.onRoutesChanged()},g});
define('application/application-context',["require","exports","ramda"],function(require,exports,a){"use strict";var b=function(b){return function(c){if(!c)return!1;var d=b(c);return!a.isNil(d)&&""!==d}},c=b(a.prop("siteKey")),d=b(a.prop("defaultSiteKey")),e=function(){function a(){f(this)}return a.prototype.getSiteContext=function(){return c(this.assetcontext)?this.assetcontext.siteKey:d(this.user)?this.user.defaultSiteKey:null},a.prototype.hasPredixSDKInstalled=function(){return!!window.PredixSDK},a.prototype.reset=function(){f(this)},a}();function f(a){a.user=null,a.session=null,a.homeRoute="home",a.sessionStatus={isActive:!1},a.assetcontext=null,a.licensedModules=null,a.help={helpContext:null,helpUrl:null,defaultUrl:null},a.connectionStatus={connected:!0,lastStatusChange:null,connectionCheckerInterval:null,lastResponse:new Date,lastUserActivity:new Date},a.navigation={activeRoute:null,tabsInfo:null},a.isSupportedBrowser=!0,a.isAppHub=!!window.nav,a.hostingEnvironment=0}return new e});
define('spa/knockout/knockout-view-model',["require","exports","knockout"],function(require,exports,a){"use strict";return function(){function b(a){this.view=a,this.subscriptions=[],this.preserveContext=!1}return b.prototype.attach=function(b){b.attach($(this.view));var c=b.element;if(a.contextFor(c)&&this.preserveContext){var d=a.contextFor(c).createChildContext(this);a.applyBindingsToDescendants(d,c)}else a.applyBindingsToDescendants(this,c)},b.prototype.detach=function(b){a.cleanNode(b.element),b.clear()},b}()});
/**
 * @license RequireJS text 2.0.9 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */
/*jslint regexp: true */
/*global require, XMLHttpRequest, ActiveXObject,
  define, window, process, Packages,
  java, location, Components, FileUtils */

define('text',['module'], function (module) {
    'use strict';

    var text, fs, Cc, Ci, xpcIsWindows,
        progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'],
        xmlRegExp = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,
        bodyRegExp = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,
        hasLocation = typeof location !== 'undefined' && location.href,
        defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\:/, ''),
        defaultHostName = hasLocation && location.hostname,
        defaultPort = hasLocation && (location.port || undefined),
        buildMap = {},
        masterConfig = (module.config && module.config()) || {};

    text = {
        version: '2.0.9',

        strip: function (content) {
            //Strips <?xml ...?> declarations so that external SVG and XML
            //documents can be added to a document without worry. Also, if the string
            //is an HTML document, only the part inside the body tag is returned.
            if (content) {
                content = content.replace(xmlRegExp, "");
                var matches = content.match(bodyRegExp);
                if (matches) {
                    content = matches[1];
                }
            } else {
                content = "";
            }
            return content;
        },

        jsEscape: function (content) {
            return content.replace(/(['\\])/g, '\\$1')
                .replace(/[\f]/g, "\\f")
                .replace(/[\b]/g, "\\b")
                .replace(/[\n]/g, "\\n")
                .replace(/[\t]/g, "\\t")
                .replace(/[\r]/g, "\\r")
                .replace(/[\u2028]/g, "\\u2028")
                .replace(/[\u2029]/g, "\\u2029");
        },

        createXhr: masterConfig.createXhr || function () {
            //Would love to dump the ActiveX crap in here. Need IE 6 to die first.
            var xhr, i, progId;
            if (typeof XMLHttpRequest !== "undefined") {
                return new XMLHttpRequest();
            } else if (typeof ActiveXObject !== "undefined") {
                for (i = 0; i < 3; i += 1) {
                    progId = progIds[i];
                    try {
                        xhr = new ActiveXObject(progId);
                    } catch (e) {}

                    if (xhr) {
                        progIds = [progId];  // so faster next time
                        break;
                    }
                }
            }

            return xhr;
        },

        /**
         * Parses a resource name into its component parts. Resource names
         * look like: module/name.ext!strip, where the !strip part is
         * optional.
         * @param {String} name the resource name
         * @returns {Object} with properties "moduleName", "ext" and "strip"
         * where strip is a boolean.
         */
        parseName: function (name) {
            var modName, ext, temp,
                strip = false,
                index = name.indexOf("."),
                isRelative = name.indexOf('./') === 0 ||
                             name.indexOf('../') === 0;

            if (index !== -1 && (!isRelative || index > 1)) {
                modName = name.substring(0, index);
                ext = name.substring(index + 1, name.length);
            } else {
                modName = name;
            }

            temp = ext || modName;
            index = temp.indexOf("!");
            if (index !== -1) {
                //Pull off the strip arg.
                strip = temp.substring(index + 1) === "strip";
                temp = temp.substring(0, index);
                if (ext) {
                    ext = temp;
                } else {
                    modName = temp;
                }
            }

            return {
                moduleName: modName,
                ext: ext,
                strip: strip
            };
        },

        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,

        /**
         * Is an URL on another domain. Only works for browser use, returns
         * false in non-browser environments. Only used to know if an
         * optimized .js version of a text resource should be loaded
         * instead.
         * @param {String} url
         * @returns Boolean
         */
        useXhr: function (url, protocol, hostname, port) {
            var uProtocol, uHostName, uPort,
                match = text.xdRegExp.exec(url);
            if (!match) {
                return true;
            }
            uProtocol = match[2];
            uHostName = match[3];

            uHostName = uHostName.split(':');
            uPort = uHostName[1];
            uHostName = uHostName[0];

            return (!uProtocol || uProtocol === protocol) &&
                   (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) &&
                   ((!uPort && !uHostName) || uPort === port);
        },

        finishLoad: function (name, strip, content, onLoad) {
            content = strip ? text.strip(content) : content;
            if (masterConfig.isBuild) {
                buildMap[name] = content;
            }
            onLoad(content);
        },

        load: function (name, req, onLoad, config) {
            //Name has format: some.module.filext!strip
            //The strip part is optional.
            //if strip is present, then that means only get the string contents
            //inside a body tag in an HTML string. For XML/SVG content it means
            //removing the <?xml ...?> declarations so the content can be inserted
            //into the current doc without problems.

            // Do not bother with the work if a build and text will
            // not be inlined.
            if (config.isBuild && !config.inlineText) {
                onLoad();
                return;
            }

            masterConfig.isBuild = config.isBuild;

            var parsed = text.parseName(name),
                nonStripName = parsed.moduleName +
                    (parsed.ext ? '.' + parsed.ext : ''),
                url = req.toUrl(nonStripName),
                useXhr = (masterConfig.useXhr) ||
                         text.useXhr;

            //Load the text. Use XHR if possible and in a browser.
            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {
                text.get(url, function (content) {
                    text.finishLoad(name, parsed.strip, content, onLoad);
                }, function (err) {
                    if (onLoad.error) {
                        onLoad.error(err);
                    }
                });
            } else {
                //Need to fetch the resource across domains. Assume
                //the resource has been optimized into a JS module. Fetch
                //by the module name + extension, but do not include the
                //!strip part to avoid file system issues.
                req([nonStripName], function (content) {
                    text.finishLoad(parsed.moduleName + '.' + parsed.ext,
                                    parsed.strip, content, onLoad);
                });
            }
        },

        write: function (pluginName, moduleName, write, config) {
            if (buildMap.hasOwnProperty(moduleName)) {
                var content = text.jsEscape(buildMap[moduleName]);
                write.asModule(pluginName + "!" + moduleName,
                               "define(function () { return '" +
                                   content +
                               "';});\n");
            }
        },

        writeFile: function (pluginName, moduleName, req, write, config) {
            var parsed = text.parseName(moduleName),
                extPart = parsed.ext ? '.' + parsed.ext : '',
                nonStripName = parsed.moduleName + extPart,
                //Use a '.js' file name so that it indicates it is a
                //script that can be loaded across domains.
                fileName = req.toUrl(parsed.moduleName + extPart) + '.js';

            //Leverage own load() method to load plugin value, but only
            //write out values that do not have the strip argument,
            //to avoid any potential issues with ! in file names.
            text.load(nonStripName, req, function (value) {
                //Use own write() method to construct full module value.
                //But need to create shell that translates writeFile's
                //write() to the right interface.
                var textWrite = function (contents) {
                    return write(fileName, contents);
                };
                textWrite.asModule = function (moduleName, contents) {
                    return write.asModule(moduleName, fileName, contents);
                };

                text.write(pluginName, nonStripName, textWrite, config);
            }, config);
        }
    };

    if (masterConfig.env === 'node' || (!masterConfig.env &&
            typeof process !== "undefined" &&
            process.versions &&
            !!process.versions.node &&
            !process.versions['node-webkit'])) {
        //Using special require.nodeRequire, something added by r.js.
        fs = require.nodeRequire('fs');

        text.get = function (url, callback, errback) {
            try {
                var file = fs.readFileSync(url, 'utf8');
                //Remove BOM (Byte Mark Order) from utf8 files if it is there.
                if (file.indexOf('\uFEFF') === 0) {
                    file = file.substring(1);
                }
                callback(file);
            } catch (e) {
                errback(e);
            }
        };
    } else if (masterConfig.env === 'xhr' || (!masterConfig.env &&
            text.createXhr())) {
        text.get = function (url, callback, errback, headers) {
            var xhr = text.createXhr(), header;
            xhr.open('GET', url, true);

            //Allow plugins direct access to xhr headers
            if (headers) {
                for (header in headers) {
                    if (headers.hasOwnProperty(header)) {
                        xhr.setRequestHeader(header.toLowerCase(), headers[header]);
                    }
                }
            }

            //Allow overrides specified in config
            if (masterConfig.onXhr) {
                masterConfig.onXhr(xhr, url);
            }

            xhr.onreadystatechange = function (evt) {
                var status, err;
                //Do not explicitly handle errors, those should be
                //visible via console output in the browser.
                if (xhr.readyState === 4) {
                    status = xhr.status;
                    if (status > 399 && status < 600) {
                        //An http 4xx or 5xx error. Signal an error.
                        err = new Error(url + ' HTTP status: ' + status);
                        err.xhr = xhr;
                        errback(err);
                    } else {
                        callback(xhr.responseText);
                    }

                    if (masterConfig.onXhrComplete) {
                        masterConfig.onXhrComplete(xhr, url);
                    }
                }
            };
            xhr.send(null);
        };
    } else if (masterConfig.env === 'rhino' || (!masterConfig.env &&
            typeof Packages !== 'undefined' && typeof java !== 'undefined')) {
        //Why Java, why is this so awkward?
        text.get = function (url, callback) {
            var stringBuffer, line,
                encoding = "utf-8",
                file = new java.io.File(url),
                lineSeparator = java.lang.System.getProperty("line.separator"),
                input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)),
                content = '';
            try {
                stringBuffer = new java.lang.StringBuffer();
                line = input.readLine();

                // Byte Order Mark (BOM) - The Unicode Standard, version 3.0, page 324
                // http://www.unicode.org/faq/utf_bom.html

                // Note that when we use utf-8, the BOM should appear as "EF BB BF", but it doesn't due to this bug in the JDK:
                // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058
                if (line && line.length() && line.charAt(0) === 0xfeff) {
                    // Eat the BOM, since we've already found the encoding on this file,
                    // and we plan to concatenating this buffer with others; the BOM should
                    // only appear at the top of a file.
                    line = line.substring(1);
                }

                if (line !== null) {
                    stringBuffer.append(line);
                }

                while ((line = input.readLine()) !== null) {
                    stringBuffer.append(lineSeparator);
                    stringBuffer.append(line);
                }
                //Make sure we return a JavaScript string and not a Java string.
                content = String(stringBuffer.toString()); //String
            } finally {
                input.close();
            }
            callback(content);
        };
    } else if (masterConfig.env === 'xpconnect' || (!masterConfig.env &&
            typeof Components !== 'undefined' && Components.classes &&
            Components.interfaces)) {
        //Avert your gaze!
        Cc = Components.classes,
        Ci = Components.interfaces;
        Components.utils['import']('resource://gre/modules/FileUtils.jsm');
        xpcIsWindows = ('@mozilla.org/windows-registry-key;1' in Cc);

        text.get = function (url, callback) {
            var inStream, convertStream, fileObj,
                readData = {};

            if (xpcIsWindows) {
                url = url.replace(/\//g, '\\');
            }

            fileObj = new FileUtils.File(url);

            //XPCOM, you so crazy
            try {
                inStream = Cc['@mozilla.org/network/file-input-stream;1']
                           .createInstance(Ci.nsIFileInputStream);
                inStream.init(fileObj, 1, 0, false);

                convertStream = Cc['@mozilla.org/intl/converter-input-stream;1']
                                .createInstance(Ci.nsIConverterInputStream);
                convertStream.init(inStream, "utf-8", inStream.available(),
                Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);

                convertStream.readString(inStream.available(), readData);
                convertStream.close();
                inStream.close();
                callback(readData.value);
            } catch (e) {
                throw new Error((fileObj && fileObj.path || '') + ': ' + e);
            }
        };
    }
    return text;
});


define('text!platform/datasheets/layout/ui/layout-element-template-map.json',[],function () { return '{\r\n\t"RootLayoutGroup" : "layout-root-template",\r\n\t"LayoutGroup" : "layout-group-template",\r\n\t"TabbedGroup" : "layout-tabbed-group-template",\r\n\t"LayoutControlItem" : "layout-control-template",\r\n\t"SimpleLabelItem" : "layout-label-template",\r\n\t"SplitterItem" : "layout-empty-space-template",\r\n\t"SimpleSeparator" : "layout-empty-space-template",\r\n\t"EmptySpaceItem" : "layout-empty-space-template",\r\n\t"RowSpanContainer" : "layout-element-template",\r\n\t"TableLayoutContainer" : "layout-table-template",\r\n\t"TableColumn" : "layout-table-column-template",\r\n\t"TableRow" : "layout-table-row-template",\r\n\t"TableCell" : "layout-control-template"\r\n}';});

define('system/lang/ioc',["require","exports"],function(require,exports){"use strict";function a(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return function(b){b.dependsOn=a}}exports.dependsOn=a;function b(a){a.singleton=!0}exports.singleton=b;function c(a){return function(b){b.factory=a}}exports.factory=c;function d(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return Object.resolve.apply(Object,[a].concat(b))}exports.resolve=d});
define('system/globalization/translator',["require","exports","system/lang/ioc","jed"],function(require,exports,a){"use strict";var b=require("jed"),c=function(){function a(){this.jed=null}return a.prototype.setLocale=function(a){this.jed=new b(a)},a.prototype.translate=function(a,b,c){if(!a)return a;if(!this.jed)return a;var d=this.jed.translate(a);return b&&d.onDomain(b),c&&d.withContext(c),d.fetch()},a}();return c=__decorate([a.singleton],c)});
define('system/lang/object',["require","exports","lodash","jquery","bluebird"],function(require,exports,a,b,c){"use strict";function d(a,b){return __extends(b,a),a}function e(a){return new(Function.prototype.bind.apply(a,arguments))}function f(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];if(g(b))return h(b);var k;if(i(b))k=j(b);else{var o=l(b),p=a.map(o,function(a){return f(a)});p.unshift(b),p=p.concat(c),k=e.apply(null,p)}return m(b)&&n(b,k),k}function g(a){return a.singleton&&a.instance}function h(a){return a.instance}function i(b){return b.factory&&a.isFunction(b.factory)}function j(a){return k(a)()}function k(a){return a.factory}function l(a){return a.dependsOn||[]}function m(a){return!!a.singleton}function n(a,b){a.instance=b}function o(b,c){var d=[],e=0;for(c=c||0,e=0;e<c;e++)d.push({});return a.each(b,function(a,b){var c={id:e,name:b,text:a,toString:function(){return a}};d[b]=c,d.push(c),e++}),d.parse=function(c){if(isNaN(c)){var e=void 0;return a.each(d,function(a){c===a&&(e=c)}),
e||a.each(b,function(a,b){c!==a&&c!==b||(e=d[b])}),e}return d[c]},d.getDisplayText=function(a){var b=d.parse(a);return b?b.text:""},Object.freeze&&Object.freeze(d),d}function p(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];var e=Array.prototype.slice.call(arguments,2);if(r(a,b))return a[b].apply(a,e)}function q(a,b){b(a),p(a,"dispose")}function r(b,c,d){void 0===d&&(d=!1),a.isArray(c)||(c=[c]);for(var e=0;e<c.length;e++)if(!a.isFunction(b[c[e]])){if(d)throw"Required method "+c[e]+" is not defined";return!1}return!0}function s(b,c){var d=b[c];if(d&&a.isFunction(d))return d.bind(b)}function t(a,b,c){return!!a[b]&&(a[b]=c,!0)}function u(a,b){var c;return a[b]&&(c=a[b],delete a[b]),c}function v(a,b){return null===a?b:void 0===a?b:a}function w(a){var b=function(){return arguments.length&&(a=arguments[0]),a};return b.prop=function(){return a},b}var x=function(){function a(a){void 0===a&&(a=""),this.message=a,this.name="AbstractClassError"}return a}(),y=function(){
function a(a){void 0===a&&(a=""),this.message=a,this.name="AbstractMethodError"}return a}();function z(a,b){if(a.constructor===b)throw new x("Cannot create an instance of abstract class "+(b.name||""))}function A(a){throw new y("Cannot execute abstract method "+a+", must be overridden")}function B(a){return new c(C.bind(null,a))}function C(a,b,c){require(a,E.bind(null,b),D.bind(null,c))}function D(a,b){throw a(b),new Error(b)}function E(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];a(b)}var F={construct:e,resolve:f,inherit:d,createEnum:o,use:q,tryMethod:p,respondsTo:r,method:s,trySet:t,removeProperty:u,defaultValue:v,prop:w,AbstractClassError:x,AbstractMethodError:y,abstractClass:z,abstractMethod:A,require:B};return b.extend(Object,F),F});

define('text!system/error-handler/views/error-handler-view.html',[],function () { return '<div class="error-handler">\r\n\t<ul>\r\n\t\t<li>\r\n\t\t    <i class="icon-less-than previous"></i>\r\n\t\t</li>\r\n\t\t<li>\r\n\t    \t<span><span class="current-error-text">Error</span> <span class="current-error-number"></span> <span class="of-text">of</span> <span class="total-errors"></span></span>\r\n\t\t</li>\r\n\t\t<li>\r\n\t    \t<i class="icon-greater-than next"></i>\r\n\t\t</li>\r\n\t\t<li>\r\n\t    \t<span class="current-error"></span>\r\n\t\t</li>\r\n\t\t<li>\r\n\t    \t<span class="current-error-view-details link-txt">View Details</span> \r\n\t\t</li>\r\n\t\t<li>\r\n\t\t    <span class="vert-line"></span>\r\n\t\t</li>\r\n\t\t<li>\r\n\t    \t<span class="go-to-source-link link-txt">Go to source</span>\r\n\t\t</li>\r\n\t</ul>\r\n</div>';});

define('system/collections/list',["require","exports","jquery","knockout","system/lang/object"],function(require,exports,a,b,c){"use strict";return function(){function d(a){void 0===a&&(a=[]),this.items=a}return d.indexOf=function(b,c){var d=-1;return a.isArray(b)===!1?d:(a.each(b,function(a,b){if(c(b,a)===!0)return d=a,!1}),d)},d.sort=function(a,c,d,e){function f(a,b){return a&&b||!a&&!b?0:a?1:-1}function g(a,b){return a===b?0:a<b?-1:1}function h(a,b){var c=a.toString().toLocaleLowerCase(),d=b.toString().toLocaleLowerCase();return c===d?0:c<d?-1:1}function i(a,i){var j=b.utils.unwrapObservable(d?a[d]:a),k=b.utils.unwrapObservable(d?i[d]:i);e=e||typeof j;var l;switch(e){case"boolean":l=f(j,k);break;case"number":l=j-k;break;case"datetime":l=g(j,k);break;default:l=h(j,k)}return c||(l=0-l),l}a.sort(i)},d.fillArray=function(a,b,c){for(;b--;)a[b]=c;return a},d.prototype.count=function(){return this.items.length},d.prototype.add=function(a){this.items[this.count()]=a},d.prototype.item=function(a){
return a<0&&(a+=this.count()),this.items[a]},d.prototype.clear=function(){this.items.length=0},d.prototype.indexOf=function(a){return this.items.indexOf(a)},d.prototype.contains=function(a){return this.indexOf(a)!==-1},d.prototype.addRange=function(a){a.forEach(this.add,this)},d.prototype.forEach=function(a,b){for(var c=0;c!==this.count();c++)a.call(b,this.item(c),c,this)},d.prototype.map=function(a,b){for(var d=c.resolve(this.constructor),e=0;e!==this.count();e++)d.add(a.call(b,this.item(e),e,this));return d},d.prototype.take=function(a){var b;return b=a>=0?this.items.slice(0,a):this.items.slice(a),c.resolve(this.constructor,b)},d.prototype.shift=function(){return this.items.shift()},d.prototype.pop=function(){return this.items.pop()},d.prototype.moveToEnd=function(a){this.remove(a),this.add(a)},d.prototype.remove=function(a){var b=this.indexOf(a);b!==-1&&this.items.splice(b,1)},d.prototype.createArrayIndex=function(a,b){var c={};if(a)for(var d=0;d<a.length;d++)c[a[d][b]]=a[d]
;return c},d}()});
define('system/collections/observable-list',["require","exports","knockout"],function(require,exports,a){"use strict";return function(){function b(b){void 0===b&&(b=[]),this.items=a.observableArray(b)}return b.prototype.count=function(){return this.items().length},b.prototype.item=function(a){return this.items()[a]},b.prototype.add=function(a){this.items.push(a)},b.prototype.remove=function(a){return this.items.remove(a)},b.prototype.clear=function(){this.items([])},b.prototype.indexOf=function(a){return this.items.indexOf(a)},b.prototype.moveUp=function(a){var b=this.items.indexOf(a);0!==b&&(this.items()[b]=this.items()[b-1],this.items()[b-1]=a,this.items.valueHasMutated())},b.prototype.moveDown=function(a){var b=this.items.indexOf(a);b!==this.items().length-1&&(this.items()[b]=this.items()[b+1],this.items()[b+1]=a,this.items.valueHasMutated())},b.prototype.dispose=function(){this.items([])},b}()});
define('system/knockout/change-tracker',["require","exports","knockout","ramda"],function(require,exports,a,b){"use strict";var c=function(){function b(b,c,f){void 0===c&&(c=a.toJSON),void 0===f&&(f=!1),this.hashFunction=c,this.objectToTrack=b,this.lastCleanState=a.observable(),f||this.lastCleanState(e(this)),this.isDirty=a.computed(d.bind(null,this))}return b.prototype.markCurrentStateAsClean=function(){this.lastCleanState(e(this))},b.prototype.dispose=function(){this.isDirty.dispose(),this.lastCleanState(null)},b}();function d(a){return e(a)!==a.lastCleanState()}function e(a){var c=a.hashFunction.apply(a.objectToTrack);return b.is(Object,c)?JSON.stringify(c):c}return c});
define('system/knockout/knockout-manager',["require","exports","knockout","system/collections/list","system/collections/observable-list","./change-tracker","system/lang/functional"],function(require,exports,a,b,c,d){"use strict";var e=require("system/lang/functional");return function(){function f(a){void 0===a&&(a=e.noop),this.observables=new b,this.computeds=new b,this.subscriptions=new b,this.tracker=new d(this,a),this.isDirty=this.tracker.isDirty}return f.prototype.observable=function(){var b=a.observable.apply(null,Array.prototype.splice.call(arguments,0));return this.observables.add(b),b},f.prototype.observableArray=function(){var b=a.observableArray.apply(null,Array.prototype.splice.call(arguments,0));return this.observables.add(b),b},f.prototype.observableList=function(a){var b=new c(a);return this.observables.add(b),b},f.prototype.computed=function(b){var c=a.computed.apply(null,Array.prototype.splice.call(arguments,0));return this.computeds.add(c),c},f.prototype.pureComputed=function(b){
var c=a.pureComputed.apply(null,Array.prototype.splice.call(arguments,0));return this.computeds.add(c),c},f.prototype.subscribe=function(a,b,c,d){var e=a.subscribe(b,c,d);return this.subscriptions.add(e),e},f.prototype.dispose=function(){this.disposeSubscriptions(),this.disposeComputeds(),this.disposeObservables(),this.tracker.dispose()},f.prototype.disposeSubscriptions=function(){this.subscriptions.forEach(function(a){a.dispose()}),this.subscriptions.clear()},f.prototype.disposeComputeds=function(){this.computeds.forEach(function(a){a.dispose()}),this.computeds.clear()},f.prototype.disposeObservables=function(){this.observables.forEach(function(a){a.dispose?a.dispose():a(null)}),this.observables.clear()},f.prototype.createHash=function(){return this.observables.items.map(function(a){return a()})},f}()});
define('system/text/parser',["require","exports","ramda","globalize"],function(require,exports,a){"use strict";var b=require("globalize"),c=function(){function c(){}return c.prototype.parseInt=function(a,c,d){return void 0===a||null===a?a:"string"!=typeof a&&"number"!=typeof a?NaN:b.parseInt(a,c,d)},c.prototype.parseFloat=function(a,c,d){return void 0===a||null===a||"number"==typeof a?a:"string"!=typeof a?NaN:b.parseFloat(a,c,d)},c.prototype.parseDate=function(c,e,f){if(!e){var g=a.clone(b.findClosestCulture().calendar.patterns);return g.dt=d("d","t"),g.dT=d("d","T"),g.Dt=d("D","t"),g.DT=d("D","T"),g.Mt=d("M","t"),g.MT=d("M","T"),g.Yt=d("Y","t"),g.YT=d("Y","T"),b.parseDate(c,a.values(g),f)}return b.parseDate(c,e,f)},c}();function d(a,b){return e(a)+" "+e(b)}function e(a){return b.findClosestCulture().calendar.patterns[a]}return new c});
define('system/text/formatter',["require","exports","lodash","jquery","system/lang/ioc","system/text/parser"],function(require,exports,a,b,c,d){"use strict";var e=require("globalize");Date.Formats={Unformatted:"yyyy-MM-dd HH:mm:ss",Sortable:"S",LongDate_ShortTime:"f",LongDate_LongTime:"F",ShortTime:"t",LongTime:"T",ShortDate:"d",LongDate:"D",Month_Year:"Y",Month_Day:"M"};var f=function(a){return function(b){return a+(b||"")}};Number.Formats={Number:f("n"),Decimal:f("d"),Percent:f("p"),Currency:f("c")},Number.Formats.Number_Zero="n0",Number.Formats.Number_Two=Number.Formats.Number(2),Number.Formats.Number_Four=Number.Formats.Number(4),Number.Formats.Decimal_Zero="d0",Number.Formats.Decimal_Two=Number.Formats.Decimal(2),Number.Formats.Decimal_Four=Number.Formats.Decimal(4),Number.Formats.Percent_Zero="p0",Number.Formats.Percent_One=Number.Formats.Percent(1),Number.Formats.Percent_Two=Number.Formats.Percent(2),Number.Formats.Currency_Zero="c0",Number.Formats.Currency_Two=Number.Formats.Currency(2)
;var g=function(){function c(){this.culture="en"}return c.prototype.setCulture=function(a){this.culture=a,e.culture(a)},c.prototype.cultureInfo=function(){return e.culture()},c.prototype.getFormatByCode=function(a){return i(a)},c.prototype.format=function(b,c,f){var g=this,i=!1,j=null;if(f=f||this.culture,a.isArray(c))return a.map(c,function(a){return g.format(b,a,f)}).join(" ");if(c=c,b instanceof Date)return h(b,c,f);if(c&&null!==c.match(/^[ndmg]e?[0-9]*/i)&&!(b instanceof Date)){var k="number"==typeof b?b:d.parseFloat(b,10,"en");if(isNaN(k)||null===k)c=void 0;else{var l=c.substr(0,1);if(null!==c.match(/^[ndmg]e[0-9]*/i)){c=c.replace("e","");var n=m(k,!0);n&&n.length>1&&(k=parseFloat(n[0]),j="e"+n[1])}switch(b=k,l){case"m":c=o(k,c);break;case"g":c=o(k,c),i=!0}}}var p=e.format(b,c,f);if(j&&(p+=j),i){var q=new RegExp(e.culture(f).numberFormat[","].replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),"g");p&&(p=p.replace(q,""))}return p},c.prototype.abbreviate=function(a,b){
return a&&a.length>2*b?a.substr(0,b)+"..."+a.substr(a.length-b,a.length):a},c.prototype.abbreviateByWidth=function(a,c,d){if(!a)return a;var e=document.createElement("span");e.className="dummy-span";var f=b(e);f.text(a),b(document).find("body").append(f);var g=f.width();return b(e).remove(),g>c?this.abbreviate(a,d):a},c}();g=__decorate([c.singleton],g);function h(a,b,c){return b=i(b),e.format(a,b,c)}function i(a){return"g"===a?j():"G"===a||"GT"===a?l():"r"===a||"R"===a?"ddd, dd MMM yyyy HH':'mm':'ss 'GMT'":"s"===a||"m"===a||"y"===a?a.toUpperCase():a}function j(){return k("d")+" "+k("t")}function k(a){return e.culture().calendar.patterns[a]}function l(){return k("d")+" "+k("T")}function m(a,b){return a=a,!b&&n(a)?[a.toString()]:a.toExponential().split(/[eE]/)}function n(a){if(0===a)return!0;var b=Math.abs(a);return b<1e10&&b>1e-6}function o(a,b){var c=b.substr(1);return p(q(a,c.length>0?parseInt(c,10):void 0))}function p(a){var b=a.indexOf(".");return"n"+(b>-1?a.length-1-b:0)}
function q(a,b){var c=Number(a);if(isNaN(c))return a;var d,e=m(c);if(Math.abs(c)<1&&e&&e.length>1){var f=Math.floor(parseFloat(e[0])).toString().length,g=e[0].toString().length>f?e[0].toString().length-f-1:0,h=f+g,i=Math.abs(parseFloat(e[1])),j=i+(b>h?h:b)-1;d=c.toFixed(j>20?20:j)}else d=Math.abs(c)>=1||!b?0===b||b?c.toFixed(b>20?20:b):c.toString():c.toPrecision(b);var k=c.toString();return k.length<d.length?k:d}return g});
define('system/diagnostics/log-message',["require","exports","lodash","system/lang/object","system/text/formatter"],function(require,exports,a,b,c){"use strict";var d=function(){function d(a,b,c,d,e){void 0===e&&(e=""),this.level=a,this.source=b,this.text=c,this.timestamp=d?new Date(d):new Date,this.context=e}return d.fromJson=function(a){return new d(a.level,a.source,a.text,a.timestamp,a.context)},d.fromJsonCollection=function(b){return a.map(b,d.fromJson)},d.prototype.fullSource=function(){return this.context?this.source+" ["+this.context+"]":this.source},d.prototype.toJson=function(){return{timestamp:this.timestamp.toISOString(),level:this.level,source:this.source,text:this.text,context:this.context}},d.prototype.getFormattedTimestamp=function(){return b.resolve(c).format(this.timestamp,"f")},d.prototype.getLevelCaption=function(a){return e(a,this.level)},d}();function e(b,c){var d=a.find(b,{value:c});return d?d.text:c}return d});
define('system/diagnostics/logger',["require","exports","lodash","./log-message"],function(require,exports,a,b){"use strict";var c={trace:5,debug:4,info:3,warn:2,error:1,fatal:0},d=function(){function a(a,b,c){this.id=a,this.messageLogged=b,this.level=c}return a.prototype.log=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];e(this,a,b)},a.prototype.trace=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.trace,b)},a.prototype.debug=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.debug,b)},a.prototype.info=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.info,b)},a.prototype.warn=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.warn,b)},a.prototype.error=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.error,b)},a.prototype.fatal=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c]
;e(this,a.levels.fatal,b)},a.prototype.isTraceEnabled=function(){return f(this,a.levels.trace)},a.prototype.isDebugEnabled=function(){return f(this,a.levels.debug)},a.prototype.isInfoEnabled=function(){return f(this,a.levels.info)},a.prototype.isWarnEnabled=function(){return f(this,a.levels.warn)},a.prototype.isErrorEnabled=function(){return f(this,a.levels.error)},a.prototype.isFatalEnabled=function(){return f(this,a.levels.fatal)},a}();d.levels={trace:"trace",debug:"debug",info:"info",warn:"warn",error:"error",fatal:"fatal"};function e(a,c,d){if(f(a,c)){var e=new b(c,a.id,g(d).join(" "));a.messageLogged.raise(a,e)}}function f(a,b){return c[b]<=c[a.level]}function g(b){return a.map(b,function(b){return a.isObject(b)?JSON.stringify(b):a.isNull(b)?"":a.isUndefined(b)?"":b.toString()})}return d});
define('config/storage-config',["require","exports","application/application-context"],function(require,exports,a){"use strict";function b(){var b=a.session,c=b.apiServer.toUpperCase(),d=b.datasourceId.toUpperCase(),e=b.userId.toUpperCase(),f="Meridium APM("+c+", "+d+", "+e+")";return{name:f,description:f}}exports.documentStorage=b});
define('system/data/document-storage',["require","exports","jquery","config/storage-config","localforage"],function(require,exports,a,b){"use strict";var c=require("localforage");return function(){function d(d){var e=a.extend({},b.documentStorage(),{storeName:"data"});this.prefix=d+"__",this.instance=c.createInstance(e)}return d.prototype.getItem=function(b){var c=a.Deferred();return this.instance.getItem(this.prefix+b).then(c.resolve.bind(c),c.reject.bind(c)),c.promise()},d.prototype.setItem=function(b,c){var d=a.Deferred();return this.instance.setItem(this.prefix+b,c).then(d.resolve.bind(d),d.reject.bind(d)),d.promise()},d.prototype.removeItem=function(b){var c=a.Deferred();return this.instance.removeItem(this.prefix+b).then(c.resolve.bind(c),c.reject.bind(c)),c.promise()},d}()});
define('system/data/client-preferences',["require","exports","system/data/document-storage","system/lang/ioc"],function(require,exports,a,b){"use strict";var c=function(){function b(){this.documentStorage=new a("client_preferences")}return b.prototype.retrievePreferences=function(a){return this.documentStorage.getItem(a)},b.prototype.savePreference=function(a,b){return this.documentStorage.setItem(a,b)},b.prototype.deletePreference=function(a){return this.documentStorage.removeItem(a)},b}();return c=__decorate([b.singleton],c)});
define('system/diagnostics/log-service',["require","exports","lodash","jquery","system/lang/object","system/lang/ioc","system/data/document-storage","system/data/client-preferences","./log-message","./logger"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";var i={id:"log_config",level:h.levels.error,size:1e3},j=function(){function d(){this.clientPreferences=c.resolve(f),this.logStorage=new e("log"),this.messages=[]}return d.prototype.initializeLogConfig=function(a){return void 0===a&&(a=b.Deferred()),k(this).done(l.bind(null,this,a)),a.promise()},d.prototype.trimLog=function(){for(;this.messages.length>i.size;)this.messages.shift();return b.Deferred().resolve().promise()},d.prototype.saveConfig=function(b){return b=a.extend({},i,b),this.clientPreferences.savePreference(i.id,b)},d.prototype.saveMessage=function(a){var c=b.Deferred();this.messages.push(a.toJson()),this.trimLog(),this.logStorage.setItem("messages",this.messages).done(c.resolve.bind(c)).fail(o)},d.prototype.getAllMessages=function(){var a;try{
return a=this.messages.slice(0),a.reverse(),a=g.fromJsonCollection(a||[]),Promise.resolve(a)}catch(a){return console.error(a),Promise.reject(a)}},d.prototype.clearLog=function(){return this.messages=[],Promise.resolve(this.logStorage.setItem("messages",this.messages))},d}();j=__decorate([d.singleton],j);function k(a){return a.clientPreferences.retrievePreferences(i.id)}function l(a,b,c){c?n(a).done(b.resolve.bind(b,c)):a.saveConfig(i).done(m.bind(null,a,b,i))}function m(a,b,c){n(a).done(b.resolve.bind(b,c))}function n(a){return a.logStorage.getItem("messages").done(function(b){b&&(a.messages=b)}).fail(console.error)}function o(a,b){console.error(b),a.reject(b)}return j});
define('system/diagnostics/log-manager',["require","exports","lodash","system/lang/object","./logger","./log-service","system/lang/event"],function(require,exports,a,b,c,d,e){"use strict";var f=function(){function f(){this.defaultLevel=c.levels.error,this.level=this.defaultLevel,this.loggers={},this.nestedContexts=[],this.messageCache=[],this.messageLogged=new e,this.messageLogged.add(this.cacheMessage,this)}return f.prototype.cacheMessage=function(a,b){b.context=this.currentContext(),this.messageCache.push(b)},f.prototype.initialize=function(){var a=b.resolve(d);return a.trimLog(),a.initializeLogConfig().done(g.bind(null,this)).fail(h)},f.prototype.saveConfig=function(){return b.resolve(d).saveConfig().fail(h)},f.prototype.getLogger=function(a){var b=this.loggers[a];return b||(b=new c(a,this.messageLogged,this.level),this.loggers[a]=b),b},f.prototype.setLevel=function(b){this.level=b,a.each(this.loggers,function(a){return a.level=b})},f.prototype.pushContext=function(a){this.nestedContexts.push(k(a))},
f.prototype.popContext=function(){this.nestedContexts.pop()},f.prototype.currentContext=function(){return this.nestedContexts[this.nestedContexts.length-1]},f}();function g(a,b){a.setLevel(c.levels[b.level]),i(a),a.messageLogged.add(function(b,c){c.context=a.currentContext(),j(a,c)},a)}function h(a){console.error(a)}function i(b){b.messageLogged.remove(b.cacheMessage,b),a.each(b.messageCache,j.bind(null,b))}function j(a,c){b.resolve(d).saveMessage(c)}function k(b){return a.isObject(b)?JSON.stringify(b):b.toString()}return new f});
define('application/application-events',["require","exports","system/lang/event","system/lang/ioc"],function(require,exports,a,b){"use strict";var c=function(){function b(){this.windowResized=new a,this.windowUnloaded=new a,this.signout=new a,this.windowClicked=new a,this.errorOccured=new a,this.errorUnhandled=new a,this.errorCleared=new a,this.titleChanged=new a,this.iconChanged=new a,this.navigate=new a,this.assetcontextChanged=new a,this.connectionChanged=new a,this.sessionChanged=new a,this.sessionExpired=new a,this.offlineSessionExpired=new a,this.smallDeviceOptionsMenuClicked=new a,this.layoutChanged=new a,this.bulkClose=new a}return b.prototype.removeAll=function(){this.connectionChanged.remove(),this.windowResized.remove(),this.windowUnloaded.remove(),this.signout.remove(),this.windowClicked.remove(),this.errorOccured.remove(),this.errorUnhandled.remove(),this.errorCleared.remove(),this.titleChanged.remove(),this.iconChanged.remove(),this.navigate.remove(),this.assetcontextChanged.remove(),
this.connectionChanged.remove(),this.sessionExpired.remove(),this.smallDeviceOptionsMenuClicked.remove(),this.layoutChanged.remove(),this.bulkClose.remove()},b}();return c=__decorate([b.singleton],c)});
define('system/error/error-message',["require","exports"],function(require,exports){"use strict";return function(){function a(a,b,c){void 0===c&&(c=null),this.code=a,this.message=b,this.detail=c}return a.fromHttpResponse=function(b,c,d){if(c.responseText){var e=d?d+c.responseText:c.responseText;return new a(b,this.fromDetail(e),c.responseText)}var e=d?d+c.statusText:c.statusText;return new a(b,e)},a.fromDetail=function(a){return a=a.replace("\r\n"," ").replace("\n","").replace("\r",""),a.length>512&&(a=a.substring(0,510)+".."),a},a}()});
define('spa/conductor',["require","exports","jquery","system/lang/ioc","system/diagnostics/log-manager","application/application-events","system/error/error-message","system/globalization/translator"],function(require,exports,a,b,c,d,e,f){"use strict";var g=c.getLogger("spa/conductor"),h="FND1",i="PAGE_NOT_LOADED",j=function(){function b(a,b){this.errorOccured=a.errorOccured,this.translator=b}return b.prototype.activateScreen=function(a,b){try{return k(this,a,b)}catch(a){l(this,a)}},b.prototype.createArgumentArray=function(a,b){return void 0===b&&(b=[]),g.isTraceEnabled()&&g.trace("create argument array"),a?(a.named&&b.push(a.named),Array.prototype.push.apply(b,a.positional),b):b},b.prototype.reuseScreen=function(a,b,c){try{return m(this,a,b,c)}catch(a){l(this,a)}},b.prototype.deactivateScreen=function(a){try{n(a)}catch(a){l(this,a)}},b.prototype.canUnloadScreen=function(a){try{return o(a)}catch(a){return l(this,a),!1}},b.prototype.attachScreen=function(a,b,c){try{p(a,b,c)}catch(a){l(this,a)}},
b.prototype.detachScreen=function(a){try{q(a)}catch(a){l(this,a)}},b.prototype.canReuseScreen=function(a,b,c){try{return r(this,a,b,c)}catch(a){return l(this,a),!1}},b.prototype.openScreen=function(a,b){try{s(this,a,b)}catch(a){l(this,a)}},b.prototype.loadScreen=function(a,b){try{t(this,a,b)}catch(a){l(this,a)}},b.prototype.closeScreen=function(a){try{u(a)}catch(a){l(this,a)}},b.prototype.unloadScreen=function(a){try{v(a)}catch(a){l(this,a)}},b.prototype.changeScreen=function(b,d,e,f){void 0===e&&(e={});var h=d.screen,i={isClosing:!0,checkForReuse:!0,checkForUnload:!1};if(c.pushContext(w(b)+" from "+w(h)),a.extend(i,f),i.checkForReuse&&this.canReuseScreen(h,b,e))return g.isDebugEnabled()&&g.debug("Reusing previous screen."),void this.reuseScreen(h,d,e);this.openScreen(b,e),this.loadScreen(b,e),this.deactivateScreen(h),this.activateScreen(b,e),this.detachScreen(d),this.attachScreen(b,d,e.url),i.isClosing&&b!==h&&(g.isDebugEnabled()&&g.debug("closing previous screen."),
this.unloadScreen(h),this.closeScreen(h)),c.popContext()},b.prototype.hideScreen=function(a){this.deactivateScreen(a.screen),this.detachScreen(a)},b.prototype.clearScreen=function(a){this.changeScreen(null,a),a.screen=null},b.prototype.showScreen=function(a,b){this.activateScreen(a.screen),this.attachScreen(a.screen,a,b)},b}();j=__decorate([b.dependsOn(d,f)],j);function k(a,b,c){if(g.isTraceEnabled()&&g.trace("activating screen"),(!b||!b.isActive)&&b&&(b.isActive=!0,b.activate)){var d=a.createArgumentArray(c);return b.activate.apply(b,d)}}function l(a,b){var c,d;c=b&&b.message?b.message:b instanceof Object?JSON.stringify(b):b,d=b.stack?b.stack:(new Error).stack;var f=a.translator.translate(i),g=new e(h,f,c+"\n"+d);a.errorOccured.raise(a,g)}function m(a,b,c,d){if(g.isTraceEnabled()&&g.trace("reuse screen"),b.reuse){var e=a.createArgumentArray(d,[c,d.url]);return b.reuse.apply(b,e)}}function n(a){g.isTraceEnabled()&&g.trace("deactivating screen"),a&&!a.isActive||a&&(a.isActive=!1,
a.deactivate&&a.deactivate())}function o(a){return g.isTraceEnabled()&&g.trace("can deactivate screen"),!a||!a.canUnload||a.canUnload()}function p(a,b,c){a&&a.isAttached===!0||(g.isTraceEnabled()&&g.trace("attaching screen"),a&&a.attach&&(a.attach(b,c),b.screen=a,a.isAttached=!0))}function q(a){g.isTraceEnabled()&&g.trace("detaching screen"),a&&a.screen&&(a&&a.screen&&!a.screen.isAttached||a.screen.detach&&(a.screen.detach(a),a.screen.isAttached=!1))}function r(a,b,c,d){var e=!0;if(g.isTraceEnabled()&&g.trace("can reuse screen: ",w(c)),!c||!b||c.constructor!==b.constructor)return!1;if(c.canReuse){var f=a.createArgumentArray(d);e=c.canReuse.apply(c,f)}else c.reuse||(e=!1);return e!==!1}function s(a,b,c){if(g.isTraceEnabled()&&g.trace("opening screen"),b&&!b.isOpen){if(b.open){var d=a.createArgumentArray(c);d[d.length]=c.url,b.open.apply(b,d)}b.isOpen=!0}}function t(a,b,c){if(g.isTraceEnabled()&&g.trace("load screen"),b&&!b.isLoaded){if(b.load){var d=a.createArgumentArray(c)
;b.load.apply(b,d)}b.isLoaded=!0}}function u(a){g.isTraceEnabled()&&g.trace("closing screen"),a&&a.isOpen&&(a.close&&a.close(),a.isOpen=!1)}function v(a){g.isTraceEnabled()&&g.trace("unload screen"),a&&a.isLoaded&&(a.unload&&a.unload(),a.isLoaded=!1)}function w(a){return a?a.constructor&&a.constructor.name?a.constructor.name:a.constructor?a.constructor:a.toString():a}return j});
define('spa/region',["require","exports","jquery"],function(require,exports,a){"use strict";var b=8,c=function(){function a(a){this.element=null,this.$element=null,this.setElement(a),this.activeContainer=null,this.screen=null}return a.prototype.setElement=function(a){var b=d(a);this.element=e(b),this.$element=h(b),i(this)},a.prototype.attach=function(a){this.clear(),this.activeContainer=j(),k(this,a),l(this)},a.prototype.clear=function(){this.activeContainer&&(n(this),i(this))},a.prototype.remove=function(){if(!this.$element)throw new Error("region.$element is null");this.$element.remove()},a.prototype.dispose=function(){this.clear(),this.detach(),this.screen=null},a.prototype.detach=function(){this.element=null,this.$element=null},a.prototype.removeAndDispose=function(){this.remove(),this.dispose()},a}();function d(a){return a||document.createElement("div")}function e(a){return f(a)?g(a):a}function f(b){return b instanceof a}function g(a){return a.get(0)}function h(b){return f(b)?b:a(b)}
function i(a){if(!a.$element)throw new Error("region.$element is null");a.$element.empty()}function j(){var a=document.createElement("div");return a.classList.add("region"),a}function k(b,c){a(b.activeContainer).append(c)}function l(a){if(m(a.element)){if(!a.$element)throw new Error("region.$element is null");a.$element.after(a.activeContainer)}else{if(!a.element)throw new Error("region.element is null");a.element.appendChild(a.activeContainer)}}function m(a){return!!a&&a.nodeType===b}function n(b){a(b.activeContainer).remove(),b.activeContainer=null}return c});

define('text!system/ui/views/dialog.html',[],function () { return '<div class="pattern pattern-dialog" >\r\n    <div class="dialog-opacity-style"></div>\r\n    <div class="dialog-wrapper">\r\n        <section class="title">\r\n            <div class="title-wrapper">\n                <div class="title-container" data-bind="text: title, attr: {title: title}"></div>\n            </div>\r\n            <span class="close-dialog icon-close-popup"\r\n            \tdata-bind="click: closeDialog, visible: showCloseIcon"></span>\r\n        </section>\r\n        <section class="content dialog-content"></section>\r\n    </div>\r\n</div>';});

define('system/ui/dialog-view-model',["require","exports","jquery","knockout","spa/conductor","spa/region","application/application-events","system/lang/object","text!./views/dialog.html"],function(require,exports,a,b,c,d,e,f){"use strict";var g=require("text!./views/dialog.html"),h=0,i=function(){function i(a,g,h){void 0===h&&(h=null),this.options=h,this.content=a,this.title=g,this.showHelp=b.observable(!0),this.showClose=b.observable(!0),this.showCloseIcon=b.observable(!1),this.showCheck=b.observable(!0),this.applicationEvents=f.resolve(e),this.dialogShellRegion=new d(null),this.dialogContentRegion=new d(null),this.$wrapper=null,this.conductor=f.resolve(c)}return i.prototype.show=function(){var c=document.createElement("div");document.body.appendChild(c),this.dialogShellRegion.setElement(c),this.dialogShellRegion.attach(a(g)),b.applyBindings(this,this.dialogShellRegion.activeContainer),this.$wrapper=this.dialogShellRegion.$element.find(".dialog-wrapper");var d=this.$wrapper.find(".dialog-content")
;if(this.dialogContentRegion.setElement(d),this.options?(this.options.height&&this.$wrapper.css("height",this.options.height),this.options.width&&this.$wrapper.css("width",this.options.width),this.options.noPadding?d.addClass("dialog-no-padding"):j(this,d)):j(this,d),this.options&&this.options.hasOwnProperty("closeIcon")){var e=this.options.closeIcon||!1;this.showCloseIcon(e)}h++,this.dialogShellRegion.$element.find(".dialog-opacity-style").css("z-index",h.toString()+"98"),this.dialogShellRegion.$element.find(".dialog-opacity-style").on("touchstart",m.bind(null)),this.$wrapper.css("z-index",h.toString()+"99"),this.conductor.changeScreen(this.content,this.dialogContentRegion),l(this),this.applicationEvents.windowResized.add(l,this,this),this.$wrapper.find("div.dialog-message-box div.btn.btn-primary").each(n.bind(null)),this.$wrapper.find(".okButtonClass").hover(o.bind(null,this),p.bind(null,this)),this.$wrapper.find(".cancelButtonClass").hover(o.bind(null,this),p.bind(null,this)),
q(this)},i.prototype.closeDialog=function(){r(this),k(this),h--},i.prototype.centerDialog=function(){l(this)},i.prototype.setContent=function(a){this.content=a,this.conductor.changeScreen(this.content,this.dialogContentRegion),l(this)},i}();function j(a,b){a.$wrapper.find(".title").addClass("title-with-padding"),b.addClass("dialog-with-padding")}function k(a){a.dialogShellRegion.$element.find(".dialog-opacity-style").off("touchstart"),a.conductor.clearScreen(a.dialogContentRegion),b.cleanNode(a.dialogShellRegion.activeContainer),a.dialogShellRegion.clear(),a.dialogShellRegion.$element.remove(),a.applicationEvents.windowResized.remove(a),a.applicationEvents.navigate.remove(a)}function l(b){var c,d,e,f,g,h;window.scrollTo(0,0),e=window.innerHeight?window.innerHeight:a(window).height(),f=window.innerWidth?window.innerWidth:a(window).width(),h=b.$wrapper.outerHeight(),g=b.$wrapper.outerWidth(),c=Math.max(0,(e-h)/2+a(window).scrollTop()),d=Math.max(0,(f-g)/2+a(window).scrollLeft()),
b.$wrapper.css("top",c+"px"),b.$wrapper.css("left",d+"px")}function m(a){a.preventDefault(),a.stopPropagation()}function n(b,c){var d=a(c);d.attr("tabindex",b+1),"OK"===d.text()&&(d.addClass("okButtonClass"),d.focus()),"Cancel"===d.text()&&d.addClass("cancelButtonClass")}function o(b){a(b).focus()}function p(b){a(b).blur()}function q(b){b.$wrapper.keydown(function(b){var c=a(b.currentTarget).find("input, select, textarea, button"),d=c.first(),e=c.last();9===(b.which||b.keyCode)&&(b.shiftKey&&d.length&&d.is(":focus")&&(b.preventDefault(),e.focus()),!b.shiftKey&&e.length&&e.is(":focus")&&(b.preventDefault(),d.focus()))})}function r(a){a.$wrapper.off("keydown")}return i});

define('text!system/ui/views/message-box.html',[],function () { return '<div class="dialog-message-box">\r\n    <div class="message-text-container">\r\n        <i class="message-icon" data-bind="css:icon"></i>\r\n        <div class="main-message" data-bind="html:message"></div>\r\n    </div>    \r\n    <section class="button-align message-box-button-container" data-bind="foreach: buttons">\r\n        <div class="btn btn-primary" data-bind="text: name,\r\n            css: $parent.buttonStyle,\r\n            event: { \'keydown\': $parent.buttonKeyDown.bind($parent) },\r\n            click: $parent.buttonClicked.bind($parent, $index())"></div>\r\n    </section>\r\n</div>';});

define('system/ui/message-box',["require","exports","jquery","system/lang/object","spa/knockout/knockout-view-model","system/knockout/knockout-manager","system/globalization/translator","system/ui/dialog-view-model","text!./views/message-box.html"],function(require,exports,a,b,c,d,e,f){"use strict";var g=require("text!./views/message-box.html"),h=9,i=13,j=function(c){__extends(j,c);function j(a,f,h,i){var j=c.call(this,g)||this;return j.kom=new d,j.message=a,j.title=f,j.buttons=j.kom.observableArray(h),j.icon=i||"icon-node-warning",j.dfd=null,j.dialog=null,j.translator=b.resolve(e),j.$element=null,j.buttonStyle=j.kom.pureComputed(k.bind(null,j)),j.canSave=!0,j}return j.show=function(a,b,c,d,e){return c=c||[{name:q("OK")}],new j(a,b,c,d).showMessage(e)},j.showOk=function(a,b,c){var d=[{name:q("OK")}];return j.show(a,b,d,c)},j.showOkCancel=function(a,b,c){var d=[{name:q("OK")},{name:q("CANCEL")}];return j.show(a,b,d,c)},j.showYesNo=function(a,b,c){var d=[{name:q("YES")},{name:q("NO")}];return j.show(a,b,d,c)},
j.showYesNoCancel=function(a,b,c){var d=[{name:q("YES")},{name:q("NO")},{name:q("CANCEL")}];return j.show(a,b,d,c)},j.showUnsavedChanges=function(a){var b=q("UNSAVED_CHANGES_DIALOG_TITLE"),c=q("UNSAVED_CHANGES_DIALOG_MESSAGE"),d=[{name:q("UNSAVED_CHANGES_DIALOG_DONT_SAVE_BTN")},{name:q("UNSAVED_CHANGES_DIALOG_SAVE_BTN")}],e={showCloseIcon:!0,buttonIndex:1,applyUnsavedChangesDialogStyling:!0,canSave:!0};return r(a)&&(e.canSave=!1,c=q("UNSAVED_CHANGES_DIALOG_NO_SAVE_MESSAGE"),d=[{name:q("UNSAVED_CHANGES_DIALOG_CONTINUE_BTN")},{name:q("UNSAVED_CHANGES_DIALOG_GO_BACK_BTN")}]),j.show(c,b,d,"",e)},j.prototype.showMessage=function(b){var c=!!b&&b.showCloseIcon,d=b?b.buttonIndex:0,e=!!b&&b.applyUnsavedChangesDialogStyling;return this.dialog=new f(this,this.title,{closeIcon:c}),this.dfd=a.Deferred(),this.dialog.show(),this.$element=this.dialog.$wrapper.find(".dialog-message-box"),l(this,e),m(this,d),c&&o(this),r(b)&&(this.canSave=!1),this.dfd},j.prototype.buttonClicked=function(a){
this.dialog.closeDialog(),1===a&&this.canSave===!1?s(this):this.dfd.resolve(a)},j.prototype.buttonKeyDown=function(b,c){var d=a(c.target),e=this.$element.find(".message-box-button-container > .btn");if(c.keyCode===i)return d.click(),!1;if(c.keyCode===h){if(d.is(":last-of-type")&&c.shiftKey===!1)return e.first().focus(),!1;if(d.is(":first-of-type")&&c.shiftKey===!0)return e.last().focus(),!1}return!0},j.prototype.unload=function(){this.kom.dispose()},j}(c);function k(a){var b=a.buttons().length;return 2===b?"two-buttons":3===b?"three-buttons":""}function l(a,b){var c=a.$element.parents(".dialog-content");c.addClass("message-box-content"),c.siblings(".title").addClass("message-box-title"),a.dialog.centerDialog(),b&&(c.removeClass("dialog-with-padding"),a.dialog.$wrapper.find(".title-wrapper").addClass("unsaved-dialog-title"),a.dialog.$wrapper.find("section.title").removeClass("title-with-padding"),a.$element.find(".main-message").addClass("message-with-padding"),
a.$element.find(".message-box-button-container").addClass("unsaved-dialog-button-container"))}function m(b,c){var d=b.$element.find(".message-box-button-container > .btn");d[c].focus(),1===c&&(a(d[c]).addClass("activeBtn"),d.on("mouseenter",n.bind(null,d)))}function n(b){a(b[1]).hasClass("activeBtn")&&(a(b[1]).removeClass("activeBtn"),b.off("mouseenter"))}function o(a){a.dialog.$wrapper.find(".icon-close-popup").on("click",p.bind(null,a))}function p(a){a.dfd.reject()}function q(a){return b.resolve(e).translate(a)}function r(a){return a&&void 0!==a.canSave&&null!==a.canSave&&"false"===a.canSave.toString().toLowerCase()}function s(a){p(a)}return j});
define('system/error-handler/error-handler',['require','lodash','jquery','text!./views/error-handler-view.html','system/ui/message-box','system/lang/event','system/globalization/translator'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./views/error-handler-view.html"),d=require("system/ui/message-box"),e=require("system/lang/event"),f=require("system/globalization/translator");function g(a,b){this.errorHandlerClosedEvent=new e,this.errorHandlerShowEvent=new e,this.translator=Object.resolve(f),this.init(a,b)}function h(a){a.currentErrorNumber=a.currentErrorNumber-1,a.updateView()}function i(a){a.currentErrorNumber=a.currentErrorNumber+1,a.updateView()}function j(a){d.showOk(a.errorArray[a.currentErrorNumber].longDesc,a.errorArray[a.currentErrorNumber].title,"fa fa-warning fa-2x")}function k(a){a.errorArray[a.currentErrorNumber].sourceCallBack()}return g.prototype.init=function a(d,e){d||(d=b("section.content-wrapper > section.content > div.region")),this.errorArray=e?e:[],this.currentErrorNumber=0,d.children("div.error-handler").remove(),0===d.children("div.error-handler").eq(0).length&&(d.prepend(c),
this.errorContainer=d.children("div.error-handler"),this.errorContainer.find("span.current-error-view-details").text(this.translate("VIEW_DETAILS")),this.errorContainer.find("span.go-to-source-link").text(this.translate("GO_TO_SOURCE")),this.errorContainer.find("span.current-error-text").text(this.translate("NOTIFICATION")),this.errorContainer.find("span.of-text").text(this.translate("OF")),this.errorContainer.find("i.previous").on("click",h.bind(null,this)),this.errorContainer.find("i.next").on("click",i.bind(null,this)),this.errorContainer.find("span.current-error-view-details").on("click",j.bind(null,this)),this.errorContainer.find("span.go-to-source-link").on("click",k.bind(null,this)),this.updateView())},g.prototype.showErrorHandler=function a(){this.errorContainer.show(),this.errorContainer.siblings().height("calc(100% - "+this.errorContainer.outerHeight()+"px)"),this.errorHandlerShowEvent.raise(this.errorContainer.outerHeight())},g.prototype.hideErrorHandler=function a(){
this.errorContainer.hide(),this.errorContainer.siblings().height("100%"),this.errorHandlerClosedEvent.raise(this.errorContainer.outerHeight())},g.prototype.addError=function a(b){this.errorArray.push(b),this.updateView()},g.prototype.removeError=function a(b){var c="object"==typeof b?this.errorArray.indexOf(b):b;this.errorArray.splice(c,1),this.errorArray.length===this.currentErrorNumber&&this.errorArray.length>0&&(this.currentErrorNumber=this.errorArray.length-1),this.updateView()},g.prototype.updateView=function b(c,d){var e;if(!(this.errorArray.length>0))return this.hideErrorHandler(),"No error to show";e=this.errorArray[this.currentErrorNumber]||null,this.showErrorHandler(),0===this.currentErrorNumber?this.errorContainer.find("i.previous").css("visibility","hidden"):this.errorContainer.find("i.previous").css("visibility","visible"),
this.currentErrorNumber===this.errorArray.length-1?this.errorContainer.find("i.next").css("visibility","hidden"):this.errorContainer.find("i.next").css("visibility","visible"),this.errorContainer.removeClass("error warning info").addClass(e.severity),this.errorContainer.find("span.current-error").text(e.title),this.errorContainer.find("span.current-error-number").text(this.currentErrorNumber+1),this.errorContainer.find("span.total-errors").text(this.errorArray.length),this.errorContainer.find(".current-error-view-details").css("display",e.longDesc?"inline":"none"),this.errorContainer.find(".go-to-source-link").css("display",a.isFunction(e.sourceCallBack)?"inline":"none"),this.handleDivider()},g.prototype.getTotalErrors=function b(c){return c?a.filter(this.errorArray,function(a){return a.severity===c}).length:this.errorArray.length},g.prototype.handleDivider=function a(b){
this.errorContainer.find(".current-error-view-details").is(":hidden")||this.errorContainer.find(".go-to-source-link").is(":hidden")?this.errorContainer.find("span.vert-line").hide():this.errorContainer.find("span.vert-line").show()},g.prototype.translate=function a(b){return this.translator.translate(b)},g});
define('system/knockout/knockout-helpers',['require','ramda','jquery','system/lang/object','knockout','xss','system/globalization/translator','system/error-handler/error-handler','system/text/parser','system/lang/functional','system/text/formatter','jquery-ui'],function(require){"use strict";var a=require("ramda"),b=require("jquery");require("system/lang/object");var c=require("knockout"),d=require("xss"),e=Object.resolve(require("system/globalization/translator")),f=require("system/error-handler/error-handler"),g=require("system/text/parser"),h=require("system/lang/functional"),i=require("system/text/formatter");require("jquery-ui");function j(a,d){c.bindingHandlers[a]={init:function(e,f,g,h){var i=new d(e,f,g,h);return b(e).data(a+"-binding",i),c.utils.domNodeDisposal.addDisposeCallback(e,function(){var c=b(e).data(a+"-binding");c.dispose&&c.dispose(e),b(e).removeData(a+"-binding")}),i.init&&i.init(e,f,g,h),c.applyBindingsToDescendants(i,e),{controlsDescendantBindings:!0}},update:function(c,d,e,f){var g=b(c).data(a+"-binding");g.update&&g.update(c,d,e,f)}}}c.appendTemplateScript=function(a,c){var d=b.Deferred();return document.getElementById(a)?d.resolve():b.ajax({url:c,dataType:"html"}).done(function(c){
var e=b("<script>").attr("id",a).attr("type","text/html").html(c);b("body").append(e),d.resolve()}),d.promise()},c.bindingHandlers.jqIconButton={init:function(a,d){var e=d(),f=c.unwrap(e.icon),g=c.unwrap(e.text),h=Object.defaultValue(c.unwrap(e.enabled),!0);f&&b(a).html('<i class="'+f+'"></i>')},update:function(a,d){var e=d(),f=c.unwrap(e.enabled),g=f?1:.5;b(a).find("i").css("opacity",g)}},c.bindingHandlers.toolTip={init:function(a,c){b(a).tooltip({content:c(),html:!0})},update:function(a,c){b(a).tooltip({content:c(),html:!0,tooltipClass:"datasheet-tooltip"})}},c.bindingHandlers.jqButton={init:function(a,d){var e=d(),f=c.unwrap(e.label),g=Object.defaultValue(c.unwrap(e.enabled),!0),h=c.unwrap(e.title);b(a).attr("title",h).button({disabled:!g}),e.label&&b(a).button("option","label",f)},update:function(a,d){var e=d(),f=c.unwrap(e.label),g=c.unwrap(e.enabled),h=c.unwrap(e.title);b(a).attr("title",h).button("option","disabled",g===!1),e.label&&b(a).button("option","label",f),
e.primaryIcon&&e.secondaryIcon?b(a).button("option","icons",{primary:e.primaryIcon,secondary:e.secondaryIcon}):e.primaryIcon&&b(a).button("option","icons",{primary:e.primaryIcon})}},c.bindingHandlers.localText={init:function(a,d){var f=c.utils.unwrapObservable(d());b(a).text(e.translate(f))},update:function(a,d){var f=c.utils.unwrapObservable(d());b(a).text(e.translate(f))}},c.bindingHandlers.localTitle={init:function(a,b){var d=c.utils.unwrapObservable(b());a.title=e.translate(d)},update:function(a,b){var d=c.utils.unwrapObservable(b());a.title=e.translate(d)}},c.bindingHandlers.xssHtml={update:function(a,e){var f=c.unwrap(e());b(a).html(d(f))}},c.bindingHandlers.required={init:function(a,d){c.unwrap(d())?b(a).attr("required","required"):b(a).removeAttr("required")},update:function(a,d){c.unwrap(d())?b(a).attr("required","required"):b(a).removeAttr("required")}},c.bindingHandlers.slide={init:function(a,d){var e=d(),f=c.unwrap(e.visible),g=c.unwrap(e.duration||"fast")
;f?b(a).slideDown(g):b(a).hide()},update:function(a,d){var e=d(),f=c.unwrap(e.visible),g=c.unwrap(e.duration||"fast");f?b(a).slideDown(g):b(a).slideUp(g)}},c.bindingHandlers.fade={init:function(a,d){var e=d(),f=c.unwrap(e.visible),g=c.unwrap(e.duration||"fast");f?b(a).fadeIn(g):b(a).hide()},update:function(a,d){var e=d(),f=c.unwrap(e.visible),g=c.unwrap(e.duration||"fast");f?b(a).fadeIn(g):b(a).fadeOut(g)}},c.utils.setOptionNodeSelectionState=function(a,b){navigator.userAgent.indexOf("MSIE 6")>=0?a.setAttribute("selected",b):a.selected=b},c.bindingHandlers.groupedOptions=function(){function a(a,f,g){var h,i,j;b(a);var k=[];for(h=0;h<a.childNodes.length;h++){var l=a.childNodes[h];if("OPTGROUP"===l.tagName){if(void 0!==l.childNodes)for(var m=0;m<l.childNodes.length;m++){var n=l.childNodes[m];n.tagName&&"OPTION"===n.tagName&&n.selected&&k.push(c.selectExtensions.readValue(n))}}else l.tagName&&"OPTION"===l.tagName&&l.selected&&k.push(c.selectExtensions.readValue(l))}
var o=a.scrollTop,p=c.utils.unwrapObservable(f());if(a.innerHTML="",p){var q=g();"number"!=typeof p.length&&(p=[p]),q.optionsCaption&&(j=document.createElement("OPTION"),j.innerHTML=q.optionsCaption,c.selectExtensions.writeValue(j,void 0),a.appendChild(j));var r=[],s=q.optionsGroup;for(h=0,i=p.length;h<i;h++){var t="";"function"==typeof s?t=s(p[h]):"string"==typeof s&&(t=c.utils.unwrapObservable(p[h][s])),t=t||"",void 0===r[t]&&(r[t]=[]),r[t].push(p[h])}for(var u in r)if(r.hasOwnProperty(u)){var v=null;for(""!==u&&(v=document.createElement("OPTGROUP"),v.label=u,a.appendChild(v)),h=0,i=r[u].length;h<i;h++){var w=r[u],x="string"==typeof q.optionsValue?w[h][q.optionsValue]:w[h],y=x;j=document.createElement("OPTION");var z=q.optionsText;"function"==typeof z?y=z(w[h]):"string"==typeof z&&(y=w[h][z]),x=c.utils.unwrapObservable(x),y=c.utils.unwrapObservable(y),c.selectExtensions.writeValue(j,x),j.innerHTML=y.toString(),null!==v?v.appendChild(j):a.appendChild(j)}}d(a,k),e(a,o)}}function b(a){
if("SELECT"!==a.tagName)throw new Error("groupedOptions binding applies only to SELECT elements")}function d(a,b){var d,e,f=a.getElementsByTagName("OPTION"),g=0;for(d=0,e=f.length;d<e;d++)c.utils.arrayIndexOf(b,c.selectExtensions.readValue(f[d]))>=0&&(c.utils.setOptionNodeSelectionState(f[d],!0),g++)}function e(a,b){b&&(a.scrollTop=b)}return{update:a}}(),c.extenders.validate=function(a,d){var g,h,i,j,k,l,m,n;b.isFunction(d)?g=d:(g=d.validationCallback,h=d.errorLevel,i=d.title,j=d.message,k=d.gotoCallback,l=d.controlSelector,m=d.errorHandler||Object.resolve(f),n=d.useValidationBar!==!0&&d.useValidationBar!==!1||d.useValidationBar),a.invalid=c.computed(function(){return a(),!g(a())}),a.validationError=void 0;function o(){n===!0&&(a.invalid()?a.validationError||(a.validationError={title:c.unwrap(i||e.translate("VALIDATION_ERROR")),longDesc:c.unwrap(j||void 0),severity:c.unwrap(h||"error"),sourceCallBack:k},
m.addError(a.validationError)):a.validationError&&(m.removeError(a.validationError),a.validationError=void 0))}return a.validationSubscription=a.invalid.subscribe(o),o(),a.dispose=function(){a.validationSubscription.dispose(),a.invalid.dispose(),n&&a.validationError&&(m.removeError(a.validationError),a.validationError=void 0)},a},c.extenders.preventChange=function(a,b){return c.computed({read:a,write:function(c){var d=a(),e=b.call(this,d,c);e!==!0&&e!==!1&&void 0!==e&&e.done?e.done(function(){a(c)}):e===!0&&a(c)}})},c.extenders.trackLastValue=function(a,b){var d=c.observable(b),e=c.computed({read:a,write:function(b){d(a()),a(b)}});return e.lastValue=d,e(a()),e},c.extenders.forceNumeric=function(a){var b=c.pureComputed({read:a,write:function(b){var c=a(),d,e;d=null===b||""===b||isNaN(b)?null:parseFloat(b),e=d,e!==c?a(e):b!==c&&a.notifySubscribers(e)}}).extend({notify:"always"});return b(a()),b},c.observableArray.fn.trackHasOneItem=function(){return this.hasOneItem=c.observable(),
this.subscribe(function(a){this.hasOneItem(!(!a||1!==a.length))},this),this.valueHasMutated(),this},c.observableArray.fn.trackHasItems=function(){return this.hasItems=c.observable(),this.subscribe(function(a){this.hasItems(!(!a||!a.length))},this),this.valueHasMutated(),this};var k=-1;function l(a,b){var d=this;k++,d.namespace=".combo-box-"+k,d.accessor=b(),d.optionsText=s(d.accessor.optionsText,null),d.value=s(d.accessor.value()),d.inputValue=c.observable(p(d,d.accessor.value())),d.options=s(d.accessor.options,[]),d.multiselect=!1,d.selectedOptions=s(d.accessor.selectedOptions,d.multiselect?[]:[d.value]),d.allowUnmatched=!1,d.allowNull=s(d.accessor.allowNull,!1),d.separator=s(d.accessor.separator,", "),d.allowUnmatched&&(d.multiselect=!1),d.maxOptions=s(d.accessor.maxOptions,"-1"),d.isListOpen=!1,d.updatingValueBinding=!1}l.prototype.init=function(a,d,e,f){var g=this;m(g,a,e,f),n(g,a),o(g),c.isObservable(g.accessor.value)&&(g.valueSubscription=g.accessor.value.subscribe(function(){
if(g.updatingValueBinding)return void(g.updatingValueBinding=!1);g.refresh()})),c.isObservable(g.accessor.options)&&(g.optionsSubscription=g.accessor.options.subscribe(function(){g.options=g.accessor.options()})),b(window).on("click"+g.namespace,a,r.bind(null,g))},l.prototype.dispose=function(a){var c=this;c.disableSubscription&&c.disableSubscription.dispose(),c.valueSubscription&&c.valueSubscription.dispose(),c.optionsSubscription&&c.optionsSubscription.dispose(),b(window).off(c.namespace),b(a).off(),b(a).empty(),b(a).parents(".mi-ui-scroll-y").off(c.namespace),b("body").off(c.namespace)},l.prototype.close=function(){var a=this;a.input.autocomplete("close"),a.isListOpen=!1},l.prototype.refresh=function(){var a=this;a.select(s(a.accessor.value()))},l.prototype.select=function(b){var c=this;c.value=b,c.selectedOptions.length>0&&!a.contains(c.Value,c.selectedOptions)&&c.selectedOptions.pop(),c.selectedOptions.push(c.value),c.inputValue(p(c,c.value))},l.prototype.buttonOnClick=function(){
var a=this;a.input.focus(),a.isListOpen?a.isListOpen=!1:(a.input.autocomplete("search",""),event.stopImmediatePropagation())};function m(a,d,e){d=b(d),a.inputAttrs={},e().attr&&e().attr.input&&(a.inputAttrs=e().attr.input),d.empty(),d.addClass("mi-ui-combo-box"),a.input=b('<input class="form-control" style="border-width:0px;height:20px" data-bind="value: inputValue, valueUpdate: \'input\', disable: accessor.disable, attr: inputAttrs" style="width: 100%">').appendTo(d);var f=b('<i class="input-group-addon icon-arrow" style="padding:0 10px 0 0" data-bind="click: buttonOnClick" tabindex="-1"/>').appendTo(d).button({disabled:s(a.accessor.disable)});f.removeClass("ui-widget ui-state-default ui-corner-all ui-button-disabled ui-state-disabled ui-button-text-only"),c.isObservable(a.accessor.disable)&&(a.disableSubscription=a.accessor.disable.subscribe(function(){f.button("option","disabled",a.accessor.disable())})),a.input.on("keydown",function(c){
c.keyCode===b.ui.keyCode.ESCAPE&&h.defer(function(){a.refresh(),a.isListOpen=!1})}),d.parents(".mi-ui-scroll-y").on("scroll"+a.namespace,a.close.bind(a)),b("body").on("scroll"+a.namespace,a.close.bind(a))}function n(c){function d(a,d){var e=!a.term,f=new RegExp(b.ui.autocomplete.escapeRegex(a.term),"i"),g=[];b.each(c.options,function(d,h){var i=p(c,h);if((e||f.test(i))&&(g.push({label:i.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.ui.autocomplete.escapeRegex(a.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"),value:i,option:h}),c.maxOptions!==-1&&g.length>=c.maxOptions))return!1}),d(g)}function e(a,d){a.keyCode!==b.ui.keyCode.TAB&&(c.isListOpen=!1,c.select(d.item.option),q(c))}function f(a,d){if(!d.item){var e=new RegExp("^"+b.ui.autocomplete.escapeRegex(c.inputValue())+"$","i"),f=!1;b.each(c.options,function(a,b){var d=p(c,b);if(e.test(d))return c.select(b),c.inputValue(d),f=!0,!1}),f||(c.allowUnmatched?c.select(c.inputValue()):c.select(c.value)),q(c)}}function g(){
c.isListOpen=!0}function h(){c.multiselect&&q(c)}function i(a,c){var d=b("<li>").appendTo(a).data("item.autocomplete",c);return j(d,c),d}function j(d,e){var f=b("<a>").appendTo(d).html(e.label).mouseover(e,k).mouseout(e,l);a.contains(e.option,c.selectedOptions)&&f.addClass("ui-state-highlight")}function k(d){a.contains(d.data.option,c.selectedOptions)&&b(d.currentTarget).removeClass("ui-state-highlight")}function l(d){a.contains(d.data.option,c.selectedOptions)&&b(d.currentTarget).addClass("ui-state-highlight")}c.input.autocomplete({appendTo:b("body"),delay:0,minLength:0,autoFocus:c.accessor.autoFocus,position:{my:"left top",at:"left bottom",collision:"flip"},source:d,select:e,change:f,open:g,close:h}),c.input.data("autocomplete").menu.element.addClass("mi-ui-combo-box"),c.input.data("autocomplete")._renderItem=i}function o(a){var b=null!==a.value,c=0===a.selectedOptions.length,d=a.options.length>0;!b&&c&&d&&!a.allowNull?(a.select(a.options[0]),q(a)):b&&a.select(a.value)}
function p(c,d){function e(a){return b.map(a,function(a){return p(c,a)}).join(c.separator)}function f(b){return b?c.allowUnmatched&&!a.contains(b,c.options)?b:c.optionsText?s(b[c.optionsText],"").toString():b.toString():""}return b.isArray(d)?e(d):f(d)}function q(a){c.isObservable(a.accessor.value)&&(a.updatingValueBinding=!0,a.accessor.value(a.value)),c.isObservable(a.accessor.selectedOptions)&&a.accessor.selectedOptions(a.selectedOptions)}function r(a,c){var d=c.data;b.contains(d,c.srcElement)||a.close()}function s(a,c){return(b.isFunction(a)?a():a)||c}j("combo-box",l),c.bindingHandlers.sort={init:function(a,c){var d=!1;a.style.cursor="pointer",a.onclick=function(){var a=c(),e=a.prop,f=a.arr;d?(b(this).parent().find(".icon-up-arrow, .icon-arrow").remove(),b(this).append('<div class="icon-arrow" style="float: right;"></div>')):(b(this).parent().find(".icon-up-arrow, .icon-arrow").remove(),b(this).append('<div class="icon-up-arrow" style="float: right;"></div>')),d=!d,
f.sort(function(a,b){var c=a,f=b;d||(c=b,f=a);var g=e.split(".");for(var h in g)if(g.hasOwnProperty(h)){var i=g[h],j=i.indexOf("()");j>0?(i=i.substring(0,j),c=c[i](),f=f[i]()):(c=c[i],f=f[i])}return c===f?0:c<f?-1:1})}}},c.bindingHandlers.datetime={init:function(a,d){a=b(a);var e=d(),f=c.unwrap(Object.defaultValue(e.ampm,!1)),g=c.unwrap(Object.defaultValue(e.format,"hh:mm:ss")),h=c.unwrap(Object.defaultValue(e.showHour,!0)),i=c.unwrap(Object.defaultValue(e.showMinute,!0)),j=c.unwrap(Object.defaultValue(e.showSecond,!0)),k=c.unwrap(Object.defaultValue(e.showMillisec,!1)),l=c.unwrap(Object.defaultValue(e.stepHour,.25)),m=c.unwrap(Object.defaultValue(e.stepMinute,.25)),n=c.unwrap(Object.defaultValue(e.stepSecond,.25)),o=c.unwrap(Object.defaultValue(e.stepMillisec,.5)),p={ampm:f,timeFormat:g,showHour:h,showMinute:i,showSecond:j,showMillisec:k,stepHour:l,stepMinute:m,stepSecond:n,stepMillisec:o};a.datetimepicker(p)}};function t(a,d,e){
var f=d(),g=c.utils.unwrapObservable(f),h=e(),j=c.utils.unwrapObservable(h.dataType),k,l=h.exponentMin||null,m=h.exponentMax||null,n=b(a),o=n.is(":focus"),p=Object.resolve(i),q;switch(j){case"integer":case"I":k=h.integerFormat,o&&h.integerFormatEdit&&(k=h.integerFormatEdit);break;case"decimal":case"N":k=h.decimalFormat,o&&h.decimalFormatEdit&&(k=h.decimalFormatEdit);break;case"dateTime":case"D":k=h.dateTimeFormat,o&&h.dateTimeFormatEdit&&(k=h.dateTimeFormatEdit);break;case"currency":case"C":k=h.currencyFormat,o&&h.currencyFormatEdit&&(k=h.currencyFormatEdit);break;default:k=h.integerFormat||h.decimalFormat||h.dateTimeFormat||h.currencyFormat}k=u(k,l,m,x(g)),q=p.format(x(g),k),n.val(q),n.text(q)}function u(a,b,c,d){return null===b||null===c?a:(v(a)&&w(b,c,d)&&(a=a.replace("e","")),a)}function v(a){return a=a||"",a.indexOf("e")>-1}function w(a,b,c){var d=Math.abs(c);return a=x(Math.abs(a)||0),b=x(Math.abs(b)||0),0===c||a<d&&d<b}function x(a){return isNaN(a)||""===a?a:parseFloat(a)}
c.bindingHandlers.formattedValue={init:function(a,d,e){if(c.isObservable(d())){var f=e(),h=f.valueUpdate||"change",i=b(a);i.on(h,function(){var a=d(),b=c.utils.unwrapObservable(f.dataType),e=i.val();if(b||(f.integerFormat?b="integer":f.decimalFormat?b="decimal":f.dateTimeFormat?b="dateTime":f.currencyFormat&&(b="currency")),""!==e)switch(b){case"integer":case"I":var h=g.parseInt(e);isNaN(h)||(e=h);break;case"decimal":case"N":case"currency":case"C":var j=g.parseFloat(e);isNaN(j)||(e=j);break;case"dateTime":case"D":e=g.parseDate(e)}a(e)}),c.utils.domNodeDisposal.addDisposeCallback(i,function(){b(i).off()}),i.focusin(function(){c.bindingHandlers.formattedValue.updateFormat(a,d,e)}),i.focusout(function(){c.bindingHandlers.formattedValue.updateFormat(a,d,e)})}},update:function(a,d,e){var f=e(),g="INPUT"===a.nodeName,h=Object.defaultValue(f.formatOnce,g),i=b(a);h&&i.val()||c.bindingHandlers.formattedValue.updateFormat(a,d,e)},updateFormat:t}});

define('text!ui/elements/checkbox/checkbox-template.html',[],function () { return '<script id="mi-checkbox-tmpl" type="text/html">\r\n    <div class="checkbox-container">\r\n        <input type="checkbox" data-bind="checked: $root.checked,disable: $root.disable,value:$root.value, attr:{id:$data.id, required: $root.required}, checkedValue: $root.checkedValue " />\r\n        <label data-bind="attr:{for:$data.id}">\r\n            <span class="checkbox-label" ></span>\r\n            <span class="chkbox-text" data-bind="text:$root.text"></span>\r\n        </label>       \r\n    </div>\r\n</script>';});

define('ui/elements/checkbox/checkbox-view-model',['require','lodash','jquery','text!./checkbox-template.html','knockout'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./checkbox-template.html"),d=require("knockout");d.bindingHandlers.miCheckboxProperty={createNodes:function(a,b){document.getElementById("mi-checkbox-tmpl")||document.body.insertAdjacentHTML("beforeend",c),d.applyBindingsToNode(a,{template:{name:"mi-checkbox-tmpl"}},b)},init:function(a,c){var e=c();return e.id=d.bindingHandlers.miCheckboxProperty.getGuid(),e.textClick=function a(c,d){if(this.disable)return!1;"function"==typeof this.checked?this.checked(!this.checked()):"boolean"==typeof this.checked&&(b(d.target).parent().find("input").prop("checked",!this.checked),this.checked=!this.checked)},d.bindingHandlers.miCheckboxProperty.createNodes(a,e),{controlsDescendantBindings:!0}},getGuid:function a(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},s4:function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},
update:function(c,e){var f,g=b(c).find('input[type="checkbox"]');a.each(e(),function(a,e){f=d.unwrap(a),"disable"===e?g.prop("disabled",f):"checked"===e?f!==!0&&f!==!1||g.prop("checked",f):"text"===e&&b(c).find(".chkbox-text").html(f)})}};var e=Object.create(HTMLElement.prototype);document.registerElement("mi-checkbox",{prototype:e})});
define('platform/datasheets/layout/ui/layout-element-view-model',['require','jquery','knockout','text!./layout-element-template-map.json','system/globalization/translator','system/knockout/knockout-helpers','ui/elements/checkbox/checkbox-view-model'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("text!./layout-element-template-map.json"),d=require("system/globalization/translator");require("system/knockout/knockout-helpers"),require("ui/elements/checkbox/checkbox-view-model");function e(i,j){var k=JSON.parse(c),l,m=this;i=i||{},this.clientGuid=h(),this.translator=Object.resolve(d),this.controlName=i.controlName,this.name=i.name,this.parentName=i.parentName,this.type=i.type,this.visible=i.visible,this.caption=i.caption,this.captionVisible=i.captionVisible,this.captionPosition=i.captionPosition,this.row=i.location().row(),this.isHidden=b.observable(!1),l=a.map(i.children(),function(a){return new e(a,m)}),this.children=b.observableArray(l),this.size=i.size,this.location=i.location,this.captionSize=i.captionSize,this.mappedRows=b.computed(g.bind(null,this)),this.viewTemplate=b.observable(k[this.type()]||"layout-element-template"),this.controlTemplate=b.observable(),
this.fieldValue=b.observable(),this.isDatasheetReadOnly=b.observable(!0),this.elementCss=b.observable("form-control"),this.fontColorCss=b.observable("ds-enabled-fontColor"),this.headerCss=b.observable("ds-group-header-enabled"),this.parentElement=j,this.isParentControlVisible=b.computed(f.bind(null,this))}e.prototype.translate=function a(b){return this.translator.translate(b)},e.prototype.getChildViewTemplate=function a(b){return b.viewTemplate()},e.prototype.autoGrow=function a(b,c){c.currentTarget.scrollHeight>100?(c.currentTarget.style.overflow="auto",c.currentTarget.style.height="100px"):(c.currentTarget.style.height="45px",c.currentTarget.style.overflow="hidden",c.currentTarget.style.height=c.currentTarget.scrollHeight+"px")};function f(a){return null===a.isHidden()||!a.parentElement||!a.parentElement.children||2!==a.parentElement.children().length||(a.parentElement.isHidden(a.isHidden()),!1)}function g(a){
for(var b=a.children(),c={},d=0;d<b.length;d++)c[b[d].row]?c[b[d].row].push(b[d]):c[b[d].row]=[b[d]];return c}function h(){return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()}function i(){for(var a="",b="abcdefghijklmnopqrstuvwxyz",c=0;c<4;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}return e});
define('system/hardware/device',["require","exports","detect"],function(require,exports){"use strict";var a=require("detect");return function(){function b(b){this.userAgent=b||navigator.userAgent,this.parsedUserAgent=a.parse(this.userAgent)}return b.prototype.isMobile=function(){return this.isMobileApp()},b.prototype.isMobileApp=function(){return void 0!==window.cordova},b.prototype.isWindowsApp=function(){return!!window.MSApp},b.prototype.isAndroid=function(){return/Android/i.test(this.userAgent)},b.prototype.isIOS=function(){return/iPhone|iPad|iPod/i.test(this.userAgent)},b.prototype.isIE=function(){return/Trident/i.test(this.userAgent)&&!/MSIE/i.test(this.userAgent)},b.prototype.isEdge=function(){return/EDGE/i.test(this.userAgent)},b.prototype.isChromeOnAndroid=function(){return!!this.canReadBrowserAndOS()&&("CHROME"===this.parsedUserAgent.browser.family.toUpperCase()&&"ANDROID"===this.parsedUserAgent.os.family.toUpperCase())},b.prototype.canReadBrowserAndOS=function(){
return!(!this.parsedUserAgent.browser.family||!this.parsedUserAgent.os.family)},b.prototype.innerWidth=function(){return window.innerWidth},b.prototype.outerWidth=function(){return window.outerWidth},b.prototype.screenWidth=function(){return window.screen.width},b.prototype.innerHeight=function(){return window.innerHeight},b.prototype.pixelRatio=function(){return window.devicePixelRatio},b.prototype.deviceInnerWidth=function(){return this.roundUp(this.innerWidth()*this.pixelRatio())},b.prototype.roundUp=function(a){return Math.ceil(a)},b.prototype.deviceOuterWidth=function(){return this.roundUp(this.outerWidth()*this.pixelRatio())},b.prototype.deviceScreenWidth=function(){return this.roundUp(this.screenWidth()*this.pixelRatio())},b.prototype.isChrome=function(){return/Chrome/i.test(this.userAgent)},b}()});
define('system/mobile/device-connectivity',["require","exports","system/lang/ioc","system/lang/ioc","system/lang/ioc","application/application-events","bluebird","ramda"],function(require,exports,a,b,c,d,e,f){"use strict";var g=function(){function a(){this.userSetToOffline=!1,this.applicationEvents=c.resolve(d)}return a.prototype.getManualOfflineStatus=function(){return this.userSetToOffline},a.prototype.setManualOfflineStatus=function(a){this.userSetToOffline=a,this.hasPredixSDKInstalled()?this.queryConnectivity().catch(this.handleConnectivityFailure.bind(null,this)).then(this.handleConnectivityResponse.bind(null,this)):this.applicationEvents.connectionChanged.raise(this,{connected:!this.userSetToOffline})},a.prototype.hasPredixSDKInstalled=function(){return!!window.PredixSDK},a.prototype.queryConnectivity=function(){return new e(function(a,b){window.PredixSDK.queryConnectivity(a,b)})},a.prototype.handleConnectivityResponse=function(a,b){var c=window;a.deviceIsOnline(b)&&(b=a.resetConnectivityWithToggle(a,b)),
c.broadcaster.fireEvent("PredixSDK.ReachabilityChanged",{ReachabilityStatus:b})},a.prototype.deviceIsOnline=function(a){return f.contains("Online",a)},a.prototype.resetConnectivityWithToggle=function(a,b){b=a.getStateAsArray(b);var c=f.indexOf("Online",b);return a.userSetToOffline===!0&&(b[c]="Offline"),b},a.prototype.getStateAsArray=function(a){return"string"==typeof a&&(a=a.split(",")),a},a.prototype.handleConnectivityFailure=function(a){console.log("An error occurred")},a}();return g=__decorate([a.singleton,b.dependsOn(d)],g)});
define('system/http/predix-mobile-ajax-client',["require","exports","system/diagnostics/log-manager","application/application-context","system/mobile/device-connectivity","system/lang/object","ramda"],function(require,exports,a,b,c,d,e){"use strict";var f=a.getLogger("system/http/ajax-client"),g=59900,h={timeout:g,headers:{"Content-Type":"application/json",timeout:g}},i="apm",j="api/core/utility/unauthorizedping",k="",l=function(){function a(){}return a.prototype.baseUrl=function(){return k+i+"/"},a.useSecureConnection=function(a){},a.setServer=function(a){k=a},a.addAjaxOption=function(a,b){var c={};c[a]=b,$.extend(h,c)},a.clearHeaders=function(){},a.prototype.url=function(a){return a=this.trimSlash(a),a=k+i+"/"+a,a=encodeURI(decodeURI(a))},a.prototype.get=function(a,b){return f.info("ajax GET",a),a=this.url(a),m("GET","text",b,{},a)},a.prototype.post=function(a,b,c){return f.info("ajax POST",b,c),a=this.url(a),m("POST","text",c,b,a)},a.prototype.put=function(a,b,c){return f.info("ajax PUT",b,c),a=this.url(a),
m("PUT","text",c,b,a)},a.prototype.delete=function(a,b){return f.info("ajax DELETE",a),a=this.url(a),m("DELETE","text",b,{},a)},a.prototype.getBinary=function(a,b){return f.info("ajax binary GET",a),a=this.url(a),m("GET","blob",b,{},a)},a.isMultiTenant=function(){return!!window.nav},a.prototype.trimSlash=function(a){return a&&"/"===a.charAt(0)&&(a=a.substring(0).slice(1)),a},a}();function m(a,b,f,g,i){var j=$.extend(!0,{},h,f),k=$.Deferred(),l=window,m=new l.PredixRequest(a,i),p=d.resolve(c);return m.responseType=b,q(m,j),m.onComplete=x.bind(null,k.resolve.bind(k),k.reject.bind(k),a,i),m.onError=y.bind(null,k.reject.bind(k),i),m.beforeSend=o(m,p.getManualOfflineStatus()),"GET"===a?m.send():f&&!e.isNil(f.data)?m.send(f.data):m.send(g),n(k,m)}function n(a,b){var c=a.promise();return c.abort=b.abort,c}function o(a,b){return b?p.bind(null,a):null}function p(a){console.log("Aborting"),a.abort(),a.onComplete({statusCode:-1,error:"error"})}function q(a,b){
e.mapObjIndexed(r.bind(null,a),b.headers)}function r(a,b,c){a.setRequestHeader(c,b)}function s(a){return a>=200&&a<300||304===a}function t(a,b,c,d){if(null===b.data||""===b.data)try{c(null,null,a)}catch(a){console.log("error from success callback for url: "+d),console.log("response: "+JSON.stringify(b)),console.log("error: "+a)}else if("string"==typeof b.data)try{c(JSON.parse(b.data),null,a)}catch(a){console.log("error from success callback for url: "+d),console.log("response: "+JSON.stringify(b)),console.log("error: "+a)}else try{c(b.data,null,a)}catch(c){console.log("error from success callback for url: "+d),console.log("response: "+JSON.stringify(b),null,a),console.log("error: "+c)}}function u(a,b,c,d){var e="error";try{console.log("====jqXHR: "+JSON.stringify(a)),console.log("====text: "+e),console.log("====Error thrown "+d+" === "+b),c(a,e,b)}catch(a){console.log("error from fail callback for url: "+d),console.log("error: "+a)}}function v(a){
w(a,j)||(b.connectionStatus.lastResponse=new Date)}function w(a,b){return a.indexOf(b)>-1}function x(a,b,c,d,e){console.log("====SUCCESS "+c+" RESPONSE FROM URL: "+d+" === "+e.data),v(d);var f=s(e.statusCode),g={status:e.statusCode};f===!0?t(g,e,a,d):u(g,e.data,b,d)}function y(a,b,c){console.log("====FAIL RESPONSE FROM URL: "+b+" === "+JSON.stringify(c)),u({status:c.statusCode,statusText:c.error},c.error,a,b)}return l});
define('system/http/binary-transport',['require','jquery'],function(require){"use strict";require("jquery").ajaxTransport("+binary",function(a,b,c){if(window.FormData&&(a.dataType&&"binary"===a.dataType||a.data&&(window.ArrayBuffer&&a.data instanceof ArrayBuffer||window.Blob&&a.data instanceof Blob)))return{send:function(b,c){var d=new XMLHttpRequest,e=a.url,f=a.type,g=a.async||!0,h=a.responseType||"blob",i=a.data||null,j=a.username||null,k=a.password||null;d.addEventListener("load",function(){var b={};b[a.dataType]=d.response,c(d.status,d.statusText,b,d.getAllResponseHeaders())}),d.open(f,e,g,j,k);for(var l in b)b.hasOwnProperty(l)&&d.setRequestHeader(l,b[l]);d.responseType=h,d.send(i)},abort:function(){c.abort()}}})});
define('system/http/ajax-client',["require","exports","lodash","jquery","system/lang/ioc","application/application-events","system/diagnostics/log-manager","system/hardware/device","system/mobile/device-connectivity","system/http/predix-mobile-ajax-client","system/lang/object","./binary-transport"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";require("./binary-transport");var j=k()?59900:3e5;function k(){return!!window.nav}var l=e.getLogger("system/http/ajax-client"),m={contentType:"application/json",dataType:"json",cache:!0,timeout:j,headers:{timeout:j}},n={useSecureConnection:"https:"===location.protocol,server:null},o=function(){function c(){}return c.useSecureConnection=function(a){n.useSecureConnection=a,l.info("connectionOptions.useSecureConnection",a)},c.setServer=function(a){c.useSecureConnection(r(a)),a=v(a),a=w(a),n.server=a,l.info("connectionOptions.server",a)},c.server=function(){return n.server},c.secureConnection=function(){return n.useSecureConnection},c.addHeader=function(a,c){
var d={};d[a]=c,m.headers=m.headers||{},b.extend(m.headers,d),l.info("adding to ajaxOptions.headers",a,c)},c.clearHeaders=function(){m.headers=void 0,l.info("ajaxOptions.headers cleared")},c.headers=function(){return b.extend({},m.headers)},c.promise=function(a,b){var c=a.promise();return c.request={abort:b.abort},c},c.prototype.url=function(a){return q(this,a)},c.prototype.get=function(a,c){a=q(this,a);var d="GET",e=b.extend({},m,{url:a,type:d});return l.info("ajax GET",e.url),y(e,c)},c.prototype.getBinary=function(a,c){a=this.url(a);var d="GET",e="binary",f=!1,g=b.extend({},m,{url:a,type:d,dataType:e,processData:f});return delete g.contentType,l.info("ajax binary GET",g.url),y(g,c)},c.prototype.post=function(c,d,e){c=q(this,c),d=a.isObject(d)?JSON.stringify(d):d;var f="POST",g=b.extend({},m,{url:c,type:f,data:d});return l.info("ajax POST",d,e),y(g,e)},c.prototype.put=function(c,d,e){return l.info("ajax PUT",d,e),c=q(this,c),y(b.extend({},m,{url:c,type:"PUT",
data:a.isObject(d)?JSON.stringify(d):d}),e)},c.prototype.delete=function(a,c){a=q(this,a);var d=b.extend({},m,{url:a,type:"DELETE"});return l.info("ajax DELETE",d.url),y(d,c)},c.isMultiTenant=function(){return k()},c.prototype.protocol=function(){return n.useSecureConnection?"https":"http"},c.prototype.baseUrl=function(){return z(this)},c}();o=__decorate([c.dependsOn(d)],o),o.factory=function(){return p()?new h:new o};function p(){return!!window.PredixSDK}function q(a,b){return b=(new f).isMobileApp()?z(a)+"meridium/"+A(b):A(b)}function r(a){return s(a)?u(a):x()}function s(a){return!!a&&(t(a)||u(a))}function t(a){return a.toLowerCase().indexOf("http://")>-1}function u(a){return a.toLowerCase().indexOf("https://")>-1}function v(a){return a?a.toLowerCase().replace("https://","").replace("http://",""):a}function w(a){return a?a.toString().replace(/\//g,""):a}function x(){return"https:"===location.protocol}function y(a,c){var d=i.resolve(f),e=i.resolve(g)
;return d.isMobile()&&e.getManualOfflineStatus()?b.ajax({beforeSend:function(a){a.abort("error")}}):b.ajax(b.extend({},a,c))}function z(a){return n.server?a.protocol()+"://"+n.server+"/":""}function A(a){return a&&"/"===a.charAt(0)&&(a=a.substring(0).slice(1)),a}return o});
define('system/lang/converter',['require','system/text/parser','globalize'],function(require){"use strict";var a=require("system/text/parser"),b=require("globalize");function c(){}c.prototype.toNullable=function a(b){return b?b:null},c.prototype.toObject=function a(b,c){return b?b:c},c.prototype.toString=function a(b,c){return void 0===b||null===b?void 0!==c?c:"":b.toString()},c.prototype.toNullableString=function a(b){return c.prototype.toString(b,null)},c.prototype.toBoolean=function a(b,c){return void 0!==b&&(b===c||b===!0)},c.prototype.toNullableBoolean=function a(b,c){return void 0!==c||void 0!==b&&null!==b?b===c||b===!0:null},c.prototype.toInteger=function a(b,c){var d=parseInt(b,10);return c=c||0,isNaN(d)?c:d},c.prototype.toFloat=function a(b,c){var d=parseFloat(b);return arguments.length<2&&(c=0),isNaN(d)?c:d},c.prototype.toDate=function a(b,c,e){return d(b,c,e)},c.prototype.toNullableDate=function a(b,c){return d(b,c,null)};function d(b,c,d){return c=c||"yyyy-MM-ddTHH:mm:ss.fff",d=Object.defaultValue(d,null),
null===b||void 0===b?d:b instanceof Date?b:a.parseDate(b,c)||a.parseDate(b,"yyyy-MM-ddTHH:mm:ss.fff")||d}return c.prototype.toDateString=function a(c,d){return d=d||"S",b.format(c,d)},c.prototype.toNullableInteger=function a(b){var c=parseFloat(b);return isNaN(c)?null:c},c.prototype.toNullableFloat=function a(b){return this.toFloat(b,null)},new c});
define('platform/datasheets/layout/services/dto/layout-size-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.height=a.toInteger(b.height),this.width=a.toInteger(b.width),this.percentageHeight=a.toInteger(b.percentageHeight),this.width=a.toInteger(b.percentageWidth)}return b});
define('platform/datasheets/layout/services/dto/layout-location-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.row=a.toInteger(b.row),this.column=a.toInteger(b.column),this.rowSpan=a.toInteger(b.rowSpan),this.columnSpan=a.toFloat(b.columnSpan),this.x=a.toInteger(b.x),this.y=a.toInteger(b.y)}return b});
define('platform/datasheets/layout/services/dto/layout-element-dto',['require','jquery','system/lang/converter','./layout-size-dto','./layout-location-dto'],function(require){"use strict";var a=require("jquery"),b=require("system/lang/converter"),c=require("./layout-size-dto"),d=require("./layout-location-dto");function e(f){f=f||{},this.controlName=b.toString(f.controlName),this.name=b.toString(f.name),this.parentName=b.toString(f.parentName),this.type=b.toString(f.type),this.visible=b.toBoolean(f.visible),this.caption=b.toString(f.caption),this.defaultCaption=b.toString(f.defaultCaption),this.captionVisible=b.toBoolean(f.captionVisible),this.captionPosition=b.toString(f.captionPosition);var g=a.map(b.toObject(f.children,[]),function(a){return new e(b.toObject(a,{}))});this.children=b.toObject(g,[]),this.size=new c(b.toObject(f.size,{})),this.location=new d(b.toObject(f.location,{})),this.captionSize=new c(b.toObject(f.captionSize,{}))}return e});
define('platform/datasheets/layout/services/dto/datasheet-layout-dto',['require','jquery','system/lang/converter','./layout-element-dto'],function(require){"use strict";var a=require("jquery"),b=require("system/lang/converter"),c=require("./layout-element-dto");function d(d){d=d||{};var e=a.map(b.toObject(d.elements,[]),function(a){return new c(b.toObject(a,{}))});this.elements=e,this.datasheetId=b.toString(d.datasheetId),this.datasheetKey=b.toInteger(d.datasheetKey)}return d});
define('platform/datasheets/layout/services/dto/datasheet-dto',['require','system/lang/converter','./datasheet-layout-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./datasheet-layout-dto");function c(c){c=c||{},this.key=a.toString(c.key),this.id=a.toString(c.id),this.caption=a.toString(c.caption),this.defaultCaption=a.toString(c.defaultCaption),this.description=a.toString(c.description),this.familyKey=a.toString(c.familyKey),this.familyType=a.toString(c.familyType),this.familyID=a.toString(c.familyID),this.isCustomForm=a.toBoolean(c.isCustomForm),this.isMasterDetail=a.toBoolean(c.isMasterDetail),this.lastViewed=a.toBoolean(c.lastViewed),this.customFormParameters=a.toObject(c.customFormParameters),this.isDefault=a.toBoolean(c.isDefault),this.sections=a.toObject(c.sections,[]),this.updateUser=a.toString(c.updateUser),this.updateDate=a.toDate(c.updateDate),this.isHidden=a.toBoolean(c.isHidden),this.layout=new b(a.toObject(c.layout,{}))}return c});
define('platform/datasheets/layout/services/dto/bulk-datasheet-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.id=a.toString(b.id),this.caption=a.toString(b.caption),this.defaultCaption=a.toString(b.defaultCaption),this.description=a.toString(b.description),this.familyKey=a.toString(b.familyKey),this.familyType=a.toString(b.familyType),this.isCustomForm=a.toBoolean(b.isCustomForm),this.isDefault=a.toBoolean(b.isDefault),this.updateUser=a.toString(b.updateUser),this.updateDate=a.toDate(b.updateDate),this.columns=b.columns}return b});
define('platform/datasheets/layout/services/dto/datasheet-field-info-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.fieldKey=a.toString(b.fieldKey),this.fieldId=a.toString(b.fieldID),this.inputType=a.toString(b.inputType),this.maxLength=a.toInteger(b.maxLength),this.isActive=a.toBoolean(b.isActive)}return b});
define('platform/datasheets/layout/services/datasheet-service',['require','jquery','lodash','system/lang/object','system/http/ajax-client','./dto/datasheet-dto','./dto/bulk-datasheet-dto','./dto/datasheet-field-info-dto'],function(require){"use strict";var a=require("jquery"),b=require("lodash");require("system/lang/object");var c=require("system/http/ajax-client"),d=require("./dto/datasheet-dto"),e=require("./dto/bulk-datasheet-dto"),f=require("./dto/datasheet-field-info-dto"),g="api/core/datasheet/",h="api/core/metadata/",i="api/internal/aca",j="api/core/uom";function k(a){this.ajaxClient=a,this.isForDCM=!1}k.dependsOn=[c],k.prototype.setupForDCM=function(){this.isForDCM=!0},k.prototype.getAllDatasheets=function b(){var c=g,e=a.Deferred();return this.ajaxClient.get(c).done(function(b){var c=a.map(b,function(a){return new d(a)});e.resolve(c)}).fail(function(){e.reject()}),e.promise()},k.prototype.getDatasheets=function b(e){var f=g+"family/"+e,h=a.Deferred(),i;return i=this.ajaxClient.get(f).done(function(b){var c=a.map(b,function(a){return new d(a)});h.resolve(c)}).fail(function(a){h.reject(a.statusText,a)}),c.promise(h,i)},k.prototype.getDatasheet=function b(e,f){var h=g+e,i=a.Deferred(),j
;return void 0!==f&&(h=h+"/"+f),j=this.ajaxClient.get(h,{}).done(function(a){i.resolve(new d(a))}).fail(function(a){i.reject(a.statusText,a)}),c.promise(i,j)},k.prototype.getBulkDatasheet=function b(c,d){var f=g+"bulk/"+c,h=a.Deferred();return void 0!==d&&(f=f+"/"+d),this.ajaxClient.get(f,{}).done(function(a){h.resolve(new e(a))}).fail(function(){h.reject()}),h.promise()},k.prototype.getFieldInfo=function d(e){var f=g+"fieldsInputInfo/"+e,h=a.Deferred(),i;return this.isForDCM&&(f+="?isFromDCM=true"),i=this.ajaxClient.get(f,{}).done(function a(c){var d=b.map(c,l);h.resolve(d)}).fail(function a(b){h.reject(b.statusText,b)}),c.promise(h,i)};function l(a){return new f(a)}return k.prototype.newDatasheet=function b(c){var d=g+"new",e=a.Deferred();return this.ajaxClient.post(d,c).done(function(a){e.resolve(a)}).fail(function(){e.reject()}),e.promise()},k.prototype.deleteDatasheet=function b(c){var d=g+c,e=a.Deferred();return this.ajaxClient.delete(d,{}).done(function(a){e.resolve(a)
}).fail(function(){e.reject()}),e.promise()},k.prototype.updateDatasheet=function b(c){var d=g+"update",e=a.Deferred();return this.ajaxClient.post(d,c).done(function(a){e.resolve(a)}).fail(function(){e.reject()}),e.promise()},k.prototype.updateLayout=function b(c){var d=g+"layout",e=a.Deferred();return this.ajaxClient.post(d,c).done(function(a){e.resolve(a)}).fail(function(){e.reject()}),e.promise()},k.prototype.getEntityFamilyById=function b(c){var d=this,e=h+"entityfamily?id="+c,f=a.Deferred();return d.isForDCM&&(e+="&isFromDCM=true"),this.ajaxClient.get(e).done(function(a){f.resolve(a)}).fail(function(){f.reject()}),f.promise()},k.prototype.pushCritIndToCMMS=function b(c){var d=a.Deferred();return this.ajaxClient.put(i+"/sap/"+c).done(function(a){d.resolve(a)}).fail(d.reject.bind(d)),d.promise()},k.prototype.getBDFLayoutPreferences=function b(c,d){var e=a.Deferred(),f=g+"pref/"+c+"/"+d;return this.ajaxClient.get(f).done(function(a){e.resolve(a)}).fail(e.reject.bind(e)),e.promise()},
k.prototype.updateBDFLayoutPreferences=function b(c,d,e){var f=a.Deferred(),h=g+"pref/"+c+"/"+d;return this.ajaxClient.post(h,e).done(function(a){f.resolve(a)}).fail(f.reject.bind(f)),f.promise()},k.prototype.getUomCoversion=function b(c){var d=a.Deferred(),e=j+"/conversion/"+c;return this.ajaxClient.get(e).done(function(a){d.resolve(a)}).fail(d.reject.bind(d)),d.promise()},k.prototype.getUomCoversionByKey=function b(c,d){var e=a.Deferred(),f=j+"/conversion/fromkey/"+c+"/tokey/"+d;return this.ajaxClient.get(f).done(function(a){e.resolve(a)}).fail(e.reject.bind(e)),e.promise()},k.prototype.getUoms=function b(c){var d=a.Deferred(),e=j+"/keys/"+c;return this.ajaxClient.get(e).done(function(a){d.resolve(a)}).fail(d.reject.bind(d)),d.promise()},k});

define('text!platform/datasheets/layout/ui/views/templates/datasheet-text-editor.html',[],function () { return '<div class="panel-content text-editor" >\r\n    <textarea class="form-control" data-bind="value: val, attr: { readonly: disabled, placeholder: $root.translate(\'DS_TEXT_EDITOR_TITLE\'), autofocus: !$root.isIOS && !disabled}"></textarea>\r\n</div>\r\n<div class="panel-footer" >\r\n    <button class="btn btn-primary save-btn" data-bind="click:saveTexteditorValue, text: $root.translate(\'DONE\'), disable: ctx.fieldValue().disabled() || ctx.fieldValue().clientDisabled() || readonly"></button>\r\n    <!--<button class="btn btn-primary" data-bind="click:closeTexteditorDialog, text: $root.translate(\'DS_CANCEL\')"></button>-->\r\n</div>';});

define('platform/datasheets/layout/ui/datasheet-text-editor',['require','lodash','jquery','knockout','spa/ko/knockout-view-model','system/lang/event','text!./views/templates/datasheet-text-editor.html','system/globalization/translator','system/hardware/device'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("spa/ko/knockout-view-model"),e=require("system/lang/event"),f=require("text!./views/templates/datasheet-text-editor.html"),g=require("system/globalization/translator"),h=require("system/hardware/device");function i(a,b,d,i){this.contentEl=f,j.call(this,this.contentEl),this.val=c.observable(a),this.ctx=b,this.oldVal=c.observable(a),this.region=null,this.onSave=new e,this.onClose=new e,this.action=new e,this.translator=Object.resolve(g),this.disabled=c.observable(d),this.readonly=c.observable(i),this.device=Object.resolve(h),this.isIOS=this.device.isIOS()}var j=Object.inherit(d,i);i.prototype.attach=function a(c){j.prototype.attach.call(this,c),this.region=c,b(document).trigger("click"),this.isIOS||!this.disabled||this.disabled()||this.region.$element.find("textarea").focus()},i.prototype.detach=function a(b){k(this)},i.prototype.translate=function a(b){
return this.translator.translate(b)},i.prototype.saveTexteditorValue=function a(){this.action.raise(),this.ctx&&this.ctx.fieldValue&&this.ctx.fieldValue().value(this.val()),this.onSave.raise(),k(this)};function k(b){a.delay(function(a){a.ctx&&a.ctx.fieldValue&&a.ctx.fieldValue().isSelected&&a.readonly&&!a.readonly()&&a.ctx.fieldValue().isSelected(!0)}.bind(null,b),100)}return i.prototype.closeTexteditorDialog=function a(){this.ctx&&this.ctx.fieldValue&&this.ctx.fieldValue().value(this.oldVal()),this.action.raise(),this.onClose.raise()},i});
define('platform/datasheets/layout/ui/helpers/ui-helper',['require','jquery','lodash','knockout','system/ui/message-box','application/application-context'],function(require){"use strict";var a=require("jquery"),b=require("lodash"),c=require("knockout"),d=require("system/ui/message-box"),e=require("application/application-context"),f="0",g="MI Reference Document";function h(){}h.prototype.handleNavAppearance=function b(c,d){a(".more-options-outer-container").remove(),c&&c.region&&c.region.$element&&(c.datasheetNavWidth(c.region.$element.find(".datasheet-layout-container .datasheet-nav").width()),c.region.$element.find(".datasheet-layout-container .datasheet-nav").removeClass("small-nav"),c.region.$element.find(".datasheet-layout-container .datasheet-nav").removeClass("too-small-nav"),c.region.$element.find(".master-detail-datasheet-layout-container .datasheet-nav").removeClass("small-nav"),c.region.$element.find(".master-detail-datasheet-layout-container .datasheet-nav").removeClass("too-small-nav"),
c.datasheetNavWidth()&&c.datasheetNavWidth()<768&&(c.datasheetNavWidth()<500&&c.showStateManagement()?(c.region.$element.find(".datasheet-layout-container .datasheet-nav").addClass("too-small-nav"),c.region.$element.find(".master-detail-datasheet-layout-container .datasheet-nav").addClass("too-small-nav")):(c.region.$element.find(".datasheet-layout-container .datasheet-nav").addClass("small-nav"),c.region.$element.find(".master-detail-datasheet-layout-container .datasheet-nav").addClass("small-nav"))))},h.prototype.handleStickyHeader=function b(c,d,e){var f=c.uiHelper.handleHeaderHeight(c,d);if(e[0]&&e[0].scrollTop>50){var g=a(e[0]).parents("mi-recommendation")&&!!a(e[0]).parents("mi-recommendation").length,h=e&&e[0]&&e[0].className.indexOf("dialog-content")>-1;!f.hasClass("sticky-ds-nav")&&f[0]&&(f[0].classList.add("sticky-ds-nav"),h?f.css({top:e[0].offsetTop+107}):f.css({top:g?e[0].offsetTop+51:e[0].offsetTop}))}else f[0]&&f[0].classList.remove("sticky-ds-nav")},
h.prototype.handleHeaderHeight=function b(c,d){var e,f;return c&&d&&d.$element&&(".master-datasheet-container"===d.$element.selector?(f=a(".master-detail-datasheet-layout-container > .datasheet-nav"),e=a(".master-detail-datasheet-layout-container > .datasheet-nav > .datasheet-toolbar"),f.height(e.height()),e.width(f.width()-7)):(f=d.$element.find(".datasheet-nav"),e=d.$element.find(".datasheet-toolbar"),a(".master-detail-datasheet-layout-container .master-datasheet-container .datasheet-nav ").is(":empty")||f.height(e.height()),e.width(f.width()-7))),e},h.prototype.setOverlay=function a(b){var c=0,d=!1;b.region.$element.find(".datasheet-layout-container").find(".datasheet-nav").is(":visible")&&(c+=b.region.$element.find(".datasheet-nav").height()+40,d=!0),b.region.$element.find(".datasheet-layout-container").find(".nav-tabs").is(":visible")&&(c+=b.region.$element.find(".datasheet-layout-container").find(".nav-tabs").height()),d&&(c-=20),
b.region.$element.find(".datasheet-layout-container").find("h1").is(":visible")&&(c+=b.region.$element.find(".datasheet-layout-container").find("h1").height()+25),b.overlayTop(c+"px");var e="calc(100% - "+c+"px) ";b.overlayHeight(e)},h.prototype.attachTabClickHandlers=function a(b){if(b.region){var c=b.region.$element.find('[data-toggle="tab"], [data-toggle="pill"]');b.kom.subscribe(b.isDatasheetRendered,i.bind(null,b,c)),c.each(j.bind(null,b))}};function i(b,d,e){if(!e)return void(b.tabs&&(b.tabContainer.append(b.alternativeTabsContainer.children()),b.tabContainer.next().remove()));b.calculateTabWidth(),b.calculateContainerWidth(),b.tabWidth()>b.containerWidth()&&(k(b,d),d.each(function(d,e){if(b.tabs.push(a(e).parent()),b.tabWidths.push(a(e).parent().width()+40),void 0!==c.contextFor(a(e).parent().get(0))){var f=c.contextFor(a(e).parent().get(0)).$data;b.tabVms.push(f),b.tabsMoreOptions.push({type:"text",text:f.caption(),icon:"",vm:f,index:d})}
b.alternativeTabsContainer.append(a(e).parent().data("index",d).attr("data-index",d))}),b.tabsMoreOptions.length>=1&&(b.tabsMoreOptions[0].icon="icon-tick"),l(b))}function j(b,c,d){a(d).on("click",function(c){c&&(c.preventDefault(),c.stopPropagation()),a(this).parent("li").siblings("li").removeClass("active").end().addClass("active");var d=a(this).data("target");return b.region.$element.find(".tab-pane").removeClass("active").end().find(d).addClass("active"),b.tabSwitched.raise(),!1})}function k(b,d){b.tabs=[],b.tabWidths=[],b.tabVms=[],b.tabsMoreOptions=[],b.alternativeTabsContainer=a("<div/>"),b.tabContainer=a(d[0]).closest("ul"),b.tabContainer.length>0&&(void 0!==c.contextFor(b.tabContainer.get(0))&&(b.tabContainerContext=c.contextFor(b.tabContainer.get(0)).$data),b.tabContainer.css({display:"inline-block","vertical-align":"middle"}))}function l(a){var b=a.alternativeTabsContainer.find("li"),c=a.region.$element.width(),d=0;b.each(function(b,e){d=m(a,c,d,3,b,e)}),n(a,a.tabContainer)}
function m(b,c,d,e,f,g,h){return h&&h.index,d+=b.tabWidths[f],d+50>c?(e=f,d-=b.tabWidths[f]):a(b.tabContainer).append(g),d}function n(b,c){var d=a("<div/>").attr("data-bind","halt-bindings").css("display","inline-block"),e=a("<mi-more-options-noko/>").attr("data-bind","property: {icon: 'icon-options'}");window.CustomElements&&!window.CustomElements.useNative&&window.CustomElements.upgrade(e.get(0)),b.moreOptions=e.get(0),b.moreOptions.loader=b.setTabsOptions.bind(b),d.append(e),b.moreOptions.moreoptionsCB(o.bind(null,b)),c.after(d)}h.prototype.setTabsOptions=function a(b,c){return c.resolve(b.tabsMoreOptions),c};function o(b,c){var d=0,e=b.region.$element.width(),f=3;b.tabContainer.children().appendTo(a(b.alternativeTabsContainer)),d+=b.tabWidths[c.index];for(var g=0;g<b.moreOptions.options.length;g++)b.moreOptions.options[g].icon="";b.moreOptions.options[c.index].icon="icon-tick",a(b.tabs).each(function(a,g){d=p(b,e,d,f,a,g,c)}),f<c.index&&a(b.tabContainer).append(b.tabs[c.index]),
a(b.tabs[c.index]).find("a").trigger("click")}function p(b,c,d,e,f,g,h){return f!==h.index&&(d+=b.tabWidths[f]),d+50>c?(e=f,d-=b.tabWidths[f]):a(b.tabContainer).append(g),d}h.prototype.calculateTabWidth=function b(c){if(c&&c.region&&c.region.$element){var d=c.region.$element.find(".nav-tabs").children(),e,f=0;for(e=0;e<d.length;e++)f+=a(d[e]).width();c.tabWidth(f)}},h.prototype.calculateContainerWidth=function a(b){b&&b.region&&b.region.$element&&(b.containerWidth(b.region.$element.find(".datasheet-layout-container").width()-100),b.datasheetNavWidth(b.region.$element.find(".datasheet-layout-container .datasheet-nav").width()))},h.prototype.addMoreOptionsForIcons=function a(b,c,d){"form"===d&&b.hideMoreOptionsForIcons&&!b.hideMoreOptionsForIcons()?q(b,c,d):"bulk"===d&&q(b,c,d)};function q(b,c,d){if(b&&b.region&&b.region.$element){var e=b.region.$element.find(c),f=a("<mi-more-options-noko/>").attr("data-bind",'property: {icon: "icon-options"}')
;f.attr("class","datasheet-icons-more-options"),window.CustomElements&&!window.CustomElements.useNative&&window.CustomElements.upgrade(f.get(0)),b.iconsMoreOptions=f.get(0),b.iconsMoreOptions.loader=b.setIconOptions.bind(b),e.append(b.iconsMoreOptions),b.iconsMoreOptions.moreoptionsCB(t.bind(null,b,d))}}h.prototype.setIconOptions=function b(c,d){var e=a.Deferred();return"form"===d?r(c):"bulk"===d&&s(c),e.resolve(c.iconOptions),e};function r(a){var b=[],c=e.user.isSuperUser,d=!a.siteKey()||a.siteKey()&&a.siteKey().toString()===f,h=a.currentDatasheet().familyID()===g;b.push({type:"text",text:a.translate("PRINT"),icon:"icon-printer"}),a.isRootRecordAvailable()&&a.datasheetNavWidth()<768&&b.push({type:"text",text:a.translate("RM_MAKE_ROOT_RECORD_TOOLTIP"),icon:"icon-open-in-new-window"}),a.isDefaultHelpTextAvailable()&&b.push({type:"text",text:a.helpButtonText(),icon:"icon-questionmark"}),b.push({type:"text",text:a.translate("DS_ADD"),icon:"icon-plus",noaccess:!a.isNewAvailable()}),
a.isUnlinkRecordAvailable()&&b.push({type:"text",text:a.translate("RM_UNLINK_RECORD"),icon:"icon-unlink",noaccess:!a.isUnlinkRecordEnabled()}),b.push({type:"text",text:a.translate("DS_DELETE"),icon:"icon-bin",noaccess:!a.isDeleteAvailable()||h&&d&&!c}),a.isReferencesAvailable()&&a.isRefDocEnabled()&&b.push({type:"text",text:a.refDocCount()+" "+a.translate("DS_REF_DOCS"),icon:"icon-doc"}),a.isHistoryAvailable()&&a.isHistoryEnabled()&&b.push({type:"text",text:a.translate("DS_HISTORY"),icon:"icon-history",disabled:!a.isHistoryEnabled()}),a.isCopyAvailable()&&(b.push({type:"text",text:a.translate("DS_COPY"),icon:"icon-copy",noaccess:!a.isPasteEnabled()}),b.push({type:"text",text:a.translate("DS_PASTE"),icon:"icon-paste",noaccess:!a.isPasteEnabled(),disabled:a.canPaste()})),a.iconOptions=b}function s(a){var c=[],d=e.user.isSuperUser,g=!(!a.selectedRows().length||!b.find(a.selectedRows(),function(a){return!a.siteKey()||a.siteKey()&&a.siteKey().toString()===f})),h=a.isRefDocFamily()
;a.isMasterDatasheet()&&c.push({type:"text",text:a.translate("DS_UNLINK"),icon:"icon-unlink",noaccess:!a.isUnlinkAvailable(),disabled:a.hasSelection()}),a.isHistoryAvailable()&&c.push({type:"text",text:a.translate("DS_HISTORY"),icon:"icon-history",disabled:!a.isSingleEntitySelected()||a.isHistoryDisabled()}),c.push({type:"text",text:a.translate("DS_DELETE"),icon:"icon-bin",noaccess:!a.isDeleteAvailable()||h&&g&&!d,disabled:a.hasSelection()}),a.isRefDocAvailable()&&!a.isRefDocDisabled()&&c.push({type:"text",text:a.translate("DS_REF_DOCS"),icon:"icon-doc",disabled:!a.isSingleEntitySelected()||a.isRefDocDisabled()}),a.isCopyAvailable()&&(c.push({type:"text",text:a.translate("DS_COPY"),icon:"icon-copy",noaccess:!a.isPasteEnabled()&&a.isSingleEntitySelected(),disabled:!a.isSingleEntitySelected()}),c.push({type:"text",text:a.translate("DS_PASTE"),icon:"icon-paste",noaccess:!a.isPasteEnabled(),disabled:!a.canPaste()})),a.showColumnChooser()&&c.push({type:"text",
text:a.translate("DATASHEET_REORDER"),icon:"icon-paste"}),a.isFrozenColumn&&!a.isFrozenColumn()?c.push({type:"text",text:a.translate("DATASHEET_FREEZE_COLUMN"),icon:"icon-copy",disabled:!a.focusedColumn||a.frozenColsKeys&&a.frozenColsKeys().length>=4}):a.isFrozenColumn&&a.isFrozenColumn()&&c.push({type:"text",text:a.translate("DATASHEET_UNFREEZE_COLUMN"),icon:"icon-copy",disabled:!a.focusedColumn}),a.isFrozenRow()?c.push({type:"text",text:a.translate("DATASHEET_UNFREEZE_ROW"),icon:"icon-copy",disabled:!a.isSingleEntitySelected()}):c.push({type:"text",text:a.translate("DATASHEET_FREEZE_ROW"),icon:"icon-copy",disabled:!a.isSingleEntitySelected()||a.frozenRows().length>=5}),a.iconOptions=c}function t(a,b,c){c.noaccess||"form"!==b?c.noaccess||"bulk"!==b||(c.text===a.translate("DS_UNLINK")&&a.unlinkRelatedEntities(),
u(a,c)):(c.text===a.helpButtonText()?a.toggleHelpText():c.text===a.translate("DS_STATE_TRANSITION")?a.showStateTransition():c.text===a.translate("DS_STATE_ASSIGNMENT")?a.showStateAssignment():c.text===a.translate("DS_ADD")?a.newDatasheet():c.text===a.translate("RM_UNLINK_RECORD")&&a.unlinkRecord(),u(a,c))}function u(a,b){
b.text===a.translate("DS_DELETE")?a.deleteDatasheet():b.text&&b.text.indexOf(a.translate("DS_REF_DOCS"))>=0?a.showRefDocs():b.text===a.translate("DS_HISTORY")?a.showHistory():b.text===a.translate("DS_COPY")?a.copyDatasheet():b.text===a.translate("DS_PASTE")?a.pasteDatasheet():b.text===a.translate("DATASHEET_REORDER")?a.openColumnChooser():b.text===a.translate("DATASHEET_FREEZE_COLUMN")?a.freezeColumn():b.text===a.translate("DATASHEET_UNFREEZE_COLUMN")?a.unfreezeColumn():b.text===a.translate("DATASHEET_FREEZE_ROW")?a.freezeRow():b.text===a.translate("DATASHEET_UNFREEZE_ROW")?a.unfreezeRow():b.text===a.translate("RM_MAKE_ROOT_RECORD_TOOLTIP")?a.makeRootRecord():b.text===a.translate("PRINT")?a.print():b.text===a.translate("DS_SAVE_TOOLTIP")?a.saveDatasheet():b.text===a.translate("DS_DOWNLOAD_REF_DOC")&&a.downloadRefdoc()}h.prototype.attachTemplates=function b(c,d,e){var f=a("body"),g=a("body #datasheet-templates"),h,i;g.length?(h=a(g).find("#layout-templates"),v(f,d,h),
i=a(g).find("#field-templates"),w(f,e,i)):(a(f).append("<div id='datasheet-templates'></div>"),h=a(g).find("#layout-templates"),v(f,d,h),i=a(g).find("#field-templates"),w(f,e,i))};function v(b,c,d){d.length||(d=a(b).find("#datasheet-templates").append("<div id='layout-templates'></div>"),a(d).find("#layout-templates").append(c))}function w(b,c,d){d.length||(d=a(b).find("#datasheet-templates").append("<div id='field-templates'></div>"),a(d).find("#field-templates").append(c))}function x(b,c,d){d.length||(d=a(b).find("#datasheet-templates").append("<div id='bulk-field-templates'></div>"),a(d).find("#bulk-field-templates").append(c))}function y(b,c,d){d.length||(d=a(b).find("#datasheet-templates").append("<div id='aggregate-field-templates'></div>"),a(d).find("#aggregate-field-templates").append(c))}h.prototype.attachTemplatesForBulk=function a(b,c){z(b,c,"bulk")},h.prototype.attachTemplatesForAggregate=function a(b,c){z(b,c,"aggregate")};function z(b,c,d){
var e=a("body"),f,g=a("body #datasheet-templates");g.length||a(e).append("<div id='datasheet-templates'></div>"),"aggregate"===d?(f=a(g).find("#aggregate-field-templates"),y(e,c,f)):(f=a(g).find("#bulk-field-templates"),x(e,c,f))}h.prototype.lockEntityUpdateHelper=function a(b,c){var d=b.translator.translate("DS_ENTITY_UPDATE_WARNING_CAPTION"),e=c?b.translator.translate("DS_BULK_ENTITY_UPDATE_WARNING_MSG"):b.translator.translate("DS_ENTITY_UPDATE_WARNING_MSG"),f=b.translator.translate("OK");b.messagebox&&B(b.messagebox),b.messagebox=A(e,d,f),b.messagebox.showMessage()},h.prototype.unsupportedTextFound=function a(b){var c=b.translator.translate("DS_INVALID_INPUT"),d=b.translator.translate("DS_UNSUPOORTED_TEXT_FOUND"),e=b.translator.translate("OK");b.messagebox&&B(b.messagebox),b.messagebox=A(d,c,e),b.messagebox.showMessage()};function A(a,b,c){var e=null,f=null;return f=[{name:c}],e=new d(a,b,f)}function B(a){null!==a&&a.dialog.dialogShellRegion.activeContainer&&(a.dialog.closeDialog(),
a=null)}return h.prototype.isAllDatasheetsHidden=function a(c){return b.every(c,function(a){return a.isHidden===!0||a.isMasterDetail===!0})},h});
define('system/text/clean-href',[],function(){"use strict";var a=/^([^:]+):|^#|^(.\/)|^(..\/)|^!/gm,b=/^(%20|\s)*(data|javascript)/im,c=/[^\x20-\x7E]/gim;return function(d){var e,f,g,h;if(d){if(e=d.replace(c,""),!(f=e.match(a)))return"";if(g=f[0],h=b.test(g))return"";d=e}return d}});
define('platform/datasheets/layout/model/field-value-model',['require','lodash','jquery','xss','knockout','../ui/datasheet-text-editor','spa/region','system/ui/dialog-view-model','application/application-context','system/lang/event','system/text/formatter','system/text/parser','system/lang/converter','moment','system/globalization/translator','../ui/helpers/ui-helper','system/text/clean-href','system/knockout/knockout-helpers'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("xss"),d=require("knockout"),e=require("../ui/datasheet-text-editor"),f=require("spa/region"),g=require("system/ui/dialog-view-model"),h=require("application/application-context"),i=require("system/lang/event"),j=require("system/text/formatter"),k=require("system/text/parser"),l=require("system/lang/converter"),m=require("moment"),n=Object.resolve(j),o=require("system/globalization/translator"),p=require("../ui/helpers/ui-helper"),q=require("system/text/clean-href");require("system/knockout/knockout-helpers");function r(b,c,e,f,g,j,k){var l=this;if(g=g||{},g.required=g.required||!1,g.disabled=g.disabled||!1,g.picklist=g.picklist||void 0,g.isHtmlField=g.isHtmlField||!1,g.unitOfMeasure=g.unitOfMeasure||{},g.unitOfMeasureKey=g.unitOfMeasureKey||{},g.backColor=g.backColor||{},g.jsModuleName=g.jsModuleName||null,g.jsModuleParams=g.jsModuleParams||null,g.jsModuleUseApply=g.jsModuleUseApply||!1,
g.popJSModuleOnFocus=g.popJSModuleOnFocus||null,g.addParseValueParam=g.addParseValueParam||!1,g.dependentFields=g.dependentFields||[],g.values=void 0!==typeof g.values?"object"==typeof g.values?g.values:[g.values]:[],this.inputType=d.observable("Textbox"),this.translator=Object.resolve(o),this.key=d.observable(b),this.id=d.observable(c),this.entityKey=d.observable(k),this.oldValue=null,this.value=d.observable(e),this.computedBoolVal=null,v(this),this.displayValue=d.observable(f),this.uom=d.observable(g.unitOfMeasure),this.uomKey=d.observable(g.unitOfMeasureKey),this.disValue=d.computed(F.bind(null,l)),this.caption=g.caption,this.defaultCaption=g.defaultCaption,this.clientid=d.observable(j),this.isSelected=d.observable(!1),this.changedFromView=d.observable(!0),this.isDirty=d.observable(!1),this.required=d.observable(g.required),this.disabled=d.observable(g.disabled),this.isHtmlField=d.observable(g.isHtmlField),this.maxNumberOfValues=d.observable(g.maxNumberOfValues),
this.dbLength=g.dbLength,this.oldValues=d.observable(),this._values=d.observableArray(a.compact(g.values)),this.values=d.observableArray(a.compact(g.values)),void 0!==g.picklist){this.picklist=d.observableArray(l.createPickList.bind(this)(g.picklist)),this.isPicklistRestricted=d.observable(g.isPicklistRestricted);var m=a.find(g.picklist,s);this.picklistValue=d.observable(m?m.value:""),this.picklistValueSubscription=this.picklistValue.subscribe(M.bind(null,l)),this.picklistSubscription=this.picklist.subscribe(H.bind(null,l))}this.browsevalue=d.observable(),this.browsevalueSubscription=this.browsevalue.subscribe(x.bind(null,this)),this.format=g.format,this.behaviors=g.behaviors,this.isMaskedField=!1,O(this),this.dateFormat=d.observable(),this.format?this.dateFormat(z(this.format)):h.user&&h.user.formats&&h.user.formats.dateTime&&this.dateFormat(h.user.formats.dateTime),this.dateValue=d.observable(),this.isDateControl=d.observable(!1),this.dateSubscription=null,
this.helpText=""===g.helpText?this.translate("DS_NO_HELP_TEXT"):d.observable(g.helpText),this.backColor=d.observable(g.backColor),null!==g.jsModuleName?this.jsModuleName=d.observable(g.jsModuleName):this.jsModuleName=d.observable(),null!==g.jsModuleParams?this.jsModuleParams=d.observable(g.jsModuleParams):this.jsModuleParams=d.observable(),this.jsModuleUseApply=g.jsModuleUseApply,null!==g.popJSModuleOnFocus?this.popJSModuleOnFocus=d.observable(g.popJSModuleOnFocus):this.popJSModuleOnFocus=d.observable(),this.addParseValueParam=g.addParseValueParam,this.jsModuleValue=d.computed(u(this)),this.dependentFields=d.observableArray(g.dependentFields),this.clientDisabled=d.observable(!1),this.successMessage=d.observable(),this.errorMessage=d.observable(),this.validationMessage=d.observable(),this.isValid=d.computed(E.bind(null,this)),this.valueChanged=new i,this.valueBeforeChangedSubscription=this.value.subscribe(N.bind(null,l),null,"beforeChange"),
this.maxNumberOfValues()<=1?this.valueChangedSubscription=this.value.subscribe(K.bind(null,l)):this.valuesChangedSubscription=this.values.subscribe(I.bind(null,l)),this.placeHolder=d.computed(t.bind(null,l)),g.hidden=g.hidden||!1,this.hidden=d.observable(g.hidden),this.layoutElement=null}function s(a){return a.isSelected===!0}function t(a){return"NumericTextBox"===a.inputType()||"UOMTextbox"===a.inputType()?a.translate("DS_NUMERIC_INPUT"):a.translate("DS_TEXT_INPUT")}function u(a){return{read:function b(){var c=a.value();return c&&c.toString().indexOf("&parseValue=true")>-1?c.toString().substring(0,c.toString().indexOf("&parseValue=true")):c},write:function b(c){c&&c.toString().indexOf("&parseValue=true")===-1&&a.addParseValueParam?a.value(c+"&parseValue=true"):a.value(c)},owner:a}}r.prototype.translate=function a(b){return this.translator.translate(b)},r.prototype.isCleanHref=function a(c){var d=c?c:this.displayValue(),e;try{e=b(d)}catch(a){return!0}return""!==q(e.attr("href"))}
;function v(a){var b=!1;"string"==typeof a.value()&&("true"!==a.value().toLowerCase()&&"false"!==a.value().toLowerCase()||(b=!0)),"boolean"==typeof a.value()&&(b=!0),b&&(a.computedBoolVal=d.computed(w(a)))}function w(a){return{read:function(){return l.toBoolean(a.value(),"True")},write:function(b){a.value(b)}}}function x(a,b){var c="";if(""!==b){var d=b.split("\\");c=d[d.length-1]}a.value(c)}r.prototype.handleDate=function b(){var c=this,d=l.toDate(this.value());a.defer(y.bind(null,c,d))},r.prototype.handleDateFormat=function a(b){b!==this.format&&(this.format=b,this.format?this.dateFormat(z(this.format)):h.user&&h.user.formats&&h.user.formats.dateTime&&this.dateFormat(h.user.formats.dateTime))};function y(a,b){a.isDateControl(!0),a.dateValue(b),a.dateSubscription&&a.dateSubscription.dispose(),a.dateSubscription=a.dateValue.subscribe(B.bind(null,a))}r.prototype.convertDate=function a(b){var c=this;return this.value()?n.format(new Date(this.value()),this.dateFormat()):this.value()}
;function z(a){return n.getFormatByCode(a)}function A(a,b,c){return c.replace(new RegExp(a,"g"),b)}function B(a,b){var c=n.format(b,C(a));""===a.value()&&null===c||"0NaN-NaN-NaN"===c||(null===c&&(c=""),a.value(c))}function C(a){return"yyyy-MM-ddTHH:mm:ss.fff"}r.prototype.showTextEditor=function a(b){var c=new e(this.fieldValue().value(),this,this.fieldValue().disabled()||this.fieldValue().clientDisabled(),b),d=new f,h,i={},j;return i.closeIcon=!0,i.height="75%",i.width="75%",j=this.caption?this.caption().replace(/:([^:]*)$/,"$1").trim():this.columnCaption,""===j&&(j=this.fieldValue().translate("DS_TEXT_EDITOR_TITLE")),c.attach(d),h=new g(c,j,i),h.show(),c.action.add(D.bind(null,h)),c};function D(a){a.closeDialog()}r.prototype.dispose=function a(){this.valueChanged.remove(),this.valueBeforeChangedSubscription&&this.valueBeforeChangedSubscription.dispose(),this.valuesChangedSubscription&&this.valuesChangedSubscription.dispose(),this.isValid&&this.isValid.dispose()},
r.prototype.deallocateMem=function a(){this.translator=null,this.oldValue=null,this.computedBoolVal&&(this.computedBoolVal.dispose(),this.computedBoolVal=null),this.caption=null,this.defaultCaption=null,this.dbLength=null,this.format=null,this.behaviors=null,this.isMaskedField=null,this.helpText=null,this.valueChanged.remove(),this.valueChanged=null,this.key=null,this.id=null,this.entityKey=null,this.value=null,this.displayValue=null,this.uom=null,this.uomKey=null,this.disValue&&(this.disValue.dispose(),this.disValue=null),this.clientid=null,this.isSelected=null,this.changedFromView=null,this.isDirty=null,this.required=null,this.disabled=null,this.maxNumberOfValues=null,this.oldValues=null,this._values=null,this.values=null,this.picklist&&(this.picklist=null,this.isPicklistRestricted=null,this.picklistValue=null),this.browsevalue=null,this.dateFormat=null,this.dateValue=null,this.isDateControl=null,this.dateSubscription=null,this.backColor=null,this.jsModuleName=null,
this.jsModuleParams=null,this.popJSModuleOnFocus=null,this.dependentFields=null,this.clientDisabled=null,this.successMessage=null,this.errorMessage=null,this.validationMessage=null,this.isValid&&(this.isValid.dispose(),this.isValid=null),this.placeHolder&&(this.placeHolder.dispose(),this.placeHolder=null),this.valueBeforeChangedSubscription&&(this.valueBeforeChangedSubscription.dispose(),this.valueBeforeChangedSubscription=null),this.valuesChangedSubscription&&(this.valuesChangedSubscription.dispose(),this.valuesChangedSubscription=null),this.valueChangedSubscription&&(this.valueChangedSubscription.dispose(),this.valueChangedSubscription=null),this.hidden=null,this.layoutElement=null,this.picklistValueSubscription&&(this.picklistValueSubscription.dispose(),this.picklistValueSubscription=null),this.picklistSubscription&&(this.picklistSubscription.dispose(),this.picklistSubscription=null),this.jsModuleValue&&(this.jsModuleValue.dispose(),this.jsModuleValue=null),
this.browsevalueSubscription&&(this.browsevalueSubscription.dispose(),this.browsevalueSubscription=null),this.inputType=null,this.addParseValueParam=null};function E(a){var b=!0;return a.errorMessage()?(b=!1,a.validationMessage(a.errorMessage()),b):a.required()?""===a.value().toString()||void 0===a.value()?(b=!1,a.validationMessage(a.translate("DS_VALIDATION_MESSAGE")),b):b:(b=!0,a.validationMessage(""),b)}r.prototype.createPickList=function b(c){var d=[],e=!1,f=!1,g,h=this;if(void 0!==c){for(g=0;g<c.length;g++)if(c[g].isSelected===!0){e=!0;break}if(!e){var i=a.compact(h.values());e=parseInt(h.maxNumberOfValues())>1&&i.length}if(!h.required()&&h.maxNumberOfValues()<2){for(var j=0;j<c.length;j++)if(""===c[j].value.toString().trim()){f=!0;break}f&&0!==c.length||d.push({value:"",displayValue:""})}else!e&&h.required()&&d.push({value:"",displayValue:"",isSelected:!0});for(g=0;g<c.length;g++)d.push(c[g]);return d}},r.prototype.innerText=function c(){var d,e,f,g,h,i,j=null,k,l,m,n,o
;k=l=m=o="";try{d=JSON.parse(this.displayValue())}catch(a){d=null}if(d&&a.isArray(d)&&0!==d.length)return d[0].description;if(e=this.displayValue().split("href"),e[1]&&!(e[1].indexOf("http")>0||e[1].indexOf("www.")>0)){for(m=m.concat("href"),j=e[1].split(/>/),o=j[1],n=b(this.displayValue())[0].attributes,i=0;i<n.length;i++)if("href"!==n[i].nodeName&&!n[i].nodeName.match(/>|&|\\/)){j=j[0].split(n[i].nodeName),j[0]=j[0].trim();break}if(/\'|\"/.test(j[0])&&(j[0]=j[0].replace(/\'|\"/g,"")),f=j[0].split("?"),g=f[0].split("/"),g.length>1)for(i=1;i<g.length;i++)g[i]="/"+encodeURIComponent(g[i]);for(i=0;i<g.length;i++)m=m.concat(g[i]);if(f[1]){for(h=f[1].split(/=|&/),i=1;i<h.length;i+=2)h[i]="="+encodeURIComponent(h[i])+"&";for(i=0;i<h.length;i++)l=l.concat(h[i]);"&"===l.charAt(l.length-1)&&(l=l.substring(0,l.length-1))}for(""!==l&&""!==m&&(m=m.concat("?")),k="<a "+m+l,i=0;i<n.length;i++)"href"===n[i].nodeName||n[i].nodeName.match(/>|&|\\/)||(k=k+" "+n[i].nodeName+"="+n[i].nodeValue)
;k=k+">"+o+">",k=k.replace(/%23/g,"#"),k&&this.displayValue(k)}try{return b(this.displayValue()).text()}catch(a){return this.displayValue()}};function F(b){var c=b.displayValue();if(!c||"NumericTextBox"!==b.inputType()&&"UOMTextbox"!==b.inputType()||G(b)){if(/<a href=(|'|")#datasheet-dialog.*<\/a>/.test(c)){var d=location.hash.split(";")[parseInt(location.hash.split(";")[0].replace("#",""))+1].split("=")[1];c=c.replace(/href=#datasheet-dialog\//g,"href=#"+d+"?datasheet-dialog=")}}else if(c.toString().indexOf("E")===-1){var e=k.parseFloat(c);!isNaN(e)&&isFinite(e)&&a.isNumber(parseFloat(e))&&(c=n.format(e,"m"))}return void 0===b.uom().length||""===b.displayValue().trim()?c:c+" ("+b.uom()+")"}function G(b){return a.find(b.behaviors,function(a){return"Format"===a.behaviorType})}function H(b,c){var d,e;e=a.find(c,function(a){return a.isSelected===!0}),d=e?e.value:"",b.picklistValue(d)}function I(b,c){if(b.changedFromView()){if(b.isDirty(!0),
parseInt(b.maxNumberOfValues())>1&&(c=a.compact(c)),a.isEqual(c,[].concat(b.oldValues())))return;b.oldValues([].concat(c)),""!==b.errorMessage()&&void 0!==b.errorMessage()&&""===c||b.valueChanged.raise(b.key(),c,b.oldValue||null,b.clientid(),b.dependentFields(),"values")}else E.bind(null,b),b.isDirty()&&b.isDirty(!1);b.changedFromView(!0)}function J(a,b){return b&&b.toString()&&b.toString().indexOf("href")>0&&!a.isCleanHref(b.toString())}function K(a,b){if(a.changedFromView()){if(b=c(b),b=b?b.replace(/&lt;/g,"<").replace(/&gt;/g,">"):b,L(a)&&b&&b.toString().trim().toLowerCase().indexOf("<script")>-1||J(a,b)){var d=Object.resolve(p);return a.changedFromView(!1),a.value(a.oldValue),void d.unsupportedTextFound(a)}b&&b.toString().indexOf("&parseValue=true")>-1?a.displayValue(b.toString().substring(0,b.toString().indexOf("&parseValue=true"))):a.displayValue(b),a.isDirty(!0),
""!==a.errorMessage()&&void 0!==a.errorMessage()&&""===b||a.valueChanged.raise(a.key(),b,a.oldValue||null,a.clientid(),a.dependentFields())}else a.dateValue(b),E.bind(null,a),a.isDirty()&&a.isDirty(!1);a.changedFromView(!0)}function L(a){return"MaskedTextBox"===a.inputType()||"NumericTextBox"===a.inputType()||"Date"===a.inputType()||"Textbox"===a.inputType()||"TextArea"===a.inputType()||"UOMTextbox"===a.inputType()}function M(a,b){a.value(b)}function N(a,b){a.oldValue=b}function O(b){a.find(b.behaviors,P)&&(b.isMaskedField=!0)}function P(a){return a&&"Masked"===a.behaviorType}return r});
define('platform/datasheets/layout/model/entity-model',['require','knockout','system/lang/event','system/knockout/knockout-helpers'],function(require){"use strict";var a=require("knockout"),b=require("system/lang/event");require("system/knockout/knockout-helpers");function c(c,f,g,h){var i=0;for(c=c||[],i=0;i!==c.length;i++)c[i].valueChanged.add(d.bind(null,this),this);this.key=f,this.clientid=g,this.fieldValues=a.observableArray(c),this.isAuditable=h,this.fieldValuesSubscription=this.fieldValues.subscribe(e.bind(null,this),null,"arrayChange"),this.fieldValueChanged=new b}c.prototype.dispose=function a(){var b=0;for(b=0;b!==this.fieldValues().length;b++)this.fieldValues()[b].dispose();this.fieldValues.removeAll(),this.fieldValuesSubscription.dispose()},c.prototype.deallocateMem=function a(){var b;for(b=0;b<this.fieldValues().length;b++)this.fieldValues()[b].valueChanged.remove(this),this.fieldValues()[b].dispose(),this.fieldValues()[b].deallocateMem(),this.fieldValues()[b]=null;this.fieldValuesSubscription.dispose(),this.fieldValuesSubscription=null,this.fieldValues.removeAll(),this.fieldValues=null,
this.key=null,this.clientid=null,this.isAuditable=null,this.fieldValueChanged=null};function d(a,b,c,d,e,f,g){a.fieldValueChanged.raise(a.key,b,c,d,a.clientid,f,g)}function e(a,b){var c=0,e=[],f=[];for(c=0;c!==b.length;c++)"added"===b[c].status?e.push(b[c].value):"deleted"===b[c].status&&f.push(b[c].value);for(c=0;c!==e.length;c++)e[c].valueChanged.add(d.bind(null,a));for(c=0;c!==f.length;c++)f[c].valueChanged.remove(d.bind(null,a))}return c});
define('platform/datasheets/layout/model/datasheet-clipboard-model',['require','knockout','system/lang/event'],function(require){"use strict";var a=require("knockout"),b=require("system/lang/event");function c(){this.isEmpty=a.observable(!0),this.onChange=new b,this.clipboardKey="DSClipboard",null!==this.getData()&&this.isEmpty(!1)}c.prototype.setData=function(a,b){var c=new d(a,b);return c.fieldValues=c.fieldValues.filter(function(a){return"MIRD_DOC_PATH_CHR"!==a.id}),window.sessionStorage.setItem(this.clipboardKey,JSON.stringify(c)),this.isEmpty(!1),this.onChange.raise(),c},c.prototype.getData=function(){return JSON.parse(window.sessionStorage.getItem(this.clipboardKey))};function d(a,b){var c=0;for(this.familykey=a,this.fieldValues=[],c;c<b.length;c++){var d=b[c];d.disabled()||this.fieldValues.push(new e(d))}}function e(a){return this.id=a.id(),this.key=a.key(),this.value=a.value(),this.values=a.values(),this.displayValue=a.displayValue(),this.required=a.required(),this.hidden=a.hidden(),this.backColor=a.backColor(),void 0!==a.picklist&&(this.picklist=a.picklist()),
this.errorMessage=a.errorMessage(),this}return new c});
define('platform/datasheets/layout/model/layout-size-model',['require','knockout','system/knockout/knockout-helpers'],function(require){"use strict";var a=require("knockout");require("system/knockout/knockout-helpers");function b(b){b=b||{},this.height=a.observable(b.height),this.width=a.observable(b.width),this.percentageHeight=a.observable(b.percentageHeight),this.width=a.observable(b.percentageWidth)}return b});
define('platform/datasheets/layout/model/layout-location-model',['require','knockout','system/knockout/knockout-helpers'],function(require){"use strict";var a=require("knockout");require("system/knockout/knockout-helpers");function b(b){b=b||{},this.row=a.observable(b.row),this.column=a.observable(b.column),this.rowSpan=a.observable(b.rowSpan),this.columnSpan=a.observable(b.columnSpan),this.x=a.observable(b.x),this.y=a.observable(b.y)}return b});
define('platform/datasheets/layout/model/layout-element-model',['require','jquery','knockout','./layout-size-model','./layout-location-model','system/knockout/knockout-helpers'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("./layout-size-model"),d=require("./layout-location-model");require("system/knockout/knockout-helpers");function e(f){var g;f=f||{},this.controlName=b.observable(f.controlName),this.name=b.observable(f.name),this.parentName=b.observable(f.parentName),this.type=b.observable(f.type),this.visible=b.observable(f.visible),this.caption=b.observable(f.caption||f.defaultCaption),this.defaultCaption=b.observable(f.defaultCaption),this.captionVisible=b.observable(f.captionVisible),this.captionPosition=b.observable(f.captionPosition),this.children=b.observableArray(),f.children&&f.children.length>0&&(g=a.map(f.children,function(a){return new e(a)}),this.children(g)),this.size=b.observable(new c(f.size)),this.location=b.observable(new d(f.location)),this.captionSize=b.observable(new c(f.captionSize))}return e});
define('platform/datasheets/layout/model/datasheet-layout-model',['require','jquery','knockout','./layout-element-model','system/knockout/knockout-helpers'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("./layout-element-model");require("system/knockout/knockout-helpers");function d(d){var e;d=d||{},d.elements=d.elements||[],e=a.map(d.elements,function(a){return new c(a)}),this.elements=b.observableArray(e)}return d});
define('platform/datasheets/layout/model/datasheet-model',['require','jquery','knockout','./datasheet-layout-model','system/globalization/translator','system/knockout/knockout-helpers'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("./datasheet-layout-model"),d=require("system/globalization/translator");require("system/knockout/knockout-helpers");function e(e){e=e||{},this.key=b.observable(e.key),this.id=b.observable(e.id),this.caption=b.observable(e.caption),this.defaultCaption=b.observable(e.defaultCaption),this.description=b.observable(e.description),this.familyKey=b.observable(e.familyKey),this.familyType=b.observable(e.familyType),this.familyID=b.observable(e.familyID),this.isCustomForm=b.observable(e.isCustomForm),this.isMasterDetail=b.observable(e.isMasterDetail),this.isDefault=b.observable(e.isDefault),this.lastViewed=b.observable(e.lastViewed),this.sections=b.observable(e.sections),this.updateUser=b.observable(e.updateUser),this.updateDate=b.observable(e.updateDate),this.translator=Object.resolve(d),this.title=b.observable(this.translator.translate("DS_DATASHEET_TITLE")),b.bindingHandlers.warningMsg={
init:function(b,c){a(b).tooltip({content:c(),html:!0})},update:function(b,c){a(b).tooltip({content:c(),html:!0,tooltipClass:"warning-messsage-popup"})}},e.layout?this.layout=new c(e.layout):e.columns&&(this.columns=e.columns)}return e});
define('platform/datasheets/layout/adapters/datasheet-adapter',['require','../services/dto/datasheet-dto','../model/datasheet-model'],function(require){"use strict";var a=require("../services/dto/datasheet-dto"),b=require("../model/datasheet-model");function c(){}return c.toModelObject=function a(c){return new b(c)},c.toDTO=function b(c){var d=new a;return d.key=c.key(),d.id=c.id(),d.caption=c.caption(),d.defaultCaption=c.defaultCaption(),d.description=c.description(),d.familyKey=c.familyKey(),d.familyType=c.familyType(),d.familyID=c.familyID(),d.isCustomForm=c.isCustomForm(),d.isDefault=c.isDefault(),d.sections=c.sections(),d.updateUser=c.updateUser(),d.updateDate=c.updateDate(),d.title=c.title(),d},c});
define('application/export-service',['require','lodash','jquery','system/http/ajax-client','application/application-context','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c="api/core/uiexport",d=require("system/http/ajax-client"),e=require("application/application-context");require("system/lang/object");function f(){var a=this;a.ajaxClient=Object.resolve(d),a.baseURL=a.ajaxClient.url(c),a.sessionID=e.session.id}return f.prototype.exportPage=function c(d,e,f){var g=this;e=e?e:"pdf",f+="."+e;var h=b("#shell-screen > .content-wrapper > .content"),i=b(h).width();b(h).width("1200px"),b(document).trigger("resize"),a.delay(function(){var a=b(h)[0].outerHTML;b(h).width(i),b(document).trigger("resize"),g.exportCall(a,d,e,f)},100)},f.prototype.exportCall=function d(e,f,g,h){var i=b("link"),j={htmlString:e,cssLinks:a.map(i,function(a){return a.outerHTML}),hiddenHtmlSelector:["button"],avoidPageBreaks:[".avoid-page-break"],addPageBreakBefore:[".add-page-break-before"],addPageBreakAfter:[".add-page-break-after"],orientation:"landscape"}
;j.orientation=f.orientation?f.orientation:j.orientation,j.htmlString=f.htmlString?f.htmlString:j.htmlString,f.cssLinks&&b.each(f.cssLinks,function(a,b){j.cssLinks.push(b)}),f.hiddenHtmlSelector&&b.each(f.hiddenHtmlSelector,function(a,b){j.hiddenHtmlSelector.push(b)}),f.avoidPageBreaks&&b.each(f.avoidPageBreaks,function(a,b){j.avoidPageBreaks.push(b)}),f.addPageBreakBefore&&b.each(f.addPageBreakBefore,function(a,b){j.addPageBreakBefore.push(b)}),f.addPageBreakAfter&&b.each(f.addPageBreakAfter,function(a,b){j.addPageBreakAfter.push(b)});var k=b('<form method="POST" action="'+c+'">');b.each(j,function(a,b){var c=document.createElement("input");c.setAttribute("name",a),c.setAttribute("value",b),k.append(c)});var l=document.createElement("input");l.setAttribute("name","type"),l.setAttribute("value",g),k.append(l);var m=document.createElement("input");m.setAttribute("name","fileName"),m.setAttribute("value",h),k.append(m),b("body").append(k),k.submit()},f});
define('platform/datasheets/layout/model/datasheet-field-info-model',[],function(){"use strict";function a(a){a=a||{},this.fieldKey=a.fieldKey,this.fieldId=a.fieldId,this.inputType=a.inputType,this.maxLength=a.maxLength,this.isActive=a.isActive}return a});
define('platform/datasheets/layout/adapters/datasheet-field-info-adapter',['require','../services/dto/datasheet-field-info-dto','../model/datasheet-field-info-model'],function(require){"use strict";var a=require("../services/dto/datasheet-field-info-dto"),b=require("../model/datasheet-field-info-model");function c(){}return c.toModelObject=function a(c){return new b(c)},c.toDTO=function b(c){var d=new a;return d.fieldKey=c.fieldKey,d.inputType=c.inputType,d.maxLength=c.maxLength,d.isActive=c.isActive,d},c});

define('text!platform/datasheets/error-dialog/ui/views/error-dialog.html',[],function () { return '<div style="height:400px;">\r\n  \r\n        <div>\r\n            <h4 data-bind="text: $root.translate(\'DS_ERROR_WHILE_SAVING_RECORDS_MESSAGE\')"></h4>\r\n        </div>\r\n\r\n        <div class="table-responsive" style="font-size:12px; max-height:400px;height:calc(100% - 100px); overflow:auto;">\r\n\r\n            <table class="table table-bordered">\r\n                <thead>\r\n                    <tr>\r\n                        <th data-bind="text: $root.translate(\'DS_ID\')"></th>\r\n                        <th data-bind="text: $root.translate(\'DS_ERROR\')"></th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody data-bind="foreach:errors">\r\n                    <tr>\r\n                        <td data-bind="text:$data.id"></td>\r\n                        <td data-bind="text:$data.errorMessage"></td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n\r\n   \r\n    <div style="height:50px;padding:5px;">\r\n        <button type="button" class="btn btn-primary pull-right" data-bind="click:closeError, text: $root.translate(\'DS_CLOSE\')"></button> \r\n    </div>\r\n    \r\n</div>';});

define('platform/datasheets/error-dialog/ui/error-dialog-view-model',['require','knockout','spa/ko/knockout-view-model','text!./views/error-dialog.html','system/lang/event','system/globalization/translator'],function(require){"use strict";var a=require("knockout"),b=require("spa/ko/knockout-view-model"),c=require("text!./views/error-dialog.html"),d=require("system/lang/event"),e=require("system/globalization/translator");function f(b){g.call(this,c),this.errors=a.observableArray(),this.closeDialog=new d,this.translator=Object.resolve(e),this.populateErrors(b)}var g=Object.inherit(b,f);return f.prototype.populateErrors=function a(b){var c=0,d=this;for(c=0;c<b.length;c++)d.errors.push({id:b[c].id,errorMessage:b[c].errorMessage})},f.prototype.attach=function a(b){g.prototype.attach.call(this,b),this.region=b},f.prototype.detach=function a(b){g.prototype.attach.call(this,b)},f.prototype.closeError=function a(){this.closeDialog.raise()},f.prototype.translate=function a(b){return this.translator.translate(b)},f});
define('platform/datasheets/layout/ui/utils',['require','jquery','system/error/error-message','platform/datasheets/error-dialog/ui/error-dialog-view-model','system/ui/dialog-view-model'],function(require){"use strict";var a=require("jquery"),b=require("system/error/error-message"),c=require("platform/datasheets/error-dialog/ui/error-dialog-view-model"),d=require("system/ui/dialog-view-model");function e(){}e.prototype.setErrorAndReturnErrorFlag=function a(b,c,d){var e=!1,f=!1;return"form"===b?this.setErrorAndReturnErrorFlagForForm(b,c):"bulk"===b?this.setErrorAndReturnErrorFlagForBulk(b,c,d):"mdf"===b?(e=this.setErrorAndReturnErrorFlagForForm(b,c),f=this.setErrorAndReturnErrorFlagForBulk(b,c,d),e||f):void 0},e.prototype.setErrorAndReturnErrorFlagForForm=function a(b,c){for(var d=!1,e,f,g,h=c.entity.fields,m=0;m<h.length;m++)h.models[m].attributes.isRequired===!0&&(""===h.models[m].attributes.value&&(g=h.models[m].attributes.id,f=i(c,h,m,!1),c.appEvents.errorOccured.raise(null,f),e=j(c,g),e&&k(c,e),d=!0),""!==h.models[m].attributes.errorMessage&&(d=!0)),"Date"===h.models[m].attributes.dataType&&""!==h.models[m].attributes.errorMessage&&(f=i(c,h,m,!0),
c.appEvents.errorOccured.raise(null,f),d=!0);return d&&"mdf"===b&&l("master",c),d},e.prototype.setErrorAndReturnErrorFlagForBulk=function a(b,c,d){var e,h,i,j,k=!1,m=[];for(h=0;d&&h<d.length;h++)for(e=d[h].fields,i=0;i<e.length;i++)e.models[i].attributes.isRequired===!0&&(""===e.models[i].attributes.value&&(g(c,m,d[h].id,e.models[i].attributes.caption,!1),k=!0),""!==e.models[i].attributes.errorMessage&&(g(c,m,d[h].id,e.models[i].attributes.caption,!1),k=!0)),"Date"===e.models[i].attributes.dataType&&e.models[i].attributes.errorMessage===c.translator.translate("FORMAT_IS_NOT_VALID")&&(g(c,m,d[h].id,e.models[i].attributes.caption,!0),k=!0);return k&&(f(c,m),"mdf"===b&&l("detail",c)),k},e.prototype.clearAllErrorNotifications=function a(b){b.containerEl&&b.containerEl.find("i.icon-riskmatrix-exclamation").remove()};function f(a,b){var e,f;e=new c(b),f=new d(e,a.translator.translate("DS_ERROR_REPORT")),e.closeDialog.add(h.bind(null,f)),f.show()}function g(a,b,c,d,e){e?b.push({id:c,
errorMessage:d+" "+a.translator.translate("FORMAT_IS_NOT_VALID")}):b.push({id:c,errorMessage:d+" "+a.translator.translate("DS_REQ")})}function h(a){a.closeDialog()}function i(a,c,d,e){var f=2,g,h,i;return e?(g=c.models[d].attributes.caption+" "+a.translator.translate("FORMAT_IS_NOT_VALID"),h=c.models[d].attributes.caption+" "+a.translator.translate("FORMAT_IS_NOT_VALID"),i=new b(f,g,h)):(g=c.models[d].attributes.caption+" "+a.translator.translate("DS_REQ"),h=c.models[d].attributes.caption+" "+a.translator.translate("DS_REQ"),i=new b(f,g,h)),i}function j(a,b){if(a.containerEl.find("div[data-controlname='"+b+"']").closest("div.tab-pane").length>0){return"."+a.containerEl.find("div[data-controlname='"+b+"']").closest("div.tab-pane").attr("class").split(" ")[0]}}function k(a,b){m(a,b)||a.containerEl.find("a[data-target='"+b+"']").append('<i class="icon-riskmatrix-exclamation"></i>'),a.containerEl.find(".icon-riskmatrix-exclamation").css("color","red")}function l(a,b){
var c=b.containerEl.find('mi-tab[value="'+a+'"]');c.find(".icon-riskmatrix-exclamation").length||(c.find('td[class="tdtxtcenter"]').append('<span><i class="icon-riskmatrix-exclamation"></i></span>'),c.find(".icon-riskmatrix-exclamation").css({color:"red","vertical-align":"sub"}))}function m(b,c){var d=!1,e=b.containerEl.find("a[data-target='"+c+"']");return a(e).find("i").length>0&&(d=!0),d}return e});
define('ui/elements/ref-doc/services/service',['require','jquery','system/lang/object','system/http/ajax-client'],function(require){"use strict";var a=require("jquery");require("system/lang/object");var b=require("system/http/ajax-client"),c="api/common/referencedocuments/",d="api/core/metadata/",e="api/core/entity/";function f(a){this.ajaxClient=a}f.dependsOn=[b],f.prototype.getRefDocs=function(b){var c=a.Deferred(),d=e+"refdoc/"+b;return this.ajaxClient.get(d,{}).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a.statusText)}),c.promise()},f.prototype.getSiteKey=function(b){var c=a.Deferred(),d=e+"sitekey/"+b;return this.ajaxClient.get(d,{}).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a.statusText)}),c.promise()},f.prototype.unlinkRefDoc=function(b,d){var e=a.Deferred(),f=c+"refdocunlink/"+b+"/"+d;return this.ajaxClient.delete(f,{}).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a.statusText)}),e.promise()},f.prototype.delteRefDoc=function(b){var d=a.Deferred(),e=c+"delete/"+b;return this.ajaxClient.delete(e,{}).done(function(a){d.resolve(a)
}).fail(function(a){d.reject(a.statusText)}),d.promise()},f.prototype.addRefDoc=function(b,c){var d=a.Deferred(),f=e+"refdocinsertnlink/"+b,g={refDoc:c},h=c;return h.entityModified=null,h.entitySaved=null,h.entityDeleted=null,h.entityIdChanged=null,h.entityChangedEvent=null,this.ajaxClient.post(f,h).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a.statusText)}),d.promise()},f.prototype.linkRefDocEnntity=function(b,c){var d=a.Deferred(),f=e+"refdoclink/"+b+"/"+c;return this.ajaxClient.post(f).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a.statusText)}),d.promise()},f.prototype.openRefDoc=function(b,d){var e=a.Deferred(),f=c+"refdocopen/"+b;return this.ajaxClient.getBinary(f).done(g.bind(null,d)).fail(i.bind(null,e)),e.promise()},f.prototype.getAllRefDocByRelatedEntyKey=function(b){var d=a.Deferred(),e=c+b;return this.ajaxClient.get(e,{}).done(m.bind(null,d)).fail(i.bind(null,d)),d.promise()};function g(a,b){
if(navigator.msSaveBlob)navigator.msSaveOrOpenBlob(b,a.documentPath);else if("undefined"!=typeof cordova){var c=h(a.documentPath);cordova.writeBinaryToLocalFile(b,c,cordova.openLocalFile.bind(null,c))}else{var d=window.URL.createObjectURL(b);window.open(d)}}function h(a){var b=a.split("\\");return b[b.length-1]}function i(a,b){console.log(b),a.reject(b)}function j(a,b){var c="data:"+b+";base64,"+escape(a);return window.open(c,"_blank"),!0}f.prototype.getRefDocType=function(b){var d=a.Deferred(),e=c+"refdoctype/"+b;return this.ajaxClient.get(e,{}).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a.statusText)}),d.promise()},f.prototype.saveRefDoc=function(b,c){var d=a.Deferred(),f=e,g=c;return g.entityModified=null,g.entitySaved=null,g.entityDeleted=null,g.entityIdChanged=null,g.entityChangedEvent=null,this.ajaxClient.put(f,g).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a.statusText)}),d.promise()},f.prototype.uploadRefDoc=function(b,d){
var e=a.Deferred(),f=JSON.parse(sessionStorage.getItem("meridium-session")).id,g=c+"refdocupload/"+d,h,i;return b.append("sessionid",f),i=this.ajaxClient.baseUrl()+c+"refdocupload/"+d,h={data:b,cache:!1,contentType:!1,processData:!1},this.ajaxClient.post(i,"",h).done(function(a){e.resolve(a)}).fail(function(a,b,c){e.reject(b)}),e.promise()},f.prototype.getBaseUrl=function(){return this.ajaxClient.baseUrl()},f.prototype.refDocServerCredentialsExist=function(){var b=a.Deferred();return this.ajaxClient.get("api/refdoc-server/config").done(k.bind(null,b)).fail(l.bind(null,b)),b.promise()},f.prototype.getRefDocSize=function b(d){var e=a.Deferred();return this.ajaxClient.get(c+"refdocsize/"+d).done(function(a){e.resolve(a)}).fail(function(){e.reject()}),e.promise()};function k(a,b){var c=!1;""!==b.userName&&""!==b.userPassword&&(c=!0),a.resolve(c)}function l(a,b){a.reject(b)}function m(a,b){var c=0,d=0,e=[],f=[];for(c=0;c<b.columns.length;c++){var g={}
;"-1"===b.columns[c].famliyMappingIndex.toString()?g.id=b.columns[c].uniqueId:(b.columns[c].id.indexOf("[")>-1&&(b.columns[c].id=b.columns[c].id.replace(/[\[\]']+/g,"")),g.id=b.columns[c].id),void 0!==b.columns[c].alias&&""!==b.columns[c].alias?g.alias=b.columns[c].alias:g.alias=b.columns[c].id,g.visible=b.columns[c].isVisible,"MI_SITE_KEY"!==g.id&&"ENTY_KEY"!==g.id&&"MI_REF_DOCUMENTS_STORE_DOCUM_L"!==g.id&&"MIRD_DOC_PATH_CHR"!==g.id&&"MI_REF_DOCUMENTS_DOCUM_EXTEN_C"!==g.id||(g.visible=!1),"CTIT_ID"===g.id&&(g.hasCellTemplate="true");var h=b.columns[c].typeName;"System.Int64"===h||"System.Double"===h?g.dataType="number":"System.DateTime"===h&&(g.dataType="date"),e.push(g)}for(c=0;c<b.rowColumns.length;c++){var i={};for(d=0;d<e.length;d++)i[e[d].id]=null===b.rowColumns[c].values[d]?"":b.rowColumns[c].values[d];f.push(i)}a.resolve({columns:e,data:f})}return f});

define('text!system/error/views/error-detail-view.html',[],function () { return '<div class="error-detail-wrapper">\r\n    <div class="block-group">\r\n        <div class="error-code error-header error-header-code block" data-bind="text: translate(\'ERROR_CODE\')"></div>\r\n    </div>\r\n\r\n    <div class="block-group">\r\n        <div data-bind="text:code" class="error-code block"></div>\r\n    </div>\r\n\r\n    <div class="block-group error-message-group">\r\n        <div class="error-message error-header error-header-message block" data-bind="text: translate(\'MESSAGE\')"></div>\r\n        <div data-bind="html:message" class="error-message block"></div>\r\n    </div>\r\n\r\n    <!-- ko if: detail -->\r\n    <div class="block-group error-message-detail">\r\n        <div class="error-url error-header error-header-url block" data-bind="text: translate(\'DETAILS\')"></div>\r\n        <pre data-bind="html:detail" class="error-url error-body-url block"></pre>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <section class="button-align">\r\n        <div class="btn btn-primary error-dialog-close" data-bind="text: translate(\'OK\')"></div>\r\n    </section>\r\n</div>';});

define('system/error/error-detail-view-model',['require','text!./views/error-detail-view.html','system/globalization/translator','spa/ko/knockout-view-model'],function(require){"use strict";var a=require("text!./views/error-detail-view.html"),b=require("system/globalization/translator"),c=require("spa/ko/knockout-view-model");function d(c){e.call(this,a),this.errorMessage=c,this.translator=Object.resolve(b)}var e=Object.inherit(c,d);d.prototype.attach=function a(b){this.code=this.errorMessage.code,this.message=this.errorMessage.message;try{this.detail=f(g(this.errorMessage.detail))||null}catch(a){this.detail=this.errorMessage.detail||null}e.prototype.attach.call(this,b)},d.prototype.detach=function a(b){e.prototype.detach.call(this,b)},d.prototype.translate=function(a){return this.translator.translate(a)};function f(a){return JSON.stringify(JSON.parse(a),null,"\t")}function g(a){return a.split("<").join("&lt;").split("<").join("&gt;").split("\\r\\n").join("<br/>").split("\\n").join("<br/>")}return d});
define('logging/feedback-component/feedback-component',['require','jquery','toastr','system/error/error-detail-view-model','system/error/error-message','system/globalization/translator','system/ui/dialog-view-model'],function(require){"use strict";var a=require("jquery"),b=require("toastr"),c=require("system/error/error-detail-view-model"),d=require("system/error/error-message"),e=require("system/globalization/translator"),f=require("system/ui/dialog-view-model");function g(a){b.options={positionClass:"toast-top-center",timeOut:"10000",hideDuration:"1000",closeButton:!0}}g.prototype.info=function a(c,d){k(),b.info(c,d)},g.prototype.warning=function a(c,d){k(),b.warning(c,d)},g.prototype.success=function a(c,d){k(),b.success(c,d)},g.prototype.error=function a(d,e){var g=new c(d),h=j("ERROR")+" - "+d.code,k=new f(g,h,{height:"90%"});b.options.onclick=function(){k.show(),i(k)},b.options.onHidden=l,b.error(d.message,e)},g.prototype.errorMessageFromResponse=function(a){var b=new d(0,h(a.responseText));g.prototype.error(b)},g.prototype.errorMessageFromResponseWithDetails=function(a,b){var c=new d(0,h(b.responseText),a);g.prototype.error(c)},g.prototype.errorDetailsFromResponse=function(a,b){
var c=new d(0,a,h(b.responseText));g.prototype.error(c)},g.prototype.clear=function a(){b.clear()};function h(a){return'"'===a[0]&&'"'===a[a.length-1]&&(a=a.substring(1,a.length-1)),a}function i(b){a(".error-dialog-close").click(function(){b.closeDialog()})}function j(a){return Object.resolve(e).translate(a)}function k(){b.options.onclick=null}function l(){k(),b.options.onHidden=null}return g});
define('ui/elements/ref-doc/view-models/downloaders/base-downloader',["require","exports","system/diagnostics/log-manager","system/lang/ioc","system/globalization/translator","logging/feedback-component/feedback-component"],function(require,exports,a,b,c){"use strict";var d=require("logging/feedback-component/feedback-component"),e=function(){function e(a){this.indicator=a}return e.prototype.tryShowIndicator=function(){this.indicator&&this.indicator.show()},e.prototype.tryHideIndicator=function(){this.indicator&&this.indicator.hide()},e.prototype.showFailureToast=function(){var a=b.resolve(c);new d({closeButton:!0,timeOut:"200",hideDuration:"200"}).error({code:"0",message:a.translate("REFDOCS_FAILED_TO_OPEN_DOCUMENT")}),this.logError(new Error("failed to get ref doc type"))},e.prototype.logError=function(b){a.getLogger("app/ui/ref-doc/view-models/downloaders/base-downloader.ts").error(b.stack)},e}();exports.BaseDownloader=e});
define('ui/elements/ref-doc/view-models/downloaders/parsers/session-parser',["require","exports"],function(require,exports){"use strict";function a(){var a=sessionStorage.getItem("meridium-session"),b;return a&&(b=JSON.parse(a)),b}exports.getSession=a});
define('ui/elements/ref-doc/view-models/downloaders/builders/form-builder',["require","exports","system/http/ajax-client","system/lang/ioc","ui/elements/ref-doc/view-models/downloaders/parsers/session-parser"],function(require,exports,a,b,c){"use strict";var d=function(){function d(){}return d.prototype.getFormElement=function(d){var e=b.resolve(a),f="api/common/referencedocuments/refdocdownload/"+d,g=c.getSession().id,h=e.url(f);return $('<form action="'+h+'" method="post" enctype="application/x-www-form-urlencoded" target="_blank">'+this.getInputElement(g)+"</form>")},d.prototype.getInputElement=function(a){return'<input type="hidden" name="data" value="'+encodeURIComponent(JSON.stringify({sessionid:a}))+'"/>'},d}();exports.FormBuilder=d});
define('ui/elements/ref-doc/view-models/downloaders/desktop-downloader',["require","exports","ui/elements/ref-doc/view-models/downloaders/base-downloader","ui/elements/ref-doc/view-models/downloaders/builders/form-builder","ui/elements/ref-doc/view-models/downloaders/parsers/session-parser"],function(require,exports,a,b,c){"use strict";var d=function(a){__extends(d,a);function d(){return a.call(this)||this}return d.prototype.download=function(a){c.getSession()?this.downloadDesktop(a):this.logError(new Error("No session present.  Failed to download reference document."))},d.prototype.downloadDesktop=function(a){(new b.FormBuilder).getFormElement(a).appendTo("body").submit().remove()},d}(a.BaseDownloader);exports.DesktopDownloader=d});
define('ui/elements/ref-doc/view-models/downloaders/mobile-downloader',["require","exports","system/lang/ioc","ui/elements/ref-doc/view-models/downloaders/base-downloader","ui/elements/ref-doc/services/service"],function(require,exports,a,b){"use strict";var c=require("ui/elements/ref-doc/services/service"),d=function(b){__extends(d,b);function d(d){var e=b.call(this,d)||this;return e.refDocService=a.resolve(c),e}return d.prototype.download=function(a){var b=this;this.tryShowIndicator(),this.refDocService.getRefDocType(a).done(function(c){"URL"===c.type?b.openNetworkDocumentInBrowser(c):b.openDocumentOnDevice(a,c)}).fail(this.showFailureToast)},d.prototype.openNetworkDocumentInBrowser=function(a){window.cordova.InAppBrowser.open(a.documentPath,"_blank"),this.tryHideIndicator()},d.prototype.openDocumentOnDevice=function(a,b){this.refDocService.openRefDoc(a,b).fail(this.showFailureToast),this.tryHideIndicator()},d}(b.BaseDownloader);exports.MobileDownloader=d});
define('ui/elements/ref-doc/view-models/downloaders/factory/platform-downloader-factory',["require","exports","ui/elements/ref-doc/view-models/downloaders/desktop-downloader","ui/elements/ref-doc/view-models/downloaders/mobile-downloader"],function(require,exports,a,b){"use strict";function c(a,b){return a.isMobileApp()?e(b):d()}exports.createPlatformDownloader=c;function d(){return new a.DesktopDownloader}function e(a){return new b.MobileDownloader(a)}});
define('ui/elements/ref-doc/view-models/downloaders/downloader',["require","exports","system/hardware/device","system/lang/ioc","ui/elements/ref-doc/view-models/downloaders/factory/platform-downloader-factory"],function(require,exports,a,b,c){"use strict";return function(){function d(a){this.indicator=a}return d.prototype.download=function(d,e){var f=b.resolve(a),g=c.createPlatformDownloader(f,this.indicator);this.tryStopPropagation(e),g.download(d)},d.prototype.tryStopPropagation=function(a){a&&a.stopPropagation()},d}()});
define('platform/datasheets/layout/ui/helpers/ref-doc-helper',['require','exports','module','jquery','ui/elements/ref-doc/services/service','system/globalization/translator','ui/elements/ref-doc/view-models/downloaders/downloader'],function(require,exports,module){"use strict";var a=require("jquery"),b=require("ui/elements/ref-doc/services/service"),c=require("system/globalization/translator"),d=require("ui/elements/ref-doc/view-models/downloaders/downloader");function e(){this.refDocService=Object.resolve(b),this.translator=Object.resolve(c)}e.prototype.showRefDocs=function a(b,c){b.datasheetReference.raise(),b.isDatasheetRendered(!1),b.isRefDocRendered(!0),b.isMasterDatasheet()&&f(b),c?(b.region.$element.find(".ref-doc-container").append(c),b.refdocEl=c):(b.region.$element.find(".ref-doc-container").append('<mi-ref-doc showicon="true" entitykey="'+b.entykey()+'"></mi-ref-doc>'),b.refdocEl=b.region.$element.find("mi-ref-doc")[0]),Element.upgrade(b.refdocEl),b.refdocEl.refDocCB(b.hideRefDocs.bind(b,b.isDatasheetReadOnly())),b.isDatasheetReadOnly(!1),b.refDocsRendered.raise(b.refdocEl)};function f(b){var c=b.region.$element.parents(".master-detail-datasheet-layout-container")
;a(c).find("> .datasheet-nav").toggle(),a(c).find("> .mdf-tab-header").toggle()}return e.prototype.hideRefDocs=function a(b,c,d){b.isMasterDatasheet()&&f(b),b.region.$element.find(".ref-doc-container").empty(),b.refDocCount(d),b.isDatasheetRendered(!0),b.addMoreOptionsForIcons(),b.isRefDocRendered(!1),b.isDatasheetReadOnly(c),b.refDocsHidden.raise()},e.prototype.downloadRefDoc=function a(b,c,e){(new d).download(c,e)},e});
define('ui/elements/ref-doc/models/refdoc-path-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.isStored=a.toBoolean(b.isStored),this.isUrl=a.toBoolean(b.isUrl),this.isUnc=a.toBoolean(b.isUnc),this.path=a.toString(b.path),this.formData=a.toObject(b.formData,null)}return b});
define('ui/elements/ref-doc/models/refdoc-path-model',['require','knockout','system/lang/object'],function(require){"use strict";var a=require("knockout");require("system/lang/object");function b(b){var c=this;b=b||{},c.isStored=a.observable(b.isStored),c.isUrl=a.observable(b.isUrl),c.isUnc=a.observable(b.isUnc),c.path=a.observable(b.path),c.formData=b.formData}return b});
define('ui/elements/ref-doc/models/refdoc-path-adapter',['require','./refdoc-path-dto','./refdoc-path-model'],function(require){"use strict";var a=require("./refdoc-path-dto"),b=require("./refdoc-path-model");function c(){}return c.toModel=function a(c){return new b(c)},c.toDTO=function b(c){var d=new a;return c=c||{},d.isStored=c.isStored(),d.isUrl=c.isUrl(),d.isUnc=c.isUnc(),d.path=c.path(),d.formData=c.formData,d},c});
define('system/ui/busy-indicator',['require','scopedQuerySelector'],function(require){"use strict";require("scopedQuerySelector");function a(a){this.container=null,this.loaderClassName=a||null,this.displayCache=null,this.positionCache=null}a.prototype.attachTo=function(a){a&&(this.displayCache=a.style.overflow,this.positionCache=a.style.position,b(this,a))},a.prototype.detach=function(){this.container=null,this.loaderClassName=null,this.displayCache=null,this.positionCache=null},a.prototype.show=function(){var a,b;if(this.container)for(this.container.style.overflow="hidden",this.container.style.position=this.positionCache?this.positionCache:"relative",a=this.container.querySelectorAll(":scope > .busy-indicator-wrap"),b=0;b<a.length;b++)a[b].style.display="block"},a.prototype.hide=function(){var a,b;if(this.container)for(this.displayCache?this.container.style.overflow=this.displayCache:this.container.style.overflow="",this.positionCache?this.container.style.position=this.positionCache:this.container.style.position="",
a=this.container.querySelectorAll(":scope > .busy-indicator-wrap"),b=0;b<a.length;b++)a[b].style.display="none"};function b(a,b){if(a.container=b,!a.container.querySelector(":scope > .busy-indicator-wrap")){var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div"),f=a.container.getBoundingClientRect();c.classList.add("busy-indicator-wrap"),c.style.display="none",d.classList.add("busy-indicator"),a.loaderClassName?e.classList.add(a.loaderClassName):a.container.offsetWidth<640?e.classList.add("loading-small"):a.container.offsetWidth<1024&&a.container.offsetWidth>641?e.classList.add("loading-med"):a.container.offsetWidth<1440&&a.container.offsetWidth>1025?e.classList.add("loading-large"):a.container.offsetWidth>1441?e.classList.add("loading-extra-large"):e.classList.add("loading-med"),c.appendChild(d),d.appendChild(e),a.container.appendChild(c),c.style.top=a.container.clientTop+"px",c.style.left=a.container.clientLeft+"px"}}return a});
define('platform/datasheets/layout/ui/helpers/js-module-helper',['require','jquery','lodash','ui/elements/ref-doc/models/refdoc-path-adapter','system/ui/busy-indicator'],function(require){"use strict";var a=require("jquery"),b=require("lodash"),c=require("ui/elements/ref-doc/models/refdoc-path-adapter"),d=require("system/ui/busy-indicator");function e(){}e.prototype.showJSModule=function a(b,c){f(b,c)};function f(a,b){require([b.jsModuleName],function(c){var d;if("form"===b.type)d=new c,b.jsModuleUseApply?d.show.apply(d,b.jsModuleParams).done(g.bind(null,a,b)):d.show(b.jsModuleParams,a.entityReference,a.siteKey()).done(g.bind(null,a,b));else if("bulk"===b.type)d=new c,d.show(b.jsModuleParams).done(function(c){h(a,b,c),a.focusCell(b.data,a.rows(),b.cellIndex,b.rowIndex)}).fail(function(){a.focusCell(b.data,a.rows(),b.cellIndex,b.rowIndex)});else if("aggregate"===b.type){for(var e=null,f=0;f<a.entities().length;f++)for(var j=0;j<a.entities()[f].length;j++)if(a.entities()[f][j].clientid===b.clientID){e=a.entities()[f];break}d=new c(e),d.show(b.jsModuleParams).done(function(c){i(a,b,c),a.moveToNextModuleCell(b.data,a.rows(),b.cellIndex,b.rowIndex)
}).fail(function(c){c===!1&&a.moveToNextModuleCell(b.data,a.rows(),b.cellIndex,b.rowIndex)})}})}e.prototype.callOnFocus=function a(b,c,d){var e;"form"===c.type?(e=c.popJSModuleOnFocus)&&this.showJSModule(b,c):"bulk"!==c.type&&"aggregate"!==c.type||(e=d.popJSModuleOnFocus(),c={key:d.key(),jsModuleName:d.jsModuleName(),jsModuleParams:d.jsModuleParams(),entityKey:d.entityKey(),clientID:d.clientid(),type:c.type,cellIndex:c.cellIndex,rowIndex:c.rowIndex,fieldKey:c.fieldKey},e?this.showJSModule(b,c):b.focusCell(c.data,b.rows(),c.cellIndex,c.rowIndex))};function g(a,b,d){k(a);var e=0,f=[],g=null;for(a.currentEntity()&&(f=a.currentEntity().fieldValues()),e=0;e!==f.length;e++)if(f[e].key()===b.key){g=f[e];break}j(g,d),a.isReferenceDocument?a.refDocPathModel=c.toModel(d):d.isTeamModel&&(delete d.isTeamModel,a.teamModel=d)}function h(a,d,e){var f=0,g,h,i=[],k=null;for(a.entities()&&(g=b.find(a.entities(),function(a){return void 0===d.clientID?a.key===d.entityKey:a.clientid===d.clientID}),
i=g.fieldValues()),f=0;f!==i.length;f++)if(i[f].key().toString()===d.fieldKey||i[f].key()===d.fieldKey){k=i[f];break}j(k,e),a.entities()&&(h=b.find(a.rows(),function(a){return void 0===d.clientID?a.entitykey()===d.entityKey:a.clientid()===d.clientID}),h.refDocPathModel(c.toModel(e)))}function i(a,b,c){var d=0,e,f=[],g=null;if(a.entities()){for(var h=0;h<a.entities().length;h++)for(var i=0;i<a.entities()[h].length;i++){if("0"===a.entities()[h][i].key.toString()&&"0"===b.entityKey.toString()&&a.entities()[h][i].clientid.toString()===b.clientID.toString()){e=a.entities()[h][i];break}if("0"!==b.entityKey.toString()&&a.entities()[h][i].key.toString()===b.entityKey.toString()){e=a.entities()[h][i];break}}f=e.fieldValues()}for(d=0;d!==f.length;d++)if(f[d].key().toString()===b.fieldKey||f[d].key()===b.fieldKey){g=f[d];break}j(g,c)}function j(a,b){if(a){var c=JSON.stringify(b);b&&(c+="&parseValue=true"),a.value(c)}}function k(b){var c=!1
;a(".jsmodule-busy-indicator").find(".busy-indicator-wrap").remove();var e=Object.resolve(d);e.attachTo(b.region.element),e.show(),a(b.region.element).find(".loading-large").addClass("position-update"),a(b.region.element).find(".busy-indicator-wrap").addClass("jsmodule-busy-indicator"),b.fieldValueChanged.add(function(){c=!0}),b.entityReference.entityModified.add(function(){c&&(e.hide(),b.region&&a(b.region.element).find(".busy-indicator-wrap").remove(),c=!1)})}return e});

define('text!platform/datasheets/layout/ui/views/print-dialog-view.html',[],function () { return '<div class="datasheet-print-dialog-container">    \r\n        <div>            \r\n            <mi-radio data-bind="miRadioProperty: {checked: $root.selectedRadioButton, name: \'datasheet-print-dialog-radio1\', text: $root.translate(\'DS_DATASHEET_PRINT\'), value: 1}"></mi-radio>   \r\n        </div>\r\n        \r\n        <div>        \r\n            <mi-radio data-bind="miRadioProperty: {checked: $root.selectedRadioButton, name: \'datasheet-print-dialog-radio2\', text: $root.translate(\'DS_REPORT_PRINT\'), value: 2}"></mi-radio>\r\n        </div>\r\n\r\n        <div>\r\n            <mi-select data-bind="miproperty: {options: $root.options, optionsText: \'reportId\', value: $root.selectedOption, editable: false, disabled: $root.options().length === 0}"></mi-select>\r\n        </div>\r\n    <br/>\r\n    <div class="pull-right">\r\n        <button data-bind="click: $root.okButtonClicked, enable: $root.selectedRadioButton() === 1 || ($root.selectedRadioButton() === 2 && $root.selectedOption() && $root.selectedOption().reportId), text: $root.translate(\'DS_OK\')" class="btn btn-text"></button>\r\n        <button data-bind="click: $root.cancelButtonClicked, text: $root.translate(\'DS_CANCEL\')" class="btn btn-text"></button>\r\n    </div>\r\n</div>';});


define('text!ui/elements/radio/radio-template.html',[],function () { return '<script id="mi-radio-tmpl" type="text/html">\r\n    <div class="radio-container" tabindex="0">\r\n        <input type="radio" data-bind="checked: $root.checked,disable: $root.disable,value:$root.value, attr:{id:$data.id , name:$root.name, required:$root.required} " />\r\n        <label data-bind="attr:{for:$data.id}"></label>\r\n        <span class="radio-text" data-bind="text: $root.text, click: $data.textClick"></span>\r\n    </div>\r\n</script>';});

define('ui/elements/radio/radio-view-model',['require','lodash','jquery','text!./radio-template.html','knockout'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./radio-template.html"),d=require("knockout");d.bindingHandlers.miRadioProperty={createNodes:function(a,b){document.getElementById("mi-radio-tmpl")||document.body.insertAdjacentHTML("beforeend",c),d.applyBindingsToNode(a,{template:{name:"mi-radio-tmpl"}},b)},init:function(a,c){var e=c();return e.id=d.bindingHandlers.miRadioProperty.getGuid(),e.textClick=function a(c,d){if(b(d.target).parent().find('input[type="radio"]').prop("disabled"))return!1;b(d.target).parent().find("input").prop("checked",!0),b(d.target).parent().find("input").trigger("change"),"function"==typeof this.checked&&this.checked(this.value)},d.bindingHandlers.miRadioProperty.createNodes(a,e),{controlsDescendantBindings:!0}},getGuid:function a(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},s4:function a(){
for(var b="",c="abcdefghijklmnopqrstuvwxyz",d=0;d<4;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},update:function(c,e){var f;a.each(e(),function(a,e){f=d.unwrap(a),"disable"===e?b(c).find('input[type="radio"]').prop("disabled",f):"text"===e&&b(c).find(".radio-text").html(f)})}};var e=Object.create(HTMLElement.prototype);document.registerElement("mi-radio",{prototype:e})});

define('text!ui/elements/select/template.html',[],function () { return '<div class="mi-select-container" data-bind="event:{click:toggleOptions,\r\n                                                    mousedown:handleMouseDown},\r\n    css:{\'disabled\':disabled,\'open\':isOpen,\'required\': isRequired }">\r\n    <div data-bind="css:{\'active\':isOpen}" class="mi-dropdown-selector">\r\n        <div data-bind="visible:multiple,\r\n    event:{click:toggleSelectAll},\r\n    css:{\'dx-checkbox-indeterminate\':selectedOptions().length && selectedOptions().length !== options().length ,\r\n        \'dx-checkbox-checked\':selectedOptions().length === options().length}" \r\n             class="pull-left dx-select-checkbox dx-datagrid-checkbox-size dx-widget dx-checkbox" tabindex="0" onclick="void(0)">\r\n            <div class="dx-checkbox-container">\r\n                <span class="dx-checkbox-icon"></span>\r\n            </div>\r\n        </div>\r\n        <input type="text" class="mi-selected-value-text pull-left"\r\n               data-bind="value:text,\r\n    valueUpdate:\'keyup\',\r\n    attr:{\'readonly\':(!editable() || disabled() || multiple() || isMobile),\r\n           \'title\': text},\r\n    css:{\'multi\':multiple},\r\n    event: {keyup: handleKeyUpOnTextInput,\r\n            keydown:handleKeyDownOnTextInput,\r\n            click:handleKeyUpOnTextInput,\r\n            mousedown:handleKeyUpOnTextInput},\r\n    hasFocus:textFocus" /> \r\n        <i class="icon-arrow pull-right"></i>\r\n        <!--disable:(!editable() || disabled() || multiple())<span class="mi-selected-value-text pull-left" data-bind="text:selectedValueText()"></span> <span class="fa fa-angle-down pull-right"></span>-->\r\n    </div>\r\n\r\n</div>';});


define('text!ui/elements/select/options-template.html',[],function () { return '<div data-bind="visible:isOpen(),event:{mousedown:$root.handleMouseDown}" class="mi-select-options-container">\r\n\r\n    <p class="mi-select-caption" data-bind="visible:optionsCaption() && optionsCaption().trim(),text:optionsCaption,event:{\r\n                                    click:function(data,event){selectValue($root,null,event);}},\r\n                                    css:{\'mi-select-option\':optionsCaption}\r\n                                "></p>\r\n\r\n    <!-- ko ifnot:optionsGroup -->\r\n    <!-- ko foreach:filteredOptions -->\r\n    <p class="mi-select-option" data-bind="html:$parent.wrapOptionText($data),event:{\r\n                                                    click:function(data,event){$parent.selectValue($parent,data,event);}},\r\n                                                    css:{\'active\':$parent.isActive($data)},\r\n                                                    attr:{\'data-index\':$index()}">\r\n    </p>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- ko if:optionsGroup -->\r\n    <!-- ko foreach:Object.keys(filteredOptions()) -->\r\n\r\n    <strong class="mi-select-group-title" data-bind="text:$data,visible:$data !== \'undefined\',click:$root.handleMouseDown"></strong>\r\n    <!-- ko foreach:$root.filteredOptions()[$data] -->\r\n    <p class="mi-select-option" data-bind="html:$root.wrapOptionText($data),event:{\r\n                                                                            click:function(data,event){$root.selectValue($root,data,event);}},\r\n                                                                            css:{\'active\':$root.isActive($data)},\r\n                                                                            attr:{\'data-index\':$index()}">\r\n    </p>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</div>\r\n';});

define('system/knockout/bindings/halt-bindings',['require','knockout'],function(require){"use strict";var a=require("knockout");a.bindingHandlers["halt-bindings"]||(a.bindingHandlers["halt-bindings"]={init:function(){return{controlsDescendantBindings:!0}}});function b(a){return Element.build("div",a,null,{"data-bind":"halt-bindings: true"})}return{createElement:b}});
define('ui/elements/select/mi-property',['require','lodash','jquery','knockout'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d="property-changed-event-handlers",e=1;if(!c.bindingHandlers.miproperty){c.bindingHandlers.miproperty={init:function(e,f){var h,i=b(e),j={},k=g(f());a.each(k,function(b,c){h=function(b,d){var e=f()[c];a.isFunction(e)&&e(d)},j[c]=h,i.on("attributes."+c+":changed",h),i.on("properties."+c+":changed",h)}),c.utils.domData.set(e,d,j),c.utils.domNodeDisposal.addDisposeCallback(e,function(){var b=c.utils.domData.get(e,d);a.each(f(),function(a,c){i.off("attributes."+c+":changed",b[c]),i.off("properties."+c+":changed",b[c])})})},update:function(d,h){var i,j=g(h());f(d,!1),a.each(j,function(f,g){i=c.unwrap(f),"object"==typeof i&&!a.isEqual(b(d).data(g.toLowerCase()),i)||""===i?(b(d).data(g.toLowerCase(),i),b(d).attr("data-"+g.toLowerCase(),e),e++):(b(d).data(g.toLowerCase(),i),b(d).attr("data-"+g.toLowerCase(),i))}),f(d,!0)}};var f=function(a,d){if(b(a).find(".mi-select-container")[0]){
var e=c.contextFor(b(a).find(".mi-select-container")[0]).$data;e.propertiesUpdateDone&&e.propertiesUpdateDone(d)}},g=function(a){for(var b={},c=["addCaption","multiple","editable","value","selectedOptions","optionsCaption","optionsText","optionsValue","optionsGroup","disabled","required","options"],d=0;d<c.length;d++)void 0!==a[c[d]]&&(b[c[d]]=a[c[d]]);return b}}});
define('ui/elements/select/element',['require','lodash','jquery','jquery','knockout','system/lang/converter','system/knockout/knockout-manager','system/knockout/bindings/halt-bindings','./mi-property'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("jquery"),d=require("knockout"),e=require("system/lang/converter"),f=require("system/knockout/knockout-manager");require("system/knockout/bindings/halt-bindings"),require("./mi-property");function g(a,b){var c=Object.create(HTMLElement.prototype);c.createdCallback=function(){this.implementation=Object.resolve(b,this),this.implementation.element=this,Object.tryMethod(this.implementation,"created")},c.attachedCallback=function(){this.implementation&&Object.tryMethod(this.implementation,"attached")},c.detachedCallback=function(){this.implementation&&(Object.tryMethod(this.implementation,"detached"),this.implementation=null)},c.attributeChangedCallback=function(a,b,c){Object.tryMethod(this.implementation,a.toLowerCase()+"Changed",b,c)},c.getControl=function(){return this.implementation},Element.registerElement(a,{prototype:c})}var h=function(){function a(a,b,c){this.kom=Object.resolve(f),
this.properties=[],this.view=a,this.preserveContext=b||!1,this.appendAfterBindings=c||!1,this.container=null,this.element=null,this.state=null}a.prototype.created=function(){Object.tryMethod(this,"beforeCreated"),c(this),Object.tryMethod(this,"afterCreated")},a.prototype.attached=function(){Object.tryMethod(this,"beforeAttached"),e(this),Object.tryMethod(this,"afterAttached")},a.prototype.detached=function(){Object.tryMethod(this,"beforeDetached"),g(this),Object.tryMethod(this,"afterDetached"),this.kom.dispose(),this.kom=null,this.properties=null,this.view=null,this.preserveContext=null,this.appendAfterBindings=null,this.state=null,this.container=null},a.prototype.bindAttribute=function(a,c,d,e){var f=e||!1;this["data-"+a.toLowerCase()+"Changed"]=function(c,d){var e=b(this.element).data(a.toLowerCase());this[a]&&this[a](e)}.bind(this),this.kom.subscribe(this[a],function(c){f||b(this.element).trigger("attributes."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),
void 0===b(this.element).attr("data-"+a.toLowerCase())?this.element.setAttribute("data-"+a.toLowerCase(),c):this[a](b(this.element).data(a.toLowerCase()))},a.prototype.bindProperty=function(a,c,d,e){this[a]=this.kom.observable();var f=e||!1;Object.defineProperty(this.element,a,{get:function(){return this[a]()}.bind(this),set:function(b){this[a]&&this[a](b)}.bind(this)}),this.properties.push(a),this.kom.subscribe(this[a],function(c){f||b(this.element).trigger("properties."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),this[a](Object.defaultValue(this.element[a],c))},a.prototype.bindArrayProperty=function(a,c,d,e){this[a]=this.kom.observableArray();var f=e||!1;Object.defineProperty(this.element,a,{get:function(){return this[a]()}.bind(this),set:function(b){this[a](b)}.bind(this)}),this.properties.push(a),this.kom.subscribe(this[a],function(c){f||b(this.element).trigger("properties."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),
this[a](Object.defaultValue(this.element[a],c))};function c(a){a.state="created";var c=document.createElement("div"),d=b(c),e=b(a.view);a.preserveContext||d.attr("data-bind","halt-bindings"),d.append(e),a.appendAfterBindings||b(a.element).empty().append(d),a.container=c}function e(a){if("detached"===a.state){var c=document.createElement("div"),e=b(c),f=b(a.view);a.preserveContext||e.attr("data-bind","halt-bindings"),e.append(f),a.appendAfterBindings||b(a.element).empty().append(e),a.container=c}a.state="attached",d.applyBindingsToDescendants(a,a.container),a.appendAfterBindings&&b(a.element).empty().append(a.container)}function g(a){a.state="detached",d.cleanNode(a.container),b(a.container).remove()}function h(a,b){delete a[b]}return a}();function i(b,d){window.CustomElements&&(window.CustomElements.useNative||(a.isArray(b)?j(b,d):a.isString(b)?k(b,d):b instanceof c?l(b):m(b)))}function j(a,b){for(var c=0;c!==a.length;c++)i(a[c],b)}function k(a,c){c&&c.$element&&(c=c.$element),
l(b(a,c))}function l(a){a.each(function(a,b){m(b)})}function m(a){window.CustomElements.upgrade(a)}function n(b,c,d,e){var f,g=document.createElement(b);if(c&&c.appendChild(g),d)for(f=0;f!==d.length;f++)g.classList.add(d[f]);return e&&a.each(e,function(a,b){e.hasOwnProperty(b)&&g.setAttribute(b,a)}),g}function o(a,b,c){var d=a.getAttribute(b);return d?e.toBoolean(d,"true"):c}function p(a,b,c){var d=a.getAttribute(b);return d?e.toInteger(d):c}function q(a,b,c){var d=a.getAttribute(b);return d?e.toString(d):c}function r(a){for(;a.firstChild;)a.removeChild(a.firstChild)}return{register:g,ViewModel:h,upgrade:i,build:n,booleanAttribute:o,intAttribute:p,stringAttribute:q,clearDom:r}});
define('system/lang/string',[],function(){"use strict";String.prototype.toStaticHTML=function(){return window.toStaticHTML?window.toStaticHTML(this).trim():this.trim()},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.startsWith=function(a,b){void 0===b&&(b=!0);var c=b?a.toLowerCase():a,d=a.length;return(b?this.toLowerCase():this).substr(0,d)===c},String.prototype.format=function(){var a=arguments,b=/\{(\d|\d\d)\}/g,c=/\d+/;return this.replace(b,function(b){var d=1*b.match(c)[0];return void 0!==a[d]?a[d]:""===a[d]?"":b})},String.isNullOrWhitespace=function(a){return void 0===a||null===a||("string"!=typeof a&&(a=a.toString()),""===a.trim())},String.compare=function(a,b){return void 0!==a&&null!==a&&void 0!==b&&null!==b&&a.toLocaleLowerCase().localeCompare(b.toLocaleLowerCase())},String.escapeRegex=function(a){return String(a).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},String.prototype.endsWith=function(a,b){
var c=this.toString();("number"!=typeof b||!isFinite(b)||Math.floor(b)!==b||b>c.length)&&(b=c.length),b-=a.length;var d=c.lastIndexOf(a,b);return d!==-1&&d===b}});
define('ui/elements/select/view-model',['require','lodash','jquery','text!./template.html','text!./options-template.html','knockout','spa/region','./element','system/hardware/device','system/lang/string','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./template.html"),d=require("text!./options-template.html"),e=require("knockout"),f=require("spa/region"),g=require("./element"),h=Object.resolve(require("system/hardware/device"));require("system/lang/string"),require("system/lang/object");function i(a){j.call(this,c,!1,!1);var b=this;this.element=a,this.isOpen=null,this.selectedItem=null,this.text=null,this.showAllOptions=null,this.textFocus=null,this.keyPressed=null,this.optionsValue=null,this.optionsText=null,this.optionsGroup=null,this.multiple=null,this.optionsCaption=null,this.options=null,this.value=null,this.required=null,this.disabled=null,this.editable=null,this.selectedOptions=null,this.isRequired=null,this.currentText=null,this.currentMatchedOptions=null,this._selectedOptions=[],this.updated_selectedOptions=!1,this.propertiesUpdateDone=!0,this.selectedValueText=null,this.filteredOptions=null,this.isMobile=h.isMobile(),
this.optionsRegion=new f("","blah"),b.optionsContainerDiv=null,this.isClicked=!1,this.documentHandlerFn=w.bind(null,b),this.isRequiredSubscriber=null,this.filteredOptionsSubscriber=null}var j=Object.inherit(g.ViewModel,i);function k(b){if(!b.options)return[];var c=[].concat(b.options()),d=b.text(),f=[],g=b.optionsGroup(),h=c,i=[],j,k=b.optionsCaption(),n,o;if(c&&c.length)if(i=m(b,h,d),j=k!==d,!b.showAllOptions()&&("object"!=typeof b.options()[0]||b.optionsText())&&b.text()&&"object"!=typeof b.text()&&j&&b.keyPressed()&&(d=l(d),n=new RegExp(d.trim(),"i"),o=e.utils.arrayFilter(c,function(a){var c=b.getOptionText(a);return n.test(c)}),(!i||i&&o.length>1)&&(h=o.length?o:c)),"object"==typeof h[0]&&g){var p=a.groupBy(h,g),q={undefined:[]};f=p?p:q}else f=h;return f}function l(a){return a=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}i.prototype.beforeAttached=function(){var c=this;this.init(),b(document).off("mousedown",this.documentHandlerFn).on("mousedown",this.documentHandlerFn),
this.bindAttribute("multiple",!1,C.bind(null,this),!0),this.bindAttribute("editable",!0,null,!0),this.bindAttribute("value",null,D.bind(null,this),!0),this.bindAttribute("selectedOptions",[],E.bind(null,this),!0),this.bindAttribute("optionsCaption",null,null,!0),this.bindAttribute("optionsText",null,null,!0),this.bindAttribute("optionsValue",null,null,!0),this.bindAttribute("optionsGroup",null,null,!0),this.bindAttribute("disabled",!1,q.bind(null,c),!0),this.bindAttribute("required",!1,null,!0),this.bindAttribute("options",[],B.bind(null,c),!0),this.resizeProxy=b.proxy(a.debounce(this.resize,100),this),this.scrollProxy=b.proxy(this.resize,this)},i.prototype.init=function a(){var b=this;this.isOpen=e.observable(!1),this.keyPressed=e.observable(),this.selectedItem=e.observable(),this.text=e.observable(),this.showAllOptions=e.observable(!1),this.textFocus=e.observable(),this.optionsValue=e.observable(),this.optionsText=e.observable(),this.optionsGroup=e.observable(),
this.multiple=e.observable(!1),this.optionsCaption=e.observable(""),this.options=e.observableArray([]),this.value=e.observable(),this.required=e.observable(!1),this.disabled=e.observable(!1),this.editable=e.observable(!0),this.selectedOptions=e.observableArray([]),this.propertiesUpdateDone=e.observable(!0),this.isRequired=e.computed(o.bind(b,b)),this.isRequiredSubscriber=this.isRequired.subscribe(r.bind(b,b)),this.selectedValueText=e.computed(y.bind(null,this)),this.filteredOptions=e.computed(k.bind(null,this)),this.filteredOptionsSubscriber=this.filteredOptions.subscribe(p.bind(b,b))};function m(b,c,d){return d!==b.currentText&&(b.currentText=d,b.currentMatchedOptions=a.find(c,n.bind(b,b,d))),b.currentMatchedOptions}function n(a,b,c){var d=a.getOptionText(c);return d&&d.toString()===b.toString()}function o(a){return a.required()&&!a.hasValue()}function p(a,b){a.setOptionContainerPosition.bind(null,a)(b),M.bind(null,a)(b)}function q(a,c){
c?b(a.element).addClass("mi-select-disabled"):b(a.element).removeClass("mi-select-disabled")}function r(a,c){a.isRequired()?b(a.element).addClass("mi-select-required"):b(a.element).removeClass("mi-select-required")}i.prototype.afterAttached=function(){var a=this},i.prototype.afterDetached=function(){this.isOpen(!1),b(this.optionsContainerDiv).remove(),this.isOpen=null,this.selectedItem=null,this.text=null,this.showAllOptions=null,this.textFocus=null,this.optionsValue=null,this.optionsText=null,this.optionsGroup=null,this.multiple=null,this.optionsCaption=null,this.options=null,this.value=null,this.required=null,this.disabled=null,this.editable=null,this.selectedOptions=null,this.isRequired=null,this.keyPressed=null,this.selectedValueText=null,this.filteredOptions=null,b(document).off("mousedown",this.documentHandlerFn),this.isRequiredSubscriber&&this.isRequiredSubscriber.dispose(),this.filteredOptionsSubscriber&&this.filteredOptionsSubscriber.dispose()},
i.prototype.selectValue=function(c,d,e){if(e&&(e.preventDefault(),e.stopPropagation()),c.disabled())return!1;if(c.multiple()){if(c.multiple()){if(!d)return!0;var f=c.selectedOptions(),g=f||[],h=c.getOptionValue(d);b.inArray(h,c.selectedOptions())===-1?(c._selectedOptions.push(d),g.push(h)):(c._selectedOptions=b.grep(c._selectedOptions,function(a){return c.getOptionValue(a)!==h}),g=b.grep(g,function(a){return a!==h})),c.updated_selectedOptions=!0,c.selectedOptions(g),b(c.element).trigger("properties.selectedOptions:changed",[g]),c.textFocus(!0)}}else{var i;if(c.selectedItem(d),a.isEqual(d,c.value()))y(c);else{if(d){var j=c.getOptionValue(d);return i=j,c.isOpen(!1),u(c),c.value&&c.value(j),b(c.element).trigger("properties.value:changed",[i]),b(c.element).trigger("selected",[c.value?c.value():c.value]),!0}c.value("");var k=c.optionsCaption()?c.optionsCaption():"";c.text(k),i="",b(c.element).trigger("properties.value:changed",[i])}c.textFocus(!0),c.isOpen(!1),u(c),
b(c.element).trigger("selected",[c.value()])}return!0},i.prototype.toggleSelectAll=function(a,c){var d=this;if(d.disabled())return!0;if(d.selectedOptions().length||d.selectedOptions().length===d.options().length)d._selectedOptions=[],d.updated_selectedOptions=!0,d.selectedOptions([]),b(d.element).trigger("properties.selectedOptions:changed",[[]]);else if(!d.selectedOptions().length){var e=s(d.options(),d.getOptionValue.bind(d));d._selectedOptions=d.options(),d.updated_selectedOptions=!0,d.selectedOptions(e),b(d.element).trigger("properties.selectedOptions:changed",[e])}return!0};function s(a,b){var c=[],d;for(d=0;d<a.length;d++)c.push(b(a[d]));return c}i.prototype.toggleOptions=function(a,c){c.stopPropagation();var d=this;return!(d.disabled()||d.options()&&!d.options().length)&&(d.isClicked=!0,b(document).trigger("mousedown",[d.element]),this.showAllOptions(!0),d.isOpen()?(u(d),b(d.element).trigger("selected",[d.multiple()?d.selectedOptions():d.value()])):(F(d),t(d)),
d.isOpen()||b(d.optionsContainerDiv).css("visibility","hidden"),d.textFocus()||d.textFocus(!0),d.isOpen(!d.isOpen()),!0)};function t(a){b(a.element).parents().on("scroll",a.scrollProxy)}function u(a){b(a.optionsContainerDiv).css("visibility","hidden"),b(a.element).parents().off("scroll",a.scrollProxy),L(a)}i.prototype.showOptions=function(a){var c=this;this.showAllOptions(c.multiple()),this.isOpen()||13===a.keyCode||c.disabled()||(b(c.optionsContainerDiv).css("visibility","hidden"),c.isClicked=!0,b(document).trigger("mousedown",[c.element]),this.isOpen(!0),F(this),t(c))},i.prototype.handleMouseDown=function a(b,c){return c.stopPropagation(),!0},i.prototype.handleKeyUpOnTextInput=function a(b,c){return c.stopPropagation(),this.isOpen()||this.keyPressed(!1),"keyup"===c.type&&this.keyPressed(!0),this.showOptions(c),!0},i.prototype.handleKeyDownOnTextInput=function a(c,d){var e=this,f;if(d.stopPropagation(),b(e.element).trigger("textChange",[d]),9===d.keyCode)e.isOpen(!1),u(e),f=!e.text(),
y(e),b(e.element).trigger("selected",[e.multiple()?e.selectedOptions():e.value()]),x(e,f);else{if(8===d.keyCode&&(e.multiple()||e.disabled()))return!1;this.showAllOptions(e.multiple()),J.bind(null,e)(d)}return!0},i.prototype.getValue=function(a){return"function"==typeof a?a():a},i.prototype.getReturnValue=function(a,b){return"function"==typeof a?b?a.call(b,b):b:b?b[a]:b},i.prototype.getOptionText=function(a){var b=this;return a&&b.optionsText()?b.getValue(b.getReturnValue(b.optionsText(),a)):a},i.prototype.getOptionValue=function(a){var b=this;return a&&b.optionsValue()?b.getValue(b.getReturnValue(b.optionsValue(),a)):a},i.prototype.hasValue=function(){var a=this;if(a.multiple()){if(a.selectedOptions()&&0===a.selectedOptions().length)return!1}else if(!a.value())return!1;return!0},i.prototype.isActive=function(c){var d=this
;return d.multiple()?b.inArray(d.getOptionValue(c),d.selectedOptions())!==-1:"object"!=typeof d.value()||d.optionsValue()?d.getOptionValue(c)===d.value():a.isEqual(c,d.value())},i.prototype.resize=function(){this.isOpen(!1),v(this)},i.prototype.wrapOptionText=function(a){var b=this,c=b.getOptionText(a),d=b.text(),e,f=c,g=b.options(),h;return h=m(b,g,d),c&&d&&d.trim()&&!h&&(d=l(d),e=new RegExp(d,"gi"),c&&"string"==typeof c&&(c=R(c)),f=c.replace(e,function(a){return"<b>"+a+"</b>"}),f=f.replace(/ /g,"&nbsp;")),f&&"string"==typeof f&&(f=R(f)),f},i.prototype.setFocus=function b(){var c=this;a.defer(c.showOptions.bind(c,{}))};function v(a){u(a)}function w(a,c){var d;a.isClicked?a.isClicked=!1:(a.isOpen&&a.isOpen()&&(a.isOpen(!1),u(a),b(a.element).trigger("selected",[a.multiple()?a.selectedOptions():a.value()]),d=!a.text()),y(a),x(a,d))}function x(a,c){
if(c)if(a.multiple()||null!==a.optionsCaption()&&""!==a.optionsCaption()||!a.options()||!a.options().length)!a.multiple()&&a.options()&&a.options().length&&(a.value(""),b(a.element).trigger("properties.value:changed",[""]));else{var d=a.getOptionValue(a.options()[0]);a.value(d),b(a.element).trigger("properties.value:changed",[d])}}function y(a,c){if(a.options){var d=null,e=a.options(),f=null,g=null,h="";if(!a.multiple()&&(null===a.optionsCaption()||""===a.optionsCaption())&&!a.value()&&a.options()&&e.length&&a.propertiesUpdateDone()){var i=a.getOptionValue(e[0]);a.value(i),b(a.element).trigger("properties.value:changed",[i])}if(a.multiple()){if(a.options()&&e.length&&a.selectedOptions()&&a.selectedOptions().length){var j=a.selectedOptions(),k="",l;return k=s(a._selectedOptions,a.getOptionText.bind(a)).join(" | "),h=k,a.text(h),h}}else if((null!==a.value()||""!==a.value())&&a.options()&&e.length){for(var m=0;m<e.length;m++)if(g=A(a,e[m],a.value())){d=g;break}
if(d)return h=a.getOptionText(d),a.text(h),h}return h=a.optionsCaption()||"",a.text(h),h}}function z(a,b,c){for(var d=[],e,f=0;f<c.length;f++){var g=c[f];if(null!==g)for(var h=0;h<b.length;h++)if(e=A(a,b[h],g)){d.push(e);break}}return d}function A(b,c,d){var e=b.getOptionValue(c),f=null;return void 0===d||null===d||void 0===e||null===e?f:("function"==typeof d.numericValue&&null!==d.numericValue()&&(d=d.numericValue()),b.optionsValue()?e.toString()===d.toString()&&(f=c):c===d.toString()?f=c:"object"==typeof d&&a.isEqual(d,c)&&(f=c),f)}function B(a,b){b.length||(a.value,a.selectedOptions&&a.selectedOptions([])),a.multiple()&&a.selectedOptions&&(a.updated_selectedOptions||(a._selectedOptions=z(a,b,a.selectedOptions()),y(a)),a.updated_selectedOptions=!1)}function C(a){}function D(a,c){null!==c&&b(a.element).trigger("valueChange",[c])}function E(a,c){if(a.multiple()){var d=a.options();a.updated_selectedOptions||(a._selectedOptions=z(a,d,c)),a.updated_selectedOptions=!1,
b(a.element).trigger("valueChange",[c])}}function F(a){a.optionsCaption()===a.text()&&a.text(""),G(a),a.setOptionContainerPosition(a),setTimeout(function(a){if("function"==typeof a.options&&"function"==typeof a.text){var c=m(a,a.options(),a.text());a.text()&&a.optionsCaption()!==a.text()&&c&&!a.isMobile&&b(a.element).find(".mi-selected-value-text").select()}}.bind(a,a),100)}function G(a){var c,f;b("body").find(".select-outer-container").length?c=b("body").find(".select-outer-container"):(c=document.createElement("div"),b(c).addClass("select-outer-container"),document.body.appendChild(c)),a.optionsContainerDiv||(f=document.createElement("div"),a.optionsContainerDiv=f,b(f).css("visibility","hidden"),b(c).append(f),a.optionsRegion.setElement(f),a.optionsRegion.attach(d),e.applyBindings(a,a.optionsRegion.activeContainer))}i.prototype.setOptionContainerPosition=function(a){var c,d,e,f,g,h,i,j=a.optionsContainerDiv;if(j){if(e=b(a.element).outerHeight(),
c=b(a.container).find(".mi-dropdown-selector").offset(),d=b(a.container).find(".mi-dropdown-selector").width(),!c)return;a.topOffset=c?c.top:0,a.leftOffset=c?c.left:0,b(j).css({position:"absolute","min-width":d,"z-index":1e5}),b(a.element).closest(".dialog-wrapper").length>0&&b(j).css({"max-width":d}),setTimeout(H.bind(null,a,j,c,d,e),1)}};function H(a,c,d,e,f){var g=b(c).outerWidth(),i=b(c).outerHeight(),j,k,l=b(c).find(".mi-select-options-container");l.removeClass("top-left top-right bottom-left bottom-right"),!a.isMobile&&h.innerHeight()<700&&b(".select-outer-container .mi-select-options-container").css("max-height","200px"),d.top+i+50>=b(window).height()?(j=d.top-i-20,d.left+e-g<80?(k=d.left,l.addClass("top-left")):(k=d.left-Math.abs(e-g),l.addClass("top-right"))):(j=a.topOffset+f+10,d.left+e-g<80?(k=d.left,l.addClass("bottom-left")):(k=d.left-Math.abs(e-g)+7,l.addClass("bottom-right"))),b(c).css({left:k,top:j,visibility:"visible"}),
b(c).find(".mi-select-option").hasClass("focus")||!a.multiple||a.multiple()||Q(a,"active")}function I(a){}function J(a,b){switch(b.keyCode){case 40:b.preventDefault(),O(a,b);break;case 38:b.preventDefault(),P(a,b);break;case 13:b.preventDefault(),K(a,b);break;default:return}}function K(a,c){var d=a.optionsContainerDiv,f=b(d).find(".mi-select-option.focus");if(f.length&&e.contextFor(b(f[0]).get(0))){var g=e.contextFor(b(f[0]).get(0)).$data;b(f[0]).hasClass("mi-select-caption")&&(g=null),a.selectValue(a,g,c),a.multiple()||(a.isOpen(!1),v(a),b(a.element).trigger("selected",[a.value()]),a.textFocus(!0))}}function L(a){var c=a.optionsContainerDiv;b(c).find(".mi-select-option").removeClass("focus")}function M(a){setTimeout(N.bind(null,a),10)}function N(a){if(!a.options||a.multiple&&a.multiple()||a.isOpen&&!a.isOpen())return!1;var c=a.options(),d=a.text(),e=!1,f=a.optionsContainerDiv;if(c&&c.length&&(e=m(a,c,d)),!e&&d&&d!==a.optionsCaption()){L(a);var g=a.optionsCaption()?1:0
;b(b(f).find(".mi-select-option")[g]).addClass("focus"),Q(a)}else e&&d&&d!==a.optionsCaption()&&(L(a),b(b(f).find(".mi-select-option")).filter(function(){return b(this).text()===d}).addClass("focus"),Q(a));!d&&a.value()&&(L(a),a.value()&&Q(a,"active"))}function O(a){var c=a.optionsContainerDiv,d=b(c).find(".mi-select-option.focus"),e=b(c).find(".mi-select-option.active"),f;b(c).find(".mi-select-option").removeClass("focus"),f=d.length&&b(d).nextAll(".mi-select-option:first").length?b(d).nextAll(".mi-select-option:first"):d.length&&!b(d).nextAll(".mi-select-option:first").length?b(b(c).find(".mi-select-option")[0]):e.length?b(e).nextAll(".mi-select-option:first"):b(b(c).find(".mi-select-option")[0]),f.addClass("focus");var g=a.options(),h=a.text(),i;g&&g.length&&((i=m(a,g,h))||a.optionsCaption()&&a.optionsCaption()===h)&&a.text(f.text()),Q(a)}function P(a){var c=a.optionsContainerDiv,d=b(c).find(".mi-select-option.focus"),e=b(c).find(".mi-select-option.active"),f
;b(c).find(".mi-select-option").removeClass("focus"),f=d.length&&b(d).prevAll(".mi-select-option:first").length?b(d).prevAll(".mi-select-option:first"):d.length&&!b(d).prevAll(".mi-select-option:first").length?b(c).find(".mi-select-option").last():e.length?b(e).prevAll(".mi-select-option:first"):b(b(c).find(".mi-select-option")[0]),f.addClass("focus");var g=a.options(),h=a.text(),i;g&&g.length&&((i=m(a,g,h))||a.optionsCaption()&&a.optionsCaption()===h)&&a.text(f.text()),Q(a)}function Q(a,c){var d=a.optionsContainerDiv,e=c||"focus",f=b(d).find(".mi-select-option."+e);f&&f[0]&&(f[0].parentNode.scrollTop=f[0].offsetTop)}function R(a){return a.replace(/<([a-z]+)([^>]*[^\/])?>(?![\s\S]*<\/\1)/gi,function(a){return b("<div/>").text(a).html()})}return g.register("mi-select",i),i});
define('platform/datasheets/layout/ui/print-dialog-view-model',['require','text!platform/datasheets/layout/ui/views/print-dialog-view.html','spa/ko/knockout-view-model','system/globalization/translator','system/lang/event','knockout','ui/elements/radio/radio-view-model','ui/elements/select/view-model'],function(require){"use strict";var a=require("text!platform/datasheets/layout/ui/views/print-dialog-view.html"),b=require("spa/ko/knockout-view-model"),c=require("system/globalization/translator"),d=require("system/lang/event"),e=require("knockout");require("ui/elements/radio/radio-view-model"),require("ui/elements/select/view-model");function f(){g.call(this,a),this.translator=Object.resolve(c),this.printOptionSelected=new d,this.printCancelled=new d,this.selectedRadioButton=e.observable(""),this.options=e.observableArray([]),this.selectedOption=e.observable("")}var g=Object.inherit(b,f);f.prototype.translate=function a(b){return this.translator.translate(b)},f.prototype.setReportOptions=function a(b){b&&(h(this,b),this.options(b))},f.prototype.okButtonClicked=function a(){this.printOptionSelected.raise(this.selectedRadioButton(),this.selectedOption())},f.prototype.cancelButtonClicked=function a(){this.printCancelled.raise()};function h(a,b){var c,d=!1
;for(c=0;c<b.length;c++)"true"===b[c].isDefaultReport.toString()&&(a.selectedOption(b[c]),d=!0);d||a.selectedOption({reportId:"",reportPath:""})}return f});
define('platform/datasheets/layout/ui/helpers/print-helper',['require','lodash','jquery','jquery','platform/datasheets/layout/ui/print-dialog-view-model','system/ui/dialog-view-model','system/globalization/translator','application/application-events'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("jquery"),d=require("platform/datasheets/layout/ui/print-dialog-view-model"),e=require("system/ui/dialog-view-model"),f=require("system/globalization/translator"),g=require("application/application-events");function h(){this.translator=Object.resolve(f),this.appEvents=Object.resolve(g)}h.prototype.print=function a(b,c,f){if(f&&0===f.length)j(b,c);else{var g=Object.resolve(d);g.setReportOptions(f);var h=new e(g,this.translator.translate("DS_SELECT_REPORT"),{height:300,width:400});h.show(),g.printOptionSelected.add(i.bind(null,this,b,c,h)),g.printCancelled.add(l.bind(null,h))}};function i(a,b,c,d,e,f){1===e?j(b,c):2===e&&f&&f.reportPath&&k(a,f.reportPath,b.currentEntyKey()),l(d)}function j(a,b){"form"===b?m(a,"Datasheet"):"bulk"===b?n(a,"Bulk Datasheet"):"mdf"===b&&o(a,"Datasheet")}function k(a,b,c){a.appEvents.navigate.raise("ssrs/viewer/"+b+"/P0="+c,{tab:!0})}function l(a){a.closeDialog()}
function m(a,b){var c=[],d;c=p(a,c),d=q(a,c),C(a,d,b)}function n(a,b){var c={},d;c=p(a,c),d=s(a,c),C(a,d,b)}function o(a,b){var c,d={};d=p(a,d),c=t(a,d),C(a,c,b)}function p(a,c){return a.region.$element.find("input.form-control, input[type=text], input.mi-selected-value-text").each(function(){b(this).attr("value",b(this).val()),b(this).css("background-color",b(this).css("backgroundColor")+"! important")}),a.region.$element.find("mi-select").each(function(a,c,d){var e=D(),f=b(d).find("input.mi-selected-value-text");b(d).attr("data-guid",e),a[e]={className:e,value:b(f).val(),backgroundColor:b(f).css("background-color")}}.bind(null,c)),a.region.$element.find("textarea.form-control").each(function(){b(this).html(b(this).val()),b(this).css("background-color",b(this).css("backgroundColor")+"! important")}),a.region.$element.find("select").each(function(a,c,d){var e=D(),f=b(d);b(f).attr("id",e),a[e]={className:e,value:b(f).find("option:selected").text(),
backgroundColor:b(f).css("background-color")}}.bind(null,c)),b(a.region.$element.find("mi-checkbox input:checkbox:checked")).each(function(){b(this).attr("checked",!0),b(this).css("background-color",b(this).css("backgroundColor")+"! important")}),c}function q(a,d){var e=c.extend(!0,[],a.region.$element),f=b.parseHTML("<div style='margin:20px'>"+e.html()+"<div>");b(f).find("div.datasheet-nav > div.datasheet-toolbar > div.datasheet-btn-group").remove();var g=b(f).find("div.datasheet-tab-container");return b(f).find("div.tab-content > .tab-pane").prepend(function(a,b){return g.find("ul.nav-tabs > li").removeClass("active"),g.find("ul.nav-tabs > li:nth-child("+(a+1)+")").addClass("active"),"<hr>"+g.html()}),b(f).find("div.datasheet-tab-container").remove(),b(f).find("div.tab-content > .tab-pane").show(),b(f).find("mi-select").each(function(a,c,d){var e=b(d).attr("data-guid");a[e]&&(b(d).find("input.mi-selected-value-text").attr("value",a[e].value),
b(d).find("input.mi-selected-value-text").css("background-color",a[e].backgroundColor))}.bind(null,d)),r(f),f}function r(a){b(a).find(".datasheet-btn-group.site-filter-component").each(function(){var a="";a="readonly"===b(this).find("mi-site-selector").attr("readonly")?b(this).find("mi-site-selector .site-selector-root div.readonly output")[0].innerText:b(this).find("mi-site-selector .site-selector-root div.dropdown output")[0].innerText,
b(this).find("mi-site-selector .site-selector-root div.dropdown button").replaceWith("<i class='icon-location' style='margin: 1px 0px 0px -12px; font-size: 24px;color: #3e87e8;padding-top: 3px;width: 20px;float:left;'></i><label style='font-family: open_sanssemibold, Helvetica Neue, Helvetica, Arial, sans-serif;font-size: 10px;font-weight: normal;margin-top: 1px;display: inline-block;margin-left: 12px;'>Site:</label><br/><output style='display: block;padding-top: 7px;font-size: 13px;line-height: 1.667;color: #232323;margin: -10px 0 0 20px;'>"+a+"</output>")})}function s(c,d){var e=b(c.region.$element).html(),f=b.parseHTML("<div style='margin:20px'>"+e+"<div>");b(f).find(".bulk-datasheet-header-container").css("padding","10px"),b(f).find(".table-responsive").remove();var g="<div style='padding:10px;'>",h=b("div.table-responsive > table.table > thead > tr > th"),i=c.region.$element.find("div.freezed-cols-container > table.table > thead > tr > th"),j=[],k=[],l="---"
;return c.region.$element.find("div.table-responsive > table.table > tbody > tr").each(function(a,c){j[a]=b(this).find("td")}),c.region.$element.find("div.freezed-cols-container > table.table > tbody > tr").each(function(a,c){k[a]=b(this).find("td")}),g=B(i,k,l,g),a.each(h,function(b,c){if(c>=0&&"status-col"!==b.className&&"row-selector"!==b.className){var d=0===c?"border-left: 1px solid #e6e6e6;":"";g=z(g,b,c,d),a.each(j,function(a,e){a.length>=0&&"status-col"!==b.className&&"row-selector"!==b.className&&(g=A(g,l,a,e,c,d))}),g+="</div>"}}),g+="</div>",b(f).find(".bulk-datasheet-header-container").after(g),b(f).find("mi-select").each(function(a,c,d,e){var f=b(e).attr("data-guid");c[f]&&(b(e).find("input.mi-selected-value-text").attr("value",c[f].value),b(e).find("input.mi-selected-value-text").css("background-color",c[f].backgroundColor))}.bind(null,c,d)),b(f).find("select").each(function(a,c){var e=b(c).attr("id");if(d[e]){var f=b("<option>"+d[e].value+"</option>");b(c).html(f),
b(c).css("background-color",d[e].backgroundColor)}}),b(f).find(".freezed-cols-container.pull-left").remove(),x(f),v(f),w(f,"bluk"),f}function t(a,c){var d=b(a.region.$element).html(),e=b.parseHTML("<div class='master-datasheet-print-container' style='margin:20px'>"+d+"<div>");b(e).find("div.datasheet-nav > div.datasheet-toolbar > div.datasheet-btn-group").remove();var f=b(e).find("div.datasheet-tab-container");return b(e).find("div.tab-content > .tab-pane").prepend(function(a,b){return f.find("ul.nav-tabs > li").removeClass("active"),f.find("ul.nav-tabs > li:nth-child("+(a+1)+")").addClass("active"),"<hr>"+f.html()}),b(e).find("div.datasheet-tab-container").remove(),b(e).find("div.tab-content > .tab-pane").show(),e=y(e),b(e).find(".master-datasheet-tab-content .master-tab-pane, .master-datasheet-tab-content .detail-tab-pane").show(),b(e).find(".form-control, input").prop("disabled",!1),b(b(e).find("div.table-responsive")[0]).html(a.getBulkHtmlForPrinting(a)),u(e),
b(e).find("mi-select").each(function(a,c,d){var e=b(d).attr("data-guid");a[e]&&(b(d).find("input.mi-selected-value-text").attr("value",a[e].value),b(d).find("input.mi-selected-value-text").css("background-color",a[e].backgroundColor))}.bind(null,c)),r(e),b(e).find("div.freezed-cols-container").remove(),e}function u(a){for(var c=1;c<b(a).find("div.table-responsive").length;c++)b(b(a).find("div.table-responsive")[c]).remove();b(a).find(".bulk-datasheet-table-body").remove(),b(a).find(".bulk-float-table-scrollbar").remove(),b(a).find(".bulk-datasheet-disabled-overlay").remove(),b(a).find("textarea").each(function(){var a=b(this).next();b(a).hasClass("textareaIcon")&&b(a).remove()}),v(a),w(a,"mdf")}function v(a){b(a).find(".form-group.has-error").each(function(){var a=b(this).find(".icon-node-warning");b(a).hasClass("icon-node-warning")&&b(a).css({bottom:"28px",position:"relative",right:"5px","z-index":"11",float:"right"})})}function w(a,c){
b(a).find(".form-group .bulk-uom-button").each(function(){b(this).css({bottom:"mdf"===c?"-8px":"0",position:"relative"})})}function x(a){b(a).find(".icon-calendar").remove()}function y(a){return b(a).find(".mdf-tab-header").hide(),b(a).find(".master-tab-pane .master-tab-header").show(),b(a).find(".detail-tab-pane .detail-tab-header").show(),b(a).find(".master-tab-header li a").css("color","#555555 "),b(a).find(".master-tab-header li.active a").css("color","#007aff").css("border"," 2px solid #ddd"),b(a).find(".master-tab-header").css("padding","20px 0 20px 0"),b(a).find(".detail-tab-header li a").css("color","#555555 "),b(a).find(".detail-tab-header li.active a").css("color","#007aff").css("border"," 2px solid #ddd"),b(a).find(".detail-tab-header").css("padding","20px 0 20px 0"),a}function z(a,c,d,e){
return a+="<div style='display:inline-block;vertical-align:top;margin-top:20px;border-top:1px solid #444;'><div style='padding:5px;background-color:#f8f8f8;border: 0;"+e+"border-bottom: 1px solid #e6e6e6;border-right: 1px solid #e6e6e6;'>"+b(c).text()+"</div>"}function A(a,c,d,e,f,g){return c=b(d[f]).find(".site-filter-component").length>0?b(d[f]).find("mi-site-selector .site-selector-root output")[0].innerText:b(d[f]).find(".hyperlinkEllipsis").length>0?b(d[f]).find(".hyperlinkEllipsis").html():b(d[f]).find(".form-control").length>0&&!b(d[f]).find("input:password")?b(d[f]).find(".form-control").val():b(d[f]).find("mi-checkbox").length>0?b(d[f]).find("mi-checkbox").html():b(d[f]).html(),a+="<div style='padding:5px;height:75px;background-color:#fff;border: 0;"+g+"border-bottom: 1px solid #e6e6e6;border-right: 1px solid #e6e6e6 !important;'>"+c+"</div>"}function B(c,d,e,f){return a.each(c,function(c,g){if(g>=2&&(b(c).hasClass("freezed-column")||b(c).hasClass("site-selector-caption"))){
var h=2===g?"border-left: 1px solid #e6e6e6;":"";f=z(f,c,g,h),a.each(d,function(a,b){a.length>=2&&"status-col"!==c.className&&"row-selector"!==c.className&&(f=A(f,e,a,b,g,h))}),f+="</div>"}}),f}function C(c,d,e){var f=a.map(b("link"),function(a){return a.outerHTML}),g={htmlString:b(d).get(0).outerHTML,cssLinks:f};c.exportService.exportPage(g,"pdf",e)}function D(){return E()+E()+"-"+E()+"-"+E()+"-"+E()+"-"+E()+E()+E()}function E(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return h});
define('platform/datasheets/layout/ui/helpers/record-manager-helper',['require','system/lang/event'],function(require){"use strict";var a=require("system/lang/event");function b(){var b=this;b.makeRootRecordEvent=new a,b.unlinkRecordEvent=new a}return b.prototype.deallocateMem=function a(){this.makeRootRecordEvent.remove(),this.unlinkRecordEvent.remove()},b.prototype.makeRootRecord=function a(){this.makeRootRecordEvent.raise()},b.prototype.unlinkRecord=function a(){this.unlinkRecordEvent.raise()},b});

define('text!platform/datasheets/layout/ui/views/datasheet.html',[],function () { return '\r\n<div class="datasheet-layout-container">\r\n    <div>\r\n        <h2 data-bind="text: title,visible:title"></h2>\r\n\r\n        <div data-bind="if: isDatasheetRendered() && !isMasterDatasheet()" class="datasheet-nav">\r\n            <div class="datasheet-toolbar">\r\n                <div class="datasheet-selector-container block b8">\r\n                    <div class="datasheet-selector-label-container block" data-bind="visible: showDatasheetSelection">\r\n                        <div class="datasheet-lbl1"><span data-bind="text: $root.translate(\'DS_DATASHEET_ID_LABEL\')"></span>:</div>\r\n                    </div>\r\n                    <div class="datasheet-selector-select-container block" data-bind="visible: showDatasheetSelection">\r\n                        <mi-select class="datasheet-selector" data-bind="miproperty:{\r\n                            value: currentDatasheetKey,\r\n\r\n                            optionsValue:\'key\',\r\n                            optionsText:\'caption\', options: datasheetKeys}" />\r\n                    </div>\r\n                </div>\r\n                <div class="datasheet-controls-container block b4 pull-right">\r\n                    <div class="datasheet-btn-group form-ds-iconbar" data-bind="visible: !showEditButton()">\r\n                        <!-- ko if: $root.datasheetNavWidth() > 768 -->\r\n                            <button class="btn btn-icon" data-bind="visible: isRootRecordAvailable() && this.innerWidth > 1068 , click: makeRootRecord, attr: {title: $root.translate(\'RM_MAKE_ROOT_RECORD_TOOLTIP\')}"><i class="icon-open-in-new-window"></i></button>\r\n                        <!-- /ko -->                        \r\n                        <mi-associated-pages-btn familykey entitykey disabled data-bind="attr: { familykey: assocFamilykey(), entitykey: currentEntyKey(), disabled: assocDisabled() } " hideifnorecords="true"></mi-associated-pages-btn>\r\n                        <button class="btn btn-icon" data-bind="visible: isDatasheetRendered() && isSaveAvailable(), click: saveDatasheet, disable: isReadOnly, attr: {title: translate(\'DS_SAVE_TOOLTIP\')}"><i class="icon-save"></i></button>                        \r\n                    </div>\r\n                    <div class="datasheet-btn-group" data-bind="visible: showEditButton()">\r\n                        <!-- ko if: canEdit() && !isMasterDatasheet() -->\r\n                        <button class="btn btn-icon" data-bind="click : toggleEdit, attr: {title: translate(\'DS_EDIT_TOOLTIP\')}"><i class="icon-edit"></i></button>\r\n                        <!-- /ko -->\r\n                    </div>\r\n                    <!-- ko if: $root.datasheetNavWidth() > 768 -->                                      \r\n                    <!--<div class="datasheet-btn-group print-btn-group">\r\n                        <button class="btn btn-icon" data-bind="click : print, attr: {title: translate(\'PRINT\'), visible: $root.datasheetNavWidth() > 1068}"><i class="icon-printer"></i></button>\r\n                    </div>-->\r\n                    <!-- /ko -->\r\n\r\n                    <!-- ko if: isDatasheetRendered()  && !isMasterDatasheet() && isSiteFiltered()-->\r\n                    <div class="datasheet-btn-group site-filter-component">\r\n                        <mi-site-selector data-bind="value: siteKey,attr: { readonly: isSelectedSiteViewOnly },event:{\'change\': handleSiteChange}, visible: showSiteSelector"></mi-site-selector>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                    <!-- ko if: isDatasheetRendered() && showStateManagement() -->\r\n                    <div class="datasheet-btn-group state-transition-component">\r\n                        <mi-state-transition hidereservedops data-bind="attr: { entitykey: currentEntyKey, disable: isStateTransitionDisabled },\r\n                                    event: {\r\n                                        beforeStateChanged: onBeforeStateChanged,\r\n                                        stateChanged: onAfterStateChanged\r\n                                    }"></mi-state-transition>\r\n                    </div>\r\n                    <!-- /ko -->\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="layout-elements-group block-group columns-10" data-bind="visible: isDatasheetRendered() && !isReadOnly(), foreach: layoutElements, css: {\'datasheet-readonly-container\': isDatasheetReadOnly}">\r\n            <div class="layout-element block"\r\n                 data-bind="visible: visible,\r\n                template: { name: viewTemplate },\r\n                css: {\r\n                    \'span-1\': location().columnSpan() == 1,\r\n                    \'span-2\': location().columnSpan() == 2,\r\n                    \'span-2-5\': location().columnSpan() == 2.5,\r\n                    \'span-3\': location().columnSpan() == 3,\r\n                    \'span-4\': location().columnSpan() == 4,\r\n                    \'span-5\': location().columnSpan() == 5,\r\n                    \'span-6\': location().columnSpan() == 6,\r\n                    \'span-7\': location().columnSpan() == 7,\r\n                    \'span-7-5\': location().columnSpan() == 7.5,\r\n                    \'span-8\': location().columnSpan() == 8,\r\n                    \'span-9\': location().columnSpan() == 9,\r\n                    \'span-10\': location().columnSpan() == 10\r\n                }">\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n\r\n    <!--<div class="datasheet-disabled-overlay" data-bind="visible: isDatasheetReadOnly, style: { top: overlayTop, height: overlayHeight}"></div>-->\r\n\r\n    <div class="refdoc" data-bind="visible: isRefDocRendered">\r\n\r\n        <div class="ref-doc-container"></div>\r\n    </div>\r\n</div>';});


define('text!platform/datasheets/layout/ui/field-control-template-map.json',[],function () { return '{\r\n  "Textbox": "field-text-template",\r\n  "NumericTextBox": "field-text-template",\r\n  "Date": "field-date-template",\r\n  "ComboBox": "field-combo-box-template",\r\n  "MultiText": "field-multi-text-template",\r\n  "TextArea": "field-text-area-template",\r\n  "CheckBox": "field-check-box-template",\r\n  "Radio": "field-radio-template",\r\n  "Hyperlink": "field-hyperlink-template",\r\n  "Browse": "field-browse-template",\r\n  "Empty": "field-empty-template",\r\n  "Character": "field-text-template",\r\n  "Numeric": "field-text-template",\r\n  "Text": "field-text-area-template",\r\n  "Boolean": "field-check-box-template",\r\n  "Select": "field-select-template",\r\n  "MultiValue": "field-multivalue-template",\r\n  "DateAlt": "field-date-alt-template",\r\n  "MaskedTextBox": "field-masked-template",\r\n  "UOMTextbox": "field-uom-template",\r\n  "JSModule": "field-jsmodule-template"\r\n}';});


define('text!platform/datasheets/layout/ui/views/templates/layout-control-template.html',[],function () { return '<script type="text/html" id="layout-control-template">\r\n\r\n    <div class="layout-control block-group columns-10">\r\n        <div class="layout-element-caption block"\r\n             data-bind="text: caption,\r\n                    visible: captionVisible,\r\n                    attr:{\'data-visible\': captionVisible },\r\n                    popover: {\r\n                        title: $root.translate(\'DS_LAYOUT_ELEMENT_DETAILS\'),\r\n                        content: ko.toJSON($data),\r\n                        placement: \'bottom\'\r\n                    }"></div>\r\n\r\n        <!-- ko if: controlTemplate -->\r\n        <div class="layout-element-content block"\r\n             data-bind="visible: visible, attr:{\'data-controlName\':controlName},\r\n                        template: controlTemplate">\r\n        </div>\r\n        <!-- /ko -->\r\n\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/layout-element-template.html',[],function () { return '<script type="text/html" id="layout-element-template">\r\n\r\n    <div class="ds-group-header-enabled block"\r\n         data-bind="text: caption,\r\n                    visible: captionVisible,\r\n                    popover: {\r\n                        title: $root.translate(\'DS_LAYOUT_ELEMENT_DETAILS\'),\r\n                        content: ko.toJSON($data),\r\n                        placement: \'bottom\'\r\n                    }"></div>\r\n\r\n    <!-- ko if: controlTemplate -->\r\n    <div class="layout-element-content block"\r\n         data-bind="visible: controlName() && visible(),\r\n                    template: controlTemplate">\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <div class="layout-element-children block-group columns-10" data-bind="foreach: Object.keys($data.mappedRows())">\r\n        <div class="contentFlow" data-bind="foreach : $parent.mappedRows()[$data]">\r\n            <div class="layout-element block"\r\n                 data-bind="visible: visible,\r\n                        template: { name: viewTemplate },\r\n                        attr:{class:viewTemplate()==\'layout-empty-space-template\'?\'layout-element block span-empty\':\'layout-element block\'},\r\n                        css:{\'span-1\': location().columnSpan() == 1,\r\n                            \'span-2\': location().columnSpan() == 2,\r\n                            \'span-2-5\': location().columnSpan() == 2.5,\r\n                            \'span-3\': location().columnSpan() == 3,\r\n                            \'span-4\': location().columnSpan() == 4,\r\n                            \'span-5\': location().columnSpan() == 5,\r\n                            \'span-6\': location().columnSpan() == 6,\r\n                            \'span-7\': location().columnSpan() == 7,\r\n                            \'span-7-5\': location().columnSpan() == 7.5,\r\n                            \'span-8\': location().columnSpan() == 8,\r\n                            \'span-9\': location().columnSpan() == 9,\r\n                            \'span-10\': location().columnSpan() == 10,\r\n                            \'span-0\':location().columnSpan() == 0,\r\n                            \'hide-field\': isHidden }">\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/layout-empty-space-template.html',[],function () { return '<script type="text/html" id="layout-empty-space-template">\r\n    <div class="layout-empty-space" data-bind="style:{\'background-color\':(controlName() == \'0\' ? \'#eee\' : \'transparent\'),\'min-height\':\'35px\'}">\r\n        &nbsp;&nbsp;\r\n    </div>\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/layout-group-template.html',[],function () { return '<script type="text/html" id="layout-group-template">\r\n\r\n    <div class="layout-group">\r\n\r\n        <div class="block ds-group-header-enabled"\r\n             data-bind="text: caption,\r\n                    visible: captionVisible,\r\n                     attr:{class:headerCss},\r\n                    popover: {\r\n                        title: $root.translate(\'DS_LAYOUT_ELEMENT_DETAILS\'),\r\n                        content: ko.toJSON($data),\r\n                        placement: \'bottom\'\r\n                    }"></div>\r\n\r\n        <div class="layout-element-children block-group columns-10" data-bind="foreach: Object.keys($data.mappedRows())">\r\n            <div class="contentFlow" data-bind="foreach : $parent.mappedRows()[$data]">\r\n                <div class="layout-element block"\r\n                     data-bind="visible: visible,\r\n                            template: { name: viewTemplate },\r\n                            attr:{class:viewTemplate()==\'layout-empty-space-template\'?\'layout-element block span-empty\':\'layout-element block\'},\r\n                             css:{\'span-1\': location().columnSpan() == 1,\r\n                            \'span-2\': location().columnSpan() == 2,\r\n                            \'span-2-5\': location().columnSpan() == 2.5,\r\n                            \'span-3\': location().columnSpan() == 3,\r\n                            \'span-4\': location().columnSpan() == 4,\r\n                            \'span-5\': location().columnSpan() == 5,\r\n                            \'span-6\': location().columnSpan() == 6,\r\n                            \'span-7\': location().columnSpan() == 7,\r\n                            \'span-7-5\': location().columnSpan() == 7.5,\r\n                            \'span-8\': location().columnSpan() == 8,\r\n                            \'span-9\': location().columnSpan() == 9,\r\n                            \'span-10\': location().columnSpan() == 10,\r\n                            \'span-0\':location().columnSpan() == 0,\r\n                            \'hide-field\': isHidden }"></div>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/layout-label-template.html',[],function () { return '<script type="text/html" id="layout-label-template">\r\n\r\n    <div class="layout-element-caption layout-label block"\r\n         data-bind="text: caption,\r\n                    visible: captionVisible,css:fontColorCss,\r\n                    popover: {\r\n                        title: $root.translate(\'DS_LAYOUT_ELEMENT_DETAILS\'),\r\n                        content: ko.toJSON($data),\r\n                        placement: \'bottom\' }"></div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/layout-root-template.html',[],function () { return '<script type="text/html" id="layout-root-template">\r\n\r\n    <div id="root" class="layout-element-children block-group columns-10" data-bind="foreach: Object.keys($data.mappedRows())">\r\n        <div class="contentFlow" data-bind="foreach : $parent.mappedRows()[$data]">\r\n            <div class="layout-element block"\r\n                 data-bind="visible: visible,\r\n                        template: { name: viewTemplate },\r\n                        attr:{class:viewTemplate()==\'layout-empty-space-template\'?\'layout-element block span-empty\':\'layout-element block\'},\r\n                         css:{\'span-1\': location().columnSpan() == 1,\r\n                            \'span-2\': location().columnSpan() == 2,\r\n                            \'span-2-5\': location().columnSpan() == 2.5,\r\n                            \'span-3\': location().columnSpan() == 3,\r\n                            \'span-4\': location().columnSpan() == 4,\r\n                            \'span-5\': location().columnSpan() == 5,\r\n                            \'span-6\': location().columnSpan() == 6,\r\n                            \'span-7\': location().columnSpan() == 7,\r\n                            \'span-7-5\': location().columnSpan() == 7.5,\r\n                            \'span-8\': location().columnSpan() == 8,\r\n                            \'span-9\': location().columnSpan() == 9,\r\n                            \'span-10\': location().columnSpan() == 10,\r\n                            \'span-0\':location().columnSpan() == 0,\r\n                            \'hide-field\': isHidden}"></div>\r\n        </div>\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/layout-tabbed-group-template.html',[],function () { return '<script type="text/html" id="layout-tabbed-group-template">\r\n\r\n    <div class="layout-tabbed-group">\r\n        <div class="datasheet-tab-container" data-bind="">\r\n            <ul class="nav nav-tabs" data-bind="foreach: children">\r\n                <li data-bind="css :{ active : $index()==0 }">\r\n                    <a data-bind="text: caption,\r\n                          attr: { \'data-target\': \'.\' + clientGuid }" data-toggle="tab" />\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class="tab-content" data-bind="foreach: children">\r\n\r\n            <div class="tab-pane layout-element-children block-group columns-10"\r\n                 data-bind="attr: {class : clientGuid + \' tab-pane layout-element-children block-group columns-10\'},\r\n                        foreach :Object.keys($data.mappedRows()),\r\n                        css :{ active: $index()==0 }">\r\n                <div class="contentFlow" data-bind="foreach : $parent.mappedRows()[$data]">\r\n\r\n                    <div class="layout-element block"\r\n                         data-bind="visible: visible,\r\n                                template: { name: viewTemplate },\r\n                                attr:{class:viewTemplate()==\'layout-empty-space-template\'?\'layout-element block span-empty\':\'layout-element block\'},\r\n                                 css:{\'span-1\': location().columnSpan() == 1,\r\n                                    \'span-2\': location().columnSpan() == 2,\r\n                                    \'span-2-5\': location().columnSpan() == 2.5,\r\n                                    \'span-3\': location().columnSpan() == 3,\r\n                                    \'span-4\': location().columnSpan() == 4,\r\n                                    \'span-5\': location().columnSpan() == 5,\r\n                                    \'span-6\': location().columnSpan() == 6,\r\n                                    \'span-7\': location().columnSpan() == 7,\r\n                                    \'span-7-5\': location().columnSpan() == 7.5,\r\n                                    \'span-8\': location().columnSpan() == 8,\r\n                                    \'span-9\': location().columnSpan() == 9,\r\n                                    \'span-10\': location().columnSpan() == 10,\r\n                                    \'span-0\':location().columnSpan() == 0,\r\n                                    \'hide-field\': isHidden }"></div>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/layout-table-column-template.html',[],function () { return '<script type="text/html" id="layout-table-column-template">\r\n    <div class="layout-element-caption block"\r\n         data-bind="attr: {title: caption}, text: caption, \r\n                    css:\'col-\'+ ko.utils.arrayFilter($parent.children(), function(child) { return (child.type() === \'TableColumn\'); }).length"></div>\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/layout-table-row-template.html',[],function () { return '<script type="text/html" id="layout-table-row-template">\r\n    <div class="block-group datasheet-form-control" data-bind="foreach: children, css: {\'hide-field\': isHidden}">\r\n        <div>\r\n            <div class="layout-element block"\r\n                 data-bind="visible: visible, \r\n                                 css: {\'col-1\' : $parent.children().length == 1,\r\n                                       \'col-2\' : $parent.children().length == 2,\r\n                                       \'col-3\' : $parent.children().length == 3,\r\n                                       \'col-4\' : $parent.children().length == 4,\r\n                                       \'col-5\' : $parent.children().length == 5,\r\n                                       \'col-6\' : $parent.children().length == 6,\r\n                                       \'col-7\' : $parent.children().length == 7,\r\n                                       \'col-8\' : $parent.children().length == 8,\r\n                                       \'col-9\' : $parent.children().length == 9,\r\n                                       \'col-10\' : $parent.children().length == 10,\r\n                                       \'hide-field\': isHidden}, \r\n                                template: { name: viewTemplate }"></div>\r\n        </div>\r\n    </div>\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/layout-table-template.html',[],function () { return '<script type="text/html" id="layout-table-template">\r\n\r\n    <div class="layout-table">\r\n        <div>\r\n            <div>\r\n                <div class="block-group" data-bind="template: {\r\n                                   name: getChildViewTemplate,\r\n                                   foreach: ko.utils.arrayFilter(children(), function(child) { return (child.type() === \'TableColumn\'); }) }"></div>\r\n            </div>\r\n            <div data-bind="template: {\r\n                                    name: getChildViewTemplate,\r\n                                    foreach: ko.utils.arrayFilter(children(), function(child) { return (child.type() === \'TableRow\'); }) }"></div>\r\n        </div>\r\n    </div>\r\n</script>   ';});


define('text!platform/datasheets/layout/ui/views/templates/field-check-box-template.html',[],function () { return '<script type="text/html" id="field-check-box-template">\r\n    <div class="checkbox" data-bind="visible: fieldValue,\r\n                    css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n        <mi-checkbox data-bind="miCheckboxProperty:{ checked: fieldValue().computedBoolVal, disable: fieldValue().disabled() || fieldValue().clientDisabled()}"> </mi-checkbox>\r\n        \r\n\r\n        <!-- ko ifnot:$root.isBulkDatasheet() -->\r\n            <span class="help-block text-danger"\r\n                  data-bind="visible: !fieldValue().isValid(), text:fieldValue().validationMessage" ></span>\r\n            <!--ko if: fieldValue().successMessage() -->\r\n            <span class="text-warning"\r\n                  data-bind="visible: fieldValue().isValid(),\r\n                                html: fieldValue().successMessage()">\r\n            </span>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n        <!-- ko if:$root.isBulkDatasheet -->\r\n            <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n               data-bind="visible: !fieldValue().isValid() ,\r\n                    click: fieldValue().showErrorMessage,\r\n                    toolTip: fieldValue().validationMessage()"></i>\r\n            <!--ko if: fieldValue().successMessage() -->\r\n            <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n               data-bind="visible: fieldValue().isValid(),\r\n                    warningMsg: fieldValue().successMessage()"></i>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n        <!--<span class="help-block text-danger"\r\n              data-bind="visible: !fieldValue().isValid(),\r\n                             text: fieldValue().validationMessage,\r\n                             title: fieldValue().validationMessage ">,\r\n        </span>-->\r\n        <!--ko if: !$root.isBulkDatasheet() -->\r\n        <span class="help-text"\r\n              data-bind="visible: $root.helpTextModeOn() && fieldValue().isValid(), text: fieldValue().helpText">\r\n        </span>\r\n        <!-- /ko -->\r\n    </div>\r\n</script>\r\n ';});


define('text!platform/datasheets/layout/ui/views/templates/field-combo-box-template.html',[],function () { return '<script type="text/html" id="field-combo-box-template">\r\n\r\n    <div class="form-group-mi-select" data-bind="visble: fieldValue,\r\n        css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n\r\n        <!-- ko if:(fieldValue().maxNumberOfValues() > 1) -->\r\n        <mi-select data-bind="miproperty:{\r\n                                   selectedOptions: fieldValue()._values,\r\n                                   options: fieldValue().picklist,\r\n                                   optionsValue:\'value\',\r\n                                   optionsText: \'displayValue\',\r\n                                   disabled: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                    multiple: fieldValue().maxNumberOfValues() > 1\r\n                           },event:{selected:function(self, ev, values){\r\n                                fieldValue().values(values);\r\n                            }},\r\n                                   style: {\'backgroundColor\': fieldValue().backColor}"></mi-select>\r\n\r\n        <!-- /ko -->\r\n        <!-- ko ifnot:(fieldValue().maxNumberOfValues() > 1) -->\r\n        <mi-select data-bind="miproperty:{\r\n                                           value: fieldValue().picklistValue,\r\n                                           options: fieldValue().picklist,\r\n                                           optionsValue:\'value\',\r\n                                           optionsText: \'displayValue\',\r\n                                           disabled: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                            multiple: fieldValue().maxNumberOfValues() > 1\r\n                                   },\r\n                                           style: {\'backgroundColor\': fieldValue().backColor}"></mi-select>\r\n        <!-- /ko -->\r\n        <!--ko if: !$root.isBulkDatasheet() -->\r\n        <span class="help-block text-danger"\r\n              data-bind="visible: !fieldValue().isValid(),\r\n                         text: fieldValue().validationMessage">\r\n        </span>\r\n        <span class="text-warning"\r\n              data-bind="visible: fieldValue().isValid(),\r\n                            html: fieldValue().successMessage()">\r\n        </span>\r\n        <span class="help-text"\r\n              data-bind="visible: $root.helpTextModeOn() && fieldValue().isValid, text: fieldValue().helpText">\r\n        </span>\r\n        <!-- /ko -->\r\n        <!--ko if: $root.isBulkDatasheet() -->\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n           data-bind="visible: fieldValue().isValid(),\r\n                warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/field-date-template.html',[],function () { return '<script type="text/html" id="field-date-template">\r\n\r\n    <div class="form-group"\r\n         data-bind="visble: fieldValue,\r\n                    css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n\r\n\r\n        <mi-date-time data-bind=" hasFocus: fieldValue().isSelected,\r\n                      attr:{\r\n                        format:fieldValue().dateFormat,\r\n                        \'pick-time\': \'true\',\r\n                        \'use-seconds\': true,\r\n                        disabled: fieldValue().disabled() || fieldValue().clientDisabled()\r\n                      },\r\n                      value:fieldValue().dateValue,\r\n                      style: {\'backgroundColor\': fieldValue().backColor},\r\n                      event: {invalid: $root.setErrorMessageForDate.bind($root, fieldValue()),\r\n                      clear:$root.clearErrorMessageForDate.bind($root,fieldValue())}"\r\n                      ></mi-date-time>\r\n\r\n        <!--ko if: !$root.isBulkDatasheet() -->\r\n        <span class="help-block text-danger"\r\n              data-bind="visible: !fieldValue().isValid(),\r\n                         html: fieldValue().validationMessage">\r\n        </span>\r\n        <span class="text-warning"\r\n              data-bind="visible: fieldValue().isValid(),\r\n                            html: fieldValue().successMessage()">\r\n        </span>\r\n        <span class="help-text"\r\n              data-bind="visible: $root.helpTextModeOn() && fieldValue().isValid(), text: fieldValue().helpText">\r\n        </span>\r\n        <!-- /ko -->\r\n        <!--ko if: $root.isBulkDatasheet() -->\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n           data-bind="visible: fieldValue().isValid(),\r\n                warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/field-date-alt-template.html',[],function () { return '\r\n<script type="text/html" id="field-date-alt-template">\r\n\r\n    <div class="form-group"\r\n         data-bind="visible: fieldValue,\r\n                    css: { \'has-error\': fieldValue() && !fieldValue().isValid() },\r\n    ">\r\n      \r\n      \r\n\r\n        <input type="text"\r\n               class="form-control"\r\n               placeholder="---"\r\n               data-bind="event:{focus:$root.renderDateControl.bind($root,$root)},value:fieldValue().convertDate(),\r\n                                disable: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                style: {\'backgroundColor\': fieldValue().backColor},\r\n                                flash: fieldValue().shouldFlash()" />\r\n\r\n\r\n        <button type="button"\r\n                data-bind=" event:{focus:$root.renderDateControl.bind($root,$root)},disable: fieldValue().disabled() || fieldValue().clientDisabled()"\r\n                class="btn btn-icon custom-form-button custom-icon-field-button" style="z-index:0;right:0;margin-top:-38px;">\r\n            <i class="icon-calendar"></i>\r\n        </button>\r\n\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n\r\n\r\n     \r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/field-radio-template.html',[],function () { return '<script type="text/html" id="field-radio-template">\r\n\r\n    <div class="checkbox" data-bind="visible: fieldValue">\r\n        <label>\r\n            <input type="checkbox"\r\n                   data-bind="checked: fieldValue().value,\r\n                              disable: fieldValue().disabled() || fieldValue().clientDisabled()" />\r\n            <!--ko if: !$root.isBulkDatasheet() -->\r\n             <span class="help-text"\r\n                  data-bind="visible: $root.helpTextModeOn() && fieldValue().isValid(), text: fieldValue().helpText">\r\n            </span>\r\n            <!-- /ko -->\r\n        </label>\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/field-text-area-template.html',[],function () { return '<script type="text/html" id="field-text-area-template">\r\n                        \r\n    <div class="form-group"\r\n         data-bind="visible: fieldValue,\r\n                    css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n        <!--ko if: !$root.isBulkDatasheet() -->\r\n        <textarea class="form-control" rows="2"\r\n                  data-bind="value: fieldValue().isSelected() ? fieldValue().value : fieldValue().disValue,\r\n                            event: { keyup: autoGrow},\r\n                             hasFocus: fieldValue().isSelected,\r\n                             disable: fieldValue().disabled,\r\n                             style: {\'backgroundColor\': fieldValue().backColor},\r\n                            event: {keypress: $root.bindKeypress() ? $root.onControlTouched.bind($root, fieldValue()) : null},\r\n                            attr:{class:elementCss, placeholder: $root.translate(\'DS_TEXT_AREA\'), readonly: fieldValue().clientDisabled}" />\r\n        <button class="btn btn-icon textareaIcon" tabindex="-1" data-bind="event: {click: function showTextEditor(data){ $root.showTextEditor(data, $index);}}">\r\n            <i class="icon-expand-text-area" \r\n               ></i>\r\n        </button>\r\n        <span class="help-block text-danger"\r\n              data-bind="visible: !fieldValue().isValid(),\r\n                         html: fieldValue().validationMessage">\r\n        </span>\r\n        <span class="text-warning"\r\n              data-bind="visible: fieldValue().isValid(),\r\n                            html: fieldValue().successMessage()">\r\n        </span>\r\n        <span class="help-text"\r\n              data-bind="visible: $root.helpTextModeOn() && fieldValue().isValid(), text: fieldValue().helpText">\r\n        </span>\r\n        <!--/ko-->\r\n\r\n        <!--ko if: $root.isBulkDatasheet() -->\r\n        <textarea class="form-control"\r\n                  placeholder="---"\r\n                  data-bind="text: fieldValue().displayValue,\r\n                            value: fieldValue().isSelected() ? fieldValue().value : fieldValue().displayValue,\r\n                            hasFocus: fieldValue().isSelected,\r\n                            disable: fieldValue().disabled,\r\n                            style: {\'backgroundColor\': fieldValue().backColor}, attr: {readonly: fieldValue().clientDisabled}" />\r\n        <button class="btn btn-icon textareaIcon" tabindex="-1"  data-bind="event: {click: function showTextEditor(data){ $root.showTextEditor(data, $index, $parentContext.$index);}}">\r\n            <i class="icon-expand-text-area"></i>\r\n        </button>\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n           data-bind="visible: fieldValue().isValid(),\r\n                warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n        <!--/ko-->\r\n\r\n\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/field-hyperlink-template.html',[],function () { return '<script type="text/html" id="field-hyperlink-template">\r\n\r\n    <div class="form-group"\r\n         data-bind="visble: fieldValue,\r\n                    css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n        <!--<div class="form-control hyperlinkEllipsis" data-bind="html: fieldValue().displayValue,attr:{title:fieldValue().innerText()}"></div>-->\r\n                                     \r\n        <!--ko if: !$root.isBulkDatasheet() -->\r\n        <!--ko if: fieldValue().jsModuleName() && fieldValue().jsModuleName().length -->\r\n        <!--ko if: (/<a href=.*<\\/a>/.test(fieldValue().displayValue())) -->\r\n        <div class="form-control" data-bind="html:fieldValue().isSelected() ? fieldValue().value : fieldValue().disValue,disable: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                        style: {\'backgroundColor\': fieldValue().backColor},\r\n                                        attr:{class:elementCss() + \' hyperlinkEllipsis\'},\r\n                event:{focus: function bulk_datasheet_view_model_callOnFocus(data){  $root.callOnFocus(fieldValue().key(), fieldValue().entityKey(), fieldValue().clientid(), fieldValue().jsModuleName(), fieldValue().jsModuleParams(), fieldValue().popJSModuleOnFocus()); }}"></div>\r\n        <button type="button"\r\n                placeholder="..."\r\n                data-bind="click: function datasheet_view_model_showJSModule(data){$root.showJSModule(fieldValue().key(), fieldValue().jsModuleName(), fieldValue().jsModuleParams(), $data, $index, $parentContext.$index, fieldValue().jsModuleUseApply);}"\r\n                class="btn btn-icon custom-form-button custom-icon-field-button custom-hyperlink-js-module-button">\r\n            <i class="icon-more"></i>\r\n        </button>\r\n        <!-- /ko -->\r\n        <!--ko ifnot: (/<a href=.*<\\/a>/.test(fieldValue().displayValue())) -->\r\n        <input type="text"\r\n               placeholder="..."\r\n               class="form-control custom-form-text"\r\n               data-bind="hasFocus: fieldValue().isSelected,\r\n                                      value: fieldValue().isSelected() ? fieldValue().jsModuleValue : fieldValue().disValue,\r\n                                        disable: fieldValue().disabled,\r\n                                        style: {\'backgroundColor\': fieldValue().backColor},\r\n                                        attr:{class:elementCss, readonly:fieldValue().clientDisabled},\r\n                event:{focus: function bulk_datasheet_view_model_callOnFocus(data){  $root.callOnFocus(fieldValue().key(), fieldValue().entityKey(), fieldValue().clientid(), fieldValue().jsModuleName(), fieldValue().jsModuleParams(), fieldValue().popJSModuleOnFocus()); }}\r\n                ">\r\n        <button type="button"\r\n                placeholder="..."\r\n                data-bind="click: function datasheet_view_model_showJSModule(data){$root.showJSModule(fieldValue().key(), fieldValue().jsModuleName(), fieldValue().jsModuleParams(), $data, $index, $parentContext.$index, fieldValue().jsModuleUseApply);}"\r\n                class="btn btn-icon custom-form-button custom-icon-field-button">\r\n            <i class="icon-more"></i>\r\n        </button>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n        <!--ko ifnot: fieldValue().jsModuleName() && fieldValue().jsModuleName().length -->\r\n        <div class="form-control hyperlinkEllipsis" data-bind="html: fieldValue().displayValue,attr:{title:fieldValue().innerText()}"></div>\r\n        <!--/ko-->\r\n       \r\n        <span class="help-block text-danger"\r\n              data-bind="visible: !fieldValue().isValid(),\r\n                                     html: fieldValue().validationMessage">\r\n        </span>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <span class="text-warning"\r\n              data-bind="visible: fieldValue().isValid(),\r\n                            html: fieldValue().successMessage()">\r\n        </span>\r\n        <!-- /ko -->\r\n\r\n        <span class="help-text"\r\n              data-bind="visible: $root.helpTextModeOn() && fieldValue().isValid(), text: fieldValue().helpText">\r\n        </span>\r\n        <!-- /ko -->\r\n\r\n        <!--ko if: $root.isBulkDatasheet()-->\r\n        <div class="form-control hyperlinkEllipsis" data-bind="html: fieldValue().displayValue,attr:{title:fieldValue().innerText()}"></div>-->\r\n        <!--ko if: fieldValue().jsModuleName() && fieldValue().jsModuleName().length -->\r\n        <input type="button"\r\n               class="btn btn-icon custom-bulk-ds-button"\r\n               placeholder="..."\r\n               data-bind="value: \'...\',\r\n                            click: function bulk_datasheet_view_model_showJSModule(data){ $root.showJSModule(fieldValue().key(), fieldValue().entityKey(), fieldValue().clientid(), fieldValue().jsModuleName(), fieldValue().jsModuleParams(), $data, $index, $parentContext.$index);}">\r\n        <!-- /ko -->\r\n            <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n               data-bind="visible: !fieldValue().isValid() ,\r\n                    click: fieldValue().showErrorMessage,\r\n                    toolTip: fieldValue().validationMessage()"></i>\r\n            <!--ko if: fieldValue().successMessage() -->\r\n            <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n               data-bind="visible: fieldValue().isValid(),\r\n                    warningMsg: fieldValue().successMessage()"></i>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n\r\n    </div>\r\n\r\n</script> ';});


define('text!platform/datasheets/layout/ui/views/templates/field-text-template.html',[],function () { return '<script type="text/html" id="field-text-template">\r\n\r\n    <div class="form-group"\r\n         data-bind="visible: fieldValue,\r\n                    css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n        <!--ko if: !$root.isBulkDatasheet() -->\r\n        <!--ko if: fieldValue() && !fieldValue().jsModuleName()-->\r\n        <input type="text"\r\n               data-bind="hasFocus: fieldValue().isSelected,\r\n                              value: fieldValue().isSelected() ? fieldValue().value : fieldValue().disValue,\r\n                                disable: fieldValue().disabled, \r\n                                event: {keypress: $root.bindKeypress() ? $root.onControlTouched.bind($root, fieldValue()) : null},\r\n                                style: {\'backgroundColor\': fieldValue().backColor},\r\n                                attr:{class:elementCss, placeholder: fieldValue().placeHolder, maxLength: fieldValue().dbLength, readonly:fieldValue().clientDisabled}" class="form-control">\r\n\r\n        <span class="help-block text-danger"\r\n              data-bind="visible: !fieldValue().isValid(),\r\n                            html: fieldValue().validationMessage">\r\n        </span>\r\n        <span class="text-warning"\r\n              data-bind="visible: fieldValue().isValid(),\r\n                            html: fieldValue().successMessage()">\r\n        </span>\r\n        <span class="help-text"\r\n              data-bind="visible: $root.helpTextModeOn() && fieldValue().isValid(), text: fieldValue().helpText">\r\n        </span>\r\n        <!-- /ko -->\r\n        <!--ko if: fieldValue().jsModuleName() && fieldValue().jsModuleName().length -->\r\n        <!--ko if: (/<a href=.*<\\/a>/.test(fieldValue().displayValue())) -->\r\n        <div class="form-control" data-bind="html:fieldValue().isSelected() ? fieldValue().value : fieldValue().disValue,disable: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                        style: {\'backgroundColor\': fieldValue().backColor},\r\n                                        attr:{class:elementCss() + \' hyperlinkEllipsis\'},\r\n                event:{focus: function bulk_datasheet_view_model_callOnFocus(data){  $root.callOnFocus(fieldValue().key(), fieldValue().entityKey(), fieldValue().clientid(), fieldValue().jsModuleName(), fieldValue().jsModuleParams(), fieldValue().popJSModuleOnFocus()); }}"></div>\r\n        <button type="button"\r\n                placeholder="..."\r\n                data-bind="click: function datasheet_view_model_showJSModule(data){$root.showJSModule(fieldValue().key(), fieldValue().jsModuleName(), fieldValue().jsModuleParams(), $data, $index, $parentContext.$index, fieldValue().jsModuleUseApply);}"\r\n                class="btn btn-icon custom-form-button custom-icon-field-button custom-hyperlink-js-module-button">\r\n            <i class="icon-more"></i>\r\n        </button>\r\n        <!-- /ko -->\r\n        <!--ko ifnot: (/<a href=.*<\\/a>/.test(fieldValue().displayValue())) -->\r\n        <input type="text"\r\n               placeholder="..."\r\n               class="form-control custom-form-text"\r\n               data-bind="hasFocus: fieldValue().isSelected,\r\n                                      value: fieldValue().isSelected() ? fieldValue().jsModuleValue : fieldValue().disValue,\r\n                                        disable: fieldValue().disabled,\r\n                                        style: {\'backgroundColor\': fieldValue().backColor},\r\n                                        attr:{class:elementCss, readonly:fieldValue().clientDisabled},\r\n                event:{focus: function bulk_datasheet_view_model_callOnFocus(data){  $root.callOnFocus(fieldValue().key(), fieldValue().entityKey(), fieldValue().clientid(), fieldValue().jsModuleName(), fieldValue().jsModuleParams(), fieldValue().popJSModuleOnFocus()); }}\r\n                ">\r\n        <button type="button"\r\n                placeholder="..."\r\n                data-bind="click: function datasheet_view_model_showJSModule(data){$root.showJSModule(fieldValue().key(), fieldValue().jsModuleName(), fieldValue().jsModuleParams(), $data, $index, $parentContext.$index, fieldValue().jsModuleUseApply);}"\r\n                class="btn btn-icon custom-form-button custom-icon-field-button">\r\n            <i class="icon-more"></i>\r\n        </button>\r\n        <!-- /ko -->\r\n\r\n        <span class="help-block text-danger"\r\n              data-bind="visible: !fieldValue().isValid(),\r\n                                     html: fieldValue().validationMessage">\r\n        </span>\r\n        <span class="text-warning"\r\n              data-bind="visible: fieldValue().isValid(),\r\n                            html: fieldValue().successMessage()">\r\n        </span>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n        <!--ko if: $root.isBulkDatasheet() -->\r\n        <!--ko if: !fieldValue().jsModuleName() -->\r\n        <input type="text"\r\n               class="form-control"\r\n               placeholder="---"\r\n               data-bind="hasFocus: fieldValue().isSelected,\r\n                              value: fieldValue().isSelected() ? fieldValue().value : fieldValue().disValue,\r\n                                disable: fieldValue().disabled,\r\n                                style: {\'backgroundColor\': fieldValue().backColor},\r\n                                flash: fieldValue().shouldFlash(), attr: { title: fieldValue().disValue, maxLength: fieldValue().dbLength , readonly:fieldValue().clientDisabled}" />\r\n        <!-- /ko -->\r\n        <!--ko if: fieldValue().jsModuleName() && fieldValue().jsModuleName().length -->\r\n        <input type="text"\r\n               style="margin-right: 26px;"\r\n               class="form-control custom-form-text"\r\n               placeholder="..."\r\n               data-bind="hasFocus: fieldValue().isSelected,\r\n                                  value: fieldValue().isSelected() ? fieldValue().jsModuleValue : fieldValue().disValue,\r\n                                    disable: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                    style: {\'backgroundColor\': fieldValue().backColor},\r\n                                    flash: fieldValue().shouldFlash(),\r\n    event: {focus: function bulk_datasheet_view_model_showJSModule(data){ $root.callOnFocus(fieldValue(), $data, $index, $parentContext.$index);}}\r\n                                    ">\r\n        <input type="button"\r\n               class="btn btn-icon custom-bulk-ds-button"\r\n               placeholder="..."\r\n               data-bind="value: \'...\',\r\n                            click: function bulk_datasheet_view_model_showJSModule(data){ $root.showJSModule(fieldValue().key(), fieldValue().entityKey(), fieldValue().clientid(), fieldValue().jsModuleName(), fieldValue().jsModuleParams(), $data, $index, $parentContext.$index, fieldValue().jsModuleUseApply);}">\r\n        <!-- /ko -->\r\n\r\n\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n            data-bind="visible: fieldValue().isValid(),\r\n                warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/field-select-template.html',[],function () { return '<script type="text/html" id="field-select-template">\r\n\r\n    <div class="form-group-select">\r\n        <select class="form-control" data-bind="value: fieldValue().picklistValue,\r\n                                           options: fieldValue().picklist,\r\n                                           optionsValue:\'value\',\r\n                                           optionsText: \'displayValue\',\r\n                                           disable: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                           visible:fieldValue(),\r\n                                           style: {\'backgroundColor\': fieldValue().backColor}"></select>\r\n        <!--ko if: $root.isBulkDatasheet() -->\r\n            <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n               data-bind="visible: !fieldValue().isValid() ,\r\n                    click: fieldValue().showErrorMessage,\r\n                    toolTip: fieldValue().validationMessage()"></i>\r\n            <!--ko if: fieldValue().successMessage() -->\r\n            <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n               data-bind="visible: fieldValue().isValid(),\r\n                    warningMsg: fieldValue().successMessage()"></i>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n    </div>\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/field-multivalue-template.html',[],function () { return '<script type="text/html" id="field-multivalue-template">\r\n\r\n    <div data-bind="visble: fieldValue,\r\n        css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n\r\n\r\n\r\n        <!-- ko if:(fieldValue().maxNumberOfValues() > 1) -->\r\n\r\n        <mi-multi-value data-bind="miproperty:{\r\n                                        selectedOptions: fieldValue().values,\r\n                                       options: fieldValue().picklist,\r\n                                       optionsValue: \'value\',\r\n                                       optionsText:  \'displayValue\',\r\n                                       disabled: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                       multiple: fieldValue().maxNumberOfValues() > 1\r\n                                       },\r\n                                       style: {\'backgroundColor\': fieldValue().backColor}"></mi-multi-value>\r\n\r\n        <!-- /ko -->\r\n        <!-- ko ifnot:(fieldValue().maxNumberOfValues() > 1) -->\r\n\r\n        <mi-multi-value data-bind="miproperty:{\r\n                                       value: fieldValue().picklistValue,\r\n                                       options: fieldValue().picklist,\r\n                                       optionsValue: \'value\',\r\n                                       optionsText:  \'displayValue\',\r\n                                       disabled: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                       multiple: fieldValue().maxNumberOfValues() > 1\r\n                                       },\r\n                                       style: {\'backgroundColor\': fieldValue().backColor}"></mi-multi-value>\r\n\r\n        <!-- /ko -->\r\n        \r\n        <!--ko if: !$root.isBulkDatasheet() -->\r\n        <span class="help-block text-danger"\r\n              data-bind="visible: !fieldValue().isValid(),\r\n                         text: fieldValue().validationMessage">\r\n        </span>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <span class="text-warning"\r\n              data-bind="visible: fieldValue().isValid(),\r\n                            html: fieldValue().successMessage()">\r\n        </span>\r\n        <!-- /ko -->\r\n        <span class="help-text"\r\n              data-bind="visible: $root.helpTextModeOn() && fieldValue().isValid, text: fieldValue().helpText">\r\n        </span>\r\n        <!-- /ko -->\r\n        <!--ko if: $root.isBulkDatasheet() -->\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n           data-bind="visible: fieldValue().isValid(),\r\n                    warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/field-empty-template.html',[],function () { return '<script type="text/html" id="field-empty-template">\r\n\r\n    <div class="form-group disabled" data-bind="style:{\'background-color\':\'#eee\',\'min-height\':\'25px\'}">\r\n\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/field-browse-template.html',[],function () { return '<script type="text/html" id="field-browse-template"> \r\n    <div data-bind="visble: fieldValue">\r\n        <form enctype="multipart/form-data" class="refdoc-form" method="post">\r\n            <div class="block-group">\r\n                <input class="block form-control" name="file" type="text" data-bind="value: fieldValue().value" style="width: 90%;">\r\n\r\n                <label for="file-browse" class="btn btn-primary" style="padding: 4px 12px;">...</label>\r\n                <input id="file-browse" class="block browse-control" readonly name="file" type="file" data-bind="value: fieldValue().browsevalue" style="display: none;">\r\n\r\n            </div>\r\n        </form>\r\n    </div>\r\n</script>\r\n';});


define('text!platform/datasheets/layout/ui/views/templates/field-multi-text-template.html',[],function () { return '<script type="text/html" id="field-multi-text-template">\r\n\r\n    <div data-bind="visble: fieldValue,\r\n        css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n\r\n        <mi-text-ext data-bind="miproperty:{\r\n                           value: fieldValue().value,\r\n                           options: fieldValue().values,\r\n                           disable: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                           },\r\n                           style: {\'backgroundColor\': fieldValue().backColor}"></mi-text-ext>\r\n\r\n\r\n        <!--ko if: !$root.isBulkDatasheet() -->\r\n        <span class="help-block text-danger"\r\n              data-bind="visible: !fieldValue().isValid(),\r\n                         html: fieldValue().validationMessage">\r\n        </span>\r\n        <span class="text-warning"\r\n              data-bind="visible: fieldValue().isValid(),\r\n                            html: fieldValue().successMessage()">\r\n        </span>\r\n        <!-- /ko -->\r\n        <!--ko if: $root.isBulkDatasheet() -->\r\n            <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n               data-bind="visible: !fieldValue().isValid() ,\r\n                    click: fieldValue().showErrorMessage,\r\n                    toolTip: fieldValue().validationMessage()"></i>\r\n            <!--ko if: fieldValue().successMessage() -->\r\n            <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n               data-bind="visible: fieldValue().isValid(),\r\n                    warningMsg: fieldValue().successMessage()"></i>\r\n            <!-- /ko -->\r\n\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/field-masked-template.html',[],function () { return '<script type="text/html" id="field-masked-template">\r\n    <div class="form-group" data-bind="visible: fieldValue,\r\n                                       css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n               \r\n        <!--ko if: !$root.isBulkDatasheet() -->\r\n        <input type="password" data-bind="hasFocus: fieldValue().isSelected,\r\n                                          value: fieldValue().isSelected() ? fieldValue().value : fieldValue().disValue,\r\n                                          style: {\'backgroundColor\': fieldValue().backColor},\r\n                                          attr:{class: elementCss, placeholder: $root.translate(\'DS_MASKED_INPUT\'),\r\n                                                maxLength: fieldValue().dbLength}" class="form-control" />\r\n        <span class="help-block text-danger"\r\n              data-bind="visible: !fieldValue().isValid(),\r\n                            html: fieldValue().validationMessage">\r\n        </span>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <span class="text-warning"\r\n              data-bind="visible: fieldValue().isValid(),\r\n                            html: fieldValue().successMessage()">\r\n        </span>\r\n        <!-- /ko -->\r\n        <span class="help-text"\r\n              data-bind="visible: $root.helpTextModeOn() && fieldValue().isValid(), text: fieldValue().helpText">\r\n        </span>\r\n        <!-- /ko -->\r\n\r\n        <!--ko if: $root.isBulkDatasheet() -->\r\n        <input type="password" data-bind="hasFocus: fieldValue().isSelected,\r\n                                          value: fieldValue().isSelected() ? fieldValue().value : fieldValue().disValue,\r\n                                          style: {\'backgroundColor\': fieldValue().backColor},\r\n                                          attr:{maxLength: fieldValue().dbLength}" class="form-control" placeholder="---" />\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n           data-bind="visible: fieldValue().isValid(),\r\n                warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n    </div>\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/field-uom-template.html',[],function () { return '<script type="text/html" id="field-uom-template">\r\n\r\n    <div class="form-group"\r\n         data-bind="visible: fieldValue,\r\n                    css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n        <!--ko if: !$root.isBulkDatasheet() -->\r\n        <!--ko if: fieldValue()-->\r\n        <input type="text"\r\n               data-bind="hasFocus: fieldValue().isSelected,\r\n                              value: fieldValue().isSelected() ? fieldValue().value : fieldValue().disValue,\r\n                                disable: fieldValue().disabled,\r\n                                event: {keypress: $root.bindKeypress() ? $root.onControlTouched.bind($root, fieldValue()) : null},\r\n                                style: {\'backgroundColor\': fieldValue().backColor},\r\n                                attr:{class:elementCss, placeholder: fieldValue().placeHolder, maxLength: fieldValue().dbLength,\r\n                                readonly:fieldValue().clientDisabled}" class="form-control" />\r\n\r\n        <button type="button"\r\n                placeholder="..."\r\n                data-bind="click: $root.showUOMConversionTool.bind(null, $root),\r\n                 disable: !fieldValue().value() || fieldValue().disabled"\r\n                class="btn btn-icon custom-form-button custom-icon-field-button">\r\n            <i class="icon-uom"></i>\r\n        </button>\r\n\r\n        <span class="help-block text-danger"\r\n              data-bind="visible: !fieldValue().isValid(),\r\n                            html: fieldValue().validationMessage">\r\n        </span>\r\n        <span class="text-warning"\r\n              data-bind="visible: fieldValue().isValid(),\r\n                            html: fieldValue().successMessage()">\r\n        </span>\r\n        <span class="help-text"\r\n              data-bind="visible: $root.helpTextModeOn() && fieldValue().isValid(), text: fieldValue().helpText">\r\n        </span>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n\r\n        <!--ko if: $root.isBulkDatasheet() -->\r\n        <input type="text"\r\n               class="form-control"\r\n               placeholder="---"\r\n               data-bind="hasFocus: fieldValue().isSelected,\r\n                              value: fieldValue().isSelected() ? fieldValue().value : fieldValue().disValue,\r\n                                disable: fieldValue().disabled,\r\n                                style: {\'backgroundColor\': fieldValue().backColor},\r\n                                flash: fieldValue().shouldFlash(), attr: { maxLength: fieldValue().dbLength , readonly:fieldValue().clientDisabled}" />\r\n        <button type="button"\r\n                placeholder="..."\r\n                data-bind="click: $root.showUOMConversionTool.bind(null, $root),\r\n                 disable: !fieldValue().value() || fieldValue().disabled"\r\n                class="btn btn-icon custom-form-button custom-icon-field-button bulk-uom-button">\r\n            <i class="icon-uom"></i>\r\n        </button>\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n           data-bind="visible: fieldValue().isValid(),\r\n                warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n</script>';});

define('platform/metadata/models/unit-of-measure',['require'],function(require){"use strict";function a(a){this.caption=a.caption,this.category=a.category,this.description=a.description,this.id=a.id,this.key=a.key}return a});
define('platform/metadata/models/field-metadata',['require','platform/metadata/models/unit-of-measure'],function(require){"use strict";var a=require("platform/metadata/models/unit-of-measure");function b(a){a=a||{},this.caption=a.caption,this.defaultCaption=a.description,this.description=a.description,this.helpText=a.helpText,this.id=a.id,this.isActive=a.isActive,this.isBaselineField=a.isBaselineField,this.isCalculated=a.isCalculated,this.isCaptionField=a.isCaptionField,this.isHtmlField=a.isHtmlField,this.isIdField=a.isIdField,this.isRuleLock=a.isRuleLock,this.isSearchable=a.isSearchable,this.isStateManagementField=a.isStateManagementField,this.isSystemfield=a.isSystemfield,this.isUtcField=a.isUtcField,this.keepHistory=a.keepHistory,this.key=a.key,this.length=a.length,this.maxNumberOfValues=a.maxNumberOfValues,this.overridesParentAttributes=a.overridesParentAttributes,this.physicalAttributesKey=a.physicalAttributesKey,this.physicalColumnName=a.physicalColumnName,this.sequenceNumber=a.sequenceNumber,this.spreadToAllChildren=a.spreadToAllChildren,
this.unitOfMeasureKey=a.unitOfMeasureKey,this.validationText=a.validationText,this.dataType=a.dataType,this.stateFieldType=a.stateFieldType,this.baseFamilyKey=a.baseFamilyKey,this.familyKey=a.familyKey,this.parentFieldKey=a.parentFieldKey,this.customizationFieldKey=a.customizationFieldKey,this.behaviors=a.behaviors}return b});
define('platform/metadata/models/family-metadata',['require','lodash','system/text/parser','platform/metadata/models/field-metadata'],function(require){"use strict";var a=require("lodash"),b=require("system/text/parser"),c=require("platform/metadata/models/field-metadata"),d=1,e=2,f=4,g=8;function h(h){h=h||{},this.caption=h.caption,this.databaseTableName=h.databaseTableName,this.databaseViewName=h.databaseViewName,this.defaultCaption=h.defaultCaption,this.description=h.description,this.id=h.id,this.isBaselineFamily=h.isBaselineFamily,this.isRuleLock=h.isRuleLock,this.key=h.key,this.updateDate=b.parseDate(h.updateDate),this.updateUser=h.updateUser,this.status=h.status,this.securityPrivileges=h.securityPrivileges,this.fields=a.map(h.fields,function(a){return new c(a)}),this.predecessors=h.predecessors,this.successors=h.successors,this.relationships=h.relationships,this.canDelete=(this.securityPrivileges&g)===g,this.canInsert=(this.securityPrivileges&d)===d,this.canUpdate=(this.securityPrivileges&f)===f,this.canView=(this.securityPrivileges&e)===e}return h});
define('platform/metadata/services/metadata',['require','lodash','jquery','system/lang/object','system/http/ajax-client','platform/metadata/models/family-metadata'],function(require){"use strict";var a=require("lodash"),b=require("jquery");require("system/lang/object");var c=require("system/http/ajax-client"),d="api/core/metadata",e=require("platform/metadata/models/family-metadata");function f(a){this.ajaxClient=a}return f.dependsOn=[c],f.prototype.getEntityFamilies=function(){var c=b.Deferred();return this.ajaxClient.get(d+"/entityfamilies").done(function(b){c.resolve(a.map(b,function(a){return new e(a)}))}).fail(function(a){c.reject(a)}),c.promise()},f.prototype.getEntityFamilyByKey=function(a){var c=b.Deferred();return this.ajaxClient.get(d+"/entityfamily/"+a).done(function(a){c.resolve(new e(a))}).fail(function(a){c.reject(a)}),c.promise()},f.prototype.getEntityFamilyByid=function(a){var c=b.Deferred();return this.ajaxClient.get(d+"/entityfamily?id="+a).done(function(a){c.resolve(new e(a))}).fail(function(a){c.reject(a)}),c.promise()},f.prototype.getRelationshipFamilies=function(){var c=b.Deferred()
;return this.ajaxClient.get(d+"/relationshipfamilies").done(function(b){c.resolve(a.map(b,function(a){return new e(a)}))}).fail(function(a){c.reject(a)}),c.promise()},f.prototype.getRelationshipFamilyByKey=function(a){var c=b.Deferred();return this.ajaxClient.get(d+"/relationshipfamily/"+a).done(function(a){c.resolve(a?new e(a):null)}).fail(function(a){c.reject(a)}),c.promise()},f.prototype.getRelationshipFamilyById=function(a){var c=b.Deferred();return this.ajaxClient.get(d+"/relationshipfamily?id="+a).done(function(a){c.resolve(a?new e(a):null)}).fail(function(a){c.reject(a)}),c.promise()},f.prototype.getEntityFields=function(a,c){return b.Deferred().resolve("").promise()},f.prototype.retrieveFamilyReports=function a(c){var e=b.Deferred();return this.ajaxClient.get(d+"/entityfamily/"+c+"/familyreports").done(function(a){e.resolve(a)}).fail(function(a){e.reject([])}),e.promise()},f.singleton=!0,Object.resolve(f)});

define('text!platform/datasheets/layout/ui/views/uom-conversion-view.html',[],function () { return '<div class="uom-conversion-container">\r\n    <div class="uomView">\r\n        <div style="text-align: center;">\r\n            <span data-bind="text: errorMsg, visible: errorMsg" class="text-danger"></span>\r\n        </div>\r\n        <div class="row">\r\n            <div class="left-column">\r\n                <span data-bind="text:translator.translate(\'ORGINAL_VAL\')"></span>\r\n                <input type="text" class="field-text form-control"\r\n                        data-bind="value: originalUOMValue" readonly="readonly" />\r\n            </div>\r\n            <div class="right-column">\r\n                <mi-checkbox data-bind="miCheckboxProperty:{\r\n                             checked:replaceNewValue,\r\n                             disable:!valueUpdated(),\r\n                             text:translator.translate(\'REPLACE_EXT_VAL\')\r\n                           }">\r\n                </mi-checkbox>\r\n            </div>\r\n        </div>\r\n        <div class="row">\r\n            <div class="left-column">\r\n                <span data-bind="text:translator.translate(\'CONVERTED_VAL\')"></span>\r\n                <input type="text" class="field-text form-control" data-bind="value: convertedValue" \r\n                       id="convertedValue" />\r\n            </div>\r\n            <div class="right-column">\r\n                <mi-select data-bind="miproperty:{\r\n                                   options: uomlist,\r\n                                   optionsText: \'caption\',\r\n                                   optionsValue: \'key\',\r\n                                   value: selectedUom\r\n                               }, event:{\r\n                                    valueChange: covertToNewUOM\r\n                           }">\r\n                </mi-select>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="controls">\r\n        <button type="button" class="btn btn-text" data-bind="click: cancel.bind($root),\r\n                text:translator.translate(\'CANCEL\')"></button>\r\n        <button type="button" class="btn btn-text" data-bind="click: setValueToDataSheet.bind($root),\r\n                text:translator.translate(\'DONE\'), disable: !allowReplace() || !replaceNewValue()"></button>\r\n    </div>\r\n</div>';});

define('platform/datasheets/layout/model/uom-conversion-model',['require','jquery','lodash','knockout','spa/ko/knockout-view-model','system/ui/dialog-view-model','text!../../layout/ui/views/uom-conversion-view.html','system/globalization/translator','../services/datasheet-service','system/text/parser','ui/elements/select/view-model','ui/elements/checkbox/checkbox-view-model'],function(require){"use strict";var a=require("jquery"),b=require("lodash"),c=require("knockout"),d=require("spa/ko/knockout-view-model"),e=require("system/ui/dialog-view-model"),f=require("text!../../layout/ui/views/uom-conversion-view.html"),g=require("system/globalization/translator"),h=require("../services/datasheet-service"),i=require("system/text/parser");require("ui/elements/select/view-model"),require("ui/elements/checkbox/checkbox-view-model");function j(a,b){var d=this;k.call(this,f),d.translator=a,d.dialog=null,d.service=b,d.uomConversionSet=[],d.uomlist=c.observableArray(),d.selectedUom=c.observable(),d.replaceNewValue=c.observable(!1),d.valueUpdated=c.observable(!1),d.allowReplace=c.observable(!1),d.originalUOMValue=c.observable(),d.convertedValue=c.observable(),d.errorMsg=c.observable(),d.uomKey=null,d.uomDesc=null,d.originalValue=null}j.dependsOn=[g,h];var k=Object.inherit(d,j);j.prototype.attach=function a(b){var c=this;k.prototype.attach.call(this,b),c.region=b,
n(c)},j.prototype.show=function a(b){var c=this;c.loadData(b).done(function(){c.dialog=new e(c,c.translator.translate("UOM_CONVERTER_TOOL"),{width:"35%",closeIcon:!0}),c.dialog.show()})},j.prototype.loadData=function b(c){var d=this,e=a.Deferred();return d.uomKey=c.fieldValue().uomKey(),m(d,c),d.service.getUomCoversion(d.uomKey).then(l.bind(null,d,e)).done(function(a){d.uomlist(a),e.resolve(a)}),e.promise()},j.prototype.cancel=function a(){this.dialog.closeDialog()},j.prototype.covertToNewUOM=function a(c,d,e){if(e===c.uomKey)c.convertedValue(c.originalValue);else{var f=b.find(c.uomConversionSet,{toUomKey:e}),g=p(c.convertedValue(),f);c.convertedValue(g)}},j.prototype.setValueToDataSheet=function a(){var b=this;b.layoutViewModel.fieldValue().value(b.originalValue.toString()),b.dialog.closeDialog()};function l(a,b,c){for(var d=[a.uomKey],e=0;e<c.length;e++)d.push(c[e].toUomKey);return a.uomConversionSet=c,a.service.getUoms(d)}function m(a,b){a.uomDesc=b.fieldValue().uom(),
a.originalValue=b.fieldValue().value(),a.originalUOMValue(a.originalValue+" ("+a.uomDesc+")"),a.convertedValue(b.fieldValue().value()),a.selectedUom(a.uomKey),a.layoutViewModel=b}function n(b){a(b.region.$element).find("#convertedValue").on("change",o.bind(null,b))}function o(b,c){var d=c.target.value;if(q(b,d))return void a(c.target).addClass("has-error");var e=b.selectedUom();b.uomKey!==e?b.service.getUomCoversionByKey(e,b.uomKey).done(function(a){var c=p(d,a);b.originalValue=c,b.originalUOMValue(b.originalValue+" ("+b.uomDesc+")")}):(b.originalValue=d,b.originalUOMValue(b.originalValue+" ("+b.uomDesc+")")),b.valueUpdated(!0),b.replaceNewValue(!0)}function p(a,b){return(i.parseFloat(a)+b.base)*(b.numerator/b.denominator)+b.offset}function q(b,c){return!c||(i.parseFloat(c)?(b.allowReplace(!0),b.errorMsg(""),void a(b.region.$element).find("#convertedValue").removeClass("has-error")):(b.errorMsg(b.translator.translate("QUERY_INVALID_NUMBER")),b.allowReplace(!1),!0))}return j});
define('platform/entity/services/dto/entity-field-dto',['require','jquery','system/lang/converter'],function(require){"use strict";var a=require("jquery"),b=require("system/lang/converter");function c(c){var e=this;if(c=c||{},e.key=b.toString(c.key),e.id=b.toString(c.id),e.caption=b.toString(c.caption),e.defaultCaption=b.toString(c.defaultCaption),e.changing=b.toBoolean(c.changing),e.dataType=b.toString(c.dataType),e.errorMessage=b.toString(c.errorMessage),e.isActive=b.toBoolean(c.isActive),e.dbLength=b.toString(c.dbLength),e.dbValue=b.toString(c.dbValue),e.dependentFields=b.toObject(c.dependentFields,[]),e.displayValue=b.toString(c.displayValue),e.defaultValue="Boolean"===e.dataType?b.toBoolean(b.toString(c.defaultValue).toLowerCase(),"true"):b.toString(c.defaultValue),e.fieldHistoryKeys=b.toObject(c.fieldHistoryKeys,[]),e.isDisabled=b.toBoolean(c.isDisabled),e.isRequired=b.toBoolean(c.isRequired),e.isHidden=b.toBoolean(c.isHidden),e.isHtmlField=b.toBoolean(c.isHtmlField),e.format=b.toString(c.format),e.maxNumberOfValues=b.toString(c.maxNumberOfValues),
e.originalValue=b.toString(c.originalValue),void 0!==c.pickList&&(e.pickList=b.toObject(c.pickList,void 0),e.isPicklistRestricted=b.toBoolean(c.isPicklistRestricted)),e.previousValues=b.toObject(c.previousValues,void 0),e.previousValue=b.toString(c.previousValue),e.unitOfMeasure=b.toString(c.unitOfMeasure),e.unitOfMeasureKey=b.toString(c.unitOfMeasureKey),e.backColor=b.toString(c.backColor),e.jsModuleName="",e.jsModuleParams="",e.popJSModuleOnFocus="",e.addParseValueParam="",void 0!==c.jsModule&&""!==c.jsModule)e.jsModuleName=a.parseJSON(c.jsModule).jsmodule,e.jsModuleParams=a.parseJSON(c.jsModule).params,e.jsModuleUseApply=a.parseJSON(c.jsModule).useApply,e.popJSModuleOnFocus=b.toBoolean(a.parseJSON(c.jsModule).popJSModuleOnFocus,"true"),e.addParseValueParam=b.toBoolean(a.parseJSON(c.jsModule).addParseValueParam,"true");else if(c.jsModuleName){var f={};f.jsmodule=c.jsModuleName,f.params=c.jsModuleParams,f.popJSModuleOnFocus=c.popJSModuleOnFocus,
f.addParseValueParam=c.addParseValueParam,e.jsModule=JSON.stringify(f)}e.value="Boolean"===e.dataType?b.toBoolean(b.toString(c.value).toLowerCase(),"true"):b.toString(c.value),e.values="Boolean"===e.dataType?[b.toBoolean(b.toString(c.values).toLowerCase(),"true")]:d(b.toObject(c.values)),e.error=b.toString(c.error),e.helpText=b.toString(c.helpText),e.successMessage=b.toString(c.successMessage)}function d(a){for(var b=[],c=0;a&&c<a.length;c++)null!==a[c]&&b.push(a[c]);return b}return c.fromDataCollection=function a(b){var d,e=[];if(b.length>0&&void 0!==b[0])for(d=0;d<b.length;d++)e.push(new c(b[d]));else for(d=0;d<b.length;d++)e.push(new c(b.models[d]));return e},c});
define('platform/entity/services/dto/rel-entity-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){var c=this;b=b||{},c.familyKey=a.toString(b.familyKey),c.parentKey=a.toString(b.parentKey),c.relationshipFamilyKey=a.toString(b.relationshipFamilyKey),c.isSucc=a.toBoolean(b.isSucc)}return b});
define('platform/entity/services/dto/entity-dto',['require','./entity-field-dto','./rel-entity-dto','system/lang/converter'],function(require){"use strict";var a=require("./entity-field-dto"),b=require("./rel-entity-dto"),c=require("system/lang/converter");function d(d){var e=this;d=d||{},e.caption=c.toString(d.caption),e.defaultCaption=c.toString(d.defaultCaption),e.contentGuid=c.toString(d.contentGuid),e.errorMessage=c.toString(d.errorMessage),e.familyID=c.toString(d.familyID),e.familyCaption=c.toString(d.familyCaption),e.familyKey=c.toInteger(d.familyKey),e.fields=void 0===d.fields?[]:a.fromDataCollection(d.fields),e.id=c.toString(d.id),e.isEditable=c.toBoolean(d.isEditable),e.isNew=c.toBoolean(d.isNew),e.key=c.toInteger(d.key),e.updateDate=c.toDate(d.updateDate),e.updateUser=c.toInteger(d.updateUser),e.isHistoryEnabled=c.toBoolean(d.isHistoryEnabled),e.isSiteFiltered=c.toBoolean(d.isSiteFiltered),e.siteKey=c.toString(d.siteKey),e.showStateManagement=c.toBoolean(d.showStateManagement),e.isStateManagementActive=c.toBoolean(d.isStateManagementActive),
e.useUrlRedirection=c.toBoolean(d.useUrlRedirection),e.redirectionUrl=c.toString(d.redirectionUrl),e.activeState=c.toString(d.activeState),e.isDirty=c.toBoolean(d.isDirty),e.isAuditable=c.toBoolean(d.isAuditable),e.createdDate=c.toDate(d.createdDate),e.createdBy=c.toInteger(d.createdBy),e.lockSeqNbr=c.toInteger(d.lockSeqNbr),void 0!==d.relEnty&&(e.relEnty=new b(d.relEnty))}return d.fromDataCollection=function a(b){if(void 0!==b){var c,e=[];for(c=0;c<b.length;c++)e[e.length]=new d(b[c]);return e}},d});
define('platform/entity/services/dto/field-history-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){var c=this;b=b||{},c.fieldCaption=a.toString(b.fieldCaption),c.formattedNewValue=a.toString(b.formattedNewValue),c.formattedOldValue=a.toString(b.formattedOldValue),c.newValue=a.toString(b.newValue),c.oldValue=a.toString(b.oldValue),c.updateUser=a.toString(b.updateUser),c.updateDate=a.toString(b.updateDate)}return b.fromDataCollection=function a(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e},b});
define('platform/entity/services/entity-service',['require','jquery','system/lang/object','./dto/entity-dto','./dto/field-history-dto','system/http/ajax-client'],function(require){"use strict";var a=require("jquery");require("system/lang/object");var b="api/core/entity/",c="api/core/relationship/",d="api/core/metadata/entityfamily/",e=require("./dto/entity-dto"),f=require("./dto/field-history-dto"),g=require("system/http/ajax-client");function h(a){this.ajaxClient=a,this.isForDCM=!1}h.dependsOn=[g],h.prototype.setupForDCM=function(){this.isForDCM=!0},h.prototype.newEntity=function(c){var d=b+"new/"+c,f=a.Deferred();return this.ajaxClient.get(d,{}).done(function(a){f.resolve(new e(a))}).fail(function(a){f.reject(a)}),f.promise()},h.prototype.getEntity=function(c){var d=b+c,f=a.Deferred();return this.ajaxClient.get(d,{}).done(function(a){f.resolve(new e(a))}).fail(function(a){f.reject(a.statusText,a)}),f.promise()},h.prototype.getSiteKey=function(c){var d=b+"sitekey/"+c,e=a.Deferred();return this.ajaxClient.get(d,{}).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a.statusText,a)}),e.promise()},
h.prototype.getEntities=function(c){var d=b+"getBulkEntities?",f=a.Deferred(),g=0,h=[];for(g=0;g<c.length;g++)d=d+"key="+c[g],g!==c.length-1&&(d+="&");return this.ajaxClient.get(d).done(function(a){for(var b=0;b<a.length;b++)h.push(new e(a[b]));f.resolve(h),f.resolve(a)}).fail(function(a){f.reject(a.statusText,a)}),f.promise()},h.prototype.getEntityByFamilyKey=function(b){var c=this,f=d+b;c.isForDCM&&(f+="?isFromDCM=true");var g=a.Deferred();return this.ajaxClient.get(f,{}).done(function(a){g.resolve(new e(a))}).fail(function(a){g.reject(a.statusText,a)}),g.promise()},h.prototype.getAggregateEntities=function(c){var d=b+"aggregate/query",f=a.Deferred(),g=0,h=[];return this.ajaxClient.post(d,JSON.stringify(c)).done(function(a){for(var b=0;b<a.length;b++){for(var c=[],d=0;d<a[b].length;d++)c.push(new e(a[b][d]));h.push(c)}f.resolve(h)}).fail(function(){f.reject()}),f.promise()},h.prototype.getAggregateEntitiesForCompositeObj=function(c){var d=b+"aggregate/object",f=a.Deferred(),g=0,h=[]
;return this.ajaxClient.post(d,JSON.stringify(c)).done(function(a){if(a){for(var b=0;b<a.length;b++){for(var c=[],d=0;d<a[b].length;d++)c.push(new e(a[b][d]));h.push(c)}f.resolve(h)}}).fail(function(){f.reject()}),f.promise()},h.prototype.saveEntity=function(c){var d=b,f=a.Deferred();return this.ajaxClient.post(d,c).done(function(a){f.resolve(new e(a))}).fail(function(a){f.reject(a)}),f.promise()},h.prototype.saveEntities=function(c){var d=b+"Save",f=a.Deferred();return this.ajaxClient.post(d,c).done(function(a){for(var b=[],c=0;c<a.length;c++)b.push(new e(a[c]));f.resolve(b)}).fail(function(a){f.reject(a)}),f.promise()},h.prototype.saveAndLinkEntities=function(c,d,f){var g=b+"MDF/"+d+"/"+f,h=a.Deferred();return this.ajaxClient.post(g,c).done(function(a){for(var b=[],c=0;c<a.length;c++)b.push(new e(a[c]));h.resolve(b)}).fail(function(){h.reject()}),h.promise()},h.prototype.updateEntity=function(c){var d=b,f=a.Deferred();return this.ajaxClient.put(d,c).done(function(a){
f.resolve(new e(a))}).fail(function(a){f.reject(a)}),f.promise()},h.prototype.deleteEntity=function(c){var d=b+c.key,e=a.Deferred();return this.ajaxClient.delete(d,{}).done(function(a){null!==a&&""!==a&&""!==a.errorMessage?e.reject(a.errorMessage):e.resolve({status:"deleted"})}).fail(function(a){e.reject(a)}),e.promise()},h.prototype.deleteEntities=function(c){var d=b+"deleteEntities?",e=a.Deferred(),f=0;for(f=0;f<c.length;f++)d=d+"key="+c[f],f!==c.length-1&&(d+="&");return this.ajaxClient.delete(d,{}).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},h.prototype.deleteRelationships=function(b,d,e){var f=c+b+"/"+d+"?",g=a.Deferred(),h=0;for(h=0;h<e.length;h++)f=f+"succEntityKey="+e[h],h!==e.length-1&&(f+="&");return this.ajaxClient.delete(f,{}).done(function(a){g.resolve(a)}).fail(function(a){g.reject(a)}),g.promise()},h.prototype.updateFields=function(c){var d=b+"updatefields",f=a.Deferred();return this.ajaxClient.put(d,c).done(function(a){f.resolve(new e(a))
}).fail(function(a){f.reject(a)}),f.promise()},h.prototype.copyEntity=function(c){var d=b+"copy/"+c.key,f=a.Deferred();return this.ajaxClient.get(d,{}).done(function(a){f.resolve(new e(a))}).fail(function(){f.reject()}),f.promise()},h.prototype.getHistory=function(c){var d=b+"history/"+c.key,e=a.Deferred();return this.ajaxClient.get(d,{}).done(function(a){e.resolve(f.fromDataCollection(a))}).fail(function(){e.reject()}),e.promise()},h.prototype.getReferences=function(c){var d=b+"refdoc/"+c.key,e=a.Deferred();return this.ajaxClient.get(d,{}).done(function(a){e.resolve(a)}).fail(function(){e.reject()}),e.promise()},h.prototype.canRefDoc=function(c){var d=b+"canrefdoc/"+c,e=a.Deferred(),f;return f=this.ajaxClient.get(d).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a.statusText,a)}),g.promise(e,f)},h.prototype.getRefDocCount=function(c){var d=b+"refdoccount/"+c,e=a.Deferred(),f;return f=this.ajaxClient.get(d).done(function(a){e.resolve(a)}).fail(function(a){
e.reject(a.statusText,a)}),g.promise(e,f)},h.prototype.getRelatedEntities=function(c,d,e){var f=b+"MDF/"+c+"/"+d+"/"+e,g=a.Deferred();return this.ajaxClient.get(f,{}).done(function(a){g.resolve(a)}).fail(function(){g.reject()}),g.promise()},h.prototype.getRelatedEntityKeys=function(c,d,e){var f=b+"MDFKeys/"+c+"/"+d+"/"+e,g=a.Deferred();return this.ajaxClient.get(f,{}).done(function(a){g.resolve(a)}).fail(function(){g.reject()}),g.promise()},h.prototype.refDocServerCredentialsExist=function b(){var c=a.Deferred();return this.ajaxClient.get("api/refdoc-server/config").done(i.bind(null,c)).fail(j.bind(null,c)),c.promise()},h.prototype.getBulkEntitiesByQuery=function(c){var d=b+"bulk/query",f=a.Deferred(),g=0,h=[];return this.ajaxClient.post(d,JSON.stringify(c)).done(function(a){for(var b=[],c=0;c<a.length;c++)b.push(new e(a[c]));f.resolve(b)}).fail(function(){f.reject()}),f.promise()};function i(a,b){var c=!1;""!==b.userName&&""!==b.userPassword&&(c=!0),a.resolve(c)}function j(a,b){
a.reject(b)}return h});
define('platform/entity/model/entity-field-model',['require','lodash','backbone'],function(require){"use strict";var a=require("lodash"),b=require("backbone"),c;return c=b.Model.extend({initialize:function(){this.on("change:value",function(b,c){b.set("previousValue",b.previous("value"),{silent:!0}),b.set("changing",!0,{silent:!0});var d=b.get("pickList");if(void 0!==d&&d.length>0){var e=a.find(d,function(a){return a.isSelected===!0});e&&(e.isSelected=!1);var f=a.find(d,function(a){return a.value===c});f&&(f.isSelected=!0)}}).on("change:values",function(a,b){a.get("errorMessage")||a.set("previousValues",a.previous("values")?a.previous("values"):a.get("previousValues"),{silent:!0}),a.set("changing",!0,{silent:!0})})}})});
define('platform/entity/model/entity-field-collection',['require','backbone','./entity-field-model'],function(require){"use strict";var a=require("backbone"),b=require("./entity-field-model"),c;return c=a.Collection.extend({model:b})});
define('platform/entity/entity',['require','lodash','jquery','./model/entity-field-collection','./services/entity-service','./services/dto/entity-dto','./services/dto/entity-field-dto','system/lang/event','system/http/ajax-client','system/globalization/translator'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./model/entity-field-collection"),d=require("./services/entity-service"),e=require("./services/dto/entity-dto"),f=require("./services/dto/entity-field-dto"),g=require("system/lang/event"),h=require("system/http/ajax-client"),i=require("system/globalization/translator");function j(a){var e=this,f,j;j=Object.resolve(h),e._service=new d(j),b.extend(e,a),f=new c(e.fields),f.on("change",this._fieldChanged,e),e.entitySaved=new g,e.entityModified=new g,e.conflictedEvent=new g,e.fields=f,e.entityDeleted=new g,e.updateReqCount=0,e.isEntityDirty=!1,e.saveQueue=0,e.translator=Object.resolve(i),e.saveDfd=null,e.entityChangedEvent=new g,e.entityIdChanged=new g,e.updatedFromModule=null}return j.prototype.save=function a(c,d,e){var f=this,g;return g=e?e:b.Deferred(),0===f.updateReqCount&&0===f.saveQueue?(f.saveQueue++,0!==f.key?f._service.updateEntity(f._convertToServiceDTO()).done(function(a){f.saveQueue--,
f.isEntityDirty=!1,f._updateSelf(a),f.entitySaved&&f.entitySaved.raise(a,c,d),g.resolve(f)}).fail(function(a){f.saveQueue--,g.reject(a)}):f._service.saveEntity(f._convertToServiceDTO()).done(function(a){f.saveQueue--,f.isEntityDirty=!1,f._updateSelf(a),f.entitySaved&&f.entitySaved.raise(a,c,d),g.resolve(f)}).fail(function(a){f.saveQueue--,g.reject(a)})):(f.saveDfd=g,f.saveQueue++),g},j.prototype.translate=function a(b){return this.translator.translate(b)},j.prototype.delete=function(a){var c=b.Deferred(),d=this;if(0!==d.updateReqCount)throw d.translate("DS_CANNOT_DELETE_ENTITY_EXCEPTION");return 0!==d.key&&d._service.deleteEntity(a._convertToServiceDTO()).done(function(b){d.entityDeleted&&d.entityDeleted.raise(a),c.resolve(b)}).fail(function(a){c.reject(a)}),c},j.prototype.getHistory=function a(){var c=this,d=b.Deferred();return c._service.getHistory(c._convertToServiceDTO()).done(function(a){d.resolve(a)}),d},j.prototype.getReferences=function a(){var c=this,d=b.Deferred()
;return c._service.getReferences(c._convertToServiceDTO()).done(function(a){d.resolve(a)}),d},j.prototype.updateFieldsExternal=function b(c){var d=this;c.familyKey===d.familyKey&&a.each(data.fields,function(a){var b=d.fields.find(function(b){return b.id===a.id});b.set("value",a.value,{silent:!0}),d.entityModified&&d.entityModified.raise(d,b.toJSON(),d.id)})},j.prototype._convertToServiceDTO=function a(){var b=this,c,d;return c=f.fromDataCollection(b.fields.toJSON()),d=new e(b),d.fields=c,d.siteKey||delete d.siteKey,d},j.prototype._updateSelf=function b(c){var d=this;for(var e in c)"fields"!==e&&void 0!==d[e]&&(d[e]=c[e]);c.fields&&c.fields.length>0&&d.fields.each(function(b){var d=a.find(c.fields,function(a){return a.id===b.get("id")});d&&b.set(d,{silent:!0})})},j.prototype._fieldChanged=function b(){var c=this;c.updateReqCount++,c.isEntityDirty=!0,c._service.updateFields(c._convertToServiceDTO()).done(function(b){c.id!==b.id&&(c.id=b.id,c.entityIdChanged&&c.entityIdChanged.raise(c)),
c.isDirty=b.isDirty,c.updateReqCount--,a.each(b.fields,function(a){if(a.changing){var d=c.fields.find(function(b){return b.id===a.id});a.changing=!1,d.get("changing")&&c.conflictedEvent.raise(d),a.isDirty=!1,d.set(a,{silent:!0}),c.entityModified?c.entityModified.raise(c,d.toJSON(),b.id,!1,c._convertToServiceDTO().lockSeqNbr,b):c.entityChangedEvent&&c.entityChangedEvent.raise(c,d.toJSON(),b.id)}}),c.saveQueue>0&&(c.saveQueue=0,c.save(null,null,c.saveDfd))}).fail(function(){c.updateReqCount--,c.saveQueue>0&&(c.saveQueue=0,c.save())})},j.prototype.updateField=function b(c,d,e,f){var g=this,h=a.find(g.fields.models,function(a){return a.get("id").toString()===c.toString()});if(window.field=h,void 0===h)throw c+" "+g.translate("DS_NOT_VALID_ID_EXCEPTION");if(void 0===h.get(d))throw d+" "+g.translate("DS_NOT_VALID_FIELD_EXCEPTION");h.set(d,e),g.entityModified&&g.entityModified.raise(g,h.toJSON(),!1,!0,null,null,f)},j.prototype.checkIfDirty=function a(){return this.isEntityDirty},
j.prototype.checkIfEntityDirty=function c(){var d=b.Deferred(),e=this;return a.delay(function(){e.updateReqCount>0?d.reject():e.isDirty&&!e.updatedFromModule?d.reject():d.resolve()},100),d},j});
define('platform/entity/entity-factory',['require','lodash','jquery','./services/entity-service','./services/dto/entity-dto','./services/dto/entity-field-dto','system/lang/event','./entity','system/http/ajax-client','system/globalization/translator'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./services/entity-service"),d=require("./services/dto/entity-dto"),e=require("./services/dto/entity-field-dto"),f=require("system/lang/event"),g=require("./entity"),h="entity-clipboard",i=require("system/http/ajax-client"),j=require("system/globalization/translator");function k(){var a=this;a.ajaxClient=Object.resolve(i),a.service=new c(a.ajaxClient),a.createdEvent=new f,a.copiedEvent=new f,a.pastedEvent=new f,a.bulkDeleteEvent=new f,a.bulkUnlinkEvent=new f,a.updateEntitiesEvent=new f,a.translator=Object.resolve(j)}k.prototype.new=function a(c){var d=b.Deferred(),e=l(c),f=this;return"key"===e?f.service.newEntity(c).done(function(a){d.resolve(new g(a))}).fail(function(a){d.reject(a)}):d.resolve(c),d.promise()},k.prototype.getEntityByFamilyKey=function a(c){var d=b.Deferred();return this.service.getEntityByFamilyKey(c).done(function(a){d.resolve(new g(a))}).fail(function(a){d.reject(a)}),
d.promise()},k.prototype.translate=function a(b){return this.translator.translate(b)},k.prototype.get=function a(c){var d=b.Deferred(),e=l(c),f=this;return"key"===e?f.service.getEntity(c).done(function(a){d.resolve(new g(a))}).fail(function(a,b){d.reject(a,b)}):"keys"===e?f.service.getEntities(c).done(function(a){var b,c=[];for(b=0;b<a.length;b++)c.push(new g(a[b]));d.resolve(c)}).fail(function(a,b){d.reject(b,a)}):"objects"===e?f.createNewEntitiesFromJSON(c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}):f.createNewEntityFromJSON(c).done(function(a){d.resolve(a)}),d},k.prototype.getSiteKey=function a(c){var d=b.Deferred();return this.service.getSiteKey(c).done(function(a){d.resolve(a)}).fail(function(a,b){d.reject(a,b)}),d},k.prototype.getAggregatedEntities=function a(c){var d=b.Deferred();return this.service.getAggregateEntities(c).done(function(a){var b,c=[];for(b=0;b<a.length;b++){for(var e=[],f=0;f<a[b].length;f++)e.push(new g(a[b][f]));c.push(e)}d.resolve(c)
}).fail(function(a){d.reject(a)}),d},k.prototype.getAggregateEntitiesForCompositeObj=function a(c){var d=b.Deferred();return this.service.getAggregateEntitiesForCompositeObj(c).done(function(a){var b,c=[];for(b=0;b<a.length;b++){for(var e=[],f=0;f<a[b].length;f++)e.push(new g(a[b][f]));c.push(e)}d.resolve(c)}).fail(function(a){d.reject(a)}),d},k.prototype.createNewEntityFromJSON=function a(c){var e=b.Deferred();return e.resolve(new g(new d(c))),e.promise()},k.prototype.createNewEntitiesFromJSON=function a(c){var e=b.Deferred(),f,h=[];for(f=0;f<c.length;f++)h.push(new g(new d(c[f])));return e.resolve(h),e.promise()},k.prototype.save=function a(c,d,e){var f=this,g=l(c),h=b.Deferred();if("objects"===g){var i=f._convertToServiceDTOs(c);f.service.saveEntities(i,d).done(function(a){for(var b=0;b<c.length;b++)c[b]._updateSelf(a[b]),""===c[b].errorMessage&&(c[b].clientid=void 0);h.resolve(c)}).fail(function(a){h.reject(a)})}else"bulk"===g?c.length>0?c.save(d,e).done(function(a){h.resolve(a)
}).fail(function(a){h.reject(a)}):h.reject():c.save(d,e).done(function(a){h.resolve(a)}).fail(function(a){h.reject(a)});return h},k.prototype.saveAndLinkEntities=function a(c,d,e){var f=this,g=b.Deferred(),h;return h=f._convertToServiceDTOs(c),f.service.saveAndLinkEntities(h,d,e).done(function(a){for(var b=0;b<c.length;b++)c[b]._updateSelf(a[b]),""===c[b].errorMessage&&(c[b].clientid=void 0);g.resolve(c)}).fail(function(a){g.reject(a)}),g},k.prototype._convertToServiceDTOs=function a(b){for(var c=[],f=0;f<b.length;f++){var g=e.fromDataCollection(b[f].fields.toJSON()),h=new d(b[f]);h.fields=g,c.push(h)}return c},k.prototype.copyFrom=function a(c){var d=this,e=b.Deferred();return d.service.copyEntity(c._convertToServiceDTO()).done(function(a){window.sessionStorage.setItem(h,JSON.stringify(a)),e.resolve({status:"copied"})}),e},k.prototype.canPaste=function a(b){var c=!1,d;return d=window.sessionStorage.getItem(h)?JSON.parse(window.sessionStorage.getItem(h)):null,
d&&d.familyKey&&d.familyKey===b&&(c=!0),c},k.prototype.pasteTo=function a(b){var c=this,d;if(!(d=window.sessionStorage.getItem(h)?JSON.parse(window.sessionStorage.getItem(h)):null)||!c.canPaste(b.familyKey))throw c.translate("DS_UNABLE_TO_PASTE_EXCEPTION");b.updateFieldsExternal(d)},k.prototype.delete=function a(c){var d=this,e=b.Deferred(),f;return f=l(c),"keys"===f?d.service.deleteEntities(c).done(function(a){d.bulkDeleteEvent.raise(c,a),e.resolve(a)}).fail(function(a){e.reject(a)}):c.delete(c).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e},k.prototype.deleteRelationships=function a(c,d,e){var f=this,g=b.Deferred(),h,i=!1;return f.service.deleteRelationships(c,d,e).done(function(a){for(var b=0;b<a.length;b++)if(""!==a[b].errorMessage){i=!0,h=a[b].errorMessage;break}i||f.bulkUnlinkEvent.raise(e,a),g.resolve(a)}).fail(function(a){g.reject(a)}),g},k.prototype.updateEntitySite=function a(b){b.isDirty=!0,b._fieldChanged()},k.prototype.updateFieldValue=function b(c,d,e){
var f=!1,g=a.find(c.fields.models,function(a){return a.get("key").toString()===d.toString()});g.set("value",e);var h=g.toJSON();c.entityModified&&c.entityModified.raise(c,h,!1,!0,null,null,f)},k.prototype.updateFieldByKey=function b(c,d,e,f){var g=a.find(c.fields.models,function(a){return a.get("key").toString()===d.toString()});g.trigger("change:"+f,g),g.set(f,e,{silent:!0}),g.trigger("change"),c.entityModified&&c.entityModified.raise(c,g.toJSON())},k.prototype.updateField=function a(b,c,d,e){return b.updateField(c,d,e)},k.prototype.saveBulkEntities=function a(b){this.updateEntitiesEvent.raise(b)},k.prototype.checkIfDirty=function a(b){return!!b&&b.checkIfDirty()},k.prototype.checkIfEntityDirty=function a(c){var d=b.Deferred(),e;return c?(e=c.checkIfEntityDirty(),e.done(function(){d.resolve()}),e.fail(function(){d.reject()})):d.resolve(),d},k.prototype.checkIfEntitiesDirty=function a(c){var d,e=b.Deferred(),f=[],g
;if(c)for(d=0;d<c.length;d++)f.push(c[d].checkIfEntityDirty());else e.resolve();return g=b.when.apply(this,f),g.done(function(){e.resolve()}),g.fail(function(){e.reject()}),e},k.prototype.checkIfCompositeEntitiesDirty=function a(c){var d,e,f=b.Deferred(),g=[],h;if(c)for(d=0;d<c.length;d++)for(e=0;e<c[d].length;e++)g.push(c[d][e].checkIfEntityDirty());else f.resolve();return h=b.when.apply(this,g),h.done(function(){f.resolve()}),h.fail(function(){f.reject()}),f},k.prototype.checkIfEntityNew=function a(b){return 0===b.key},k.prototype.getRelatedEntities=function a(c,d,e){var f=b.Deferred();return this.service.getRelatedEntityKeys(c,d,e).done(function(a){var b,c=[];for(b=0;b<a.length;b++)c.push(a[b]);f.resolve(c)}).fail(function(a){f.reject(a)}),f.promise()},k.prototype.uploadRefDoc=function(a,b){var c=JSON.parse(window.sessionStorage.getItem("meridium-session")).id;a.append("sessionid",c);var d={cache:!1,data:a,contentType:!1,processData:!1}
;return this.ajaxClient.post("api/common/referencedocuments/refdocupload/"+b,"",d)},k.prototype.canRefDoc=function(a,c){var d=this,e=b.Deferred(),f;return 0!==c&&"0"!==c||e.reject(),f=d.service.canRefDoc(a).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.request={abort:f.request.abort},e},k.prototype.getRefDocCount=function(a){var c=this,d=b.Deferred(),e;return 0!==a&&"0"!==a||d.reject(),e=c.service.getRefDocCount(a).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.request={abort:e.request.abort},d},k.prototype.setEntityClean=function a(b){b&&(b.isDirty=!1)};function l(a){if("string"==typeof a||a instanceof String||"number"==typeof a||a instanceof Number)return"key";if(b.isArray(a)){for(var c=0;c<a.length;c++)return"key"===l(a[c])?"keys":"objects";return"bulk"}return"object"}return k.prototype.hasRefDocServerCredentials=function(){var a=this,c=b.Deferred();return a.service.refDocServerCredentialsExist().done(function(a){c.resolve(a)}).fail(function(a){
c.reject(a)}),c},k.prototype.getBulkEntitiesByQuery=function a(c){var d=b.Deferred();return this.service.getBulkEntitiesByQuery(c).done(function(a){var b,c=[];for(b=0;b<a.length;b++)c.push(new g(a[b]));d.resolve(c)}).fail(function(a){d.reject(a)}),d},k.prototype.setupForDCM=function(){this.service.setupForDCM()},k});
define('platform/datasheets/layout/ui/bootstrap-tabs',[],function(){"use strict";var a=function(a){this.element=$(a)};a.prototype.show=function(){var a=this.element,b=a.closest("ul:not(.dropdown-menu)"),c=a.data("target");if(c||(c=a.attr("href"),c=c&&c.replace(/.*(?=#[^\s]*$)/,"")),!a.parent("li").hasClass("active")){var d=b.find(".active:last a")[0],e=$.Event("show.bs.tab",{relatedTarget:d});if(a.trigger(e),!e.isDefaultPrevented()){var f=$(c);this.activate(a.parent("li"),b),this.activate(f,f.parent(),function(){a.trigger({type:"shown.bs.tab",relatedTarget:d})})}}},a.prototype.activate=function(a,b,c){var d=b.find("> .active"),e=c&&$.support.transition&&d.hasClass("fade");function f(){d.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),a.addClass("active"),e?(a[0].offsetWidth,a.addClass("in")):a.removeClass("fade"),a.parent(".dropdown-menu")&&a.closest("li.dropdown").addClass("active"),c&&c()}e?d.one($.support.transition.end,f).emulateTransitionEnd(150):f(),d.removeClass("in")};var b=$.fn.tab
;return $.fn.tab=function(b){return this.each(function(){var c=$(this),d=c.data("bs.tab");d||c.data("bs.tab",d=new a(this)),"string"==typeof b&&d[b]()})},$.fn.tab.Constructor=a,$.fn.tab.noConflict=function(){return $.fn.tab=b,this},a});

define('text!ui/elements/multi-value/template.html',[],function () { return '<div class="mi-multi-value-container" data-bind="visible:visible,css:{\'disabled\':disabled,\'open\':isOpen,\'required\':isRequired}">\r\n    <div data-bind="css:{\'active\':isOpen},clickBubble: false, hasFocus:textFocus, event:{\r\n            keyup: handleKeyUpOnTextInput,\r\n            keydown:handleKeyDownOnTextInput,\r\n            click:handleKeyUpOnTextInput,\r\n            mousedown:handleKeyUpOnTextInput\r\n         }" class="mi-multi-value-selector">\r\n        <input type="text" class="mi-multi-value-selected-value-text pull-left" data-bind="value:text,\r\n                                                                                            valueUpdate:\'keyup\',\r\n             \r\n                                                                                            attr:{\'readonly\':(disabled() || multiple() || isMobile),\r\n                                                                                                   \'disabled\':disabled()},\r\n                                                                                            event:{keyup: handleKeyUpOnTextInput}" />\r\n        <!--<span class="mi-multi-value-selected-value-text pull-left" data-bind="text:selectedValueText"></span>-->\r\n        <i class="icon-arrow pull-right"></i>\r\n    </div>\r\n</div>';});


define('text!ui/elements/multi-value/options-template.html',[],function () { return '<div data-bind="visible:isOpen(),event:{mousedown:function(data,event){event.stopPropagation();}}" class="mi-multi-value-options-container">\r\n    <p class="mi-multi-value-option mi-multi-value-input" data-bind="event:{mousedown:inputMouseDown}">\r\n        <input type="text" data-bind="attr:{ placeholder: addCaptionText}, value:addValue,event:{\'keydown\':addValueUpdate}" />\r\n    </p>\r\n\r\n   <!-- ko if:optionsCaption -->\r\n    <p class="mi-multi-value-option mi-multi-value-caption" data-bind="text:optionsCaption,\r\n                                                                       event:{click:function(data,event){$root.selectValue($root,null,event);}}"></p>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko foreach:filteredOptions -->\r\n    <p class="mi-multi-value-option" data-bind="text:$parent.getOptionText($data),\r\n                                            event:{click:function(data,event){$root.selectValue($root,data,event);}},\r\n                                            css:{\'active\':$parent.isActive($data)}">\r\n\r\n    </p>\r\n    <!-- /ko -->\r\n     \r\n   \r\n\r\n  \r\n\r\n</div>\r\n';});

define('ui/elements/multi-value/view-model',['require','lodash','jquery','text!./template.html','text!./options-template.html','knockout','spa/region','system/globalization/translator','../select/element','system/hardware/device'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./template.html"),d=require("text!./options-template.html"),e=require("knockout"),f=require("spa/region"),g=require("system/globalization/translator"),h=require("../select/element"),i=Object.resolve(require("system/hardware/device"));function j(){k.call(this,c,!1,!0);var a=this;this.translator=Object.resolve(g),this.optionsValue=e.observable(),this.optionsText=e.observable(),this.multiple=e.observable(!1),this.optionsCaption=e.observable(""),this.options=e.observableArray([]),this.value=e.observable(),this.required=e.observable(!1),this.disabled=e.observable(!1),this.visible=e.observable(!0),this.selectedOptions=e.observableArray([]),this.autoAdd=e.observable(!0),this.onOptionAdd=e.observable(),this.addCaption=e.observable(this.translator.translate("MULTI_VALUE_ADD_OPTION_PLACEHOLDER")),this.text=e.observable(),this.textFocus=e.observable(!1),this.keyPressed=e.observable(!1),
this.currentText=null,this.isOpen=e.observable(!1),this.selectedItem=e.observable(),this.addValue=e.observable(),this.optionsRegion=new f,this.isClicked=!1,this.isMobile=i.isMobile(),this.isRequired=e.computed(p.bind(a,a)),this.isRequiredSubscriber=this.isRequired.subscribe(q.bind(a,a)),this.addCaptionText=e.computed(o.bind(null,this)),this.selectedValueText=e.computed(u.bind(null,this)),this.filteredOptions=e.computed(l.bind(null,this)),this.addValueUpdate=r,this.addValueSubscription=this.addValue.subscribe(a.addOption,this),this.documentHandlerFn=s.bind(null,a),this.filteredOptionsSubscriber=null}var k=Object.inherit(h.ViewModel,j);j.prototype.beforeAttached=function(){var a=this;this.filteredOptionsSubscriber=this.filteredOptions.subscribe(n.bind(a,a)),b(document).on("mousedown",this.documentHandlerFn)},j.prototype.afterDetached=function(){var a=this;b(window).off("resize",a.resizeProxy),b(a.element).parents().off("scroll",a.scrollProxy),b(a.element).off(),
b(document).off("mousedown",a.documentHandlerFn),a.translator=null,a.optionsValue=null,a.optionsText=null,a.multiple=null,a.optionsCaption=null,a.options=null,a.value=null,a.required=null,a.disabled=null,a.visible=null,a.selectedOptions=null,a.autoAdd=null,a.onOptionAdd=null,a.addCaption=null,a.text=null,a.textFocus=null,a.keyPressed=null,a.currentText=null,a.isOpen=null,a.selectedItem=null,a.addValue=null,a.optionsRegion&&(a.optionsRegion.detach(),a.optionsRegion=null),a.isClicked=null,a.isMobile=null,a.isRequired&&(a.isRequired.dispose(),a.isRequired=null),a.isRequiredSubscriber&&(a.isRequiredSubscriber.dispose(),a.isRequiredSubscriber=null),a.addCaptionText&&(a.addCaptionText.dispose(),a.addCaptionText=null),a.selectedValueText&&(a.selectedValueText.dispose(),a.selectedValueText=null),a.filteredOptions&&(a.filteredOptions.dispose(),a.filteredOptions=null),a.addValueUpdate=null,a.addValueSubscription&&(a.addValueSubscription.dispose(),a.addValueSubscription=null),
a.documentHandlerFn=null,a.filteredOptionsSubscriber&&(a.filteredOptionsSubscriber.dispose(),a.filteredOptionsSubscriber=null),a.resizeProxy=null,a.scrollProxy=null,a.optionsContainerDiv=null},j.prototype.inputMouseDown=function(a,b){b.stopPropagation(),b.target.focus()};function l(a){if(!a.options)return[];var b=[].concat(a.options()),c=a.text(),d=[],f=b,g=[],h,i=a.optionsCaption(),j,k;return b&&b.length?(g=F(a,f,c),h=i!==c,a.text()&&h&&a.keyPressed()&&(c=m(c),j=new RegExp(c.trim(),"i"),k=e.utils.arrayFilter(b,function(b){var c=a.getOptionText(b);return j.test(c)}),(!g||g&&k.length>1)&&(f=k.length?k:b)),d=null!==f?f:b):void 0}function m(a){return null!==a&&(a=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")),a}function n(a,b){a.setOptionContainerPosition.bind(null,a)()}function o(a){return a.addCaption()||a.translator.translate("MULTI_VALUE_ADD_OPTION_PLACEHOLDER")}function p(a){return a.required()&&!a.hasValue()}function q(a,c){
a.isRequired()?b(a.element).addClass("mi-multi-value-required"):b(a.element).removeClass("mi-multi-value-required")}j.prototype.hasValue=function a(){var b=this;if(b.multiple()){if(b.selectedOptions()&&b.selectedOptions().length)return!1}else if(!b.value())return!1;return!0},j.prototype.addOption=function a(c){var d=c,e=this;if(c){if(("object"==typeof e.options()[0]||e.optionsText())&&(d={},d[e.optionsText()]=c,d[e.optionsValue()]=c),e.onOptionAdd(d),e.options.push(d),e.multiple()){if(e.multiple()){var f=e.selectedOptions();f.push(e.getOptionValue(d)),e.text(f),e.selectedOptions(f),b(e.element).trigger("properties.selectedOptions:changed",[e.selectedOptions()])}}else e.selectedItem(d),e.value(e.getOptionValue(d)),b(e.element).trigger("properties.value:changed",[e.value()]);e.addValue("")}};function r(a,b){switch(b.keyCode){case 13:b.target.blur(),b.target.focus();break;case 9:a.toggleOptions();break;case 40:b.preventDefault(),P(a,b,!0);break;case 38:b.preventDefault(),Q(a,b)}return!0}
function s(a){a.isClicked?a.isClicked=!1:(a.isOpen()&&(a.isOpen(!1),E(a),b(a.element).trigger("selected",[a.multiple()?a.selectedOptions():a.value()])),u(a))}j.prototype.afterAttached=function(){},j.prototype.afterCreated=function(){},j.prototype.beforeCreated=function(){var c=this;this.bindAttribute("optionsText",null),this.bindAttribute("optionsValue",null),this.bindAttribute("optionsCaption",null),this.bindAttribute("addCaption",null),this.bindAttribute("options",[],w.bind(null,this),!0),this.bindAttribute("value",null,z.bind(null,this),!0),this.bindAttribute("selectedOptions",[],null,!0),this.bindAttribute("disabled",!1),this.bindAttribute("required",!1),this.bindAttribute("visible",!0),this.bindAttribute("multiple",!1,x.bind(null,this)),this.bindAttribute("autoAdd",!0),this.bindAttribute("onOptionAdd",null),this.resizeProxy=b.proxy(a.debounce(this.resize.bind(null,this),100),this),this.scrollProxy=b.proxy(this.scrollHandler,this),
b(this.element).on("properties.options:changed",function(a,b){}.bind(this)),b(this.element).on("properties.value:changed",z.bind(null,this)),b(this.element).on("properties.multiple:changed",function(a,b){}.bind(this)),b(this.element).on("properties.size:changed",function(a,b){}.bind(this)),b(this.element).on("properties.selectedOptions:changed",A.bind(null,this))},j.prototype.selectValue=function(c,d,e){if(e&&(e.preventDefault(),e.stopPropagation()),c.disabled())return!1;if(c.multiple()){if(c.multiple()){if(!d)return!0;var f=c.selectedOptions(),g=f||[],h=c.getOptionValue(d);b.inArray(h,c.selectedOptions())===-1?g.push(h):g=b.grep(g,function(a){return a!==h}),c.selectedOptions(g),b(c.element).trigger("properties.selectedOptions:changed",[g]),c.textFocus(!0)}}else{var i;if(c.selectedItem(d),a.isEqual(d,c.value()))u(c);else{if(d){var j=c.getOptionValue(d);return i=j,c.textFocus(!0),c.isOpen(!1),E(c),c.value&&c.value(j),b(c.element).trigger("properties.value:changed",[i]),
b(c.element).trigger("selected",[c.value?c.value():c.value]),!0}c.value("");var k=c.optionsCaption()?c.optionsCaption():"";c.text(k),i="",b(c.element).trigger("properties.value:changed",[i])}c.textFocus(!0),c.isOpen(!1),E(c),b(c.element).trigger("selected",[c.value()])}return!0},j.prototype.toggleOptions=function(a,c){var d=this;return c&&c.stopPropagation(),d.disabled()||d.options()&&!d.options().length?(d.textFocus(!0),E(d),d.isOpen(!1),!1):(d.isClicked=!0,b(document).trigger("mousedown",[d.element]),d.isOpen()?(E(d),b(d.element).trigger("selected",[d.multiple()?d.selectedOptions():d.value()])):(C(d),D(d)),d.isOpen()||b(d.optionsContainerDiv).css("visibility","hidden"),d.textFocus()||d.textFocus(!0),d.isOpen(!d.isOpen()),!0)};function t(a){e.cleanNode(a.optionsRegion.activeContainer),b(".multi-value-outer-container").remove(),b(window).off("resize",a.resizeProxy),b(a.element).parents().off("scroll",a.scrollProxy)}function u(a){if(a.options){var b=null,c=a.options(),d=null,e=null,f=""
;if(a.multiple()){if(c&&a.selectedOptions()&&a.selectedOptions().length){for(var g=a.selectedOptions(),h="",i=0;i<g.length;i++){for(var j=g[i],k=0;k<c.length;k++)if(e=v(a,c[k],j)){b=e;break}var l=h?", ":"";h+=l+a.getOptionText(b)}return a.text(g),h}}else if(a.value()&&c){for(var m=0;m<c.length;m++)if(e=v(a,c[m],a.value())){b=e;break}if(b)return f=a.getOptionText(b),a.text(f),f}return f=a.optionsCaption()||"",a.text(f),f}}function v(b,c,d){var e=b.getOptionValue(c),f=null;return b.optionsValue()?e.valueOf()===d.valueOf()&&(f=c):c.valueOf()===d.valueOf()?f=c:"object"==typeof d&&a.isEqual(d,c)&&(f=c),f}j.prototype.getValue=function(a){var b=a;return"function"==typeof a&&(b=a()),b},j.prototype.getReturnValue=function(a,b){return"function"==typeof a?a.call(b,b):b?b[a]:b},j.prototype.getOptionText=function(a){var b=this;return b.optionsText()?b.getValue(b.getReturnValue(b.optionsText(),a)):a},j.prototype.getOptionValue=function(a){var b=this
;return b.optionsValue()?b.getValue(b.getReturnValue(b.optionsValue(),a)):a},j.prototype.isActive=function(c){var d=this;return d.multiple()?b.inArray(d.getOptionValue(c),d.selectedOptions())!==-1:null===d.getOptionValue(c)||null===d.value()?d.getOptionValue(c)===d.value():"object"!=typeof d.value()||d.optionsValue()?d.getOptionValue(c).valueOf()===d.value().valueOf():a.isEqual(c,d.value())},j.prototype.resize=function(a){a.isMobile||(a.isOpen(!1),t(a))},j.prototype.scrollHandler=function(){this.isOpen(!1),t(this)};function w(){}function x(a){}function y(a){}function z(a,c){b(a.element).trigger("valueChange",[c])}function A(a,b,c){}function B(a){this.option=a,this.isSelected=e.observable(!1)}function C(a){a.optionsRegion.$element.hasClass("multi-value-outer-container")&&a.optionsRegion.$element.remove();var c;c=document.createElement("div"),a.optionsContainerDiv=c,b(c).addClass("multi-value-outer-container"),document.body.appendChild(c),a.optionsRegion.setElement(c),
a.optionsRegion.attach(d),e.applyBindings(a,a.optionsRegion.activeContainer),a.setOptionContainerPosition(a)}j.prototype.setOptionContainerPosition=function(a){var c,d,e=30,f,g,h,i,j=a.optionsContainerDiv;j&&(c=b(a.container).find(".mi-multi-value-selector").offset(),d=b(a.container).find(".mi-multi-value-selector").width(),a.topOffset=c.top,a.leftOffset=c.left,b(j).css({position:"absolute","min-width":d,"z-index":1e5}),setTimeout(function(){f=b(j).width(),g=b(j).height(),b(j).find(".mi-multi-value-options-container").removeClass("top-left top-right bottom-left bottom-right"),c.top+g+50>=b(window).height()?(h=c.top-g-20,c.left+d-f<80?(i=c.left,b(j).find(".mi-multi-value-options-container").addClass("top-left")):(i=c.left-Math.abs(d-f),b(j).find(".mi-multi-value-options-container").addClass("top-right"))):(h=a.topOffset+e+10,c.left+d-f<80?(i=c.left,b(j).find(".mi-multi-value-options-container").addClass("bottom-left")):(i=c.left-Math.abs(d-f),
b(j).find(".mi-multi-value-options-container").addClass("bottom-right"))),b(j).css({left:i,top:h})},1))},j.prototype.showOptions=function a(c){var d=this;this.isOpen()||13===c.keyCode||d.disabled()||(b(d.optionsContainerDiv).css("visibility","hidden"),d.isClicked=!0,b(document).trigger("mousedown",[d.element]),this.isOpen(!0),C(this),D(d))},j.prototype.handleKeyUpOnTextInput=function a(b,c){return c.stopPropagation(),this.isOpen()||this.keyPressed(!1),"keyup"===c.type&&this.keyPressed(!0),this.showOptions(c),!0},j.prototype.handleKeyDownOnTextInput=function a(c,d){var e=this;if(d.stopPropagation(),b(e.element).trigger("textChange",[d]),9===d.keyCode)e.isOpen(!1),E(e),u(e),b(e.element).trigger("selected",[e.multiple()?e.selectedOptions():e.value()]);else{if(8===d.keyCode&&(e.multiple()||e.disabled()))return!1;H.bind(null,e)(d)}return!0};function D(a){b(a.element).parents().on("scroll",a.scrollProxy)}function E(a){b(a.optionsContainerDiv).css("visibility","hidden"),
b(a.element).parents().off("scroll",a.scrollProxy),J(a)}function F(b,c,d){return d!==b.currentText&&(b.currentText=d,b.currentMatchedOptions=a.find(c,G.bind(b,b,d))),b.currentMatchedOptions}function G(a,b,c){var d=a.getOptionText(c);return d&&d.toString()===b.toString()}function H(a,b){switch(b.keyCode){case 40:b.preventDefault(),P(a,b);break;case 38:b.preventDefault(),Q(a,b);break;case 13:b.preventDefault(),I(a,b);break;default:return}}function I(a,c){var d=a.optionsContainerDiv,f=b(d).find(".mi-multi-value-option.focus");if(f.length&&e.contextFor(b(f[0]).get(0))){var g=e.contextFor(b(f[0]).get(0)).$data;if(b(f[0]).hasClass("mi-multi-value-caption"))g=null;else if(K(a,f))return void L(a,f);a.selectValue(a,g,c),a.multiple()||(a.isOpen(!1),E(a),b(a.element).trigger("selected",[a.value()]),a.textFocus(!0))}}function J(a){var c=a.optionsContainerDiv;b(c).find("mi-multi-value-option").removeClass("focus")}function K(a,c){return b(c[0]).hasClass("mi-multi-value-input")}function L(a,c){
b(c[0]).find("input").focus()}function M(a,b){if(K(a,b))return L(a,b),!0;a.textFocus(!0)}function N(a){setTimeout(O.bind(null,a),10)}function O(a){if(!a.options||a.multiple&&a.multiple())return!1;var c=a.options(),d=a.selectedValueText(),e=!1,f=a.optionsContainerDiv;if(c&&c.length&&(e=F(a,c,d)),!e&&d&&d!==a.optionsCaption()){J(a);var g=a.optionsCaption()?1:0;b(b(f).find(".mi-multi-value-option")[g]).addClass("focus"),R(a)}else e&&d&&d!==a.optionsCaption()&&(J(a),b(b(f).find(".mi-multi-value-option")).filter(function(){return b(this).text()===d}).addClass("focus"),R(a));!d&&a.value()&&(J(a),a.value()&&R(a,"active"))}function P(a,c,d){var e=a.optionsContainerDiv,f=b(e).find(".mi-multi-value-option.focus"),g=b(e).find(".mi-multi-value-option.active"),h;b(e).find(".mi-multi-value-option").removeClass("focus"),
h=f.length&&b(f).nextAll(".mi-multi-value-option:first").length?b(f).nextAll(".mi-multi-value-option:first"):f.length&&!b(f).nextAll(".mi-multi-value-option:first").length?b(b(e).find(".mi-multi-value-option")[0]):g.length?b(g).nextAll(".mi-multi-value-option:first"):b(b(e).find(".mi-multi-value-option")[d?1:0]),h.addClass("focus"),M(a,h);var i=a.options(),j=a.selectedValueText(),k;i&&i.length&&((k=F(a,i,j))||a.optionsCaption()&&a.optionsCaption()),R(a)}function Q(a){var c=a.optionsContainerDiv,d=b(c).find(".mi-multi-value-option.focus"),e=b(c).find(".mi-multi-value-option.active"),f;b(c).find(".mi-multi-value-option").removeClass("focus"),f=d.length&&b(d).prevAll(".mi-multi-value-option:first").length?b(d).prevAll(".mi-multi-value-option:first"):d.length&&!b(d).prevAll(".mi-multi-value-option:first").length?b(c).find(".mi-multi-value-option").last():e.length?b(e).prevAll(".mi-multi-value-option:first"):b(b(c).find(".mi-multi-value-option")[0]),f.addClass("focus"),M(a,f)
;var g=a.options(),h=a.selectedValueText(),i;g&&g.length&&((i=F(a,g,h))||a.optionsCaption()&&a.optionsCaption()),R(a)}function R(a,c){var d=a.optionsContainerDiv,e=c||"focus",f=b(d).find(".mi-multi-value-option."+e);f&&f[0]&&(f[0].parentNode.scrollTop=f[0].offsetTop)}function S(a){return a.replace(/<([a-z]+)([^>]*[^\/])?>(?![\s\S]*<\/\1)/gi,function(a){return b("<div/>").text(a).html()})}return h.register("mi-multi-value",j),j});

define('text!ui/elements/text-ext/template.html',[],function () { return '<div class="mi-multi-value-container" data-bind="visible:visible,css:{\'disabled\':disabled,\'open\':isOpen,\'required\': (options() && !options().length) && required}">\r\n    <div data-bind="click:toggleOptions,css:{\'active\':isOpen},clickBubble: false" class="mi-multi-value-selector">\r\n        <!--<input type="text" class="mi-multi-value-selected-value-text pull-left" data-bind="value:value" />-->\r\n        <span class="mi-multi-value-selected-value-text pull-left" data-bind="text:selectedValueText"></span>\r\n        <i class="icon-arrow pull-right" ></i>\r\n    </div>\r\n\r\n    <div data-bind="visible:isOpen()" class="mi-multi-value-options-container hide">\r\n\r\n        <!-- ko ifnot:(optionsCaption() === null) -->\r\n        <p class="mi-multi-value-option" data-bind="text:optionsCaption()"></p>\r\n        <!-- /ko -->\r\n        <!-- ko foreach:options -->\r\n        <p class="mi-multi-value-option" data-bind="text:$parent.getOptionText($data)"></p>\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n</div>';});


define('text!ui/elements/text-ext/options-template.html',[],function () { return '<div data-bind="visible:isOpen()" class="mi-text-ext-options-container">\r\n    <p class="mi-multi-value-option" data-bind="clickBubble: false, click:function(data,event){event.preventDefault();}">\r\n        <input type="text" data-bind="attr:{ placeholder: $root.translator.translate(\'MULTI_VALUE_ADD_OPTION_PLACEHOLDER\') }, value:addValue,event:{\'keyup\':addValueUpdate}" />\r\n    </p>\r\n\r\n    <!-- ko ifnot:(optionsCaption() === null) -->\r\n    <p class="mi-multi-value-option" data-bind="text:optionsCaption()"></p>\r\n    <!-- /ko -->\r\n    <!-- ko foreach:options -->\r\n    <p class="mi-multi-value-option">\r\n        <span data-bind="text:$parent.getOptionText($data)"></span>\r\n        <span class="ds ds-cross pull-right" data-bind="click:function(data,event){$parent.removeOption(data,event);}"></span> \r\n\r\n    </p>\r\n    <!-- /ko -->\r\n\r\n  \r\n\r\n</div>\r\n';});

define('ui/elements/text-ext/view-model',['require','lodash','jquery','text!./template.html','text!./options-template.html','knockout','spa/region','../select/element','system/globalization/translator','system/hardware/device'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./template.html"),d=require("text!./options-template.html"),e=require("knockout"),f=require("spa/region"),g=require("../select/element"),h=require("system/globalization/translator"),i=Object.resolve(require("system/hardware/device"));function j(){m.call(this,c,!1,!0);var a=this;this.translator=Object.resolve(h),this.options=e.observableArray([]),this.value=e.observable(),this.optionsCaption=e.observable(),this.optionsText=e.observable(),this.optionsValue=e.observable(),this.max=e.observable(),this.required=e.observable(),this.disabled=e.observable(),this.visible=e.observable(),this.isOpen=e.observable(!1),this.selectedItem=e.observable(),this.addValue=e.observable(),this.optionsRegion=new f,b(document).bind("click",k.bind(null,a)),this.isClicked=!1,this.isMobile=i.isMobile(),this.addValueUpdate=l,this.addValue.subscribe(a.addOption,this)}function k(a){
a.isClicked?a.isClicked=!1:a.isOpen()&&(b(".text-ext-outer-container").remove(),a.isOpen(!1))}function l(a,b){13!==b.keyCode&&9!==b.keyCode||(b.target.blur(),b.target.focus())}var m=Object.inherit(g.ViewModel,j);j.prototype.afterAttached=function(){},j.prototype.afterCreated=function(){},j.prototype.beforeCreated=function(){var c=this;this.bindAttribute("optionsText",null),this.bindAttribute("optionsValue",null),this.bindAttribute("optionsCaption",null),this.bindAttribute("options",[],null,!0),this.bindAttribute("value",null),this.bindAttribute("max",null),this.bindAttribute("disabled",!1),this.bindAttribute("required",!1),this.bindAttribute("visible",!0),this.resizeProxy=b.proxy(a.debounce(this.resize,100),this),this.scrollProxy=b.proxy(this.resize,this),this.selectedValueText=e.computed(o.bind(null,this)),b(this.element).on("properties.options:changed",function(a,b){}.bind(this)),b(this.element).on("properties.value:changed",s.bind(null,this)),
b(this.element).on("properties.size:changed",function(a,b){}.bind(this)),b(this.element).on("properties.selectedOptions:changed",t.bind(null,this))},j.prototype.removeOption=function(a,c){var d=this;c.stopPropagation(),d.options.remove(a),b(d.element).trigger("properties.options:changed",[d.options()]),d.value(d.options().join(", "))},j.prototype.addOption=function(a){var c=this,d=a,e=!1;if(a){"object"==typeof c.options()[0]&&null!==c.options()[0]&&(d={},d[c.optionsText()]=a,d[c.optionsValue()]=a),window.txt=c;for(var f=c.options(),g=0;g<f.length;g++)if(null===f[g]){c.options()[g]=d,e=!0;break}e?c.value(c.options().join(", ")):(c.options.push(d),b(c.element).trigger("properties.options:changed",[c.options()])),c.addValue("")}},j.prototype.toggleOptions=function(a,c){var d=this;if(c.stopPropagation(),d.disabled())return!1;d.isClicked=!0,b(document).trigger("click"),d.isOpen()||(v(d),b(window).on("resize",this.resizeProxy),b(d.element).parents().on("scroll",this.scrollProxy),
d.isOpen(!0))};function n(a){e.cleanNode(a.optionsRegion.activeContainer),b(".text-ext-outer-container").remove(),b(window).off("resize",a.resizeProxy),b(a.element).parents().off("scroll",a.scrollProxy)}function o(a){var b=a.options(),c="";if(b){for(var d=0;b&&d<b.length;d++){c+=(c?", ":"")+a.getOptionText(b[d])}return c}}j.prototype.getValue=function(a){var b=a;return"function"==typeof a&&(b=a()),b},j.prototype.getReturnValue=function(a,b){return"function"==typeof a?a.call(b,b):b?b[a]:b},j.prototype.getOptionText=function(a){var b=this;return b.optionsText()?b.getValue(b.getReturnValue(b.optionsText(),a)):a},j.prototype.getOptionValue=function(a){var b=this;return b.optionsValue()?b.getValue(b.getReturnValue(b.optionsValue(),a)):a},j.prototype.resize=function(){this.isMobile||(this.isOpen(!1),n(this))};function p(a,b){for(var c=0;b&&c<b.length;c++)null!==b[c]&&a.options.push(b[c])}function q(a){}function r(a){}function s(a,b,c){}function t(a,b,c){}function u(a){this.option=a,
this.isSelected=e.observable(!1)}function v(a){var c,f,g,h=30,i,j,k,l;c=document.createElement("div"),a.optionsContainerDiv=c,b(c).addClass("text-ext-outer-container"),document.body.appendChild(c),a.optionsRegion.setElement(c),a.optionsRegion.attach(d),e.applyBindings(a,a.optionsRegion.activeContainer),f=b(a.container).find(".mi-multi-value-selector").offset(),g=b(a.container).find(".mi-multi-value-selector").width(),a.topOffset=f.top,a.leftOffset=f.left,b(c).css({position:"absolute",top:a.topOffset+40,left:a.leftOffset,"min-width":g,"z-index":1e5}),setTimeout(function(){i=b(c).width(),j=b(c).height(),f.top+j>=b(window).height()?(k=f.top-j-20,f.left+g-i<80?(l=f.left,b(c).find(".mi-text-ext-options-container").addClass("top-left")):(l=f.left-Math.abs(g-i),b(c).find(".mi-text-ext-options-container").addClass("top-right"))):(k=a.topOffset+h+10,f.left+g-i<80?(l=f.left,b(c).find(".mi-text-ext-options-container").addClass("bottom-left")):(l=f.left-Math.abs(g-i),
b(c).find(".mi-text-ext-options-container").addClass("bottom-right"))),b(c).css({left:l,top:k})},1)}return g.register("mi-text-ext",j),j});
!function(a){"use strict";if("function"==typeof define&&define.amd)define('ui/elements/date-time/bootstrap-datetimepicker',["jquery","moment","lodash","system/text/formatter","system/lang/converter","system/globalization/translator","system/hardware/device","system/text/parser"],a);else{if(!jQuery)throw"bootstrap-datetimepicker requires jQuery to be loaded first";if(!moment)throw"bootstrap-datetimepicker requires moment.js to be loaded first";a(jQuery,moment,_)}}(function(a,b,c,d,e,f,g,h){"use strict";if(void 0===b)throw alert("momentjs is required"),new Error("momentjs is required");var i=0,j=b,k=Object.resolve(d),l=Object.resolve(f),m=function(b,d){var e=a.fn.datetimepicker.defaults,f={time:"icon-time-units",date:"icon-calendar",up:"icon-up-arrow",down:"icon-arrow"},m=new g,n=this,o=!1,p=function(){var b=!1,c;if(t(),c=k.cultureInfo().calendar.patterns,r(c),n.use24hours=n.format.toLowerCase().indexOf("t")<1,null===k.cultureInfo().calendar.AM&&null===k.cultureInfo().calendar.AM&&(n.use24hours=!0),
n.component&&(b=n.component.find("span")),n.options.pickTime&&b&&b.addClass(n.options.icons.time),n.options.pickDate&&b&&(b.removeClass(n.options.icons.time),b.addClass(n.options.icons.date)),n.options.widgetParent="string"==typeof n.options.widgetParent&&n.options.widgetParent||n.element.parents().filter(function(){return"scroll"===a(this).css("overflow-y")}).get(0)||"body",n.widget=a(da()).appendTo(n.options.widgetParent),n.options.useSeconds&&!n.use24hours&&n.widget.width(300),s(),n.options.disabledDates=ba(n.options.disabledDates),n.options.enabledDates=ba(n.options.enabledDates),q(),""!==n.options.defaultDate&&""===u().val()&&n.setValue(n.options.defaultDate),1!==n.options.minuteStepping){var d=n.options.minuteStepping;n.date.minutes(Math.round(n.date.minutes()/d)*d%60).seconds(0)}},q=function(){n.startViewMode=n.viewMode,n.setMinDate(n.options.minDate),n.setMaxDate(n.options.maxDate),E(),F(),H(),I(),J(),D(),T(),U()},r=function(a){n.format||(n.format=n.options.pickDate?a.d:"",
n.options.pickDate&&n.options.pickTime&&(n.format+=" "),n.format+=n.options.pickTime?a.t:"",n.options.useSeconds&&(~a.t.indexOf(" tt")?n.format=n.format.split(" tt")[0]+":ss tt":~a.t.indexOf(" t")?n.format=n.format.split(" t")[0]+":ss t":n.format+=":ss"))},s=function(){if(n.minViewMode=n.options.minViewMode||0,"string"==typeof n.minViewMode)switch(n.minViewMode){case"months":n.minViewMode=1;break;case"years":n.minViewMode=2;break;default:n.minViewMode=0}if(n.viewMode=n.options.viewMode||0,"string"==typeof n.viewMode)switch(n.viewMode){case"months":n.viewMode=1;break;case"years":n.viewMode=2;break;default:n.viewMode=0}},t=function(){if(n.options=a.extend({},e,d),n.options.icons=a.extend({},f,n.options.icons),n.element=a(b),n.elementZIndexOrig=n.element.css("z-index"),n.elementPosOrig=n.element.css("position"),n.blockout=a('<div class="datepicker-screen-freeze"></div>'),v(),!n.options.pickTime&&!n.options.pickDate)throw new Error("Must choose at least one picker");n.id=i++,
j.locale(n.options.language),n.date=j(),n.unset=!1,n.isInput=n.element.is("input"),n.component=!1,n.element.hasClass("input-group")&&(0===n.element.find(".datepickerbutton").size()?n.component=n.element.find("[class^='input-group-']"):n.component=n.element.find(".datepickerbutton")),n.format=n.options.format,n.placePosition=""},u=function(){var a;if(n.isInput)return n.element;if(a=n.element.find(".datepickerinput"),0===a.size())a=n.element.find("input");else if(!a.is("input"))throw new Error('CSS class "datepickerinput" cannot be applied to non input element');return a},v=function(){var a;a=n.element.is("input")?n.element.data():n.element.find("input").data(),void 0!==a.dateFormat&&(n.options.format=a.dateFormat),void 0!==a.datePickdate&&(n.options.pickDate=a.datePickdate),void 0!==a.datePicktime&&(n.options.pickTime=a.datePicktime),void 0!==a.dateUseminutes&&(n.options.useMinutes=a.dateUseminutes),void 0!==a.dateUseseconds&&(n.options.useSeconds=a.dateUseseconds),
void 0!==a.dateUsecurrent&&(n.options.useCurrent=a.dateUsecurrent),void 0!==a.dateMinutestepping&&(n.options.minuteStepping=a.dateMinutestepping),void 0!==a.dateMindate&&(n.options.minDate=a.dateMindate),void 0!==a.dateMaxdate&&(n.options.maxDate=a.dateMaxdate),void 0!==a.dateShowtoday&&(n.options.showToday=a.dateShowtoday),void 0!==a.dateCollapse&&(n.options.collapse=a.dateCollapse),void 0!==a.dateLanguage&&(n.options.language=a.dateLanguage),void 0!==a.dateDefaultdate&&(n.options.defaultDate=a.dateDefaultdate),void 0!==a.dateDisableddates&&(n.options.disabledDates=a.dateDisableddates),void 0!==a.dateEnableddates&&(n.options.enabledDates=a.dateEnableddates),void 0!==a.dateIcons&&(n.options.icons=a.dateIcons),void 0!==a.dateUsestrict&&(n.options.useStrict=a.dateUsestrict),void 0!==a.dateDirection&&(n.options.direction=a.dateDirection),void 0!==a.dateSidebyside&&(n.options.sideBySide=a.dateSidebyside)},w=function(){
var b="absolute",c=n.component?n.component.offset():n.element.offset(),d=a(window);n.width=n.component?n.component.outerWidth():n.element.outerWidth(),c.top=c.top+n.element.outerHeight(),n.placePosition,y(c,d),z(c),void 0!==n.options.width&&n.widget.width(n.options.width),"left"===n.options.orientation&&(n.widget.addClass("left-oriented"),c.left=c.left-n.widget.width()+20),Y()&&(b="fixed",c.top-=d.scrollTop(),c.left-=d.scrollLeft()),d.width()<c.left+n.widget.outerWidth()?(c.right=d.width()-c.left-n.width,c.left="auto",n.widget.addClass("pull-right")):(c.right="auto",n.widget.removeClass("pull-right")),n.widget.css({position:b,top:c.top,left:c.left,right:c.right})},x=function(){c.defer(function(){window.scrollTo(0,0),n.widget.css("top",Math.max(0,(a(window).height()-n.widget.outerHeight())/2+a(window).scrollTop())+"px"),n.widget.css("left",Math.max(0,(a(window).width()-n.widget.outerWidth())/2+a(window).scrollLeft())+"px")})},y=function(b,c){
var d=b.top+n.widget.height()>c.height()+c.scrollTop()&&n.widget.height()+n.element.outerHeight()<b.top,e=!(b.top>0&&b.left>0&&b.top+n.widget.height()<c.height());"up"===n.options.direction?n.placePosition="top":"bottom"===n.options.direction?n.placePosition="bottom":"auto"===n.options.direction&&(d?n.placePosition="top":e?(x(),a(n.widget).addClass("remove-arrow")):n.placePosition="bottom")},z=function(a){"top"===n.placePosition?(a.top-=n.widget.height()+n.element.outerHeight()+15,n.widget.addClass("top").removeClass("bottom")):(a.top+=1,n.widget.addClass("bottom").removeClass("top"))},A=function(a){n.element.trigger({type:"dp.clear",date:j(n.date),oldDate:j(a)})},B=function(a,b){if(o)o=!1;else if(j(n.date).isSame(j(a)))return;n.element.trigger({type:"dp.change",date:j(n.date),oldDate:j(a)}),"change"!==b&&n.element.change()},C=function(a){o=!0,n.element.trigger({type:"dp.error",date:j(a)})},D=function(a){j.locale(n.options.language);var b=a,c;b||(b=u().val(),b&&(c=S(b,n.format,b),
c instanceof Date||!n.options.oldFormat||n.format===n.options.oldFormat||(c=S(b,n.options.oldFormat,b)),n.date=j(c)),n.date||(n.date=j())),n.viewDate=j(n.date).startOf("month"),G(),K()},E=function(){j.locale(n.options.language);var b=a("<tr>"),c=j.weekdaysMin(),d;if(0===j().localeData()._week.dow)for(d=0;d<7;d++)b.append('<th class="dow">'+c[d]+"</th>");else for(d=1;d<8;d++)7===d?b.append('<th class="dow">'+c[0]+"</th>"):b.append('<th class="dow">'+c[d]+"</th>");n.widget.find(".datepicker-days thead").append(b)},F=function(){j.locale(n.options.language);for(var a="",b=0,c=j.monthsShort();b<12;)a+='<span class="month">'+c[b++]+"</span>";n.widget.find(".datepicker-months td").append(a)},G=function(){if(n.options.pickDate){j.locale(n.options.language);var b=n.viewDate.year(),c=n.viewDate.month(),d=n.options.minDate.year(),e=n.options.minDate.month(),f=n.options.maxDate.year(),g=n.options.maxDate.month(),h,i,k,l=[],m,o,p,q,r,s,t=j.months()
;for(n.widget.find(".datepicker-days").find(".disabled").removeClass("disabled"),n.widget.find(".datepicker-months").find(".disabled").removeClass("disabled"),n.widget.find(".datepicker-years").find(".disabled").removeClass("disabled"),n.widget.find(".datepicker-days th:eq(1)").text(t[c]+" "+b),i=j(n.viewDate).subtract(1,"months"),q=i.daysInMonth(),i.date(q),i.startOf("week"),(b===d&&c<=e||b<d)&&n.widget.find(".datepicker-days th:eq(0)").addClass("disabled"),(b===f&&c>=g||b>f)&&n.widget.find(".datepicker-days th:eq(2)").addClass("disabled"),k=j(i).add(42,"d");i.isBefore(k);){if(i.weekday()===j().startOf("week").weekday()&&(m=a("<tr>"),l.push(m)),o="",i.year()<b||i.year()===b&&i.month()<c?o+=" old":(i.year()>b||i.year()===b&&i.month()>c)&&(o+=" new"),i.isSame(j({y:n.date.year(),M:n.date.month(),d:n.date.date()}))&&(o+=" active"),!_(i,"day")&&aa(i)||(o+=" disabled"),n.options.showToday===!0&&i.isSame(j(),"day")&&(o+=" today"),
n.options.daysOfWeekDisabled)for(p in n.options.daysOfWeekDisabled)if(i.day()===n.options.daysOfWeekDisabled[p]){o+=" disabled";break}m.append('<td class="day'+o+'">'+i.date()+"</td>"),h=i.date(),i.add(1,"d"),h===i.date()&&i.add(1,"d")}for(n.widget.find(".datepicker-days tbody").empty().append(l),s=n.date.year(),t=n.widget.find(".datepicker-months").find("th:eq(1)").text(b).end().find("span").removeClass("active"),s===b&&t.eq(n.date.month()).addClass("active"),s-1<d&&n.widget.find(".datepicker-months th:eq(0)").addClass("disabled"),s+1>f&&n.widget.find(".datepicker-months th:eq(2)").addClass("disabled"),p=0;p<12;p++)b===d&&e>p||b<d?a(t[p]).addClass("disabled"):(b===f&&g<p||b>f)&&a(t[p]).addClass("disabled");for(l="",b=10*parseInt(b/10,10),r=n.widget.find(".datepicker-years").find("th:eq(1)").text(b+"-"+(b+9)).end().find("td"),n.widget.find(".datepicker-years").find("th").removeClass("disabled"),d>b&&n.widget.find(".datepicker-years").find("th:eq(0)").addClass("disabled"),
f<b+9&&n.widget.find(".datepicker-years").find("th:eq(2)").addClass("disabled"),b-=1,p=-1;p<11;p++)l+='<span class="year'+(p===-1||10===p?" old":"")+(s===b?" active":"")+(b<d||b>f?" disabled":"")+'">'+b+"</span>",b+=1;r.html(l)}},H=function(){j.locale(n.options.language);var a=n.widget.find(".timepicker .timepicker-hours table"),b="",c,d,e;if(a.parent().hide(),n.use24hours)for(c=0,d=0;d<6;d+=1){for(b+="<tr>",e=0;e<4;e+=1)b+='<td class="hour">'+ca(c.toString())+"</td>",c++;b+="</tr>"}else for(c=1,d=0;d<3;d+=1){for(b+="<tr>",e=0;e<4;e+=1)b+='<td class="hour">'+ca(c.toString())+"</td>",c++;b+="</tr>"}a.html(b)},I=function(){var a=n.widget.find(".timepicker .timepicker-minutes table"),b="",c=0,d,e,f=n.options.minuteStepping;for(a.parent().hide(),1===f&&(f=5),d=0;d<Math.ceil(60/f/4);d++){for(b+="<tr>",e=0;e<4;e+=1)c<60?(b+='<td class="minute">'+ca(c.toString())+"</td>",c+=f):b+="<td></td>";b+="</tr>"}a.html(b)},J=function(){
var a=n.widget.find(".timepicker .timepicker-seconds table"),b="",c=0,d,e;for(a.parent().hide(),d=0;d<3;d++){for(b+="<tr>",e=0;e<4;e+=1)b+='<td class="second">'+ca(c.toString())+"</td>",c+=5;b+="</tr>"}a.html(b)},K=function(){if(n.date){var a=n.widget.find(".timepicker span[data-time-component]"),b=n.date.hours(),c="AM";n.use24hours?(n.widget.find(".timepicker-hour").addClass("hour-fix"),n.widget.find(".timepicker-minute").addClass("hour-fix"),n.widget.find(".timepicker-second").addClass("hour-fix")):(b>=12&&(c="PM"),0===b?b=12:12!==b&&(b%=12),n.widget.find(".timepicker [data-action=togglePeriod]").text(c)),a.filter("[data-time-component=hours]").text(ca(b)),a.filter("[data-time-component=minutes]").text(ca(n.date.minutes())),a.filter("[data-time-component=seconds]").text(ca(n.date.second()))}},L=function(b){b.stopPropagation(),b.preventDefault(),n.unset=!1;var c=a(b.target).closest("span, td, th, button"),d,e,f,g,h=j(n.date);c.hasClass("close-button")&&n.hide(),
c.hasClass("clear-date-button")&&(n.setDate(S("",void 0,"")),n.hide(),A()),1===c.length&&M(b,c,d,e,f,g,h)},M=function(a,b,c,d,e,f,g){if(!b.is(".disabled"))switch(b[0].nodeName.toLowerCase()){case"th":switch(b[0].className){case"switch":T(1);break;case"prev":case"next":e=ea.modes[n.viewMode].navStep,"prev"===b[0].className&&(e*=-1),n.viewDate.add(e,ea.modes[n.viewMode].navFnc),G()}break;case"span":b.is(".month")?(c=b.parent().find("span").index(b),n.viewDate.month(c)):(d=parseInt(b.text(),10)||0,n.viewDate.year(d)),n.viewMode===n.minViewMode&&(n.date=j({y:n.viewDate.year(),M:n.viewDate.month(),d:n.viewDate.date(),h:n.date.hours(),m:n.date.minutes(),s:n.date.seconds()}),B(g,a.type),Z()),T(-1),G();break;case"td":b.is(".day")&&(f=parseInt(b.text(),10)||1,c=n.viewDate.month(),d=n.viewDate.year(),b.is(".old")?0===c?(c=11,d-=1):c-=1:b.is(".new")&&(11===c?(c=0,d+=1):c+=1),n.date=j({y:d,M:c,d:f,h:n.date.hours(),m:n.date.minutes(),s:n.date.seconds()}),n.viewDate=j({y:d,M:c,d:Math.min(28,f)}),
G(),Z(),B(g,a.type),n.hide())}},N={incrementHours:function(){$("add","hours",1)},incrementMinutes:function(){$("add","minutes",n.options.minuteStepping)},incrementSeconds:function(){$("add","seconds",1)},decrementHours:function(){$("subtract","hours",1)},decrementMinutes:function(){$("subtract","minutes",n.options.minuteStepping)},decrementSeconds:function(){$("subtract","seconds",1)},togglePeriod:function(){var a=n.date.hours();a>=12?a-=12:a+=12,n.date.hours(a)},showPicker:function(){n.widget.find(".timepicker > div:not(.timepicker-picker)").hide(),n.widget.find(".timepicker .timepicker-picker").show()},showHours:function(){n.widget.find(".timepicker .timepicker-picker").hide(),n.widget.find(".timepicker .timepicker-hours").show()},showMinutes:function(){n.widget.find(".timepicker .timepicker-picker").hide(),n.widget.find(".timepicker .timepicker-minutes").show()},showSeconds:function(){n.widget.find(".timepicker .timepicker-picker").hide(),
n.widget.find(".timepicker .timepicker-seconds").show()},selectHour:function(b){var c=n.widget.find(".timepicker [data-action=togglePeriod]").text(),d=parseInt(a(b.target).text(),10);"PM"===c&&(d+=12),n.date.hours(d),N.showPicker.call(n)},selectMinute:function(b){n.date.minutes(parseInt(a(b.target).text(),10)),N.showPicker.call(n)},selectSecond:function(b){n.date.seconds(parseInt(a(b.target).text(),10)),N.showPicker.call(n)}},O=function(b){var c=j(n.date),d=a(b.currentTarget).data("action"),e=N[d].apply(n,arguments);return P(b),n.date||(n.date=j({y:1970})),Z(),K(),B(c,b.type),e},P=function(a){a.stopPropagation(),a.preventDefault()},Q=function(a){27===a.keyCode&&n.hide()},R=function(b){j.locale(n.options.language);var c=a(b.target),d=j(n.date),e=j(S(c.val(),n.format,c.val()));e.isValid()&&!_(e)&&aa(e)?(D(),n.setValue(e),B(d,b.type),Z()):(n.viewDate=d,n.unset=!0,B(d,b.type),C(e))},S=function(a,b,c){return b=b||"yyyy-MM-ddTHH:mm:ss.fff",c=Object.defaultValue(c,null),
null===a||void 0===a?c:a instanceof Date?a:h.parseDate(a,b)||h.parseDate(a,"yyyy-MM-ddTHH:mm:ss.fff")||h.parseDate(a)||null},T=function(a){a&&(n.viewMode=Math.max(n.minViewMode,Math.min(2,n.viewMode+a))),n.widget.find(".datepicker > div").hide().filter(".datepicker-"+ea.modes[n.viewMode].clsName).show()},U=function(){var b,c,d,e,f;n.widget.on("click",".datepicker *, .close-button, .clear-date-button",a.proxy(L,this)),n.widget.on("click","[data-action]",a.proxy(O,this)),n.widget.on("mousedown",a.proxy(P,this)),n.element.on("keydown",a.proxy(Q,this)),n.options.pickDate&&n.options.pickTime&&n.widget.on("click.togglePicker",".accordion-toggle",function(g){if("top"===n.placePosition&&setTimeout(function(){w()},250),g.stopPropagation(),b=a(this),c=b.closest("ul"),d=c.find(".in"),e=c.find(".collapse:not(.in)"),d&&d.length){if((f=d.data("collapse"))&&f.transitioning)return;d.collapse("hide"),e.collapse("show"),b.find("span").toggleClass(n.options.icons.time+" "+n.options.icons.date),
n.element.find("[class^='input-group-'] span").toggleClass(n.options.icons.time+" "+n.options.icons.date)}}),n.isInput?m.isMobile()?n.element.on({focus:a.proxy(n.show,this),change:a.proxy(R,this)}):n.element.on({focus:a.proxy(n.show,this),change:a.proxy(R,this),blur:a.proxy(n.hide,this)}):(n.element.on({change:a.proxy(R,this)},"input"),n.component?n.component.on("click",a.proxy(n.show,this)):n.element.on("click",a.proxy(n.show,this)))},V=function(){a(window).on("resize.datetimepicker"+n.id,a.proxy(w,this)),n.isInput||a(document).on("mousedown.datetimepicker"+n.id,a.proxy(n.hide,this))},W=function(){n.widget.off("click",".datepicker *, .close-button, .clear-date-button",n.click),n.widget.off("click","[data-action]"),n.widget.off("mousedown",n.stopEvent),n.options.pickDate&&n.options.pickTime&&n.widget.off("click.togglePicker"),n.isInput?n.element.off({focus:n.show,change:n.change}):(n.element.off({change:n.change},"input"),
n.component?n.component.off("click",n.show):n.element.off("click",n.show))},X=function(){a(window).off("resize.datetimepicker"+n.id),n.isInput||a(document).off("mousedown.datetimepicker"+n.id)},Y=function(){if(n.element){var b=n.element.parents(),c=!1,d;for(d=0;d<b.length;d++)if("fixed"===a(b[d]).css("position")){c=!0;break}return c}return!1},Z=function(){j.locale(n.options.language);var a="";n.unset||(a=k.format(n.date.toDate(),n.format)),u().val(a),n.element.data("date",a),n.options.pickTime||n.hide()},$=function(a,b,c){j.locale(n.options.language);var d;if("add"===a?(d=j(n.date),23===d.hours()&&d.add(c,b),d.add(c,b)):d=j(n.date).subtract(c,b),_(j(d.subtract(c,b)))||_(d))return void C(k.format(d.toDate(),n.format));"add"===a?n.date.add(c,b):n.date.subtract(c,b),n.unset=!1},_=function(a,b){j.locale(n.options.language);var c=n.options.maxDate,d=n.options.minDate;return b&&(c=j(c).endOf(b),d=j(d).startOf(b)),
!(!a.isAfter(c)&&!a.isBefore(d))||n.options.disabledDates!==!1&&n.options.disabledDates[k.format(a,"yyyy-MM-dd")]===!0},aa=function(a){return j.locale(n.options.language),n.options.enabledDates===!1||n.options.enabledDates[k.format(a,"yyyy-MM-dd")]===!0},ba=function(a){var b,c={},d=0,e;for(e=0;e<a.length;e++)b=j(a[e]),b.isValid()&&(c[k.format(b.toDate(),"yyyy-MM-dd")]=!0,d++);return d>0&&c},ca=function(a){return a=a.toString(),a.length>=2?a:"0"+a},da=function(){if(n.options.pickDate&&n.options.pickTime){var a="";return a='<div class="bootstrap-datetimepicker-widget'+(n.options.sideBySide?" timepicker-sbs":"")+' dropdown-menu" style="z-index:99999 !important;">',
n.options.sideBySide?a+='<div class="row"><div class="col-sm-6 datepicker">'+ea.template+'</div><div class="col-sm-6 timepicker">'+fa.getTemplate()+"</div></div>":a+='<ul class="list-unstyled"><li'+(n.options.collapse?' class="collapse in"':"")+'><div class="datepicker">'+ea.template+'</div></li><li class="picker-switch accordion-toggle"><a class="btn btn-icon" style="width:100%; padding-top:5px;"><span class="'+n.options.icons.time+'"></span></a></li><li'+(n.options.collapse?' class="collapse"':"")+'><div class="timepicker">'+fa.getTemplate()+"</div></li></ul>"+ea.buttonsTemplate,a+="</div>"}return n.options.pickTime?'<div class="bootstrap-datetimepicker-widget dropdown-menu"><div class="timepicker">'+fa.getTemplate()+"</div>"+ea.buttonsTemplate+"</div>":'<div class="bootstrap-datetimepicker-widget dropdown-menu"><div class="datepicker">'+ea.template+"</div>"+ea.buttonsTemplate+"</div>"},ea={modes:[{clsName:"days",navFnc:"month",navStep:1},{clsName:"months",navFnc:"year",navStep:1},{
clsName:"years",navFnc:"year",navStep:10}],headTemplate:'<thead><tr><th class="prev"><i class="icon-back-arrow"></i></th><th colspan="5" class="switch"></th><th class="next"><i class="icon-right-arrow"></i></th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'},fa={hourTemplate:'<span data-action="showHours" data-time-component="hours" class="timepicker-hour"></span>',minuteTemplate:'<span data-action="showMinutes" data-time-component="minutes" class="timepicker-minute"></span>',secondTemplate:'<span data-action="showSeconds"  data-time-component="seconds" class="timepicker-second"></span>'};ea.template='<div class="datepicker-days"><table class="table-condensed">'+ea.headTemplate+'<tbody></tbody></table></div><div class="datepicker-months"><table class="table-condensed">'+ea.headTemplate+ea.contTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+ea.headTemplate+ea.contTemplate+"</table></div>",
ea.buttonsTemplate='<div class="block-group date-picker-buttons"><button class="clear-date-button btn btn-default block">'+l.translate("CLEAR")+'</button><button class="close-button btn btn-default block">'+l.translate("CLOSE")+"</button> </div>",fa.getTemplate=function(){
return'<div class="timepicker-picker"><table class="table-condensed"><tr><td><a href="#" class="btn  btn-icon" data-action="incrementHours"><span style="box-shadow:none; font-size:18px;" class="'+n.options.icons.up+'"></span></a></td><td class="separator"></td><td>'+(n.options.useMinutes?'<a href="#" class="btn btn-icon" data-action="incrementMinutes"><span style="box-shadow:none; font-size:18px;" class="'+n.options.icons.up+'"></span></a>':"")+"</td>"+(n.options.useSeconds?'<td class="separator"></td><td><a href="#" class="btn btn-icon" data-action="incrementSeconds"><span style="box-shadow:none; font-size:18px;" class="'+n.options.icons.up+'"></span></a></td>':"")+(n.use24hours?"":'<td class="separator"></td>')+"</tr><tr><td>"+fa.hourTemplate+'</td> <td class="separator">:</td><td>'+(n.options.useMinutes?fa.minuteTemplate:'<span class="timepicker-minute">00</span>')+"</td> "+(n.options.useSeconds?'<td class="separator">:</td><td>'+fa.secondTemplate+"</td>":"")+(n.use24hours?"":'<td class="separator"></td><td><button type="button" class="btn btn-primary" style="min-width: 0;" data-action="togglePeriod"></button></td>')+'</tr><tr><td><a href="#" class="btn btn-icon" data-action="decrementHours"><span style="box-shadow:none; font-size:18px;" class="'+n.options.icons.down+'"></span></a></td><td class="separator"></td><td>'+(n.options.useMinutes?'<a href="#" class="btn btn-icon" data-action="decrementMinutes"><span style="box-shadow:none; font-size:18px;" class="'+n.options.icons.down+'"></span></a>':"")+"</td>"+(n.options.useSeconds?'<td class="separator"></td><td><a href="#" class="btn btn-icon" data-action="decrementSeconds"><span class="'+n.options.icons.down+'"></span></a></td>':"")+(n.use24hours?"":'<td class="separator"></td>')+'</tr></table></div><div class="timepicker-hours" data-action="selectHour"><table class="table-condensed"></table></div><div class="timepicker-minutes" data-action="selectMinute"><table class="table-condensed"></table></div>'+(n.options.useSeconds?'<div class="timepicker-seconds" data-action="selectSecond"><table class="table-condensed"></table></div>':"")
},n.destroy=function(){W(),X(),n.widget.remove(),n.blockout&&n.blockout.remove(),n.element.removeData("DateTimePicker"),n.component&&n.component.removeData("DateTimePicker")},n.show=function(b){if(n.options.useCurrent&&""===u().val()){if(1!==n.options.minuteStepping){var c=j(),d=n.options.minuteStepping;c.minutes(Math.round(c.minutes()/d)*d%60).seconds(0),n.setValue(k.format(c.toDate(),n.format))}else n.setValue(k.format(new Date,n.format));B("",b.type)}n.blockout=a('<div class="datepicker-screen-freeze"></div>').appendTo("body"),m.isMobile()&&n.blockout.click(function(){a(n.blockout).remove(),n.hide()}),n.widget.hasClass("picker-open")?(n.widget.hide(),n.widget.removeClass("picker-open")):(n.widget.show(),n.blockout.show(),n.widget.css("visibility","visible"),n.element.css("z-index",99999),a("input.form-control").css("z-index",2),n.element.css("position","relative"),n.widget.addClass("picker-open")),n.height=n.component?n.component.outerHeight():n.element.outerHeight(),w(),
n.element.trigger({type:"dp.show",date:j(n.date)}),V(),b&&P(b)},n.disable=function(){var a=n.element.find("input");a.prop("disabled")||a.prop("disabled",!0)},n.enable=function(){var a=n.element.find("input");a.prop("disabled")&&a.prop("disabled",!1)},n.hide=function(a){m.isMobile()?setTimeout(n.hide_function.bind(null,this,a),500):n.hide_function(a)},n.hide_function=function(b){if(!b||!a(b.target).is("#"+n.element.attr("id"))){var c=n.widget.find(".collapse"),d,e;for(d=0;d<c.length;d++)if((e=c.eq(d).data("collapse"))&&e.transitioning)return;n.widget.hide(),n.widget.css("visiblity","hidden"),n.widget.removeClass("picker-open"),n.viewMode=n.startViewMode,n.blockout&&(n.blockout.remove(),m.isMobile()&&n.blockout.off("click")),m.isMobile()&&a(n.element).blur(),n.element.css("z-index",n.elementZIndexOrig),n.element.css("position",n.elementPosOrig),T(),n.element.trigger({type:"dp.hide",date:j(n.date)}),X()}},n.setValue=function(a){j.locale(n.options.language),a?n.unset=!1:(n.unset=!0,Z()),
j.isMoment(a)||(a=j(a instanceof Date?a:S(a,n.format,a))),a.isValid()?(n.date=a,Z(),n.viewDate=j({y:n.date.year(),M:n.date.month()}),G(),K()):C(a)},n.getDate=function(){return n.unset?null:j(n.date)},n.setDate=function(a){var b=j(n.date);a?n.setValue(a):n.setValue(null),B(b,"function")},n.setDisabledDates=function(a){n.options.disabledDates=ba(a),n.viewDate&&D()},n.setEnabledDates=function(a){n.options.enabledDates=ba(a),n.viewDate&&D()},n.setMaxDate=function(a){void 0!==a&&(n.options.maxDate=j(a),n.viewDate&&D())},n.setMinDate=function(a){void 0!==a&&(n.options.minDate=j(a),n.viewDate&&D())},p()};a.fn.datetimepicker=function(b){function c(c){var d=a(c);d.data("DateTimePicker")||d.data("DateTimePicker",new m(c,b))}return this.each(c.bind(null,this))},a.fn.datetimepicker.defaults={pickDate:!0,pickTime:!0,useMinutes:!0,useSeconds:!1,useCurrent:!0,minuteStepping:1,minDate:new j({y:1900}),maxDate:(new j).add(1e3,"y"),showToday:!0,collapse:!0,language:"en",defaultDate:"",disabledDates:!1,
enabledDates:!1,icons:{},useStrict:!1,direction:"auto",sideBySide:!1,daysOfWeekDisabled:!1,widgetParent:!1}});
define('logging/error-notification-handler',['require','jquery','knockout','spa/ko/knockout-view-model','system/lang/event'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("spa/ko/knockout-view-model"),d=require("system/lang/event"),e=[];function f(){g.call(this)}var g=Object.inherit(c,f);f.prototype.addError=function a(b){b&&(b.errorCode=b.errorCode||"",b.errorMessage=b.errorMessage||"",b.errorDetail=b.errorDetail||"",b.date=b.date||h(),b.time=b.time||i(new Date))},f.prototype.getErrorsLog=function a(b,c){return e},f.prototype.getErrorById=function b(c){return a.grep(e,function(a){return a.number===parseInt(c.logId)})};function h(){var a=new Date;return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear().toString().substr(2,2)}function i(a){var b=a.getHours(),c=a.getMinutes(),d=b>=12?"pm":"am";return b%=12,b=b?b:12,c=c<10?"0"+c:c,b+":"+c+" "+d}return f.singleton=!0,f});
define('ui/elements/date-time/date-time-control',['require','exports','module','lodash','jquery','logging/error-notification-handler','system/diagnostics/log-manager','system/lang/event','system/hardware/device','ui/elements/date-time/bootstrap-datetimepicker'],function(require,exports,module){"use strict";var a=require("lodash"),b=require("jquery"),c=require("logging/error-notification-handler"),d=require("system/diagnostics/log-manager"),e=d.getLogger(module.id),f=require("system/lang/event"),g=require("system/hardware/device");require("ui/elements/date-time/bootstrap-datetimepicker");function h(a){this.element=a,this.options=null,this.picker=null,this.changed=new f,this.invalid=new f,this.clear=new f,this.blur=new f,this.hide=new f,this.inputGroup=null,this.input=null,this.addon=null,this.button=null,this.icon=null,this.$input=null,this.$addon=null,this.markValid=!1,this.errorNotificationHandler=Object.resolve(c)}h.culture="",h.setCulture=function(a){try{h.culture=a}catch(a){B(this,a)}},h.prototype.initHTML=function(){try{i(this)}catch(a){B(this,a)}},h.prototype.initialize=function(a){try{j(this,a)}catch(a){B(this,a)}},h.prototype.setValue=function(a){try{this.picker&&this.picker.setDate(a)}catch(a){B(this,a)}},
h.prototype.enable=function(){try{r(this,!1)}catch(a){B(this,a)}},h.prototype.disable=function(){try{r(this,!0)}catch(a){B(this,a)}},h.prototype.dispose=function(){try{k(this)}catch(a){B(this,a)}finally{l(this)}};function i(a){Element.clearDom(a.element),a.inputGroup=Element.build("div",a.element,["input-group","date"]),a.input=Element.build("input",a.inputGroup,["form-control"],{type:"text"}),a.addon=Element.build("span",a.inputGroup,["input-group-btn"]),a.button=Element.build("button",a.addon,["btn","btn-icon"]),a.icon=Element.build("span",a.button),a.$input=b(a.input),a.$addon=b(a.addon)}function j(a,b){if(b){var c;a.options&&(c=a.options.format),a.options=b,a.options.oldFormat=c}l(a),o(a),p(a)}function k(a){a.changed.remove(),a.changed=null,a.invalid.remove(),a.invalid=null,a.clear.remove(),a.clear=null,l(a)}function l(a){m(a),n(a)}function m(a){a.$addon.off(),a.$input.off()}function n(a){a.picker&&(a.picker.destroy(),a.picker=null)}function o(a){
a.options.pickDate?(a.icon.classList.add("icon-calendar"),a.icon.classList.remove("icon-time-units")):(a.icon.classList.add("icon-time-units"),a.icon.classList.remove("icon-calendar"))}function p(a){a.picker=q(a),r(a,a.options.disabled),s(a)}function q(a){return a.$input.datetimepicker({pickDate:a.options.pickDate,pickTime:a.options.pickTime,useMinutes:a.options.useMinutes,useSeconds:a.options.useSeconds,minuteStepping:a.options.minuteStep,format:a.options.format,oldFormat:a.options.oldFormat,language:h.culture,useCurrent:a.options.useCurrent}),a.$input.data("DateTimePicker")}function r(a,b){a.picker&&b?a.picker.disable():a.picker&&!b&&a.picker.enable(),a.input.disabled=b,a.button.disabled=b}function s(a){a.$addon.click(u.bind(null,a)),a.$input.change(v),a.$input.on("dp.change",w.bind(null,a)),a.$input.on("blur",x.bind(null,a)),a.$input.on("dp.error",z.bind(null,a)),a.$input.on("dp.hide",y.bind(null,a)),a.$input.on("dp.clear",A.bind(null,a)),t(a)}function t(a){
Object.resolve(g).isMobile()&&(a.input.readOnly=!0)}function u(a){a.input.focus()}function v(a){a.stopPropagation()}function w(c,d){var e=d.oldDate?d.oldDate.toDate():null,f=d.date?d.date.toDate():null;a.defer(function(){b(c.input).removeClass("date-error"),c.input.style.border="1px solid #c0c5c5",c.input.style.padding="10px"}),c.changed.raise(c,e,f)}function x(a,b){a.blur.raise(a),b.stopPropagation()}function y(a,b){a.hide.raise(),b.stopPropagation()}function z(c,d){c.input.value||!c.input.value&&c.element.required?(c.invalid.raise(c,c.input.value),a.defer(function(){c.markValid||b(c.input).addClass("date-error")})):c.changed.raise(c,null,null)}function A(a,b){a.clear.raise(),b.stopPropagation()}function B(a,b){e.error(b.stack),a.errorNotificationHandler.addError({errorMessage:b.message,errorDetail:b.stack})}return h});
define('ui/elements/date-time/element',['require','exports','module','lodash','jquery','logging/error-notification-handler','system/diagnostics/log-manager','system/lang/converter','./date-time-control'],function(require,exports,module){"use strict";var a=require("lodash"),b=require("jquery"),c=require("logging/error-notification-handler"),d=require("system/diagnostics/log-manager"),e=d.getLogger(module.id),f=require("system/lang/converter"),g=require("./date-time-control"),h=Object.create(HTMLElement.prototype);h.createdCallback=function(){m(this),this.rebuild=a.debounce(U.bind(null,this),100),this.errorNotificationHandler=Object.resolve(c)},h.attachedCallback=function(){try{i(this)}catch(a){V(a,this)}},h.detachedCallback=function(){try{j(this)}catch(a){V(a,this)}finally{Element.clearDom(this)}},h.attributeChangedCallback=function(a,b,c){try{k(this,a,b,c)}catch(a){V(a,this)}};function i(a){a.control=new g(a),o(a),a.control.initHTML(),a.control.initialize({pickDate:a.pickDate,pickTime:a.pickTime,useMinutes:a.useMinutes,useSeconds:a.useSeconds,minuteStep:a.minuteStep,format:a.format,disabled:a.disabled,required:a.required,defaultDate:a.value,useCurrent:a.useCurrent}),
a.control.changed.add(E,null,a),a.control.blur.add(F,null,a),a.control.invalid.add(H,null,a),a.control.hide.add(G,null,a),a.control.clear.add(I,null,a)}function j(a){a.control.dispose(),a.control=null,Element.clearDom(a)}function k(a,b,c,d){"value"===b?(c=f.toNullableDate(c),d=f.toNullableDate(d),L(a,c,d)):"format"===b?a.format=p(a):"pick-date"===b?a.pickDate=q(a):"pick-time"===b?a.pickTime=r(a):"use-minutes"===b?a.useMinutes=s(a):"use-seconds"===b?a.useSeconds=t(a):"minute-step"===b?a.minuteStep=u(a):"disabled"===b?a.disabled=v(a):"required"===b?a.required=x(a):"populate-empty"===b&&(a.useCurrent=w(a)),l(a)}function l(a){a._properties.value&&a.control.picker.setValue(a.control.picker.date.toDate())}function m(b){b._properties={pickDate:!0,pickTime:!0,useMinutes:!0,useSeconds:!1,minuteStep:1,format:"",disabled:!1,required:!1,useCurrent:!0,oldValue:null},a.each(b._properties,n.bind(null,b)),b._properties.value=f.toDate(),Element.defineProperty(b,"value",{get:A.bind(null,b,"value"),
set:C.bind(null,b)})}function n(a,b,c){Object.defineProperty(a,c,{get:A.bind(null,a,c),set:B.bind(null,a,c)})}function o(a){a._properties.format=p(a),a._properties.pickDate=q(a),a._properties.pickTime=r(a),a._properties.useMinutes=s(a),a._properties.useSeconds=t(a),a._properties.minuteStep=u(a),a._properties.disabled=v(a),a._properties.value=f.toDate(z(a),void 0,z(a)),a._properties.required=x(a),a._properties.useCurrent=w(a),a._properties.oldValue=a._properties.value}function p(a){return Element.stringAttribute(a,"format",a.format)}function q(a){return y(a,"pick-date",a.pickDate)}function r(a){return y(a,"pick-time",a.pickTime)}function s(a){return y(a,"use-minutes",a.useMinutes)}function t(a){return y(a,"use-seconds",a.useSeconds)}function u(a){return Element.intAttribute(a,"minute-step",a.minuteStep)}function v(a){return Element.booleanAttribute(a,"disabled")}function w(a){return!Element.booleanAttribute(a,"populate-empty")}function x(a){return Element.booleanAttribute(a,"required")}
function y(a,b,c){var d=a.getAttribute(b);return d?f.toBoolean(d,"true"):c}function z(a){return Element.stringAttribute(a,"value",a.value)}function A(a,b){return a._properties[b]}function B(a,b,c){a._properties[b]=c,U(a)}function C(c,d){if(!window.CustomElements||window.CustomElements.useNative)D(c,d);else{var e,f=!1;c.parentNode&&c.parentNode.parentNode&&(e=c.parentNode.parentNode),e&&b(e).hasClass("layout-element-content")&&(f=!0),f?D(c,d):a.defer(function(){D(c,d)})}}function D(b,c){void 0!==c&&(""===c&&(c=null),null===c||void 0===c||a.isDate(c)||(c=f.toDate(c,void 0,c)),c=K(b,c),b._properties.value=c,b._properties.oldValue=c,b.control&&b.control.setValue(b.value))}function E(a,b,c,d){null===a.value&&null===d||L(a,a.value,d)}function F(a){M(a)}function G(a){N(a)}function H(a,b,c){var d=a._properties.value;if(c){var e;if(c=c.trim(),/AM|PM/.test(c.substr(c.length-2))&&(c=c.split(/AM|PM/)[0]),e=new Date(c.trim()),
!isNaN(e.getTime()))return void(a.value.getTime()!==e.getTime()&&(a.value=e,a.control.markValid=!0,P(a,d,a.value)))}a._properties.value=null,R(a,d)}function I(a){J(a)}function J(a){a.dispatchEvent(new CustomEvent("clear",{detail:{oldValue:null,newValue:null}}))}function K(a,b){if(b)return a.pickTime?!a.useSeconds&&b.setSeconds&&b.setSeconds(0,0):b.setHours(0,0,0,0),b}function L(a,b,c){T(b,c)&&(a._properties.value=c)}function M(a){T(a._properties.oldValue,a._properties.value)&&(P(a,a._properties.oldValue,a._properties.value),a._properties.oldValue=a._properties.value)}function N(a){O(a)&&T(a._properties.oldValue,a._properties.value)&&(Q(a,a._properties.oldValue,a._properties.value),a._properties.oldValue=a._properties.value)}function O(a){return a.getAttribute("update-on-close")}function P(a,b,c){a.dispatchEvent(new CustomEvent("change",{detail:{oldValue:b,newValue:c}}))}function Q(a,b,c){a.dispatchEvent(new CustomEvent("updateValueOnClose",{detail:{oldValue:b,newValue:c}}))}
function R(a,b){a.dispatchEvent(new CustomEvent("invalid",{detail:{oldValue:b,newValue:null}}))}function S(a){return Math.floor(a/1e3)}function T(a,b){return!a||(!b||S(a.valueOf())!==S(b.valueOf()))}function U(a){a.control&&(a.control.initialize({pickDate:a.pickDate,pickTime:a.pickTime,useMinutes:a.useMinutes,useSeconds:a.useSeconds,minuteStep:a.minuteStep,format:a.format,disabled:a.disabled,required:a.required,defaultDate:a.value,useCurrent:a.useCurrent}),a.disabled?a.control.disable():a.control.enable())}function V(a,b){e.error(a.stack),b.errorNotificationHandler.addError({errorMessage:a.message,errorDetail:a.stack})}return document.registerElement("mi-date-time",{prototype:h}),h});
define('ui/elements/more-options-item/view-model',['jquery','system/lang/converter'],function(){"use strict";var a=require("jquery"),b=require("system/lang/converter"),c=Object.create(HTMLElement.prototype);c.createdCallback=function(){var b,c,e;this.$el=a(this),this.className="moreoptions-item",this.display="block",e=document.createElement("span"),e.className="icon",c=document.createElement("span"),c.className="text",this.appendChild(e),this.appendChild(c),d(this)},c.attachedCallback=function(){},c.attributeChangedCallback=function(a,b,c){};function d(a){a._value=null,Element.defineProperty(a,"value",{get:function(){return this._value}.bind(a),set:function(a){this._value=a,e(this,a)}.bind(a)})}function e(a,b){var c;a.value&&(a.querySelector(".text").textContent=b.text,a.querySelector(".icon").className=b.icon)}return document.registerElement("mi-more-options-item",{prototype:c}),c});
define('ui/elements/more-options/more-options',['require','lodash','jquery','system/lang/converter','system/globalization/translator','../more-options-item/view-model'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/lang/converter"),d=require("system/globalization/translator");require("../more-options-item/view-model");var e=Object.create(HTMLElement.prototype);e.createdCallback=function(){var c,d;c=this,c.internalIcon=null,c._disabled=b(c).is("[disabled]"),c._noaccess=null,c._text=null,this.isOpen=!1,this._options=[],o(this),b(this).empty(),d=i(this),this.appendChild(d),this.resizeProxy=b.proxy(a.debounce(this.resize,100),this),this.scrollProxy=b.proxy(this.scroll,this),this.ctrlOffset=null,this.ctrlWidth=null,this.optionsWidth=null,this.optionsHeight=null,this.optionsTop=null,this.optionsLeft=null,this.outerContainer=null,this.docClickHandler=h.bind(null,this),Element.defineProperty(c,"moreoptionsCB",{get:g.bind(null,c),set:c.handlemoreoptionsCB.bind(c)}),Element.defineProperty(c,"options",{get:function(){return c._options}.bind(c),set:function(a){f(c,a)}.bind(c)}),
Element.defineProperty(c,"icon",{get:function(){return c.internalIcon}.bind(c),set:function(a){j(c,a)}.bind(c)}),Element.defineProperty(c,"text",{get:function(){return c._text}.bind(c),set:function(a){k(c,a)}.bind(c)}),Element.defineProperty(c,"disabled",{get:function(){return c._disabled}.bind(c),set:function(a){l(c,a)}.bind(c)}),Element.defineProperty(c,"noaccess",{get:function(){return c._noaccess}.bind(c),set:function(a){m(c,a)}.bind(c)}),Element.defineProperty(c,"tooltip",{get:function(){}.bind(c),set:function(a){n.call(null,c,a)}.bind(c)}),c.internalIcon||j(c,null)},e.attachedCallback=function(){u(this).addEventListener("mousedown",this),b(document).on("mousedown.mi_opt",this.docClickHandler)},e.attributeChangedCallback=function(a,b,d){var e=this;if("disabled"===a){l(e,c.toBoolean(d,"true"))}else if("noaccess"===a){var f=c.toBoolean(d,"true");m(e,f)}else"icon"===a?j(e,d):"text"===a&&k(e,d)},e.handlemoreoptionsCB=function(a,b){this.callback=a};function f(a,b){a._options=b}
e.detachedCallback=function(){var a=u(this);a&&a.removeEventListener("mousedown",this),b(document).off("mousedown.mi_opt",this.docClickHandler),b(this.contentContainer).remove(),this.isOpen=!1},e.handleEvent=function(a){"mousedown"===a.type&&(a.stopPropagation(),this.loader&&this.reload())},e.optionClicked=function(a,b){b.stopPropagation(),a.disabled!==!0&&a.noaccess!==!0&&(s(this),Object.tryMethod(this,"callback",a))},e.reload=function(){this.load().done()},e.load=function(){var a;return this.disabled?b.Deferred().done().promise():this.loader?this.isOpen?(b(window).off("resize",this.resizeProxy),b(this).parents().off("scroll",this.scrollProxy),a=this.loader(),a.done(s.bind(null,this)),a.promise()):(b(window).on("resize",this.resizeProxy.bind(null,this)),b(this).parents().on("scroll",this.scrollProxy.bind(null,this)),a=this.loader(),a.done(r.bind(null,this)),a.promise()):b.Deferred().done().promise()},e.resize=function(a){b(a).find(".mi-more-options-icon").is(":visible")?v(this):s(a)},
e.deallocateMem=function(){var a=this;a.internalIcon=null,a.isOpen=null,a.ctrlOffset=null,a.ctrlWidth=null,a.optionsWidth=null,a.optionsHeight=null,a.optionsTop=null,a.optionsLeft=null,a.outerContainer=null,a.disabled=null,a.options=null,a.contentContainer&&(a.contentContainer=null),a.isClicked&&(a.isClicked=null),a.callback=null,a.loader=null,a.scrollProxy=null,a.resizeProxy=null,a.icon=null,a.tooltip=null},e.scroll=function(a){s(a),a.isOpen=!1};function g(a){return a.handlemoreoptionsCB}function h(a,c){a.isClicked?a.isClicked=!1:a.isOpen&&(b(c.target).hasClass("more-options-content")||(b(".more-options-outer-container").remove(),a.isOpen=!1))}function i(a){var b,c,d,e;return b=document.createElement("button"),b.className="mi-more-options-icon btn btn-icon",c=document.createElement("i"),b.appendChild(c),b}function j(a,c){a.internalIcon=c?c.trim():"icon-options",b(a).find("button i").removeAttr("class").addClass(a.internalIcon)}function k(a,c){c&&(a._text=c.trim(),
b(a).find("button").text(a._text),b(a).find("button").attr("title",a._text),b(a).find("button").append('<i class="icon-tree-collapse"></i>'),b(a).find("button").removeClass("btn-icon").addClass("btn-text"))}function l(a,c){void 0!==c&&(a._disabled=c),a._disabled?b(a).find("button").addClass("disabled"):b(a).find("button").removeClass("disabled")}function m(a,c){a._noaccess=c,c?b(a).find("button").addClass("no-access"):b(a).find("button").removeClass("no-access")}function n(a,c){c&&b(a).find("button").attr("title",c)}function o(a){a._loader=null,Element.defineProperty(a,"loader",{get:p.bind(null,a),set:q.bind(null,a)})}function p(a){return a._loader}function q(a,b){a._loader=b}function r(a,c){var d,e,f,g,h,i,j,k=u(a),l=0;if(a._options=c,!c.length)return void(a.isOpen=!1);if(a.isOpen=!a.isOpen,a.isClicked=!0,b(document).trigger("mousedown.mi_opt"),f=document.createElement("div"),b(f).addClass("more-options-outer-container"),a.contentContainer=b(f),g=document.createElement("ul"),
b(g).addClass("more-options-content"),k){for(d=0;d<c.length;d++)e=document.createElement("mi-more-options-item"),h=document.createElement("li"),c[d].disabled&&b(h).addClass("disabled"),c[d].noaccess?l++:(h.addEventListener("mousedown",function(a){a.stopPropagation()}.bind(a),!1),h.addEventListener("click",function(c){if("click"===c.type){var d=b(c.currentTarget).find("mi-more-options-item")[0].value;a.optionClicked(d,c)}}.bind(a),!1),t(a,e,d,c.length),h.appendChild(e),g.appendChild(h),e.value=c[d]);0!==c.length&&c.length===l&&(e=document.createElement("mi-more-options-item"),h=document.createElement("li"),b(h).addClass("no-access"),h.appendChild(e),g.appendChild(h))}f.appendChild(g),document.body.appendChild(f),v(a)}function s(a){a.isOpen=!a.isOpen,b(a.contentContainer).remove()}function t(a,b,c,d){var e,f;b.setAttribute("index",c)}function u(a){var b=a.querySelectorAll(".mi-more-options-icon");return 0===b.length?null:b[b.length-1]}function v(a){var c=50,d,e;w(a),x(a),
a.ctrlOffset&&a.ctrlOffset.top+a.optionsHeight+c>=b(window).height()?(y(a),b(a.outerContainer).find(".more-options-content").css({"box-shadow":"0px 0px 12px 6px rgba(0, 0, 0, 0.175)","-webkit-box-shadow":"0px 0px 12px 6px rgba(0, 0, 0, 0.175)"})):z(a),a.height&&b(a.outerContainer).find(".more-options-content").css({maxHeight:a.height})}function w(a){a.outerContainer=b(a.contentContainer),a.ctrlOffset=b(a).find(".mi-more-options-icon").offset(),a.ctrlWidth=b(a).find(".mi-more-options-icon").width(),b(a.outerContainer).css({position:"absolute"}),a.optionsWidth=b(a.outerContainer).width(),a.optionsHeight=b(a.outerContainer).height()}function x(a){b(a.outerContainer).find(".more-options-content").removeClass("top-left top-right bottom-left bottom-right")}function y(a){var b;a.ctrlOffset&&(b=a.ctrlOffset.top-a.optionsHeight-10,a.ctrlOffset&&a.ctrlOffset.left+a.ctrlWidth-a.optionsWidth<80?A(a,"top-left",b):B(a,"top-right",b))}function z(a){var b;a.ctrlOffset&&(b=a.ctrlOffset.top+50-6,
a.ctrlOffset&&a.ctrlOffset.left+a.ctrlWidth-a.optionsWidth<80?A(a,"bottom-left",b):B(a,"bottom-right",b))}function A(a,b,c){var d;d=a.ctrlOffset.left,C(a,b),D(a,d,c)}function B(a,b,c){var d;d=a.ctrlOffset.left-Math.abs(a.ctrlWidth-a.optionsWidth),d=a.text?d+37:d,C(a,b),D(a,d,c)}function C(a,c){var d;d=b(a.outerContainer).find(".more-options-content"),b(d).addClass(c)}function D(a,c,d){b(a.outerContainer).css({left:c,top:d})}return document.registerElement("mi-more-options-noko",{prototype:e}),e});
define('system/lang/interface',['lodash'],function(){"use strict";var a=require("lodash");function b(a,b,c){this.name=a,this.methods=b||[],this.properties=c||[]}b.prototype.implementedBy=function(a){c(this,a),d(this,a)};function c(b,c){var d,e;for(d=0;d<b.methods.length;d++){if(e=b.methods[d],a.isUndefined(c[e]))throw"Missing method "+e;if(!a.isFunction(c[e]))throw e+" is not a function"}return!0}function d(b,c){var d,e;for(d=0;d<b.properties.length;d++)if(e=b.properties[d],a.isUndefined(c[e]))throw"Missing property "+e;return!0}return b});
define('ui/elements/site-selector/i-site-selector-element',['require','exports','module','system/lang/interface'],function(require,exports,module){"use strict";return new(require("system/lang/interface"))(module.id,["createdCallback","attachedCallback","detachedCallback","attributeChangedCallback","removeChild"])});
define('ui/elements/site-selector/models/site-user',['require','lodash','ramda','application/application-context','mi-assert','system/globalization/translator'],function(require){"use strict";var a=require("lodash"),b=require("ramda"),c=require("application/application-context"),d=require("mi-assert"),e=require("system/globalization/translator");function f(){var a=Object.resolve(e);this.NullSite={siteKey:null,siteName:a.translate("ALL_SITES")},this.__private__={user:c.user,session:c.session,dbSitesCount:c.dbSiteCount}}f.hasGlobalAccess=function a(){return!0},f.prototype.getSites=function a(){var b=g(this);return d.isArray(b,"sites"),b},f.prototype.getDBSiteCount=function a(){return o(this)},f.prototype.hasMultipleSites=function(){return!!h(this).sites&&1!==h(this).sites.length};function g(a){var b=i(a).userSites;return b=b||[],b=b.slice(),d.isArray(b,"sites"),d.assert(b!==h(a).sites,"sites is a copy of user sites"),b}function h(a){q(a);var b=a.__private__.user;return r(a,b),b}function i(a){return q(a),a.__private__.session}f.prototype.getDefaultSite=function a(){var b,c=j(this);return b=c?k(this,c):n(this),s(b),b};function j(a){
var b=h(a).defaultSiteKey||null;return d.isNotUndefined(b,"defaultSiteKey"),b}function k(b,c){var d;return l(b)?(d=a.find(b.getSites(),m.bind(null,c)),d=d||n(b)):d=b.NullSite,s(d),d}function l(a){return a.getSites().length>0}function m(a,b){return b.siteKey===a}function n(a){var c;return c=l(a)?b.find(p,a.getSites())||a.NullSite:a.NullSite,s(c),c}function o(a){return a.__private__.dbSitesCount}var p=b.complement(b.prop("viewOnly"));function q(a){d.enabled&&(d.instanceOf(a,f,"this"),d.isNotUndefined(a.__private__,"this.__private__"),d.isNotUndefined(a.__private__.user,"this.__private__.user"))}function r(a,b){b=b||h(a),d.enabled&&d.assert(b===c.user,"expected user to be same as ApplicationContext.user")}function s(a){d.enabled&&(d.ok(a,"site"),null!==a.siteKey&&d.isString(a.siteKey,"site.siteKey"),d.isString(a.siteName,"site.siteName"))}return f});
define('system/http/ajax-request',['require','lodash','system/http/ajax-client','mi-assert'],function(require){"use strict";var a=require("lodash"),b=require("system/http/ajax-client"),c=require("mi-assert");function d(a,c,d,e){this.ajaxClient=Object.resolve(b),this.method=a,this.url=c,this.data=d||null,this.options=e||null}d.get=function(a,b){return new d("get",a,null,b)},d.post=function(a,b,c){return new d("post",a,b,c)},d.put=function(a,b,c){return new d("put",a,b,c)},d.delete=function(a,b){return new d("delete",a,null,b)},d.prototype.send=function a(b){var c;if("get"===this.method)c=this.ajaxClient.get(this.url,this.options);else if("post"===this.method)c=this.ajaxClient.post(this.url,this.data,this.options);else if("put"===this.method)c=this.ajaxClient.put(this.url,this.data,this.options);else{if("delete"!==this.method)throw"Unknown request method: "+this.method;c=this.ajaxClient.delete(this.url,this.options)}return b&&c.fail(this.onFail(b)),c},d.prototype.onFail=function a(b){return c.isObject(b,"dfd"),e.bind(null,b,this)};function e(b,e,f){c.isObject(b,"dfd"),
c.instanceOf(e,d,"request"),c.isObject(f,"response"),a.isFunction(b.promise)?b.reject(e,f):b.reject({request:e,response:f})}return d});
define('system/http/es6-ajax-request',['require','./ajax-request','bluebird'],function(require){"use strict";var a=require("./ajax-request"),b=require("bluebird");function c(a,b,c,e){d.call(this,a,b,c,e),this.xhr=null}var d=Object.inherit(a,c);c.get=function(a,b){return new c("get",a,null,b)},c.post=function(a,b,d){return new c("post",a,b,d)},c.put=function(a,b,d){return new c("put",a,b,d)},c.delete=function(a,b){return new c("delete",a,null,b)},c.prototype.send=function(){return this.xhr=d.prototype.send.call(this),b.resolve(this.xhr).catch(e.bind(null,this))};function e(a,b){return{request:a,response:b}}return c});
define('ui/elements/site-selector/view-models/site-selector-view-model',['require','lodash','mi-assert','../models/site-user','system/lang/event','system/http/es6-ajax-request','mithril'],function(require){"use strict";var a=require("lodash"),b=require("mi-assert"),c=require("../models/site-user"),d=require("system/lang/event"),e=require("system/http/es6-ajax-request"),f=require("mithril");function g(){var a=new c;this.__private__={user:a,selectedSite:a.NullSite,isHidden:!1,isDisabled:!1,isReadOnly:!1},this.selectedSiteChanged=Object.resolve(d),this.setSelectedSite(this.getDefaultSite())}g.prototype.dispose=function a(){this.selectedSiteChanged.remove(),this.selectedSiteChanged=null},g.prototype.getDefaultSite=function a(){return h(this).getDefaultSite()};function h(a){p(a);var b=a.__private__.user;return q(a,b),b}g.prototype.setSelectedSite=function a(b){p(this),r(b),this.__private__.selectedSite=b,this.selectedSiteChanged.raise(this,{site:this.getSelectedSite()})},g.prototype.getSites=function a(){return h(this).getSites()},g.prototype.getSelectableSites=function a(){
var d=c.hasGlobalAccess(),e=this.getSites(),f=0===e.length,g=this.getSelectedSite(),j=h(this).NullSite;return d?e=i(this,e):(f||g===j)&&(e=[j]),b.isArray(e,"sites"),b.assert(e.length>=1,"expected sites to have at least one item"),e};function i(a,b){return b.unshift(h(a).NullSite),b}g.prototype.getSelectedSite=function a(){p(this);var b=this.__private__.selectedSite;return r(b),b},g.prototype.allowSelection=function a(){return h(this).hasMultipleSites()},g.prototype.isHidden=function a(){p(this);var c=this.__private__.isHidden||0===j(this)||k(this)<1;return b.isBoolean(c),c};function j(a){return p(a),a.getSites().length}function k(a){return p(a),h(a).getDBSiteCount()}g.prototype.isDisabled=function a(){p(this);var c=this.__private__.isDisabled;return b.isBoolean(c),c},g.prototype.isReadOnly=function a(){p(this);var c=this.__private__.isReadOnly;return b.isBoolean(c),c},g.prototype.setHidden=function a(c){p(this),b.isBoolean(c),this.__private__.isHidden=c},
g.prototype.setDisabled=function a(c){p(this),b.isBoolean(c),this.__private__.isDisabled=c},g.prototype.setReadOnly=function a(c){p(this),b.isBoolean(c),this.__private__.isReadOnly=c},g.prototype.selectSiteByKey=function a(b){p(this);var c=l(this,b);c&&this.setSelectedSite(c)};function l(b,c){return null===c?h(b).NullSite:a.find(b.getSites(),m.bind(null,c))}function m(a,b){return b.siteKey===a}g.prototype.selectSiteByAssetKey=function a(c){p(this),b.stringNotEmpty(c),n(c).then(o.bind(null,this))};function n(a){b.stringNotEmpty(a);var c="api/common/assetcontext/"+a;return e.get(c).send()}function o(a,b){a.selectSiteByKey("0"===b.siteKey?null:b.siteKey),f.redraw()}g.prototype.selectDefaultSite=function(){var a=this.getDefaultSite();a&&this.setSelectedSite(a)};function p(a){b.enabled&&(b.instanceOf(a,g,"this"),b.isNotUndefined(a.__private__,"this.__private__"),b.isObject(a.__private__.user,"this.__private__.user"),b.isObject(a.__private__.selectedSite,"this.__private__.selectedSite"),
b.isBoolean(a.__private__.isHidden,"this.__private__.isHidden"),b.isBoolean(a.__private__.isDisabled,"this.__private__.isDisabled"),b.isBoolean(a.__private__.isReadOnly,"this.__private__.isReadOnly"),b.instanceOf(a.selectedSiteChanged,d,"this.selectedSiteChanged"))}function q(a,d){d=d||h(a),b.enabled&&b.instanceOf(d,c,"user")}function r(a){b.enabled&&(b.ok(a,"site"),null!==a.siteKey&&b.isString(a.siteKey,"site.siteKey"),b.isString(a.siteName,"site.siteName"))}return g});
define('system/mithril/mithril-extensions',['require','lodash','mithril'],function(require){"use strict";var a=require("lodash"),b=require("mithril");function c(b,c,d){return b=f(b),b?a.isFunction(c)?c():c:d?a.isFunction(d)?d():d:void 0}function d(a,b,c){return a=f(a),a?b(a):c?c():void 0}function e(b,c,d){return b=f(b),a.size(b)?a.map(b,c):d?d():void 0}function f(b){return a.isFunction(b)?b():b}function g(){b.endComputation(),b.startComputation()}function h(a,b){return{currentTarget:a,args:b}}return{iif:c,exists:d,map:e,value:f,restartComputation:g,event:h}});
define('system/mithril/html-tags',['require','mithril','./mithril-extensions'],function(require){"use strict";var a=require("mithril"),b=require("./mithril-extensions");function c(b){return a("i"+b)}function d(b,c){return a(".inline",b,c)}function e(c,d,e){return a("video[controls]",{width:b.value(d),height:b.value(e),src:b.value(c)})}return{icon:c,idiv:d,video:e,header:a.bind(null,"header"),h1:a.bind(null,"h1"),h2:a.bind(null,"h2"),span:a.bind(null,"span"),div:a.bind(null,"div"),section:a.bind(null,"section"),label:a.bind(null,"label"),table:a.bind(null,"table"),thead:a.bind(null,"thead"),tbody:a.bind(null,"tbody"),tr:a.bind(null,"tr"),th:a.bind(null,"th"),td:a.bind(null,"td"),ul:a.bind(null,"ul"),li:a.bind(null,"li"),a:a.bind(null,"a"),output:a.bind(null,"output")}});
define('system/mithril/bootstrap-tags',['require','mithril','./mithril-extensions'],function(require){"use strict";var a=require("mithril"),b=require("./mithril-extensions");function c(c,d,e,f){return a("a.list-group-item",{href:b.value(c),class:b.value(e||!1)?"active":"",onclick:f},b.value(d))}return{aListGroupItem:c,button:a.bind(null,"button.btn.btn-default"),primaryButton:a.bind(null,"button.btn.btn-primary"),iconButton:a.bind(null,"button.btn.btn-icon"),panel:a.bind(null,".panel.panel-default"),panelHeading:a.bind(null,".panel-heading"),panelBody:a.bind(null,".panel-body.container"),layoutRow:a.bind(null,".row"),divListGroup:a.bind(null,".list-group"),inputGroupButton:a.bind(null,"span.input-group-btn"),formGroup:a.bind(null,".form-group"),textBox:a.bind(null,'input.form-control[type="text"]'),table:a.bind(null,"table.table"),dropdown:a.bind(null,".dropdown"),dropdownMenu:a.bind(null,"ul.dropdown-menu")}});
define('ui/elements/site-selector/views/site-selector-view',['require','mithril','system/mithril/html-tags','system/mithril/bootstrap-tags','ramda','system/globalization/translator'],function(require){"use strict";var a=require("mithril"),b=require("system/mithril/html-tags"),c=require("system/mithril/bootstrap-tags"),d=require("ramda"),e=require("system/globalization/translator");function f(a){if(!a.isHidden()){return(a.isReadOnly()?g:h)(a)}}function g(c){return a(".readonly",[b.icon(".icon-location"),j(),k(c)])}function h(a){return c.dropdown([i(a),l(a)])}function i(c){var d=c.getSelectedSite(),e={"data-toggle":"dropdown",title:d.siteName};return c.isDisabled()&&(e.disabled="disabled"),a("button.btn",e,[b.icon(".icon-location"),j(),k(c)])}function j(){var a=Object.resolve(e),c=a.translate("SITE");return b.label(c+":")}function k(a){var c=a.getSelectedSite();return c&&c.truncatedSiteName?b.output(c.truncatedSiteName):b.output(c.siteName)}function l(c){var d=c.getSelectableSites();return a(".dropdown-menu",[b.ul(m(c,d))])}function m(a,b){return d.map(n(a),q(b))}var n=d.curry(function a(c,d){return b.li({className:p(c,d),onclick:c.setSelectedSite.bind(c,d),
title:d.siteName},d.siteName)});function o(a){return!a.viewOnly}function p(a,b){return b===a.getSelectedSite()?"active":""}var q=d.filter(o);return f});
define('ui/elements/site-selector/site-selector-element',['require','exports','module','lodash','jquery','mi-assert','mithril','./i-site-selector-element','system/diagnostics/log-manager','./view-models/site-selector-view-model','./views/site-selector-view','system/text/formatter'],function(require,exports,module){"use strict";var a=require("lodash"),b=require("jquery"),c=require("mi-assert"),d=require("mithril"),e=require("./i-site-selector-element"),f=require("system/diagnostics/log-manager"),g=f.getLogger(module.id),h=require("./view-models/site-selector-view-model"),i=require("./views/site-selector-view"),j=require("system/text/formatter"),k=Object.resolve(j),l={},m=90,n=60,o=6;l.prototype=Object.create(HTMLElement.prototype),l.prototype.createdCallback=function(){try{p(this)}catch(a){B(a)}};function p(a){q(a),r(a),w(a),R(a),t(a).isHidden()&&b(a).addClass("customHide")}function q(a){a.__private__={root:null,vm:null,previousValue:null}}function r(a){s(a,Object.resolve(h)),t(a).setReadOnly(Element.booleanAttribute(a,"hidden")),t(a).setDisabled(Element.booleanAttribute(a,"disabled")),t(a).setReadOnly(Element.booleanAttribute(a,"readonly")),t(a).selectedSiteChanged.add(u,a,a)}function s(a,b){R(a),a.__private__.vm=b}function t(a){R(a);var b=a.__private__.vm
;return null!==b&&T(b),b}function u(a,b,d){T(b),c.ok(d,"e"),V(d.site,"e.site"),v(a,d.site),Element.raiseEvent(a,"change",{site:d.site,value:d.site.siteKey})}function v(a,b){a.clientWidth>100?b.truncatedSiteName=k.abbreviateByWidth(b.siteName,m,o):b.truncatedSiteName=k.abbreviateByWidth(b.siteName,n,o-2)}function w(a){Element.defineProperty(a,"value",{get:x.bind(null,a),set:y.bind(null,a)}),Element.defineProperty(a,"isSiteViewOnly",{get:z.bind(null,a),set:A})}function x(a){var b=t(a).getSelectedSite();return V(b),b.siteKey}function y(b,c){(a.isUndefined(c)||""===c)&&(c=null),t(b).selectSiteByKey(c),d.redraw()}function z(a){var b=t(a).getSelectedSite();return V(b),b.viewOnly}function A(){}function B(a){throw g.error(a.stack),console.error(a.stack),a}l.prototype.attachedCallback=function(){try{C(this)}catch(a){B(a)}};function C(a){D(a)||r(a),E(a),v(a,t(a).getSelectedSite()),G(a)}function D(a){return R(a),!!a.__private__.vm}function E(a){R(a),
F(a,Element.build("div",a,["site-selector-root"]))}function F(a,b){R(a),a.__private__.root=b}function G(a){S(a),U(i),d.mount(H(a),{controller:t.bind(null,a),view:i})}function H(a){R(a);var b=a.__private__.root;return S(a,b),b}l.prototype.detachedCallback=function(){try{I(this)}catch(a){B(a)}};function I(a){J(a),K(a),L(a)}function J(a){S(a),d.mount(H(a),null)}function K(a){R(a),S(a),Element.detach(H(a)),F(a,null)}function L(a){t(a).selectedSiteChanged.remove(a),t(a).dispose(),s(a,null)}l.prototype.attributeChangedCallback=function(a,b,c){try{M(this,a,b,c)}catch(a){B(a)}};function M(a,b,c,d){var e=N(b);e&&e(a,d)}function N(b){return{hidden:O,disabled:P,readonly:Q}[b]||a.noop}function O(a,b){t(a).setHidden(null!==b),d.redraw()}function P(a,b){t(a).setDisabled(null!==b),d.redraw()}function Q(a,b){t(a).setReadOnly(null!==b),d.redraw()}l.prototype.selectSiteByAssetKey=function(a){c.isNotUndefined(a,"siteKey"),c.isNotNull(a,"siteKey"),c.stringNotEmpty(a.toString(),"siteKey.toString()"),
t(this).selectSiteByAssetKey(a.toString()),d.redraw()},l.prototype.selectDefaultSite=function(){null!==t(this)&&t(this).selectDefaultSite(),d.redraw()};function R(a){c.enabled&&(c.implementsInterface(a,e,"this"),c.isNotUndefined(a.__private__,"this.__private__"),c.isNotUndefined(a.__private__.root,"this.__private__.root"),c.isNotUndefined(a.__private__.vm,"this.__private__.vm"))}function S(a,b){c.enabled&&(b=b||H(a),c.instanceOf(b,HTMLElement,"root"))}function T(a){c.enabled&&c.instanceOf(a,h,"vm")}function U(a){c.enabled&&c.isFunction(a,"view")}function V(a){c.enabled&&(c.ok(a,"site"),null!==a.siteKey&&c.isString(a.siteKey,"site.siteKey"),c.isString(a.siteName,"site.siteName"),a.truncatedSiteName&&c.isString(a.truncatedSiteName,"site.truncatedSiteName "))}return Element.registerElement("mi-site-selector",{prototype:l.prototype}),l});
define('state-management/services/dto/state-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key)||"0",this.id=a.toString(b.id),this.caption=a.toString(b.caption)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('security/services/role-dto',['require','system/lang/converter','./user-dto','./group-dto'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.id=a.toString(b.id),this.key=a.toString(b.key)||"0",this.caption=a.toString(b.caption),this.description=a.toString(b.description),this.users=require("./user-dto").fromDataCollection(b.users),this.groups=require("./group-dto").fromDataCollection(b.groups)}return b.fromDataCollection=function a(c){if(void 0!==c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('security/services/group-dto',['require','system/lang/converter','./user-dto','./role-dto'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.id=a.toString(b.id),this.key=a.toString(b.key)||"0",this.caption=a.toString(b.caption),this.description=a.toString(b.description),this.isActive=a.toBoolean(b.isActive),this.parentKey=a.toString(b.parentKey)||"0",this.lockSeq=a.toString(b.lockSeq)||"0",this.users=require("./user-dto").fromDataCollection(b.users),this.roles=require("./role-dto").fromDataCollection(b.roles)}return b.fromDataCollection=function a(c){if(void 0!==c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('security/services/usersite-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key)||"0",this.siteKey=a.toString(b.siteKey)||"0",this.userKey=a.toString(b.userKey)||"0",this.viewOnly=a.toBoolean(b.viewOnly)||!1,this.siteName=a.toString(b.siteName),this.userName=a.toString(b.userName),this.lockSeq=a.toString(b.lockSeq)||"0"}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('security/services/fmlypriv-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.userKey=a.toString(b.userKey),this.userDisplay=a.toString(b.userDisplay),this.groupKey=a.toString(b.groupKey),this.groupDisplay=a.toString(b.groupDisplay),this.familyKey=a.toString(b.familyKey),this.familyId=a.toString(b.familyId),this.familyDisplay=a.toString(b.familyDisplay),this.privilege=a.toInteger(b.privilege),this.ins=b.privilege===(b.privilege=1|b.privilege),this.vw=b.privilege===(b.privilege=2|b.privilege),this.upd=b.privilege===(b.privilege=4|b.privilege),this.del=b.privilege===(b.privilege=8|b.privilege),this.hash=this.ins+this.vw+this.upd+this.del,this.isDirty=!1,this.isDeleted=!1}return b.fromDataCollection=function a(c){if(void 0!==c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('security/services/user-dto',['require','./group-dto','./usersite-dto','./role-dto','./fmlypriv-dto','system/lang/converter'],function(require){"use strict";var a=require("./group-dto"),b=require("./usersite-dto"),c=require("./role-dto"),d=require("./fmlypriv-dto"),e=require("system/lang/converter");function f(f){f=f||{};var g=f.formats||{};this.key=e.toString(f.key),this.id=e.toString(f.id),this.lastName=e.toString(f.lastName),this.firstName=e.toString(f.firstName),this.initial=e.toString(f.initial),this.displayName=this.lastName+", "+this.firstName+" "+this.initial,this.fullDisplayName=this.lastName+", "+this.firstName+" ("+this.id+")",this.contentGuid=e.toString(f.contentGuid),this.cultureId=e.toString(f.cultureId),this.timezoneId=e.toString(f.timezoneId),this.ianaTimezoneId=e.toString(f.timezoneIanaId),this.defaultSiteKey=void 0===f.defaultSiteKey?"0":e.toString(f.defaultSiteKey),this.queryPrivilege=e.toString(f.queryPrivilege),this.isActive=e.toBoolean(f.isActive),this.isSuperUser=e.toBoolean(f.isSuperUser),this.isCatalogAdmin=e.toBoolean(f.isCatalogAdmin),
this.isConfigAdmin=e.toBoolean(f.isConfigAdmin),this.isPowerUser=e.toBoolean(f.isPowerUser),this.isSecurityAdmin=e.toBoolean(f.isSecurityAdmin),this.daysLeft=e.toString(f.daysLeft),this.address1=e.toString(f.address1),this.address2=e.toString(f.address2),this.areaOfResponsibility=e.toString(f.areaOfResponsibility),this.badgeId=e.toString(f.badgeId),this.businessUnit=e.toString(f.businessUnit),this.city=e.toString(f.city),this.comments=e.toString(f.comments),this.company=e.toString(f.company),this.country=e.toString(f.country),this.department=e.toString(f.department),this.domain=e.toString(f.domain),this.email=e.toString(f.email),this.facility=e.toString(f.facility),this.faxNumber=e.toString(f.faxNumber),this.siteCode=e.toString(f.siteCode),this.formats={longDate:g.longDate||"D",shortDate:g.shortDate||"d",longTime:g.longTime||"T",shortTime:g.shortTime||"t",dateTime:g.dateTime||"dt"},this.groups=a.fromDataCollection(f.groups),this.sites=b.fromDataCollection(f.sites),
this.roles=c.fromDataCollection(f.roles),this.privileges=d.fromDataCollection(f.privileges),this.newPassword=e.toString(f.newPassword),this.unhashedPassword=e.toString(f.unhashedPassword),this.password=e.toString(f.password),this.phoneNumber=e.toString(f.phoneNumber),this.phoneNumber2=e.toString(f.phoneNumber2),this.postalCode=e.toString(f.postalCode),this.state=e.toString(f.state),this.title=e.toString(f.title),this.uomConversionSetId=e.toString(f.uomConversionSetId),this.hasThumbnailPhoto=e.toBoolean(f.hasThumbnailPhoto),this.mustChangePassword=e.toBoolean(f.mustChangePassword),this.isLocked=e.toBoolean(f.isLocked),this.failedLogins=e.toString(f.failedLogins),this.userLockSeq=e.toString(f.userLockSeq),this.hrLockSeq=e.toString(f.hrLockSeq),this.isSelected=!1,this.isDirty=!1}return f.fromDataCollection=function a(b){if(b){var c,d=[];for(c=0;c<b.length;c++)d[d.length]=new f(b[c]);return d}},f});
define('state-management/services/dto/assignment-dto',['require','system/lang/converter','./state-dto','security/services/user-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./state-dto"),c=require("security/services/user-dto");function d(d){d=d||{},this.key=a.toString(d.key)||"0",this.state=new b(d.state),this.familyKey=a.toString(d.familyKey)||"0",this.entityKey=a.toString(d.entityKey)||"0",this.assignedUser=d.assignedUser?new c(d.assignedUser):null,this.eligibleUsers=c.fromDataCollection(d.eligibleUsers)}return d.fromDataCollection=function a(b){if(b){var c,e=[];for(c=0;c<b.length;c++)e[e.length]=new d(b[c]);return e}},d});
define('state-management/services/dto/operation-dto',['require','system/lang/converter','./state-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./state-dto");function c(c){c=c||{},this.key=a.toString(c.key)||"0",this.id=a.toString(c.id),this.caption=a.toString(c.caption),this.isReserved=a.toBoolean(c.isReserved),this.successorState=new b(c.successorState)}return c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}},c});
define('state-management/services/dto/transition-dto',['require','system/lang/converter','./state-dto','./operation-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./state-dto"),c=require("./operation-dto");function d(d){d=d||{},this.activeState=new b(d.activeState),this.entityKey=a.toString(d.entityKey)||"0",this.familyKey=a.toString(d.familyKey)||"0",this.operation=new c(d.operation),this.isEditable=a.toBoolean(d.isEditable),this.successors=c.fromDataCollection(d.successors)}return d});
define('state-management/services/dto/history-record-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key)||"0",this.entityKey=a.toString(b.entityKey)||"0",this.stateId=a.toString(b.stateId),this.stateCaption=a.toString(b.stateCaption),this.userId=a.toString(b.userId),this.dateEntered=a.toDate(b.dateEntered)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('state-management/services/state-management-service',['require','jquery','system/http/ajax-client','./dto/state-dto','./dto/assignment-dto','./dto/transition-dto','./dto/history-record-dto'],function(require){"use strict";var a=require("jquery"),b=require("system/http/ajax-client"),c=require("./dto/state-dto"),d=require("./dto/assignment-dto"),e=require("./dto/transition-dto"),f=require("./dto/history-record-dto"),g="api/core/state/";function h(a){this.ajaxClient=a}return h.dependsOn=[b],h.prototype.getAssignments=function b(c){var e=g+"assignments/"+c,f=a.Deferred();return this.ajaxClient.get(e,{}).done(function(b){var c=a.map(b,function(a){return new d(a)});f.resolve(c)}).fail(function(a){f.reject(a)}),f.promise()},h.prototype.putAssignments=function b(c,d){var e=a.Deferred(),f=g+"assignments/"+c;return this.ajaxClient.put(f,d).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},h.prototype.getHistoryRecords=function b(c){var d=g+"history/"+c,e=a.Deferred();return this.ajaxClient.get(d,{}).done(function(b){var c=a.map(b,function(a){return new f(a)});e.resolve(c)}).fail(function(a){e.reject(a)}),e.promise()},
h.prototype.getTransition=function b(c){var d=g+"transition/"+c,f=a.Deferred();return this.ajaxClient.get(d,{}).done(function(a){f.resolve(new e(a))}).fail(function(a){f.reject(a)}),f.promise()},h.prototype.postTransition=function b(c){var d=a.Deferred(),e=g+"transition/";return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},h});
define('state-management/model/state-model',['require','knockout'],function(require){"use strict";var a=require("knockout");function b(b){b=b||{},this.key=a.observable(b.key),this.id=a.observable(b.id),this.caption=a.observable(b.caption)}return b});
define('state-management/adapters/state-adapter',['require','../services/dto/state-dto','../model/state-model'],function(require){"use strict";var a=require("../services/dto/state-dto"),b=require("../model/state-model");function c(){}return c.toModelObject=function a(c){return new b(c)},c.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},c.toDTO=function b(c){var d=new a;return c=c||{},d.key=c.key(),d.id=c.id(),d.caption=c.caption(),d},c.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},c});
define('state-management/model/operation-model',['require','knockout','./state-model'],function(require){"use strict";var a=require("knockout"),b=require("./state-model");function c(c){c=c||{},this.key=a.observable(c.key),this.id=a.observable(c.id),this.caption=a.observable(c.caption),this.isReserved=a.observable(c.isReserved),this.isSelected=a.observable(!1),this.successorState=a.observable(new b(c.successorState))}return c.fromDataCollection=function a(b){var d,e=[];for(d=0;d<b.length;d++)e[d]=new c(b[d]);return e},c});
define('state-management/adapters/operation-adapter',['require','../services/dto/operation-dto','./state-adapter','../model/operation-model'],function(require){"use strict";var a=require("../services/dto/operation-dto"),b=require("./state-adapter"),c=require("../model/operation-model");function d(){}return d.toModelObject=function a(b){return new c(b)},d.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},d.toDTO=function c(d){var e=new a;return d=d||{},e.key=d.key(),e.id=d.id(),e.caption=d.caption(),e.isReserved=d.isReserved(),e.successorState=b.toDTO(d.successorState()),e},d.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},d});
define('state-management/model/transition-model',['require','knockout','../adapters/state-adapter','../adapters/operation-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/state-adapter"),c=require("../adapters/operation-adapter");function d(d){d=d||{},this.activeState=a.observable(b.toModelObject(d.activeState)),this.entityKey=a.observable(d.entityKey),this.familyKey=a.observable(d.familyKey),this.isEditable=a.observable(d.isEditable),this.operation=a.observable(c.toModelObject(d.operation)),this.successors=a.observableArray(c.toModelObjectArray(d.successors))}return d});
define('state-management/adapters/transition-adapter',['require','../services/dto/transition-dto','../model/transition-model','./operation-adapter','./state-adapter'],function(require){"use strict";var a=require("../services/dto/transition-dto"),b=require("../model/transition-model"),c=require("./operation-adapter"),d=require("./state-adapter");function e(){}return e.toModelObject=function a(c){return new b(c)},e.toDTO=function b(e){var f=new a;return e=e||{},f.activeState=d.toDTO(e.activeState()),f.familyKey=e.familyKey(),f.entityKey=e.entityKey(),f.operation=c.toDTO(e.operation()),f.successors=c.toDTOArray(e.successors()),f.isEditable=e.isEditable(),f},e});
define('security/model/user-model',['require','knockout','../services/role-dto','../services/usersite-dto','../services/group-dto'],function(require){"use strict";var a=require("knockout"),b=require("../services/role-dto"),c=require("../services/usersite-dto"),d=require("../services/group-dto");function e(e){var g=this;e=e||{},this.firstName=a.observable(e.firstName),this.id=a.observable(e.id),this.key=e.key,this.lastName=a.observable(e.lastName),this.contentGuid=a.observable(e.contentGuid),this.address1=a.observable(e.address1),this.address2=a.observable(e.address2),this.areaOfResponsibility=a.observable(e.areaOfResponsibility),this.badgeId=a.observable(e.badgeId),this.businessUnit=a.observable(e.businessUnit),this.city=a.observable(e.city),this.comments=a.observable(e.comments),this.company=a.observable(e.company),this.country=a.observable(e.country),this.cultureId=a.observable(e.cultureId),this.defaultSiteKey=a.observable(e.defaultSiteKey),this.department=a.observable(e.department),this.domain=a.observable(e.domain),this.email=a.observable(e.email),this.facility=a.observable(e.facility),
this.faxNumber=a.observable(e.faxNumber),this.firstName=a.observable(e.firstName),this.groups=a.observableArray(d.fromDataCollection(e.groups)),this.roles=a.observableArray(b.fromDataCollection(e.roles)),this.sites=a.observableArray(c.fromDataCollection(e.sites)),this.initial=a.observable(e.initial),this.isActive=a.observable(e.isActive),this.isLocked=a.observable(e.isLocked),this.isSuperUser=a.observable(e.isSuperUser),this.IsCatalogAdmin=a.observable(e.isCatalogAdmin),this.IsConfigAdmin=a.observable(e.isConfigAdmin),this.IsPowerUser=a.observable(e.isPowerUser),this.IsSecurityAdmin=a.observable(e.isSecurityAdmin),this.daysLeft=a.observable(e.daysLeft),this.newPassword=a.observable(e.newPassword),this.mustChangePassword=a.observable(e.mustChangePassword),this.password=a.observable(e.password),this.phoneNumber=a.observable(e.phoneNumber),this.phoneNumber2=a.observable(e.phoneNumber2),this.postalCode=a.observable(e.postalCode),this.queryPrivilege=a.observable(e.queryPrivilege),
this.siteCode=a.observable(e.siteCode),this.state=a.observable(e.state),this.timezoneId=a.observable(e.timezoneId),this.ianaTimezoneId=a.observable(e.ianaTimezoneId),this.title=a.observable(e.title),this.uomConversionSetId=a.observable(e.uomConversionSetId),this.hasThumbnailPhoto=a.observable(e.hasThumbnailPhoto),void 0===g.initial()?this.displayName=a.computed(function(){return g.lastName()+", "+g.firstName()}):this.displayName=a.computed(function(){return g.lastName()+", "+g.firstName()+" "+g.initial()}),this.fullDisplayName=a.computed(function(){return g.lastName()+", "+g.firstName()+" ("+g.id()+")"}),this.contentManagementDisplay=a.computed(function(){return g.firstName()+" "+g.lastName()+" "+g.email()}),this.v3DisplayName=a.computed(function(){return g.lastName()+", "+g.firstName()+" | "+g.id()}),this.userLockSeq=a.observable(e.userLockSeq),this.hrLockSeq=a.observable(e.hrLockSeq),this.isSelected=a.observable(!1),this.isDirty=a.observable(!1),
this.defaultSiteIsSet=a.observable(!1),this.isSuperUser.subscribe(f.bind(null,this))}function f(a){var b=0;a.isSuperUser()&&a.queryPrivilege("0")}return e});
define('security/adapters/user-adapter',['require','../services/user-dto','../model/user-model','mi-assert','system/lang/converter','../services/role-dto','../services/usersite-dto','../services/group-dto'],function(require){"use strict";var a=require("../services/user-dto"),b=require("../model/user-model"),c=require("mi-assert"),d=require("system/lang/converter"),e=require("../services/role-dto"),f=require("../services/usersite-dto"),g=require("../services/group-dto");function h(){}return h.serialize=function a(b){return{firstName:b.firstName,id:b.id,key:b.key,lastName:b.lastName,email:b.email,initial:b.initial}},h.serializeArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.serialize(b[c]));return d}},h.deserialize=function b(e){c.isObject(e,"data"),c.isString(e.key,"data.key"),c.isString(e.id,"data.id");var f=new a;return f.key=d.toString(e.key),f.id=d.toString(e.id),f.firstName=d.toString(e.firstName),f.lastName=d.toString(e.lastName),f.initial=d.toString(e.initial),f.email=d.toString(e.email),f},h.deserializeArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.deserialize(b[c]));return d}},
h.toModelObject=function a(c){return new b(c)},h.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},h.toDTO=function b(c){var d=new a;return c=c||{},d.firstName=c.firstName(),d.id=c.id(),d.key=c.key,d.lastName=c.lastName(),d.contentGuid=c.contentGuid(),d.address1=c.address1(),d.address2=c.address2(),d.areaOfResponsibility=c.areaOfResponsibility(),d.badgeId=c.badgeId(),d.businessUnit=c.businessUnit(),d.city=c.city(),d.comments=c.comments(),d.company=c.company(),d.country=c.country(),d.cultureId=c.cultureId(),d.defaultSiteKey=c.defaultSiteKey(),d.department=c.department(),d.domain=c.domain(),d.email=c.email(),d.facility=c.facility(),d.faxNumber=c.faxNumber(),d.firstName=c.firstName(),d.groups=g.fromDataCollection(c.groups()),d.roles=e.fromDataCollection(c.roles()),d.sites=f.fromDataCollection(c.sites()),d.mustChangePassword=c.mustChangePassword(),d.initial=c.initial(),d.isActive=c.isActive(),
d.isLocked=c.isLocked(),d.isSuperUser=c.isSuperUser(),d.newPassword=c.newPassword(),d.password=c.password(),d.phoneNumber=c.phoneNumber(),d.phoneNumber2=c.phoneNumber2(),d.postalCode=c.postalCode(),d.queryPrivilege=c.queryPrivilege(),d.siteCode=c.siteCode(),d.state=c.state(),d.timezoneId=c.timezoneId(),d.ianaTimezoneId=c.ianaTimezoneId(),d.title=c.title(),d.uomConversionSetId=c.uomConversionSetId(),d.hasThumbnailPhoto=c.hasThumbnailPhoto(),d.displayName=c.lastName()+", "+c.firstName()+" "+c.initial(),d.fullDisplayName=c.lastName()+", "+c.firstName()+" ("+c.id()+")",d.v3DisplayName=c.lastName()+", "+c.firstName()+" | "+c.id(),d.userLockSeq=c.userLockSeq(),d.hrLockSeq=c.hrLockSeq(),d.daysLeft=c.daysLeft(),d.isSelected=!1,d.isDirty=!1,d.daysLeft=c.daysLeft(),d},h.toDTOArray=function a(b){var c=0,d=[];if(b){if(0===b.length)return d;for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},h});
define('state-management/model/assignment-model',['require','knockout','./state-model','security/adapters/user-adapter','lodash'],function(require){"use strict";var a=require("knockout"),b=require("./state-model"),c=require("security/adapters/user-adapter"),d=require("lodash");function e(d){d=d||{},this.key=a.observable(d.key),this.state=a.observable(new b(d.state)),this.familyKey=a.observable(d.familyKey),this.entityKey=a.observable(d.entityKey),this.assignedUser=d.assignedUser?a.observable(c.toModelObject(d.assignedUser)):a.observable(),this.eligibleUsers=a.observableArray(c.toModelObjectArray(d.eligibleUsers)),this.assignableUsers=a.computed(f.bind(null,this)),this.assignedUserKey=this.assignedUser()?a.observable(this.assignedUser().key):a.observable(),this.assignedUserKey.subscribe(i.bind(null,this))}function f(a){var b=a.eligibleUsers().slice(0);if(a.assignedUser()){g(a.eligibleUsers(),a.assignedUser())||b.push(a.assignedUser())}return b}function g(a,b){return!!d.find(a,h.bind(null,b.key))}function h(a,b){return a===b.key}function i(a,b){var c=d.find(a.eligibleUsers(),h.bind(null,b))
;c&&a.assignedUser(c)}return e});
define('state-management/adapters/assignment-adapter',['require','../services/dto/assignment-dto','../model/assignment-model','./state-adapter','security/adapters/user-adapter'],function(require){"use strict";var a=require("../services/dto/assignment-dto"),b=require("../model/assignment-model"),c=require("./state-adapter"),d=require("security/adapters/user-adapter");function e(){}return e.toModelObject=function a(c){return new b(c)},e.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},e.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},e.toDTO=function b(e){var f=new a;return e=e||{},f.key=e.key(),f.state=c.toDTO(e.state()),f.familyKey=e.familyKey(),f.entityKey=e.entityKey(),f.assignedUser=e.assignedUser()?d.toDTO(e.assignedUser()):null,f.eligibleUsers=d.toDTOArray(e.eligibleUsers()),f},e});

define('text!state-management/views/state-assignment.html',[],function () { return '<div class="state-assignment">\r\n\r\n    <ul class="state-assignment-tabs nav nav-tabs">\r\n        <li data-bind="css: { active: isAssignmentActive }">\r\n            <a data-bind="click: showAssignments, text: translate(\'STATE_ASSIGNMENT\')"></a>\r\n        </li>\r\n        <li data-bind="css: { active: isHistoryActive }">\r\n            <a data-bind="click: showHistory, text: translate(\'STATE_HISTORY\')"></a>\r\n        </li>\r\n    </ul>\r\n\r\n    <div class="state-assignment-tab-content"\r\n         data-bind="visible: isAssignmentActive">\r\n        <table class="table table-bordered table-condensed table-striped">\r\n            <thead>\r\n                <tr>\r\n                    <td data-bind="text: translate(\'STATE\')"></td>\r\n                    <td data-bind="text: translate(\'ASSIGNEE\')"></td>\r\n                </tr>\r\n            </thead>\r\n            <tbody data-bind="foreach: assignments">\r\n                <tr>\r\n                    <td data-bind="text: state().caption" />\r\n                    <td>\r\n                        <div class="form-group">\r\n                            <!-- ko if: assignableUsers().length -->\r\n                            <mi-select class="form-control" data-bind="miproperty: {options: assignableUsers, optionsText: \'fullDisplayName\', value: assignedUserKey, optionsValue: \'key\', optionsCaption: \' \' }"></mi-select>\r\n                            <!-- /ko -->\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n\r\n    <div class="state-assignment-tab-content"\r\n         data-bind="visible: isHistoryActive">\r\n        <table class="table table-bordered table-condensed table-striped">\r\n            <thead>\r\n                <tr>\r\n                    <td>\r\n                        <a data-bind="click: sortHistory(\'state\'),\r\n                                      text: translate(\'STATE\')"></a>\r\n                        <i class="icon-arrow pull-right"\r\n                           data-bind="visible: historySortCriteria.orderBy() === \'state\',\r\n                                      css: { \'rotate-180\': !historySortCriteria.reverse() }"></i>    <!--font awesome fa-flip-vertical has been removed, needs to be verified-->\r\n                    </td>\r\n                    <td>\r\n                        <a data-bind="click: sortHistory(\'user\'),\r\n                                      text: translate(\'STATE_HIST_LAST_SET_BY\')"></a>\r\n                        <i class="icon-arrow pull-right"\r\n                           data-bind="visible: historySortCriteria.orderBy() === \'user\',\r\n                                      css: { \'rotate-180\': !historySortCriteria.reverse() }"></i>    <!--font awesome fa-flip-vertical has been removed, needs to be verified-->\r\n                    </td>\r\n                    <td>\r\n                        <a data-bind="click: sortHistory(\'dateEntered\'),\r\n                                      text: translate(\'STATE_HIST_LAST_SET_ON\')"></a>\r\n                        <i class="icon-arrow pull-right"\r\n                           data-bind="visible: historySortCriteria.orderBy() === \'dateEntered\',\r\n                                      css: { \'rotate-180\': !historySortCriteria.reverse() }"></i>    <!--font awesome fa-flip-vertical has been removed, needs to be verified-->\r\n                    </td>\r\n                </tr>\r\n            </thead>\r\n            <tbody data-bind="foreach: historyRecords">\r\n                <tr>\r\n                    <td data-bind="text: stateCaption" />\r\n                    <td data-bind="text: userId" />\r\n                    <td data-bind="text: dateEntered.toLocaleDateString() + \' \' + dateEntered.toLocaleTimeString()" />\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n\r\n</div>';});

define('state-management/state-assignment-view-model',['require','jquery','application/application-events','spa/ko/knockout-view-model','system/globalization/translator','knockout','system/knockout/knockout-manager','system/error/error-message','./services/state-management-service','./adapters/assignment-adapter','text!./views/state-assignment.html','system/lang/object'],function(require){"use strict";var a=require("jquery"),b=require("application/application-events"),c=require("spa/ko/knockout-view-model"),d=require("system/globalization/translator"),e=require("knockout"),f=require("system/knockout/knockout-manager"),g=require("system/error/error-message"),h=require("./services/state-management-service"),i=require("./adapters/assignment-adapter"),j=require("text!./views/state-assignment.html");require("system/lang/object");function k(a,b,c){l.call(this,j),this.kom=a,this.kom.tracker.hashFunction=s.bind(null,this),this.applicationEvents=b,this.translator=Object.resolve(d),this.service=c,this.region=null,this.historySortCriteria={orderBy:this.kom.observable("dateEntered"),reverse:this.kom.observable(!0)},this.assignments=null,this.entityKey=null,this.historyRecords=null,this.isAssignmentActive=null,this.isHistoryActive=null}var l=Object.inherit(c,k);k.dependsOn=[f,b,h],k.prototype.open=function a(){
this.applicationEvents.titleChanged.raise(this.translate("STATE_ASSIGNMENT"),this)},k.prototype.load=function b(c){var d=new a.Deferred,e,f;return this.assignments=this.kom.observableArray(),this.entityKey=c,this.historyRecords=this.kom.observableArray(),this.isAssignmentActive=this.kom.observable(!0),this.isHistoryActive=this.kom.observable(!1),e=this.service.getAssignments(this.entityKey).done(n.bind(null,this)).fail(r.bind(null,this)),f=this.service.getHistoryRecords(this.entityKey).done(o.bind(null,this)).fail(r.bind(null,this)),a.when(e,f).done(p.bind(null,this,d)),d.promise()},k.prototype.activate=function a(){},k.prototype.attach=function a(b){l.prototype.attach.call(this,b),this.region=b},k.prototype.detach=function a(b){l.prototype.detach.call(this,b)},k.prototype.canUnload=function a(){return!0},k.prototype.deactivate=function a(){this.kom.disposeSubscriptions(),this.kom.disposeComputeds()},k.prototype.unload=function a(){this.kom.disposeObservables()},
k.prototype.sortHistory=function a(b){this.historySortCriteria.orderBy()===b?this.historySortCriteria.reverse(!this.historySortCriteria.reverse()):this.historySortCriteria.orderBy(b),m(this)},k.prototype.translate=function(a){return this.translator.translate(a)},k.prototype.showAssignments=function a(){this.isAssignmentActive(!0),this.isHistoryActive(!1)},k.prototype.showHistory=function a(){this.isAssignmentActive(!1),this.isHistoryActive(!0)},k.prototype.save=function b(){var c=a.Deferred();if(this.assignments&&this.assignments())return this.service.putAssignments(this.entityKey,i.toDTOArray(this.assignments())).done(q.bind(null,this,c)).fail(r.bind(null,this)),c.promise()},k.prototype.isDirty=function a(){return this.kom.isDirty()};function m(a){var b=a.historySortCriteria.orderBy(),c=a.historySortCriteria.reverse();a.historyRecords.sort(function(a,d){var e=a;switch(a=c?d:a,d=c?e:d,b){case"state":return a.stateCaption===d.stateCaption?0:a.stateCaption<d.stateCaption?-1:1;case"user":
return a.userId===d.userId?0:a.userId<d.userId?-1:1;case"dateEntered":return a.dateEntered===d.dateEntered?0:a.dateEntered<d.dateEntered?-1:1;default:return}})}function n(a,b){var c=i.toModelObjectArray(b);a.assignments(c)}function o(a,b){a.historyRecords(b)}function p(a,b){a.kom.tracker.markCurrentStateAsClean(),b.resolve()}function q(a,b,c){b.resolve(c)}function r(a,b){var c=2,d=b.statusText,e=new g(c,d);a.applicationEvents.errorOccured.raise(a,e)}function s(a){var b=[],c=0,d;if(a.assignments&&a.assignments()){for(c=0;c!==a.assignments().length;c++)d=a.assignments()[c],b.push({assignmentKey:d.key(),assignedUserKey:d.assignedUser()?d.assignedUser().key:null});return JSON.stringify(b)}}return k});

define('text!state-management/views/state-assignment-dialog.html',[],function () { return '<div class="state-assignment-dialog block-group">\r\n    <div class="state-assignment-container">\r\n        &nbsp;\r\n    </div>\r\n    <div class="controls pull-right">\r\n        <button type="button"\r\n                class="btn btn-primary"\r\n                data-bind="enable: canClickDone,\r\n                           text: translate(\'DONE\'),\r\n                           click: done"></button>\r\n        <button type="button"\r\n                class="btn btn-default"\r\n                data-bind="click: cancel,\r\n                           text: translate(\'CANCEL\')"></button>\r\n    </div>\r\n</div>';});

define('state-management/state-assignment-dialog',['require','jquery','spa/ko/knockout-view-model','spa/region','system/lang/event','system/ui/busy-indicator','system/ui/dialog-view-model','./state-assignment-view-model','system/globalization/translator','system/knockout/knockout-manager','./adapters/assignment-adapter','text!./views/state-assignment-dialog.html','system/lang/string','system/lang/object'],function(require){"use strict";var a=require("jquery"),b=require("spa/ko/knockout-view-model"),c=require("spa/region"),d=require("system/lang/event"),e=require("system/ui/busy-indicator"),f=require("system/ui/dialog-view-model"),g=require("./state-assignment-view-model"),h=require("system/globalization/translator"),i=require("system/knockout/knockout-manager"),j=require("./adapters/assignment-adapter"),k=require("text!./views/state-assignment-dialog.html");require("system/lang/string"),require("system/lang/object");function l(a,b,c){var g,j;m.call(this,k),this.stateAssignmentRegion=a,this.stateAssignmentViewModel=b,this.busyIndicator=Object.resolve(e),this.translator=Object.resolve(h),this.kom=Object.resolve(i),this.cancelEvent=new d,j=this.translator.translate("STATE_ASSIGNMENT"),g={height:"50%",width:"50%"},this.dialog=Object.resolve(f,this,j,g),this.title=this.dialog.title,this.requestedEntityKey=null,this.canClickDone=null,this.dfd=null}var m=Object.inherit(b,l)
;l.dependsOn=[c,g],l.prototype.show=function b(c,d){return this.requestedEntityKey=c,this.title=d||this.title,this.dialog.show(),this.dfd=a.Deferred(),this.busyIndicator.attachTo(document.querySelector(".dialog-wrapper .state-assignment-dialog .state-assignment-container")),this.dfd.promise()},l.prototype.open=function a(){},l.prototype.load=function b(){var c=new a.Deferred;return this.stateAssignmentViewModel.load(this.requestedEntityKey),this.canClickDone=this.kom.computed(n.bind(null,this)),c.promise()},l.prototype.activate=function a(){this.stateAssignmentViewModel.activate()},l.prototype.attach=function a(b){m.prototype.attach.call(this,b),this.region=b,this.stateAssignmentRegion.setElement(this.region.$element.find("div.state-assignment-container").get(0)),this.stateAssignmentViewModel.attach(this.stateAssignmentRegion)},l.prototype.detach=function a(b){this.stateAssignmentViewModel.detach(this.stateAssignmentRegion),this.stateAssignmentRegion.clear(),
m.prototype.detach.call(this,b)},l.prototype.canUnload=function a(){return this.stateAssignmentViewModel.canUnload()},l.prototype.deactivate=function a(){this.stateAssignmentViewModel.deactivate(this.stateAssignmentRegion)},l.prototype.unload=function a(){this.stateAssignmentViewModel.unload()},l.prototype.translate=function(a){return this.translator.translate(a)},l.prototype.done=function a(){this.busyIndicator.show(),this.stateAssignmentViewModel.save().done(o.bind(null,this))},l.prototype.cancel=function a(){this.busyIndicator.detach(),this.cancelEvent.raise(),this.dialog.closeDialog()};function n(a){return a.stateAssignmentViewModel.isDirty()}function o(a){var b;a.busyIndicator.hide(),a.busyIndicator.detach(),a&&a.stateAssignmentViewModel&&a.stateAssignmentViewModel.assignments&&a.stateAssignmentViewModel.assignments()&&(b=a.stateAssignmentViewModel.assignments(),a.dfd.resolve(j.toDTOArray(b)),a.dialog.closeDialog())}return l});

define('text!ui/elements/state-transition/popover-content.html',[],function () { return '<div class="state-transition">\r\n    <div class="form-group">\r\n        <!-- ko if: canDisplaySuccessors -->\r\n        <!--<label data-bind="text: translate(\'STATE_CHOOSE_OPERATION\')"></label>-->\r\n        <ul class="successors-list list-group"\r\n            data-bind="foreach: availableSuccessors,\r\n                       click: selectOperation">\r\n            <li class="list-group-item"\r\n                data-bind="text:caption,\r\n                            css: { active: isSelected }">\r\n            </li>\r\n        </ul>\r\n        <!-- /ko -->\r\n        <!-- ko ifnot: canDisplaySuccessors -->\r\n        <label data-bind="text: translate(\'STATE_NO_SUCCESSORS\')"></label>\r\n        <!-- /ko -->\r\n    </div>\r\n</div>\r\n<div class="state-assignment block-group">\r\n    <!-- ko if: successorAssignment -->\r\n    <div class="form-group">\r\n        <select data-bind="options: successorAssignment().eligibleUsers,\r\n                           optionsText: \'displayName\',\r\n                           optionsCaption: \'Assignee\'"></select>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko ifnot: hideAssignments -->\r\n    <div class="assignment-dialog-link block">\r\n        <a data-bind="click: showAssignmentsDialog,\r\n                      text: translate(\'STATE_MGT_SHOW_ASSIGN_DLG\')">\r\n        </a>\r\n    </div>\r\n    <!-- /ko -->\r\n\r\n    <div class="done-control block">\r\n        <button type="button"\r\n                class="btn btn-text"\r\n                data-bind="text: translate(\'DONE\'),\r\n                           enable: canClickDone,\r\n                           click: done"></button>\r\n    </div>\r\n</div>\r\n';});

define('ui/elements/state-transition/popover-content-view-model',['require','lodash','knockout','system/lang/event','spa/ko/knockout-view-model','system/knockout/knockout-manager','system/globalization/translator','state-management/state-assignment-dialog','state-management/adapters/operation-adapter','state-management/model/operation-model','text!./popover-content.html','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("knockout"),c=require("system/lang/event"),d=require("spa/ko/knockout-view-model"),e=require("system/knockout/knockout-manager"),f=require("system/globalization/translator"),g=require("state-management/state-assignment-dialog"),h=require("state-management/adapters/operation-adapter"),i=require("state-management/model/operation-model"),j=require("text!./popover-content.html");require("system/lang/object");function k(){l.call(this,j),this.kom=Object.resolve(e),this.translator=Object.resolve(f),this.stateAssignmentDialog=Object.resolve(g),this.transition=null,this.assignments=null,this.entityKey=null,this.disableTransition=null,this.hideAssignments=null,this.hiddenOperations=null,this.hideReservedOperations=null,this.canDisplaySuccessors=null,this.selectedSuccessor=null,this.successorAssignment=null,this.canClickDone=null,this.availableSuccessors=null,this.doneEvent=new c,this.closeEvent=new c,
this.assignmentsChanged=new c,this.region=null}var l=Object.inherit(d,k);k.prototype.activate=function(){this.canDisplaySuccessors=this.kom.pureComputed(o.bind(null,this)),this.selectedSuccessor=this.kom.pureComputed(m.bind(null,this)),this.successorAssignment=this.kom.pureComputed(r.bind(null,this)),this.canClickDone=this.kom.pureComputed(t.bind(null,this)),this.availableSuccessors=this.kom.pureComputed(p.bind(null,this))},k.prototype.attach=function(a){this.region=a,l.prototype.attach.apply(this,arguments)},k.prototype.deactivate=function(){this.kom.dispose()},k.prototype.detach=function(){l.prototype.detach.apply(this,arguments)},k.prototype.selectOperation=function a(c,d){var e=b.dataFor(d.target);this.disableTransition&&this.disableTransition()||e instanceof i&&(this.selectedSuccessor&&this.selectedSuccessor()&&this.selectedSuccessor().isSelected(!1),e.isSelected(!0))},k.prototype.showAssignmentsDialog=function(){
this.hideAssignments&&this.hideAssignments()||this.entityKey&&this.entityKey()&&(this.stateAssignmentDialog.show(this.entityKey()).done(this.assignmentsChanged.raise.bind(this.assignmentsChanged)),this.closeEvent.raise())},k.prototype.done=function(){this.disableTransition&&this.disableTransition()||this.selectedSuccessor&&this.selectedSuccessor()&&this.doneEvent.raise(h.toDTO(this.selectedSuccessor()))},k.prototype.translate=function(a){return this.translator.translate(a)};function m(b){if(b.transition&&b.transition()&&b.transition().successors&&b.transition().successors()&&b.transition().successors().length)return a.find(b.transition().successors(),n)}function n(a){return a.isSelected()}function o(a){return a.transition&&a.transition()&&a.transition().successors&&a.transition().successors()&&a.transition().successors().length}function p(b){if(b.canDisplaySuccessors())return a.filter(b.transition().successors(),q.bind(null,b.hiddenOperations(),b.hideReservedOperations()))}
function q(b,c,d){var e=c&&d.isReserved(),f=a.includes(b,d.id());return!(e||f)}function r(b){if(b.assignments&&b.assignments()&&b.selectedSuccessor&&b.selectedSuccessor())return a.find(b.assignments(),s.bind(null,b))}function s(a,b){return a.selectedSuccessor().key()===b.state().key()}function t(a){return(!a.disableTransition||!a.disableTransition())&&!(!a.selectedSuccessor||!a.selectedSuccessor())}return k});

define('text!ui/elements/state-transition/view.html',[],function () { return '<section class="mi-state-trans-container">\r\n    <button type="button"\r\n            class="btn mi-state-trans"\r\n            data-bind="disable: isReadOnly, click: togglePopover">\r\n        <span class="active-state"\r\n              data-bind="text: activeState"></span>\r\n        <i class="icon-arrow pull-right"></i>\r\n        <br />\r\n        <!-- ko if: assignmentOverride -->\r\n            <span class="assigned-user"\r\n                  data-bind="text: assignmentOverride"></span>\r\n        <!-- /ko -->\r\n        <!-- ko ifnot: assignmentOverride -->\r\n            <!-- ko if: activeAssignmentUser -->\r\n            <span class="assigned-user"\r\n                  data-bind="text: activeAssignmentUser"></span>\r\n            <!-- /ko -->\r\n            <!-- ko ifnot: activeAssignmentUser -->\r\n            <span class="assigned-user no-assignment"\r\n                  data-bind="text: translate(\'NOT_ASSIGNED\')">\r\n            </span>\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n    </button>\r\n</section>';});

define('ui/elements/state-transition/view-model',['require','lodash','jquery','spa/ko/knockout-view-model','system/knockout/knockout-manager','application/application-events','system/error/error-message','system/globalization/translator','spa/region','spa/conductor','system/lang/event','state-management/services/state-management-service','state-management/adapters/transition-adapter','state-management/adapters/assignment-adapter','state-management/adapters/operation-adapter','./popover-content-view-model','text!./view.html','bluebird','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("spa/ko/knockout-view-model"),d=require("system/knockout/knockout-manager"),e=require("application/application-events"),f=require("system/error/error-message"),g=require("system/globalization/translator"),h=require("spa/region"),i=require("spa/conductor"),j=require("system/lang/event"),k=require("state-management/services/state-management-service"),l=require("state-management/adapters/transition-adapter"),m=require("state-management/adapters/assignment-adapter"),n=require("state-management/adapters/operation-adapter"),o=require("./popover-content-view-model"),p=require("text!./view.html"),q=require("bluebird");require("system/lang/object");function r(){s.call(this,p),this.kom=Object.resolve(d),this.appEvents=Object.resolve(e),this.translator=Object.resolve(g),this.popoverContentRegion=Object.resolve(h),this.popoverContentViewModel=Object.resolve(o),this.conductor=Object.resolve(i),
this.service=Object.resolve(k),this.kom.tracker.hashFunction=S.bind(null,this),this.isDirty=this.kom.tracker.isDirty,this.entityKey=this.kom.observable(),this.assignmentOverride=this.kom.observable(),this.disable=this.kom.observable(!1),this.disableTransition=this.kom.observable(!1),this.hideAssignments=this.kom.observable(!1),this.hiddenOperations=this.kom.observableArray(),this.transition=this.kom.observable(),this.assignments=this.kom.observableArray(),this.hideReservedOperations=this.kom.observable(!1),this.popoverContentViewModel.transition=this.transition,this.popoverContentViewModel.assignments=this.assignments,this.popoverContentViewModel.entityKey=this.entityKey,this.popoverContentViewModel.disableTransition=this.disableTransition,this.popoverContentViewModel.hideAssignments=this.hideAssignments,this.popoverContentViewModel.hiddenOperations=this.hiddenOperations,this.popoverContentViewModel.hideReservedOperations=this.hideReservedOperations,
this.popoverContentViewModel.doneEvent.add(z.bind(null,this),this),this.popoverContentViewModel.closeEvent.add(D.bind(null,this),this),this.popoverContentViewModel.assignmentsChanged.add(C.bind(null,this),this),this.isLoading=this.kom.observable(!0),this.activeAssignment=this.kom.pureComputed(E.bind(null,this)),this.activeState=this.kom.pureComputed(G.bind(null,this)),this.activeAssignmentUser=this.kom.pureComputed(H.bind(null,this)),this.isReadOnly=this.kom.pureComputed(I.bind(null,this)),this.kom.subscribe(this.entityKey,J.bind(null,this)),this.$popoverTarget=null,this.region=null,this.popoverContainer=null,this.beforeStateChanged=new j,this.stateChanged=new j}var s=Object.inherit(c,r);r.prototype.attach=function(a){this.region=a,s.prototype.attach.apply(this,arguments),Element.upgrade("mi-state-transition",this.region)},r.prototype.detach=function(){y(this,this.$popoverTarget),this.popoverContainer&&(this.popoverContainer.detach(),this.popoverContainer=null),
this.popoverContentViewModel.doneEvent.remove(),this.kom.dispose()},r.prototype.showPopover=function(a,c){var d=b(c.target);c.stopPropagation(),d=d.is("button")?d:d.parent("button"),v(this,d)},r.prototype.hidePopover=function(a,c){if(!c)return void w(this,this.$popoverTarget);var d=b(c.target);d=d.is("button")?d:d.parent("button"),w(this,d)},r.prototype.togglePopover=function(a,c){var d=b(c.target),e;this.isLoading()||(d=d.is("button")?d:d.parent("button"),e=d.data("bs.popover"),e&&e.$tip&&e.$tip.hasClass("in")?this.hidePopover(e,c):this.showPopover(e,c))},r.prototype.translate=function(a){return this.translator.translate(a)};function t(a){a.$popoverTarget&&w(a,a.$popoverTarget)}function u(a){a.stopPropagation()}function v(a,c){var d=Element.build("div",a.region.$element.get(0),["state-popover-content"],{"data-bind":"halt-bindings: {}"});a.popoverContentRegion.setElement(d),a.conductor.changeScreen(a.popoverContentViewModel,a.popoverContentRegion),
b(document).on("click.stateTransitionPopover.hide",t.bind(null,a)),b(d).on("click",u),c.data("bs.popover")||c.popover({template:'<div class="mi-state popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',placement:"bottom",trigger:"manual",container:"body",html:!0,content:d}),c.popover("show"),a.$popoverTarget=c,c.data("bs.popover")&&(a.popoverContainer=c.data("bs.popover").$tip)}function w(a,b){b&&b.data("bs.popover")&&y(a,b)}function x(a,c){b(document).off("click.stateTransitionPopover.hide"),c.popover().off("hidden.bs.popover"),c.popover("destroy"),a.conductor.clearScreen(a.popoverContentRegion),a.$popoverTarget=null}function y(a,b){b&&(b.popover().on("hidden.bs.popover",x.bind(null,a,b)),b.popover("hide"))}function z(a,b){var c=n.toModelObject(b),d;w(a,a.$popoverTarget),a.transition().operation(c),d={transitionData:l.toDTO(a.transition()),cancel:!1,promise:null},a.beforeStateChanged.raise(d),
d.cancel||q.resolve(d.promise).then(B.bind(null,a)).catch(A)}function A(){}function B(a){a.isLoading(!0),a.service.postTransition(l.toDTO(a.transition())).done(N.bind(null,a)).fail(Q.bind(null,a))}function C(a){var b=a.transition().entityKey();a.service.getAssignments(b).done(L.bind(null,a)).fail(Q.bind(null,a))}function D(a){w(a,a.$popoverTarget)}function E(b){if(b.assignments&&b.assignments()&&b.transition&&b.transition()&&b.transition().activeState&&b.transition().activeState())return a.find(b.assignments(),F.bind(null,b))}function F(a,b){return a.transition().activeState().key()===b.state().key()}function G(a){if(a.transition&&a.transition()&&a.transition().activeState&&a.transition().activeState()&&a.transition().activeState().caption&&a.transition().activeState().caption())return a.transition().activeState().caption()}function H(a){
if(a.activeAssignment&&a.activeAssignment()&&a.activeAssignment().assignedUser&&a.activeAssignment().assignedUser())return a.activeAssignment().assignedUser().displayName()}function I(a){var b=a.disable(),c=a.transition()&&a.transition().isEditable();return b||!c}function J(a,b){K(a,b)}function K(a,c){var d,e;c&&(a.isLoading(!0),d=a.service.getTransition(c).done(M.bind(null,a)).fail(Q.bind(null,a)),e=a.service.getAssignments(c).done(L.bind(null,a)).fail(Q.bind(null,a)),b.when(d,e).done(P.bind(null,a)))}function L(a,b){var c=m.toModelObjectArray(b);a.assignments(c),a.kom.tracker.markCurrentStateAsClean()}function M(a,b){a.transition(l.toModelObject(b))}function N(a){var c=a.service.getTransition(a.entityKey()).done(M.bind(null,a)).fail(Q.bind(null,a));b.when(c).done(O.bind(null,a))}function O(a,b){var c={transitionData:b};a.stateChanged.raise(c),P(a)}function P(a){a.isLoading(!1)}function Q(a,b){R(a,b.responseText),P(a)}function R(a,b){var c=2,d=b,e=new f(c,d)
;a.appEvents.errorOccured.raise(a,e)}function S(a){var b={};if(a.selectedSuccessor&&a.selectedSuccessor())return b.selectedSuccessor=a.selectedSuccessor().key(),JSON.stringify(b)}return r});
define('ui/elements/state-transition/component',['require','spa/region','spa/conductor','./view-model','system/lang/object'],function(require){"use strict";var a=require("spa/region"),b=require("spa/conductor"),c=require("./view-model"),d={};require("system/lang/object"),d.prototype=Object.create(HTMLElement.prototype),d.prototype.createdCallback=function(){var d,e,f,g,h,i,j;this.attached=!1,this.conductor=Object.resolve(b),this.region=new a,this.viewModel=Object.resolve(c),d=Element.stringAttribute(this,"entitykey"),Element.defineProperty(this,"entitykey",{get:this.viewModel.entityKey,set:this.viewModel.entityKey}),d&&(this.entitykey=d),j=Element.stringAttribute(this,"assignmentoverride"),Element.defineProperty(this,"assignmentoverride",{get:this.viewModel.assignmentOverride,set:this.viewModel.assignmentOverride}),j&&(this.assignmentoverride=j),e=Element.booleanAttribute(this,"disable"),Element.defineProperty(this,"disable",{get:this.viewModel.disable,set:this.viewModel.disable}),e&&(this.disable=e),f=Element.booleanAttribute(this,"disabletransition"),Element.defineProperty(this,"disabletransition",{
get:this.viewModel.disableTransition,set:this.viewModel.disableTransition}),f&&(this.disabletransition=f),g=Element.booleanAttribute(this,"hideassignments"),Element.defineProperty(this,"hideassignments",{get:this.viewModel.hideAssignments,set:this.viewModel.hideAssignments}),g&&(this.hideassignments=g),i=Element.booleanAttribute(this,"hidereservedops"),Element.defineProperty(this,"hidereservedops",{get:this.viewModel.hideReservedOperations,set:this.viewModel.hideReservedOperations}),i&&(this.hidereservedops=i),h=Element.stringAttribute(this,"hiddenops"),Element.defineProperty(this,"hiddenops",{get:this.getHiddenOps,set:this.setHiddenOps}),h&&(this.hiddenops=h)},d.prototype.attachedCallback=function(){this.attached=!0,Element.clearDom(this);var a=Element.build("section",this,["fill"],{"data-bind":"halt-bindings: {}"});this.region.setElement(a),this.conductor.changeScreen(this.viewModel,this.region),this.viewModel.beforeStateChanged.add(this.beforeStateChanged,this),
this.viewModel.stateChanged.add(this.stateChanged,this)},d.prototype.hideStatePopup=function(){this.viewModel.hidePopover(this)},d.prototype.detachedCallback=function(){this.attached=!1,this.conductor.clearScreen(this.region),this.viewModel.beforeStateChanged.remove(this),this.viewModel.stateChanged.remove(this)},d.prototype.beforeStateChanged=function(a){Element.raiseEvent(this,"beforeStateChanged",a)},d.prototype.stateChanged=function(a){Element.raiseEvent(this,"stateChanged",a)},d.prototype.attributeChangedCallback=function(a,b,c){Object.tryMethod(this,a+"Changed",b,c)},d.prototype.entitykeyChanged=function(a,b){this.entitykey=b},d.prototype.assignmentoverrideChanged=function(a,b){this.assignmentoverride=b},d.prototype.disableChanged=function(a,b){this.disable=null!==b},d.prototype.disabletransitionChanged=function(a,b){this.disabletransition=null!==b},d.prototype.hideassignmentsChanged=function(a,b){this.hideassignments=null!==b},d.prototype.hidereservedopsChanged=function(a,b){
this.hidereservedops=null!==b},d.prototype.hiddenopsChanged=function(a,b){this.hiddenops=b},d.prototype.getHiddenOps=function(){return JSON.stringify(this.viewModel.hiddenOperations())},d.prototype.setHiddenOps=function(a){var b;a=a||"[]",b=e(a)?JSON.parse(a):f(a),this.viewModel.hiddenOperations(b)};function e(a){try{return JSON.parse(a),!0}catch(a){return!1}}function f(a){var b=a.split(","),c=0;for(c=0;c<b.length;c++)b[c]=b[c].trim();return b}return Element.registerElement("mi-state-transition",{prototype:d.prototype}),d});

define('text!ui/elements/ref-doc/views/refdoc-container.html',[],function () { return '<div class="refdoc-container">\r\n    <mi-resultgrid allowcolumnresizing=true\r\n                   allowcolumnreordering=true\r\n                   selectionmode=\'multiple\'\r\n                   showgroupingpanel=false\r\n                   showrowfilter=true>\r\n    </mi-resultgrid>\r\n</div>\r\n';});

define('ui/elements/ref-doc/models/path-validator',['require','system/lang/object'],function(require){"use strict";require("system/lang/object");function a(){}return a.prototype.isValidUrl=function a(b){var c=/^http:\/\//,d=/^https:\/\//;return null!==b&&void 0!==b&&""!==b&&0!==b.length&&!(!c.test(b)&&!d.test(b))},a.prototype.isValidUncPath=function a(b){var c=/^\\\\/;if(null===b||void 0===b||""===b||0===b.length)return!1;if(""===b||0===b.length||b.length>32767)return!1;if(c.test(b)){var d=b.replace(/^(\\\\)/,"");if(0===d.length)return!1;if(/[. \\]$/.test(d))return!1;var e=d.split("\\");if(0===e.length)return!1;var f=e[0],g=/[<>:"\/|?*]/;if(g.test(f))return!1;e.splice(0,1);for(var h=0;h<e.length;h++){var i=e[h];if(g.test(i))return!1}return!0}return!1},a});
define('ui/elements/ref-doc/models/refdoc-model',['require','knockout'],function(require){"use strict";var a=require("knockout");function b(a){a=a||{},this.name=a.name,this.desc=a.desc,this.addedBy=a.addedBy||"-",this.addedOn=a.addedOn||"-"}return b});
define('ui/elements/ref-doc/models/refdoc-collection',['require','lodash','knockout','./path-validator','./refdoc-model'],function(require){"use strict";var a=require("lodash"),b=require("knockout"),c=require("./path-validator"),d=require("./refdoc-model");function e(){this.validator=Object.resolve(c),this.refdocs=[]}e.prototype.populate=function(a){var b,c,d,e,h,i,j,k,l,m,n;for(this.refdocs=[],b=0;b<a.length;b++)c=f(a[b].fields,"CTIT_ID"),d=f(a[b].fields,"CTIT_DESC_TX"),e=f(a[b].fields,"MI_REF_DOCUMENTS_STORE_BY_C"),h=f(a[b].fields,"MI_REF_DOCUMENTS_LAST_UPDAT_DATE_D"),j=f(a[b].fields,"MI_REF_DOCUMENTS_STORE_DOCUM_L"),l=f(a[b].fields,"MIRD_DOC_PATH_CHR"),n=!!this.validator.isValidUrl(l.value),m=!!this.validator.isValidUncPath(l.value),l=g(l.value),i=a[b].key,k=j.value===!0||"True"===j.value||"true"===j.value,this.refdocs.push({key:i,name:c.value||"-",desc:d.value||"-",addedBy:e.value||"-",addedOn:h.displayValue||"-",isStoredDocument:k,docType:l,isURL:n,isUncPath:m})};function f(b,c){return a.find(b,function(a){return a.id===c})}function g(a){var b=a.split(".");return b[b.length-1]}return e});

define('text!ui/elements/checkbox/template.html',[],function () { return '<div class="checkbox-noko-container">\r\n    <input type="checkbox" />\r\n    <label class="">\r\n        <span class="checkbox-label"></span>\r\n        <span class="chkbox-text"></span>\r\n    </label>\r\n   \r\n</div>';});

define('ui/elements/checkbox/view-model',['require','jquery','text!./template.html','knockout'],function(require){"use strict";var a=require("jquery"),b=require("text!./template.html"),c=require("knockout"),d=Object.create(HTMLElement.prototype);d.createdCallback=function(){this.implementation=Object.resolve(e),this.implementation.element=this,this.implementation.$element=a(this),Object.tryMethod(this.implementation,"created")},d.attachedCallback=function(){Object.tryMethod(this.implementation,"attached")},d.detachedCallback=function(){Object.tryMethod(this.implementation,"detached")},d.attributeChangedCallback=function(a,b,c){Object.tryMethod(this.implementation,a+"Changed",b,c)};function e(){this.element=null,this.$element=null,this.$input=null,this.$container=b,this.inputChangeHandler=f.bind(null,this),this.init={}}e.prototype.created=function b(){var c=this;this.Node=document.createElement("div"),a(this.Node).append(),a(this.element).empty().append(this.$container),this.$input=this.$element.find('input[type="checkbox"]'),this.$label=this.$element.find("label")
;var d=this.getGuid();this.$input.attr("id",d),this.$label.attr("for",d),this.setAccessor("text",g.bind(this,this,"text")),this.setAccessor("checked",g.bind(this,this,"checked")),this.setAccessor("disabled",g.bind(this,this,"disabled")),this.setAccessor("value",g.bind(this,this,"value")),this.setAccessor("name",g.bind(this,this,"name"))},e.prototype.attached=function a(){this.$input.on("change",this.inputChangeHandler)},e.prototype.detached=function a(){this.$input.off("change",this.inputChangeHandler)};function f(a,b){a.$element.parents("mi-widget").length&&b.stopPropagation(),a.checked(b.currentTarget.checked),a.$element.trigger("checkedChange",[b.currentTarget.checked,a.value()])}function g(a,b,c){return"text"===b?void a.$element.find(".chkbox-text").html(c):"checked"===b?void(a.$input.get(0).checked="checked"===c||h(c)):"disabled"===b?void a.$input.prop("disabled",h(c)):void(a.$input&&a.$input.prop(b,c))}function h(a){return"false"!==a&&a!==!1&&("true"===a||a===!0)}
e.prototype.setAccessor=function(a,b){this[a]=c.observable(),Object.defineProperty(this.element,a,{get:i.bind(this,this,a),set:j.bind(this,this,a)}),this[a+"Changed"]=k.bind(this,this,a),this[a].subscribe(l.bind(this,this,b)),this[a](this.element.getAttribute(a))};function i(a,b){return a[b]()}function j(a,b,c){a[b](c)}function k(a,b,c,d){a[b](d)}function l(a,b,c){b&&b.call(a,c)}return e.prototype.getGuid=function a(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},e.prototype.s4=function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},Element.registerElement("mi-checkbox-noko",{prototype:d}),e});

define('text!ui/elements/radio/template.html',[],function () { return '<div class="radio-noko-container">\r\n    <input type="radio" tabindex="0" />\r\n    <label class="">\r\n        <span class="radio-label"></span>\r\n        <span class="radio-text"></span>\r\n    </label>\r\n\r\n</div>';});

define('ui/elements/radio/view-model',['require','jquery','text!./template.html','knockout'],function(require){"use strict";var a=require("jquery"),b=require("text!./template.html"),c=require("knockout"),d=Object.create(HTMLElement.prototype);d.createdCallback=function(){this.implementation=Object.resolve(e),this.implementation.element=this,this.implementation.$element=a(this),Object.tryMethod(this.implementation,"created")},d.attachedCallback=function(){Object.tryMethod(this.implementation,"attached")},d.detachedCallback=function(){Object.tryMethod(this.implementation,"detached")},d.attributeChangedCallback=function(a,b,c){Object.tryMethod(this.implementation,a+"Changed",b,c)};function e(){this.element=null,this.$element=null,this.$input=null,this.$container=b,this.init={}}e.prototype.created=function(){var b=this;this.Node=document.createElement("div"),a(this.Node).append(this.$container),a(this.element).html(this.Node),this.$input=this.$element.find('input[type="radio"]'),this.$label=this.$element.find("label");var c=this.getGuid();this.$input.attr("id",c),
this.$label.attr("for",c),this.$input.on("change",function(a){b.checked(a.currentTarget.checked),b.$element.trigger("checkedChange",[a.currentTarget.checked,b.value(),b.name()])}),this.setAccessor("text",f.bind(this,this,"text")),this.setAccessor("checked",f.bind(this,this,"checked")),this.setAccessor("value",f.bind(this,this,"value")),this.setAccessor("name",f.bind(this,this,"name"))};function f(a,b,c){return a.init[b]&&"null"!==c?"text"===b?void a.$element.find(".radio-text").html(c):"checked"===b?void(a.$input.get(0).checked=g(c)):"disabled"===b?void a.$input.prop("disabled",g(c)):void(a.$input&&a.$input.prop(b,c)):void(a.init[b]=!0)}function g(a){if(!a)return!1;var b=a.toString();return"false"!==b&&"true"===b}return e.prototype.setAccessor=function(a,b){this[a]=c.observable(),this[a+"_canSet"]=!0,Object.defineProperty(this.element,a,{get:function(){return this[a]()}.bind(this),set:function(b){this[a+"_canSet"]=!1,this[a](b),this.element.setAttribute(a,b)}.bind(this)}),
this[a+"Changed"]=function(b,c){this[a+"_canSet"]=!1,this[a](c),this.element[a]=c}.bind(this),this[a].subscribe(function(c){b&&b.call(this,c),this.element.setAttribute(a,c),this.element[a]=c}.bind(this)),this[a](this.element.getAttribute(a)),b&&b.call(this,this.element.getAttribute(a))},e.prototype.attached=function(){},e.prototype.getGuid=function a(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},e.prototype.s4=function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},Element.registerElement("mi-radio-noko",{prototype:d}),e});
define('search/ui-utils',['require','system/globalization/translator','ui/elements/checkbox/view-model','ui/elements/radio/view-model'],function(require){"use strict";var a=require("system/globalization/translator");require("ui/elements/checkbox/view-model"),require("ui/elements/radio/view-model");function b(){}function c(a,b,c){a[a.length]={value:b,description:c}}return b.loadSelect=function(a,b,d,e,f){var g,h=[];for(a.implementation.optionsText("description"),a.implementation.optionsValue("value"),""!==d&&a.implementation.optionsCaption(d),f.length>1&&c(h,"",b),g=0;g<f.length;g++)c(h,f[g].key,f[g].caption);a.implementation.options(h),e&&(a.implementation.value(e),""===a.implementation.value()&&a.implementation.value(h[0].value))},b.relatedEntities=function(a){var b,c,d;for(d=document.createElement("span"),d.className="relationship-links",b=0;b<a.relatedEntities.length;b++)c=document.createElement("a"),c.setAttribute("href",a.relatedEntities[b].url),c.appendChild(document.createTextNode(a.relatedEntities[b].title)),d.appendChild(c);return d},b.associatedActions=function(a){var b,c,d
;for(d=document.createElement("div"),d.className="associated-actions",b=0;b<a.searchActions.length;b++)c=document.createElement("a"),c.setAttribute("href",a.searchActions[b].url),c.appendChild(document.createTextNode(a.searchActions[b].title)),c.className="btn btn-default",c.target="tab",d.appendChild(c);return d},b.familyElement=function(a){var b=document.createElement("span");return b.classList.add("list-group-item-text"),b.appendChild(document.createTextNode(a.familyCaption||a.catalogPath||a.className)),b},b.setRecordCount=function(b,c){var d,e=Object.resolve(a),f,g;d=(c.paging.page-1)*c.paging.per_page,d+=c.data.length,b&&(Element.clearDom(b),g=e.translate("OF"),g.length>5&&(g="/"),f=d.toString()+" "+g+" "+c.paging.total.toString(),b.appendChild(document.createTextNode(f)))},b.appendRelatedEntities=function(a,c,d,e){var f=e.data,g,h,i,j,k,l,m=a.querySelector("ul"),n;for(b.setRecordCount(a.querySelector(".search-message span.record-count"),e),g=0;g<f.length;g++)n=f[g],
h=document.createElement("li"),h.classList.add("list-group-item"),h.mi_data=n,k=document.createElement("div"),h.appendChild(k),"none"!==c&&(k.className="block-group",k.appendChild(b.selector("multiselect"===c))),l=document.createElement("div"),l.className="results",k.appendChild(l),i=document.createElement("h4"),i.classList.add("list-group-item-heading"),l.appendChild(i),d?(j=document.createElement("a"),j.href=n.action,j.target="tab"):j=document.createElement("span"),j.appendChild(document.createTextNode(n.description)),i.appendChild(j),l.appendChild(b.familyElement(n)),d&&n.searchActions&&l.appendChild(b.associatedActions(n)),m.appendChild(h)},b.selector=function(a,b,c){var d=document.createElement("div"),e;return d.className="selector block",a?e=document.createElement("mi-checkbox-noko"):(e=document.createElement("mi-radio-noko"),e.name="global-search-finder-radio"),b&&(e.value=b),c&&(e.familykey=c),d.appendChild(e),d},b.getValueFromMiSelect=function(a){var b
;return a&&a.implementation&&a.implementation.value?(b=a.implementation.value(),b&&b instanceof Array?b[0]:b):""},b});
define('search/models/family',[],function(){"use strict";function a(a,b){this.caption=a,this.key=b}return a});
define('search/adapters/family-adapter',['require','search/models/family'],function(require){"use strict";var a=require("search/models/family");function b(){}return b.fromDTO=function(b){return new a(b.caption,b.key)},b.fromDTOArray=function(a){var c,d=[];for(c=0;c<a.length;c++)d[d.length]=b.fromDTO(a[c]);return d.sort(function(a,b){return a.caption.localeCompare(b.caption)}),d},b});
define('search/services/search-service',['require','jquery','system/http/ajax-client','search/adapters/family-adapter'],function(require){"use strict";var a=require("jquery"),b=require("system/http/ajax-client"),c=require("search/adapters/family-adapter"),d="api/search",e="api/core/appconfig";function f(a){this.ajaxClient=a,this.activeSearch=null}f.dependsOn=[b],f.prototype.search=function(a,b,c,d,e,f,h,j,k,l,m,n){return j&&j.length>0||k&&k.length>0||l&&l.length>0||m&&m.length>0?i(this,a,b,c,d,e,f,h,j,k,l,m,n):g(this,a,b,c,d,e,f,h,n)};function g(b,c,d,e,f,g,i,j,l){var m=a.Deferred(),n=h(c,d,e,f,g,i,j,l);return b.activeSearch=b.ajaxClient.get(n).done(k.bind(null,b,m)).fail(m.reject.bind(m)),m.promise()}function h(a,b,c,e,f,g,h,i){var j=d+"?term="+encodeURIComponent(a)+"&page="+b+"&pageSize="+c,k;if(e&&e.length>0)for(k=0;k<e.length;k++)j+="&families="+e[k];if(f&&f.length>0)for(k=0;k<f.length;k++)j+="&relationships="+f[k];return g===!1&&(j+="&hasRelationship=false"),h===!0&&(j+="&exactFamilyMatch=true"),i===!0&&(j+="&autoWildcard=true"),j}function i(b,c,d,e,f,g,i,j,l,m,n,o,p){
var q=a.Deferred(),r=h(c,d,e,f,g,i,j,p),s={EntityKeys:l,SiteKeys:m,ExcludeSucc:n,ExcludePred:o};return b.activeSearch=b.ajaxClient.post(r,s).done(k.bind(null,b,q)).fail(q.reject.bind(q)),q.promise()}f.prototype.cancelSearch=function(){this.activeSearch&&this.activeSearch.abort()},f.prototype.families=function(){var b=a.Deferred(),c=d+"/families";return this.ajaxClient.get(c).done(j.bind(null,b)).fail(b.reject.bind(b)),b.promise()},f.prototype.relatedEntities=function(a,b,c){var e=d+"/related/"+a+"/"+b.toString()+"/"+c.toString();return this.ajaxClient.get(e).promise()},f.prototype.relationships=function(a){return this.ajaxClient.get(d+"/relationships/"+a.toString())},f.prototype.build=function(){return this.ajaxClient.post(d+"/build")},f.prototype.status=function(){return this.ajaxClient.get(d+"/status")},f.prototype.getSearchSettings=function(){return this.ajaxClient.get(e+"/10")},f.prototype.searchSettings=function(a){return this.ajaxClient.put(e+"/10",a)},
f.prototype.schedule=function(a){return this.ajaxClient.post(d+"/schedule",a)},f.prototype.getSchedule=function(){return this.ajaxClient.get(d+"/schedule")};function j(a,b){a.resolve(c.fromDTOArray(b))}function k(a,b,c){b.resolve(c),a.activeSearch=null}return f});
define('search/search-view-model',['require','jquery','search/services/search-service','application/application-events','system/error/error-message','ramda'],function(require){"use strict";var a=require("jquery"),b=require("search/services/search-service"),c=require("application/application-events"),d=require("system/error/error-message"),e=require("ramda"),f=.75;function g(){this.service=Object.resolve(b),this.applicationEvents=Object.resolve(c),this.page=1,this.pageSize=25,this.paused=!1,this.families=null,this.term="",this.familyFilter=null,this.relationshipFilter=null,this.hasRelationship=!0,this.exactFamilyMatch=!1,this.entityKeys=null,this.siteKeys=null,this.excludeSucc=null,this.excludePred=null,this.autoWildcard=!1}g.prototype.loadFamilies=function(){var a=this.service.families();return a.done(l.bind(null,this)),a.promise()},g.prototype.loadRelationships=function(a){return this.service.relationships(a).promise()};var h=e.when(e.or(e.equals("0"),e.equals(0)),e.always(null));g.prototype.newSearch=function(a,b,c,d,f,g,j,k){return this.page=0,this.term=a,this.familyFilter=b,this.relationshipFilter=c,this.entityKeys=d,
f&&(this.siteKeys=e.uniq(e.map(h,f))),this.excludeSucc=g,this.excludePred=j,this.autoWildcard=k,i(this)},g.prototype.listScrolled=function(a){var b=a.target,c=b.offsetHeight+b.scrollTop,d=c/b.scrollHeight;if(!this.paused&&d>=f)return i(this)},g.prototype.cancelSearch=function(){this.service.cancelSearch()};function i(b){var c=a.Deferred();if(b.term||b.familyFilter)return b.paused=!0,b.page++,b.service.search(b.term,b.page,b.pageSize,b.familyFilter,b.relationshipFilter,b.hasRelationship,b.exactFamilyMatch,b.entityKeys,b.siteKeys,b.excludeSucc,b.excludePred,b.autoWildcard).done(k.bind(null,b,c)).fail(j.bind(null,b)),c.promise()}function j(a,b){if("abort"!==b.statusText){var c=d.fromHttpResponse(1,b);a.applicationEvents.errorOccured.raise(a,c)}}function k(a,b,c){b.resolve(c),c.data.length===a.pageSize&&(a.paused=!1)}function l(a,b){a.families=b}return g});
define('search/related-entity-view-model',['require','search/services/search-service','application/application-events','system/error/error-message','search/ui-utils'],function(require){"use strict";var a=require("search/services/search-service"),b=require("application/application-events"),c=require("system/error/error-message"),d=require("search/ui-utils"),e=.75;function f(c){this.service=Object.resolve(a),this.applicationEvents=Object.resolve(b),this.page=1,this.pageSize=25,this.paused=!1,this.settings={url:c.url,selector:c.selector||"none",makeLink:c.makeLink},this.region=null}f.prototype.load=function(a){var b=document.createElement("div"),c=document.createElement("ul");this.region=document.createElement("div"),this.region.classList.add("global-search-inline-related-entities"),a.insertAdjacentElement("afterend",this.region),this.region.innerHTML='<section class="search-message"><span></span></section>',b.className="global-search-results",this.region.appendChild(b),c.className="list-group",b.appendChild(c),this.region.querySelector(".global-search-results").addEventListener("scroll",this),this.paused=!0,
this.service.relatedEntities(this.settings.url,this.page,this.pageSize).done(h.bind(null,this)).fail(i.bind(null,this))},f.prototype.handleEvent=function(a){g(this,a)},f.prototype.show=function(){this.region.classList.add("active")},f.prototype.hide=function(){this.region.classList.remove("active")},f.prototype.toggle=function(){this.region.classList.toggle("active")},f.prototype.visible=function(){return this.region.classList.contains("active")};function g(a,b){var c=b.target,d=c.offsetHeight+c.scrollTop,f=d/c.scrollHeight;!a.paused&&f>=e&&(a.page++,a.paused=!0,a.service.relatedEntities(a.settings.url,a.page,a.pageSize).done(h.bind(null,a)).fail(i.bind(null,a)))}function h(a,b){d.appendRelatedEntities(a.region,a.settings.selector,a.settings.makeLink,b),b.data.length===a.pageSize&&(a.paused=!1)}function i(a,b){var d=c.fromHttpResponse(1,b);a.applicationEvents.errorOccured.raise(a,d)}return f});

define('text!search/views/search-finder.html',[],function () { return '<section class="global-search-finder">\r\n    <div class="block-group">\r\n        <mi-select name="families"></mi-select>\r\n        <mi-select name="relationships"></mi-select>\r\n        <div class="input-group block-group">\r\n            <input type="text" class="form-control search-term block" />\r\n            <div class="btn-group search-options block" dropdown data-bind="click: searchOptionsClicked">\r\n                <button type="button" class="btn search-options-current-selection"><i class="icon-global-search"></i></button>\r\n                <button type="button" class="btn dropdown-toggle" dropdown-toggle><span class="caret"></span></button>\r\n                <ul class="dropdown-menu search-options-list" role="menu">\r\n                    <li><button class="btn"><i class="icon-text-asterisk"></i></button></li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <section class="search-message">\r\n        <span></span>\r\n    </section>\r\n    <section class="global-search-results">\r\n        <ul class="list-group">\r\n        </ul>\r\n    </section>\r\n    <button type="button" class="btn btn-text btn-ok pull-right"></button>\r\n    <button type="button" class="btn btn-text btn-secondary btn-cancel pull-right" style="margin-right:5px;"></button>\r\n\r\n</section>\r\n';});

define('search/search-finder',['require','jquery','system/globalization/translator','system/ui/dialog-view-model','search/ui-utils','search/search-view-model','search/related-entity-view-model','text!./views/search-finder.html','ramda'],function(require){"use strict";var a=require("jquery"),b=require("system/globalization/translator"),c=require("system/ui/dialog-view-model"),d=require("search/ui-utils"),e=require("search/search-view-model"),f=require("search/related-entity-view-model"),g=require("text!./views/search-finder.html"),h=require("ramda");function i(){this.translator=Object.resolve(b),this.dfd=null,this.dialog=null,this.element=null,this.settings={multiSelect:!1,selectRelated:!0,families:null,relationships:null,defaultFamily:null,defaultRelationship:null,initialSearch:null,autoSearch:!1,entityKeys:null,siteKeys:null,selectionRequired:!1,excludeSucc:null,excludePred:null},this.searchViewModel=new e,this.searchOptionOpened=!1,this.closeSearchOptionsHandler=m.bind(null,this)}i.prototype.show=function(b){var d={height:"90%",width:"90%"},e=b.title||this.translator.translate("SEARCH");return this.dialog=new c(this,e,d),b=b||{},this.settings.multiSelect=b.multiSelect===!0,
this.settings.selectRelated=b.selectRelated===!0,this.settings.families=b.families||[],this.settings.relationships=b.relationships||[],this.settings.defaultFamily=b.defaultFamily,this.settings.defaultRelationship=b.defaultRelationship,this.settings.initialSearch=b.initialSearch||"",this.settings.autoSearch=b.autoSearch===!0,this.settings.entityKeys=b.entityKeys||[],this.settings.siteKeys=b.siteKeys||[],this.settings.selectionRequired=b.selectionRequired===!0,this.settings.excludeSucc=b.excludeSucc||[],this.settings.excludePred=b.excludePred||[],this.searchViewModel.hasRelationship=!(b.hasRelationship===!1),this.searchViewModel.exactFamilyMatch=b.exactFamilyMatch===!0,this.dfd=a.Deferred(),this.dialog.show(),this.dfd.promise()},i.prototype.attach=function(b){var c,d,e,f=this.translator.translate("CANCEL");b.attach(a(g)),e=a(b.element).find("mi-select"),Element.upgrade(e),this.element=b.element,d=this.element.querySelector("input"),d.value=this.settings.initialSearch,
d.addEventListener("change",this),this.element.querySelector("input.search-term").addEventListener("keypress",this),this.element.addEventListener("click",this),this.element.querySelector(".global-search-results").addEventListener("scroll",this),j(this),this.element.querySelector("button.btn-cancel").appendChild(document.createTextNode(f)),c=this.element.querySelector('mi-select[name="families"]'),this.searchViewModel.loadFamilies().done(C.bind(null,this)),e.on("valueChange",this.handleEvent.bind(this))};function j(a){var b,c=a.translator.translate("OK");b=a.element.querySelector("button.btn-ok"),b.appendChild(document.createTextNode(c)),b.disabled=a.settings.selectionRequired}i.prototype.detach=function(b){this.element.querySelector("input").removeEventListener("change",this),this.element.removeEventListener("click",this),this.element.querySelector(".global-search-results").removeEventListener("scroll",this),a(this.element).find("mi-select").off(),b.clear(),
"resolved"!==this.dfd.state()&&this.dfd.reject()},i.prototype.handleEvent=function(a){var b;if(k(this,a),"valueChange"===a.type)"MI-SELECT"===a.target.tagName&&"families"===a.target.getAttribute("name")&&E(this,a.target),y(this);else if("scroll"===a.type)(b=this.searchViewModel.listScrolled(a))&&b.done(A.bind(null,this));else if("keypress"===a.type){var c=a.which||a.keyCode;13===c&&(a.preventDefault(),y(this))}};function k(a,b){"click"===b.type&&(l(a,b),n(a,b),q(a,b),r(a,b),s(a,b),t(a,b),v(a,b))}function l(a,b){var c=b.target.classList.contains("caret"),d="BUTTON"===b.target.nodeName&&!h.isNil(b.target.querySelector(".caret"));(c||d)&&(x(a),a.searchOptionOpened=!a.searchOptionOpened,a.searchOptionOpened?window.addEventListener("click",a.closeSearchOptionsHandler):window.removeEventListener("click",a.closeSearchOptionsHandler))}function m(a,b){var c=a.element.querySelector(".btn-group.search-options"),d=!h.isNil(c)&&c.contains(b.target),e=!h.isNil(c);e&&!d?(x(a,!1),
a.searchOptionOpened=!1,window.removeEventListener("click",a.closeSearchOptionsHandler)):e||window.removeEventListener("click",a.closeSearchOptionsHandler)}function n(a,b){var c=a.element.querySelector(".dropdown-menu.search-options-list").contains(b.target),d="I"===b.target.nodeName,e=1===b.target.querySelectorAll("i").length;if(c&&(d||e)){"icon-global-search"===p(b.target)&&o(a),x(a)}}function o(a){var b=a.element.querySelector(".search-options > button.search-options-current-selection > i"),c=a.element.querySelector(".dropdown-menu.search-options-list > li > button > i");b.classList.add("icon-global-search"),c.classList.remove("icon-global-search")}function p(a){return"I"===a.nodeName?a.className:a.querySelector("i").className}function q(a,b){a.element.querySelector(".btn.search-options-current-selection").contains(b.target)&&y(a)}function r(a,b){b.target.classList.contains("btn-ok")&&B(a)}function s(a,b){b.target.classList.contains("btn-cancel")&&a.dialog.closeDialog()}
function t(a,b){u(b.target)&&(b.preventDefault(),b.cancelBubble=!0,G(a,b))}function u(a){return"A"===a.tagName&&!!a.parentElement.classList.contains("relationship-links")}function v(a,b){w(b.target,"MI-RADIO-NOKO","MI-CHECKBOX-NOKO")&&a.settings.selectionRequired&&(a.element.querySelector("button.btn-ok").disabled=!a.element.querySelector("input:checked"))}function w(a){var b=Array.prototype.slice.call(arguments,1);return!!a&&(b.indexOf(a.nodeName)>-1||!!a.parentElement&&(b.unshift(a.parentElement),w.apply(null,b)))}function x(a,b){var c=a.element.querySelector(".dropdown-menu.search-options-list");return b===!0?void(c.style.display="block"):b===!1?void(c.style.display=""):void(""===c.style.display?c.style.display="block":c.style.display="")}function y(a){var b,c,e,f,g=a.element.querySelector(".global-search-results .list-group"),h=a.element.querySelector("input.search-term"),i;a.settings.autoSearch=!1,a.searchViewModel.cancelSearch(),z(a,""),g.scrollTop=0,g.innerHTML="",
b=d.getValueFromMiSelect(a.element.querySelector('mi-select[name="families"]')),b?c=[b]:a.settings.families.length>0&&(c=a.settings.families),e=d.getValueFromMiSelect(a.element.querySelector('mi-select[name="relationships"]')),e?(f=[],f[0]=e):a.settings.relationships.length>0&&(f=a.settings.relationships),i=a.searchViewModel.newSearch(h.value,c,f,a.settings.entityKeys,a.settings.siteKeys,a.settings.excludeSucc,a.settings.excludePred),i?i.done(A.bind(null,a)):z(a,a.translator.translate("INVALID_SEARCH"))}function z(a,b){a.element.querySelector(".search-message span").innerHTML=b,a.element.querySelector(".search-message").style.display="block",a.element.querySelector(".global-search-results").style.height="calc(100% - 90px)"}function A(a,b){var c,e,f,g,h,i,j;if(a.element.querySelector(".global-search-results .list-group")){if(j=a.element.querySelector(".global-search-results .list-group").children,0===j.length&&0===b.data.length)return void z(a,a.translator.translate("NO_RESULTS"))
;if(a.element.querySelector(".search-message").style.display="none",a.element.querySelector(".global-search-results").style.height="calc(100% - 45px)",d.setRecordCount(a.element.querySelector(".search-message span"),b),i=a.element.querySelector(".global-search-results .list-group"))for(h=0;h<b.data.length;h++)c=document.createElement("li"),c.classList.add("list-group-item"),c.mi_data=b.data[h],f=document.createElement("div"),f.classList.add("block-group"),f.appendChild(d.selector(a.settings.multiSelect)),g=document.createElement("div"),g.classList.add("result"),e=document.createElement("h4"),e.classList.add("list-group-item-heading"),e.appendChild(document.createTextNode(b.data[h].description)),g.appendChild(e),g.appendChild(d.familyElement(b.data[h])),b.data[h].relatedEntities&&g.appendChild(d.relatedEntities(b.data[h])),f.appendChild(g),c.appendChild(f),i.appendChild(c)}}function B(a){var b=[],c,d,e=a.element.querySelectorAll("input:checked");for(c=0;c<e.length;c++){
for(d=e[c];d&&"LI"!==d.nodeName;)d=d.parentElement;b[b.length]=d.mi_data}a.dfd.resolve(b),a.dialog.closeDialog()}function C(a){var b=D(a.searchViewModel.families,a.settings.families),c=a.element.querySelector('mi-select[name="families"]'),e=a.element.querySelector('mi-select[name="relationships"]'),f,g;c&&e&&(g=a.searchViewModel.hasRelationship?a.translator.translate("SEARCH_LINKED_TO"):a.translator.translate("SEARCH_EXCLUDE_FROM"),d.loadSelect(c,a.translator.translate("SEARCH_All_FAMILIES"),a.translator.translate("SEARCH_LOOK_IN"),a.settings.defaultFamily,b),1===b.length||a.settings.defaultFamily?E(a,c):a.settings.relationships.length>0?(f=D(a.searchViewModel.families,a.settings.relationships),d.loadSelect(e,a.translator.translate("SEARCH_All_FAMILIES"),g,a.settings.defaultRelationship,f),a.settings.autoSearch&&y(a)):a.settings.autoSearch&&y(a))}function D(a,b){var c,d,e;if(b&&b.length>0){for(e=[],c=0;c<b.length;c++)for(d=0;d<a.length;d++)if(a[d].key===b[c]){e[e.length]=a[d];break}
}else e=a;return e}function E(a,b){var c=a.element.querySelector('mi-select[name="relationships"]'),e=D(a.searchViewModel.families,a.settings.relationships),f,g,h;c&&(g=a.searchViewModel.hasRelationship?a.translator.translate("SEARCH_LINKED_TO"):a.translator.translate("SEARCH_EXCLUDE_FROM"),a.settings.relationships.length>0?(d.loadSelect(c,a.translator.translate("SEARCH_All_FAMILIES"),g,a.settings.defaultRelationship,e),a.settings.autoSearch&&y(a)):(c.implementation.options([]),(h=d.getValueFromMiSelect(b))&&(f=a.searchViewModel.loadRelationships(h),f.done(F.bind(null,a,c)))))}function F(a,b,c){var e;b.implementation&&(e=a.searchViewModel.hasRelationship?a.translator.translate("SEARCH_LINKED_TO"):a.translator.translate("SEARCH_EXCLUDE_FROM"),d.loadSelect(b,a.translator.translate("SEARCH_All_FAMILIES"),e,a.settings.defaultRelationship,c),a.settings.autoSearch&&y(a))}function G(a,b){var c,d;b.target.viewModel?b.target.viewModel.visible()?b.target.viewModel.hide():(H(b.target),
b.target.viewModel.show()):(H(b.target),d={url:b.target.getAttribute("href"),selector:"none",makeLink:!1},a.settings.selectRelated&&(d.selector=a.settings.multiSelect?"multiselect":"single"),c=new f(d),c.load(b.target.parentElement),c.show(),b.target.viewModel=c)}function H(a){var b,c;for(b=a.parentElement.querySelectorAll("a"),c=0;c<b.length;c++)b[c].viewModel&&b[c].viewModel.hide()}return i});
define('system/knockout/bindings/property',['require','lodash','jquery','knockout'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d="property-changed-event-handlers";c.bindingHandlers.property||(c.bindingHandlers.property={init:function(e,f){var g,h=b(e),i={};a.each(f(),function(b,c){g=function(b,d){var e=f()[c];a.isFunction(e)&&e(d)},i[c]=g,h.on("attributes."+c+":changed",g),h.on("properties."+c+":changed",g)}),c.utils.domData.set(e,d,i),c.utils.domNodeDisposal.addDisposeCallback(e,function(){var b=c.utils.domData.get(e,d);a.each(f(),function(a,c){h.off("attributes."+c+":changed",b[c]),h.off("properties."+c+":changed",b[c])})})},update:function(b,d){var e;a.each(d(),function(a,d){e=c.unwrap(a),b[d]=e})}})});
define('system/lang/element',['require','lodash','jquery','jquery','knockout','system/lang/converter','system/knockout/knockout-manager','system/knockout/bindings/halt-bindings','system/knockout/bindings/property'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("jquery"),d=require("knockout"),e=require("system/lang/converter"),f=require("system/knockout/knockout-manager");require("system/knockout/bindings/halt-bindings"),require("system/knockout/bindings/property"),Element.registeredElements={};function g(){var a=Array.prototype.slice.call(arguments,0),b=a[0];Element.registeredElements[b]?console.warn("Attemted to register element "+b+" after it was already registered"):(document.registerElement.apply(document,a),Element.registeredElements[b]=!0)}function h(a,b){var c=Object.create(HTMLElement.prototype);c.createdCallback=function(){this.implementation=Object.resolve(b),this.implementation.element=this,Object.tryMethod(this.implementation,"created")},c.attachedCallback=function(){Object.tryMethod(this.implementation,"attached")},c.detachedCallback=function(){Object.tryMethod(this.implementation,"detached")},c.attributeChangedCallback=function(a,b,c){
Object.tryMethod(this.implementation,a+"Changed",b,c)},document.registerElement(a,{prototype:c})}var i=function(){function a(a,b,c){this.kom=Object.resolve(f),this.properties=[],this.view=a,this.preserveContext=b||!1,this.appendAfterBindings=c||!1,this.container=null,this.element=null}a.prototype.created=function(){Object.tryMethod(this,"beforeCreated"),c(this),Object.tryMethod(this,"afterCreated")},a.prototype.attached=function(){Object.tryMethod(this,"beforeAttached"),e(this),Object.tryMethod(this,"afterAttached")},a.prototype.detached=function(){Object.tryMethod(this,"beforeDetached"),g(this),Object.tryMethod(this,"afterDetached")},a.prototype.bindAttribute=function(a,c,d){this[a]=this.kom.observable(),this[a+"Changed"]=function(b,c){this[a](c)}.bind(this),this.kom.subscribe(this[a],function(c){b(this.element).trigger("attributes."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),this[a](Object.defaultValue(this.element.getAttribute(a),c))},
a.prototype.bindProperty=function(a,c,d,e){this[a]=this.kom.observable();var f=e||!1;Object.defineProperty(this.element,a,{get:function(){return this[a]()}.bind(this),set:function(b){this[a](b)}.bind(this)}),this.properties.push(a),this.kom.subscribe(this[a],function(c){f||b(this.element).trigger("properties."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),this[a](Object.defaultValue(this.element[a],c))},a.prototype.bindArrayProperty=function(a,c,d,e){this[a]=this.kom.observableArray();var f=e||!1;Object.defineProperty(this.element,a,{get:function(){return this[a]()}.bind(this),set:function(b){this[a](b)}.bind(this)}),this.properties.push(a),this.kom.subscribe(this[a],function(c){f||b(this.element).trigger("properties."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),this[a](Object.defaultValue(this.element[a],c))};function c(a){var c=document.createElement("div"),d=b(c),e=b(a.view);a.preserveContext||d.attr("data-bind","halt-bindings"),d.append(e),
a.appendAfterBindings||b(a.element).empty().append(d),a.container=c}function e(a){d.applyBindingsToDescendants(a,a.container),a.appendAfterBindings&&b(a.element).empty().append(a.container)}function g(a){d.cleanNode(a.container),b(a.container).remove(),a.kom.dispose(),a.properties.forEach(h.bind(null,a))}function h(a,b){delete a[b]}return a}();function j(b,d){window.CustomElements&&(window.CustomElements.useNative||(a.isArray(b)?k(b,d):a.isString(b)?l(b,d):b instanceof c?m(b):n(b)))}function k(a,b){for(var c=0;c!==a.length;c++)j(a[c],b)}function l(a,c){c&&c.$element&&(c=c.$element),m(b(a,c))}function m(a){a.each(function(a,b){n(b)})}function n(a){window.CustomElements.upgrade(a)}function o(b,c,d,e,f){var g,h=document.createElement(b);if(d)for(g=0;g!==d.length;g++)h.classList.add(d[g]);return e&&a.each(e,function(a,b){e.hasOwnProperty(b)&&h.setAttribute(b,a)}),f&&(h.textContent=f),c&&c.appendChild(h),h}function p(a,b){return null!==a.getAttribute(b)}function q(a,b,c){
var d=a.getAttribute(b);return d?e.toInteger(d):c}function r(a,b,c){var d=a.getAttribute(b);return d?e.toString(d):c}function s(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function t(a,b,c){var d=a[b];Object.defineProperty(a,b,c),a[b]=d}function u(a,b,c){a.dispatchEvent(new CustomEvent(b,{detail:c}))}function v(a){a.parentNode&&a.parentNode.removeChild(a)}var w={registerElement:g,register:h,ViewModel:i,upgrade:j,build:o,booleanAttribute:p,intAttribute:q,stringAttribute:r,clearDom:s,defineProperty:t,raiseEvent:u,detach:v};return b.extend(Element,w),w});
define('ui/elements/ref-doc/view-models/events',['require'],function(require){"use strict";function a(){this.IsValidPath=!1,this.IsLink=!1,this.AddRefSuccess=!1,this.AddRefFail=!1}return a.prototype.IsValidUrl=function a(b){return new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:/\\S*)?$","i").test(b)},a.prototype.IsValidUnc=function a(b){return new RegExp("^[a-zA-Z]:\\.*|^\\\\.*").test(b)},a.prototype.ValidatePath=function a(b){return this.IsValidPath=this.IsValidUrl(b)||this.IsValidUnc(b),this.IsValidPath},a.prototype.IsStoredDocChecked=function a(b){return null!==b&&b.datasheet.entity.fields._byId.MI_REF_DOCUMENTS_STORE_DOCUM_L.attributes.value},a.prototype.GetPath=function a(b){var c=""
;return null!==b&&(c=b.datasheet.entity.fields._byId.MIRD_DOC_PATH_CHR.attributes.value),c},a.prototype.Reset=function a(){this.IsValidPath=!1,this.IsLink=!1,this.AddRefSuccess=!1,this.AddRefFail=!1},a});
define('ui/elements/ref-doc/views/ref-doc-container-view',['require','jquery','system/globalization/translator'],function(require){"use strict";var a=require("jquery"),b=require("system/globalization/translator");function c(a){this.translator=Object.resolve(b),this.refDocs=a}c.prototype.getView=function(){var a="",b;if(this.refDocs.length>0)for(b=0;b<this.refDocs.length;b++)a+='<section class="content block-group"  data-key="'+this.refDocs[b].key+'">',a+='<div class="block col-15"><span class="icon"><i class="'+d(this.refDocs[b])+'"></i></span>'+this.refDocs[b].name+"</div>",a+='<div class="block col-25">'+this.refDocs[b].desc+"</div>",this.refDocs[b].isStoredDocument&&""!==this.refDocs[b].docType?a+='<div class="block col-10"> <div> '+this.translator.translate("YES")+"</div></div>":a+='<div class="block col-10"> <div> '+this.translator.translate("NO")+"</div></div>",a+='<div class="block col-10"><div>'+this.refDocs[b].size+"</div></div>",
a+='<div class="block col-5"> <button class="btn btn-icon section-icon edit" title="'+this.translator.translate("EDIT")+'"> <i class="icon-edit"></i> </button></div>',a+='<div class="block col-5"> <button class="btn btn-icon section-icon unlink" title="'+this.translator.translate("UNLINK")+'"> <i class="icon-unlink"></i> </button></div>',(this.refDocs[b].isURL||this.refDocs[b].isUncPath)&&(a+='<div class="block col-5"> <button class="btn btn-icon section-icon open" title="'+this.translator.translate("OPEN_IN_NEW_WINDOW")+'"> <i class="icon-open-in-new-window"></i> </button></div>'),this.refDocs[b].isStoredDocument&&""!==this.refDocs[b].docType&&(a+='<div class="block col-5"> <button class="btn btn-icon section-icon download" title="'+this.translator.translate("DOWNLOAD")+'"> <i class="icon-download"></i> </button></div>'),a+="</section>";else a+='<section class="content block-group"> ',
a+='<section class="block text-info">'+this.translator.translate("REFDOCS_NO_REFERENCE_DOCUMENTS_AVAILABLE")+"</section>";return a};function d(a){return"pdf"===a.docType?"icon-image":"js"===a.docType?"icon-code":"xls"===a.docType||"xlsx"===a.docType?"icon-grid":"doc"===a.docType||"docx"===a.docType?"icon-doc":"jpg"===a.docType||"jpeg"===a.docType||"png"===a.docType||"bmp"===a.docType||"gif"===a.docType?"icon-image":(a.docType,"icon-doc")}return c});
define('ui/elements/tool-bar/view-model',['lodash','jquery'],function(){"use strict";var a=require("lodash"),b=require("jquery"),c=Object.create(HTMLElement.prototype);c.createdCallback=function(){var b,c;this._closeOverflowBind=m.bind(null,this),this.$filter=null,this.popoverId=null,b=document.createElement("button"),b.className="more-options-icon btn btn-primary btn-icon dropdown-toggle",this.appendChild(b),c=document.createElement("icon"),c.className="icon-options",b.appendChild(c),this.throttledPositionEllipsis=a.throttle(this.positionEllipsis.bind(this),650)},c.attachedCallback=function(){a.defer(q.bind(null,this)),window.addEventListener("resize",this),document.querySelector("body").addEventListener("click",this._closeOverflowBind),this.addEventListener("click",this)},c.detachedCallback=function(){var a;window.removeEventListener("resize",this),document.querySelector("body").removeEventListener("click",this._closeOverflowBind),this.$filter&&(a=document.querySelector(this.popOverId),a&&a.parentElement.removeChild(a),
this.$filter=null)},c.showElement=function(a,b){for(var c=this.firstElementChild;c;)d(c,a)&&e(c,b),null!==c&&(c=c.nextElementSibling)};function d(a,b){return a.className.split(" ").indexOf(b)>=0}function e(a,c){c?b(a).addClass("overflow").removeClass("no-access"):b(a).addClass("no-access").removeClass("overflow")}c.handleEvent=function(b){var c,d,e,f;if("resize"===b.type&&b.target===window)this.throttledPositionEllipsis(),a.defer(q.bind(null,this));else if("click"===b.type){if(c=this.querySelector(".more-options-icon"),d=document.querySelector(this.popOverId),b.target===c||c.contains(b.target))l(this);else if(d&&d.contains(b.target)){for(f=b.target;f&&!e;)f.original&&(e=f.original),f=f.parentElement;e&&(b.cancelBubble=!0,e.dispatchEvent(new CustomEvent("click",{bubble:!0})))}b.target.parentElement.classList.contains("tool-bar-overflow")&&this._closeOverflowBind(this,b)}},c.positionEllipsis=function(){
var a=this.firstElementChild,b=this.querySelector(".more-options-icon"),c=document.querySelector(".content").getBoundingClientRect(),d=0,e=5,l,m=!1,n,o,p,q,r;if(r=this,null!==this.offsetParent)if(p=this.parentElement.getBoundingClientRect(),l="MI-TREE"===this.parentElement.tagName,this.$filter&&this.$filter.popover("hide"),a&&a!==b){for(n=b.getBoundingClientRect(),q=c.width===p.width||l?p.width-n.width-e:p.left+p.width-n.width-e,o=a.getBoundingClientRect(),d=h(r,b,o,p),a=this.firstElementChild;a;)o=a.getBoundingClientRect(),j(a,b,o,p)&&(i(a)?d>0?(m=!0,a.classList.add("overflow"),f(a),d--,d=h(r,b,o,p)):(g(a),a.classList.remove("overflow")):k(a,this)?(m=!0,a.classList.add("overflow")):(g(a),a.classList.remove("overflow"))),null!==a&&(a=a.nextElementSibling);m?(b.style.visibility="visible",b.style.left=q.toString()+"px"):b.style.visibility="hidden"}else;};function f(a){var c=b(a);""===c.next().text()||c.hasClass("more-options-icon")||c.next().css({"margin-right":"20px"})}function g(a){
var c=b(a),d=[];c.hasClass("overflow")&&c.attr("style",""),c.parent().children().each(function(a,c){"right"!==b(this).css("float")||b(this).hasClass("overflow")||d.push(b(this))}),b.each(d,function(a){0!==a&&b(this).attr("style","")})}function h(a,b,c,d){var e,f=0;for(e=a.firstElementChild;e;)j(e,b,c,d)&&k(e,a)&&i(e)&&f++,e=e.nextElementSibling;return f}function i(a){return"right"===b(a).css("float")}function j(a,b,c,d){var e="addItem"===a.getAttribute("data-action");return a!==b&&c.width!==d.width&&!e}function k(a,c){var d=b(a).position().top>b(c).position().top+b(c).height();return a.classList.contains("overflow")&&!a.classList.contains("dropdown-toggle")&&(b(a).removeClass("overflow"),d=b(a).position().top>b(c).position().top+b(c).height(),b(a).addClass("overflow")),d}function l(a){if(!a.$filter){var c,d;a.$filter=b(a.querySelector(".more-options-icon")),a.$filter.popover({placement:"bottom",container:"body",content:" "}),a.$filter.on("shown.bs.popover",a,n),
a.$filter.on("hide.bs.popover",a,o),a.$filter.on("hidden.bs.popover",a,p),a.$filter.popover("show"),setTimeout(function(){c=parseInt(b(a.popOverId).css("left")),d=parseInt(b(a.popOverId).width()),b(a.popOverId).css("left",c-(d-30))},250)}}function m(a,b){var c;if(a.$filter){if(!(c=document.querySelector(a.popOverId))||c.contains(b.target)||b.target===a)return;a.$filter.popover("hide")}}function n(a){var b=a.data,c,d=b.querySelectorAll(".overflow"),e,f;for(b.popOverId="#"+a.target.attributes["aria-describedby"].value,c=document.querySelector(b.popOverId+" .popover-content"),c.classList.add("tool-bar-overflow"),e=0;e<d.length;e++)f=d[e].cloneNode(),f.original=d[e],c.appendChild(f),f.textContent=f.getAttribute("title");c.addEventListener("click",b)}function o(a){var b=a.data,c;c=document.querySelector(b.popOverId+" .popover-content"),c&&c.addEventListener("click",b),b.$filter.off("shown.bs.popover",n),b.$filter.off("hide.bs.popover",o)}function p(a){var b=a.data
;b.$filter&&(b.$filter.off("hidden.bs.popover",p),b.$filter.popover("destroy"),b.$filter=null,b.popoverId=null)}function q(a){a&&a.positionEllipsis&&a.positionEllipsis instanceof Function&&a.positionEllipsis()}return document.registerElement("mi-tool-bar",{prototype:c}),c});

define('text!ui/elements/filter/filter-template.html',[],function () { return '<div class="icon-filter-container">\r\n    <button class="icon-container btn btn-icon" data-bind="click: toggleFilter, css: {\'filter-active\': hasSelection}">\r\n        <i class="icon-collection-filter"></i>\r\n    </button>\r\n</div>\r\n';});


define('text!ui/elements/filter/generic-filter-view.html',[],function () { return '<div class="filter-container" data-bind="visible: visible,\r\n                                             css: {\'right-filter-container\': isRightOriented}">\r\n\r\n    <div class="filters" data-bind="css: {\'has-tag\': hasSelection}">\r\n        <!--<div class="clear-all" data-bind="css: {\'clear-all-active\': hasSelection}">\r\n            <a data-bind="click: $root.clearSelection,text:$root.translator.translate(\'MF_CLEAR_ALL\')"></a>\r\n        </div>-->\r\n        <div class="tag-section tag-area " data-bind="css: {\'filter-tag-active\': hasSelection}">\r\n            <!-- ko foreach: filterOptions -->\r\n            <!-- ko foreach: options -->\r\n            <!-- ko if: $data.isSelected-->\r\n            <div class="tag tag-style">\r\n                <span>\r\n                    <span data-bind="text: text"></span>\r\n                </span>\r\n                <i class="icon-close-popup" data-bind="click: $root.removeFilter.bind($data)"></i>\r\n            </div>\r\n            <!-- /ko -->\r\n            <!-- /ko -->\r\n            <!-- /ko -->\r\n        </div>\r\n        <div class="filter-content">\r\n            <div class="sort-header <!--border-active-->">\r\n                <!--<header class="header-title"> Sort by: </header>-->\r\n                <div data-bind="visible: sortOptions().length > 0" class="mi-select">\r\n                    <mi-select data-bind="miproperty:{\r\n                               options:sortOptions,\r\n                               value:sortvalue,\r\n                               optionsCaption:sortcaption\r\n                            }"></mi-select>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="filter-header">\r\n            <header data-bind="text: $root.translator.translate(\'FILTER_HEADER_CAPTION\')"></header>\r\n            <header class="dotted-border"> </header>\r\n        </div>\r\n        <div class="filter-body" data-bind="foreach:filterOptions,css:{\'no-select\': !sortOptions().length}">\r\n            <div class="filter-section">\r\n                <header data-bind="text: caption"></header>\r\n                <div class="filter-item">\r\n                    <form class="form-item" data-bind="foreach:options">\r\n                        <div>\r\n                            <!--<input type="checkbox" data-bind="value: value, checked: isSelected" /> <span data-bind="text: text"></span>-->\r\n                            <mi-checkbox data-bind="miCheckboxProperty: {checked: isSelected, text: text}"></mi-checkbox>\r\n                        </div>\r\n                    </form>\r\n                    <div class="second-dotted-border"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n</div>';});

define('ui/elements/filter/filter-item',['require','knockout','system/lang/event'],function(require){"use strict";var a=require("knockout"),b=require("system/lang/event");function c(c,e){c=c||null,this.caption=e,this.value=a.observable(c.value),this.text=a.observable(c.text),this.isSelected=a.observable(c.isSelected),this.isSelected.subscribe(d.bind(null,this)),this.valueChanged=new b}function d(a,b){a.valueChanged.raise(b,a.text(),a.value())}return c});
define('ui/elements/filter/filter-group',['require','knockout','./filter-item','system/lang/event'],function(require){"use strict";var a=require("knockout"),b=require("./filter-item"),c=require("system/lang/event");function d(d){d=d||null,this.caption=d.caption,this.type=a.observable(d.type),this.options=a.observableArray(),this.valueChanged=new c;for(var f=0;f<d.options.length;f++)this.options.push(new b(d.options[f].option,this.caption)),this.options()[f].valueChanged.add(e.bind(null,this))}function e(a,b,c,d){a.valueChanged.raise(a.caption,c,b,d)}return d});
define('ui/elements/filter/filter-view-model',['require','lodash','jquery','knockout','text!./filter-template.html','text!./generic-filter-view.html','./filter-group','spa/region','system/globalization/translator','ui/elements/select/view-model','ui/elements/checkbox/checkbox-view-model'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("text!./filter-template.html"),e=require("text!./generic-filter-view.html"),f=require("./filter-group"),g=require("spa/region"),h=require("system/globalization/translator");require("ui/elements/select/view-model"),require("ui/elements/checkbox/checkbox-view-model");function i(){j.call(this,d,!1),this.translator=Object.resolve(h),this.visible=c.observable(!1),this.filterOptions=c.observableArray(),this.sortOptions=c.observableArray(),this.values=[],this.type=c.observable(),this.hasSelection=c.computed(q.bind(null,this)),this.isRightOriented=null,this.x=null,this.y=null,this.topOffset=0,this.leftOffset=0,this.genericFilterRegion=new g(null,null),this.isClicked=!1,b(document).bind("click",k.bind(null,this))}var j=Object.inherit(Element.ViewModel,i);i.prototype.beforeCreated=function(){this.bindProperty("type",null),this.bindProperty("sortvalue",null),
this.bindProperty("sortcaption",null),this.bindArrayProperty("filteroptions",null),this.bindArrayProperty("sortoptions",null),this.bindAttribute("value",null),this.bindAttribute("sortvalue",null),this.bindAttribute("sortcaption",this.translator.translate("SORT_BY")),this.bindProperty("orientation","left"),b(this.element).on("properties.sortoptions:changed",o.bind(null,this)),b(this.element).on("properties.filteroptions:changed",n.bind(null,this)),b(this.element).on("properties.type:changed",p.bind(null,this)),b(this.element).on("properties.orientation:changed",s.bind(null,this)),this.isRightOriented=c.computed(t.bind(null,this)),this.resizeProxy=b.proxy(a.debounce(this.resize,100),this),this.scrollProxy=b.proxy(this.resize,this),this.ignoreValueChange=!1};function k(a){a.isClicked?a.isClicked=!1:a.visible()&&(b(".filter-outer-container").remove(),a.visible(!1))}i.prototype.toggleFilter=function(){event.stopPropagation(),this.isClicked=!0,b(document).trigger("click"),
this.visible()?(c.cleanNode(this.genericFilterRegion.activeContainer),this.contentContainer.remove(),b(window).off("resize",this.resizeProxy),b("body").find(".content").off("scroll",this.scrollProxy)):(u(this),b(window).on("resize",this.resizeProxy),b("body").find(".content").on("scroll",this.scrollProxy)),this.visible(!this.visible())},i.prototype.removeFilter=function(a){a.isSelected(!1)},i.prototype.resize=function(){l(this),m(this)};function l(a){var c;(c=b(a.element).find(".icon-container").offset())&&(a.topOffset=c.top,a.leftOffset=c.left)}function m(a){if(a.contentContainer){var b="";window.innerWidth<a.leftOffset+250&&(a.leftOffset=a.leftOffset-215+"px",b="align-left"),a.contentContainer.css({position:"absolute",top:a.topOffset+42+"px",left:a.leftOffset}),a.contentContainer.find(".filters").addClass(b)}}i.prototype.clearSelection=function(a){var b,c,d,e;for(a.ignoreValueChange=!0,b=0;b<a.filterOptions().length;b++)for(d=a.filterOptions()[b],
c=0;c<d.options().length;c++)e=d.options()[c],e.isSelected()===!0&&e.isSelected(!1);a.values=[],a.value(""),a.ignoreValueChange=!1},i.prototype.afterDetached=function(){};function n(a,b,c){var d,e,g;if(0===a.filterOptions().length)for(d=0;d<c.length;d++)for(a.filterOptions.push(new f(c[d])),a.filterOptions()[d].valueChanged.add(r.bind(null,a)),e=0;e<c[d].options.length;e++)g=c[d].options[e].option,g.isSelected&&a.values.push(g.value)}function o(a,b,c){var d;if(c&&0===a.sortOptions().length)for(d=0;d<c.length;d++)a.sortOptions.push(c[d])}function p(a,b,c){a.type(c)}function q(a){var b,c,d,e;for(b=0;b<a.filterOptions().length;b++)for(d=a.filterOptions()[b],c=0;c<d.options().length;c++)if(e=d.options()[c],e.isSelected()===!0)return!0;return!1}function r(b,c,d,e,f){var g,h;b.ignoreValueChange||(e===!0?b.values.push(f):(h=a.findIndex(b.values,function(a){return a===f}))!==-1&&b.values.splice(h,1),g=b.values.join(),b.value(g))}function s(a,b,c){a.orientation(c)}function t(a){
return"right"===a.orientation()}function u(a){var d,f;f=b(".content-wrapper"),d=document.createElement("div"),b(d).addClass("filter-outer-container"),a.contentContainer=b(d),b(f).after(d),a.genericFilterRegion.setElement(d),a.genericFilterRegion.attach(b(e)),c.applyBindings(a,a.genericFilterRegion.activeContainer),b(".filter-outer-container").click(function(a){a.stopPropagation()}),l(a),m(a)}return Element.register("mi-filter",i),i});

define('text!ui/elements/resultgrid/resultgrid-template.html',[],function () { return '\r\n<div class="rg-header">\r\n    <div data-bind="halt-bindings" class="rg-pager" >\r\n        <mi-select data-bind="miproperty:{\r\n                           options: listObjects,\r\n                           optionsText: \'displayName\',\r\n                           optionsValue: optionsValue,\r\n                           value: selectedValue,\r\n                           editable: false\r\n                           }">\r\n        </mi-select>\r\n        <div class="totalCount">\r\n            <div data-bind="text: $root.translator.translate(\'OF\')"></div>\r\n            <div data-bind="text: customTotalCount"></div> \r\n            <div data-bind="text: $root.translator.translate(\'RECORDS\')"></div>\r\n         </div>\r\n      </div>\r\n   \r\n        <!--<button class="btn btn-icon pull-right rg-filter" data-bind="attr: {title : \'Filter\'}">\r\n            <i class="icon-collection-filter" ></i>\r\n        </button>-->\r\n    </div>\r\n<div class="gridContainer" style="display:block;height:100%;width:100%;"></div>\r\n<div class="rg-footer">\r\n    <div class="rg-controls" >\r\n        <span class="dxDataGridTotalCount pull-left" style="height: 25px;display:none;"></span>\r\n    </div>\r\n\r\n</div>';});

define('ui/elements/resultgrid/resultgrid-service',['require','jquery','system/lang/object','system/http/ajax-client'],function(require){"use strict";var a=require("jquery");require("system/lang/object");var b=require("system/http/ajax-client");function c(a){this.ajaxClient=a,this.API_URL="api/core/command/query"}return c.dependsOn=[b],c.prototype.getData=function(b){var c=a.Deferred(),d=this.API_URL,e={CommandText:b.query,Parameters:[],StartRow:b.startRow,MaxRows:b.maxRows};return this.ajaxClient.post(d,e).done(function(a){c.resolve(a)}).fail(function(a){c.reject(a.statusText)}),c.promise()},c});
define('ui/elements/page-filter/page-filter-remote',['require','jquery'],function(require){"use strict";var a=require("jquery");function b(){this.pageFilter=null}b.prototype.connect=function a(b){this.pageFilter=c(b)};function c(b){var c;return c=a(b).closest("mi-page-filter").get(0)||null,null===c?a(b).closest("mi-et-page-filter").get(0)||null:c}return b.prototype.isConnected=function a(){return null!==this.pageFilter},b});
define('ui/elements/page-filter/page-filter-connection',['require','./page-filter-remote'],function(require){"use strict";var a=require("./page-filter-remote");function b(){this.callback=null,this.element=null,this.filter=null,this.remote=Object.resolve(a)}return b.prototype.open=function a(b,c){this.callback=b,this.element=c,this.remote.connect(c),this.filter=this.remote.pageFilter,this.remote.isConnected()?this.filter.connect(this):this.publish()},b.prototype.close=function a(){this.filter&&this.filter.disconnect(this),this.filter=null,this.element=null,this.callback=null},b.prototype.publish=function a(b){this.callback(b)},b.prototype.isSame=function a(b){return this===b},b});
define('query/services/dto/column-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.caption=a.toString(b.caption),this.defaultCaption=a.toString(b.defaultCaption),this.dataType=a.toString(b.dataType),this.isInactive=a.toBoolean(b.isInactive),this.id=a.toString(b.id)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('query/services/dto/table-design-dto',['require','system/lang/converter','./column-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./column-dto");function c(c){c=c||{},c.showAllFields||c.showAllFields===!1||(c.showAllFields=!0),c.showDataFields||c.showDataFields===!1||(c.showDataFields=!1),c.showInactiveFields||c.showInactiveFields===!1||(c.showInactiveFields=!1),c.showSystemFields||c.showSystemFields===!1||(c.showSystemFields=!1),this.alias=a.toString(c.alias),this.caption=a.toString(c.caption),this.defaultCaption=a.toString(c.defaultCaption),this.datasheetId=a.toString(c.datasheetId),this.id=a.toString(c.id),this.key=a.toString(c.key),this.layoutX=a.toInteger(c.layoutX),this.layoutY=a.toInteger(c.layoutY),this.name=a.toString(c.name),this.queryColumns=b.fromDataCollection(c.queryColumns),this.showAllFields=a.toBoolean(c.showAllFields),this.showDataFields=a.toBoolean(c.showDataFields),this.showInactiveFields=a.toBoolean(c.showInactiveFields),this.showSystemFields=a.toBoolean(c.showSystemFields),
this.storedQueryPath=a.toString(c.storedQueryPath),this.tableType=a.toString(c.tableType),this.queryColumns&&(this.queryColumns=this.queryColumns.sort(d))}c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}};function d(a,b){var c=a.caption.toLowerCase(),d=b.caption.toLowerCase(),e=!1,f=!1;return c.indexOf("[")===-1&&c.indexOf("{")===-1||(e=!0,c=c.slice(1,c.length-1)),d.indexOf("[")===-1&&d.indexOf("{")===-1||(f=!0,d=d.slice(1,d.length-1)),e&&f||!e&&!f?c===d?0:c<d?-1:1:e?-1:1}return c});
define('query/services/dto/query-criteria-dto',['require','lodash','system/lang/converter'],function(require){"use strict";var a=require("lodash"),b=require("system/lang/converter");function c(b){b=b||{},this.expressions=a.isArray(b.expressions)?b.expressions:[b.expressions]}return c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=b[d]?new c(b[d]):null;return e}},c});
define('query/services/dto/column-design-dto',['require','lodash','system/lang/converter','./column-dto','./query-criteria-dto'],function(require){"use strict";var a=require("lodash"),b=require("system/lang/converter"),c=require("./column-dto"),d=require("./query-criteria-dto");function e(e){e=e||{},this.alias=b.toString(e.alias,null),this.caption=b.toString(e.caption,null),this.defaultCaption=b.toString(e.defaultCaption,null),this.criterias=a.isArray(e.criterias)?e.criterias:[e.criterias],this.crosstab=b.toString(e.crosstab),this.dataType=b.toString(e.dataType),this.display=b.toBoolean(e.display),this.expressionText=b.toString(e.expressionText),this.hyperlink=b.toString(e.hyperlink),this.id=b.toString(e.id,null),this.include=b.toBoolean(e.include),this.key=b.toString(e.key),this.layoutWidth=b.toInteger(e.layoutWidth,40),this.resultFilterExpression=b.toString(e.resultFilterExpression),this.sortIndex=b.toInteger(e.sortIndex),this.sortOrder=b.toString(e.sortOrder),this.tableDesignKey=b.toString(e.tableDesignKey),this.total=b.toString(e.total),this.resultSortIndex=b.toInteger(e.resultSortIndex),
this.resultSortOrder=b.toString(e.resultSortOrder),this.appendTo=new c(e.appendTo),this.updateTo=e.updateTo,this.simpleCriteria=d.fromDataCollection(e.simpleCriteria)}return e.fromDataCollection=function a(b){if(b){var c,d=[];for(c=0;c<b.length;c++)d[d.length]=new e(b[c]);return d}},e});
define('query/services/dto/operand-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.tableDesignKey=a.toString(b.tableDesignKey),this.columnId=a.toString(b.columnId),this.charOperand=a.toString(b.charOperand)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('query/services/dto/condition-dto',['require','system/lang/converter','./operand-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./operand-dto");function c(c){c=c||{},this.leftOperand=new b(c.leftOperand),this.operator=a.toString(c.operator),this.rightOperand=new b(c.rightOperand),this.nextOperator=a.toString(c.nextOperator)}return c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}},c});
define('query/services/dto/join-design-dto',['require','system/lang/converter','./condition-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./condition-dto");function c(c){c=c||{},this.conditions=b.fromDataCollection(c.conditions),this.isMiJoin=a.toBoolean(c.isMiJoin),this.joinSucc=a.toBoolean(c.joinSucc),this.joinType=a.toString(c.joinType),this.key=a.toInteger(c.key),this.leftDesignKey=a.toInteger(c.leftDesignKey),this.relDesignKey=a.toInteger(c.relDesignKey),this.rightDesignKey=a.toInteger(c.rightDesignKey),this.joinDesignKey=a.toInteger(c.joinDesignKey)}return c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}},c});
define('query/services/dto/parameter-value-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.value=a.toString(b.value),this.displayValue=a.toString(b.displayValue)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('query/services/dto/parameter-design-dto',['require','lodash','system/lang/converter','./parameter-value-dto'],function(require){"use strict";var a=require("lodash"),b=require("system/lang/converter"),c=require("./parameter-value-dto");function d(a){a=a||{},this.id=b.toString(a.id,null),this.dataType=b.toString(a.dataType),this.caption=b.toString(a.caption),this.defaultValue=b.toNullableString(a.defaultValue),this.isHidden=b.toBoolean(a.isHidden),this.familyId=b.toString(a.familyId),this.fieldId=b.toString(a.fieldId),this.isMultiValue=b.toBoolean(a.isMultiValue),this.list=b.toObject(a.list,[]),this.localizedCaption=b.toString(a.localizedCaption),this.codeTable=b.toString(a.codeTable),this.referenceCode=b.toString(a.referenceCode),this.referenceTable=b.toString(a.referenceTable),this.query=b.toString(a.query),this.isExclusive=b.toBoolean(a.isExclusive),this.parmValues=c.fromDataCollection(a.parmValues),this.parmPrompts=b.toObject(a.parmPrompts,[]),this.isAssetHierarchy=b.toBoolean(a.isAssetHierarchy),this.assetHierarchyCaption=b.toString(a.assetHierarchyCaption),
this.all=b.toBoolean(a.all),this.child=b.toBoolean(a.child),this.parent=b.toBoolean(a.parent),this.current=b.toBoolean(a.current),this.isGis=b.toBoolean(a.isGis),this.format=b.toBoolean(a.format),this.alias=b.toString(a.alias),this.distance=b.toString(a.distance),this.entyKey=b.toBoolean(a.entyKey),this.justTheDate=b.toBoolean(a.justTheDate)}return d.fromDataCollection=function a(b){if(b){var c,e=[];for(c=0;c<b.length;c++)e[e.length]=new d(b[c]);return e}},d.prototype.copyPromptValues=function b(c){this.parmPrompts=a.map(c.parmPrompts)},d});
define('query/services/dto/parameter-container-dto',['require','lodash','system/lang/converter','./parameter-design-dto'],function(require){"use strict";var a=require("lodash"),b=require("system/lang/converter"),c=require("./parameter-design-dto");function d(a){a=a||{},this.hasDependencies=b.toBoolean(a.hasDependencies),this.parmDesigns=c.fromDataCollection(a.parmDesigns)}d.prototype.copyPromptValues=function b(c){var d=e.bind(null,c);a.forEach(this.parmDesigns,d)};function e(b,c){var d=c.copyPromptValues.bind(c);a(b.parmDesigns).filter({id:c.id}).take(1).forEach(d)}return d});
define('query/services/dto/query-container-dto',['require','system/lang/converter','./table-design-dto','./column-design-dto','./join-design-dto','./parameter-container-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./table-design-dto"),c=require("./column-design-dto"),d=require("./join-design-dto"),e=require("./parameter-container-dto");function f(f){f=f||{},this.columnDesigns=c.fromDataCollection(f.columnDesigns),this.isCaseInsensitive=a.toBoolean(f.isCaseInsensitive),this.isChanged=a.toBoolean(f.isChanged),this.isDeleteForce=a.toBoolean(f.isDeleteForce),this.isDistinct=a.toBoolean(f.isDistinct),this.isFormatted=a.toBoolean(f.isFormatted),this.isTop=a.toBoolean(f.isTop),this.isUomVisible=a.toBoolean(f.isUomVisible),this.joinDesigns=d.fromDataCollection(f.joinDesigns),this.pageSize=a.toInteger(f.pageSize),this.parmContainer=new e(f.parmContainer),this.queryText=a.toString(f.queryText),this.queryType=a.toString(f.queryType),this.showTotals=a.toBoolean(f.showTotals),this.sqlChanged=a.toBoolean(f.sqlChanged),this.designChanged=a.toBoolean(f.designChanged),this.startPage=a.toInteger(f.startPage),
this.tableDesigns=b.fromDataCollection(f.tableDesigns),this.topRows=a.toInteger(f.topRows),this.uniqueId=a.toString(f.uniqueId),this.catalogPath=a.toString(f.catalogPath),this.asyncQueryRowLimit=a.toInteger(f.asyncQueryRowLimit),this.tableDesigns&&this.tableDesigns.sort(g),this.appendSource=new b(f.appendSource),this.predecessorSource=new b(f.predecessorSource),this.successorSource=new b(f.successorSource),this.designStatus=f.designStatus,this.loadStatus=f.loadStatus}function g(a,b){var c=a.caption.toLowerCase(),d=b.caption.toLowerCase();return c.indexOf("[")===-1&&c.indexOf("{")===-1||(c=c.slice(1,c.length-1)),d.indexOf("[")===-1&&d.indexOf("{")===-1||(d=d.slice(1,d.length-1)),c===d?0:c<d?-1:1}return f});
define('catalog/services/dto/catalog-item-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.id=a.toString(b.id),this.caption=a.toString(b.caption),this.defaultCaption=a.toString(b.defaultCaption),this.description=a.toString(b.description),this.path=a.toString(b.path),this.folderKey=a.toString(b.folderKey),this.itemType=a.toInteger(b.itemType),this.ownerKey=a.toString(b.ownerKey),this.ownerId=a.toString(b.ownerId),this.lockSeq=a.toString(b.lockSeq),this.query=a.toObject(b.query),this.dataset=a.toObject(b.dataset),this.createDate=a.toDate(b.createDate),this.createUser=a.toString(b.createUser),this.updateDate=a.toDate(b.updateDate),this.updateUser=a.toString(b.updateUser),this.ownerDisplay=a.toString(b.ownerDisplay),this.creatorDisplay=a.toString(b.creatorDisplay),this.updatorDisplay=a.toString(b.updatorDisplay)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('catalog/services/dto/folder-dto',['require','jquery','system/lang/converter','./catalog-item-dto'],function(require){"use strict";var a=require("jquery"),b=require("system/lang/converter"),c=require("./catalog-item-dto");function d(c){var e=[];c=c||{},this.key=b.toString(c.key),this.id=b.toString(c.id),this.description=b.toString(c.description),this.caption=b.toString(c.caption),this.folderType=b.toInteger(c.folderType),this.hasChildren=b.toBoolean(c.hasChildren),this.ownerKey=b.toString(c.ownerKey),this.ownerId=b.toString(c.ownerId),this.parentKey=b.toString(c.parentKey),this.path=b.toString(c.path),this.privilege=b.toInteger(c.privilege),this.spread=b.toInteger(c.spread),this.updateDate=b.toDate(c.updateDate),this.updateUser=b.toString(c.updateUser),this.lockSeq=b.toString(c.lockSeq),this.ownerDisplay=b.toString(c.ownerDisplay),this.updatorDisplay=b.toString(c.updatorDisplay),c.children&&(e=a.map(c.children,function(a){return new d(b.toObject(a,{}))})),this.children=e}return d});
define('catalog/services/dto/folder-priv-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key,"0"),this.userKey=a.toString(b.userKey,"0"),this.userDisplay=a.toString(b.userDisplay),this.groupKey=a.toString(b.groupKey,"0"),this.groupDisplay=a.toString(b.groupDisplay),this.folderKey=a.toString(b.folderKey,"0"),this.privilege=a.toInteger(b.privilege),this.spread=a.toInteger(b.spread)}return b});
define('catalog/services/dto/user-pref-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.userKey=a.toString(b.userKey),this.prefType=a.toInteger(b.prefType),this.name=a.toString(b.name),this.value=a.toString(b.value)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('catalog/services/dto/nav-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.caption=a.toString(b.caption)}return b.fromDataCollection=function a(c){if(void 0!==c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('catalog/services/dto/catalog-item-result-grid-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.type="",this.linkValue="",b.itemType===-1?(this.type="#query/",this.linkValue=b.key):b.itemType===-2?(this.type="#graph/",this.linkValue=b.key):b.itemType===-3?(this.type="#ssrs/viewer/",this.linkValue=b.path+"\\"+a.toString(b.id)):b.itemType===-5?(this.type="#dataset/",this.linkValue=b.key):b.itemType===-9&&(this.type="#dashboard/",this.linkValue=b.key),this.name=a.toString(b.id),this.path="<a href='"+this.type+a.toString(this.linkValue)+"'>"+a.toString(b.path)+"</a>",this.creator=a.toString(b.ownerId),this.date=a.toDate(b.createDate)}return b.fromDataCollection=function a(c){var d,e=[];for(d=0;d<c.length;d++)e[d]=new b(c[d]);return e},b});
define('catalog/services/catalog-service',['require','lodash','jquery','system/http/ajax-client','./dto/folder-dto','./dto/catalog-item-dto','./dto/folder-priv-dto','./dto/user-pref-dto','./dto/nav-dto','./dto/catalog-item-result-grid-dto'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/http/ajax-client"),d=require("./dto/folder-dto"),e=require("./dto/catalog-item-dto"),f=require("./dto/folder-priv-dto"),g=require("./dto/user-pref-dto"),h=require("./dto/nav-dto"),i=require("./dto/catalog-item-result-grid-dto"),j="api/core/userpref/",k="api/core/command/",l="api/core/catalog/",m="22",n="api/core/localizer",o=n+"/translations/objectKey/{0}?localizableType={1}&defaultValue={2}";function p(a){this.ajaxClient=a}p.dependsOn=[c],p.prototype.getAllFolders=function a(){var c=l+"folders/all/",e=b.Deferred();return this.ajaxClient.get(c,{}).done(function(a){var c=b.map(a,function(a){return new d(a)});e.resolve(c)}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.getFolder=function a(c){var e=l+"folder/"+c,f=b.Deferred();return this.ajaxClient.get(e,{}).done(function(a){f.resolve(new d(a))}).fail(function(a){f.reject(a)}),f.promise()},
p.prototype.getFoldersPaginate=function a(c,e,f){var g=l+"folders/"+c+"/pageSize/"+e+"/pageNum/"+f,h=b.Deferred();return this.ajaxClient.get(g,{}).done(function(a){a&&a.length&&0!==a.length?h.resolve(b.map(a,function(a){return new d(a)})):h.resolve(null)}).fail(function(a){h.reject(a)}),h.promise()},p.prototype.getFolderRoots=function a(){var c=b.Deferred(),e=l+"folder/roots";return this.ajaxClient.get(e,{}).done(function(a){a&&a.length&&0!==a.length?c.resolve(b.map(a,function(a){return new d(a)})):c.resolve(null)}).fail(function(a){c.reject(a)}),c.promise()},p.prototype.getPublicFolder=function a(){var c=l+"folder/public/",e=b.Deferred();return this.ajaxClient.get(c,{}).done(function(a){e.resolve(new d(a))}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.getPersonalFolder=function a(){var c=l+"folder/personal/",e=b.Deferred();return this.ajaxClient.get(c,{}).done(function(a){e.resolve(new d(a))}).fail(function(a){e.reject(a)}),e.promise()},
p.prototype.getBaselineFolder=function a(){var c=l+"folder/baseline/",e=b.Deferred();return this.ajaxClient.get(c,{}).done(function(a){e.resolve(new d(a))}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.getFolderParents=function a(c){var e=b.Deferred(),f=l+"folder/parents?path="+c;return this.ajaxClient.get(f,{}).done(function(a){e.resolve(b.map(a,function(a){return new d(a)}))}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.searchFolders=function a(c,e,f){var g=l+"folders/search?searchValue="+c+"&pageSize="+e+"&pageNum="+f,h=b.Deferred();return this.ajaxClient.get(g,{}).done(function(a){a&&a.length?h.resolve(b.map(a,function(a){return new d(a)})):h.resolve(null)}).fail(function(a){h.reject(a)}),h.promise()},p.prototype.postFolder=function a(c){var d=b.Deferred(),e=l+"folder/";return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.postQuery=function a(c){var d=b.Deferred(),e=k+"discover"
;return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.putFolder=function a(c){var d=b.Deferred(),e=l+"folder/";return this.ajaxClient.put(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.deleteFolder=function a(c){var d=b.Deferred(),e=l+"folder/";return this.ajaxClient.delete(e+c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.copyFolder=function a(c,d){var e=b.Deferred(),f=l+"folder/copy/"+c+"/"+d;return this.ajaxClient.post(f).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.moveFolder=function a(c,d){var e=b.Deferred(),f=l+"folder/move/"+c+"/"+d;return this.ajaxClient.post(f).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.getCatalogItems=function a(d){var f=b.Deferred(),g=l+"items/"+d;return this.ajaxClient.get(g,{}).done(function(a){
c.isMultiTenant()&&(a=a.filter(function(a){return a.itemType!==-12||"Role"!==a.id})),f.resolve(b.map(a,function(a){return new e(a)}))}).fail(function(a){f.reject(a)}),f.promise()},p.prototype.getCatalogItem=function a(b){var c=l+"item/";return this.ajaxClient.get(c+b)},p.prototype.getCatalogItemId=function a(b,c){var d=l+"item/"+b+"?id="+c;return this.ajaxClient.get(d)},p.prototype.getCatalogItemKey=function a(b){var c=l+"itemkey?path="+b;return this.ajaxClient.get(c)},p.prototype.getCatalogItemByPath=function a(b){var c=l+"item?path="+encodeURIComponent(b);return this.ajaxClient.get(c)},p.prototype.CanUpdateCatalogItem=function a(b){var c=l+"item/can-update/"+b;return this.ajaxClient.get(c)},p.prototype.postCatalogItem=function a(c){var d=b.Deferred(),e=l+"item/";return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.putCatalogItem=function a(c){var d=b.Deferred(),e=l+"item/"
;return this.ajaxClient.put(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.copyCatalogItems=function a(c,d){var e=b.Deferred(),f=l+"items/copy/"+d;return this.ajaxClient.post(f,c).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.moveCatalogItems=function a(c,d){var e=b.Deferred(),f=l+"items/move/"+d;return this.ajaxClient.post(f,c).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.deleteCatalogItem=function a(c){var d=b.Deferred(),e=l+"item/";return this.ajaxClient.delete(e+c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.searchCatalogItems=function a(c,d,e,f){var g=b.Deferred(),h,i,j,k;return c=c||"0",d=d||"",e=void 0===e||e,e=e?"True":"False",f=f||0,h="?searchValue="+d,i="&searchSubFolders="+e,j="&itemType="+f,k=l+"items/search/"+c+h+i+j,this.ajaxClient.get(k,{}).done(q.bind(null,this,g)).fail(function(a){g.reject(a)}),
g.promise()};function q(a,b,c){b.resolve(e.fromDataCollection(c))}p.prototype.getFolderPrivs=function a(c){var d=l+"privs/"+c,e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(a){var c=b.map(a,function(a){return new f(a)});e.resolve(c)}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.postFolderPriv=function a(c){var d=b.Deferred(),e=l+"priv";return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.putFolderPriv=function a(c){var d=b.Deferred(),e=l+"priv";return this.ajaxClient.put(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.deleteFolderPriv=function a(c){var d=b.Deferred(),e=l+"priv/"+c;return this.ajaxClient.delete(e).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},p.prototype.getPreference=function a(c,d){var e=b.Deferred(),f=j+"get/"+c+"/1?name="+d;return this.ajaxClient.get(f,{}).done(function(a){e.resolve(new g(a))
}).fail(function(a){e.reject(a)}),e.promise()},p.prototype.setPreference=function a(c){var d=b.Deferred(),e=j+"set";return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()};function r(a,b){a.resolve(i.fromDataCollection(b))}p.prototype.getTranslation=function(a,c,d){var e=b.Deferred(),f=s(a,d);return this.ajaxClient.get(f,{}).done(t.bind(null,e,c,d)).fail(function(a){e.reject(a)}),e.promise()};function s(a,b){return o.replace("{0}",encodeURIComponent(a)).replace("{1}",encodeURIComponent(m)).replace("{2}",encodeURIComponent(b))}function t(b,c,d,e){var f=a.find(e,{cultureId:c});f&&(d=f.value),b.resolve(d)}return p});
define('query/services/dto/rowset-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.columns=a.toObject(b.columns),this.familyMappings=a.toObject(b.familyMappings),this.rowColumns=a.toObject(b.rowColumns),this.rows=a.toObject(b.rows),this.totalRows=a.toInteger(b.totalRows)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('query/services/dto/query-result-dto',[],function(){"use strict";function a(){this.rowCount=0,this.columns=[],this.rows=[],this.timeoutExceeded=!1}return a});
define('system/lang/private',["require","exports"],function(require,exports){"use strict";function a(a){return a.__private__=a.__private__||{},a.__private__}return a});
define('query/model/query-result',['require','ramda','system/lang/private','mi-assert'],function(require){"use strict";var a=require("ramda"),b=require("system/lang/private"),c=require("mi-assert");function d(){b(this).rowCount=0,b(this).columns=[],b(this).rows=[],b(this).timeoutExceeded=!1}var e=d.prototype;e.getRowCount=function(){return b(this).rowCount},e.setRowCount=function(a){c.isNumber(a,"rowCount"),b(this).rowCount=a},e.getColumns=function(){return b(this).columns},e.setColumns=function(a){c.isArray(a,"columns"),b(this).columns=a},e.getVisibleColumns=function(){var c=b(this).columns;return a.filter(f,c)};function f(a){return a.getIsDisplayed()}return e.getRows=function(){return b(this).rows},e.setRows=function(a){c.isArray(a,"rows"),b(this).rows=a},e.getTimeoutExceeded=function(){return b(this).timeoutExceeded},e.setTimeoutExceeded=function(a){c.isBoolean(a,"timeoutExceeded"),b(this).timeoutExceeded=a},d});
define('query/services/dto/column-result-dto',[],function(){"use strict";function a(){this.typeName="",this.alias="",this.localizedAlias="",this.isDisplayed=!0,this.fieldDataType="",this.hyperlinkFormat="",this.columnDesignKey=-1,this.fieldKey="",this.fieldId="",this.caption="",this.defaultCaption="",this.displayUomCaption="",this.displayUomDefaultCaption="",this.storageUomCaption="",this.storageUomDefaultCaption=""}return a});
define('query/model/column-result',['require','system/lang/private','mi-assert'],function(require){"use strict";var a=require("system/lang/private"),b=require("mi-assert");function c(){a(this).typeName="",a(this).alias="",a(this).localizedAlias="",a(this).isDisplayed=!0,a(this).fieldDataType="",a(this).hyperlinkFormat="",a(this).columnDesignKey=-1,a(this).fieldKey="",a(this).fieldId="",a(this).caption="",a(this).defaultCaption="",a(this).displayUomCaption="",a(this).displayUomDefaultCaption="",a(this).storageUomCaption="",a(this).storageUomDefaultCaption="",a(this).format=""}var d=c.prototype;return d.getTypeName=function(){return a(this).typeName},d.setTypeName=function(c){b.isString(c,"typeName"),a(this).typeName=c},d.getAlias=function(){return a(this).alias},d.setAlias=function(c){b.isString(c,"alias"),a(this).alias=c},d.getLocalizedAlias=function(){return a(this).localizedAlias},d.setLocalizedAlias=function(c){b.isString(c,"localizedAlias"),a(this).localizedAlias=c},d.getIsDisplayed=function(){return a(this).isDisplayed},d.setIsDisplayed=function(c){
b.isBoolean(c,"isDisplayed"),a(this).isDisplayed=c},d.getFieldDataType=function(){return a(this).fieldDataType},d.setFieldDataType=function(c){b.isString(c,"fieldDataType"),a(this).fieldDataType=c},d.getHyperlinkFormat=function(){return a(this).hyperlinkFormat},d.setHyperlinkFormat=function(c){b.isString(c,"hyperlinkFormat"),a(this).hyperlinkFormat=c},d.getFormat=function(){return a(this).format},d.setFormat=function(c){b.isString(c,"format"),a(this).format=c},d.getColumnDesignKey=function(){return a(this).columnDesignKey},d.setColumnDesignKey=function(c){b.isNumber(c,"columnDesignKey"),a(this).columnDesignKey=c},d.getFieldKey=function(){return a(this).fieldKey},d.setFieldKey=function(c){b.isString(c,"fieldKey"),a(this).fieldKey=c},d.getFieldId=function(){return a(this).fieldId},d.setFieldId=function(c){b.isString(c,"fieldId"),a(this).fieldId=c},d.getCaption=function(){return a(this).caption},d.setCaption=function(c){b.isString(c,"caption"),a(this).caption=c},
d.getDefaultCaption=function(){return a(this).defaultCaption},d.setDefaultCaption=function(c){b.isString(c,"defaultCaption"),a(this).defaultCaption=c},d.getDisplayUomCaption=function(){return a(this).displayUomCaption},d.setDisplayUomCaption=function(c){b.isString(c,"displayUomCaption"),a(this).displayUomCaption=c},d.getDisplayUomDefaultCaption=function(){return a(this).displayUomDefaultCaption},d.setDisplayUomDefaultCaption=function(c){b.isString(c,"displayUomDefaultCaption"),a(this).displayUomDefaultCaption=c},d.getStorageUomCaption=function(){return a(this).storageUomCaption},d.setStorageUomCaption=function(c){b.isString(c,"storageUomCaption"),a(this).storageUomCaption=c},d.getStorageUomDefaultCaption=function(){return a(this).storageUomDefaultCaption},d.setStorageUomDefaultCaption=function(c){b.isString(c,"storageUomDefaultCaption"),a(this).storageUomDefaultCaption=c},d.setFormat=function(c){b.isString(c,"format"),a(this).format=c},c});
define('query/adapters/column-result-adapter',['require','ramda','mi-assert','system/lang/converter','../services/dto/column-result-dto','../model/column-result'],function(require){"use strict";var a=require("ramda"),b=require("mi-assert"),c=require("system/lang/converter"),d=require("../services/dto/column-result-dto"),e=require("../model/column-result");function f(a){var e=new d;return b.isObject(a,"data"),e.typeName=c.toString(a.typeName),e.alias=c.toString(a.alias),e.localizedAlias=c.toString(a.localizedAlias),e.isDisplayed=c.toBoolean(a.isDisplayed),e.fieldDataType=c.toString(a.fieldDataType),e.hyperlinkFormat=c.toString(a.hyperlink),e.columnDesignKey=c.toInteger(a.columnDesignKey,-1),e.fieldKey=c.toString(a.fieldKey),e.fieldId=c.toString(a.fieldId),e.caption=c.toString(a.caption),e.defaultCaption=c.toString(a.defaultCaption),e.displayUomCaption=c.toString(a.displayUomCaption),e.displayUomDefaultCaption=c.toString(a.displayUomDefaultCaption),e.storageUomCaption=c.toString(a.storageUomCaption),e.storageUomDefaultCaption=c.toString(a.storageUomDefaultCaption),e.format=c.toString(a.format),e}function g(a){var c=new e
;return b.instanceOf(a,d,"dto"),c.setTypeName(a.typeName),c.setAlias(a.alias),c.setLocalizedAlias(a.localizedAlias),c.setIsDisplayed(a.isDisplayed),c.setFieldDataType(a.fieldDataType),c.setHyperlinkFormat(a.hyperlinkFormat),c.setColumnDesignKey(a.columnDesignKey),c.setFieldKey(a.fieldKey),c.setFieldId(a.fieldId),c.setCaption(a.caption),c.setDefaultCaption(a.defaultCaption),c.setDisplayUomCaption(a.displayUomCaption),c.setDisplayUomDefaultCaption(a.displayUomDefaultCaption),c.setStorageUomCaption(a.storageUomCaption),c.setStorageUomDefaultCaption(a.storageUomDefaultCaption),c.setFormat(a.format),c}return{deserialize:f,deserializeArray:a.map(f),toModel:g,toModelArray:a.map(g)}});
define('query/services/dto/row-dto',[],function(){"use strict";function a(){this.cells=[]}return a});
define('query/model/row',['require','ramda','system/lang/private','mi-assert'],function(require){"use strict";var a=require("ramda"),b=require("system/lang/private"),c=require("mi-assert");function d(){b(this).cells=[]}var e=d.prototype;e.getCells=function(){return b(this).cells},e.setCells=function(a){c.isArray(a,"cells"),b(this).cells=a},e.getVisibleCells=function(){var c=b(this).cells;return a.filter(f,c)};function f(a){return a.isVisible()}return d});
define('query/services/dto/cell-dto',[],function(){"use strict";function a(){this.dbValue=null,this.value="",this.utcValue="",this.backColor=""}return a});
define('query/model/cell',['require','system/lang/private','mi-assert','./column-result','system/lang/converter','system/text/formatter','application/application-context','system/lang/string'],function(require){"use strict";var a=require("system/lang/private"),b=require("mi-assert"),c=require("./column-result"),d=require("system/lang/converter"),e=require("system/text/formatter"),f=require("application/application-context");require("system/lang/string");function g(){a(this).column=null,a(this).dbValue=null,a(this).value="",a(this).utcValue="",a(this).backColor="",a(this).hyperlinkRoute="",a(this).formatter=Object.resolve(e)}var h=g.prototype;return h.getColumn=function(){return a(this).column},h.setColumn=function(d){b.instanceOf(d,c,"column"),a(this).column=d},h.getDbValue=function(){var b=a(this).column,c=a(this).dbValue;if(!b)return c;switch(b.getTypeName()){case"System.DateTime":return d.toDate(c);case"System.Integer":return d.toNullableInteger(c);case"System.Double":return d.toNullableFloat(c);case"System.Boolean":return d.toBoolean(c);case"System.String":return"Boolean"===b.getFieldDataType()?c===!0||"Y"===c:d.toString(c);default:return c}},
h.setDbValue=function(b){a(this).dbValue=b},h.getValue=function(){var b=a(this).value,c=this.getDbValue(),d=a(this).column,e=a(this).formatter,g=f.user.formats.dateTime;if(!d||b)return b;switch(d.getTypeName()){case"System.DateTime":return c?e.format(c,g):"";case"System.Integer":case"System.Double":return null===c?c:e.format(c,"g");default:return c?c.toString():""}},h.setValue=function(c){b.isString(c,"value"),a(this).value=c},h.getUtcValue=function(){return a(this).utcValue},h.setUtcValue=function(c){b.isString(c,"utcValue"),a(this).utcValue=c},h.getBackColor=function(){return a(this).backColor},h.setBackColor=function(c){b.isString(c,"backColor"),a(this).backColor=c},h.getHyperlinkRoute=function(){return a(this).hyperlinkRoute},h.setHyperlinkRoute=function(c){b.isString(c,"hyperlinkRoute"),a(this).hyperlinkRoute=c},h.isVisible=function(){return a(this).column.getIsDisplayed()},g});
define('query/adapters/cell-adapter',['require','ramda','mi-assert','system/lang/converter','../services/dto/cell-dto','../model/cell'],function(require){"use strict";var a=require("ramda"),b=require("mi-assert"),c=require("system/lang/converter"),d=require("../services/dto/cell-dto"),e=require("../model/cell");function f(a){var e=new d;return b.isObject(a,"data"),void 0===a.dbValue?e.dbValue=null:e.dbValue=a.dbValue,e.value=c.toString(a.value),e.utcValue=c.toString(a.utcValue),e.backColor=c.toString(a.backColor),e}var g=a.addIndex(a.map);function h(a,c){return b.isArray(c,"dtos"),g(i.bind(null,a),c)}function i(a,c,f){var g=new e;return b.instanceOf(c,d,"dto"),g.setDbValue(c.dbValue),g.setValue(c.value),g.setUtcValue(c.utcValue),g.setBackColor(c.backColor),g.setColumn(a[f]),g}return{deserialize:f,deserializeArray:a.map(f),toModel:i,toModelArray:h}});
define('query/adapters/row-adapter',['require','ramda','mi-assert','system/lang/converter','../services/dto/row-dto','../model/row','./cell-adapter'],function(require){"use strict";var a=require("ramda"),b=require("mi-assert"),c=require("system/lang/converter"),d=require("../services/dto/row-dto"),e=require("../model/row"),f=require("./cell-adapter");function g(a){var e=new d,g=c.toObject(a.cells,[]);return b.isObject(a,"data"),e.cells=f.deserializeArray(g),e}function h(c,d){return b.isArray(d,"dtos"),a.map(i.bind(null,c),d)}function i(a,c){var g=new e,h,i;for(b.instanceOf(c,d,"dto"),b.isArray(a,"columnResults"),h=f.toModelArray(a,c.cells),i=0;i<h.length;i++)j(h,a[i],h[i]);return g.setCells(h),g}function j(a,b,c){var d=k(b,a);c.setHyperlinkRoute(d)}function k(b,c){var d=b.getHyperlinkFormat(),e=l(c);return a.all(n,e)?"":d.format.apply(d,e)}function l(b){return a.map(m,b)}function m(a){return a.getValue()}function n(a){return!a}return{deserialize:g,deserializeArray:a.map(g),toModel:i,toModelArray:h}});
define('query/adapters/query-result-adapter',['require','ramda','mi-assert','system/lang/converter','../services/dto/query-result-dto','../model/query-result','./column-result-adapter','./row-adapter'],function(require){"use strict";var a=require("ramda"),b=require("mi-assert"),c=require("system/lang/converter"),d=require("../services/dto/query-result-dto"),e=require("../model/query-result"),f=require("./column-result-adapter"),g=require("./row-adapter");function h(a){var e=new d,h=c.toObject(a.columns,[]),i=c.toObject(a.rows,[]);return b.isObject(a,"data"),e.rowCount=c.toInteger(a.rowCount),e.columns=f.deserializeArray(h),e.rows=g.deserializeArray(i),e.timeoutExceeded=c.toBoolean(a.timeoutExceeded),e}function i(a){b.instanceOf(a,d,"dto");var c=new e;return c.setRowCount(a.rowCount),c.setColumns(f.toModelArray(a.columns)),c.setRows(g.toModelArray(c.getColumns(),a.rows)),c.setTimeoutExceeded(a.timeoutExceeded),c}return{deserialize:h,deserializeArray:a.map(h),toModel:i,toModelArray:a.map(i)}});
define('query/services/dto/table-dto',['require','system/lang/converter','./column-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./column-dto");function c(c){c=c||{},this.caption=a.toString(c.caption),this.defaultCaption=a.toString(c.defaultCaption),this.id=a.toString(c.id),this.queryColumns=b.fromDataCollection(c.queryColumns),this.tableType=a.toString(c.tableType),this.queryColumns&&(this.queryColumns=this.queryColumns.sort(d))}c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}};function d(a,b){var c=a.caption.toLowerCase(),d=b.caption.toLowerCase(),e=!1,f=!1;return c.indexOf("[")===-1&&c.indexOf("{")===-1||(e=!0,c=c.slice(1,c.length-1)),d.indexOf("[")===-1&&d.indexOf("{")===-1||(f=!0,d=d.slice(1,d.length-1)),e&&f||!e&&!f?c===d?0:c<d?-1:1:e?-1:1}return c});
define('query/services/dto/join-source-dto',['require','system/lang/converter','./table-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./table-dto");function c(c){c=c||{},this.entFamilyCaption=a.toString(c.entFamilyCaption),this.entFamilyId=a.toString(c.entFamilyId),this.joinSucc=a.toBoolean(c.joinSucc),this.relFamilyCaption=a.toString(c.relFamilyCaption),this.relFamilyId=a.toString(c.relFamilyId),this.entTableData=new b(c.entTableData),this.relTableData=new b(c.relTableData)}return c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}},c});
define('query/services/dto/hyperlink-route-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.featureKey=a.toString(b.featureKey),this.sortOrder=a.toInteger(b.sortOrder),this.caption=a.toString(b.caption),this.pattern=a.toString(b.pattern),this.parm1Caption=a.toString(b.parm1Caption),this.parm2Caption=a.toString(b.parm2Caption),this.parm3Caption=a.toString(b.parm3Caption)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('query/services/dto/hyperlink-feature-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.id=a.toString(b.id),this.sortOrder=a.toInteger(b.sortOrder),this.caption=a.toString(b.caption)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('query/services/dto/hyperlink-container-dto',['require','system/lang/converter','./hyperlink-route-dto','./hyperlink-feature-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./hyperlink-route-dto"),c=require("./hyperlink-feature-dto");function d(a){a=a||{},this.features=c.fromDataCollection(a.features),this.routes=b.fromDataCollection(a.routes)}return d});
define('query/services/query-service',['require','lodash','jquery','system/http/ajax-client','./dto/rowset-dto','./dto/query-container-dto','../adapters/query-result-adapter','./dto/table-dto','./dto/table-design-dto','./dto/column-dto','./dto/join-source-dto','./dto/hyperlink-container-dto','system/lang/converter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/http/ajax-client"),d=require("./dto/rowset-dto"),e=require("./dto/query-container-dto"),f=require("../adapters/query-result-adapter"),g=require("./dto/table-dto"),h=require("./dto/table-design-dto"),i=require("./dto/column-dto"),j=require("./dto/join-source-dto"),k=require("./dto/hyperlink-container-dto"),l="api/core/queryengine",m="api/core/url",n=require("system/lang/converter");function o(a){this.ajaxClient=a}o.dependsOn=[c],o.prototype.evaluateQuerySql=function a(c){var d=b.Deferred(),e=l+"/evaluate/string",f=b.Deferred();return this.ajaxClient.post(e,{value:c}).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.getPromptArrayFromQueryString=function a(b){var c=/^p\d+$/,d=[],e,f,g=[],h=0,i=0;for(var j in b)b.hasOwnProperty(j)&&c.test(j)&&d.push(j);for(d.sort(),h=0;h<d.length;h++){if(e=d[h],f=e.match(/\d+/)[0],h.toString()!==f)for(i=h,
i=0;i<f;i++)g.push(null);g.push(b[e])}return g},o.prototype.evaluateQueryContainer=function a(c){var d=b.Deferred(),e=l+"/evaluate/container",f=b.Deferred();return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.executeQuerySql=function a(c){var e=b.Deferred(),f=l+"/execute/string",g=b.Deferred();return this.ajaxClient.post(f,{value:c}).done(function(a){e.resolve(new d(a))}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.executeQueryContainer=function a(c){var e=b.Deferred(),f=l+"/execute/container",g=b.Deferred();return this.ajaxClient.post(f,c).done(function(a){e.resolve(new d(a))}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.executeQueryContainerSync=function a(c){var d=b.Deferred(),e=l+"/executesync/container";return this.ajaxClient.post(e,c).done(function(a){d.resolve(f.deserialize(a))}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.getEntitySources=function c(){
var d=l+"/entitysources/all",e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(b){var c=a.map(b,function(a){return new g(a)});c.sort(p),e.resolve(c)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.getEntitySource=function a(c){var d=l+"/entitysource?entityFamilyId="+c,e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(a){var b=new h(a);e.resolve(b)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.getJoinSources=function a(c){var d=l+"/joinsources?entFamilyId="+c,e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(a){var c=b.map(a,function(a){return new j(a)});e.resolve(c)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.joinsourcesForRf=function a(c){var d=l+"/joinsources_for_rf?relFamilyId="+c,e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(a){var c=b.map(a,function(a){return new j(a)});e.resolve(c)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.getJoinSource=function a(c,d,e,f){var g,h=b.Deferred()
;return f=f!==!1||f,g=l+"/joinsource?predFamilyId="+c+"&relFamilyId="+d+"&succFamilyId="+e+"&getSuccessor="+f,this.ajaxClient.get(g,{}).done(function(a){var b=new j(a);h.resolve(b)}).fail(function(a){h.reject(a)}),h.promise()},o.prototype.getRelSources=function a(){var c,d=b.Deferred();return c=l+"/relsources/all",this.ajaxClient.get(c,{}).done(function(a){var c=b.map(a,function(a){return new g(a)});c.sort(p),d.resolve(c)}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.getRelSource=function a(c){var d=l+"/relsource?relFamilyId="+c,e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(a){var b=new h(a);e.resolve(b)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.compileString=function a(c){var d=b.Deferred(),f=l+"/compilestring/",g=b.Deferred(),h;return this.ajaxClient.post(f,{value:c}).done(function(a){h=new e(a),d.resolve(h)}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.compileContainer=function a(c){
var d=b.Deferred(),e=l+"/compilecontainer/",f=b.Deferred();return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.recompileContainer=function a(c){var d=b.Deferred(),f=l+"/recompilecontainer/",g=b.Deferred();return this.ajaxClient.post(f,c).done(function(a){d.resolve(new e(a))}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.compileContainerParameters=function a(c){var d=b.Deferred(),f=l+"/compileparameters/",g=b.Deferred();return this.ajaxClient.post(f,c).done(function(a){d.resolve(new e(a))}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.compileParameterDesign=function a(c){var d=b.Deferred(),e=l+"/compileparamdesign/",f=b.Deferred();return this.ajaxClient.post(e,c).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},o.prototype.getQueryAsSource=function a(c){var d=l+"/querysource?catalogItemPath="+encodeURIComponent(c),e=b.Deferred()
;return this.ajaxClient.get(d,{}).done(function(a){var b=new h(a);e.resolve(b)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.getDatasheets=function a(c){var d=l+"/datasheets?fmlyId="+c,e=b.Deferred();return this.ajaxClient.get(d,{}).done(function(a){e.resolve(a)}).fail(function(a){e.reject(a)}),e.promise()},o.prototype.getDatasheetColumns=function a(c,d){var e=l+"/datasheetColumns?fmlyId="+c+"&datasheetCaption="+d,f=b.Deferred();return this.ajaxClient.get(e,{}).done(function(a){var c=b.map(a,function(a){return new i(a)});c.sort(p),f.resolve(c)}).fail(function(a){f.reject(a)}),f.promise()},o.prototype.convertSimpleCriteria=function a(c,d,e){var f=b.Deferred(),g=l+"/convertcriteria?columnIdx="+d.toString()+"&criteriaIdx="+e.toString();return this.ajaxClient.post(g,c).done(function(a){f.resolve(a)}).fail(function(a){f.reject(a)}),f.promise()},o.prototype.convertSimpleCriteriaText=function a(c,d,e,f,g){var h=b.Deferred(),i=l+"/convertsimplecriteriatext"
;return this.ajaxClient.post(i,{queryContainer:c,toDisplay:d,columnKey:e,criteriaIndex:f,factorTexts:g}).done(function(a){h.resolve(a)}).fail(function(a){h.reject(a)}),h.promise()},o.prototype.convertCriteriaText=function a(c,d,e,f,g){var h=b.Deferred(),i=l+"/convertcriteriatext";return this.ajaxClient.post(i,{queryContainer:c,toDisplay:d,columnKey:e,criteriaIndex:f,factorText:g}).done(function(a){h.resolve(a)}).fail(function(a){h.reject(a)}),h.promise()},o.prototype.convertExpressionText=function a(c,d,e,f,g){var h=b.Deferred(),i=l+"/convertexpressiontext";return this.ajaxClient.post(i,{queryContainer:c,toDisplay:d,columnKey:e,criteriaIndex:f,factorText:g}).done(function(a){h.resolve(a)}).fail(function(a){h.reject(a)}),h.promise()},o.prototype.getUrlContainer=function a(){var c=m+"/hyperlink/container",d=b.Deferred();return this.ajaxClient.get(c,{}).done(function(a){var b=new k(a);d.resolve(b)}).fail(function(a){d.reject(a)}),d.promise()};function p(a,b){
var c=a.caption.toLowerCase(),d=b.caption.toLowerCase();return c.indexOf("[")===-1&&c.indexOf("{")===-1||(c=c.slice(1,c.length-1)),d.indexOf("[")===-1&&d.indexOf("{")===-1||(d=d.slice(1,d.length-1)),c===d?0:c<d?-1:1}return o});
define('catalog/services/catalog-constants',[],function(){"use strict";function a(){this.FOLDER_TYPE_PERSONAL=0,this.FOLDER_TYPE_BASELINE=1,this.FOLDER_TYPE_PUBLIC=2,this.FOLDER_PRIV_NONE=0,this.FOLDER_PRIV_CREATE=1,this.FOLDER_PRIV_VIEW=2,this.FOLDER_PRIV_EDIT_OWN=4,this.FOLDER_PRIV_EDIT_ALL=8,this.FOLDER_PRIV_DELETE_OWN=16,this.FOLDER_PRIV_DELETE_ALL=32,this.ITEM_TYPE_NONE=0,this.ITEM_TYPE_QUERY=-1,this.ITEM_TYPE_GRAPH=-2,this.ITEM_TYPE_REPORT=-3,this.ITEM_TYPE_SEARCH=-4,this.ITEM_TYPE_DATASET=-5,this.ITEM_TYPE_METRICVIEW=-6,this.ITEM_TYPE_EXPLORER=-7,this.ITEM_TYPE_PROJECT=-8,this.ITEM_TYPE_DASHBOARD=-9,this.ITEM_TYPE_R_SCRIPT=-10,this.ITEM_TYPE_SCRIPT=-11,this.QUERY_TYPE_NONE=0,this.QUERY_TYPE_SELECT=1,this.QUERY_TYPE_UPDATE=2,this.QUERY_TYPE_DELETE=3,this.QUERY_TYPE_APPEND=4,this.QUERY_TYPE_TRANSFORM=5,this.QUERY_TYPE_IN=6,this.QUERY_TYPE_AGGREGATE=7,this.GRP_CATALOG_ADMIN="MI Catalog Administrator",this.GRP_POWER_USER="MI Power User Role",this.KEY_PUBLIC_FOLDER="-1",this.KEY_BASELINE_FOLDER="-41",
this.KEY_PERSONAL_FOLDER="-999999999",this.CATALOG_PREFERENCE=1}return a});
define('query/services/dto/query-state-dto',['require','system/lang/converter','./query-container-dto'],function(require){"use strict";var a=require("system/lang/converter"),b=require("./query-container-dto");function c(a){a=a||{},this.version=2,this.queryContainer=new b(a.queryContainer)}return c});
define('query/model/parameter-value-model',['require','knockout'],function(require){"use strict";var a=require("knockout");function b(b){b=b||{},this.value=a.observable(b.value),this.displayValue=a.observable(b.displayValue)}return b});
define('query/adapters/parameter-value-adapter',['require','../services/dto/parameter-value-dto','../model/parameter-value-model'],function(require){"use strict";var a=require("../services/dto/parameter-value-dto"),b=require("../model/parameter-value-model");function c(){}return c.toModelObject=function a(c){return new b(c)},c.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},c.toDTO=function b(c){var d=new a;return c=c||{},d.value=c.value(),d.displayValue=c.displayValue(),d},c.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},c});
define('query/model/parameter-design-model',['require','knockout','../adapters/parameter-value-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/parameter-value-adapter");function c(c){c=c||{},this.id=a.observable(c.id),this.dataType=a.observable(c.dataType),this.caption=a.observable(c.caption),this.defaultValue=a.observable(c.defaultValue),this.isHidden=a.observable(c.isHidden),this.familyId=a.observable(c.familyId),this.fieldId=a.observable(c.fieldId),this.isMultiValue=a.observable(c.isMultiValue),this.list=a.observableArray(c.list),this.localizedCaption=a.observable(c.localizedCaption),this.codeTable=a.observable(c.codeTable),this.referenceCode=a.observable(c.referenceCode),this.referenceTable=a.observable(c.referenceTable),this.query=a.observable(c.query),this.isExclusive=a.observable(c.isExclusive),this.parameterValues=a.observableArray(b.toModelObjectArray(c.parmValues)),this.parameterPrompts=a.observableArray(c.parmPrompts),this.isAssetHierarchy=a.observable(c.isAssetHierarchy),this.child=a.observable(c.child),
this.parent=a.observable(c.parent),this.all=a.observable(c.all),this.current=a.observable(c.current),this.isGis=a.observable(c.isGis),this.format=a.observable(c.foramt),this.alias=a.observable(c.alias),this.distance=a.observable(c.distance),this.entyKey=a.observable(c.entyKey),this.justTheDate=a.observable(c.justTheDate),this.defaultValues=a.computed({read:e.bind(null,this),write:f.bind(null,this),owner:this}),this.isExclusive.subscribe(d.bind(null,this))}function d(a,b){b||a.isMultiValue(!1)}function e(a){var b=a.defaultValue();return b?b.toString().split("|"):[]}function f(a,b){b.length>1?a.defaultValue(b.join("|")):a.defaultValue(b[0])}return c});
define('query/adapters/parameter-design-adapter',['require','../services/dto/parameter-design-dto','../model/parameter-design-model','./parameter-value-adapter'],function(require){"use strict";var a=require("../services/dto/parameter-design-dto"),b=require("../model/parameter-design-model"),c=require("./parameter-value-adapter");function d(){}return d.toModelObject=function a(c){return new b(c)},d.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},d.toDTO=function b(d){var e=new a,f=d.parameterPrompts();return d=d||{},e.id=d.id()||null,e.dataType=d.dataType(),e.caption=d.caption(),e.defaultValue=d.defaultValue(),e.isHidden=d.isHidden(),e.familyId=d.familyId(),e.fieldId=d.fieldId(),e.isMultiValue=d.isMultiValue(),e.list=d.list(),e.localizedCaption=d.localizedCaption(),e.codeTable=d.codeTable(),e.referenceCode=d.referenceCode(),e.referenceTable=d.referenceTable(),e.query=d.query(),e.isExclusive=d.isExclusive(),e.parmValues=c.toDTOArray(d.parameterValues()),e.isAssetHierarchy=d.isAssetHierarchy(),e.isAssetHierarchy?(e.parmPrompts="0"===f[0]||0===f[0]?["-1"]:f,
e.assetHierarchyCaption=d.assetHierarchyCaption):e.parmPrompts=f,e.child=d.child(),e.parent=d.parent(),e.all=d.all(),e.current=d.current(),e.isGis=d.isGis(),e.format=d.format(),e.alias=d.alias(),e.distance=d.distance(),e.entyKey=d.entyKey(),e.justTheDate=d.justTheDate(),e},d.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},d});

define('text!query/execution/views/query-prompt.html',[],function () { return '<div class="query-prompt"\r\n     data-bind="foreach: prompts">\r\n    <div class="form-group"\r\n         data-bind="css: { \'has-error\': !$root.validatePrompt($data) }">\r\n        <!-- ko ifnot: isHidden -->\r\n            <label data-bind="text: caption"></label>\r\n            <!-- ko if: options && options.length -->\r\n                <!-- ko if: isExclusive -->\r\n                    <!-- ko if: isMultiValue -->\r\n                        <mi-select data-bind="miproperty: {\r\n                                                  options: options,\r\n                                                  multiple: true,\r\n                                                  optionsText: \'displayValue\',\r\n                                                  optionsValue: \'value\',\r\n                                                  optionsCaption: \'\',\r\n                                                  selectedOptions: values\r\n                                              },\r\n                                              event: {\r\n                                                  selected: $root.multiSelectValueChanged.bind($root)\r\n                                   }">\r\n                        </mi-select>\r\n                    <!-- /ko -->\r\n                    <!-- ko ifnot: isMultiValue -->\r\n                        <mi-select data-bind="miproperty: {\r\n                                                  options: options,\r\n                                                  multiple: false,\r\n                                                  optionsText: \'displayValue\',\r\n                                                  optionsValue: \'value\',\r\n                                                  optionsCaption: \'\',\r\n                                                  value: value\r\n                                    }">\r\n                        </mi-select>\r\n                    <!-- /ko -->\r\n                <!-- /ko -->\r\n                <!-- ko ifnot: isExclusive -->\r\n                    <!-- ko if: isMultiValue -->\r\n                        <mi-select data-bind="miproperty: {\r\n                                                  options: options,\r\n                                                  multiple: true,\r\n                                                  optionsText: \'displayValue\',\r\n                                                  optionsValue: \'value\',\r\n                                                  optionsCaption: \'\',\r\n                                                  selectedOptions: values\r\n                                              },\r\n                                              event: {\r\n                                                  selected: $root.multiSelectValueChanged.bind($root)\r\n                                   }">\r\n                        </mi-select>\r\n                    <!-- /ko -->\r\n                    <!-- ko ifnot: isMultiValue -->\r\n                        <mi-multi-value data-bind="miproperty: {\r\n                                                  options: cboOptions,\r\n                                                  multiple: false,\r\n                                                  optionsText: \'displayValue\',\r\n                                                  optionsValue: \'value\',\r\n                                                  optionsCaption: \'\',\r\n                                                  value: value\r\n                                    }">\r\n                        </mi-multi-value>\r\n                    <!-- /ko -->\r\n                <!-- /ko -->\r\n            <!-- /ko -->\r\n            <!-- ko ifnot: (options && options.length) -->\r\n                <!-- ko if: isAssetHierarchy -->\r\n                    <mi-asset-context dialog data-bind="value: value"></mi-asset-context>\r\n                <!-- /ko -->\r\n                <!-- ko ifnot: isAssetHierarchy -->\r\n                    <div data-bind="template: valueTemplate"></div>\r\n                <!-- /ko -->\r\n            <!-- /ko -->\r\n        <!-- /ko -->\r\n    </div>\r\n\r\n    <!-- ko if: validationMessage -->\r\n        <p class="invalid-value bg-danger text-danger">\r\n            <button type="button"\r\n                    class="close"\r\n                    data-bind="click: $root.clearPromptValidationMessage($data),\r\n                               attr: { \'aria-label\': $root.translate(\'CLOSE\')}">\r\n                <span aria-hidden="true">&times;</span>\r\n            </button>\r\n            <span data-bind="text: validationMessage" />\r\n        </p>\r\n    <!-- /ko -->\r\n</div>\r\n\r\n<script type="text/html" id="prompt-text-template">\r\n    <input type="text" class="form-control" data-bind="value: value" />\r\n</script>\r\n<script type="text/html" id="prompt-number-template">\r\n    <input type="text"\r\n           class="form-control"\r\n           data-bind="textInput: value" />\r\n</script>\r\n<script type="text/html" id="prompt-datetime-template">\r\n    <mi-date-time pick-time="true"\r\n                  use-seconds="true"\r\n                  data-bind="value: value,\r\n                             attr: { format: $root.format }" />\r\n</script>\r\n<script type="text/html" id="prompt-date-template">\r\n    <mi-date-time pick-time="false"\r\n                  data-bind="value: value,\r\n                             attr: { format: $root.dateFormat }" />\r\n</script>';});

define('assets/services/asset-context-dto',['require','system/globalization/translator','system/lang/converter'],function(require){"use strict";var a=require("system/globalization/translator"),b=require("system/lang/converter");function c(a){a=a||{},this.entityKey=b.toString(a.entityKey),this.description="-1"===this.entityKey?d("ASSET_HIERARCHY_ROOT"):b.toString(a.description),this.type=b.toString(a.type),this.familyId=b.toString(a.familyId),this.siteKey=b.toString(a.siteKey)}c.fromDataCollection=function a(b){for(var d=[],e=0;e<b.length;e++)d[d.length]=new c(b[e]);return d},c.fromHierarchyDTO=function a(b){return b?new c({entityKey:b.entityKey,description:b.description,type:"Hierarchy",familyId:b.familyId,siteKey:b.siteKey}):c.default()},c.fromGroupDTO=function a(b){return new c(b?{entityKey:b.entityKey,description:b.groupid,type:"Group",siteKey:b.siteKey}:{type:"Group"})},c.default=function a(b){var e=d("ASSET_HIERARCHY_ROOT");return new c({entityKey:b||"-1",description:e,type:"Hierarchy"})};function d(b){return Object.resolve(a).translate(b)}return c});
define('assets/services/hierarchy-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){this.entityKey=a.toString(b.entityKey),this.description=a.toString(b.description),this.familyKey=a.toString(b.familyKey),this.familyId=a.toString(b.familyId),this.siteKey=a.toNullableString(b.siteKey),this.hasChildren=null,b.childCount&&(this.hasChildren=a.toInteger(b.childCount)>0),b.hierarchyPath&&(this.hierarchyPath=a.toString(b.hierarchyPath))}return b.fromDataCollection=function a(c){for(var d=[],e=0;e<c.length;e++)d[d.length]=new b(c[e]);return d},b});
define('assets/services/hierarchy-paging-dto',[],function(){"use strict";function a(a){this.page=a.page||1,this.pageSize=a.per_page||25,this.data=null}return a});
define('assets/services/taxonomy-dto',['require','lodash','system/lang/converter'],function(require){"use strict";var a=require("lodash"),b=require("system/lang/converter");function c(a,c){this.code=b.toString(a),this.description=b.toString(c),this.children=[]}return c.fromDataCollection=function b(d){for(var e=[],f=a.values(a.groupBy(d,"categoryCode")),g,h,i,j,k=0;k<f.length;k++){g=new c(f[k][0].categoryCode,f[k][0].categoryDescription),e[e.length]=g,h=a.values(a.groupBy(f[k],"classCode"));for(var l=0;l<h.length;l++){i=new c(h[l][0].classCode,h[l][0].classDescription),g.children[g.children.length]=i;for(var m=0;m<h[l].length;m++)j=new c(h[l][m].typeCode,h[l][m].typeDescription),i.children[i.children.length]=j}}return e},c});
define('assets/models/family',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.id=a.toString(b.id),this.caption=a.toString(b.caption)}return b.fromDataCollection=function a(c){var d,e=[];for(d=0;d<c.length;d++)e[d]=new b(c[d]);return e},b});
define('assets/models/field',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){this.key=a.toString(b.key),this.caption=a.toString(b.caption)}return b});
define('assets/models/hierarchy-configuration',['require','system/lang/converter','assets/models/family','assets/models/field','system/knockout/knockout-manager'],function(require){"use strict";var a=require("system/lang/converter"),b=require("assets/models/family"),c=require("assets/models/field"),d=require("system/knockout/knockout-manager");function e(e){var h,i;if(e=e||{},this.kom=Object.resolve(d),this.entityKey=a.toString(e.entityKey),this.displayFieldKey=this.kom.observable(a.toString(e.displayFieldKey)),this.parentDisplayFieldKey=this.kom.observable(a.toString(e.parentDisplayFieldKey)),this.parentKey=this.kom.observable(a.toString(e.parentKey)),this.childKey=this.kom.observable(a.toString(e.childKey)),i=[],e.children)for(h=0;h<e.children.length;h++)i[i.length]=new b(e.children[h]);if(this.children=this.kom.observableArray(i),this.relationshipKey=this.kom.observable(a.toString(e.relationshipKey)),i=[],e.relationships)for(h=0;h<e.relationships.length;h++)i[i.length]=new b(e.relationships[h]);if(this.relationships=this.kom.observableArray(i),this.taxonomyCategoryFieldKey=this.kom.observable(a.toString(e.taxonomyCategoryFieldKey)),
this.parentTaxonomyCategoryFieldKey=this.kom.observable(a.toString(e.parentTaxonomyCategoryFieldKey)),this.taxonomyClassFieldKey=this.kom.observable(a.toString(e.taxonomyClassFieldKey)),this.parentTaxonomyClassFieldKey=this.kom.observable(a.toString(e.parentTaxonomyClassFieldKey)),this.taxonomyTypeFieldKey=this.kom.observable(a.toString(e.taxonomyTypeFieldKey)),this.parentTaxonomyTypeFieldKey=this.kom.observable(a.toString(e.parentTaxonomyTypeFieldKey)),this.level=this.kom.observable(a.toInteger(e.level)),i=[],e.fields)for(h=0;h<e.fields.length;h++)i[i.length]=new c(e.fields[h]);if(this.fields=this.kom.observableArray(i),i=[],e.parentFields)for(h=0;h<e.parentFields.length;h++)i[i.length]=new c(e.parentFields[h]);this.parentFields=this.kom.observableArray(i),this.isNotRecursive=this.kom.computed(g.bind(null,this)),this.kom.tracker.hashFunction=f.bind(null,this),this.kom.tracker.markCurrentStateAsClean()}e.prototype.isDirty=function(){return this.kom.isDirty()},
e.prototype.markClean=function(){this.kom.tracker.markCurrentStateAsClean()},e.prototype.dispose=function(){this.kom.dispose()};function f(a){var b;return b={level:a.level(),displayField:a.displayFieldKey(),parentFamilyKey:a.parentKey(),childFamilyKey:a.childKey(),relationshipKey:a.relationshipKey(),taxonomyCategeoryField:a.taxonomyCategoryFieldKey(),taxonomyClassField:a.taxonomyClassFieldKey(),taxonomyTypeField:a.taxonomyTypeFieldKey(),parentDisplayField:a.parentDisplayFieldKey(),parentTaxonomyCategeoryField:a.parentTaxonomyCategoryFieldKey(),parentTaxonomyClassField:a.parentTaxonomyClassFieldKey(),parentTaxonomyTypeField:a.parentTaxonomyTypeFieldKey()},JSON.stringify(b)}function g(a){return 0===a.level()&&a.parentKey()!==a.childKey()}return e});
define('assets/models/hierarchy-config-dto',[],function(){"use strict";function a(a){a=a||{},this.entityKey=a.entityKey,this.displayFieldKey=a.displayFieldKey(),this.parentKey=a.parentKey(),this.childKey=a.childKey(),this.relationshipKey=a.relationshipKey(),this.taxonomyCategoryFieldKey=a.taxonomyCategoryFieldKey(),this.taxonomyClassFieldKey=a.taxonomyClassFieldKey(),this.taxonomyTypeFieldKey=a.taxonomyTypeFieldKey(),this.level=a.level(),this.parentDisplayFieldKey=a.parentDisplayFieldKey(),this.parentTaxonomyCategoryFieldKey=a.parentTaxonomyCategoryFieldKey(),this.parentTaxonomyClassFieldKey=a.parentTaxonomyClassFieldKey(),this.parentTaxonomyTypeFieldKey=a.parentTaxonomyTypeFieldKey()}return a});
define('assets/adapters/hierarchy-config-adapter',['require','assets/models/hierarchy-configuration','assets/models/hierarchy-config-dto'],function(require){"use strict";var a=require("assets/models/hierarchy-configuration"),b=require("assets/models/hierarchy-config-dto");function c(){}return c.fromDTOArray=function(b){var c,d,e=[];for(c=0;c<b.length;c++)d=new a(b[c]),e[e.length]=d;return e},c.toDTO=function(a){return new b(a)},c});
define('assets/services/hierarchy-service',['require','jquery','system/http/ajax-client','assets/services/hierarchy-dto','assets/services/hierarchy-paging-dto','assets/services/taxonomy-dto','assets/services/asset-context-dto','assets/adapters/hierarchy-config-adapter','assets/models/family','assets/models/field','system/globalization/translator','application/application-context'],function(require){"use strict";var a=require("jquery"),b=require("system/http/ajax-client"),c=require("assets/services/hierarchy-dto"),d=require("assets/services/hierarchy-paging-dto"),e=require("assets/services/taxonomy-dto"),f=require("assets/services/asset-context-dto"),g=require("assets/adapters/hierarchy-config-adapter"),h=require("assets/models/family"),i=require("assets/models/field"),j=require("system/globalization/translator"),k=require("application/application-context"),l="api/common/assethierarchy/",m="MI_AST_GRP",n="api/core/userpref",o="asset-hierarchy-key",p=7;function q(a,b){this.ajaxClient=a,this.request=null,this.translator=b}q.dependsOn=[b,j],q.prototype.get=function(){var b=a.Deferred();return this.ajaxClient.get(l).done(A.bind(null,b)).fail(b.reject.bind(b)),b},q.prototype.children=function b(c,d,e,f,g,h){var i=a.Deferred(),j=l+"children";return c&&(j+="/"+c.toString()),
j+="?taxonomyCategory="+d+"&taxonomyClass="+e+"&taxonomyType="+f+"&page="+g+"&pageSize="+h,this.request=this.ajaxClient.get(j),this.request.done(v.bind(null,this,i)),this.request.fail(t.bind(null,i)),i.promise()},q.prototype.childrenFilteredBySites=function(b,c,d,e,f,g,h){var i=a.Deferred(),j=l+"children";return b&&(j+="/"+b.toString()),j+="?taxonomyCategory="+c+"&taxonomyClass="+d+"&taxonomyType="+e+"&page="+f+"&pageSize="+g,this.request=this.ajaxClient.post(j,h),this.request.done(v.bind(null,this,i)),this.request.fail(t.bind(null,i)),i.promise()},q.prototype.search=function b(c,d,e){var f=a.Deferred(),g=l;return g+="search?term="+encodeURIComponent(c)+"&page="+d+"&pageSize="+e,this.ajaxClient.get(g).done(w.bind(null,this,f)).fail(f.reject.bind(f)),f.promise()},q.prototype.searchFilteredBySites=function(b,c,d,e){var f=a.Deferred(),g=l;return g+="search?term="+encodeURIComponent(b)+"&page="+c+"&pageSize="+d,this.ajaxClient.post(g,e).done(w.bind(null,this,f)).fail(f.reject.bind(f)),
f.promise()},q.prototype.assets=function b(c,d){var e,f=a.Deferred(),g=l+"assets/"+c.toString();if(d&&d.length>0)for(e=0;e<d.length;e++)g+=(0===e?"?":"&")+"families="+d[e].toString();return this.ajaxClient.get(g).done(u.bind(null,f)).fail(f.reject.bind(f)),f.promise()},q.prototype.assetsFilteredBySites=function b(c,d){var e=a.Deferred(),f=l+"assets/"+c.toString();return this.ajaxClient.post(f,d).done(u.bind(null,e)).fail(e.reject.bind(e)),e.promise()},q.prototype.abort=function a(){this.request&&this.request.abort()},q.prototype.taxonomy=function b(){var c=a.Deferred();return this.ajaxClient.get(l+"taxonomy").done(x.bind(null,c)).fail(c.reject.bind(c)),c.promise()},q.prototype.path=function b(c){var d=a.Deferred();return c&&"-1"!==c&&"0"!==c?(this.request=this.ajaxClient.get(l+"path/"+c),this.request.done(y.bind(null,this,d)),this.request.fail(d.reject.bind(d)),d.promise()):(setTimeout(y.bind(null,this,d,[]),0),d.promise())},q.prototype.pathAll=function b(c,d){
var e=a.Deferred(),f=l+"pathAll/"+d;return this.ajaxClient.post(f,c).done(z.bind(null,this,e)).fail(e.reject.bind(e)),e.promise()},q.prototype.families=function(){var b=a.Deferred();return this.ajaxClient.get(l+"families").done(B.bind(null,b)).fail(b.reject.bind(b)),b.promise()},q.prototype.relationships=function(b){var c=a.Deferred();return this.ajaxClient.get(l+"families/"+b.toString()).done(B.bind(null,c)).fail(c.reject.bind(c)),c.promise()},q.prototype.getPartialFamily=function(b){var c=a.Deferred();return this.ajaxClient.get(l+"family/"+b.toString()).done(D.bind(null,c)).fail(c.reject.bind(c)),c.promise()},q.prototype.relationshipsById=function(){var b=a.Deferred();return this.ajaxClient.get(l+"families/"+m).done(B.bind(null,b)).fail(b.reject.bind(b)),b.promise()},q.prototype.relatedFamilies=function(b,c){var d=l+"families/"+b.toString()+"/"+c.toString(),e=a.Deferred();return this.ajaxClient.get(d).done(B.bind(null,e)).fail(e.reject.bind(e)),e.promise()},
q.prototype.familyFields=function(b){var c=a.Deferred();return this.ajaxClient.get(l+"families/"+b.toString()+"/fields").done(C.bind(null,c)).fail(c.reject.bind(c)),c.promise()},q.prototype.updateConfiguration=function(a){return this.ajaxClient.put(l,a)},q.prototype.rebuild=function(){return this.ajaxClient.post(l+"rebuild")},q.prototype.storeAssetHierarchyKey=function(a){return this.ajaxClient.post(n+"/set",r(a))};function r(a){return{userKey:s(),prefType:p,name:o,value:a}}function s(){return k.user.key}function t(a,b,c,d){"abort"!==c&&a.reject(b,c,d)}function u(a,b){a.resolve(c.fromDataCollection(b))}function v(a,b,e){var f;a.request=null,f=new d(e),f.data=c.fromDataCollection(e.data),b.resolve(f)}function w(a,b,e){var f;f=new d(e),f.data=c.fromDataCollection(e.data),b.resolve(f)}function x(a,b){a.resolve(e.fromDataCollection(b))}function y(a,b,c){var d=f.fromDataCollection(c);d.unshift({description:a.translator.translate("ASSET_HIERARCHY_ROOT"),entityKey:"-1"}),b.resolve(d)}
function z(a,b,c){b.resolve(f.fromDataCollection(c))}function A(a,b){a.resolve(g.fromDTOArray(b))}function B(a,b){var c,d=[];for(c=0;c<b.length;c++)d[d.length]=new h(b[c]);a.resolve(d)}function C(a,b){var c,d=[];for(c=0;c<b.length;c++)d[d.length]=new i(b[c]);a.resolve(d)}function D(a,b){var c={},d=0;for(c.relationships=[],c.parentFields=[],d=0;d<b.parentFields.length;d++)c.parentFields[c.parentFields.length]=new i(b.parentFields[d]);for(d=0;d<b.relationships.length;d++)c.relationships[c.relationships.length]=new h(b.relationships[d]);a.resolve(c)}return q});

define('text!assets/views/asset-hierarchy-control-filter.html',[],function () { return '<div class="filter-trigger-container">\r\n    <button class="btn btn-default btn--bare actionable actionable--secondary filter-trigger-btn">\r\n        <i class="icon-collection-filter"></i>\r\n        <span class="filter-txt label--inline" for="filter-icon">Filter</span>\r\n    </button>\r\n    <button class="ahc-filters-clear-btn pull-right hide">Clear</button>\r\n</div>\r\n<div class="uacb-filter-popup hide"></div>';});

define('assets/asset-hierarchy-control-filter',['require','jquery','assets/services/hierarchy-service','spa/ko/knockout-view-model','system/knockout/knockout-manager','system/globalization/translator','text!./views/asset-hierarchy-control-filter.html'],function(require){"use strict";var a=require("jquery"),b=require("assets/services/hierarchy-service"),c=require("spa/ko/knockout-view-model"),d=require("system/knockout/knockout-manager"),e=require("system/globalization/translator"),f=require("text!./views/asset-hierarchy-control-filter.html");function g(a,c,g){h.call(this,f),this.service=Object.resolve(b),this.translator=Object.resolve(e),this.categories=null,this.classes=null,this.types=null,this.currentCategory=a,this.currentClass=c,this.currentType=g,this.kom=Object.resolve(d)}var h=Object.inherit(c,g);g.prototype.load=function a(){this.categories=this.kom.observableArray(),this.classes=this.kom.computed(m.bind(null,this)),this.types=this.kom.computed(n.bind(null,this)),this.service.taxonomy().done(l.bind(null,this))},g.prototype.attach=function b(c){c.attach(a(f)),h.prototype.attach.call(this,c),c.element.querySelector(".apply").addEventListener("click",this),c.$element.addClass("asset-hierarchy-filter-popover")},
g.prototype.detach=function(a){a.element.querySelector(".apply").removeEventListener("click",this),h.prototype.detach(a)},g.prototype.unload=function a(){this.kom.dispose()},g.prototype.translate=function a(b){return this.translator.translate(b)},g.prototype.handleEvent=function b(c){"click"===c.type&&c.target.classList.contains("apply")&&(a(".hierarchy-control-filter")[0].closeFilter(),a(".hierarchy-control-filter").trigger("filter-closed"))};function i(a,b){var c,d;for(c=a.currentCategory().code,d=0;d<b.length;){if(b[d].code===c){a.currentCategory(b[d]);break}d++}}function j(a){var b,c,d;for(b=a.currentCategory(),c=a.currentClass().code,d=0;d<b.children.length;){if(b.children[d].code===c){a.currentClass(b.children[d]);break}d++}}function k(a){var b,c,d;for(b=a.currentClass(),c=a.currentType().code,d=0;d<b.children.length;){if(b.children[d].code===c){a.currentType(b.children[d]);break}d++}}function l(a,b){a.currentCategory()&&i(a,b),a.currentClass()&&j(a),a.currentType()&&k(a),
a.categories(b)}function m(a){return a.currentCategory()?a.currentCategory().children:[]}function n(a){return a.currentClass()?a.currentClass().children:[]}return g});

define('text!assets/views/asset-hierarchy-control.html',[],function () { return '<asset-hierarchy-control data-bind="attr:{enableMultiSelect:settings.multiSelect}"></asset-hierarchy-control>\r\n';});


define('text!assets/views/asset-hierarchy-control-search.html',[],function () { return '<input placeholder="Search" type="text" class="ahc-search-input text-input" />\r\n<i class="ahc-search-icon icon-global-search"></i>\r\n<i class="ahc-search-clear-icon icon-multiply icon-close hide"></i>';});

define('ui/elements/list-group-item/view-model',['system/globalization/translator'],function(){"use strict";var a=require("system/globalization/translator"),b=Object.create(HTMLElement.prototype);b.createdCallback=function(){var b,d,e,f,g;this.translator=Object.resolve(a),this.className="list-group-item",b=document.createElement("div"),b.classList.add("background-div"),this.appendChild(b),d=document.createElement("div"),d.classList.add("block-group"),d.classList.add("mi-li-body"),this.appendChild(d),e=document.createElement("div"),e.setAttribute("name","selector"),d.appendChild(e),l(this),e=document.createElement("div"),g=document.createElement("span"),f=document.createElement("span"),g.setAttribute("name","text"),f.setAttribute("name","custom-icon"),g.classList.add("system-ellipsis-text"),e.appendChild(f),e.appendChild(g),d.appendChild(e),this._listItemIcon=f,m(this),c(this)},b.attachedCallback=function(){this.querySelector(".mi-li-body").addEventListener("click",this)},b.attributeChangedCallback=function(a,b,c){
"selector"===a||"multiselect"===a||"radio-child-only"===a?l(this):"checked"===a?r(this,c):"description"===a&&this.value?q(this):"icon-class"===a?s(this,c):"has-children"===a?m(this):"use-html"===a?q(this):"disabled"===a?n(this,c):"disabledicon"===a&&o(this,c)},b.handleEvent=function(a){"click"===a.type?t(this,a):"change"===a.type&&u(this,a)};function c(a){a._value=null,Element.defineProperty(a,"value",{get:f.bind(null,a),set:g.bind(null,a)}),Element.defineProperty(a,"listItemIcon",{get:d.bind(null,a),set:e.bind(null,a)})}function d(a){return a._listItemIcon}function e(a,b){}function f(a){return a._value}function g(a,b){a._value=b,q(a),m(a)}function h(a,b,c){var d=document.createElement("span"),e=document.createElement("input");"true"===a.getAttribute("multiselect")?(e.type="checkbox",d.classList.add("custom-checkbox")):e=i(a,e),a.getAttribute("checked")?e.checked="true"===a.getAttribute("checked"):e.checked=!1,e.setAttribute("selector",!0),b.appendChild(d),b.appendChild(e),
c.classList.add("selector-seperator")}function i(a,b){var c=!!a.querySelector("i.icon-right-arrow"),d=a.getAttribute("radio-child-only");return b=j(b),d&&c&&(b.style.visibility="hidden"),b}function j(a){return a.type="radio",a.name="list-group-radio",a}function k(a,b,c){var d=document.createElement("i");d.className="icon-plus",d.title=a.translator.translate("ADD_ASSET"),b.appendChild(d),c.classList.add("selector-seperator")}function l(a){var b=a.getAttribute("selector"),c,d=a.querySelector('[name="selector"]'),e=a.querySelector('[name="text"]');d.hasChildNodes()&&(c=d.querySelector("input"),c&&c.removeEventListener("checked",a),d.innerHTML=""),"toggle"===b?h(a,d,e):"addOnly"===b&&k(a,d,e)}function m(a){var b,c,d,e,f=a.querySelector(".mi-li-body");c=a.getAttribute("has-children"),c?"true"===c?d=!0:(e=a.value[c],d=e instanceof Function?e():e):d=!1,d&&!f.querySelector('i[name="icon"]')?(b=document.createElement("i"),b.className=a.getAttribute("icon-class"),
b.title=a.translator.translate("EXPAND"),b.setAttribute("name","icon"),f.appendChild(b)):d||(b=f.querySelector('i[name="icon"]'))&&f.removeChild(b)}function n(a,b){b===!0||"true"===b?a.classList.add("disabled"):b!==!1&&"false"!==b||a.classList.remove("disabled")}function o(a,b){b===!0||"true"===b?a.classList.add("disabledIcon"):b!==!1&&"false"!==b||a.classList.remove("disabledIcon")}function p(a){var b,c=a.querySelector(".mi-li-body");c.querySelector('i[name="icon"]')||(b=document.createElement("i"),b.className=a.getAttribute("icon-class"),b.setAttribute("name","icon"),c.appendChild(b))}function q(a){var b,c,d=a.getAttribute("description")||"description",e=a.getAttribute("use-html");a.value&&(b=a.value[d],c=b instanceof Function?b.call(a.value):b,e?a.querySelector('[name="text"]').innerHTML=c:a.querySelector('[name="text"]').textContent=c)}function r(a,b){var c=a.querySelector('[name="selector"] input');c&&(c.checked="false"!==b,
c.checked?c.previousSibling.classList.add("checked"):c.previousSibling.classList.remove("checked"))}function s(a,b){var c=a.querySelector('[name="icon"]');null!==c?c.className=b:(p(a),c=a.querySelector('[name="icon"]'),c.className=b)}function t(a,b){var c;if(b.cancelBubble=!0,b.preventDefault=!0,c=new CustomEvent("click",{bubbles:!0,cancelable:!0}),"selector"===b.target.getAttribute("name")||"selector"===b.target.parentElement.getAttribute("name"))if("INPUT"===b.target.tagName)"radio"!==b.target.getAttribute("type")&&"checkbox"!==b.target.getAttribute("type")||(c.selecting=b.target.checked);else if("I"===b.target.tagName){if("true"===a.getAttribute("disabledicon"))return;c.selecting=!0}a.dispatchEvent(c)}function u(a,b){var c,d;c=b.target.checked,a.setAttribute("checked",b.target.checked),d=b.target.checked,c!==d&&(b.target.checked=c)}return document.registerElement("mi-li",{prototype:b}),b});
define('ui/elements/searchbox/view-model',['lodash','jquery','system/globalization/translator'],function(){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/globalization/translator"),d=Object.create(HTMLElement.prototype),e=["key","description","page","page-size","scroll-percent","use-html","multiselect","selector"];d.createdCallback=function(){var b;this.classList.add("btn"),this.classList.add("btn-icon"),b=document.createElement("i"),b.className="icon-search",this.appendChild(b),this.search=a.debounce(q,500),this._searchDiv=null,this._searchList=null,this._value="",Element.defineProperty(this,"value",{get:o.bind(null,this),set:p.bind(null,this)}),this._closeSearchBind=this.closeSearch.bind(this),this._resizeBind=i.bind(null,this),this.isInToolbar=!1,this.disabled=!1,this.translator=null},d.attachedCallback=function(){this.addEventListener("click",this),window.addEventListener("resize",this._resizeBind),this.translator=Object.resolve(c),this.title=f(this,"SEARCH")},d.detachedCallback=function(){this._searchDiv&&j(this),
window.removeEventListener("resize",this._resizeBind),this.isInToolbar&&this._searchList&&k(this)},d.handleEvent=function(a){"input"===a.type?(this._value=a.target.value,n(this)):"click"===a.type&&"I"===a.target.tagName&&(a.target.classList.contains("icon-multiply")?r(this):a.target.classList.contains("icon-search")&&!this.disabled&&(w(this,a),g(this)))},d.attributeChangedCallback=function(b,c,d){var f;"delay"===b?this.search=a.debounce(q,d):"disabled"===b?this.disabled="true"===d:this.searchDiv&&(f=this.searchDiv.querySelector(".search-list"))&&e.indexOf(b)>-1&&f.setAttribute(b,d)},d.closeSearch=function(a){if(""===this._value)if(this._searchList&&"none"!==b(this._searchList).css("display")){if(a.target===this._searchDiv.querySelector("input"))return;this._searchDiv&&""===this._searchDiv.querySelector("input").value&&(j(this),k(this))}else{
if(a&&"blur"!==a.type&&(a.target===this||a.target.parentElement===this||a.target===this._searchDiv||a.target.parentElement===this._searchDiv))return;j(this)}},d.toggleEnabled=function(a){var b=this.querySelector("Search");b.disabled="true"===a},d.toggleSearch=function(){g(this)};function f(a,b){return a.translator.translate(b.toUpperCase())}function g(a){var b;a._searchDiv||a.isInToolbar&&a._searchList?(r(a),j(a),k(a)):(a._searchDiv=document.createElement("div"),a._searchDiv.className="mi-searchbox","MI-TOOL-BAR"!==a.parentElement.tagName?a.parentElement.appendChild(a._searchDiv):a.parentElement.parentElement.insertBefore(a._searchDiv,a.parentElement.nextElementSibling),b=document.createElement("input"),b.setAttribute("type","text"),b.className="form-control mi-searchbox",b.value=a.value,b.addEventListener("blur",a._closeSearchBind),a._searchDiv.appendChild(b),b.focus(),b=document.createElement("i"),b.className="icon-multiply",a._searchDiv.appendChild(b),b.addEventListener("click",a),
"true"!==a.getAttribute("custom-search")&&(b=document.createElement("mi-list-group"),Element.upgrade(b),b.classList.add("search-list"),b.classList.add("dropdown-menu-left"),s(a,b),b.loader=t.bind(null,a),"MI-TOOL-BAR"!==a.parentElement.tagName?a._searchDiv.appendChild(b):(a.isInToolbar=!0,a._searchDiv.parentElement.insertBefore(b,a._searchDiv.nextElementSibling),a._searchList=b,a._searchList.searchResult=a._searchList.parentElement.searchResult,h(a,b)),i(a)),m(a),l(a),a._searchDiv.addEventListener("input",a))}function h(a){a._searchList.addEventListener("click",function(b){b.target===this?g(a):"MI-LI"===b.target.tagName&&w(a,b)})}function i(a){var c;"true"!==a.getAttribute("custom-search")&&(c=a.parentElement)&&("MI-TOOL-BAR"===c.nodeName&&(c=c.parentElement),a._searchDiv&&(a.isInToolbar?a._searchList&&(a._searchList.style.height=(c.clientHeight-77).toString()+"px",b(a._searchList).css("position","absolute"),"relative"===b(c).css("position")?(b(a._searchList).css("top",77),
b(a._searchList).css("left",0)):(b(a._searchList).css("top",b(c).position().top+77),b(a._searchList).css("left",b(c).position().left)),a._searchList.style.width=c.clientWidth.toString()+"px"):(a._searchList=a._searchDiv.querySelector(".search-list"),a._searchList.style.height=(c.clientHeight-46-35).toString()+"px")))}function j(a){a._searchDiv&&(a._searchDiv.removeEventListener("click",a),a._searchDiv.removeEventListener("input",a),a._searchDiv.querySelector("input").removeEventListener("blur",a._closeSearchBind),Element.clearDom(a._searchDiv),a._searchDiv.parentElement.removeChild(a._searchDiv),a._searchDiv=null,l(a))}function k(a){a._searchList&&(a._searchList.removeEventListener("click",a),Element.clearDom(a._searchList),b(a._searchList).remove(),a._searchList=null,l(a))}function l(a){var b=new CustomEvent("resize",{bubbles:!0});b.open=null!==a._searchDiv,a.dispatchEvent(b)}function m(a){
a.value.length>0?a._searchDiv.querySelector("i").style.display="inline-block":a._searchDiv.querySelector("i").style.display="none"}function n(a){m(a),a.search(a)}function o(a){return a._value}function p(a,b){a._value=b||"",""===a._value||a._searchDiv||g(a),a._searchDiv&&(a._searchDiv.querySelector("input").value=a._value,n(a))}function q(a){var b;a.searchCallback&&a._searchDiv&&("true"===a.getAttribute("custom-search")?(b=a._searchDiv.querySelector("input"),a.searchCallback(b.value)):(a._searchList.value=null,a._searchList.reload()))}function r(a){a.value="",q(a),a._searchDiv.querySelector(".mi-searchbox input").focus()}function s(a,b){var c,d;for(c=0;c<e.length;c++)(d=a.getAttribute(e[c]))&&b.setAttribute(e[c],d)}function t(a,c,d){var e=a._searchDiv.querySelector("input");return e&&a.searchCallback?a.searchCallback(e.value,c,d).done(u.bind(null,a)):b.Deferred().resolve().promise()}function u(a,b){var c
;a._searchDiv&&(c=a.isInToolbar?a._searchList:a._searchDiv.querySelector(".search-list"))&&(b&&b.length>0?c.classList.add("open"):c.classList.remove("open"))}function v(a){for(var b=a.hasAttribute("multiselect")?a.querySelectorAll("mi-li[checked]"):a.querySelectorAll(".active"),c=[],d=0;d<b.length;d++)c.push(b[d].value);return c}function w(a,b){var c;c=new CustomEvent("search-selected",{bubbles:!0}),c.searchResult=v(b.currentTarget),a.dispatchEvent(c)}return document.registerElement("mi-searchbox",{prototype:d}),d});
define('ui/elements/tool-bar-filter/view-model',['require','jquery','spa/conductor','spa/region','system/globalization/translator'],function(require){"use strict";var a=require("jquery"),b=require("spa/conductor"),c=require("spa/region"),d=require("system/globalization/translator"),e=Object.create(HTMLElement.prototype);e.createdCallback=function(){var a;h(this),this.classList.add("btn"),this.classList.add("btn-default"),this.classList.add("btn-icon"),a=document.createElement("i"),a.className="icon-collection-filter",this.appendChild(a),this.region=null,this.translator=null},e.attachedCallback=function(){this.addEventListener("click",this),document.querySelector("body").addEventListener("click",this._closeFilterBind),this.translator=Object.resolve(d),this.title=f(this,"FILTER")},e.detachedCallback=function(){var a;"true"!==this.getAttribute("custom-filter")&&(this.$filter&&(a=document.querySelector(this.popOverId),a&&a.parentElement.removeChild(a),this.$filter=null),this.conductor.unloadScreen(this.filterViewModel),this.conductor.closeScreen(this.filterViewModel)),
document.querySelector("body").removeEventListener("click",this._closeFilterBind)},e.handleEvent=function(a){"click"===a.type&&(a.target!==this&&a.target.parentElement!==this||g(this))},e.openFilter=function(){g(this)},e.closeFilter=function(){i(this)};function f(a,b){return a.translator.translate(b.toUpperCase())}function g(b){if("true"===b.getAttribute("custom-filter"))b.filterViewModel();else{if(b.$filter)return;b.$filter=a(b),b.$filter.popover({placement:"bottom",content:" ",container:"body"}),b.$filter.on("shown.bs.popover",b,l),b.$filter.on("hide.bs.popover",b,m),b.$filter.on("hidden.bs.popover",b,n),b.$filter.popover("show")}}function h(a){a.conductor=Object.resolve(b),a._closeFilterBind=i.bind(null,a),a.$filter=null,a.popoverId=null,a._filterViewModel=null,Element.defineProperty(a,"filterViewModel",{get:j.bind(null,a),set:k.bind(null,a)})}function i(a,b){var c;if(a.$filter){if(!(c=document.querySelector(a.popOverId))||c.contains(b.target)||b.target===a)return
;a.$filter.popover("hide")}}function j(a){return a._filterViewModel}function k(a,b){b?(a._filterViewModel=b,"true"!==a.getAttribute("custom-filter")&&(a.conductor.openScreen(a._filterViewModel),a.conductor.loadScreen(a._filterViewModel))):a._filterViewModel=null}function l(b){var d=b.data;d.region=new c,d.popOverId="#"+b.target.getAttribute("aria-describedby"),d.region.setElement(a(d.popOverId+" .popover-content")),d.conductor.activateScreen(d.filterViewModel),d.conductor.attachScreen(d.filterViewModel,d.region)}function m(a){var b=a.data;b.conductor.deactivateScreen(b.filterViewModel),b.conductor.detachScreen(b.region),b.$filter.off("shown.bs.popover",l),b.$filter.off("hide.bs.popover",m)}function n(a){var b=a.data;b.$filter&&(b.$filter.off("hidden.bs.popover",n),b.$filter.popover("destroy"),b.$filter=null,b.popoverId=null,b.dispatchEvent(new CustomEvent("filter-closed",{bubbles:!0})))}return document.registerElement("mi-tool-bar-filter",{prototype:e}),e});
define('ui/elements/list-group/view-model',['require','jquery','ramda','lodash','system/lang/converter','system/globalization/translator','ui/elements/list-group-item/view-model','ui/elements/searchbox/view-model','ui/elements/tool-bar/view-model','ui/elements/tool-bar-filter/view-model'],function(require){"use strict";var a=require("jquery"),b=require("ramda"),c=require("lodash"),d=require("system/lang/converter"),e=require("system/globalization/translator"),f=["key","description","selector","multiselect","has-children","use-html","delay","custom-search","radio-child-only"];require("ui/elements/list-group-item/view-model"),require("ui/elements/searchbox/view-model"),require("ui/elements/tool-bar/view-model"),require("ui/elements/tool-bar-filter/view-model");var g=Object.create(HTMLElement.prototype);g.selectRadioButton=function(a,b){E(this,a,b,!0)},g.createdCallback=function(){var a,b,c,d,e,f,g;j(this),this.classList.add("nav-list-group"),c=this.querySelector("mi-tool-bar"),c||(c=document.createElement("mi-tool-bar"),this.appendChild(c)),this.filterViewModel&&this.classList.add("show-filter"),e=document.createElement("mi-tool-bar-filter"),e.filterViewModel=this.filterViewModel,f=this.getAttribute("custom-filter"),
"true"===f&&e.setAttribute("custom-filter","true"),c.insertBefore(e,c.firstChild),this.searchCallback&&this.classList.add("show-search-button"),d=document.createElement("mi-searchbox"),d.searchCallback=this.searchCallback,c.insertBefore(d,c.firstChild),B(this,d),"false"!==this.getAttribute("allow-add")&&this.classList.add("allow-add"),c.insertBefore(N(this,"addItem","NEWITEM","icon-plus"),c.firstChild),a=document.createElement("div"),a.className="list-group",b=this.getAttribute("selector"),"addOnly"!==b&&"toggle"!==b||(a.className+=" selectable"),this.appendChild(a),g=document.createElement("div"),g.className="loading-small",this.appendChild(g),this.loader&&this.reload(),this.addEventListener("search-selected",this)},g.attachedCallback=function(){var a=U(this),b=this.querySelector("mi-tool-bar");a.addEventListener("scroll",this),a.addEventListener("click",this),b.addEventListener("click",this),b.addEventListener("resize",this),b.addEventListener("filter-closed",this),T(this)},
g.attributeChangedCallback=function(a,b,c){var d=U(this),e;"selector"===a&&d&&("addOnly"===c||"toggle"===c?d.classList.add("selectable"):d.classList.remove("selectable")),"allow-add"===a&&("false"===c?this.classList.remove("allow-add"):this.classList.add("allow-add")),"custom-filter"===a&&(e=this.querySelector("mi-tool-bar mi-tool-bar-filter"))&&e.setAttribute(a,c),A(this,a,c,d)},g.handleEvent=function(a){var b;"scroll"===a.type?J(this,a):"click"===a.type?C(a.target)?(E(this,D(a.target).value,a.selecting),h(this,a)):"BUTTON"===a.target.nodeName?(b=a.target.getAttribute("data-action"),S(this,b,a)):"I"===a.target.tagName&&"BUTTON"===a.target.parentElement.tagName&&(b=a.target.parentElement.getAttribute("data-action"),S(this,b,a)):"resize"===a.type?T(this):"filter-closed"===a.type?this.reload():"search-selected"===a.type&&(W.call(null,this,a.searchResult),x.call(null,this,this.searchResult))};function h(a,b){F(a)&&D(b.target).value&&!b.selecting&&i(a)&&l(a,k(a))}function i(a){
return t(a)&&c.includes(t(a),k(a))}g.reload=function(){var a=U(this);a&&(this.resume(),Element.clearDom(a),this.setAttribute("page","1"),a.scrollTop=0,this.loader&&this.load().done(M.bind(null,this)))},g.pause=function(){this.paused=!0},g.resume=function(){this.paused=!1},g.load=function(){var b=this.getAttribute("page"),c=L(this),d;return this.loader?(this.pause(),this.classList.add("loading"),T(this),d=this.loader(b,c),d.done(I.bind(null,this)),d.always(V.bind(null,this)),d.promise()):a.Deferred().done().promise()},g.scrollIntoView=function(){var a,b,c,d,e=U(this);e&&(a=e.querySelector("mi-li.active"),a?(b=a.parentNode,d=a.getBoundingClientRect(),c=b.getBoundingClientRect(),(d.top<c.top||d.top>c.bottom)&&(b.scrollTop=a.offsetTop-b.offsetTop)):e.firstElementChild&&(e.firstElementChild.scrollTop=0))},g.addItem=function(){this.dispatchEvent(new CustomEvent("add-item",{bubbles:!0}))},g.loadState=function(a){var b=this.querySelector("mi-tool-bar mi-searchbox");a=a||{},
a.value&&(this.value=a.value),a.searchTerm&&(b.value=a.searchTerm)},g.saveState=function(){var a=this.querySelector("mi-tool-bar mi-searchbox");return{value:this.value,searchTerm:a.value}};function j(a){a.translator=Object.resolve(e),a.paused=!1,a.searchResult=[],a._loader=null,Element.defineProperty(a,"loader",{get:q.bind(null,a),set:r.bind(null,a)}),a._value=null,Element.defineProperty(a,"value",{get:s.bind(null,a),set:E.bind(null,a)}),Element.defineProperty(a,"items",{get:t.bind(null,a),set:u.bind(null,a)}),Element.defineProperty(a,"selectedItems",{get:v.bind(null,a),set:x.bind(null,a)}),a._filterViewModel=null,Element.defineProperty(a,"filterViewModel",{get:O.bind(null,a),set:P.bind(null,a)}),a._searchCallback=null,Element.defineProperty(a,"searchCallback",{get:Q.bind(null,a),set:R.bind(null,a)}),a._listItemIconCallback=null,Element.defineProperty(a,"listItemIconCallback",{get:o.bind(null,a),set:p.bind(null,a)})}function k(a){var b=m(a);if(b)return b.selectedRadioButton}
function l(a,b){var c=m(a);c&&(c.selectedRadioButton=b)}function m(a){var b=n(a);if(b)return b[0]}function n(b){var c=b.parentElement,d;if(c)return d=a(c).siblings()}function o(a){return a._listItemIconCallback}function p(a,b){a._listItemIconCallback=b||null}function q(a){return a._loader}function r(a,b){a._loader=b,a.reload()}function s(a){return a._value}function t(a){var b=U(a),c,d=[],e;if(b)for(c=b.querySelectorAll("mi-li"),e=0;e<c.length;e++)d[d.length]=c[e].value;return d}function u(a,b){var c=U(a);c&&(Element.clearDom(c),b&&y(a,b))}function v(a){var b=U(a),c,d=[],e;if(b)for(c=b.querySelectorAll('mi-li[checked="true"]'),e=0;e<c.length;e++)d[d.length]=c[e].value;return d}function w(a){var b,c,d=U(a);if(d&&(b=d.querySelectorAll('mi-li[checked="true"]'),b.length>0))for(c=0;c<b.length;c++)b[c].setAttribute("checked","false")}function x(a,b){var c,d;if(w(a),b)for(c=0;c<b.length;c++)(d=H(a,b[c]))&&d.setAttribute("checked","true")}function y(a,b){var c,d,e=U(a),f;if(e){
for(f=document.createDocumentFragment(),z(b,e),c=0;c<b.length;c++)d=document.createElement("mi-li"),d.setAttribute("icon-class","icon-right-arrow"),f.appendChild(d),d.value=b[c],d.value.hasOwnProperty("disabled")&&d.setAttribute("disabled","true"===d.value.disabled||d.value.disabled),d.value.hasOwnProperty("disabledIcon")&&d.setAttribute("disabledIcon","true"===d.value.disabledIcon||d.value.disabledIcon),Object.tryMethod(a,"_listItemIconCallback",d.listItemIcon,b[c]),B(a,d);var g=new CustomEvent("loaded",{bubbles:!0,cancelable:!0,detail:{frag:f}});a.dispatchEvent(g),e.appendChild(f),a.searchResult.length&&x(a,a.searchResult)}}function z(a,b){if(0===a.length){var c=b.parentElement,d,e;c&&(c.parentElement&&(c=c.parentElement,c.previousSibling&&(c=c.previousSibling)),"MI-PATH-HISTORY"===c.nodeName&&(d=c.children[0].children,e=d[d.length-1],e.setAttribute("icon-class","")))}}function A(a,b,c,d){var e,g,h;if(d&&f.indexOf(b)>-1){for(e=d.getElementsByTagName("mi-li"),
g=0;g<e.length;g++)e[g].setAttribute(b,c);h=a.querySelector("mi-tool-bar mi-searchbox"),h&&h.setAttribute(b,c)}}function B(a,b){var c,d;for(c=0;c<f.length;c++)(d=a.getAttribute(f[c]))&&b.setAttribute(f[c],d)}function C(a){return"MI-LI"===a.tagName||"MI-LI"===a.parentNode.tagName||"MI-LI"===a.parentNode.parentNode.tagName||"MI-LI"===a.parentNode.parentNode.parentNode.tagName}function D(a){for(var b=a;"MI-LI"!==b.tagName;)b=b.parentNode;return b}function E(a,b,c,d){if(b){var e,f,g;if(g=new CustomEvent("selecting",{bubbles:!0,cancelable:!0}),g.selecting=c,g.newValue=b,a.dispatchEvent(g)){if(f=a.getElementsByClassName("active"),f&&f.length>0&&f[0].classList.remove("active"),a._value=b,b)if(F(a)&&b&&c&&l(a,b),void 0!==(e=H(a)))a._value=e.value,e.classList.add("active"),a.scrollIntoView();else{var h=a.querySelector("mi-list-group");h&&void 0!==h&&(a._value=h.value,h.classList.add("active"),a.scrollIntoView())}
return a.value&&void 0!==e?(e.getAttribute("multiselect")&&("true"===e.getAttribute("checked")?e.setAttribute("checked","false"):e.setAttribute("checked","true")),d?(e.setAttribute("checked","true"),G(a,c,!0),!0):(F(a)?G(a,c,!0):G(a,c),!0)):(null!==a.value&&void 0!==a.value||G(a,c),!1)}}}function F(a){return b.any(b.propEq("name","radio-child-only"),a.attributes)}function G(a,b,c){var d=new CustomEvent("change",{bubbles:!0,cancelable:!0});a.dispatchEvent(d),d=new CustomEvent("selected",{bubbles:!0,cancelable:!0}),d.preventListGroupNull=c,d.selecting=b,a.dispatchEvent(d)}function H(a,b){var c=0,d=U(a),e,f,g;if(d&&(e=d.querySelectorAll("mi-li"))&&0!==e.length){for(b=b||a.value,f=a.getAttribute("key")||"entityKey",g=b[f];c<e.length&&g!==e[c].value[f];)c++;return e[c]}}function I(a,b){var c=U(a);c&&"1"===a.getAttribute("page")&&Element.clearDom(c),b&&(y(a,b),b.length===L(a)&&a.resume())}function J(a,b){
var c=b.target,e=d.toFloat(a.getAttribute("scroll-percent")||"0.75"),f=(c.offsetHeight+c.scrollTop)/c.scrollHeight;!a.paused&&f>=e&&(K(a),a.load())}function K(a){var b=d.toInteger(a.getAttribute("page")||"1");b++,a.setAttribute("page",b.toString())}function L(a){var b=a.getAttribute("page-size")||"25";return d.toInteger(b)}function M(a){a.value&&(E(a,a.value)||(a.paused?a.value=null:(K(a),a.load().done(M.bind(null,a)))))}function N(a,b,c,d){var e=document.createElement("button"),f=document.createElement("i");return e.className="btn btn-default btn-icon",e.setAttribute("data-action",b),e.title=a.translator.translate(c),f.className=d,e.appendChild(f),e}function O(a){return a._filterViewModel}function P(a,b){var c=a.querySelector("mi-tool-bar mi-tool-bar-filter");b?a.classList.add("show-filter"):a.classList.remove("show-filter"),c&&(c.filterViewModel=b),a._filterViewModel=b}function Q(a){return a._searchCallback}function R(a,b){var c=a.querySelector("mi-tool-bar mi-searchbox")
;b?a.classList.add("show-search-button"):a.classList.remove("show-search-button"),c&&(c.searchCallback=b),a._searchCallback=b}function S(a,b,c){b&&a[b]&&a[b](c)}function T(a){var b,c=a.querySelector("mi-tool-bar"),d=U(a);c&&(b=a.querySelector("mi-tool-bar").clientHeight,a.classList.contains("loading")&&(b+=16),d.style.height="calc(100% - "+(b+1)+"px)")}function U(a){var b=a.querySelectorAll(".list-group");return 0===b.length?null:b[b.length-1]}function V(a){a.classList.remove("loading"),T(a)}function W(a,b){var c,d,e=0;for(c=0;c<b.length;c++){for(d=0;d<a.searchResult.length;d++)if(a.searchResult[d].key===b[c].key){e++;break}0===e&&a.searchResult.push(b[c])}}return document.registerElement("mi-list-group",{prototype:g}),g});
define('ui/elements/path-history/view-model',['require','lodash','jquery','ui/elements/list-group-item/view-model','ui/elements/list-group/view-model'],function(require){"use strict";var a=require("lodash"),b=require("jquery");require("ui/elements/list-group-item/view-model"),require("ui/elements/list-group/view-model");var c=["key","description","selector","multiselect","checked","has-children","use-html","page-size","delay","radio-child-only"],d=Object.create(HTMLElement.prototype);d.createdCallback=function(){var a;this.style.display="block",a=document.createElement("div"),a.className="list-group",this.appendChild(a),Element.defineProperty(this,"value",{get:k.bind(null,this),set:l.bind(null,this)}),Element.defineProperty(this,"listGroup",{get:m.bind(null,this),set:n}),this._loader=null,Element.defineProperty(this,"loader",{get:o.bind(null,this),set:p.bind(null,this)}),this._listItemIconCallback=null,Element.defineProperty(this,"listItemIconCallback",{get:g.bind(null,this),set:h.bind(null,this)}),this._selectedRadioButton=null,Element.defineProperty(this,"selectedRadioButton",{get:e.bind(null,this),set:f.bind(null,this)})}
;function e(a){return a._selectedRadioButton}function f(a,b){a._selectedRadioButton=b}function g(a){return a._listItemIconCallback}function h(a,b){a._listItemIconCallback=b||null}d.attachedCallback=function(){this.firstElementChild.addEventListener("click",this)},d.attributeChangedCallback=function(a,b,d){var e,f;if(c.indexOf(a)>-1)for(f=this.firstElementChild.getElementsByTagName("mi-li"),e=0;e<f.length;e++)"description"!==a&&"use-html"!==a||f[e].setAttribute(a,d),f[e].listGroup.setAttribute(a,d)},d.handleEvent=function(a){var b;"click"===a.type&&(a.cancelBubble=!0,a.preventDefault=!0,b=new CustomEvent("click",{bubbles:!0}),b.data=a.target.value,this.dispatchEvent(b),i(this))};function i(a){if(a.selectedRadioButton){var c=b(a).siblings(),d,f,g;c&&(d=b(a).siblings()[0]),d&&(f=d.children),f&&(g=f[0]),g&&e(a)&&j(a,g)}}d.contains=function(a){var b,c=this.value;for(b=0;b<c.length;b++)if(a===c[b].value)return!0;return!1},d.push=function(a){var b;b=document.createElement("mi-li"),
this.firstElementChild.appendChild(b),b.classList.add("selected"),null!==a.hasChildren&&b.setAttribute("icon-class","icon-arrow"),this.getAttribute("description")&&b.setAttribute("description",this.getAttribute("description")),this.getAttribute("use-html")&&b.setAttribute("use-html",this.getAttribute("use-html")),b.setAttribute("has-children",!0),b.value=a,b.listGroup=r(this,a),Object.tryMethod(this,"_listItemIconCallback",b.listItemIcon,a),q(this),j(this,b.listGroup)};function j(b,c){c&&b.selectedRadioButton&&a.includes(c.items,b.selectedRadioButton)&&c.selectRadioButton(b.selectedRadioButton,!0)}d.pop=function(){var a=this.firstElementChild,b=a.getElementsByTagName("mi-li");b.length>1&&(a.removeChild(b[b.length-1]),q(this))},d.moveBack=function(a){var b=this.firstElementChild,c=b.getElementsByTagName("mi-li"),d,e;if(a instanceof Object)for(;c&&c[c.length-1].value!==a;)b.removeChild(c[c.length-1]),q(this);else for(c=c.splice(a+1),d=0;d<c.length;d++)b.removeChild(c[d]),q(this)
;(e=b.querySelector("mi-li:last-of-type").listGroup)&&(e._value=null)},d.clear=function(){this.firstElementChild.innerHTML=""};function k(a){var b=a.firstElementChild.getElementsByTagName("mi-li"),c=[],d;for(d=0;d<b.length;d++)c[c.length]=b[d].value;return c}function l(a,b){var c,d,e=a.firstElementChild,f=!1;if(b instanceof Array){for(d=e.getElementsByTagName("mi-li"),c=0;c<b.length;c++)c>=d.length?(a.push(b[c]),f=!0):b[c]!==d[c].value&&(d[c].value=b[c],d[c].listGroup.reload(),f=!0);if(b.length<d.length){for(f=!0,c=d.length-1;c>b.length-1;c--)e.removeChild(d[c]);d[d.length-1].listGroup.value=null}f&&q(a)}else a.firstChild.innerHTML="",b&&a.push(b),q(a)}function m(a){var b=a.firstElementChild.getElementsByTagName("mi-li"),c=[],d;for(d=0;d<b.length;d++)c[c.length]=b[d].listGroup;return c}function n(){}function o(a){return a._loader}function p(a,b){var c,d=a.firstElementChild.getElementsByTagName("mi-li");for(a._loader=b,
c=0;c<d.length;c++)d[c].listGroup.listItemIconCallback=a.listItemIconCallback,d[c].listGroup.loader=b?b.bind(null,c):null}function q(a){var b=new CustomEvent("change",{bubbles:!0});a.dispatchEvent(b)}function r(a,b){var d=document.createElement("mi-list-group"),e=a.firstElementChild.getElementsByTagName("mi-li").length-1,f;for(f=0;f<c.length;f++)t(a,d,c[f]);return d.setAttribute("allow-add","false"),b&&b.loader?d.loader=b.loader.bind(null,e):a.loader&&(d.loader=a.loader.bind(null,e)),d.listItemIconCallback=a.listItemIconCallback,d.addEventListener("change",s),d}function s(a){a.cancelBubble=!0,a.preventDefault()}function t(a,b,c){var d=a.getAttribute(c);d&&b.setAttribute(c,d)}return document.registerElement("mi-path-history",{prototype:d}),d});
define('ui/elements/tree/view-model',['require','jquery','system/globalization/translator','ui/elements/path-history/view-model','ui/elements/searchbox/view-model','ui/elements/list-group/view-model','ui/elements/tool-bar/view-model','ui/elements/tool-bar-filter/view-model'],function(require){"use strict";var a=require("jquery"),b=require("system/globalization/translator"),c=["key","description","page","page-size","scroll-percent","selector","multiselect","checked","has-children","use-html","delay","radio-child-only"];require("ui/elements/path-history/view-model"),require("ui/elements/searchbox/view-model"),require("ui/elements/list-group/view-model"),require("ui/elements/tool-bar/view-model"),require("ui/elements/tool-bar-filter/view-model");var d=Object.create(HTMLElement.prototype);d.createdCallback=function(){var a,b,c,d,f,h;g(this),b=this.querySelector("mi-tool-bar"),b||(b=document.createElement("mi-tool-bar"),Element.upgrade(b),this.appendChild(b)),this.filterViewModel&&this.classList.add("show-filter"),d=document.createElement("mi-tool-bar-filter"),Element.upgrade(d),d.classList.add("default-buttons-left"),d.filterViewModel=this.filterViewModel,f=this.getAttribute("custom-filter"),"true"===f&&d.setAttribute("custom-filter","true"),
b.insertBefore(d,b.firstChild),this.searchCallback&&this.classList.add("show-search-button"),c=document.createElement("mi-searchbox"),Element.upgrade(c),c.classList.add("default-buttons-left"),c.searchCallback=e.bind(null,this),c.setAttribute("custom-search","true"),c.setAttribute("no-auto-close","true"),b.insertBefore(c,b.firstChild),p(this,c),"false"!==this.getAttribute("allow-add")&&this.classList.add("allow-add"),b.insertBefore(C(this,"addItem","NEWITEM","icon-plus"),b.firstChild),b.insertBefore(C(this,"togglePathHistory","HIDE","icon-up-arrow","hide-button"),b.firstChild),b.insertBefore(C(this,"backInHistory","BACK","icon-back-arrow","back-button"),b.firstChild),a=document.createElement("section"),a.className="nav-list-group",this.appendChild(a),this.pathHistory=document.createElement("mi-path-history"),Element.upgrade(this.pathHistory),this.pathHistory.loader=this._loader,this.pathHistory.value=this._value,this.pathHistory.className="expanded",a.appendChild(this.pathHistory),
p(this,this.pathHistory),h=document.createElement("div"),h.className="tree-list-control",a.appendChild(h),this._value&&x(this)},d.attachedCallback=function(){var a=this.querySelector("section.nav-list-group"),b=this.querySelector("mi-tool-bar");a.addEventListener("selecting",this),a.addEventListener("selected",this),a.addEventListener("click",this),b.addEventListener("click",this),b.addEventListener("resize",this),b.addEventListener("filter-closed",this),this.pathHistory.addEventListener("change",this),B(this)},d.attributeChangedCallback=function(a,b,d){var e,f;"root-name"===a?B(this,d):"allow-add"===a?"false"===d?this.classList.remove("allow-add"):this.classList.add("allow-add"):"custom-filter"===a?(f=this.querySelector("mi-tool-bar mi-tool-bar-filter"))&&f.setAttribute(a,d):c.indexOf(a)>-1&&(this.pathHistory.setAttribute(a,d),(e=this.querySelector("mi-tool-bar mi-searchbox"))&&e.setAttribute(a,d))},d.handleEvent=function(a){
"selecting"===a.type?D(this,a):"selected"===a.type?E(this,a):"click"===a.type?q(this,a):"change"===a.type?x(this):"resize"===a.type&&a.target!==window?t(this,a):"filter-closed"===a.type?this.refreshAll():"focus"===a.type&&a.target.parentElement.classList.contains("mi-searchbox")?(this.pathHistory.value=this.pathHistory.value[0],this.pathHistory.firstElementChild.firstElementChild.style.display="none",setTimeout(t.bind(null,this),0)):"blur"===a.type&&a.target.classList.contains("mi-searchbox")&&t(this)},d.togglePathHistory=function(){var a=!this.pathHistory.classList.contains("expanded"),b=this.querySelector('button[data-action="togglePathHistory"]');b.firstElementChild.className=a?"icon-up-arrow":"icon-arrow",b.title=this.translator.translate(a?"HIDE":"SHOW"),this.pathHistory.className=a?"expanded":"collapsed",t(this)},d.backInHistory=function(){var a=this.value;a.length>1&&w(this,a[a.length-2])},d.refresh=function(){var a=this.value,b=a[a.length-1]
;1===a.length?this.reload():(this.pathHistory.pop(),this.pathHistory.push(b))},d.refreshAll=function(){var a=this.pathHistory.listGroup,b;if(a.length<=1)this.reload();else{for(b=0;b<a.length;b++)a[b].items=null,a[b].resume();a[a.length-1].reload()}},d.reload=function(){A(this)&&this.pathHistory.clear(),B(this)},d.addItem=function(){this.dispatchEvent(new CustomEvent("add-item",{bubble:!0}))},d.loadState=function(a){var b;a=a||{},a.searchTerm&&(b=this.querySelector("mi-searchbox"),b._value=a.searchTerm,b.toggleSearch(),this.searchTerm=a.searchTerm,t(this),this.preSearchValue=a.preSearchValue),this.value=a.value,a.searchTerm&&(this.pathHistory.firstElementChild.firstElementChild.style.display="none")},d.saveState=function(){return{preSearchValue:this.preSearchValue,value:this.value,searchTerm:this.searchTerm}};function e(a,b){a.pathHistory.clear(),a.pathHistory.value={description:b,loader:a._searchCallback.bind(null,b)},a.searchTerm=b,
a.pathHistory.firstElementChild.firstElementChild.style.display="none",t(a)}function f(a){var b,c;a.preSearchValue&&(a.pathHistory.clear(),a.pathHistory.value=a.preSearchValue,a.preSearchValue=null,a.searchTerm="",a.querySelector("mi-searchbox").value=null,b=a.pathHistory.firstElementChild.firstElementChild,b&&(b.style.display="block"),c=new CustomEvent("search-closed",{bubbles:!0}),a.dispatchEvent(c),t(a))}function g(a){a.translator=Object.resolve(b),a._loader=null,a.preSearchValue=null,a.searchTerm="",Element.defineProperty(a,"loader",{get:j.bind(null,a),set:k.bind(null,a)}),a._value=null,Element.defineProperty(a,"value",{get:l.bind(null,a),set:m.bind(null,a)}),Element.defineProperty(a,"listGroup",{get:n.bind(null,a),set:o}),a._filterViewModel=null,Element.defineProperty(a,"filterViewModel",{get:F.bind(null,a),set:G.bind(null,a)}),a._searchCallback=null,Element.defineProperty(a,"searchCallback",{get:H.bind(null,a),set:I.bind(null,a)}),a._listItemIconCallback=null,
Element.defineProperty(a,"listItemIconCallback",{get:h.bind(null,a),set:i.bind(null,a)})}function h(a){return a._listItemIconCallback}function i(a,b){a._listItemIconCallback=b||null,a.pathHistory&&(a.pathHistory.listItemIconCallback=b)}function j(a){return a.pathHistory?a.pathHistory.loader:a._loader}function k(a,b){a.pathHistory&&(a.pathHistory.listItemIconCallback=a._listItemIconCallback,a.pathHistory.loader=b),a._loader=b}function l(a){return a.pathHistory?a.pathHistory.value:a._value}function m(a,b){a.pathHistory&&b&&(a.pathHistory.value=b),a._value=b}function n(a){return a.querySelector(".tree-list-control mi-list-group")}function o(){}function p(a,b){var d,e;for(d=0;d<c.length;d++)(e=a.getAttribute(c[d]))&&b.setAttribute(c[d],e)}function q(a,b){var c;"BUTTON"===b.target.nodeName?(c=b.target.getAttribute("data-action"),r(a,c,b)):"I"===b.target.tagName&&"BUTTON"===b.target.parentElement.tagName?(c=b.target.parentElement.getAttribute("data-action"),
r(a,c,b)):"MI-PATH-HISTORY"===b.target.tagName&&b.data&&w(a,b.data)}function r(a,b,c){b&&a[b]&&a[b](c)}function s(a,b){a.preSearchValue=a.pathHistory.value,b.target._searchDiv&&(b.target._searchDiv.querySelector("input").addEventListener("focus",a),b.target._searchDiv.querySelector("input").addEventListener("blur",a))}function t(b,c){var d=b.querySelector(".tree-list-control"),e=b.querySelector("section.nav-list-group"),g=e.firstElementChild,h=b.children,i=b.querySelector("mi-tool-bar"),j=0,k;if(d){if(c&&(c.open===!1?f(b):s(b,c)),i){for(k=0;k<h.length;k++)h[k]!==e&&(j+=a(h[k]).outerHeight());e.style.height="calc(100% - "+j+"px)"}for(j=0;g;)g!==d&&(j+=g.clientHeight),g=g.nextElementSibling;j=j.toString()+"px",d.style.height="calc(100% - "+j+")"}}function u(a,b){var c,d;for(c=new CustomEvent("navigating",{bubbles:!0,cancelable:!0}),c.newValue=[],d=0;d<a.length&&a[d]!==b;)c.newValue[c.newValue.length]=a[d],d++;return void 0!==b&&(c.newValue[c.newValue.length]=b),c}function v(a,b){
var c,d=a.pathHistory.listGroup[a.pathHistory.listGroup.length-1];b&&b.preventListGroupNull||(d.selectedItems=null),c=new CustomEvent("navigated",{bubbles:!0}),a.dispatchEvent(c)}function w(a,b){var c;c=u(a.value,b),a.dispatchEvent(c)&&(a.pathHistory.moveBack(b),v(a))}function x(a){y(a),z(a)}function y(b){var c=a("button.hide-button",b),d=a("button.back-button",b);c.addClass("pull-right"),1===b.pathHistory.value.length?(d.addClass("disabled"),c.addClass("disabled")):(d.removeClass("disabled"),c.removeClass("disabled"))}function z(a){var b=a.pathHistory.listGroup[a.pathHistory.listGroup.length-1],c=a.querySelector(".tree-list-control");b&&(c.firstElementChild&&c.removeChild(c.firstElementChild),c.appendChild(b),t(a),0!==b.items.length||b.paused?b.scrollIntoView():b.load())}function A(a){return a.getAttribute("root-name")||a.getAttribute("title")}function B(a,b){var c,d,e=a.getAttribute("description")||"description",f=b||A(a);if(f)d=a.value,0===d.length?(c={},c[e]=f,
a.value=c):(d[0]instanceof Object||(d[0]={}),d[0][e]=f,a.value=d);else if(a.value.length>0)return void(a.value=a.value[0])}function C(a,b,c,d,e){var f=document.createElement("button"),g=document.createElement("i");return f.className="btn btn-default btn-icon default-buttons-left "+(e||""),f.setAttribute("data-action",b),f.title=a.translator.translate(c),g.className=d,f.appendChild(g),f}function D(a,b){var c;b.selecting!==!0&&b.selecting!==!1&&(b.cancelBubble=!0,c=u(a.value,b.newValue),a.dispatchEvent(c)||b.preventDefault())}function E(a,b){var c;if(b.target.classList.contains("search-list"))return void(b.cancelBubble=!0);null!==b.selecting&&void 0!==b.selecting||(b.cancelBubble=!0,a.pathHistory.push(b.target.value),v(a,b),a.preSearchValue&&(c=new CustomEvent("search-selected",{bubbles:!0}),c.searchResult=[b.target.value],a.dispatchEvent(c)))}function F(a){return a._filterViewModel}function G(a,b){var c=a.querySelector("mi-tool-bar mi-tool-bar-filter")
;b?a.classList.add("show-filter"):a.classList.remove("show-filter"),c&&(c.filterViewModel=b),a._filterViewModel=b}function H(a){return a._searchCallback}function I(a,b){b?a.classList.add("show-search-button"):a.classList.remove("show-search-button"),a._searchCallback=b}return Element.registerElement("mi-tree",{prototype:d}),d});

define('text!ui/elements/filter/filter-btn-no-ko-view.html',[],function () { return '<div class="icon-filter-container">\r\n    <button class="icon-container btn btn-icon">\r\n        <i class="icon-collection-filter"></i>\r\n    </button>\r\n</div>\r\n';});


define('text!ui/elements/filter/filter-body-no-ko-view.html',[],function () { return '<!--<mi-select data-optionscaption="Select" data-selectedoptions="" data-disabled="false" data-required="false" data-visible="true" data-multiple="false"></mi-select>-->\r\n<div class="filter-container">\r\n\r\n    <div class="filters-noko">\r\n        <!--<div class="clear-all">\r\n            <a></a>\r\n        </div>-->\r\n        <div class="tag-section tag-area">\r\n        </div>\r\n        <div class="filter-content">\r\n            <div class="sort-header ">\r\n                \r\n            </div>\r\n        </div>\r\n        <div class="filter-header">\r\n            <header></header>\r\n            <header class="dotted-border"> </header>\r\n        </div>\r\n        <div class="filter-body">\r\n            \r\n        </div>\r\n    </div>\r\n</div>\r\n';});


define('text!ui/elements/filter/filter-group-no-ko-view.html',[],function () { return '<div class="filter-section">\r\n    <header></header>\r\n    <div class="filter-item">\r\n        <form class="form-item">\r\n            <div>\r\n                <!--<mi-checkbox data-bind="miCheckboxProperty: {checked: isSelected, text: text}"></mi-checkbox>-->\r\n            </div>\r\n        </form>\r\n        <div class="second-dotted-border"></div>\r\n    </div>\r\n</div>';});

define('ui/elements/filter/filter-item-no-ko',['require'],function(require){"use strict";function a(a,b){a=a||null,this.caption=b,this.value=a.value,this.text=a.text,this.isSelected=a.isSelected}return a});
define('ui/elements/filter/filter-group-no-ko',['require','./filter-item-no-ko'],function(require){"use strict";var a=require("./filter-item-no-ko");function b(b){var c;for(b=b||null,this.caption=b.caption,this.type=b.type,this.items=[],this.hideCaption=b.hideCaption,c=0;c<b.options.length;c++)this.items.push(new a(b.options[c].option,this.caption))}return b});
define('ui/elements/filter/filter-collection-no-ko',['require','./filter-group-no-ko'],function(require){"use strict";var a=require("./filter-group-no-ko");function b(){this.filterGroups=[]}return b.prototype.populateGroups=function(b){var c,d;for(c=0;c<b.filteroptions.length;c++)d=new a(b.filteroptions[c]),this.filterGroups.push(d)},b.prototype.clear=function(){this.filterGroups=[]},b});
define('ui/elements/filter/filter-no-ko',['require','lodash','jquery','text!./filter-btn-no-ko-view.html','text!./filter-body-no-ko-view.html','text!./filter-group-no-ko-view.html','./filter-collection-no-ko','system/lang/converter','system/globalization/translator','spa/conductor','spa/region','ui/elements/select/view-model','ui/elements/checkbox/view-model','ui/elements/radio/view-model'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./filter-btn-no-ko-view.html"),d=require("text!./filter-body-no-ko-view.html"),e=require("text!./filter-group-no-ko-view.html"),f=require("./filter-collection-no-ko"),g=require("system/lang/converter"),h=require("system/globalization/translator"),i=require("spa/conductor"),j=require("spa/region");require("ui/elements/select/view-model"),require("ui/elements/checkbox/view-model"),require("ui/elements/radio/view-model");var k=Object.create(HTMLElement.prototype);k.createdCallback=function(){var c=this;this.resizeProxy=b.proxy(a.debounce(this.resize,100),this),this.scrollProxy=b.proxy(this.scroll,this),this.translator=Object.resolve(h),this.isClicked=!1,this.element=this,this.$element=null,this.isVisible=!1,this.isFilterScrollable=this.getFilterScrollable(),this.loader=null,this.filterOptions=[],this.filterCollection=new f,this.filterVMRegion=null,this.tags=[],
this.customHTML=this.getAttribute("custom-html"),this.customFilter=this.getAttribute("custom-filter"),this.documentClickHandlerFn=r.bind(null,this),c.conductor=Object.resolve(i),c._filterViewModel=null,Element.defineProperty(c,"filterViewModel",{get:n.bind(null,c),set:o.bind(null,c)}),this._loader=null,Element.defineProperty(c,"loader",{get:t.bind(null,c),set:u.bind(null,c)}),this.callback=null,Element.defineProperty(c,"filterCB",{get:function(){return c.callback},set:function(a){c.callback=a}}),this._popupWidth=null,Element.defineProperty(c,"popupWidth",{get:function(){return c._popupWidth},set:function(a){c._popupWidth=a}}),this._showHeading=!0,Element.defineProperty(c,"showHeading",{get:function(){return c._showHeading},set:function(a){void 0!==a&&(c._showHeading=g.toBoolean(a,"true"))}}),this._showTags=!0,Element.defineProperty(c,"showTags",{get:function(){return c._showTags},set:function(a){void 0!==a&&(c._showTags=g.toBoolean(a,"true"))}}),this._maxHeight=null,
Element.defineProperty(c,"maxHeight",{get:function(){return c._maxHeight},set:function(a){c._maxHeight=a}}),this._internalIcon=null,Element.defineProperty(c,"icon",{get:function(){return c._internalIcon}.bind(c),set:function(a){l(c,a)}.bind(c)}),this._disabled=b(this).is("[disabled]"),Element.defineProperty(c,"disabled",{get:function(){return c._disabled}.bind(c),set:function(a){m(c,a)}.bind(c)}),c._internalIcon&&l(c,c._internalIcon)},k.attachedCallback=function(){this.setElement(),this.htmlToDisplay=this.element.innerHTML,this.element.innerHTML=c,this.attachClickHandlers(),l(this,this._internalIcon),m(this,this._disabled)},k.detachedCallback=function(){this.customFilter&&(q(this),this.conductor.unloadScreen(this.filterViewModel),this.conductor.closeScreen(this.filterViewModel)),b(document).find("#shell-screen").off("mousedown.mifilter touchstart click",this.documentClickHandlerFn),W(this),this.resizeProxy=null,this.scrollProxy=null,this.translator=null,this.isClicked=null,
this.isVisible=!1,this.isFilterScrollable=null,this.loader=null,this.filterOptions=null,this.filterCollection&&(this.filterCollection.clear(),this.filterCollection=null),this.filterVMRegion=null,this.tags=null,this.customHTML=null,this.customFilter=null,this.documentClickHandlerFn=null,this.conductor=null,this._loader=null,this.callback=null,this._popupWidth=null,this._showHeading=null,this._showTags=null,this._maxHeight=null,this._internalIcon=null,this._disabled=null,this._filterViewModel=null,this.filterViewModel=null,this.$element=null},k.attributeChangedCallback=function(a,b,c){var d=this;"custom-html"===a?(d.customHTML=c,W(d),"true"===c&&z(d)):"custom-filter"===a?(d.customFilter=c,W(d),"true"===c&&d.isVisible&&(d.conductor.openScreen(d._filterViewModel),d.conductor.loadScreen(d._filterViewModel),z(d))):"icon"===a?l(d,c):"disabled"===a&&m(d,c)};function l(a,c){a._internalIcon=c?c.trim():"icon-collection-filter",b(a).find("button i").removeAttr("class").addClass(a._internalIcon)}
function m(a,c){void 0!==c&&(a._disabled=c),a._disabled?b(a).find("button").addClass("disabled"):b(a).find("button").removeClass("disabled")}k.load=function(){var a;return this.loader?(a=this.loader(),a.promise()):b.Deferred().done().promise()},k.setElement=function(){this.$element=b(this.element)},k.attachClickHandlers=function(){this.$element.find(".icon-container").on("click",v.bind(null,this)),b(document).find("#shell-screen").on("mousedown.mifilter touchstart click",this.documentClickHandlerFn),this.find=s.bind(null,this)},k.detachClickHandlers=function(){},k.resize=function(a){b(a).find(".icon-container").is(":visible")&&a.isVisible&&X(this)},k.scroll=function(a){g.toBoolean(a.isFilterScrollable,"true")?a.resize(a):(w(a),a.isVisible=!1)},k.getFilterScrollable=function(){return this.getAttribute("isfilterscrollable")||!0},k.closeFilter=function(){w(this)};function n(a){return a._filterViewModel}function o(a,b){b?(a._filterViewModel=b,
"true"===a.getAttribute("custom-filter")&&(a.conductor.openScreen(a._filterViewModel),a.conductor.loadScreen(a._filterViewModel))):a._filterViewModel=null}function p(a){var c=new j;a.filterVMRegion=c,c.setElement(b(".filter-outer-container .filters-noko")),a.conductor.activateScreen(a.filterViewModel),a.conductor.attachScreen(a.filterViewModel,c)}function q(a){a.conductor.deactivateScreen(a.filterVMRegion),a.conductor.detachScreen(a.filterVMRegion)}function r(a,c,d){a.isClicked?a.isClicked=!1:b(".filter-outer-container").find(c.target).length||b(".filter-outer-container").find(d).length||b(c.target).closest(".icon-filter-container").length||w(a)}function s(a,c){return b(a.htmlToDisplay).find(c)[0]}function t(a){return a._loader}function u(a,b){a._loader=b,a.isPopulated=!1,a.filterCollection&&a.filterCollection.clear()}function v(a,b){b.stopPropagation(),a._disabled||(a.isVisible?w(a):x(a))}function w(a){a.isVisible=!1,b(window).off("resize",a.resizeProxy.bind(null,a)),
b(a).parents().off("scroll",a.scrollProxy.bind(null,a)),a.contentContainer&&b(a.contentContainer).off(" click","**"),"true"===a.customFilter&&q(a),W(a)}function x(a){a.isClicked=!0,a.isVisible=!0,b(document).find("#shell-screen").trigger("mousedown.mifilter"),"true"===a.customHTML||"true"===a.customFilter?z(a):a.load().done(y.bind(null,a))}function y(a,b){a.filterOptions=b,z(a)}function z(a){V(a),"true"===a.customHTML?b(".filter-outer-container .filters-noko").empty().append(a.htmlToDisplay):"true"===a.customFilter?p(a):(a.filterOptions.sortOptions&&a.filterOptions.sortOptions.length?B(a):b(".filter-outer-container .sort-header").hide(),E(a)),Y(a),X(a),A(a)}function A(a){null!==a._maxHeight&&b(".filter-outer-container .filter-body").css({"max-height":a._maxHeight+"px"})}function B(a){var c=b(".filter-outer-container .sort-header")[0],d,e;for(b(c).append('<mi-select class="sort-dropdown"></mi-select>'),d=b(c).find(".sort-dropdown")[0],e=0;e<a.filterOptions.sortOptions.length;e++);
b(d).data("options",a.filterOptions.sortOptions),b(d).attr("data-options",JSON.stringify(a.filterOptions.sortOptions)),C(a)}function C(a){b(".filter-outer-container .sort-header .sort-dropdown").on("valueChange",function(c){c.preventDefault(),D(a,"sort",b(this).val())})}function D(a,b,c){Object.tryMethod(a,"callback",b,c)}function E(a){a.isPopulated||(F(a),a.isPopulated=!0),G(a),L(a),a.contentContainer.find(".clear-all a").on("click",Q.bind(null,a))}function F(a){a.filterCollection.populateGroups(a.filterOptions)}function G(a){var b,c=a.filterCollection,d=c.filterGroups;for(a.tags=[],b=0;b<d.length;b++)H(a,d[b],b)}function H(a,c,d){var f=a.contentContainer.find(".filter-body").get(0),g=b(e),h,i,j;if(g.data("group-index",d),i=g.find("header"),j=g.find(".form-item div").get(0),I(i,c.caption),"select"===a.filterCollection.filterGroups[d].type)J(a,j,c,d);else for(h=0;h<c.items.length;h++)K(a,j,c.items[h],h,d);b(f).append(g)}function I(a,c){b(a).append(c)}function J(a,c,d,e){
for(var f=d.hideCaption?b('<mi-select data-optionsvalue="value" data-optionstext="text"></mi-select><br />').data({"group-index":e}):b('<mi-select data-optionsvalue="value" data-optionstext="text" data-optionscaption="'+a.filterCollection.filterGroups[e].caption+'"></mi-select><br />').data({"group-index":e}),g=0;g<d.items.length;g++)if(d.items[g].isSelected){b(f[0]).data("value",d.items[g].value),b(f[0]).attr("data-value",d.items[g].value),T(a,{target:f[0]},d.items[g].value,d.caption,d.items[g].text);break}b(f).data("options",d.items),b(f).attr("data-options",JSON.stringify(d.items)),b(c).append(f)}function K(a,c,d,e,f){var g,h;"checkbox"===a.filterCollection.filterGroups[f].type?g=b('<mi-checkbox-noko  value="'+d.value+'" text="'+d.text+'" ></mi-checkbox-noko><br />').data({"group-index":f,"item-index":e,item:d
}):"radio"===a.filterCollection.filterGroups[f].type&&(g=b('<mi-radio-noko  value="'+d.value+'" text="'+d.text+'" name="'+a.filterCollection.filterGroups[f].caption+'" ></mi-radio-noko>').data({"group-index":f,"item-index":e,item:d})),b(c).append(g),d.isSelected&&"checkbox"===a.filterCollection.filterGroups[f].type?(T(a,{target:g[0]},d.value,h,d.text),b(g[0]).attr("checked",d.isSelected)):d.isSelected&&"radio"===a.filterCollection.filterGroups[f].type&&(h=a.filterCollection.filterGroups[f].caption,T(a,{target:g[0]},d.value,h,d.text),g[0].setAttribute("checked",d.isSelected)),b(c).append(g)}function L(a){var b=a.contentContainer.find(".filter-body"),c,d,e;c=b.find("mi-checkbox-noko"),c&&(Element.upgrade(c),c.on("checkedChange",O.bind(null,a))),d=b.find("mi-radio-noko"),d&&(Element.upgrade(d),d.on("checkedChange",N.bind(null,a))),(e=b.find("mi-select"))&&(Element.upgrade(e),e.on("valueChange",M.bind(null,a)))}function M(c,d,e){d.preventDefault()
;var f=b(d.target).data(),g=parseInt(f["group-index"]),h=c.filterCollection.filterGroups[g],i=h.caption;if(e){R(c,i);var j=a.find(h.items,function(a){if(a&&a.value===e)return a});T(c,d,e,i,j.text)}else{P(c,e);var k=b(d.target).data("tag");k&&k.remove()}for(var l=h.type,m=c.filterCollection.filterGroups[g].items,n,o=0;o<m.length;o++)m[o].isSelected=!1,void 0!==m[o].value&&null!==m[o].value&&void 0!==e&&null!==e&&m[o].value.toString()===e.toString()&&(m[o].isSelected=!0,n=m[o]);c.filterCollection.filterGroups[g].items=m,S(c,l,n)}function N(a,c,d,e,f){if(d)R(a,f),T(a,c,e,f,e);else{P(a,e);b(c.target).data("tag").remove()}for(var g=b(c.target).data(),h=parseInt(g["group-index"]),i=a.filterCollection.filterGroups[h],j=i.type,k=a.filterCollection.filterGroups[h].items,l,m=0;m<k.length;m++)k[m].isSelected=!1;a.filterCollection.filterGroups[h].items=k,a.filterCollection.filterGroups[h].items[g["item-index"]].isSelected=d,g.item.isSelected=d,S(a,j,g.item)}function O(a,c,d,e){var f=c.target.text
;if(d)T(a,c,e,null,f);else{P(a,e);b(c.target).data("tag").remove()}var g=b(c.target).data(),h=parseInt(g["group-index"]),i=a.filterCollection.filterGroups[h],j=i.type;a.filterCollection.filterGroups[h].items[parseInt(g["item-index"])].isSelected=d,g.item.isSelected=d,S(a,j,g.item)}function P(a,b){var c=a.tags.indexOf(b);c>=0&&a.tags.splice(c,1),a.tags.length||(a.contentContainer.find(".tag-section").hide(),a.contentContainer.find(".clear-all").hide(),Y(a),X(a))}function Q(a){for(var c=a.contentContainer.find(".tag-section").find(".tag"),d=0;d<c.length;d++){var e=b(c[d]).data();U(a,e.value,e.item,{target:c[d]})}}function R(a,b){var c=a.contentContainer.find(".tag-section").find('.tag[name="'+b+'"]'),d=c.data("value"),e=a.tags.indexOf(d);a.tags.splice(e,1),c.remove()}function S(a,b,c){var d,e=a.filterCollection,f=e.filterGroups;Object.tryMethod(a,"callback",b,c,a.tags)}function T(a,c,d,e,f){a.contentContainer.find(".tag-section").show(),a.contentContainer.find(".clear-all").show(),
a.tags.push(d);var g=b('<div class="tag tag-style"><span><span>'+f+'</span></span><i class="icon-node-error icon-style"></i></div>');g.attr("name",e).data({value:d,item:c}).find(".icon-style").on("click",U.bind(null,a,d,c)),b(c.target).data("tag",g),g.appendTo(a.contentContainer.find(".tag-section"))}function U(a,c,d,e){b(e.target).closest(".tag").remove(),P(a,c);var f=b(d.target).data(),g=parseInt(f["group-index"]),h=a.filterCollection.filterGroups[g],i=h.type;if("checkbox"===i||"radio"===i?d.target.checked=!1:(b(d.target).data("value",""),b(d.target).attr("data-value","")),"checkbox"===i)a.filterCollection.filterGroups[g].items[parseInt(f["item-index"])].isSelected=!1;else if("radio"===i||"select"===i){for(var j=a.filterCollection.filterGroups[g].items,k=0;k<j.length;k++)j[k].isSelected=!1;a.filterCollection.filterGroups[g].items=j}S(a,i,b(d.target).data().item)}function V(a){var c,e;e=b(".content-wrapper"),c=document.createElement("div"),b(c).addClass("filter-outer-container"),
a.contentContainer=b(c),b(e).after(c),b(c).append(d).on("mousedown.mifilter",function a(b){b.stopPropagation()}),b(c).find(".clear-all a").html(a.translator.translate("MF_CLEAR_ALL")),b(b(c).find(".filter-header header")[0]).text(a.translator.translate("FILTER_HEADER_CAPTION")),b(b(c).find(".filter-header")[0]).removeClass("hide"),a.contentContainer.find(".tag-section").removeClass("hide"),a.showHeading||b(b(c).find(".filter-header")[0]).addClass("hide"),a.showTags||a.contentContainer.find(".tag-section").hide().addClass("hide")}function W(a){b(".filter-outer-container").remove()}function X(a){var c=50,d,e;Y(a),Z(a),a.ctrlOffset&&a.ctrlOffset.top+a.filtersHeight+c>=b(window).height()?$(a):_(a),b(window).on("resize",a.resizeProxy.bind(null,a)),b(a).parents().on("scroll",a.scrollProxy.bind(null,a))}function Y(a){a.outerContainer=b(a.contentContainer),a.ctrlOffset=b(a).find(".icon-container").offset(),a.ctrlWidth=b(a).find(".icon-container").width()+25,
null!==a._popupWidth&&b(a.outerContainer).find(".filters-noko").css("width",a._popupWidth+"px"),b(a.outerContainer).css({position:"absolute"}),a.filtersWidth=b(a.outerContainer).find(".filters-noko").width(),a.filtersHeight=b(a.outerContainer).find(".filters-noko").height()}function Z(a){b(a.outerContainer).find(".filters-noko").removeClass("top-left top-right bottom-left bottom-right")}function $(a){var b;a.ctrlOffset&&(b=a.ctrlOffset.top-a.filtersHeight-10,a.ctrlOffset&&a.ctrlOffset.left+a.ctrlWidth-a.filtersWidth<80?aa(a,"top-left",b):ba(a,"top-right",b))}function _(a){var b;a.ctrlOffset&&(b=a.ctrlOffset.top+50-6,a.ctrlOffset&&a.ctrlOffset.left+a.ctrlWidth-a.filtersWidth<80?aa(a,"bottom-left",b):ba(a,"bottom-right",b))}function aa(a,b,c){var d;d=a.ctrlOffset.left,ca(a,b),da(a,d,c)}function ba(a,b,c){var d;d=a.ctrlOffset.left-Math.abs(a.ctrlWidth-a.filtersWidth),null!==a._popupWidth&&(d-=12),ca(a,b),da(a,d,c)}function ca(a,c){var d;d=b(a.outerContainer).find(".filters-noko"),
b(d).addClass(c)}function da(a,c,d){b(a.outerContainer).css({left:c,top:d})}return document.registerElement("mi-filter-no-ko",{prototype:k}),k});
define('assets/asset-hierarchy-control',['require','jquery','spa/ko/knockout-view-model','system/knockout/knockout-manager','spa/region','application/application-events','application/application-context','assets/services/hierarchy-service','assets/asset-hierarchy-control-filter','assets/services/asset-context-dto','system/globalization/translator','toastr','text!./views/asset-hierarchy-control.html','text!./views/asset-hierarchy-control-filter.html','text!./views/asset-hierarchy-control-search.html','ramda','devExWebJS','ui/elements/tree/view-model','ui/elements/filter/filter-no-ko','ui/elements/searchbox/view-model','unified-asset-context-browser'],function(require){"use strict";var a=require("jquery"),b=require("spa/ko/knockout-view-model"),c=require("system/knockout/knockout-manager"),d=require("spa/region"),e=require("application/application-events"),f=require("application/application-context"),g=require("assets/services/hierarchy-service"),h=require("assets/asset-hierarchy-control-filter"),i=require("assets/services/asset-context-dto"),j=require("system/globalization/translator"),k=require("toastr"),l=require("text!./views/asset-hierarchy-control.html"),m=require("text!./views/asset-hierarchy-control-filter.html"),n=require("text!./views/asset-hierarchy-control-search.html"),o=require("ramda");require("devExWebJS"),require("ui/elements/tree/view-model"),require("ui/elements/filter/filter-no-ko"),require("ui/elements/searchbox/view-model"),require("unified-asset-context-browser");var p={selector:"none",multiSelect:!1},q=500,r=500,s=1;function t(a,b,c){u.call(this,l),this.service=a,this.tree=null,this.translator=b,
this.kom=c,this.filter=null,this.category=null,this.class=null,this.type=null,this.applyingFilter=!1,this.errorOccured=Object.resolve(e).errorOccured,this.sites=null,this.searchSelectedKey=null,this.selectChildren=null,this.disableSelectAllChildren=null,this.searchTerm=null,this.currentContext=[],this.contextNodes={},this.selectedAsset=null,this.filterConfigLoaded=!1}var u=Object.inherit(b,t);t.dependsOn=[g,j,c],t.create=function b(c){var d=Object.resolve(t);return d.settings=a.extend(null,p,c),d},t.prototype.load=function(){var a=this;this.category=this.kom.observable(),this.class=this.kom.observable(),this.type=this.kom.observable(),this.filter=new h(this.category,this.class,this.type),this.selectChildren=this.kom.observable(this.settings.selectChildren),this.disableSelectAllChildren=this.kom.observable(!0)},t.prototype.attach=function a(b,c){var e=this;this.settings.contentArea?(this.region=new d,this.region.setElement(b.$element.find(this.settings.contentArea))):this.region=b,
u.prototype.attach.call(this,this.region),this.contextBrowser=this.region.$element.find("asset-hierarchy-control")[0],this.isFirstLoad=!0,this.filterConfigLoaded=!1,Element.upgrade(this.contextBrowser),this.contextBrowser.filterTemplate=m,this.contextBrowser.searchTemplate=n,this.contextBrowser.spinnerTemplate='<span class="loading-med loading-active center-block" ></span>',this.contextBrowser.enableMultiSelect="addOnly"===this.settings.selector,this.contextBrowser.itemSelectorIcon='<i class="icon-plus"></i>',this.contextBrowser.addToolbarButton(v(this)),this.contextBrowser.itemExpandCB=G.bind(null,this),this.contextBrowser.filterConfig=y.bind(null,this),this.contextBrowser.filterCB=w.bind(null,this),this.contextBrowser.searchCB=F.bind(null,this),this.contextBrowser.addEventListener("selected",this),this.contextBrowser.addEventListener("search-cleared",this),!c&&z(this),this.disableSelectAllChildren.subscribe(function(a){
e.region&&e.region.$element&&e.region.$element.find(".add-all-children-btn").attr("disabled",!!a)})};function v(b){var c=a('<button><i class="icon-plus"></i></button>').addClass("btn btn-default btn-icon add-all-children-btn").attr("title",b.translate("ADD_ALL_CHILDREN")).attr("disabled",b.disableSelectAllChildren()).on("click",b.addAllChildren.bind(null,b));return b.settings.enableAddAllChildren&&!b.selectChildren()?c[0]:a("<span></span>")[0]}function w(a,b,c){var d,e,f;c&&(d=c[0],e=c[1],f=c[2]),a.applyingFilter=!0,a.category(d||null),a.class(e||null),a.type(f||null),!c&&a.contextBrowser.selected&&"-1"!==a.contextBrowser.selected&&"0"!==a.contextBrowser.selected?a.service.path(a.contextBrowser.selected).done(x.bind(null,a)):z(a)}function x(a,b){if(a.contextBrowser){if(b.length>1){for(var c=[],d=0;d<b.length;d++)b[d].name=b[d].description,b[d].key=b[d].entityKey,b[d].parentKey="-1",b[d].hasChildren=!0,c.push(b[d]);a.currentContext=[].concat(c),a.isFirstLoad=!0,
a.pathToNavigateInitial=c,J(a,a.pathToNavigateInitial).then(function(){z(a).done(function(){a.contextBrowser.navigate(c)})})}}else z(a)}function y(a,b){a.service.taxonomy().done(function(c){a.filterConfigLoaded=!0;var d=[{id:"CATEGORY",title:a.translate("TAXONOMY_CATEGORY"),defaultCaption:a.translate("SEL_TAX_CAT_CAP"),visible:!0},{id:"CLASS",title:a.translate("TAXONOMY_CLASS"),defaultCaption:a.translate("SEL_TAX_CLS_CAP"),visible:!0},{id:"TYPE",title:a.translate("TAXONOMY_TYPE"),defaultCaption:a.translate("SEL_TAX_TYP_CAP"),visible:!0}];b.resolve(c,d);var e=[a.category(),a.class(),a.type()];e[0]&&a.contextBrowser.filter(e)})}function z(b,c,d){var e=a.Deferred(),f=[{name:"Home",description:"Home",entityKey:"-1",key:"-1",hasChildren:!0,canOpen:!1,isExpanded:void 0===d}];return f=c===!1?[]:f,b.contextBrowser&&b.contextBrowser.init(f,!0),e.resolve(f),e}t.prototype.handleEvent=function(a){"selected"!==a.type||this.searchTerm?"filter-closed"===a.type?(this.applyingFilter=!0,
z(this)):"selected"===a.type&&this.searchTerm?B(this,a):"search-cleared"===a.type&&C(this):(this.service.abort(),this.disableSelectAllChildren(!this.settings.multiSelect))};function A(a){return 1===a.newValue.length}function B(a,b){var c=a.contextBrowser.selectedAsset,d=c.entityKey;a.searchSelectedKey=d}function C(a){var b=null===a.contextBrowser.selectedAsset||"-1"===a.contextBrowser.selectedAsset.key&&a.contextBrowser.selectedAsset.key!==a.contextBrowser.selectedAssetKey?a.selectedAsset:a.contextBrowser.selectedAsset,c=b?b.entityKey:"-1";O(a)&&(c="-1"),a.searchTerm=null,a.service.path(c).done(D.bind(null,a))}function D(a,b){if(a.contextBrowser)if(b.length>1){for(var c=[],d=0;d<b.length;d++)b[d].name=b[d].description,b[d].key=b[d].entityKey,b[d].parentKey="-1",b[d].hasChildren=!0,c.push(b[d]);a.currentContext=[].concat(c),a.isFirstLoad=!0,a.pathToNavigateInitial=c,J(a,a.pathToNavigateInitial).then(function(){z(a).done(function(){a.contextBrowser.navigate(c)})})}else z(a)}
t.prototype.detach=function a(){this.service.abort(),this.region.$element.find(".hierarchy-control-filter").off("filter-closed"),this.contextBrowser.removeEventListener("selected",this),this.contextBrowser=null,this.toolbar=null,this.filterElem=null,this.searchElem=null,this.searchTerm=null,this.applyingFilter=!1,this.currentContext=[],this.contextNodes={},this.category(null),this.class(null),this.type(null),u.prototype.detach.call(this,this.region),this.region=null,this.filterConfigLoaded=!1},t.prototype.unload=function a(){this.kom.dispose()},t.prototype.translate=function(a){return this.translator.translate(a)},t.prototype.loadcontext=function(a){this.contextBrowser.selected=a,this.service.path(a).done(N.bind(null,this)).fail(P.bind(null,this))};var E=o.cond([[o.or(o.equals("0"),o.equals(0)),o.always(null)],[o.T,o.identity()]]);t.prototype.setSiteFilter=function(a){a&&(this.sites=o.map(E,a))},t.prototype.loadState=function(a){a=a||{tree:{value:i.default()}},
this.category(a.category),this.class(a.class),this.type(a.type),this.searchTerm=a.searchTerm,this.selectedAsset=a.context},t.prototype.saveState=function(){var a=null===this.contextBrowser.selectedAsset||null!==this.contextBrowser.selectedAsset&&"-1"===this.contextBrowser.selectedAsset.key&&this.contextBrowser.selectedAsset.key!==this.contextBrowser.selectedAssetKey;return{category:this.category(),class:this.class(),type:this.type(),context:a?this.selectedAsset:this.contextBrowser.selectedAsset,searchTerm:this.searchTerm}},t.prototype.getContextValue=function(){var a=null===this.contextBrowser.selectedAsset||"-1"===this.contextBrowser.selectedAsset.key&&this.contextBrowser.selectedAsset.key!==this.contextBrowser.selectedAssetKey;return i.fromHierarchyDTO(a?this.selectedAsset:this.contextBrowser.selectedAsset)},t.prototype.addAllChildren=function(a,b){var c=new CustomEvent("selectallchildren",{bubbles:!0,cancelable:!0,detail:a.contextBrowser.selectedAsset})
;a.contextBrowser&&a.contextBrowser.dispatchEvent(c)};function F(b,c,d,e,f){var g=a.Deferred();return e=s,f=r,b.searchTerm=c,c&&o.isNil(b.sites)?b.service.search(c,e,f).done(L.bind(null,b,g)).fail(P.bind(null,b)):c&&!o.isNil(b.sites)?b.service.search(c,e,f).done(M.bind(null,b,g,b.sites)).fail(P.bind(null,b)):g.resolve(),g}function G(b,c,d,e,g){var h="",i="",j="",k=d||a.Deferred(),l;return b.contextBrowser?(l=c||f.assetcontext)?b.contextNodes[l.entityKey]?(o.isNil(b.sites)?H(b,k,l,b.contextNodes[l.entityKey]):I(b,k,l,b.sites,b.contextNodes[l.entityKey]),delete b.contextNodes[l.entityKey],k):(b.category()&&(h=b.category().code),b.class()&&(i=b.class().code),b.type()&&(j=b.type().code),o.isNil(b.sites)?b.service.children(l.entityKey,h,i,j,s,q).done(H.bind(null,b,k,l)).fail(P.bind(null,b)):b.service.children(l.entityKey,h,i,j,s,q,b.sites).done(I.bind(null,b,k,l,b.sites)).fail(P.bind(null,b)),k):(setTimeout(H.bind(null,b,k,{data:[]})),k):(setTimeout(k.reject.bind(k),0),k)}
function H(a,b,c,d){for(var e=!1,f=a.currentContext&&a.currentContext.length>1,g=!1,h=0,i=0;i<a.currentContext.length-1;i++)a.currentContext[i].entityKey===c.entityKey&&(g=!0,h=i);var j=d.data.map(function(b){return b.name=b.description,b.key=a.searchTerm?R():b.entityKey,b.parentKey=a.searchTerm?c.key:c.entityKey,b.hasChildren=!!b.hasChildren,g&&!e&&f&&!a.searchTerm&&a.currentContext[h].entityKey===b.parentKey&&a.currentContext[h+1].entityKey===b.entityKey&&(e=!0),b});if(!e&&f&&g&&!a.searchTerm&&!a.applyingFilter){var k=a.currentContext[h+1];j.push(k)}if(j.length>=q){var l=a.searchTerm?c.key:c.entityKey,m={key:l.toString()+"_more_data",isAlertMessage:!0,name:a.translate("ASSET_HIERARCHY_TOO_MANY_MSG"),pathLabel:a.translate("ASSET_HIERARCHY_TOO_MANY_SUGGESTION"),parentKey:l};j.push(m)}b.resolve(j),a.category()&&0===d.data.length&&a.applyingFilter?z(a,!1):a.applyingFilter=!1}function I(a,b,c,d,e){o.forEach(K.bind(null,d),e.data)
;for(var f=!1,g=a.currentContext&&a.currentContext.length>1,h=!1,i=0,j=0;j<a.currentContext.length-1;j++)a.currentContext[j].entityKey===c.entityKey&&(h=!0,i=j);var k=e.data.map(function(b){return b.name=b.description,b.key=a.searchTerm?R():b.entityKey,b.parentKey=a.searchTerm?c.key:c.entityKey,b.hasChildren=!!b.hasChildren,b.canOpen=!b.disabledIcon,h&&!f&&g&&!a.searchTerm&&a.currentContext[i].entityKey===b.parentKey&&a.currentContext[i+1].entityKey===b.entityKey&&(f=!0),b});if(!f&&g&&h&&!a.searchTerm&&!a.applyingFilter){var l=a.currentContext[i+1];k.push(l)}if(k.length>=q){var m=a.searchTerm?c.key:c.entityKey,n={key:m.toString()+"_more_data",isAlertMessage:!0,name:a.translate("ASSET_HIERARCHY_TOO_MANY_MSG"),pathLabel:a.translate("ASSET_HIERARCHY_TOO_MANY_SUGGESTION"),parentKey:m};k.push(n)}b.resolve(k),a.category()&&0===e.data.length&&a.applyingFilter?z(a,!1):a.applyingFilter=!1}function J(b,c){var d=c.filter(function(a){return a.entityKey!==c[c.length-1].entityKey})
;return a.when.apply(a,d.map(function(a){return b.service.children(a.entityKey,"","","",s,q)})).then(function(){for(var a=0;a<d.length;a++)b.contextNodes[d[a].key]=arguments[a]})}function K(a,b){b.disabledIcon=!o.contains(b.siteKey,a)}function L(a,b,c){if(b.resolve(c.data),a.searchSelectedKey=null,a.contextBrowser){var d=c.data.map(function(a){return a.name=a.description,a.key=R(),a.parentKey="-1",a.hasChildren=!!a.hasChildren,a.pathLabel=a.hierarchyPath,a});if(d.length>=r){var e={key:R()+"_more_data",isAlertMessage:!0,name:a.translate("ASSET_HIERARCHY_TOO_MANY_MSG"),pathLabel:a.translate("ASSET_HIERARCHY_TOO_MANY_SUGGESTION"),parentKey:"-1"};d.push(e)}a.contextBrowser.init(d)}}function M(a,b,c,d){if(o.forEach(K.bind(null,c),d.data),b.resolve(d.data),a.searchSelectedKey=null,a.contextBrowser){var e=d.data.map(function(a){return a.name=a.description,a.key=R(),a.parentKey="-1",a.hasChildren=!!a.hasChildren,a.canOpen=!a.disabledIcon,a.pathLabel=a.hierarchyPath,a});if(e.length>=r){var f={
key:R()+"_more_data",isAlertMessage:!0,name:a.translate("ASSET_HIERARCHY_TOO_MANY_MSG"),pathLabel:a.translate("ASSET_HIERARCHY_TOO_MANY_SUGGESTION"),parentKey:"-1"};e.push(f)}a.contextBrowser.init(e)}}function N(a,b){var c;if(a&&a.contextBrowser){for(var d=[],e=0;e<b.length;e++)b[e].name=b[e].description,b[e].key=b[e].entityKey,b[e].parentKey="-1",b[e].hasChildren=!0,d.push(b[e]);c=[a.category(),a.class(),a.type()],a.currentContext=[].concat(d),a.pathToNavigateInitial=d,a.searchTerm&&null!==a.searchTerm?a.contextBrowser.search(a.searchTerm):c[0]?(z(a,!0,!1),a.filterConfigLoaded&&a.contextBrowser.filter(c)):J(a,a.pathToNavigateInitial).then(function(){z(a).done(function(){a.isFirstLoad?a.contextBrowser.navigate(d):a.pathToNavigateInitial=d})})}}function O(b){return!!a(b.region.element).parents(".asset-finder-screen").length}function P(a,b,c,d){d&&"abort"!==d&&k.error(d,void 0,{positionClass:"toast-top-right "})}function Q(){
return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function R(){return Q()+Q()+""+Q()+Q()+Q()+Q()+Q()+Q()}return t});
define('assets/services/asset-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.entityKey=a.toString(b.entityKey),this.equipmentId=a.toString(b.equipmentId),this.groupid=a.toString(b.equipmentId),this.familyId=a.toString(b.familyId),this.siteKey=a.toInteger(b.siteKey)}return b.fromDataCollection=function a(c){var d,e=[];for(d=0;d<c.length;d++)e[d]=new b(c[d]);return e},b.fromSelectedAsset=function a(c){return new b({entityKey:c.entityKey,equipmentId:c.description,familyId:c.familyId,siteKey:c.siteKey})},b.fromSelectedAssetArray=function a(c){return c.map(b.fromSelectedAsset)},b});
define('assets/services/asset-group-dto',['require','system/lang/converter','assets/services/asset-dto','assets/services/hierarchy-dto','assets/models/family','system/lang/string'],function(require){"use strict";var a=require("system/lang/converter"),b=require("assets/services/asset-dto"),c=require("assets/services/hierarchy-dto"),d=require("assets/models/family");require("system/lang/string");function e(e){e=e||{},this.entityKey=a.toString(e.entityKey),this.groupid=a.toString(e.groupid),this.createdBy=a.toString(e.createdBy),this.modifiedBy=a.toString(e.lastUpdatedBy),this.modifiedOn=a.toDate(e.lastUpdatedDate),this.groupdesc=a.toString(e.groupdesc),this.catalogKey=a.toInteger(e.catalogKey),this.catalogPath=a.toString(e.catalogPath),this.siteKey=a.toInteger(e.siteKey),this.equipmentCount=a.toInteger(e.equipmentCount),this.relationships=e.relationships?d.fromDataCollection(e.relationships):[],this.equipments=e.equipments?b.fromDataCollection(e.equipments):[],this.corrosionloops=e.corrosionloops?f(e.corrosionloops):[],this.hierarchyparents=e.hierarchyparents?c.fromDataCollection(e.hierarchyparents):[],this.selected=null}e.fromDataCollection=function a(b){
var c,d=[];for(c=0;c<b.length;c++)d[c]=new e(b[c]);return d},e.fromAssetContextDTO=function a(b){return new e({entityKey:b.entityKey,createdBy:b.createdBy,groupid:b.description})};function f(b){var c,d=[];for(c=0;c<b.length;c++)d[c]=a.toString(b[c]);return d}return e});
define('security/services/site-dto',['require','./usersite-dto','system/lang/converter'],function(require){"use strict";var a=require("./usersite-dto"),b=require("system/lang/converter");function c(c){c=c||{},this.name=b.toString(c.name),this.key=b.toString(c.key)||"0",this.lockSeq=b.toString(c.lockSeq),this.users=a.fromDataCollection(c.users)}return c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}},c});
define('system/lang/url-codec',["require","exports"],function(require,exports){"use strict";var a=[],b=/\[\]$/,c=/\[/,d=/\]$/,e=function(){function b(){}return b.encode=function(b){return a=[],h("",b).join("&")},b.decode=function(a){return i(a)},b}();function f(a){return"[object Array]"===Object.prototype.toString.call(a)}function g(b,c){c="function"==typeof c?c():null===c?"":void 0===c?"":c,a[a.length]=encodeURIComponent(b)+"="+encodeURIComponent(c)}function h(c,d){var e,i;if(c)if(f(d))for(e=0,i=d.length;e<i;e++)b.test(c)?g(c,d[e]):h(c+"["+("object"==typeof d[e]?e:"")+"]",d[e]);else if(d&&"[object Object]"===String(d))for(var j in d)d.hasOwnProperty(j)&&h(c+"["+j+"]",d[j]);else g(c,d);else if(f(d))for(e=0,i=d.length;e<i;e++)g(d[e].name,d[e].value);else for(var j in d)d.hasOwnProperty(j)&&h(j,d[j]);return a}function i(a){var b={};return a?(a.split("&").forEach(j.bind(null,b)),b):b}function j(a,b){var e=b.split("="),f=decodeURIComponent(e[0]),g=typeof a,h=f.split("]["),i=h.length-1
;if(c.test(h[0])&&d.test(h[i])){h[i]=h[i].replace(d,"");var j=h.shift();null!==j&&(h=j.split("[").concat(h),i=h.length-1)}else i=0;if(2===e.length){var k=decodeURIComponent(e[1]);if(i)for(var l=0;l<=i;l++)f=""===h[l]?g.length:h[l],g=g[f]=l<i?g[f]||(h[l+1]&&isNaN(h[l+1])?{}:[]):k;else"[object Array]"===Object.prototype.toString.call(a[f])?a[f].push(k):!{}.hasOwnProperty.call(a,f)?a[f]=k:a[f]=[a[f],k]}}return e});
define('assets/services/group-service',['require','jquery','system/http/ajax-client','assets/services/asset-group-dto','assets/services/asset-dto','assets/services/hierarchy-dto','security/services/site-dto','catalog/services/dto/user-pref-dto','system/lang/url-codec'],function(require){"use strict";var a=require("jquery"),b=require("system/http/ajax-client"),c=require("assets/services/asset-group-dto"),d=require("assets/services/asset-dto"),e=require("assets/services/hierarchy-dto"),f="api/common/assetgroup",g="api/core/security",h=require("security/services/site-dto"),i=require("catalog/services/dto/user-pref-dto"),j="api/core/userpref/",k=require("system/lang/url-codec");function l(a){this.ajaxClient=a,this.request=null}l.dependsOn=[b],l.prototype.abort=function a(){this.request&&this.request.abort()},l.prototype.getAllGroups=function(b,c,d,e,g,h){var i=a.Deferred(),j="",k="",l;for(d=d||[],l=0;l<d.length;l++)j+="&keys="+d[l];return h=h?"&searchterm="+h:"",e=e?"&relationshipId="+e:"",g=g?"&byCurrUser="+g:"",k="?page="+b+"&pageSize="+c+j+e+g+h,this.ajaxClient.get(f+k).done(n.bind(null,i)).fail(i.reject.bind(i)),i.promise()},l.prototype.getGroupDetails=function b(c){var d=a.Deferred()
;return this.ajaxClient.get(f+"/"+c.toString()).done(o.bind(null,d)).fail(u.bind(null,d)),d.promise()},l.prototype.assets=function b(c,d,e){var g=a.Deferred();return this.ajaxClient.get(f+"/"+c+"/assets?page="+d+"&pageSize="+e).done(q.bind(null,g)).fail(g.reject.bind(g)),g.promise()},l.prototype.allAssets=function b(c){var d=a.Deferred();return this.ajaxClient.get(f+"/"+c+"/assets").done(q.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.assetsByKey=function b(c){var d=a.Deferred();return this.ajaxClient.get(f+"/"+c+"/assetsbykey").done(q.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.getGroupDetailsWithPaging=function(b,c,d){var e=a.Deferred(),g=this;return this.request=this.ajaxClient.get(f+"/"+b.toString()+"?page="+c.toString()+"&pageSize="+d.toString()).done(o.bind(null,e)).fail(e.reject.bind(e)).always(p.bind(null,g)),e.promise()},l.prototype.addGroup=function b(c){var d=a.Deferred()
;return this.ajaxClient.post(f,c).done(o.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.editGroup=function b(c){var d=a.Deferred();return this.ajaxClient.put(f,c).done(t.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.removeGroup=function b(c){var d=a.Deferred();return this.ajaxClient.delete(f+"/"+c.toString()).done(t.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.addAssets=function b(c,d,e){var g=a.Deferred();return e=e?"?contextKey="+e.toString():"",this.ajaxClient.post(f+"/"+c.toString()+"/assets"+e,d).done(t.bind(null,g)).fail(g.reject.bind(g)),g.promise()},l.prototype.removeAssets=function b(c,d){var e=a.Deferred(),g=null,h,i=[],j;for(j=d.splice(0,50);j&&j.length>0;)h=j.map(m),g=k.encode({keys:h}),i[i.length]=this.ajaxClient.delete(f+"/"+c.toString()+"/assets?"+g),j=d.splice(0,50);return a.when.apply(a,i).done(t.bind(null,e)).fail(e.reject.bind(e)),e.promise()},l.prototype.addAssociations=function b(c,d){var e=a.Deferred()
;return this.ajaxClient.post(f+"/"+c+"/hierarchy",d).done(t.bind(null,e)).fail(e.reject.bind(e)),e.promise()},l.prototype.removeAssociations=function b(c,d){var e=a.Deferred(),g=null;return g=k.encode({keys:d}),this.ajaxClient.delete(f+"/"+c+"/hierarchy?"+g).done(t.bind(null,e)).fail(e.reject.bind(e)),e.promise()},l.prototype.getAssociations=function b(c){var d=a.Deferred();return this.ajaxClient.get(f+"/"+c.toString()+"/hierarchy").done(s.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.getSites=function b(){var c=a.Deferred();return this.ajaxClient.get(g+"/sites",{}).done(r.bind(null,c)).fail(c.reject.bind(c)),c.promise()},l.prototype.getPreference=function b(c,d){var e=a.Deferred(),f=j+"get/"+c+"/1?name="+d;return this.ajaxClient.get(f,{}).done(t.bind(null,e)).fail(e.reject.bind(e)),e.promise()},l.prototype.setPreference=function b(c){var d=a.Deferred(),e=j+"set";return this.ajaxClient.post(e,c).done(t.bind(null,d)).fail(d.reject.bind(d)),d.promise()},
l.prototype.copyGroup=function b(c){var d=a.Deferred();return this.ajaxClient.post(f+"/copy",c).done(o.bind(null,d)).fail(u.bind(null,d)),d.promise()},l.prototype.checkPermission=function(){var b=a.Deferred();return this.ajaxClient.get(f+"/permission").done(b.resolve.bind(b)).fail(b.reject.bind(b)),b.promise()};function m(a){return a.entityKey||a}function n(a,b){a.resolve(c.fromDataCollection(b))}function o(a,b){a.resolve(new c(b))}function p(a){a.request=null}function q(a,b){a.resolve(d.fromDataCollection(b))}function r(a,b){a.resolve(h.fromDataCollection(b))}function s(a,b){a.resolve(e.fromDataCollection(b))}function t(a,b){a.resolve(b)}function u(a,b,c,d){a.reject(b,c,d)}return l});

define('text!assets/views/asset-group-control.html',[],function () { return '<div data-bind="if: settings.loadAssets, style: { height: settings.loadAssets ? \'100%\' : 0 }">\r\n    <mi-tree description="groupid"\r\n             custom-filter="true"\r\n             data-bind="attr: { \'root-name\': translate(\'ASSET_GROUPS\'), multiselect: settings.multiSelect, \'allow-add\': settings.allowAdd, \'has-children\': settings.hasChildren }">\r\n        <mi-tool-bar>\r\n            <!-- ko if: settings.enableAddAllChildren === true -->\r\n            <button class="btn btn-default btn-icon" data-bind="click: addAllChildren, attr: { title: translate(\'ADD_ALL_CHILDREN\'), disabled: disableSelectAllChildren }">\r\n                <i class="icon-plus"></i>\r\n            </button>\r\n            <!-- /ko -->\r\n        </mi-tool-bar>\r\n    </mi-tree>\r\n</div>\r\n\r\n<div data-bind="ifnot: settings.loadAssets, style: { height: !settings.loadAssets ? \'100%\' : 0 }">\r\n<mi-list-group description="groupid"\r\n               custom-filter="true"\r\n               data-bind="attr: { selector: settings.selector, multiselect: settings.multiSelect, \'allow-add\': settings.allowAdd, \'has-children\': settings.hasChildren }">\r\n</mi-list-group>\r\n</div>\r\n';});


define('text!assets/views/hierarchy-finder.html',[],function () { return '<section class="asset-hierarchy-finder">\r\n    <section class="hierarchy-control"></section>\r\n    <section class="well tag-section" data-bind="foreach: results">\r\n        <span class="tag" data-bind="click: $root.removeSelection.bind($root)">\r\n            <span class="block-group">\r\n                <span data-bind="text: description"></span>\r\n                <i class="icon-multiply"></i>\r\n            </span>\r\n        </span>\r\n    </section>\r\n    <div class="controls">\r\n        <button type="button" class="btn  btn-text  btn-secondary" data-bind="click: cancel, text: translate(\'CANCEL\')"></button>\r\n        <button type="button" class="btn btn-text" data-bind="click: done, text: translate(\'OK\'), enable: hasSelection"></button>        \r\n    </div>\r\n</section>\r\n';});

define('assets/models/selected-asset',[],function(){"use strict";function a(a,b,c,d,e){this.entityKey=a,this.description=b,this.family=c,this.familyId=d,this.siteKey=e?e:0}return a});
define('assets/adapters/selected-asset-adapter',['require','assets/models/selected-asset'],function(require){"use strict";var a=require("assets/models/selected-asset");function b(){}return b.fromAssetDTO=function b(c){return new a(c.entityKey,c.equipmentId,"",c.familyId,c.siteKey)},b.fromAssetDTOArray=function a(c){return c.map(b.fromAssetDTO)},b.fromHierarchyDTO=function b(c){return new a(c.entityKey,c.description,c.family,c.familyId,c.siteKey)},b.fromAssetGroupDTO=function b(c){return new a(c.entityKey,c.groupid,"","",c.siteKey)},b.fromHierarchyDTOArray=function a(c){return c.map(b.fromHierarchyDTO)},b});
define('assets/hierarchy-finder',['require','jquery','knockout','system/knockout/knockout-manager','spa/ko/knockout-view-model','assets/asset-hierarchy-control','system/ui/dialog-view-model','text!./views/hierarchy-finder.html','system/globalization/translator','assets/adapters/selected-asset-adapter'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("system/knockout/knockout-manager"),d=require("spa/ko/knockout-view-model"),e=require("assets/asset-hierarchy-control"),f=require("system/ui/dialog-view-model"),g=require("text!./views/hierarchy-finder.html"),h=require("system/globalization/translator"),i=require("assets/adapters/selected-asset-adapter");function j(){k.call(this,g),this.dialog=null,this.dfd=null,this.translator=Object.resolve(h),this.kom=Object.resolve(c),this.results=null,this.existing=[],this.assetHierarchyControl=null,this.settings={multiSelect:!0,contentArea:".hierarchy-control",selector:"addOnly"}}var k=Object.inherit(d,j);j.prototype.show=function b(c,d){var e={height:"90%",width:"40%"};return d===!1&&(this.settings.multiSelect=d),c=c||[],c.map instanceof Function?this.existing=c.map(i.fromHierarchyDTO):this.existing=[i.fromHierarchyDTO(c)],this.dialog=new f(this,this.translator.translate("HIERARCHY_FINDER"),e),
this.dialog.show(),this.dfd=a.Deferred(),this.dfd.promise()},j.prototype.close=function a(){this.dialog=null},j.prototype.load=function a(){this.results=this.kom.observableArray(this.existing),this.hasSelection=this.kom.computed(l.bind(null,this)),this.assetHierarchyControl=e.create(this.settings),this.assetHierarchyControl.load()},j.prototype.attach=function a(b){k.prototype.attach.apply(this,arguments),this.assetHierarchyControl.attach(b),this.assetHierarchyControl.loadState(),this.assetHierarchyControl.contextBrowser.addEventListener("multiSelected",this),this.assetHierarchyControl.contextBrowser.addEventListener("search-selected",this)},j.prototype.detach=function a(){this.assetHierarchyControl.contextBrowser.removeEventListener("multiSelected",this),this.assetHierarchyControl.contextBrowser.removeEventListener("search-selected",this),this.assetHierarchyControl.detach(),k.prototype.detach.apply(this,arguments)},j.prototype.unload=function a(){this.kom.dispose(),
"resolved"!==this.dfd.state()&&this.dfd.reject(),this.dfd=null,this.assetHierarchyControl.unload(),this.assetHierarchyControl=null,this.existing=null},j.prototype.handleEvent=function(a){"multiSelected"===a.type?o(this,a.detail):"search-selected"===a.type&&o(this,a.searchResult[0])},j.prototype.done=function a(){this.settings.multiSelect?this.dfd.resolve(this.results()):this.dfd.resolve(this.results()[0]),this.dialog.closeDialog()},j.prototype.cancel=function a(){this.dialog.closeDialog()},j.prototype.translate=function a(b){return this.translator.translate(b)},j.prototype.removeSelection=function a(c,d){var e=b.dataFor(d.target);d.target.classList.contains("icon-multiply")&&e.entityKey&&n(this,e.entityKey)};function l(a){return a.results().length>0}function m(a,b){for(var c=0;c<a.length&&a[c].entityKey!==b;)c++;return c===a.length?-1:c}function n(a,b){var c=0;(c=m(a.results(),b))>-1&&a.results.splice(c,1)}function o(a,b){
b&&(a.settings.multiSelect?m(a.results(),b.entityKey)===-1&&a.results.push(i.fromHierarchyDTO(b)):a.results.splice(0,1,i.fromHierarchyDTO(b)))}return j});

define('text!assets/views/group-filter.html',[],function () { return '<section class="group-filter">\r\n    <section class="form-group">\r\n        <label class="control-label" for="relationships" data-bind="text: $root.translate(\'ASSET_HIERARCHY_RELATIONSHIP_FIELD\')"></label>\r\n        <select class="form-control"\r\n                name="relationships"\r\n                data-bind="options: relationships, optionsText: \'caption\', optionsValue: \'id\', value: $root.selectedFamily, optionsCaption: $root.translate(\'ASSET_HIERARCHY_RELATIONSHIP_CAPTION\')"></select>\r\n    </section>\r\n\r\n    <section class="hierarchy">\r\n        <button class="hierarchy-filter btn btn-default" data-bind="click: editHierarchy, text: translate(\'HIERARCHY_FILTER\')"></button>\r\n        <div class="hierarchy-list">\r\n            <ul data-bind="foreach: results, click: removeHierarchyFilter">\r\n                <li class="list-group-item"><i class="icon-multiply"></i><span data-bind="text: description"></span></li>\r\n            </ul>\r\n        </div>\r\n    </section>\r\n\r\n    <section class="my-groups">\r\n        <mi-checkbox data-bind="miCheckboxProperty: {\r\n                            checked: filterByCurrUser,\r\n                            disable: false,\r\n                            value: filterByCurrUser,\r\n                            text: translate(\'MY_GROUPS\')}">\r\n        </mi-checkbox>\r\n    </section>\r\n\r\n    <div class="controls">\r\n        <button type="button" class="btn  btn-text  btn-secondary" data-bind="click: cancel, text: translate(\'CLOSE\')"></button>\r\n        <button type="button" class="btn btn-text" data-bind="click: done, text: translate(\'DONE\')"></button>\r\n    </div>\r\n</section>\r\n';});

define('assets/group-filter-view-model',['require','jquery','knockout','spa/ko/knockout-view-model','system/ui/dialog-view-model','system/globalization/translator','assets/hierarchy-finder','assets/services/hierarchy-service','text!./views/group-filter.html','ui/elements/checkbox/checkbox-view-model'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("spa/ko/knockout-view-model"),d=require("system/ui/dialog-view-model"),e=require("system/globalization/translator"),f=require("assets/hierarchy-finder"),g=require("assets/services/hierarchy-service"),h=require("text!./views/group-filter.html");require("ui/elements/checkbox/checkbox-view-model");function i(){j.call(this,h),this.dialog=null,this.dfd=null,this.existing=[],this.relationships=[],this.family=null,this.selectedFamily=null,this.service=Object.resolve(g),this.translator=Object.resolve(e),this.results=null,this.finder=null,this.byCurrUser=null,this.filterByCurrUser=!1}var j=Object.inherit(c,i);i.prototype.show=function b(c,e,f){var g={height:"70%",width:"40%"};return c&&c instanceof Array?this.existing=c:this.existing=c?[c]:[],this.family=e,this.byCurrUser=f,this.dialog=new d(this,this.translator.translate("GROUP_FILTER"),g),this.dialog.show(),this.dfd=a.Deferred(),this.dfd.promise()},
i.prototype.close=function a(){this.dialog=null},i.prototype.load=function c(){this.finder=new f,a.isArray(this.existing)?this.results=b.observableArray(this.existing):this.results=b.observableArray([this.existing]),this.selectedFamily=b.observable(this.family),this.relationships=b.observableArray([]),this.filterByCurrUser=b.observable(this.byCurrUser),this.service.relationshipsById().done(k.bind(null,this))},i.prototype.attach=function a(){j.prototype.attach.apply(this,arguments)},i.prototype.detach=function a(){j.prototype.detach.apply(this,arguments)},i.prototype.unload=function a(){this.dialog=null,this.dfd=null,this.existing=[],this.existing=null,this.results([]),this.results=null,this.finder.close(),this.finder=null,this.selectedFamily(null),this.family=null,this.filterByCurrUser(null)},i.prototype.done=function a(){var b={family:this.selectedFamily(),results:this.results(),byCurrUser:this.filterByCurrUser()};this.dfd.resolve(b),this.dialog.closeDialog()},
i.prototype.cancel=function a(){this.dialog.closeDialog()},i.prototype.translate=function a(b){return this.translator.translate(b)},i.prototype.editHierarchy=function a(){this.finder.show(this.results()).done(l.bind(null,this))},i.prototype.removeHierarchyFilter=function c(d,e){var f=b.dataFor(e.target),g=0;if(a(e.target).hasClass("icon-multiply"))for(g=0;g<this.results().length;g++)this.results()[g].entityKey===f.entityKey&&this.results.splice(g,1)};function k(a,b){a.relationships(b),a.selectedFamily(a.family),a.filterByCurrUser(a.byCurrUser)}function l(a,b){a.results(b)}return i});
define('assets/asset-group-control',['require','jquery','bluebird','system/http/es6-ajax-request','spa/ko/knockout-view-model','spa/region','assets/services/group-service','assets/services/hierarchy-service','assets/services/asset-group-dto','assets/services/asset-context-dto','text!./views/asset-group-control.html','system/globalization/translator','assets/group-filter-view-model','system/error/error-message','application/application-events','application/application-context','catalog/services/dto/user-pref-dto','system/knockout/knockout-manager','catalog/services/catalog-constants','ui/elements/list-group/view-model','ui/elements/tree/view-model','ui/elements/tool-bar/view-model'],function(require){"use strict";var a=require("jquery"),b=require("bluebird"),c=require("system/http/es6-ajax-request"),d=require("spa/ko/knockout-view-model"),e=require("spa/region"),f=require("assets/services/group-service"),g=require("assets/services/hierarchy-service"),h=require("assets/services/asset-group-dto"),i=require("assets/services/asset-context-dto"),j=require("text!./views/asset-group-control.html"),k=require("system/globalization/translator"),l=require("assets/group-filter-view-model"),m=require("system/error/error-message"),n=require("application/application-events"),o=require("application/application-context"),p=require("catalog/services/dto/user-pref-dto"),q=require("system/knockout/knockout-manager"),r=require("catalog/services/catalog-constants");require("ui/elements/list-group/view-model"),require("ui/elements/tree/view-model"),require("ui/elements/tool-bar/view-model");var s={multiSelect:!1,selector:"none",contentArea:"",allowAdd:!1,loadAssets:!0,
hasChildren:!1};function t(a,b,c,d){u.call(this,j),this.user=o.user,this.constants=new r,this.groupService=a,this.hierarchyService=Object.resolve(g),this.translator=b,this.settings=null,this.selectedHierarchy=null,this.selectedFamily=null,this.filter=null,this.groupElement=null,this.appEvents=c,this.delayed=!1,this.filterByCurrUser=!1,this.kom=d,this.selectChildren=null,this.disableSelectAllChildren=null}var u=Object.inherit(d,t,q);t.dependsOn=[f,k,n,q],t.create=function b(c){var d=Object.resolve(t);return d.settings=a.extend(null,s,c),d.filter=new l,d},t.prototype.addAllChildren=function(){var a=new CustomEvent("selectallchildren",{bubbles:!0,cancelable:!0});this.groupElement.dispatchEvent(a)},t.prototype.attach=function a(b){var c;this.disableSelectAllChildren=this.kom.observable(!0),this.settings.contentArea?(c=new e,c.setElement(b.$element.find(this.settings.contentArea))):c=b,u.prototype.attach.call(this,c),this.groupElement=c.$element.find("mi-tree, mi-list-group")[0],
Element.upgrade(this.groupElement),v(this).then(E.bind(null,this)).then(w.bind(null,this))};function v(a){return b.resolve(a.groupService.getPreference(a.user.key,"groups-by-user"))}function w(a){null!==a.groupElement&&(a.groupElement.loader=a.loadGroup.bind(a),a.groupElement.addEventListener("search-selected",a),a.groupElement.addEventListener("filter-closed",a),a.groupElement.addEventListener("navigating",a),a.groupElement.addEventListener("navigated",a),a.settings.loadAssets?a.groupElement.searchCallback=a.searchGroupTree.bind(a):a.groupElement.searchCallback=a.searchGroupList.bind(a),a.groupElement.filterViewModel=a.editFilter.bind(a),a.groupElement.setAttribute("allow-add",a.settings.allowAdd))}t.prototype.handleEvent=function(a){"navigating"===a.type?(3===a.newValue.length&&a.preventDefault(),
this.disableSelectAllChildren(x(a))):"navigated"===a.type&&2===a.target.pathHistory.listGroup.length?a.target.pathHistory.listGroup[1].setAttribute("has-children","false"):"search-selected"===a.type?this.loadcontext(a.searchResult[0]):"filter-closed"===a.type&&(this.applyingFilter=!0)};function x(a){return 1===a.newValue.length}t.prototype.detach=function a(b){var c;this.groupElement.removeEventListener("search-selected",this),this.groupElement.removeEventListener("filter-closed",this),this.groupElement.removeEventListener("navigating",this),this.groupElement.removeEventListener("navigated",this),this.groupElement=null,this.settings.contentArea?(c=new e,c.setElement(b.$element.find(this.settings.contentArea))):c=b,this.filter&&this.filter.close(),c.screen&&u.prototype.detach.call(this,c)},t.prototype.unload=function a(){this.filter&&(this.filter.close(),this.filter=null)},t.prototype.translate=function a(b){return this.translator.translate(b)},t.prototype.editFilter=function a(){
this.filter.show(this.selectedHierarchy,this.selectedFamily,this.filterByCurrUser).done(y.bind(null,this)).fail(B.bind(null,this))},t.prototype.searchGroupTree=function(a,b,c,d){return this.groupService.getAllGroups(c,d,z(this),this.selectedFamily,this.filterByCurrUser,a).fail(B.bind(null,this)).promise()},t.prototype.searchGroupList=function(a,b,c){return this.groupService.getAllGroups(b,c,z(this),this.selectedFamily,this.filterByCurrUser,a).fail(B.bind(null,this)).promise()},t.prototype.loadGroup=function b(c,d,e){var f=a.Deferred();return void 0===e?this.groupService.getAllGroups(c,d,z(this),this.selectedFamily,this.filterByCurrUser).done(f.resolve.bind(f)).fail(B.bind(null,this)):0===c?this.groupService.getAllGroups(d,e,z(this),this.selectedFamily,this.filterByCurrUser).done(f.resolve.bind(f)).fail(B.bind(null,this)):this.groupService.assets(this.groupElement.value[c].entityKey,d,e).done(f.resolve.bind(f)).fail(B.bind(null,this)),f.promise()},t.prototype.loadcontext=function(a){
a&&(this.settings.loadAssets?C(this,a):D(this,a))},t.prototype.getContextValue=function(){return this.loadAssets?i.fromGroupDTO(this.groupElement.value[this.groupElement.value.length-1]):i.fromGroupDTO(this.groupElement.value||this.groupElement.items[0])},t.prototype.setValue=function(a,b){var c=b.originalEvent.searchResult[0];c&&(this.groupElement.value=c,this.groupElement.reload())},t.prototype.loadState=function(a){a=a||{},this.selectedHierarchy=a.hierarchy,this.selectedFamily=a.family,this.filterByCurrUser=a.byCurrUser,this.groupElement.loadState(a.groupElement)},t.prototype.saveState=function(){return{hierarchy:this.selectedHierarchy,family:this.selectedFamily,byCurrUser:this.filterByCurrUser,groupElement:this.groupElement.saveState()}};function y(a,b){a.selectedFamily=b.family,a.selectedHierarchy=b.results,a.filterByCurrUser!==b.byCurrUser&&(a.filterByCurrUser=b.byCurrUser,F(a)),a.groupElement.reload()}function z(a){
return a.selectedHierarchy?a.selectedHierarchy instanceof Array?0===a.selectedHierarchy.length?null:a.selectedHierarchy.map(A):[a.selectedHierarchy.entityKey]:null}function A(a){return a.entityKey}function B(a,b,c,d){if("abort"!==d){var e=new m("AG1",d,(new Error).stack);a.appEvents.errorOccured.raise(a,e)}}function C(a,b){"-1"===b.entityKey?a.groupElement.value&&a.groupElement.value.length>0&&(a.groupElement.value=a.groupElement.value[0]):a.groupElement.value[1]=h.fromAssetContextDTO(b)}function D(a,b){var c=h.fromAssetContextDTO(b);a.groupElement.value=c,a.groupElement.reload();var d=a.groupElement.querySelector("mi-list-group");d&&(Element.upgrade(d),d.value=c,d.reload())}function E(a,b){b&&b.value&&(a.filterByCurrUser="True"===b.value)}function F(a){var b=new p;b.userKey=a.user.key,b.prefType=a.constants.CATALOG_PREFERENCE,b.name="groups-by-user",b.value=a.filterByCurrUser,a.groupService.setPreference(b)}return t});
define('system/ui/dialog-box',['require','lodash','jquery','system/ui/dialog-view-model','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/ui/dialog-view-model");require("system/lang/object");function d(a,b,c){e.call(this,a,b,c),this.handlingButtonClick=!1,this.dfd=null,this.showHelp(!1),this.showClose(!1),this.showCheck(!1)}var e=Object.inherit(c,d);d.prototype.show=function(){return e.prototype.show.call(this),f(this),this.dialogContentRegion.$element.css("overflow-y","auto").addClass("dialog-box"),this.dfd=b.Deferred(),this.dfd.promise()},d.prototype.setContent=function(a){e.prototype.setContent.call(this,a)};function f(c){if(c.options&&c.options.buttons){var d=c.options.buttons||[],e=c.dialogShellRegion.$element.find(".dialog-wrapper");if(d.length>0){var f=b('<div class="button-bar clearfix text-right"></div>').appendTo(e);a.each(d,function(a,d){var e=a.cssClass?a.cssClass:"btn-default";b('<button class="btn pull-right '+e+'"><span>'+a.name+"</span></button>").on("click",g.bind(null,c,d,a.value||a.name)).appendTo(f)}),
b('<div class="clearfix"></div>').appendTo(f),c.centerDialog()}}}function g(a,c,d){if(!a.handlingButtonClick){a.handlingButtonClick=!0;var e=Object.tryMethod(a.content,d);if(e===!1)return void(a.handlingButtonClick=!1);b.when(e).done(function(b){a.dfd.resolve(c,d,b),a.closeDialog(),a.handlingButtonClick=!1}).fail(function(b){a.options.closeOnReject&&(a.dfd.reject(c,d,b),a.closeDialog()),a.handlingButtonClick=!1})}}d.prototype.closeDialog=function(){h(this),e.prototype.closeDialog.apply(this,arguments)};function h(c){var d=c.dialogShellRegion.$element.find(".dialog-wrapper"),e=b(".button-bar",d),f=e.find("button");a.each(f,i),e.remove(),c.centerDialog()}function i(a){b(a).off().remove()}return d});
define('assets/models/selected-asset-results',['require','knockout'],function(require){"use strict";var a=require("knockout");function b(){this.existing=null,this.selected=null,this.arrayChangeSubscription=null,this.added=[],this.removed=[]}b.prototype.init=function b(d){var e,f=[];if(this.existing=d,d)for(e=0;e<d.length;e++)f[f.length]=d[e];this.selected=a.observableArray(f),this.arrayChangeSubscription=this.selected.subscribe(c.bind(null,this),null,"arrayChange")},b.prototype.dispose=function a(){this.selected([]),this.selected=null,this.arrayChangeSubscription.dispose(),this.arrayChangeSubscription=null};function c(a,b){var c;for(c=0;c<b.length;c++)"added"===b[c].status?f(a,b[c].value):e(a,b[c].value.entityKey)}function d(a,b){for(var c=0,d=!1;c<a.length&&!d;)d=a[c].entityKey===b,c++;return d?a[c-1]:void 0}function e(a,b){var c=0,e=!1,f;if(f=d(a.existing,b))a.removed.push(f);else for(c=0,e=!1;c<a.added.length&&!e;)e=a.added[c].entityKey===b,e&&a.added.splice(c,1),c++}function f(a,b){var c=0,e=!1;if(d(a.existing,b.entityKey))for(c=0,
e=!1;c<a.removed.length&&!e;)e=a.removed[c].entityKey===b.entityKey,e&&a.removed.splice(c,1),c++;else d(a.added,b.entityKey)||a.added.push(b)}return b});

define('text!ui/elements/asset-context/template.html',[],function () { return '<div class="asset-context-selection static">\r\n  <div class="navigation">\r\n    <ul class="nav nav-pills assetMenu pull-left" data-bind="click: menuClick">\r\n      <li data-bind="css: {active: activePill() === hierarchy.url }">\r\n        <a data-bind="attr: { \'data-menu-item\': hierarchy.url, href: hierarchy.href, title: translator.translate(\'ASSET_HIERARCHY\') }, text: translator.translate(\'ASSET_HIERARCHY\')">\r\n        </a>\r\n      </li>\r\n      <li data-bind="css: {active: activePill() === group.url }">\r\n        <a data-bind="attr: { href: group.href, \'data-menu-item\': group.url, title: translator.translate(\'ASSET_GROUP\') }, text: translator.translate(\'ASSET_GROUP\')">\r\n        </a>\r\n      </li>\r\n    </ul>          \r\n  </div>\r\n  <section class="block-group context-select">\r\n    <section class="asset-content">\r\n      <section class="asset-hierarchy-control" data-bind="visible: $root.activePill() === \'hierarchy\'"></section>\r\n      <section class="asset-group-explorer" data-bind="visible: $root.activePill() === \'group\'"></section>\r\n    </section>\r\n  </section>\r\n</div>\r\n';});

define('assets/services/asset-context-service',['require','lodash','jquery','system/http/ajax-client','assets/services/asset-context-dto','application/application-context'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/http/ajax-client"),d=require("assets/services/asset-context-dto"),e=require("application/application-context"),f="api/common/assetcontext/";function g(a){this.ajaxClient=a,this.request=null}g.dependsOn=[c],g.prototype.getcontext=function c(d){var e=b.Deferred();return this.request&&this.abort(),d&&"-1"!==d&&"0"!==d?this.request=this.ajaxClient.get(f+d).done(k.bind(null,this,e)).fail(l.bind(null,this,e)):(this.request="home",a.defer(j,this,e,"-1")),e.promise()},g.prototype.abort=function(){this.request&&this.request.abort?this.request.abort():"home"===this.request&&(this.request="home-abort")},g.prototype.getAssetContextPreference=function(){var a=f+"preference/"+i(),c=b.Deferred();return this.ajaxClient.get(a).done(k.bind(null,this,c)).fail(l.bind(null,this,c)),c.promise()},g.prototype.getAssetContextAppHub=function(){var a=f+"apphub/"+i(),c=b.Deferred()
;return this.ajaxClient.get(a).done(h.bind(null,c)).fail(l.bind(null,this,c)),c.promise()};function h(a,b){return a.resolve(b)}g.prototype.setAssetContextAppHub=function(a){var c=f+"apphub/"+a,d=b.Deferred();return this.ajaxClient.put(c).done(k.bind(null,this,d)).fail(l.bind(null,this,d)),d.promise()};function i(){return e.user.key}function j(a,b,c){"home-abort"!==a.request&&b.resolve(d.default(c)),a.request=null}function k(a,b,c){a.request=null,b.resolve(new d(c))}function l(a,b,c,e){a.request=null,404===c.status?b.resolve(d.default()):"abort"!==e&&b.reject()}return g});
define('ui/elements/asset-context/view-model',['require','lodash','jquery','assets/asset-hierarchy-control','assets/asset-group-control','system/ui/dialog-box','system/globalization/translator','assets/models/selected-asset-results','knockout','text!./template.html','spa/region','application/application-context','assets/services/asset-context-dto','assets/services/hierarchy-dto','assets/services/asset-group-dto','assets/services/asset-context-service','ramda'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("assets/asset-hierarchy-control"),d=require("assets/asset-group-control"),e=require("system/ui/dialog-box"),f=require("system/globalization/translator"),g=require("assets/models/selected-asset-results"),h=require("knockout"),i=require("text!./template.html"),j=require("spa/region"),k=require("application/application-context"),l=require("assets/services/asset-context-dto"),m=require("assets/services/hierarchy-dto"),n=require("assets/services/asset-group-dto"),o=require("assets/services/asset-context-service"),p=require("ramda"),q=["selector","multiselect","allowAdd"],r={};r.prototype=Object.create(HTMLElement.prototype),r.prototype.createdCallback=function(){this.element=this,this.translator=Object.resolve(f),this.results=null,this.dialog=null,this.existing=[],this.activePill=null,this.internalvalue=null,this.showAsDialog=null,this.assetContextService=Object.resolve(o),this.group={
href:"#assets/group",title:this.translator.translate("ASSET_GROUP"),url:"group",screen:null},this.hierarchy={href:"#assets/hierarchy",title:this.translator.translate("ASSET_HIERARCHY"),url:"hierarchy",screen:null},Object.defineProperty(this,"value",{get:K.bind(null,this),set:this.setContext.bind(this)}),this.delayload=Element.booleanAttribute(this,"delayload")},r.prototype.setContext=function(c){var d=new b.Deferred,e;return c&&(e=c.entityKey||c)?this.internalvalue&&"-1"!==this.internalvalue.entityKey&&L(this.internalvalue.entityKey,e)?(a.defer(d.resolve,this.internalvalue),d.promise()):(s(this,c),z(this,c,d),d.promise()):(a.defer(d.resolve,this.internalvalue),d.promise())};function s(a,b){"string"==typeof b&&B(a,b)}r.prototype.attachedCallback=function(){Element.clearDom(this),"true"===this.getAttribute("data-open")?(this.load(),this.attach(new j(b(this)))):T(this)},r.prototype.disableStuff=function(a,b){if(a!==!1||b!==!1){var c=this.region.element.querySelector(".assetMenu")
;a===!0?(P(this),M(this),this.region.element.querySelector(".asset-hierarchy-control").style.display="none",c.removeChild(c.firtElementChild),this.activePill("hierarchy")):b===!0&&(R(this),N(this),this.region.element.querySelector(".asset-group-explorer").removeAttribute("data-bind"),c.removeChild(c.lastElementChild),this.activePill("group")),c.classList.add("not-active")}},r.prototype.detachedCallback=function(){this.region&&(this.detach(),this.unload())},r.prototype.attributeChangedCallback=function(a,b,c){this.delayload===!1&&("entitykey"===a?z(this,c):"loadassets"===a?(this.group.screen.settings.loadAssets="true"===c,this.group.screen.settings.hasChildren="true"===c,this.group.screen.detach(this.region),this.group.screen.attach(this.region)):"selectchildren"===a?this.hierarchy.screen.selectChildren(c):"multiselect"===a&&(this.hierarchy.screen.settings.multiSelect="true"===c),H(this,a,c))},r.prototype.menuClick=function a(b,c){var d,e,f;c.preventDefault(),
c.stopImmediatePropagation(),f=c.target.getAttribute("data-menu-item"),e="hierarchy"===f?this.hierarchy:this.group,d=new CustomEvent("menu-changing",{bubbles:!0,cancelable:!0,detail:{menu:e}}),this.dispatchEvent(d),d.returnValue===!1||d.defaultPrevented||("hierarchy"===f?this.showHierarchy():this.showGroup())},r.prototype.load=function(){var a,b,e,f;for(this.results=new g,this.results.init(),this.results.existing=this.existing,this.activePill=h.observable("hierarchy"),f=this.getAttribute("data-open"),this.showAsDialog=h.observable(!f),a=0;a<this.existing.length;a++)this.results.selected.push(this.existing[a]);b={multiSelect:!1,selectedItems:this.results.selected,selectable:!1,contentArea:".asset-hierarchy-control",enableAddAllChildren:null!==this.getAttribute("enableAddAllChildren"),selectChildren:null!==this.getAttribute("selectChildren")},e={multiSelect:!1,selectedItems:this.results.selected,selectable:!1,contentArea:".asset-group-explorer",
loadAssets:null!==this.getAttribute("loadassets"),enableAddAllChildren:null!==this.getAttribute("enableAddAllChildren"),allowAdd:null!==this.getAttribute("allow-add")},this.hierarchy.screen=c.create(b),this.hierarchy.screen.load(),this.group.screen=d.create(e)},r.prototype.attach=function(a){this.region=a,this.region.attach(b(i)),this.region.$element.find(".region").attr("data-bind","halt-bindings"),this.region.element.addEventListener("change",this),this.delayload===!1&&(h.applyBindingsToDescendants(this,this.region.element.querySelector(".region")),O(this),Q(this),I(this),Element.raiseEvent(this.group.screen.groupElement.querySelector("mi-tool-bar"),"resize",{}))},r.prototype.detach=function(){P(this),R(this),h.cleanNode(this.region.element),this.region.clear(),this.region=null},r.prototype.handleEvent=function(a){
"navigated"===a.type?this.group.screen&&a.target===this.group.screen.groupElement?w(this):u(this):"selected"===a.type&&"group"!==this.activePill()&&this.group.screen&&a.target!==this.group.screen.groupElement?u(this):"selected"===a.type&&"group"===this.activePill()?v(this):"loaded"===a.type?J(this,a):"click"===a.type?x(this):"change"===a.type&&a.target!==this&&a.stopImmediatePropagation()},r.prototype.unload=function a(){M(this),N(this)},r.prototype.translateText=function a(b){return this.translator.translate(b)},r.prototype.done=function a(){this.dialog||y(this)},r.prototype.showHierarchy=function a(){this.activePill(this.hierarchy.url),Element.raiseEvent(this,"menu-change",{menu:this.hierarchy})},r.prototype.showGroup=function a(){this.activePill(this.group.url),Element.raiseEvent(this,"menu-change",{menu:this.group}),Element.raiseEvent(this.group.screen.groupElement.querySelector("mi-tool-bar"),"resize",{})},r.prototype.setSiteFilter=function(a){
this.hierarchy.screen.setSiteFilter(a)},r.prototype.loadState=function(a){var c,d;return a=a||{},a.hierarchy=a.hierarchy||{},a.group=a.group||{},a.hierarchy.value=null,a.group.value=null,this.hierarchy.screen.loadState(a.hierarchy),this.group.screen.loadState(a.group),c=a.value,c?d=this.setContext(c):(d=b.Deferred(),d.resolve(),a.menu===this.group.url?(this.activePill(this.group.url),this.group.screen.groupElement.addEventListener("loaded",this),this.group.screen.groupElement.reload()):(this.activePill(this.hierarchy.url),this.value=t(this)?k.assetcontext:l.default())),d.promise()},r.prototype.saveState=function(){return{hierarchy:this.hierarchy.screen.saveState(),group:this.group.screen.saveState(),value:this.internalvalue,menu:this.activePill()}},r.prototype.href=function(){return this.activePill()===this.hierarchy.url?this.hierarchy.href+"/"+this.value.entityKey:this.group.href+"/"+this.value.entityKey};function t(a){if(p.isNil(a.parentElement))return!1
;if(p.isNil(a.parentElement.parentElement))return!1;if(p.isNil(a.parentElement.parentElement.parentElement))return!1;var b=a.parentElement.parentElement.parentElement;return b.classList.contains("assets-shell-screen")&&!b.classList.contains("asset-finder-screen")}function u(a){var c=a.hierarchy.screen.contextBrowser.selectedAsset;A(a,l.fromHierarchyDTO(c)),b(a.element).find("span.context-id").text(a.internalvalue.description)}function v(a){a.group.screen.groupElement.value&&(A(a,l.fromGroupDTO(a.group.screen.groupElement.value)),b(a.element).find("span.context-id").text(a.internalvalue.description))}function w(a){var c=a.group.screen.groupElement.value.length-1,d=a.group.screen.groupElement.value[c];A(a,l.fromGroupDTO(d)),b(a.element).find("span.context-id").text(a.internalvalue.description)}function x(a){var c={height:"90%",width:"auto",buttons:[{name:a.translator.translate("DONE"),value:"done",cssClass:"btn-primary"}]},d=a.translator.translate("ASSET_HIERARCHY")
;null!==a.getAttribute("dialog")?(a.dialog=new e(a,d,c),a.dialog.show(),a.loadState()):(a.region||a.attach(new j(b(a.querySelector(".asset-context-selection")))),b(a.element).find("div.asset-context-selection").show())}function y(a){b(a.element).find("div.asset-context-selection").removeAttr("style")}function z(a,b,c){var d;b instanceof l?setTimeout(F.bind(null,a,c,b),0):b instanceof m?(d=l.formHierarchyDTO(b),setTimeout(F.bind(null,a,c,d),0)):b instanceof n?(d=l.fromGroupDTO(b),setTimeout(F.bind(null,a,c,d),0)):b.entityKey?a.assetContextService.getcontext(b.entityKey).done(F.bind(null,a,c)).fail(c.reject.bind(c)):a.assetContextService.getcontext(b).done(F.bind(null,a,c)).fail(c.reject.bind(c))}function A(a,b){(!a.internalvalue&&a.internalvalue!==b||a.internalvalue.entityKey!==b.entityKey)&&(a.internalvalue=b,G(a))}function B(a,b){(!a.internalvalue&&a.internalvalue!==b||a.internalvalue.entityKey!==b.entityKey)&&(a.internalvalue=b)}function C(a){var b=a.value||[{}]
;return 0===b.length?"":b[b.length-1].entityKey||""}function D(a){var b=a.selectedAsset;return b?b.entityKey:""}function E(a,b){var c,d,e,f;(a.region||a.dialog)&&(c="Hierarchy"===b.type,f=a.hierarchy.screen.contextBrowser,c?(a.activePill(a.hierarchy.url),D(f)!==b.entityKey&&a.hierarchy.screen.loadcontext(b.entityKey)):(a.activePill(a.group.url),e=a.group.screen.groupElement,e.value&&e.value.entityKey===b.entityKey||a.group.screen.loadcontext(b)))}function F(a,c,d){null===d&&(d=k.assetcontext||l.default()),E(a,d),A(a,d),a.internalvalue&&b(a.element).find("span.context-id").text(a.internalvalue.description),c&&c.resolve(d)}function G(a){Element.raiseEvent(a,"change",a.internalvalue)}function H(a,b,c){var d,e,f,g,h;if(q.indexOf(b)>-1){for(h=a.querySelector("asset-hierarchy-control"),"selector"===b&&h&&(h.enableMultiSelect="addOnly"===c),d=a.getElementsByTagName("mi-list-group"),e=0;e<d.length;e++)null!==c?d[e].setAttribute(b,c):d[e].removeAttribute(b)
;for(f=a.querySelectorAll("mi-tool-bar mi-searchbox"),e=0;e<f.length;e++)null!==c?f[e].setAttribute(b,c):f[e].removeAttribute(b);for(g=a.getElementsByTagName("mi-tree"),e=0;e<g.length;e++)"groupid"===g[e].getAttribute("description")&&"selector"===b&&(c="none"),null!==c?g[e].setAttribute(b,c):g[e].removeAttribute(b)}}function I(a){var b;for(b=0;b<q.length;b++)H(a,q[b],a.getAttribute(q[b]))}function J(a,b){if(null!==b.detail.frag.querySelector("mi-li")){var c=b.detail.frag.querySelector("mi-li").value;a.value=c,a.group.screen&&a.group.screen.groupElement.removeEventListener("loaded",a)}}function K(a){return a.internalvalue}function L(a,b){return a="0"===a?"-1":a,b="0"===b?"-1":b,a===b}function M(a){a.hierarchy.screen&&(a.hierarchy.screen.unload(),a.hierarchy.screen=null)}function N(a){a.group.screen&&(a.group.screen.unload(),a.group.screen=null)}function O(a){a.hierarchy.screen.attach(a.region,!0),a.hierarchy.screen.contextBrowser.addEventListener("selected",a)}function P(a){
a.hierarchy.screen&&(a.hierarchy.screen.contextBrowser.removeEventListener("selected",a),a.hierarchy.screen.detach(a.region))}function Q(a){var b;a.group.screen.attach(a.region),b=null!==a.getAttribute("loadassets"),b?a.group.screen.groupElement.addEventListener("navigated",a):a.group.screen.groupElement.addEventListener("selected",a)}function R(a){a.group.screen&&(a.group.screen.groupElement.removeEventListener("navigated",a),a.group.screen.groupElement.removeEventListener("selected",a),a.group.screen.detach(a.region))}function S(a){var c=k.assetcontext||l.default();F(a,b.Deferred(),c)}function T(a){var b,c,d,e,f;f=document.createElement("div"),f.className="region",b=document.createElement("div"),f.appendChild(b),c=document.createElement("button"),c.className="btn btn-default",b.appendChild(c),e=document.createElement("span"),e.className="context-id",c.appendChild(e),c.addEventListener("click",a),d=document.createElement("i"),d.className="ds ds-assethierachy ds-dashboard-style",
c.appendChild(d),a.appendChild(f),b=document.createElement("div"),b.className="asset-context-selection",a.appendChild(b),S(a)}return document.registerElement("mi-asset-context",{prototype:r.prototype}),r});
define('query/execution/query-prompt-view-model',['require','lodash','jquery','knockout','application/application-events','application/application-context','system/knockout/knockout-manager','spa/ko/knockout-view-model','system/error/error-message','system/globalization/translator','../services/query-service','../services/dto/parameter-container-dto','../adapters/parameter-design-adapter','../adapters/parameter-value-adapter','text!./views/query-prompt.html','assets/services/asset-context-dto','system/lang/converter','moment','system/lang/object','ui/elements/select/view-model','ui/elements/multi-value/view-model','ui/elements/asset-context/view-model','ui/elements/date-time/bootstrap-datetimepicker','ui/elements/date-time/element'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("application/application-events"),e=require("application/application-context"),f=require("system/knockout/knockout-manager"),g=require("spa/ko/knockout-view-model"),h=require("system/error/error-message"),i=require("system/globalization/translator"),j=require("../services/query-service"),k=require("../services/dto/parameter-container-dto"),l=require("../adapters/parameter-design-adapter"),m=require("../adapters/parameter-value-adapter"),n=require("text!./views/query-prompt.html"),o=require("assets/services/asset-context-dto"),p=require("system/lang/converter"),q=require("moment");require("system/lang/object"),require("ui/elements/select/view-model"),require("ui/elements/multi-value/view-model"),require("ui/elements/asset-context/view-model"),require("ui/elements/date-time/bootstrap-datetimepicker"),require("ui/elements/date-time/element");function r(a,b){s.call(this,n),
this.kom=a,this.applicationEvents=b,this.translator=Object.resolve(i),this.queryService=Object.resolve(j),this.queryContainer=null,this.hasParamDependency=null,this.prompts=null,this.isLoading=!0,this.assetFinder=null,this.format=e.user.formats.dateTime,this.dateFormat=e.user.formats.shortDate}var s=Object.inherit(g,r);r.dependsOn=[f,d],r.prototype.open=function a(b){},r.prototype.load=function a(c){var d=new b.Deferred,e;return this.queryContainer=c.queryContainer,e=this.queryContainer.parmContainer,this.hasParamDependency=this.kom.observable(e.hasDependencies),this.prompts=this.kom.observableArray(t(this,e.parmDesigns)),d.promise()},r.prototype.activate=function a(){},r.prototype.attach=function a(b){s.prototype.attach.call(this,b),this.region=b,this.isLoading=!1},r.prototype.detach=function a(b){s.prototype.detach.call(this,b)},r.prototype.deactivate=function a(b){this.kom.disposeSubscriptions(),this.kom.disposeComputeds()},r.prototype.unload=function a(){
this.kom.disposeObservables()},r.prototype.validatePrompt=function a(b){return!b.value()||(b.isMultiValue?!b.options||!b.options.length||b.values().length>0:"Numeric"!==b.paramDesign.dataType()||b.isAssetHierarchy?"Date"!==b.paramDesign.dataType()||(G(this,b.value())?(this.clearPromptValidationMessage(b),!0):(b.validationMessage(this.translate("QUERY_INVALID_DATE")),!1)):F(this,b.value().replace(",",""))?(this.clearPromptValidationMessage(b),!0):(b.validationMessage(this.translate("QUERY_INVALID_NUMBER")),!1))},r.prototype.validate=function a(){var b=0;for(b=0;b<this.prompts().length;b++){var c=this.prompts()[b];if(!this.validatePrompt(c))return!1}return!0},r.prototype.clearPromptValidationMessage=function a(b){b.validationMessage(null)},r.prototype.getParameterValues=function b(){var c;return c=a.map(this.prompts(),H.bind(null,this)),new k({hasDependencies:this.hasParamDependency(),parmDesigns:l.toDTOArray(c)})},r.prototype.multiSelectValueChanged=function a(){
this.hasParamDependency()&&D(this,null)},r.prototype.translate=function(a){return this.translator.translate(a)};function t(b,c){var d,e;return d=l.toModelObjectArray(c),b.kom.disposeSubscriptions(),e=a.map(d,u.bind(null,b))}function u(b,c,d){var e,f=a.map(c.list(),B.bind(null,b,c)),g=f;return f&&f.length>0||(f=c.parameterValues(),g=m.toDTOArray(c.parameterValues())),"Boolean"===c.dataType()&&(f=[{displayValue:"All",value:"A"},{displayValue:"True",value:"Y"},{displayValue:"False",value:"N"}],g=f),e={caption:c.localizedCaption()||c.caption()||c.id()||b.translate("QUERY_EXEC_PROMPT_ENTER_VAL"),options:f,cboOptions:g||[],values:b.kom.observableArray(w(b,c,f)),value:b.kom.observable(v(b,c,f)),isExclusive:c.isExclusive()||"Boolean"===c.dataType(),isMultiValue:c.isMultiValue(),paramDesign:c,isAssetHierarchy:c.isAssetHierarchy(),child:c.child(),parent:c.parent(),valueTemplate:A(c),all:c.all(),current:c.current(),validationMessage:b.kom.observable(),isGis:c.isGis(),isHidden:c.isHidden(),
format:c.format(),alias:c.alias(),distance:c.distance(),entyKey:c.entyKey(),justTheDate:c.justTheDate()},b.hasParamDependency()&&(e.isExclusive||e.options.length||e.value.extend({rateLimit:{timeout:1200,method:"notifyWhenChangesStop"}}),e.isMultiValue||d+1<b.queryContainer.parmContainer.parmDesigns.length&&b.kom.subscribe(e.value,D.bind(null,b,d))),e}function v(b,d,f){var g,h=d.parameterPrompts();if(h&&h.length)return z(b,d,h[0]);if(null!==d.defaultValue()){if("Date"===d.dataType()){var i=a.find(b.queryContainer.parmContainer.parmDesigns,function(a,b){return a.caption===d.caption()});if(i&&i.parmValues.length)return C(b,d,d.defaultValue())}return z(b,d,d.defaultValue())}return f&&f.length?z(b,d,c.unwrap(f[0].value)):d.isAssetHierarchy()?(g=e.assetcontext||new o,g.entityKey&&"0"!==g.entityKey&&0!==g.entityKey||(g.entityKey="-1"),g):"Date"===d.dataType()?new Date:void 0}function w(a,b,c){var d=0,e=b.parameterPrompts(),f;if(b.isMultiValue()){if(e&&e.length){
for(d=0;d<e.length;d++)if(f=e[d],c&&c.length&&!x(c,f))return b.parameterPrompts.removeAll(),b.parameterPrompts();return b.parameterPrompts()}return b.defaultValues()}}function x(b,c){return a.find(b,y.bind(null,c))}function y(a,b){return c.utils.unwrapObservable(b.value)===a}function z(a,b,c){return"Date"===b.dataType()?p.toDate(c,"yyyy-MM-ddTHH:mm:ss.fff"):c}function A(a){switch(a.dataType()){case"Date":return a.justTheDate()?"prompt-date-template":"prompt-datetime-template";case"Numeric":return"prompt-number-template";default:return"prompt-text-template"}}function B(a,b,c){return{value:z(a,b,c),displayValue:C(a,b,c)}}function C(a,b,c){var d,e=c;return"Date"===b.dataType()&&(d=z(a,b,c),e=p.toDateString(d,a.format)),e}function D(b,c){var d=b.queryContainer,e;b.isLoading||(e=a.map(b.prompts(),H.bind(null,b)),d.parmContainer.parmDesigns=l.toDTOArray(e),b.queryService.compileContainerParameters(d).done(E.bind(null,b,c)).fail(J.bind(null,b)))}function E(a,b,c){var d,e;a.isLoading=!0,
e=t(a,c.parmContainer.parmDesigns),null!==b&&(d=e[b],!d.value()||d.isExclusive||x(d.cboOptions,d.value())||d.cboOptions.push({displayValue:d.value(),value:d.value()})),a.prompts(e),a.isLoading=!1}function F(a,c){return!!b.isNumeric(c)}function G(a,b){return q(p.toDate(b,a.format,b)).isValid()}function H(a,b){var c;return b.isMultiValue?b.options&&b.options.length?b.paramDesign.parameterPrompts(b.values()):b.paramDesign.parameterPrompts(I(b.value())):b.value()instanceof o?(b.paramDesign.parameterPrompts([b.value().entityKey]),b.paramDesign.assetHierarchyCaption=b.value().description):b.value()instanceof Date?b.paramDesign.parameterPrompts([p.toDateString(b.value(),"yyyy-MM-ddTHH:mm:ss.fff")]):"Date"===b.paramDesign.dataType()&&b.value()?(c=p.toDate(b.value(),"yyyy-MM-ddTHH:mm:ss.fff",b.value()),b.paramDesign.parameterPrompts([p.toDateString(c,"yyyy-MM-ddTHH:mm:ss.fff")])):b.value()?b.paramDesign.parameterPrompts([b.value().toString()]):b.paramDesign.parameterPrompts([null]),
b.paramDesign}function I(a){var b;if(!a)return[];b=a.split(",");for(var c=0;c<b.length;c++)b[c].trim();return b}function J(a,b){var c=2,d=h.fromHttpResponse(c,b);a.applicationEvents.errorOccured.raise(a,d)}return r});

define('text!query/execution/views/query-prompt-dialog.html',[],function () { return '<div class="query-prompt-dialog block-group">\r\n    <div class="query-prompt-container">\r\n        &nbsp;\r\n    </div>\r\n    <div class="controls">\r\n        <button type="button"\r\n                class="btn  btn-text  btn-secondary"\r\n                data-bind="click: cancel,\r\n                           text: translate(\'CANCEL\')"></button>\r\n        <button type="button"\r\n                class="btn btn-text"\r\n                data-bind="click: done,\r\n                           enable: isDoneButtonEnabled,\r\n                           text: translate(\'DONE\').capitalize()"></button>        \r\n    </div>\r\n</div>';});

define('query/execution/query-prompt-dialog',['require','jquery','spa/ko/knockout-view-model','application/application-events','system/error/error-message','system/knockout/knockout-manager','spa/region','system/ui/dialog-view-model','./query-prompt-view-model','system/globalization/translator','text!./views/query-prompt-dialog.html','system/lang/string','system/lang/object'],function(require){"use strict";var a=require("jquery"),b=require("spa/ko/knockout-view-model"),c=require("application/application-events"),d=require("system/error/error-message"),e=require("system/knockout/knockout-manager"),f=require("spa/region"),g=require("system/ui/dialog-view-model"),h=require("./query-prompt-view-model"),i=require("system/globalization/translator"),j=require("text!./views/query-prompt-dialog.html");require("system/lang/string"),require("system/lang/object");function k(a,b,c,d){l.call(this,j),this.kom=a,this.applicationEvents=b,this.queryPromptRegion=c,this.queryPromptViewModel=d,this.translator=Object.resolve(i),this.dialog=null,this.dfd=null,this.isDoneButtonEnabled=null,this.queryContainer=null}var l=Object.inherit(b,k);k.dependsOn=[e,c,f,h],k.prototype.show=function b(c){var d={height:"70%",width:"30%"};return c=c||{},c.title=c.title||this.translate("QUERY_EXEC_PROMPT_DLG_TITLE"),this.queryContainer=c.queryContainer,this.dialog=new g(this,c.title,d),
this.dialog.show(),this.dfd=a.Deferred(),this.dfd.promise()},k.prototype.close=function a(){this.dialog=null},k.prototype.open=function a(){},k.prototype.load=function b(c){var d=new a.Deferred;return c=c||{},c.queryContainer=this.queryContainer,this.queryPromptViewModel.load(c),d.promise()},k.prototype.activate=function a(){this.queryPromptViewModel.activate(),this.isDoneButtonEnabled=this.kom.computed(m.bind(null,this))},k.prototype.attach=function a(b){l.prototype.attach.call(this,b),this.region=b,this.queryPromptRegion.setElement(this.region.$element.find("div.query-prompt-container")),this.queryPromptViewModel.attach(this.queryPromptRegion)},k.prototype.detach=function a(b){this.queryPromptViewModel.detach(this.queryPromptRegion),this.queryPromptRegion.clear(),l.prototype.detach.call(this,b)},k.prototype.canUnload=function a(){return this.queryPromptViewModel.canUnload()},k.prototype.deactivate=function a(){this.queryPromptViewModel.deactivate(this.queryPromptRegion),
this.kom.disposeSubscriptions(),this.kom.disposeComputeds()},k.prototype.unload=function a(){this.queryPromptViewModel.unload(),this.kom.disposeObservables()},k.prototype.translate=function(a){return this.translator.translate(a)},k.prototype.done=function a(){var b;this.queryPromptViewModel.validate()&&(b=this.queryPromptViewModel.getParameterValues(),this.dfd.resolve(b),this.dialog.closeDialog())},k.prototype.cancel=function a(){this.dfd.reject(),this.dialog.closeDialog()};function m(a){return a.queryPromptViewModel.validate()}function n(a,b){b&&a.dfd.resolve(b),a.dialog.closeDialog()}function o(a,b){var c=2,e=d.fromHttpResponse(c,b);a.applicationEvents.errorOccured.raise(a,e)}return k});
define('system/lang/unique-id',['require','uuid'],function(require){"use strict";var a=require("uuid");function b(){return a.v1()}function c(){return a.v4()}return{createV1:b,createV4:c}});
define('query/model/column-model',['require','knockout'],function(require){"use strict";var a=require("knockout");function b(b){b=b||{},this.id=a.observable(b.id),this.caption=a.observable(b.caption),this.defaultCaption=a.observable(b.defaultCaption),this.dataType=a.observable(b.dataType),this.isInactive=a.observable(b.isInactive),this.captionDisplay=a.computed(c.bind(null,this)),this.idUndecorated=a.computed(d.bind(null,this))}function c(a){var b=a.caption();if(b)return 0===b.indexOf("[")?b.substring(1,b.length-1):b}function d(a){var b=a.id();if(b)return 0===b.indexOf("[")?b.substring(1,b.length-1):b}return b});
define('query/adapters/column-adapter',['require','../services/dto/column-dto','../model/column-model'],function(require){"use strict";var a=require("../services/dto/column-dto"),b=require("../model/column-model");function c(){}return c.toModelObject=function a(c){return new b(c)},c.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},c.toDTO=function c(d){var e=new a;return d=d||new b,e.id=d.id(),e.caption=d.caption(),e.defaultCaption=d.defaultCaption(),e.dataType=d.dataType(),e.isInactive=d.isInactive(),e},c.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},c});
define('query/model/table-design-model',['require','knockout','../adapters/column-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/column-adapter");function c(c){var h=[];c=c||{},c.showAllFields||c.showAllFields===!1||(c.showAllFields=!0),c.showDataFields||c.showDataFields===!1||(c.showDataFields=!1),c.showInactiveFields||c.showInactiveFields===!1||(c.showInactiveFields=!1),c.showSystemFields||c.showSystemFields===!1||(c.showSystemFields=!1),this.alias=a.observable(c.alias),this.caption=a.observable(c.caption),this.defaultCaption=a.observable(c.defaultCaption),this.datasheetId=a.observable(c.datasheetId),this.id=a.observable(c.id),this.key=a.observable(c.key),this.layoutX=a.observable(c.layoutX),this.layoutY=a.observable(c.layoutY),this.name=a.observable(c.name),h=b.toModelObjectArray(c.queryColumns),this.queryColumns=a.observableArray(h&&h.length?h:[]),this.showAllFields=a.observable(c.showAllFields),this.showDataFields=a.observable(c.showDataFields),this.showInactiveFields=a.observable(c.showInactiveFields),
this.showSystemFields=a.observable(c.showSystemFields),this.storedQueryPath=a.observable(c.storedQueryPath),this.tableType=a.observable(c.tableType),this.captionDisplay=a.computed(d.bind(null,this)),this.idUndecorated=a.computed(e.bind(null,this)),this.aliasDisplay=a.computed({read:f.bind(null,this),write:g.bind(null,this)})}function d(a){var b=a.caption();if(b)return 0===b.indexOf("[")||0===b.indexOf("{")?b.substring(1,b.length-1):b}function e(a){var b=a.id();if(b)return 0===b.indexOf("[")||0===b.indexOf("{")?b.substring(1,b.length-1):b}function f(a){return a.alias()||a.captionDisplay()}function g(a,b){b=b.replace(/ /g,"_").replace(/\(/g,"").replace(/\)/g,"").replace(/-/g,"_"),a.alias(b)}return c});
define('query/adapters/table-design-adapter',['require','../services/dto/table-design-dto','../model/table-design-model','./column-adapter'],function(require){"use strict";var a=require("../services/dto/table-design-dto"),b=require("../model/table-design-model"),c=require("./column-adapter");function d(){}return d.toModelObject=function a(c){return new b(c)},d.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},d.toDTO=function d(e){var f=new a;return e=e||new b,f.alias=e.alias()||null,f.caption=e.caption()||null,f.defaultCaption=e.defaultCaption()||null,f.datasheetId=e.datasheetId(),f.id=e.id(),f.key=e.key(),f.layoutX=e.layoutX(),f.layoutY=e.layoutY(),f.name=e.name(),f.queryColumns=c.toDTOArray(e.queryColumns()),f.showAllFields=e.showAllFields(),f.showDataFields=e.showDataFields(),f.showInactiveFields=e.showInactiveFields(),f.showSystemFields=e.showSystemFields(),f.storedQueryPath=e.storedQueryPath(),f.tableType=e.tableType(),f},d.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]))
;return d}},d});
define('query/services/dto/expression-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.conditionOperator=a.toString(b.conditionOperator),this.operator=a.toString(b.operator),this.value=b.dateValue?a.toDate(b.dateValue):a.toString(b.value),this.dateValue=a.toDate(b.dateValue)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});

define('text!query/expression-simple-operators.json',[],function () { return '{\r\n    "Character": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_NOT_EQUALS", "value": "NotEqual", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_CONTAINS", "value": "Contains", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_NOT_CONTAINS", "value": "DoesNotContain", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_STARTS_WITH", "value": "StartsWith", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_ENDS_WITH", "value": "EndsWith", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NULL", "value": "IsNull", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_NULL", "value": "IsNotNull", "valueNeeded": false }\r\n    ],\r\n\r\n    "Character-dh": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true }\r\n    ],\r\n\r\n    "Numeric": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_ATMOST", "value": "EqualOrLessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_ATLEAST", "value": "EqualOrGreaterThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_NOT_EQUALS", "value": "NotEqual", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_LESS_THAN", "value": "LessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_GREATER_THAN", "value": "GreaterThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NULL", "value": "IsNull", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_NULL", "value": "IsNotNull", "valueNeeded": false }\r\n    ],\r\n\r\n    "Numeric-dh": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_ATMOST", "value": "EqualOrLessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_ATLEAST", "value": "EqualOrGreaterThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_LESS_THAN", "value": "LessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_GREATER_THAN", "value": "GreaterThan", "valueNeeded": true }\r\n    ],\r\n\r\n    "Date": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_ON", "value": "DayOf", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_AT", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_AT_OR_BEFORE", "value": "EqualOrLessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_AT_OR_AFTER", "value": "EqualOrGreaterThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_AT", "value": "NotEqual", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_BEFORE", "value": "LessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_AFTER", "value": "GreaterThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NULL", "value": "IsNull", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_NULL", "value": "IsNotNull", "valueNeeded": false }\r\n    ],\r\n\r\n    "Date-dh": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_AT", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_AT_OR_BEFORE", "value": "EqualOrLessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_AT_OR_AFTER", "value": "EqualOrGreaterThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_BEFORE", "value": "LessThan", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_AFTER", "value": "GreaterThan", "valueNeeded": true }\r\n    ],\r\n\r\n    "Boolean": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_TRUE", "value": "True", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_FALSE", "value": "False", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NULL", "value": "IsNull", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_NULL", "value": "IsNotNull", "valueNeeded": false }\r\n    ],\r\n\r\n    "Boolean-dh": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_TRUE", "value": "True", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_FALSE", "value": "False", "valueNeeded": false }\r\n    ],\r\n\r\n    "Text": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_NOT_EQUALS", "value": "NotEqual", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_CONTAINS", "value": "Contains", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_NOT_CONTAINS", "value": "DoesNotContain", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_STARTS_WITH", "value": "StartsWith", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_ENDS_WITH", "value": "EndsWith", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NULL", "value": "IsNull", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_NULL", "value": "IsNotNull", "valueNeeded": false }\r\n    ],\r\n\r\n    "Text-dh": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true }\r\n    ],\r\n\r\n    "Unknown": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_NOT_EQUALS", "value": "NotEqual", "valueNeeded": true },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NULL", "value": "IsNull", "valueNeeded": false },\r\n        { "text": "EXPR_SIMPLE_OPERATOR_IS_NOT_NULL", "value": "IsNotNull", "valueNeeded": false }\r\n    ],\r\n\r\n    "Unknown-dh": [\r\n        { "text": "EXPR_SIMPLE_OPERATOR_EQUALS", "value": "Equal", "valueNeeded": true }\r\n    ]\r\n}\r\n';});

define('query/model/expression-simple-operator-model',['require','system/globalization/translator'],function(require){"use strict";var a=require("system/globalization/translator");function b(b){b=b||{};var c=Object.resolve(a);this.text=c.translate(b.text),this.value=b.value,this.valueNeeded=b.valueNeeded!==!1,this.dataType=b.dataType}return b});
define('query/model/expression-simple-operator-list',['require','ramda','text!../expression-simple-operators.json','./expression-simple-operator-model'],function(require){"use strict";var a=require("ramda"),b=require("text!../expression-simple-operators.json"),c=require("./expression-simple-operator-model");function d(a){a&&a.length?this.items=a.map(e):this.items=[]}function e(a){return new c(a)}d.loadOperatorsForDataType=function a(c){return c=c||"Unknown",f(c,JSON.parse(b)[c])};function f(b,c){var e=g(b);return new d(a.map(e,c))}var g=a.curry(function a(b,c){return c.dataType=b,c});return d});
define('query/adapters/expression-simple-operator-adapter',['require','ramda','../model/expression-simple-operator-list'],function(require){"use strict";var a=require("ramda"),b=require("../model/expression-simple-operator-list");function c(){}var d=a.propEq("value");return c.toModelObject=function c(e,f){var g=b.loadOperatorsForDataType(f);return a.find(d(e),g.items)},c.toModelObjectArray=function a(b,d){return b.map(function(a,b){return c.toModelObject(a,b)})},c});
define('query/model/expression-model',['require','knockout','../adapters/expression-simple-operator-adapter','system/lang/converter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/expression-simple-operator-adapter"),c=require("system/lang/converter");function d(b,d){b=b||{},this.conditionOperator=a.observable(b.conditionOperator),this.value=a.observable(b.value),this.dataType=a.observable(d),"Date"===d&&this.value(c.toDate(b.dateValue)),this.operator=a.observable(e(b,d)),this.valueNeeded=a.computed(f.bind(null,this)),this.operator.subscribe(g.bind(null,this)),this.template=a.computed(h.bind(null,this))}function e(a,c){return a.operator?b.toModelObject(a.operator,c):null}function f(a){return!a.operator()||a.operator().valueNeeded}function g(a,b){a.valueNeeded()?"Date"!==b.dataType||a.value()||a.value(new Date):a.value(null)}function h(a){switch(a.dataType()){case"Date":return a.operator()&&"DayOf"===a.operator().value?"exp-bld-simple-date-template":"exp-bld-simple-datetime-template";case"Boolean":return"exp-bld-simple-boolean-template";default:
return"exp-bld-simple-text-template"}}return d.prototype.toString=function a(){return this.operator()?(this.conditionOperator()?this.conditionOperator()+" ":"")+this.operator().value+(this.value()?" '"+this.value()+"'":""):""},d});
define('query/adapters/expression-adapter',['require','../services/dto/expression-dto','../model/expression-model','system/lang/converter'],function(require){"use strict";var a=require("../services/dto/expression-dto"),b=require("../model/expression-model"),c=require("system/lang/converter");function d(){}return d.toModelObject=function a(c,d){return new b(c,d)},d.toModelObjectArray=function a(b,c){var e=0,f=[];if(b&&b.length){for(e=0;e!==b.length;e++)f.push(d.toModelObject(b[e],c));return f}},d.toDTO=function b(d){var e=new a;return d=d||{},e.conditionOperator=d.conditionOperator()||"",e.operator=d.operator()?d.operator().value||"":"",e.value=d.value(),d.value()&&d.value()instanceof Date&&(e.dateValue=c.toDateString(d.value(),"yyyy-MM-ddTHH:mm:ss.fff")),e},d.toDTOArray=function a(b){var c=0,e=[];if(b&&b.length){for(c=0;c!==b.length;c++)e.push(d.toDTO(b[c]));return e}},d});
define('query/model/query-criteria-model',['require','knockout','../adapters/expression-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/expression-adapter");function c(c,d){c=c||{},this.expressions=a.observableArray(b.toModelObjectArray(c.expressions,d))}return c.prototype.toString=function a(){var b=0,c="",d="";for(b=0;b<this.expressions().length;b++)d=this.expressions()[b].toString(),c+=d.length>0?d+" ":"";return c},c});
define('query/adapters/query-criteria-adapter',['require','../services/dto/query-criteria-dto','../model/query-criteria-model','./expression-adapter'],function(require){"use strict";var a=require("../services/dto/query-criteria-dto"),b=require("../model/query-criteria-model"),c=require("./expression-adapter");function d(){}return d.toModelObject=function a(c,d){return c?new b(c,d):null},d.toModelObjectArray=function a(b,c){var e=0,f=[];if(!b||!b.length)return f;for(e=0;e!==b.length;e++)f.push(d.toModelObject(b[e],c));return f},d.toDTO=function b(d){if(!d)return null;var e=new a;return d=d||{},e.expressions=c.toDTOArray(d.expressions()),e},d.toDTOArray=function a(b){var c=0,d=[];if(!b||!b.length)return d;for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d},d});
define('query/model/column-design-model',['require','knockout','../adapters/column-adapter','../adapters/query-criteria-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/column-adapter"),c=require("../adapters/query-criteria-adapter");function d(d){d=d||{},this.alias=a.observable(d.alias),this.caption=a.observable(d.caption),this.defaultCaption=a.observable(d.defaultCaption),this.criterias=a.observableArray(d.criterias),this.crosstab=a.observable(d.crosstab),this.dataType=a.observable(d.dataType),this.display=a.observable(d.display),this.expressionText=a.observable(d.expressionText),this.hyperlink=a.observable(d.hyperlink),this.id=a.observable(d.id),this.include=a.observable(d.include),this.key=a.observable(d.key),this.layoutWidth=a.observable(d.layoutWidth),this.resultFilterExpression=a.observable(d.resultFilterExpression),this.sortIndex=a.observable(d.sortIndex),this.sortOrder=a.observable(d.sortOrder),this.tableDesignKey=a.observable(d.tableDesignKey),this.total=a.observable(d.total),this.appendTo=a.observable(b.toModelObject(d.appendTo)),
this.updateTo=a.observable(d.updateTo),this.simpleCriteria=a.observableArray([]),this.simpleCriteria(c.toModelObjectArray(d.simpleCriteria,this.dataType())),this.captionDisplay=a.computed(e.bind(null,this)),this.idUndecorated=a.computed(f.bind(null,this)),this.isSelected=a.observable(!1),this.include.subscribe(g.bind(null,this)),this.display.subscribe(h.bind(null,this)),this.expressionText.subscribe(i.bind(null,this))}function e(a){var b=a.caption();if(b)return 0===b.indexOf("[")?b.substring(1,b.length-1):b}function f(a){var b=a.id();if(b)return 0===b.indexOf("[")?b.substring(1,b.length-1):b}function g(a){a&&a.include&&null!==a.include()&&void 0!==a.include()&&(a.include()||a.display(!1))}function h(a){a&&a.display&&null!==a.display()&&void 0!==a.display()&&a.display()&&a.include(!0)}function i(a){a&&a.expressionText&&a.expressionText()&&a.tableDesignKey("")}return d});
define('query/adapters/column-design-adapter',['require','../services/dto/column-design-dto','../model/column-design-model','../adapters/column-adapter','./query-criteria-adapter'],function(require){"use strict";var a=require("../services/dto/column-design-dto"),b=require("../model/column-design-model"),c=require("../adapters/column-adapter"),d=require("./query-criteria-adapter");function e(){}return e.toModelObject=function a(c){return new b(c)},e.toModelObjectArray=function a(b){var c=0,d=[];if(!b||!b.length)return d;for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d},e.toDTO=function b(e){var f=new a;return e=e||{},f.alias=e.alias()||null,f.caption=e.caption()||null,f.defaultCaption=e.defaultCaption()||null,f.criterias=e.criterias(),f.crosstab=e.crosstab(),f.dataType=e.dataType(),f.display=e.display(),f.expressionText=e.expressionText(),f.hyperlink=e.hyperlink(),f.id=e.id()||null,f.include=e.include(),f.key=e.key(),f.layoutWidth=e.layoutWidth(),f.resultFilterExpression=e.resultFilterExpression(),f.sortIndex=e.sortIndex(),f.sortOrder=e.sortOrder(),f.tableDesignKey=e.tableDesignKey(),f.total=e.total(),f.appendTo=c.toDTO(e.appendTo()),
f.updateTo=e.updateTo(),f.simpleCriteria=d.toDTOArray(e.simpleCriteria()),f},e.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},e});
define('query/model/operand-model',['require','knockout'],function(require){"use strict";var a=require("knockout");function b(b){b=b||{},this.tableDesignKey=a.observable(b.tableDesignKey),this.columnId=a.observable(b.columnId),this.charOperand=a.observable(b.charOperand)}return b});
define('query/adapters/operand-adapter',['require','../services/dto/operand-dto','../model/operand-model'],function(require){"use strict";var a=require("../services/dto/operand-dto"),b=require("../model/operand-model");function c(){}return c.toModelObject=function a(c){return new b(c)},c.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},c.toDTO=function b(c){var d=new a;return c=c||{},d.tableDesignKey=c.tableDesignKey(),d.columnId=c.columnId(),d.charOperand=c.charOperand(),d},c.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},c});
define('query/model/condition-model',['require','knockout','../adapters/operand-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/operand-adapter");function c(c){c=c||{},this.leftOperand=a.observable(b.toModelObject(c.leftOperand)),this.operator=a.observable(c.operator),this.rightOperand=a.observable(b.toModelObject(c.rightOperand)),this.nextOperator=a.observable(c.nextOperator)}return c});
define('query/adapters/condition-adapter',['require','../services/dto/condition-dto','../model/condition-model','../adapters/operand-adapter'],function(require){"use strict";var a=require("../services/dto/condition-dto"),b=require("../model/condition-model"),c=require("../adapters/operand-adapter");function d(){}return d.toModelObject=function a(c){return new b(c)},d.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},d.toDTO=function b(d){var e=new a;return d=d||{},e.leftOperand=c.toDTO(d.leftOperand()),e.operator=d.operator(),e.rightOperand=c.toDTO(d.rightOperand()),e.nextOperator=d.nextOperator(),e},d.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},d});
define('query/model/join-design-model',['require','knockout','system/globalization/translator','../adapters/condition-adapter'],function(require){"use strict";var a=require("knockout"),b=require("system/globalization/translator"),c=require("../adapters/condition-adapter");function d(d){d=d||{},this.translator=Object.resolve(b),this.conditions=a.observableArray(c.toModelObjectArray(d.conditions)),this.isMiJoin=a.observable(d.isMiJoin),this.joinSucc=a.observable(d.joinSucc),this.joinType=a.observable(d.joinType),this.key=a.observable(d.key),this.leftDesignKey=a.observable(d.leftDesignKey),this.relDesignKey=a.observable(d.relDesignKey),this.rightDesignKey=a.observable(d.rightDesignKey),this.joinDesignKey=a.observable(d.joinDesignKey),this.jointLinkIds=[],this.leftDesignName=a.observable(this.leftDesignKey()),this.rightDesignName=a.observable(this.rightDesignKey()),this.relDesignName=a.observable(this.relDesignKey()),this.predDesignKey=a.computed(e.bind(null,this)),this.succDesignKey=a.computed(f.bind(null,this)),this.predDesignName=a.computed(g.bind(null,this)),
this.succDesignName=a.computed(h.bind(null,this)),this.innerDescription=a.computed(k.bind(null,this)),this.leftDescription=a.computed(l.bind(null,this)),this.rightDescription=a.computed(m.bind(null,this)),this.predColumnId=a.computed(i.bind(null,this)),this.succColumnId=a.computed(j.bind(null,this))}function e(a){return a.joinSucc()?a.leftDesignKey():a.rightDesignKey()}function f(a){return a.joinSucc()?a.rightDesignKey():a.leftDesignKey()}function g(a){return a.joinSucc()?a.leftDesignName():a.rightDesignName()}function h(a){return a.joinSucc()?a.rightDesignName():a.leftDesignName()}function i(a){if(a.conditions&&a.conditions()[0]&&a.conditions()[0].leftOperand&&a.conditions()[0].leftOperand()&&a.conditions()[0].leftOperand().columnId)return a.joinSucc()?a.conditions()[0].leftOperand().columnId():a.conditions()[0].rightOperand().columnId()}function j(a){
if(a.conditions&&a.conditions()[0]&&a.conditions()[0].rightOperand&&a.conditions()[0].rightOperand()&&a.conditions()[0].rightOperand().columnId)return a.joinSucc()?a.conditions()[0].rightOperand().columnId():a.conditions()[0].leftOperand().columnId()}function k(a){return a.isMiJoin()?n(a,"QUERY_EDITOR_INNER_MI_JOIN_DESC_PREFIX")+" '"+a.relDesignName()+"'":n(a,"QUERY_EDITOR_INNER_JOIN_DESC")}function l(a){return a.isMiJoin()?n(a,"QUERY_EDITOR_JOIN_INC_PRED_DESC_PREFIX")+" '"+a.leftDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_SUCC_DESC_PREFIX")+" '"+a.rightDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_MI_REL_DESC_PREFIX")+" '"+a.relDesignName()+"'":n(a,"QUERY_EDITOR_JOIN_INC_PRED_DESC_PREFIX")+" '"+a.leftDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_SUCC_DESC_PREFIX")+" '"+a.rightDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_REL_DESC")}function m(a){
return a.isMiJoin()?n(a,"QUERY_EDITOR_JOIN_INC_PRED_DESC_PREFIX")+" '"+a.rightDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_SUCC_DESC_PREFIX")+" '"+a.leftDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_MI_REL_DESC_PREFIX")+" '"+a.relDesignName()+"'":n(a,"QUERY_EDITOR_JOIN_INC_PRED_DESC_PREFIX")+" '"+a.rightDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_SUCC_DESC_PREFIX")+" '"+a.leftDesignName()+"' "+n(a,"QUERY_EDITOR_JOIN_INC_REL_DESC")}function n(a,b){return a.translator.translate(b)}return d});
define('query/adapters/join-design-adapter',['require','../services/dto/join-design-dto','../model/join-design-model','../adapters/condition-adapter'],function(require){"use strict";var a=require("../services/dto/join-design-dto"),b=require("../model/join-design-model"),c=require("../adapters/condition-adapter");function d(){}return d.toModelObject=function a(c){return new b(c)},d.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},d.toDTO=function b(d){var e=new a;return d=d||{},e.conditions=c.toDTOArray(d.conditions()),e.isMiJoin=d.isMiJoin(),e.joinSucc=d.joinSucc(),e.joinType=d.joinType(),e.key=d.key(),e.leftDesignKey=d.leftDesignKey(),e.relDesignKey=d.relDesignKey(),e.rightDesignKey=d.rightDesignKey(),e.joinDesignKey=d.joinDesignKey(),e},d.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},d});
define('query/model/parameter-container-model',['require','knockout','../adapters/parameter-design-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/parameter-design-adapter");function c(c){c=c||{},this.hasDependencies=a.observable(c.hasDependencies),this.parameterDesigns=a.observableArray(b.toModelObjectArray(c.parmDesigns))}return c});
define('query/adapters/parameter-container-adapter',['require','../services/dto/parameter-container-dto','../model/parameter-container-model','../adapters/parameter-design-adapter'],function(require){"use strict";var a=require("../services/dto/parameter-container-dto"),b=require("../model/parameter-container-model"),c=require("../adapters/parameter-design-adapter");function d(){}return d.toModelObject=function a(c){return new b(c)},d.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},d.toDTO=function b(d){var e;return d?(e=new a,e.hasDependencies=d.hasDependencies(),e.parmDesigns=c.toDTOArray(d.parameterDesigns()),e):null},d.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},d});
define('query/model/query-container-model',['require','lodash','knockout','system/lang/unique-id','../adapters/table-design-adapter','../adapters/column-design-adapter','catalog/services/catalog-constants','../adapters/join-design-adapter','../adapters/parameter-container-adapter','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("knockout"),c=require("system/lang/unique-id"),d=require("../adapters/table-design-adapter"),e=require("../adapters/column-design-adapter"),f=require("catalog/services/catalog-constants"),g=require("../adapters/join-design-adapter"),h=require("../adapters/parameter-container-adapter");require("system/lang/object"),b.extenders.numeric=function(a,c){var d=b.computed({read:a,write:function(b){var d=a(),e=Math.pow(10,c),f=isNaN(b)?0:parseFloat(+b),g=Math.round(f*e)/e;g!==d?a(g):b!==d&&a.notifySubscribers(g)}}).extend({notify:"always"});return d(a()),d};function i(a){a=a||{},this.catalogConstants=Object.resolve(f),a.tableDesigns=j(a.tableDesigns,a.joinDesigns),this.columnDesigns=b.observableArray(e.toModelObjectArray(a.columnDesigns)),this.isCaseInsensitive=b.observable(a.isCaseInsensitive),this.isChanged=b.observable(a.isChanged),this.isDeleteForce=b.observable(a.isDeleteForce),
this.isDistinct=b.observable(a.isDistinct),this.isFormatted=b.observable(a.isFormatted),this.isTop=b.observable(a.isTop),this.isUomVisible=b.observable(a.isUomVisible),this.joinDesigns=b.observableArray(g.toModelObjectArray(a.joinDesigns)),this.pageSize=b.observable(a.pageSize),this.parameterContainer=b.observable(h.toModelObject(a.parmContainer)),this.queryText=b.observable(a.queryText),this.queryType=b.observable(a.queryType),this.showTotals=b.observable(a.showTotals),this.sqlChanged=b.observable(a.sqlChanged),this.designChanged=b.observable(a.designChanged),this.startPage=b.observable(a.startPage),this.catalogPath=b.observable(a.catalogPath),this.tableDesigns=b.observableArray(d.toModelObjectArray(a.tableDesigns)),this.topRows=b.observable(a.topRows).extend({numeric:0}),this.uniqueId=b.observable(a.uniqueId||c.createV1()),this.asyncQueryRowLimit=b.observable(a.asyncQueryRowLimit),this.appendSource=b.observable(d.toModelObject(a.appendSource)),
this.predecessorSource=b.observable(d.toModelObject(a.predecessorSource)),this.successorSource=b.observable(d.toModelObject(a.successorSource)),this.designStatus=b.observable(a.designStatus),this.loadStatus=b.observable(a.loadStatus),this.queryTypeInt=b.computed(l.bind(null,this)),this.isDesignable=b.computed(m.bind(null,this)),this.maxCriteria=b.computed(k.bind(null,this)),this.tableDesigns.subscribe(n.bind(null,this),null,"arrayChange"),this.columnDesigns.subscribe(t.bind(null,this),null,"arrayChange"),this.joinDesigns.subscribe(w.bind(null,this),null,"arrayChange"),this.showTotals.subscribe(y.bind(null,this)),this.showTotals.subscribe(x.bind(null,this)),this.isDistinct.subscribe(x.bind(null,this)),this.appendSource.subscribe(z.bind(null,this)),A(this)}function j(b,c){var d=0,e,f,g=[],h=[],i=[];if(b){if(!c||!c.length)return b;for(d=0;d<c.length;d++)e=c[d],g.push(e.leftDesignKey),e.isMiJoin&&g.push(e.relDesignKey),g.push(e.rightDesignKey)
;for(d=0;d<g.length;d++)f=a.find(b,C.bind(null,g[d])),h.push(f);return a.union(h,b)}}function k(a){var b=0,c=0,d=0;for(b=0;b!==a.columnDesigns().length;b++)(c=a.columnDesigns()[b].criterias().length)>d&&(d=c);return d}function l(a){switch(a.queryType()){case"Select":return a.catalogConstants.QUERY_TYPE_SELECT;case"Update":return a.catalogConstants.QUERY_TYPE_UPDATE;case"Delete":return a.catalogConstants.QUERY_TYPE_DELETE;case"Append":return a.catalogConstants.QUERY_TYPE_APPEND;case"Transform":return a.catalogConstants.QUERY_TYPE_TRANSFORM;case"Crosstab":return a.catalogConstants.QUERY_TYPE_TRANSFORM;case"Datahub":return a.catalogConstants.QUERY_TYPE_AGGREGATE;default:return a.catalogConstants.QUERY_TYPE_NONE}}function m(a){var b=a.designStatus();return!!(!b||"Loaded"===b)}function n(b,c){var d=a.filter(c,o.bind(null,b)),e=a.filter(c,p.bind(null,b)),f=0,g=[],h,i=q(b.tableDesigns()),j=!1;for(f=0;f<e.length;f++)h=e[f].value,(!h.key()||parseInt(h.key(),10)<=0)&&(h.key(i),i++),
g=a.filter(b.tableDesigns(),r.bind(null,b,h.aliasDisplay())),g.length>1&&h.aliasDisplay(h.captionDisplay()+" "+g.length),"Datahub"===h.tableType()&&(j=!0);for(j?b.queryType("Datahub"):"Datahub"===b.queryType()&&b.queryType("Select"),f=0;f<d.length;f++)b.columnDesigns.remove(s.bind(null,b,d[f].value.key()))}function o(a,b){return"deleted"===b.status}function p(a,b){return"added"===b.status}function q(a){var b=0,c=0,d=0;for(b=0;b<a.length;b++)d=parseInt(a[b].key(),10),c=c<d?d:c;return(c+1).toString()}function r(a,b,c){return b===c.captionDisplay()}function s(a,b,c){return!!c.tableDesignKey()&&c.tableDesignKey().toString()===b.toString()}function t(b,c){var d=a.filter(c,p.bind(null,b)),e,f=0,g=q(b.columnDesigns());for(f=0;f<d.length;f++)e=d[f].value,u(b,e),(!e.key()||parseInt(e.key(),10)<=0)&&(e.key(g),g++),e.sortOrder()&&""!==e.sortOrder()||e.sortOrder("None"),e.sortIndex()&&""!==e.sortIndex()||e.sortIndex("0")}function u(b,c){if(!c.alias())return void c.alias("")
;if(!(a.filter(b.columnDesigns(),function(a){return a.alias()||a.alias(""),a.alias().toLowerCase()===c.alias().toLowerCase()}).length<=1)){var d=0,e;for(e=v(b,c,d);e;)d++,e=v(b,c,d);c.alias(c.alias()+d.toString())}}function v(b,c,d){return a.find(b.columnDesigns(),function(a){return a.alias().toLowerCase()===c.alias().toLowerCase()+d.toString()})}function w(b,c){var d=a.filter(c,p.bind(null,b)),e,f=0,g=q(b.joinDesigns());for(f=0;f<d.length;f++)e=d[f].value,parseInt(e.key(),10)<=0&&(e.key(g),g++),B(b,e,b.tableDesigns()),e.leftDesignName(),e.relDesignName(),e.rightDesignName()}function x(a){a&&a.showTotals&&a.isDistinct&&(a.showTotals()||a.isDistinct())&&a.isFormatted(!1)}function y(a,b){var c=0,d;for(c=0;c<a.columnDesigns().length;c++)d=a.columnDesigns()[c],b?d.total(d.include()?"GroupBy":"Where"):d.total("")}function z(a){var b=0,c;for(b=0;b<a.columnDesigns().length;b++)c=a.columnDesigns()[b],c.appendTo(null)}function A(a){var b=0,c
;for(b=0;b<a.joinDesigns().length;b++)c=a.joinDesigns()[b],B(a,c)}function B(c,d){var e=c.tableDesigns();d.leftDesignName(b.unwrap(a.find(e,C.bind(null,d.leftDesignKey())).caption)),d.rightDesignName(b.unwrap(a.find(e,C.bind(null,d.rightDesignKey())).caption)),d.isMiJoin()&&d.relDesignName(b.unwrap(a.find(e,C.bind(null,d.relDesignKey())).caption))}function C(a,c){return b.unwrap(c.key).toString()===a.toString()}return i});
define('query/adapters/query-container-adapter',['require','../services/dto/query-container-dto','../model/query-container-model','./table-design-adapter','./column-design-adapter','./join-design-adapter','./parameter-container-adapter'],function(require){"use strict";var a=require("../services/dto/query-container-dto"),b=require("../model/query-container-model"),c=require("./table-design-adapter"),d=require("./column-design-adapter"),e=require("./join-design-adapter"),f=require("./parameter-container-adapter");function g(){}return g.toModelObject=function a(c){return new b(c)},g.toDTO=function b(g){var h=new a;return g=g||{},h.columnDesigns=d.toDTOArray(g.columnDesigns()),h.isCaseInsensitive=g.isCaseInsensitive(),h.isChanged=g.isChanged(),h.isDeleteForce=g.isDeleteForce(),h.isDistinct=g.isDistinct(),h.isFormatted=g.isFormatted(),h.isTop=g.isTop(),h.isUomVisible=g.isUomVisible(),h.joinDesigns=e.toDTOArray(g.joinDesigns()),h.pageSize=g.pageSize(),h.parmContainer=f.toDTO(g.parameterContainer()),h.queryText=g.queryText(),h.queryType=g.queryType(),h.showTotals=g.showTotals(),h.sqlChanged=g.sqlChanged(),h.designChanged=g.designChanged(),h.startPage=g.startPage(),h.catalogPath=g.catalogPath(),
h.tableDesigns=c.toDTOArray(g.tableDesigns()),h.topRows=g.topRows(),h.uniqueId=g.uniqueId(),h.asyncQueryRowLimit=g.asyncQueryRowLimit(),h.appendSource=c.toDTO(g.appendSource()),h.predecessorSource=c.toDTO(g.predecessorSource()),h.successorSource=c.toDTO(g.successorSource()),h.designStatus=g.designStatus(),h.loadStatus=g.loadStatus(),h},g.cloneDTO=function(b){var c=JSON.stringify(b);return new a(JSON.parse(c))},g});
define('query/model/query-state-model',['require','knockout','../adapters/query-container-adapter'],function(require){"use strict";var a=require("knockout"),b=require("../adapters/query-container-adapter");function c(c){c=c||{},this.version=c.version||2,this.queryContainer=a.observable(b.toModelObject(c.queryContainer)),this.selectedTableDesign=a.observable(),this.selectedJoinDesign=a.observable()}return c});
define('query/adapters/query-state-adapter',['require','../services/dto/query-state-dto','../model/query-state-model','./query-container-adapter'],function(require){"use strict";var a=require("../services/dto/query-state-dto"),b=require("../model/query-state-model"),c=require("./query-container-adapter");function d(){}return d.toModelObject=function a(c){if(c&&c.version)return new b(c)},d.toModelObjectArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toModelObject(b[c]));return d}},d.toDTO=function b(d){var e=new a;return d=d||{},e.version=d.version,e.queryContainer=c.toDTO(d.queryContainer()),e},d.toDTOArray=function a(b){var c=0,d=[];if(b&&b.length){for(c=0;c!==b.length;c++)d.push(this.toDTO(b[c]));return d}},d});
define('query/execution/query-execution-engine',['require','jquery','ramda','application/application-events','system/error/error-message','system/globalization/translator','../services/query-service','catalog/services/catalog-service','catalog/services/dto/catalog-item-dto','catalog/services/catalog-constants','../services/dto/query-state-dto','../services/dto/query-container-dto','./query-prompt-dialog','../adapters/query-state-adapter','../adapters/query-result-adapter'],function(require){"use strict";var a=require("jquery"),b=require("ramda"),c=require("application/application-events"),d=require("system/error/error-message"),e=require("system/globalization/translator"),f=require("../services/query-service"),g=require("catalog/services/catalog-service"),h=require("catalog/services/dto/catalog-item-dto"),i=require("catalog/services/catalog-constants"),j=require("../services/dto/query-state-dto"),k=require("../services/dto/query-container-dto"),l=require("./query-prompt-dialog"),m=require("../adapters/query-state-adapter"),n=require("../adapters/query-result-adapter");function o(a){this._appEvents=Object.resolve(c),this._translator=Object.resolve(e),this._catConstants=Object.resolve(i),this._promptDialog=Object.resolve(l),this.queryService=Object.resolve(f),this.catalogService=Object.resolve(g),this.executionMode=null,this._dfd=null,a&&(p(this,a),this._opt=a)}o.prototype.execute=function b(c){var d,e=c||{};switch(this._dfd=a.Deferred(),
this.executionMode){case"SqlStatement":d=e.evalOnly?y.bind(null,this,e,this._opt.sqlStatement):s.bind(null,this,e,this._opt.sqlStatement);break;case"CatalogItemKey":d=e.evalOnly?M.bind(null,this,e,this._opt.catalogItemKey):G.bind(null,this,e,this._opt.catalogItemKey);break;case"CatalogItem":d=e.evalOnly?D.bind(null,this,e,this._opt.catalogItem):A.bind(null,this,e,this._opt.catalogItem);break;case"QueryContainer":d=e.evalOnly?R.bind(null,this,e,this._opt.queryContainer):O.bind(null,this,e,this._opt.queryContainer);break;default:throw this._translator.translate("QUERY_EXEC_UNKNOWN_MODE")}return d(),this._dfd.promise()},o.prototype.prompt=function b(c){var d;switch(this._dfd=a.Deferred(),c=c||{},this.executionMode){case"SqlStatement":d=t.bind(null,this,c,this._opt.sqlStatement);break;case"CatalogItemKey":d=H.bind(null,this,c,this._opt.catalogItemKey);break;case"CatalogItem":d=B.bind(null,this,c,this._opt.catalogItem);break;case"QueryContainer":
d=P.bind(null,this,c,this._opt.queryContainer);break;default:throw this._translator.translate("QUERY_EXEC_UNKNOWN_MODE")}return d(),this._dfd.promise()},o.prototype.compile=function b(c){var d;switch(this._dfd=a.Deferred(),this.executionMode){case"SqlStatement":d=u.bind(null,this,{},this._opt.sqlStatement);break;case"CatalogItemKey":d=I.bind(null,this,{},this._opt.catalogItemKey);break;case"CatalogItem":d=C.bind(null,this,{},this._opt.catalogItem);break;case"QueryContainer":d=Q.bind(null,this,{},this._opt.queryContainer);break;default:throw this._translator.translate("QUERY_EXEC_UNKNOWN_MODE")}return d(),this._dfd.promise()};function p(a,b){return b.catalogItemKey?void(a.executionMode="CatalogItemKey"):b.catalogItem?(q(a,b.catalogItem),void(a.executionMode="CatalogItem")):b.queryContainer?(r(a,b.queryContainer),void(a.executionMode="QueryContainer")):b.sqlStatement?void(a.executionMode="SqlStatement"):void 0}function q(a,b){
if(!(b instanceof h))throw a._translator.translate("QUERY_EXEC_INVALID_CAT_ITEM");if(b.itemType!==a._catConstants.ITEM_TYPE_QUERY)throw a._translator.translate("QUERY_EXEC_INVALID_CAT_ITEM");if(!b.query)throw a._translator.translate("QUERY_EXEC_INVALID_CAT_ITEM");if(!b.query.source)throw a._translator.translate("QUERY_EXEC_INVALID_CAT_ITEM")}function r(a,b){if(!(b instanceof k))throw a._translator.translate("QUERY_EXEC_INVALID_QUERY_CONT")}function s(a,b,c){a.queryService.compileString(c).done(v.bind(null,a,b)).fail(ea.bind(null,a))}function t(a,b,c){a.queryService.compileString(c).done(w.bind(null,a,b)).fail(ea.bind(null,a))}function u(a,b,c){a.queryService.compileString(c).done(x.bind(null,a,b)).fail(ea.bind(null,a))}function v(a,b,c){O(a,b,c)}function w(a,b,c){P(a,b,c)}function x(a,b,c){a._dfd.resolve(c)}function y(a,b,c){a.queryService.compileString(c).done(z.bind(null,a,b)).fail(ea.bind(null,a))}function z(a,b,c){R(a,b,c)}function A(a,b,c){var d=c.query.layout,e=new j(d)
;d&&d.queryContainer?O(a,b,e.queryContainer):s(a,b,c.query.source)}function B(a,b,c){var d=c.query.layout,e=new j(d);d&&d.queryContainer?P(a,b,e.queryContainer):t(a,b,c.query.source)}function C(a,b,c){var d=c.query.layout,e=new j(d);d&&d.queryContainer?Q(a,b,e.queryContainer):u(a,b,c.query.source)}function D(a,b,c){var d=c.query.layout,e=new j(d);d&&d.queryContainer?R(a,b,e.queryContainer):y(a,b,c.query.source)}function E(a,b,c){s(a,b,"(! '"+c+"')")}function F(a,b,c){y(a,b,"(! '"+c+"')")}function G(a,b,c){a.catalogService.getCatalogItem(c).done(J.bind(null,a,b)).fail(ea.bind(null,a))}function H(a,b,c){a.catalogService.getCatalogItem(c).done(K.bind(null,a,b)).fail(ea.bind(null,a))}function I(a,b,c){a.catalogService.getCatalogItem(c).done(L.bind(null,a,b)).fail(ea.bind(null,a))}function J(a,b,c){A(a,b,c)}function K(a,b,c){B(a,b,c)}function L(a,b,c){C(a,b,c)}function M(a,b,c){a.catalogService.getCatalogItem(c).done(N.bind(null,a,b)).fail(ea.bind(null,a))}function N(a,b,c){D(a,b,c)}
function O(a,b,c){b.suppressPrompts?Y(a,b,c):S(a,b,c).done(W.bind(null,a,b,c)).fail(a._dfd.reject)}function P(a,b,c){b.parameters&&c.parmContainer&&c.parmContainer.copyPromptValues(b.parameters),S(a,b,c).done(X.bind(null,a,b,c)).fail(a._dfd.reject)}function Q(a,b,c){a._dfd.resolve(c)}function R(a,b,c){b.suppressPrompts?$(a,b,c):S(a,b,c).done(Z.bind(null,a,b,c)).fail(a._dfd.reject)}function S(b,c,d){var e=a.Deferred();return T(d)?b.queryService.compileContainerParameters(d).then(V.bind(null,b),ea.bind(null,b)):(e.resolve(d.parmContainer),e.promise())}function T(a){var c,d,e;return c=a.parmContainer,d=c?c.parmDesigns:null,(e=d?b.filter(U,d):null)&&e.length>0}function U(a){return!a.isHidden}function V(a,b){return a._promptDialog.show({queryContainer:b})}function W(a,b,c,d){c.parmContainer=d,Y(a,b,c)}function X(a,b,c,d){c.parmContainer=d,a._dfd.resolve(c)}function Y(a,b,c){b&&(c.pageSize=b.pageSize||c.pageSize,c.startPage=b.startPage||c.startPage,
c.parmContainer=b.parameters||c.parmContainer,b.queryContainer&&(c.columnDesigns=b.queryContainer.columnDesigns||c.columnDesigns)),"Select"===c.queryType||"Crosstab"===c.queryType?b.sync?a.queryService.executeQueryContainerSync(c).done(ca.bind(null,a,c)).fail(ea.bind(null,a)):a.queryService.executeQueryContainer(c).done(ba.bind(null,a,c)).fail(ea.bind(null,a)):a.queryService.evaluateQueryContainer(c).done(aa.bind(null,a,b,c)).fail(ea.bind(null,a))}function Z(a,b,c,d){c.parmContainer=d,$(a,b,c)}function $(a,b,c){b&&(c.parmContainer=b.parameters||c.parmContainer),a.queryService.evaluateQueryContainer(c).done(_.bind(null,a,c)).fail(ea.bind(null,a))}function _(a,b,c){a._dfd.resolve({queryContainer:b,rowCount:c})}function aa(a,b,c,d){b.sync?a.queryService.executeQueryContainerSync(c).done(da.bind(null,a,c,d)).fail(ea.bind(null,a)):a.queryService.executeQueryContainer(c).done(da.bind(null,a,c,d)).fail(ea.bind(null,a))}function ba(a,b,c){a._dfd.resolve({queryContainer:b,rowset:c})}
function ca(a,b,c){a._dfd.resolve({queryContainer:b,result:n.toModel(c)})}function da(a,b,c){a._dfd.resolve({queryContainer:b,rowCount:c})}function ea(a,b){var c=2,e=d.fromHttpResponse(c,b);a._appEvents.errorOccured.raise(a,e),a._dfd.reject()}return o});
define('system/lang/time-zone',['require','moment-timezone','system/lang/private'],function(require){"use strict";var a=require("moment-timezone"),b=require("system/lang/private"),c="Invalid time zone identifier",d="Expected a date to be passed";function e(a){f(a),b(this).timeZoneId=a}function f(b){if(!a.tz.zone(b))throw c}var g=e.prototype;g.getTimeZoneId=function(){return b(this).timeZoneId},g.applyUtcOffset=function(c){var d,e,f;return j(c),d=b(this).timeZoneId,e=h(c),f=-a.tz.zone(d).offset(e),i(f,c)};function h(a){return Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds())}function i(a,b){var c=new Date(b.valueOf());return c.setMinutes(b.getMinutes()+a),c}g.removeUtcOffset=function(c){var d,e,f;return j(c),d=b(this).timeZoneId,e=h(c),f=a.tz.zone(d).parse(e),i(f,c)};function j(a){if(!(a instanceof Date))throw d}return e});
define('system/lang/time-zone-factory',['require','system/lang/time-zone','bluebird'],function(require){"use strict";var a=require("system/lang/time-zone"),b=require("bluebird");function c(a){return b.resolve().then(d.bind(null,a)).catch(function(a){throw a})}function d(b){return new a(b)}return{fromIanaTimeZoneId:c,fromIanaTimeZoneIdSync:d}});
define('ui/elements/date-time/timezone-handler',['require','system/lang/time-zone-factory','application/application-context','bluebird'],function(require){"use strict";var a=require("system/lang/time-zone-factory"),b=require("application/application-context"),c=require("bluebird");function d(){this.timezone=null}d.singleton=!0;var e=d.prototype;e.getTimezone=function(){var d=this,e;return d.timezone?c.resolve(f(d,d.timezone)).catch(h):(e=a.fromIanaTimeZoneId(b.user.ianaTimezoneId),c.resolve(e).catch(h).then(f.bind(null,d)).catch(h))},e.getUserTzDate=function(d){var e=this,i;return e.timezone?c.resolve(g(e,d)).catch(h):(i=a.fromIanaTimeZoneId(b.user.ianaTimezoneId),c.resolve(i).catch(h).then(f.bind(null,e)).then(g.bind(null,e,d)).catch(h))};function f(a,b){return a.timezone=b,b}function g(a,b){return a.timezone.applyUtcOffset(b)}function h(a){throw a}return d});
define('ui/elements/resultgrid/config/default-config',['require','lodash','jquery'],function(require){"use strict";var a=require("lodash"),b=require("jquery");function c(a){return{allowColumnReordering:a.allowColumnReordering(),allowColumnResizing:a.allowColumnResizing(),columnAutoWidth:a.columnAutoWidth(),selection:{mode:a.selectionMode(),selectAllMode:"page"},scrolling:{mode:a.scrollType()},sorting:d(a),loadPanel:f(a),noDataText:a.noDataCaptioin,editing:e(a),wordWrapEnabled:a.wordWrapEnabled(),onContextMenuPreparing:function(a){"header"===a.target&&(a.items=[])}}}function d(a){return{mode:a.sortingMode(),ascendingText:a.translator.translate("RG_SORT_ASCENDING_CAPTION"),descendingText:a.translator.translate("RG_SORT_DESCENDING_CAPTION"),clearText:a.translator.translate("RG_CLEAR_SORTING_CAPTION")}}function e(a){return{mode:a.editMode(),allowUpdating:a.allowRowEditing(),allowAdding:a.allowRowAdding(),allowDeleting:a.allowRowDeleting(),texts:{addRow:a.translator.translate("RG_ADD_ROW_HELP_TEXT"),
cancelAllChanges:a.translator.translate("RG_CANCEL_CHANGES_HELP_TEXT"),deleteRow:a.translator.translate("RG_DELETE"),saveAllChanges:a.translator.translate("RG_SAVE_CHANGES_HELP_TEXT"),undeleteRow:a.translator.translate("RG_UNDELETE")}}}function f(a){return{enabled:a.loaderPanelEnabled(),showPane:!1,text:""}}return c});
define('ui/elements/resultgrid/helpers/utils',['require','lodash','jquery','xss','system/text/clean-href','system/lang/converter','system/text/parser','system/text/formatter','application/application-context','system/ui/message-box','query/services/dto/query-container-dto','query/execution/query-execution-engine'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("xss"),d=require("system/text/clean-href"),e=require("system/lang/converter"),f=require("system/text/parser"),g=require("system/text/formatter"),h=Object.resolve(g),i=require("application/application-context"),j=require("system/ui/message-box"),k=require("query/services/dto/query-container-dto"),l=require("query/execution/query-execution-engine");function m(){}m.prototype.handleRowPrepared=function a(b,c,d){"data"===c.rowType&&Object.tryMethod(b,"rowPreparedCallback",c,c)},m.prototype.handleCellTemplateForActionColumn=function a(c,d,e){try{var f=b(e.value),g=f.data()||{};f=n(f),g.hyperlinkText=f.text(),g.hyperlinkUrl=f.attr("href"),f.addClass("dx-link").on("click",function(a){a.preventDefault()}).on("dxclick",function(){Object.tryMethod(c,"cellHyperlinkCallback",g)}).appendTo(d)}catch(a){throw c.translator.translate("RG_INVALID_HYPERLINK_FORMAT_MSG")}};function n(a){return a.text(c(a.text())),
a.attr("href",d(a.attr("href"))),a}m.prototype.handleCustomCellTemplate=function a(b,c,d){Object.tryMethod(b,"cellTemplateCallback",c,d)},m.prototype.handleHeaderCellTemplate=function a(b,c,d){Object.tryMethod(b,"headerCellTemplateCallback",c,d)},m.prototype.formatNumberValue=function a(b){var c=b.value;if(!c||isNaN(parseInt(c)))return 0===c?c.toString():c;var d=c.toString().split(".")[1],f=d?d.length:0;return h.format(e.toFloat(c),"n"+f)},m.prototype.formatDateValue=function a(b){var c=i.user.formats.shortDate;return h.format(b,c)},m.prototype.configurePrint=function a(c,d){c.showPrint()?b(c.element).find(".rg-print").show():b(c.element).find(".rg-print").hide(),0===d?b(c.element).find(".rg-print").attr("disabled",!0):b(c.element).find(".rg-print").removeAttr("disabled")};function o(a){for(var b=[],c=a.aggregateQueryParams.parmDesigns.length,d=0;d<c;d++)b.push(a.aggregateQueryParams.parmDesigns[d].id)
;for(var e=a.queryParams.parmDesigns.length,f=0;f<e;f++)if(b.indexOf(a.queryParams.parmDesigns[f].id)>-1)for(var g=0;g<c;g++)a.aggregateQueryParams.parmDesigns[g].id===a.queryParams.parmDesigns[f].id&&(a.aggregateQueryParams.parmDesigns[g]=a.queryParams.parmDesigns[f]);else a.aggregateQueryParams.parmDesigns.push(a.queryParams.parmDesigns[f])}m.prototype.getMenuPaging=function a(c,d){var e={};c.aggregateQueryParams?(c.queryParams&&o(c),e.parameters=c.aggregateQueryParams,e.suppressPrompts=!0):c.queryParams&&(e.parameters=c.queryParams,e.suppressPrompts=!0),c.suppressPrompts(!0),e.suppressPrompts=!0,e.evalOnly=!0,c.cachedQueryContainer?(p(c,c._queryTotalCount),b(c.element).find(".rg-pager").show(),c.getTotalCount=!1,c._queryTotalCount=0):"static"===c.data()&&"standard"===c.scrollType()?(p(c,d||c._totalCount()),b(c.element).find(".rg-pager").show(),c.getTotalCount=!1):c.loadJSONData&&(p(c,d),c.showPaging?b(c.element).find(".rg-pager").show():b(c.element).find(".rg-pager").hide(),
c.getTotalCount=!1)};function p(a,b){var c="",d=[];if(0!==b){for(var e=b/a.pageSize(),f=0;f<e;f++)c=f*a.pageSize()+1+" - "+(f+1)*a.pageSize(),d.push({displayName:c,val:f});var g=d[d.length-1],h=g.displayName;h=h.substr(0,h.indexOf("-")+2),g.displayName=h+b,a.selectedValue(""),a.listObjects(d),a.customTotalCount(b)}else a.selectedValue(""),a.listObjects([{displayName:"0",val:0}]),a.customTotalCount(0)}m.prototype.changePage=function a(b,c){if(!b.getTotalCount){var d=b.selectedValue();b.pageNumber=d,b.gridInstance.pageIndex(b.pageNumber)}};function q(a,c){a._totalCount()<a.pageSize()?(b(a.element).find(".pageControls .firstPage").attr("disabled","disabled"),b(a.element).find(".pageControls .prevPage").attr("disabled","disabled"),b(a.element).find(".pageControls .nextPage").attr("disabled","disabled"),b(a.element).find(".pageControls .lastPage").attr("disabled","disabled")):(b(a.element).find(".pageControls .firstPage").removeAttr("disabled"),
b(a.element).find(".pageControls .prevPage").removeAttr("disabled"),b(a.element).find(".pageControls .nextPage").removeAttr("disabled"),b(a.element).find(".pageControls .lastPage").removeAttr("disabled")),a.gridInstance.pageIndex()?a.gridInstance.pageIndex()===Math.floor(a._totalCount()/a.pageSize())&&(b(a.element).find(".pageControls .nextPage").attr("disabled","disabled"),b(a.element).find(".pageControls .lastPage").attr("disabled","disabled")):(b(a.element).find(".pageControls .firstPage").attr("disabled","disabled"),b(a.element).find(".pageControls .prevPage").attr("disabled","disabled")),"standard"!==a.scrollType()||a._totalCount()<a.pageSize()?b(a.element).find(".pageControls ").hide():b(a.element).find(".pageControls ").show()}function r(a,b){if(!a.gridInstance)return void console.error("grid instance not available");switch(b){case"first":a.gridInstance.pageIndex(0);break;case"prev":a.gridInstance.pageIndex(a.gridInstance.pageIndex()-1);break;case"next":
a.gridInstance.pageIndex(a.gridInstance.pageIndex()+1);break;case"last":a.gridInstance.pageIndex(Math.ceil(a._totalCount()/a.pageSize()))}}function s(a,b){j.showOk("Error in executing Query","Error")}function t(a){if(b(a.element).find(".dx-datagrid-pager.dx-pager").length){var c=b(a.element).find(".gridContainer").height()-b(a.element).find(".dx-datagrid-headers").height();b(a.element).find(".dx-datagrid-rowsview").height(c)}}return m});
define('ui/elements/resultgrid/helpers/json-helper',['require','lodash','jquery','./utils','system/lang/converter','system/text/parser','system/text/formatter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./utils"),d=require("system/lang/converter"),e=require("system/text/parser"),f=require("system/text/formatter"),g=Object.resolve(f);function h(){}var i=Object.inherit(c,h);h.prototype.preSelectRows=function a(c,d){try{var e=b(c.element).find(".gridContainer").dxDataGrid("instance");e&&e.selectRows(d)}catch(a){}},h.prototype.handleCellPrepared=function a(b,c){"data"===c.rowType&&Object.tryMethod(b,"cellPreparedCallback",c.cellElement,c)},h.prototype.handleInitNewRow=function a(b,c,d){Object.tryMethod(b,"onInitNewRowCallback",c,d)},h.prototype.handleContentReadyActionForJSON=function c(d){var e=b(d.element).find(".gridContainer").dxDataGrid("instance");b(d.element).find(".rg-controls").show(),b(d.element).find(".rg-header").show();var f=e.totalCount()>0?e.totalCount():0,g=b(".dx-datagrid-filter-row .dx-editor-cell").index(b(".dx-editor-cell.dx-focused"));d.filterElIndex=g!==-1?g:d.filterElIndex,
a.delay(function(){b(b(".dx-datagrid-filter-row .dx-editor-cell")[d.filterElIndex]).find("input").focus()},100),d.gridInstance=e,Object.tryMethod(d,"gridLoadedCallback",e),d.customTotalCount()!==f&&(d.getTotalCount=!0),"standard"===d.scrollType()?d.getTotalCount&&this.getMenuPaging(d,f):b(d.element).find(".dxDataGridTotalCount").show().text(d._totalCount()+" "+d.translator.translate("RG_TOTAL_COUNT_MESSAGE")),b(d.element).find(".dx-datagrid-pager.dx-pager").hide(),d.showGridBorder&&b(d.element).find("#gridContainer").addClass("grid-border"),this.configurePrint(d,f)},h.prototype.handleSelectionChangedForJSON=function c(d,e){var f;"single"===d.selectionMode()?(f=e.selectedRowsData[0],Object.tryMethod(d,"callback",f)):(f=a.map(e.selectedRowsData,function(a){return a.FEdefine&&a.FEdefine===!0&&a._notReplaceable===!0?b.extend(!0,a,{illegal:!0}):a}),Object.tryMethod(d,"multiSelectCallback",f))},h.prototype.handleSelectionChangeForJsonWithoutColumns=function b(c,d){var e
;"single"===c.selectionMode()?(e=d.selectedRowsData[0],Object.tryMethod(c,"callback",e)):(e=a.map(d.selectedRowsData,function(a){if(!a.FEdefine||a.FEdefine!==!0)return a}),Object.tryMethod(c,"multiSelectCallback",e))},h.prototype.handleEditorPreparedForJson=function b(c,d){var f=this;if("filterRow"===d.parentType&&"number"===d.dataType)d.editorElement.empty().dxTextBox({value:f.formatNumberValue(d),valueChangeEvent:"keyup",onValueChanged:a.debounce(function(a){var b=a.value?e.parseFloat(a.value):a.value;d.setValue(b),j(f,d,b)},500)});else if("dataRow"===d.parentType&&"number"===d.dataType)var g=d.editorElement.dxTextBox({value:f.formatNumberValue(d),onValueChanged:function(a){d.setValue(e.parseFloat(a.value))}})};function j(a,b,c){var d=b.editorElement.dxTextBox("instance"),e=d.element().find("input"),f=a.formatNumberValue({value:c});e.val(f)}h.prototype.handleEditingStart=function a(b,c){Object.tryMethod(b,"onEditingStart",c)},h.prototype.getColumnsFromData=function c(e,f){
for(var g=[],h=0;h<f.columns.length;h++){var i=a.extend({},f.columns[h])||{};if(i.dataField=f.columns[h].dataField||f.columns[h].id,void 0!==f.columns[h].alias&&""!==f.columns[h].alias?i.caption=f.columns[h].alias:i.caption||(i.caption=f.columns[h].id),void 0!==f.columns[h].isActionColumn&&"true"===f.columns[h].isActionColumn){i.cellTemplate=this.handleCellTemplateForActionColumn.bind(null,e);var j=k(i.dataField,f.data);i.calculateSortValue=j,i.calculateFilterExpression=l.bind(null,j)}else void 0!==f.columns[h].hasCellTemplate&&"true"===f.columns[h].hasCellTemplate&&(i.cellTemplate=this.handleCustomCellTemplate.bind(null,e));void 0!==f.columns[h].hasHeaderCellTemplate&&"true"===f.columns[h].hasHeaderCellTemplate&&(i.headerCellTemplate=this.handleHeaderCellTemplate.bind(null,e)),void 0!==f.columns[h].dataType&&(i.dataType=f.columns[h].dataType,"number"===i.dataType&&(i.customizeText=this.formatNumberValue)),i.encodeHtml=!0,
void 0!==f.columns[h].encodeHtml&&(i.encodeHtml=d.toBoolean(f.columns[h].encodeHtml,!0)),m(f.columns[h],i,"precision"),m(f.columns[h],i,"format"),m(f.columns[h],i,"cssClass"),m(f.columns[h],i,"alignment"),m(f.columns[h],i,"width"),m(f.columns[h],i,"allowFiltering",d.toBoolean(f.columns[h].allowFiltering,"true")),m(f.columns[h],i,"allowEditing",d.toBoolean(f.columns[h].allowEditing,"true")),m(f.columns[h],i,"fixed",d.toBoolean(f.columns[h].fixed,"true")),m(f.columns[h],i,"visible",d.toBoolean(f.columns[h].visible,!0)),void 0!==f.columns[h].lookup&&f[f.columns[h].lookup.dataSource]&&(i.lookup=b.extend({},f.columns[h].lookup),i.lookup.dataSource=f[f.columns[h].lookup.dataSource]),g.push(i)}return g};function k(a,c){for(var d=a+"_linkText",e=0;e<c.length;e++)c[e][d]=b(c[e][a]).text();return d}function l(a,b,c){return[a,c||"=",b]}function m(a,b,c,d){void 0!==a[c]&&(b[c]=4===arguments.length?d:a[c])}return h});
define('ui/elements/resultgrid/config/json-config',['require','lodash','jquery','./default-config','../helpers/json-helper'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./default-config"),d=Object.resolve(require("../helpers/json-helper"));function e(a,e,g){var h={dataSource:e.data,columns:g,pager:{visible:!1},onCellPrepared:d.handleCellPrepared.bind(null,a),onInitNewRow:d.handleInitNewRow.bind(null,a),onRowPrepared:d.handleRowPrepared.bind(null,a),onContentReady:d.handleContentReadyActionForJSON.bind(d,a),onSelectionChanged:g?d.handleSelectionChangedForJSON.bind(null,a):d.handleSelectionChangeForJsonWithoutColumns.bind(null,a),onEditorPrepared:d.handleEditorPreparedForJson.bind(d,a),onEditingStart:d.handleEditingStart.bind(null,a)};return"standard"===a.scrollType()&&(h.paging=f(a)),e.config&&b.extend(h,e.config),b.extend(h,c(a)),h}function f(a){return{enabled:!0,pageSize:a.pageSize()}}return e});
define('ui/elements/resultgrid/helpers/static-helper',['require','lodash','jquery','./utils','system/lang/converter','system/text/parser','system/text/formatter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./utils"),d=require("system/lang/converter"),e=require("system/text/parser"),f=require("system/text/formatter"),g=Object.resolve(f);function h(a){}var i=Object.inherit(c,h);h.prototype.handleStaticDataLoad=function a(c,d,e){var f=b.Deferred(),g;g=b(".dx-datagrid-filter-row .dx-editor-cell").index(b(".dx-editor-cell.dx-focused")),c.filterElIndex=g!==-1?g:c.filterElIndex,f.done(j.bind(null,c,d,e)),Object.tryMethod(c,"onPageChangeCB",f,d)};function j(a,c,d,e){a.rawQueryData=e,a.currentFilter!==c.filter&&(a.currentFilter=c.filter,a.getTotalCount=!0,a._totalCount(e.totalCount),b(a.element).find(".dxDataGridTotalCount").html(e.totalCount+" "+a.translator.translate("RG_TOTAL_COUNT_MESSAGE"))),d.resolve(e.data,{totalCount:e.totalCount}),b(b(".dx-datagrid-filter-row .dx-editor-cell")[a.filterElIndex]).find("input").focus()}h.prototype.handleGetTotalRecordsCount=function a(c,d){var e=b.Deferred()
;return Object.tryMethod(c,"totalCountCallback",e),e.done(function(a){c._totalCount(a)}),e.promise()},h.prototype.getStaticColumns=function a(b,c){for(var e=b.rawQueryData,f,g,h=0;h<c.length;h++)f=e.columns[h],g=c[h],g.dataField=f.id,void 0!==f.alias&&""!==f.alias?g.caption=f.alias:g.caption=f.id,void 0!==f.isActionColumn&&"true"===f.isActionColumn?g.cellTemplate=this.handleCellTemplateForActionColumn.bind(null,b):void 0!==f.hasCellTemplate&&"true"===f.hasCellTemplate&&(g.cellTemplate=this.handleCustomCellTemplate.bind(null,b)),void 0!==f.hasHeaderCellTemplate&&"true"===f.hasHeaderCellTemplate&&(g.headerCellTemplate=this.handleHeaderCellTemplate.bind(null,b)),g.encodeHtml=!0,void 0!==f.encodeHtml&&(g.encodeHtml=d.toBoolean(f.encodeHtml,!0)),k(f,g,"dataType"),"number"===g.dataType&&(g.customizeText=this.formatNumberValue),k(f,g,"format"),k(f,g,"precision"),k(f,g,"cssClass"),k(f,g,"alignment"),k(f,g,"width"),k(f,g,"allowFiltering",d.toBoolean(f.allowFiltering,"true")),
k(f,g,"visible",!("false"===f.visible||f.visible===!1)),k(f,g,"allowEditing",d.toBoolean(f.allowEditing,"true")),void 0!==f.lookup&&e[f.lookup.dataSource]&&(g.lookup=f.lookup,g.lookup.dataSource=e[f.lookup.dataSource]);return c};function k(a,b,c,d){void 0!==a[c]&&(b[c]=4===arguments.length?d:a[c])}return h});
define('ui/elements/resultgrid/adapters/dtos/column-info-dto',['require','lodash','jquery','knockout','system/lang/converter','system/text/parser','system/text/formatter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("system/lang/converter"),e=require("system/text/parser"),f=require("system/text/formatter"),g=Object.resolve(f),h={"System.DateTime":"date","System.Double":"number","System.Boolean":"boolean"};function i(a,b){this.dataField=j(a),this.visible=a.getIsDisplayed(),b||(this.dataType=k(a)),this.hyperlinkFormat=a.getHyperlinkFormat(),this.displayUomCaption=a.getDisplayUomCaption(),this.format=a.getFormat(),this.id=a.getFieldId(),this.fieldId=a.getFieldId(),this.alias=a.getAlias(),this.typename=a.getTypeName(),this.columnDesignKey=a.getColumnDesignKey(),this.hasCellTemplate=!1,this.encodeHtml=!0,this.visible=!0,this.fixed=!1,this.width=null}function j(a){var b=a.getAlias()||a.getFieldId();return isNaN(b)||(b+="_"),b=b.replace(/\./g,"__")}function k(a){var b;return b=h[a.getTypeName()],"Boolean"===a.getFieldDataType()&&(b="boolean"),b}return i});
define('ui/elements/resultgrid/adapters/query-data-adapter',['require','lodash','jquery','knockout','system/text/clean-href','system/lang/converter','system/text/parser','system/text/formatter','application/application-context','./dtos/column-info-dto'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("system/text/clean-href"),e=require("system/lang/converter"),f=require("system/text/parser"),g=require("system/text/formatter"),h=Object.resolve(g),i=require("application/application-context"),j=require("./dtos/column-info-dto");function k(a){}var l=k.prototype;l.getColumnInfos=function(b,c){return a.map(b,function a(b){return new j(b,c)})},l.getRows=function b(c,d,e){return a.map(d,function a(b){for(var d={},f=b.getCells(),g=0;g<e.length;g++)d[e[g].dataField]=m(c,f,f[g],e[g]),f[g].getBackColor()&&(d[e[g].dataField+"_backColor"]=f[g].getBackColor());return d})};function m(a,b,c,d){var f=t(c),g=a.cachedQueryContainer.isFormatted;return d.hyperlinkFormat&&(f="date"===d.dataType?q(c.getDbValue(),d.format):f,f=r(f,c)),"date"===d.dataType&&""!==f&&(g?(a.formColumnArr.push(d.dataField),f=q(c.getDbValue(),d.format)):v(f)||(f=c.getDbValue())),
"boolean"===d.dataType?f=e.toBoolean(f.toString().toLowerCase(),"true"):"number"!==d.dataType||d.hyperlinkFormat||g?f&&"string"==typeof f&&(f=u(f)):f=n(c),f}function n(a){var b=o(a.getValue(),a.getDbValue()),c=a.getDbValue();return c&&b&&b.toString()===c.toString()?parseFloat(b):f.parseFloat(b)}function o(a,b){return p(b)&&!p(a)?b:a}function p(a){return null!==a&&void 0!==a&&""!==a}function q(a,b){if(a){var c=b?h.getFormatByCode(b):i.user.formats.dateTime;return h.format(a,c)}return a}function r(a,b){return s(b.getHyperlinkRoute(),a)}function s(a,c){var e="";return a?(e=b("<a/>").attr("href",d(a)).text(c),b("<div/>").append(e).html()):e}function t(a){return void 0!==a.getValue()&&""!==a.getValue()?a.getValue():void 0!==a.getDbValue()&&null!==a.getDbValue()?a.getDbValue():""}function u(a){return a.replace(/<([a-z]+)([^>]*[^\/])?>(?![\s\S]*<\/\1)/gi,function(a){return b("<div/>").text(a).html()})}function v(a){return a.toString().indexOf("<a")!==-1}function w(a,b){
return a.split("/").map(function(a){if(a.startsWith("{")){var c=a.substr(1,a.length-2);return b[c].getDbValue()}return a}).join("/")}return k});
define('ui/elements/resultgrid/helpers/query-helper',['require','lodash','jquery','ramda','bluebird','./static-helper','system/lang/converter','system/text/parser','system/text/formatter','application/application-context','query/services/dto/query-container-dto','query/services/dto/parameter-container-dto','query/execution/query-execution-engine','../adapters/query-data-adapter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("ramda"),d=require("bluebird"),e=require("./static-helper"),f=require("system/lang/converter"),g=require("system/text/parser"),h=require("system/text/formatter"),i=Object.resolve(h),j=require("application/application-context"),k=require("query/services/dto/query-container-dto"),l=require("query/services/dto/parameter-container-dto"),m=require("query/execution/query-execution-engine"),n=require("../adapters/query-data-adapter"),o={"System.DateTime":"date","System.Double":"number","System.Boolean":"boolean"};function p(){this.queryDataAdapter=Object.resolve(n)}var q=Object.inherit(e,p);p.prototype.handleDatasource=function a(b){var c=this;return{load:r.bind(null,b,c),totalCount:s.bind(null,b),paginate:!0,pageSize:b.pageSize()}};function r(a,c,d){var e=new b.Deferred,f=d.filter?d.filter.join(","):"",g=d.sort?JSON.stringify(d.sort):"",h=d.skip,i=d.take,j,k={filter:f,sort:g,
skip:a.gridInstance?a.gridInstance.pageIndex()*a.pageSize():0,take:a.pageSize(),searchFilter:d.filter},l=!(d.hasOwnProperty("filter")&&void 0===d.filter);return null===a.data()||void 0===a.data()?e.resolve([]):"static"===a.data()?(k.skip=h,k.take=i,c.handleStaticDataLoad(a,k,e)):(a.gridInstance&&a.gridInstance.clearSelection(),a.currentFilter!==k.filter?(a.currentFilter=k.filter,j=b(".dx-datagrid-filter-row .dx-editor-cell").index(b(".dx-editor-cell.dx-focused")),a.filterElIndex=j!==-1?j:a.filterElIndex,x(a,k,l).done(t.bind(null,a,c,k,e,!0)).fail(u.bind(null,a,c,e))):x(a,k,l).done(t.bind(null,a,c,k,e,!1))),e.promise()}function s(a,c){var d=b.Deferred(),e={};return"static"===a.data()&&a.totalCountCallback?Object.tryMethod(a,"totalCountCallback",d,e):d.resolve(),d.promise()}function t(a,b,c,d,e,f){var g;a.rawQueryData=f.result,g=v(a,b,f),a.queryDataColumns=g.columns,Object.tryMethod(a,"queryExecutedCB",f,c),d.resolve(g.dataRows),e&&w(a.filterElIndex)}function u(a,b,c){
var d=v(a,b,a.rawQueryData);c.resolve(d.dataRows),w(a.filterElIndex)}function v(a,b,c){var d=c.result,e=d.getRows(),f=d.getColumns(),g=b.queryDataAdapter.getColumnInfos(f,c.queryContainer.isFormatted);return{dataRows:b.queryDataAdapter.getRows(a,e,g),columns:g}}function w(a){b(b(".dx-datagrid-filter-row .dx-editor-cell")[a]).find("input").focus()}function x(a,c,d){var e=b.Deferred();if("function"!=typeof a.data||null!==a.data()&&void 0!==a.data()){var f={};if(a.aggregateQueryParams?(a.queryParams&&ha(a),f.parameters=a.aggregateQueryParams,f.suppressPrompts=!0):a.queryParams?(f.parameters=a.queryParams,f.suppressPrompts=!0):f.suppressPrompts=a.suppressPrompts(),f.suppressPrompts||b(".dialog-wrapper").find("mi-resultgrid").length||b(".dx-overlay-wrapper").addClass("suppressSpinner"),f.evalOnly=!1,f.pageSize=a.pageSize(),f.startPage=0!==a.pageNumber?a.pageNumber:"0",a.cachedQueryContainer)return f.queryContainer=new k(b.parseJSON(JSON.stringify(a.cachedQueryContainer))),
d?(c.sort&&(f.queryContainer=B(a,f.queryContainer,c.sort)),void 0!==a.prevFilter&&a.prevFilter!==c.filter&&(f.startPage="0",a.pageNumber=0,a.getTotalCount=!0),""!==c.filter&&void 0===a.prevFilter&&(a.getTotalCount=!0),a.prevFilter=c.filter,C(a,f.queryContainer,c.filter,c.searchFilter).done(function(b){f.queryContainer=b,y(a,f,e)})):y(a,f,e),e;if("catalogItemPath"===a.queryExecutionMode())a.catalogService.getCatalogItemKey(a.data()).done(function b(c){f.catalogItemKey=c,y(a,f,e)});else{switch(a.queryExecutionMode()){case"catalogItemKey":f.catalogItemKey=a.data();break;case"queryContainer":f.queryContainer=a.queryContainerObject,f.suppressPrompts=a.suppressPrompts();break;case"sqlStatement":f.sqlStatement=a.data();break;case"catalogItem":f.catalogItem=a.data()}y(a,f,e)}return e}}function y(a,b,c){a.queyExecutionEngine=new m(b),b.sync=!0,a.queyExecutionEngine.execute(b).done(z.bind(null,a,c)).fail(A)}function z(a,b,c){a.cachedQueryContainer=c.queryContainer,
a._totalCount(c.result.getRows().length),a._queryTotalCount=c.result.getRowCount(),c.result.getRows().splice(a.pageSize(),a.pageSize()),b.resolve(c)}function A(){b(".dx-loadindicator").hide()}function B(a,b,c){for(var d=JSON.parse(c),e=b,f=0;f<e.columnDesigns.length;f++)e.columnDesigns[f].resultSortOrder="None",e.columnDesigns[f].resultSortIndex=0;for(var g=0;g<d.length;g++)for(var h=0;e.columnDesigns&&h<e.columnDesigns.length;h++){var i=e.columnDesigns[h].alias||P(e.columnDesigns[h].id);if(d[g].selector===i){e.columnDesigns[h].resultSortOrder=d[g].desc?"Descending":"Ascending",e.columnDesigns[h].resultSortIndex=g+1;break}}return e}function C(a,c,e,f){var g=b.Deferred(),h,i,j,k,l,m,n;if("None"!==a.uomConversionSetId)if(f&&"string"==typeof f[0])j=0,m=(f.columnIndex+1).toString(),n=[f[2].toString()],l=a.queryService.convertSimpleCriteriaText.bind(a.queryService,c,!1,m,j,n),
d.resolve().then(l).then(E(a,c,e,f,h,g));else if(f&&f.length>0)for(h=0;h<f.length;h++)"object"==typeof(i=f[h])&&(j=h,m=(i.columnIndex+1).toString(),n=[i[2].toString()],l=a.queryService.convertSimpleCriteriaText.bind(a.queryService,c,!1,m,j,n),d.resolve().then(l).then(E(a,c,e,f,h,g)));else D(a,c,e,f,g);else D(a,c,e,f,g);return g}function D(a,b,c,d,e){var f=c.split(",and,"),g=b,h,i,j=d?d.join(","):"",k=!1,l=!1,m,n;j.indexOf(",or,")>-1&&(k=!0),(j.indexOf(",and,")>-1||""!==j&&j.indexOf(",or,")===-1)&&(l=!0),k&&l?(m=d[0].join(",").split(",and,"),n=d[2].join(",").split(",or,")):!l&&k?(m=[""],n=d.join(",").split(",or,")):!k&&l&&(n=[""],m=d.join(",").split(",and,")),J(a,g,f);var o="";if(l)for(var p=0;""!==m[0]&&p<m.length;p++)i=0,h={selector:m[p].split(",")[i],query:L(m[p])},h.selector&&(o!==h.selector&&M(a,g,h.selector,F.bind(a,a,g,h)),o=h.selector);if(k)for(var q=0;""!==n[0]&&q<n.length;q++)i=0,h={selector:n[q].split(",")[i],query:L(n[q])},
h.selector&&(o!==h.selector&&M(a,g,h.selector,G.bind(a,a,g,h)),o=h.selector);return e.resolve(g)}var E=c.curry(function a(b,c,d,e,f,g,h){return e&&"string"==typeof e[0]?e[2]=h[0]:e[f][2]=h[0],D(b,c,d,e,g)});function F(a,b,c,d){c.query&&(b.columnDesigns[d].resultFilterExpression=I(a,b.columnDesigns[d],c))}function G(a,b,c,d,e){c.query&&(b.columnDesigns[d].simpleCriteria=H(a,b.columnDesigns[d],c,d))}function H(a,b,c,d){for(var e=[],f=0;f<d;f++)e.push(null);var g=[{conditionOperator:"",dateValue:null,operator:"Contains",value:c.query}];return e.push({expressions:g}),e}function I(a,b,c){var d="",e="LAST_UPDT_DT"===b.id||"CRT_DT"===b.id,f=N(a,b),g=a.cachedQueryContainer.isFormatted;if("date"===f&&!g||e){var h=new Date(c.query),j=new Date(h);j.setHours(0,0,0,0);var k=new Date(h);k.setHours(23,59,59,999)
;var l=a.timezone.removeUtcOffset(j),m=a.timezone.removeUtcOffset(k),n=i.format(l,"yyyy-MM-dd HH:mm:ss"),o=i.format(m,"yyyy-MM-dd HH:mm:ss"),p="(>=(# :dt :utc '"+n+"')",q="<=(# :dt :utc '"+o+"'))";d=p+" And "+q,a.filtersArr.push(p),a.filtersArr.push(q)}else"boolean"===f?(d="true"===c.query?"'Y'":"false"===c.query?"'N'":"",a.filtersArr.push(d)):(d="(Like '%"+c.query+"%')",a.filtersArr.push(d));return d}function J(a,b,c){M(a,b,null,null,K.bind(a,a,b)),a.filtersArr=[]}function K(a,b,c){b.columnDesigns[c].resultFilterExpression=""}function L(a){var b="",c=a.split(",");if(c.length>2&&"contains"===c[1]){var d=a.indexOf(","),e=a.indexOf(",",d+1);b=a.substring(e+1).trim()}else b=void 0===c[2]?c[2]:c[2].trim();return b}function M(a,b,c,d,e){if(!b.columnDesigns)return!1;for(var f=0;f<b.columnDesigns.length;f++){if(d){c===(b.columnDesigns[f].alias||P(b.columnDesigns[f].id))&&d&&d.call(a,f)}e&&e.call(a,f)}}function N(b,c){var d=a.find(b.queryDataColumns,function(a){
return a.columnDesignKey.toString()===c.key.toString()});return d&&d.dataType?d.dataType:c.dataType.toLowerCase()}function O(a){return a.substring(1,a.length-1)}function P(a){return a&&a.indexOf("[")>-1?O(a):a}function Q(a){return a.toString().indexOf("<a")!==-1}function R(a){return a?a.substring(0,a.length):""}p.prototype.customizeColumns=function b(c,d){if("static"===c.data())return this.getStaticColumns(c,d);var e=this,f=c.rawQueryData,g=f.getRows(),h=f.getColumns(),i,k,l,m,n,o,p,q,r,s=c.cachedQueryContainer,t=j.user.formats.shortDate;c.uomConversionSetId=j.user.uomConversionSetId;var u=a.filter(d,function(a){return!a.dataField.match("_backColor")});a.map(a.filter(d,function(a){return a.dataField.match("_backColor")}),function(a){return a.visible=!1,a});for(var v=0;v<u.length;v++)i=h[v],k=u[v],i.setFieldId(P(i.getFieldId())),k.dataField=i.getAlias()||i.getFieldId(),k.caption=X(i),k.visible=i.getIsDisplayed(),k.trueText=c.translator.translate("TRUE"),
k.falseText=c.translator.translate("FALSE"),k.filterRow={showAllText:c.translator.translate("RG_ALL")},k.encodeHtml=!0,l=V(this,c,v),l||(k.encodeHtml=l),m=aa(i.getTypeName(),s.isFormatted),m&&(k.dataType=m),o=ba(this,k.dataType),o&&(k.format={formatter:o}),"number"===k.dataType?k.customizeText=T.bind(null,this,c,s,i):"number"===na(i)?k.customizeText=U.bind(c,s.isUomVisible,i.getDisplayUomCaption()):"date"===k.dataType&&(k.customizeText=S.bind(null,i.getFormat())),n=W(this,c,v),n&&(k.cellTemplate=n),_(s,k),p=Y(this,c,v),p||(k.visible=p),q=Z(this,c,v),q&&(k.fixed=q),(r=$(this,c,v))&&(k.width=r)};function S(a,b){if(b.value){var c=a?i.getFormatByCode(a):j.user.formats.dateTime;return i.format(b.value,c)}return b.value}function T(a,b,c,d,e){var f=a.formatNumberValue(e);return f=U(c.isUomVisible,d.getDisplayUomCaption(),{value:f})}function U(a,b,c){var d=c.value;return a&&b&&d&&(d+="("+b+")"),d}function V(a,b,c){
return b.queryDataColumns[c].encodeHtml&&"true"===b.queryDataColumns[c].encodeHtml.toString()}function W(a,b,c){var d;return b.queryDataColumns[c].hasCellTemplate&&"true"===b.queryDataColumns[c].hasCellTemplate.toString()&&(d=a.handleCustomCellTemplate.bind(null,b)),d}function X(a){var b="";return b=void 0!==a.getLocalizedAlias()&&""!==a.getLocalizedAlias()?a.getLocalizedAlias():void 0!==a.getAlias()&&""!==a.getAlias()&&a.getAlias()!==a.getFieldId()?a.getAlias():void 0!==a.getCaption()&&""!==a.getCaption()&&a.getCaption()!==a.getFieldId()?a.getCaption():a.getFieldId()}function Y(a,b,c){return b.queryDataColumns[c].visible}function Z(a,b,c){return b.queryDataColumns[c].fixed}function $(a,b,c){return b.queryDataColumns[c].width}function _(a,b){if(null!==a.columnDesigns&&void 0!==a.columnDesigns)for(var c=0;c<a.columnDesigns.length;c++){var d=a.columnDesigns[c],e=d.alias||P(d.id),f=d.defaultCaption&&P(d.caption)!==P(d.defaultCaption)&&b.caption===P(d.caption)
;(b.caption===e||f||b.dataField===e)&&(d.defaultCaption&&P(d.caption)===P(d.defaultCaption)&&(b.caption=b.caption||da(d,e)),b.dataType=d.hyperlink?"string":b.dataType),b=ca(d,b)}return b}function aa(a,b){var c;switch(a){case"System.DateTime":b||(c="date");break;case"System.Boolean":c="boolean";break;case"System.Double":b||(c="number")}return c}function ba(a,b){var c;return"date"===b&&(c=a.formatDateValue),c}function ca(a,b){var c=a.expressionText,d=c&&c.match(/^'.*'$/);return"Unknown"===a.dataType&&d&&(b.allowSorting=!1,b.cssClass="disable-cursor"),b}function da(a,b){return""===a.alias&&a.caption&&(a.caption=P(a.caption),b=a.caption),b}p.prototype.handleCellPreparedForQueryResult=function c(d,e,f){if("data"===f.rowType){var g=f,h=f.cellElement,i=g.value,j=i,k=a.find(d.queryDataColumns,function(a){var b=g.column;return void 0!==b&&void 0!==b.dataField&&(b.dataField=b.dataField.replace(/\./g,"__")),a.dataField===b.dataField});if(!k||!k.hasCellTemplate){
i&&"boolean"!=typeof i&&Q(i)&&g.column.encodeHtml&&k&&k.hyperlinkFormat&&(j=j.replace(/(<a [^>]+>)([^<]+)(<\/a>)/,function(){var a=arguments[2],b="number"===k.dataType?e.formatNumberValue({value:arguments[2]}):a;return arguments[1]+b+arguments[3]}),h.empty().append(j));var l=f.data[f.column.dataField+"_backColor"];l&&b(h).css("background-color",l);var m=b(h).find("a");m.length&&ea(i)&&d._openHyperLinkInNewTab!==!1&&m.attr("target","tab")}}};function ea(a){return/<[a-z\][\s\S]*>/i.test(a)}p.prototype.handleContentReadyAction=function a(c){var d=b(c.element).find(".gridContainer").dxDataGrid("instance");b(c.element).find(".rg-controls").show(),b(c.element).find(".rg-header").show();var e=d.totalCount()>0?d.totalCount():0;if(fa(c,d),c.gridInstance=d,Object.tryMethod(c,"gridLoadedCallback",d),
"standard"===c.scrollType()?c.getTotalCount&&this.getMenuPaging(c):"standard"!==c.scrollType()||"static"!==c.data()||c.currentFilter||b(c.element).find(".dxDataGridTotalCount").html(e+" "+c.translator.translate("RG_TOTAL_COUNT_MESSAGE")),b(c.element).find(".dx-datagrid-pager.dx-pager").hide(),b(c.element).find(".dx-datagrid-pager.dx-pager").append(b(c.element).find(".dxDataGridTotalCount")),c.showGridBorder){b(c.element).find("#gridContainer").addClass("grid-border");var f=b(c.element).find("#gridContainer").height();b(c.element).find(".grid-border").height(f)}this.configurePrint(c,e)};function fa(a,c){var d=a.showPaging?"calc(100% - 46px)":"calc(100% - 25px)",e=b(a.element).find(".gridContainer");c.totalCount()<=a.pageSize()&&e.css({height:d}),a.isFirstLoad&&(a.isFirstLoad=!1,c.totalCount()<=1&&(b(a.element).find(".rg-filter").attr("disabled",!0),c.option({sorting:{mode:"none"}})))}p.prototype.handleSelectionChanged=function a(b,c){var d
;"single"===b.selectionMode()?(d=c.selectedRowsData[0],Object.tryMethod(b,"callback",d)):(d=c.selectedRowsData,Object.tryMethod(b,"multiSelectCallback",d))},p.prototype.handleEditorPreparedForQuery=function b(c){var d=this;if("filterRow"===c.parentType&&"number"===c.dataType)c.editorElement.empty().dxTextBox({value:d.formatNumberValue(c),valueChangeEvent:"keyup",onValueChanged:a.debounce(function(a){var b=a.value?g.parseFloat(a.value):a.value;c.setValue(b),ga(d,c,b)},500)});else if("dataRow"===c.parentType&&"number"===c.dataType)var e=c.editorElement.dxNumberBox({value:d.formatNumberValue(c),onValueChanged:function(a){c.setValue(g.parseFloat(a.value))}})};function ga(a,b,c){var d=b.editorElement.dxTextBox("instance"),e=d.element().find("input"),f=a.formatNumberValue({value:c});e.val(f)}p.prototype.pageFilterHandler=function a(c,d){if(d&&d.parmDesigns&&d.parmDesigns.length&&(c.aggregateQueryParams=new l(b.parseJSON(JSON.stringify(d))),c.queryParams&&c.queryParams.parmDesigns)){
for(var e=0;e<c.queryParams.parmDesigns.length;e++)for(var f=0;f<d.parmDesigns.length;f++)if(c.queryParams.parmDesigns[e].id===d.parmDesigns[f].id){c.queryParams.parmDesigns.splice(e);break}for(var g=0;g<c.queryParams.parmDesigns.length;g++)c.aggregateQueryParams.parmDesigns.push(c.queryParams.parmDesigns[g])}c.data()&&c.refresh(c.data())};function ha(a){for(var b=[],c=a.aggregateQueryParams.parmDesigns.length,d=0;d<c;d++)b.push(a.aggregateQueryParams.parmDesigns[d].id);for(var e=a.queryParams.parmDesigns.length,f=0;f<e;f++)if(b.indexOf(a.queryParams.parmDesigns[f].id)>-1)for(var g=0;g<c;g++)a.aggregateQueryParams.parmDesigns[g].id===a.queryParams.parmDesigns[f].id&&(a.aggregateQueryParams.parmDesigns[g]=a.queryParams.parmDesigns[f]);else a.aggregateQueryParams.parmDesigns.push(a.queryParams.parmDesigns[f])}function ia(b,c,d){for(var e=a.map(b,d),f=b.length,g=c.length,h=0;h<g;h++)if(e.indexOf(c[h][d]>-1))for(var i=0;i<f;i++)b[i][d]===c[h][d]&&(b[i]=c[h]);else b.push(c[h]);return c}
function ja(a,c){if(a.length&&c){var d=c.split(" And "),e=d[d.length-1].toString().trim();return b.inArray(e,a)!==-1?ka(e)?la(c,2).trim():c.substring(0,c.lastIndexOf(" And ")).trim():c}return c}function ka(a){var b=a.replace("(>=(# :dt :utc ","").replace(" 00:00:00","").replace(/\)/g,"").replace(" 23:59:59","").replace("<=(# :dt :utc ","").replace(/'/g,"");return"Invalid Date"!==new Date(b).toString()}function la(a,b){for(var c=a,d=0;d<b;d++)c=c.substring(0,c.lastIndexOf(a));return c}function ma(a,b,c){for(var d=0;d<b.rows.length;d++)for(var e=0;e<c.length;e++)b.rows[d].displayInfos&&b.rows[d].displayInfos[e]&&b.rows[d].displayInfos[e].backColor&&(a.queryHasBackgroundColor(!0),c[e].cssClass=b.rows[d].displayInfos[e].backColor),b.rows[d].displayInfos&&b.rows[d].displayInfos[e]&&b.rows[d].displayInfos[e].format&&(c[e].format={formatter:a.formatDateValue.bind(null,b.rows[d].displayInfos[e].format)})}function na(a){return"Boolean"===a.getFieldDataType()?"boolean":o[a.getTypeName()]}
return p});
define('ui/elements/resultgrid/config/query-config',['require','lodash','jquery','./default-config','../helpers/query-helper'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./default-config"),d=Object.resolve(require("../helpers/query-helper"));function e(a){var e={dataSource:d.handleDatasource(a),customizeColumns:d.customizeColumns.bind(d,a),paging:f(a),onCellPrepared:d.handleCellPreparedForQueryResult.bind(null,a,d),onContentReady:d.handleContentReadyAction.bind(d,a),onSelectionChanged:d.handleSelectionChanged.bind(null,a),onRowPrepared:d.handleRowPrepared.bind(null,a),onEditorPrepared:d.handleEditorPreparedForQuery.bind(d),remoteOperations:{paging:!0,sorting:!0,filtering:!0},pager:{visible:!1}};return b.extend(e,c(a)),e}function f(a){return{enabled:!0,pageSize:a.pageSize()}}return e});
define('ui/elements/resultgrid/config/attr-config',['require','lodash','jquery','knockout','system/lang/converter','system/text/parser','system/text/formatter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("system/lang/converter"),e=require("system/text/parser"),f=require("system/text/formatter"),g=Object.resolve(f);function h(a){this.vm=a,a.data=c.observable(),a.allowColumnResizing=c.observable(!0),a.allowColumnReordering=c.observable(!0),a.hasColumnChooser=c.observable(!0),a.selectionMode=c.observable("multiple"),a.showRowFilter=c.observable(!1),a.hideEditControls=c.observable(!1),a.showGroupingPanel=c.observable(!0),a.allowRowEditing=c.observable(!1),a.allowRowAdding=c.observable(!1),a.allowRowDeleting=c.observable(!1),a.editMode=c.observable("batch"),a.sortingMode=c.observable("single"),a.pageSize=c.observable(100),a.scrollType=c.observable("standard"),a.queryExecutionMode=c.observable("sqlStatement"),a.suppressPrompts=c.observable(!1),a.columnAutoWidth=c.observable(!0),a.wordWrapEnabled=c.observable(!1),a.showFooter=!0,a.showPaging=!0,a.showPrint=c.observable(!1),
a.loaderPanelEnabled=c.observable(!0)}function i(b,c,e,f){var g=b.getAttribute(c),h;a.isNull(g)||(h=f?d.toBoolean(g,"true"):g,a.isFunction(e)?e(h):e=h)}return h.prototype.addAttributes=function a(b){i(b,"data",b.data),i(b,"allowcolumnresizing",b.allowColumnResizing,!0),i(b,"allowcolumnreordering",b.allowColumnReordering,!0),i(b,"hascolumnchooser",b.hasColumnChooser,!0),i(b,"selectionmode",b.selectionMode),i(b,"showrowfilter",b.showRowFilter,!0),i(b,"hideeditcontrols",b.hideEditControls,!0),i(b,"showgroupingpanel",b.showGroupingPanel,!0),i(b,"allowrowediting",b.allowRowEditing,!0),i(b,"allowrowadding",b.allowRowAdding,!0),i(b,"allowrowdeleting",b.allowRowDeleting,!0),i(b,"editmode",b.editMode),i(b,"sortingmode",b.sortingMode),i(b,"pagesize",b.pageSize),i(b,"scrolltype",b.scrollType),i(b,"queryexecutionmode",b.queryExecutionMode),i(b,"suppressprompts",b.suppressPrompts,!0),i(b,"columnautowidth",b.columnAutoWidth,!0),i(b,"wordwrapenabled",b.wordWrapEnabled,!0),
i(b,"showfooter",b.showFooter,!0),i(b,"showpaging",b.showPaging,!0),i(b,"showprint",b.showPrint,!0),i(b,"loaderpanelenabled",b.loaderPanelEnabled,!0)},h.prototype.handleAttributeChange=function a(b,c,e){var f=this.vm;switch(b){case"data":f.data(e),f._refreshList(f);break;case"allowcolumnresizing":f.allowColumnResizing(d.toBoolean(e,"true"));break;case"allowcolumnreordering":f.allowColumnReordering(d.toBoolean(e,"true"));break;case"hascolumnchooser":f.hasColumnChooser(d.toBoolean(e,"true"));break;case"selectionmode":f.selectionMode(e);break;case"showgroupingpanel":f.showGroupingPanel(d.toBoolean(e,"true"));break;case"allowrowediting":f.allowRowEditing(d.toBoolean(e,"true"));break;case"allowrowadding":f.allowRowAdding(d.toBoolean(e,"true"));break;case"allowrowdeleting":f.allowRowDeleting(d.toBoolean(e,"true"));break;case"editmode":f.editMode(d.toString(e));break;case"sortingmode":f.sortingMode(e);break;case"showrowfilter":f.showRowFilter(d.toBoolean(e,"true"));break
;case"hideeditcontrols":f.hideEditControls(d.toBoolean(e,"true"));break;case"pagesize":f.pageSize(d.toInteger(e,"true"));break;case"scrolltype":f.scrollType(e);break;case"queryexecutionmode":f.queryExecutionMode(e);break;case"suppressprompts":f.suppressPrompts(d.toBoolean(e,"true"));break;case"columnautowidth":f.columnAutoWidth(d.toBoolean(e,"true"));break;case"wordwrapenabled":f.wordWrapEnabled(d.toBoolean(e,"true"));break;case"showfooter":f.showFooter=d.toBoolean(e,"true");break;case"showpaging":f.showpaging=d.toBoolean(e,"true");break;case"showprint":f.showPrint(d.toBoolean(e,"true"));break;case"loaderpanelenabled":f.loaderPanelEnabled(d.toBoolean(e,"true"))}},h});
define('ui/elements/resultgrid/config/prop-config',['require','lodash','jquery','system/lang/converter','system/text/parser','system/text/formatter'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/lang/converter"),d=require("system/text/parser"),e=require("system/text/formatter"),f=Object.resolve(e);function g(){}function h(a){return a._loadConfigurableButtons}function i(a,b){a._loadConfigurableButtons=b,a.toolbarHelper.renderToolbars(a)}function j(a){return a._loadJSONData}function k(a,b){a._loadJSONData=b,a.reload()}function l(a){return a._showGridBorder}function m(a,b){a._showGridBorder=b}return g.prototype.addProperties=function a(b){b._loadJSONData=null,Element.defineProperty(b,"loadJSONData",{get:j.bind(null,b),set:k.bind(null,b)}),b._queryParams=null,Element.defineProperty(b,"queryParams",{get:function(){return b._queryParams}.bind(b),set:function(a){b._queryParams=a}.bind(b)}),b._aggregateQueryParams=null,Element.defineProperty(b,"aggregateQueryParams",{get:function(){return b._aggregateQueryParams}.bind(b),set:function(a){b._aggregateQueryParams=a}.bind(b)}),
b._queryContainerObject=null,Element.defineProperty(b,"queryContainerObject",{get:function(){return b._queryContainerObject}.bind(b),set:function(a){b._queryContainerObject=a}.bind(b)}),Element.defineProperty(b.element,"onRowSelectCB",{get:function(){return b.callback}.bind(b),set:function(a){b.callback=a}.bind(b)}),Element.defineProperty(b.element,"onPageChangeCB",{get:function(){return b.pageChangeCallback}.bind(b),set:function(a){b.pageChangeCallback=a}.bind(b)}),Element.defineProperty(b.element,"onRowMultiSelectCB",{get:function(){return b.multiSelectCallback}.bind(b),set:function(a){b.multiSelectCallback=a}.bind(b)}),Element.defineProperty(b.element,"onCellHyperlinkClickCB",{get:function(){return b.cellHyperlinkCallback}.bind(b),set:function(a){b.cellHyperlinkCallback=a}.bind(b)}),Element.defineProperty(b.element,"onRowPreparedCB",{get:function(){return b.rowPreparedCallback}.bind(b),set:function(a){b.rowPreparedCallback=a}.bind(b)}),
Element.defineProperty(b.element,"cellTemplateCB",{get:function(){return b.celltTemplateCallback}.bind(b),set:function(a){b.cellTemplateCallback=a}.bind(b)}),Element.defineProperty(b.element,"cellPreparedCB",{get:function(){return b.cellPreparedCallback}.bind(b),set:function(a){b.cellPreparedCallback=a}.bind(b)}),Element.defineProperty(b.element,"onInitNewRowCB",{get:function(){return b.onInitNewRowCallback}.bind(b),set:function(a){b.onInitNewRowCallback=a}.bind(b)}),Element.defineProperty(b.element,"headerCellTemplateCB",{get:function(){return b.headerCellTemplateCallback}.bind(b),set:function(a){b.headerCellTemplateCallback=a}.bind(b)}),Element.defineProperty(b.element,"gridLoadedCB",{get:function(){return b.gridLoadedCallback}.bind(b),set:function(a){b.gridLoadedCallback=a}.bind(b)}),Element.defineProperty(b.element,"totalCountCB",{get:function(){return b.totalCountCallback}.bind(b),set:function(a){b.totalCountCallback=a}.bind(b)}),
Element.defineProperty(b.element,"queryExecutedCB",{get:function(){return b.queryExecutedCallback}.bind(b),set:function(a){b.queryExecutedCallback=a}.bind(b)}),Element.defineProperty(b.element,"totalCount",{get:function(){return b._totalCount()}.bind(b),set:function(a){b._totalCount(a)}.bind(b)}),b._loadConfigurableButtons=null,Element.defineProperty(b,"loadConfigurableButtons",{get:h.bind(null,b),set:i.bind(null,b)}),b._toolbarItemClickCallback=null,Element.defineProperty(b,"toolbarItemClickCallback",{get:function(a){return a._toolbarItemClickCallback}.bind(null,b),set:function(a,b){a._toolbarItemClickCallback=b}.bind(null,b)}),b._openHyperLinkInNewTab=!0,Element.defineProperty(b,"openHyperLinkInNewTab",{get:function(){return b._openHyperLinkInNewTab}.bind(b),set:function(a){b._openHyperLinkInNewTab=a}.bind(b)}),b._showGridBorder=!1,Element.defineProperty(b,"showGridBorder",{get:l.bind(null,b),set:m.bind(null,b)})},g});
define('ui/elements/resultgrid/helpers/print-helper',['require','lodash','jquery'],function(require){"use strict";var a=require("lodash"),b=require("jquery");function c(){}c.prototype.createCutomTable=function a(c){var e=c.vm,f="",g="",h="",i="",j="",k="",l=b(e).find(".dx-datagrid-text-content"),m=l.length;l.each(function(a){a!==m-1&&(h+="<th class='rg-print-header' style='"+b(this).closest("td").attr("style")+"'>"+b(this).text()+"</th>")}),f="<thead>"+h+"</thead>",b(e).find(".dx-datagrid-table").find(".dx-data-row").each(function(){j="",b(this).find(" > td:not(.dx-command-select)").each(function(){k=0===b(this).find("a").length?b(this).html():b(this).text(),j+="<td class='rg-print-col' style='"+b(this).attr("style")+"'>"+k+"</td>"}),i+="<tr>"+j+"</tr>"}),g="<tbody>"+i+"</tbody>",d(e,"<div class='rg-print-container'><table class='rg-print-table'>"+f+g+"</table>")};function d(c,d){var e=a.map(b("head > link"),function(a){return a.outerHTML}),f={htmlString:d,cssLinks:e};c.exportService.exportPage(f,"pdf","GridData")}function e(a){
var b=window.open("","","width=400,height=400"),c=b.document;c.open(),c.write(a+'<link type="text/css" rel="Stylesheet" href="styles/default.css" />'),c.close()}return c});
define('ui/elements/resultgrid/helpers/toolbar-helper',['require','lodash','jquery','./utils','system/lang/converter','system/text/parser','system/text/formatter','./print-helper','ui/elements/more-options/more-options'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./utils"),d=require("system/lang/converter"),e=require("system/text/parser"),f=require("system/text/formatter"),g=Object.resolve(f),h=Object.resolve(require("./print-helper"));require("ui/elements/more-options/more-options");function i(){this.rightToolbar=null,this.leftToolbar=null,this.vm=null,this.buttons=[]}var j=Object.inherit(c,i);i.prototype.init=function a(b,c){this.vm=b;var d,e,f;f=document.createElement("div"),d=document.createElement("mi-tool-bar"),d.className="rg-left-tool-bar pull-left",f.appendChild(d),e=document.createElement("mi-tool-bar"),e.className="rg-right-tool-bar pull-right",d.insertBefore(k(this,"showFilter",b.translator.translate("RG_SEARCH_CAPTION"),"icon-search","rg-filter"),d.firstChild),d.appendChild(n(this,b.translator.translate("PRINT"))),f.appendChild(e),c.insertBefore(f,c.firstChild),this.leftToolbar=d,this.rightToolbar=e,this.attachEventHandlers(),this.hide()},
i.prototype.handleVisibility=function a(){var c=this.vm;if(!c)return!1;c.showRowFilter()?this.show():2===b(this.leftToolbar).find("button").length&&b(this.leftToolbar).hide()},i.prototype.hide=function a(){b(this.leftToolbar).hide(),b(this.rightToolbar).hide()},i.prototype.show=function a(){b(this.leftToolbar).show(),b(this.rightToolbar).show()},i.prototype.attachEventHandlers=function a(){this.leftToolbar.addEventListener("click",this),this.rightToolbar.addEventListener("click",this)},i.prototype.handleEvent=function a(b){var c=this.vm,d;"click"===b.type&&("BUTTON"!==b.target.nodeName||b.target.disabled?"I"!==b.target.nodeName||"BUTTON"!==b.target.parentNode.nodeName||b.target.parentNode.disabled||(d=b.target.parentNode.getAttribute("data-action"),Object.tryMethod(c,"toolbarItemClickCallback",d,b)):(d=b.target.getAttribute("data-action"),Object.tryMethod(c,"toolbarItemClickCallback",d,b)))},i.prototype.disableButton=function a(b,c,d){var e,f=b.buttons
;if(f)for(e=0;e<f.length;e++)q(f[e],c)&&(f[e].disabled=d)},i.prototype.setNoAccess=function a(b,c,d){var e,f=b.buttons;if(f)for(e=0;e<f.length;e++)q(f[e],c)&&(f[e].tagName&&"mi-more-options-noko"===f[e].tagName.toLowerCase()?f[e].setAttribute("noaccess",d):d?f[e].className+=" no-access":f[e].className=f[e].className.replace(/ no-access/g,""))},i.prototype.showButton=function a(b,c,d){var e,f=b.buttons,g;if(f)for(e=0;e<f.length;e++)r(f[e])&&!q(f[e],c)?(g=s(f[e].items,c),t(g,d)):q(f[e],c)&&u(f[e],d)},i.prototype.renderToolbars=function a(b){var c,d,e,f;if(c=b.querySelector(".rg-left-tool-bar"),d=b.querySelector(".rg-right-tool-bar"),b._loadConfigurableButtons&&c&&d){for(e=0;e<b._loadConfigurableButtons().length;e++)f=b._loadConfigurableButtons()[e],
"left"===f.align?"more-options"===f.type?f.iconClass?c.insertBefore(m(this,"icon",f.iconClass,f),c.firstChild):c.insertBefore(m(this,"text",f.text,f),c.firstChild):f.text?c.insertBefore(l(this,f.action,f.title,f.text,f.btnClass),c.firstChild):c.insertBefore(k(this,f.action,f.title,f.iconClass,f.btnClass),c.firstChild):"right"===f.align&&("more-options"===f.type?f.iconClass?d.insertBefore(m(this,"icon",f.iconClass,f),d.firstChild):d.insertBefore(m(this,"text",f.text,f),d.firstChild):f.text?d.insertBefore(l(this,f.action,f.title,f.text,f.btnClass),d.firstChild):d.insertBefore(k(this,f.action,f.title,f.iconClass,f.btnClass),d.firstChild));this.show()}};function k(a,b,c,d,e){var f=document.createElement("button"),g="",h=document.createElement("i");return h.className=d,e&&(g=e),f.className="btn btn-icon "+g,f.title=c,f.setAttribute("data-action",b),f.appendChild(h),a.buttons||(a.buttons=[]),a.buttons.push(f),f}function l(a,b,c,d,e){var f=document.createElement("button"),g=""
;return f.innerHTML=d,e&&(g=e),f.className="btn btn-text "+g,f.title=c||d,f.setAttribute("data-action",b),a.buttons||(a.buttons=[]),a.buttons.push(f),f}function m(a,c,d,e){var f=document.createElement("mi-more-options-noko"),g="";return"icon"===c?f.setAttribute("icon",d):f.setAttribute("text",d),e.btnClass&&(g=e.btnClass),e.height&&b(f).prop("height",e.height),b(f).attr("class",g),window.CustomElements&&!window.CustomElements.useNative&&window.CustomElements.upgrade(f),f.items=e.options,f.loader=o.bind(null,f,e.options),f.moreoptionsCB(p.bind(null,a.vm)),a.buttons||(a.buttons=[]),a.buttons.push(f),f}function n(a,b){var c=document.createElement("button"),d=document.createElement("i");return d.className="icon-printer",c.className="btn btn-icon rg-print",c.title=b,c.style.display="none",c.onclick=function(){h.createCutomTable(a)},c.appendChild(d),a.buttons||(a.buttons=[]),a.buttons.push(c),c}function o(a,c){var d,e=[],f,g=b.Deferred(),h;for(d=0;d<c.length;d++)f={type:"text",
text:c[d].text,icon:c[d].iconClass,action:c[d].action,btnClass:c[d].btnClass},c[d].disabled&&(f.disabled="function"==typeof c[d].disabled?c[d].disabled():c[d].disabled),c[d].noaccess&&(f.noaccess="function"==typeof c[d].noaccess?c[d].noaccess():c[d].noaccess),(h=s(a.items,f.btnClass))&&h.show!==!1&&e.push(f);return g.resolve(e),g.promise()}function p(a,b){Object.tryMethod(a,"toolbarItemClickCallback",b.action)}function q(a,b){return a.className.split(" ").indexOf(b)>=0}function r(a){return!(!a||!a.tagName||"mi-more-options-noko"!==a.tagName.toLowerCase())}function s(a,b){var c;for(c=0;c<a.length;c++)if(a[c].btnClass===b)return a[c]}function t(a,b){a&&(a.show=b)}function u(a,b){a.style.display=b?"inline-block":"none"}return i});
define('ui/elements/resultgrid/resultgrid-view-model',['require','lodash','jquery','jquery','text!./resultgrid-template.html','knockout','application/application-events','system/ui/message-box','./resultgrid-service','ui/elements/page-filter/page-filter-connection','query/services/dto/query-container-dto','query/services/dto/parameter-container-dto','catalog/services/catalog-service','query/services/query-service','query/execution/query-execution-engine','system/lang/converter','system/text/parser','system/text/formatter','../date-time/timezone-handler','system/globalization/translator','application/application-context','application/export-service','./config/json-config','./config/query-config','./config/attr-config','./config/prop-config','./helpers/json-helper','./helpers/query-helper','./helpers/toolbar-helper','ui/elements/checkbox/checkbox-view-model','ui/elements/tool-bar/view-model'],function(require){"use strict"
;var a=require("lodash"),b=require("jquery"),c=require("jquery"),d=require("text!./resultgrid-template.html"),e=require("knockout"),f=require("application/application-events"),g=require("system/ui/message-box"),h=require("./resultgrid-service"),i=require("ui/elements/page-filter/page-filter-connection"),j=require("query/services/dto/query-container-dto"),k=require("query/services/dto/parameter-container-dto"),l=require("catalog/services/catalog-service"),m=require("query/services/query-service"),n=require("query/execution/query-execution-engine"),o=require("system/lang/converter"),p=require("system/text/parser"),q=require("system/text/formatter"),r=Object.resolve(q),s=require("../date-time/timezone-handler"),t=require("system/globalization/translator"),u=require("application/application-context"),v=require("application/export-service"),w=require("./config/json-config"),x=require("./config/query-config"),y=require("./config/attr-config"),z=require("./config/prop-config"),A=Object.resolve(require("./helpers/json-helper")),B=Object.resolve(require("./helpers/query-helper")),C=require("./helpers/toolbar-helper")
;require("ui/elements/checkbox/checkbox-view-model"),require("ui/elements/tool-bar/view-model");var D=Object.create(HTMLElement.prototype);D.createdCallback=function(){this.element=this,this.translator=Object.resolve(t),this.service=Object.resolve(h),this.catalogService=Object.resolve(l),this.queryService=Object.resolve(m),this.queryContainerDTO=Object.resolve(j),this.pageFilterConnection=Object.resolve(i),this.fields=e.observableArray(),this.cachedQueryContainer=null,this.attrConfig=Object.resolve(y,this),this.propConfig=Object.resolve(z,this),this.toolbarHelper=Object.resolve(C),this.exportService=Object.resolve(v),E(this);var a=this;a.filtersArr=[],a.filterElIndex=null,a.queryContainer=null,a.columnsSpecified=!1,a.totalCountDfd=new b.Deferred,a._totalCount=e.observable(0),a._totalCount.subscribe(function(b){a.totalCountDfd.resolve(b)}),a._queryTotalCount=0,a.currentFilter="",a.queryHasBackgroundColor=e.observable(!1),a.noDataCaptioin=a.translator.translate("RG_NO_DATA_CAPTION"),
a.attrConfig.addAttributes(this),a.propConfig.addProperties(this),a.getTotalCount=!0,a.customTotalCount=e.observable(),a.pageNumber=0,a.listObjects=e.observableArray([{displayName:"0",val:0}]),a.optionsValue="val",a.selectedValue=e.observable(0),a.formColumnArr=[],a.tzHandler=Object.resolve(s),a.timezone=null,a.tzHandler.getTimezone().done(function(b){a.timezone=b}),this.loadJSONData&&this.reload(),a.isFirstLoad=!0,this.appEvents=Object.resolve(f)},D.attachedCallback=function(){var a;this.element.innerHTML=d,this.pageFilterConnection.open(B.pageFilterHandler.bind(null,this),this.element),e.applyBindings(this,b(this.element).find("mi-select")[0]),e.applyBindings(this,b(this.element).find(".totalCount")[0]),a=this.querySelector(".rg-header"),this.toolbarHelper.init(this,a),this.appEvents&&this.appEvents.layoutChanged&&this.appEvents.layoutChanged.add(this.repaint,this)},D.detachedCallback=function(){this.pageFilterConnection.close(),this.cachedQueryContainer=null,
this.appEvents&&this.appEvents.layoutChanged&&this.appEvents.layoutChanged.remove(this.repaint,this)},D.attributeChangedCallback=function(a,b,c){return this.attrConfig&&this.attrConfig.handleAttributeChange(a,b,c)};function E(a){a.disableButton=a.toolbarHelper.disableButton.bind(null,a.toolbarHelper),a.setNoAccess=a.toolbarHelper.setNoAccess.bind(null,a.toolbarHelper),a.showButton=a.toolbarHelper.showButton.bind(null,a.toolbarHelper)}function F(a,b){H.bind(null,a)()}D._refreshList=F,D.refresh=function(a){this.data(a),F(this)},D.reload=function(){b(this.element).find(".rg-filter").data("isFilterEnabled",!1),"static"===this.data()&&this.gridInstance?this.refresh("static"):this.load().done()},D.repaint=function(){var a=this;try{b(a.element).find(".gridContainer").dxDataGrid("instance").repaint()}catch(a){}},D.load=function(){this.getTotalCount=!0;var a;return this.loadJSONData&&"function"==typeof this.loadJSONData?(a=this.loadJSONData(),a.done(G.bind(null,this)),
a.promise()):this.loadJSONData&&"object"==typeof this.loadJSONData?(G(this,this.loadJSONData),b.Deferred().done().promise()):b.Deferred().done().promise()},D.toggleLoaderPanel=function a(c){var d=this;if(d&&!d.element)return!1;try{var e=b(d.element).find(".gridContainer").dxDataGrid("instance"),f=null;return f=void 0!==c?!!c:!e.option("loadPanel.enabled"),e.option("loadPanel.enabled",f)}catch(a){return console.error(a),!1}};function G(a,b){void 0===b.columns||0===b.columns.length?J(a,b):I(a,b)}function H(a,b){if(null!==a.fields()&&a.data()){a.cachedQueryContainer=null,a.getTotalCount=!0;K(a,x(a))}}function I(a,b){var c=A.getColumnsFromData(a,b);a._totalCount(b.data?b.data.length:0),K(a,w(a,b,c),b,"json")}function J(a,b){a._totalCount(b.data?b.data.length:0),K(a,w(a,b),b,"json")}function K(b,c,d,e){require(["devExWebJS"],function f(){S(b);var g,h=M(b,g);b.hideEditControls()&&h.addClass("hide-edit-controls"),e?(O(b,h,c,g),
"json"===e&&void 0!==d.selectedRows&&a.defer(A.preSelectRows.bind(null,b,d.selectedRows))):"static"===b.data()?B.handleGetTotalRecordsCount(b).done(function a(){O(b,h,c,g),L(b)}):O(b,h,c),R(b,h)})}function L(a){b(a.element).find(".dxDataGridTotalCount").html(a._totalCount()+" "+a.translator.translate("RG_TOTAL_COUNT_MESSAGE"))}function M(a,c){var d="calc(100% - 46px)";return"infinite"===a.scrollType()&&(d=a.showFooter?"calc(100% - 25px)":"100%"),b('<div id="gridContainer" class="gridContainer" style=""></div>').css({display:"block",height:d,width:"100%"})}function N(a,b,c){a._totalCount()<a.pageSize()&&b.css({height:c})}function O(a,b,c,d){P(a,b).dxDataGrid(c),Q(),d&&N(a,b,d)}function P(a,c){return b(a.element).find(".gridContainer").remove().end().find(".rg-header").after(c).end().find(".gridContainer")}function Q(){b(".dx-loadpanel-indicator.dx-loadindicator.dx-widget").html('<div class="load-spinner"><span class="loading-med loading-active center-block"></span></div>')}
function R(a,c){a.showFooter||b(c).parent().find(".rg-footer").addClass("hide-rg-footer")}function S(a){b(a.element).find(".rg-filter").data("isFilterEnabled",!1),T(a),a.toolbarHelper.handleVisibility(),"infinite"===a.scrollType()?b(a.element).find(".dxDataGridTotalCount").show():"standard"===a.scrollType()&&(b(a.element).find("mi-select").show(),b(a.element).find(".totalCount").show()),a.selectedValue.subscribe(a.toolbarHelper.changePage.bind(null,a))}function T(a){b(a.element).find(".rg-filter").off().hide(),a.showRowFilter()&&b(a.element).find(".rg-filter").show().on("click",U.bind(null,a))}function U(a,c){var d=b(a.element).find(".rg-filter").data("isFilterEnabled");b(a.element).find(".rg-filter").data("isFilterEnabled",!d),b(a.element).find(".gridContainer").dxDataGrid({filterRow:{visible:!d,showOperationChooser:!1}})}return document.registerElement("mi-resultgrid",{prototype:D}),D});
define('ui/elements/ref-doc/view-models/refdoc-container-view-model',['require','lodash','jquery','knockout','text!../views/refdoc-container.html','../models/refdoc-collection','../services/service','system/lang/converter','system/ui/message-box','system/globalization/translator','logging/feedback-component/feedback-component','search/search-finder','system/lang/event','system/lang/element','../models/refdoc-path-model','./events','platform/metadata/services/metadata','application/application-context','platform/entity/services/dto/entity-dto','../views/ref-doc-container-view','ui/elements/ref-doc/view-models/downloaders/downloader','system/hardware/device','system/ui/busy-indicator','ui/elements/tool-bar/view-model','ui/elements/filter/filter-view-model','ui/elements/resultgrid/resultgrid-view-model'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("text!../views/refdoc-container.html"),e=require("../models/refdoc-collection"),f=require("../services/service"),g=require("system/lang/converter"),h=require("system/ui/message-box"),i=require("system/globalization/translator"),j=require("logging/feedback-component/feedback-component"),k=require("search/search-finder"),l=require("system/lang/event"),m=require("system/lang/element"),n=require("../models/refdoc-path-model"),o=require("./events"),p=require("platform/metadata/services/metadata"),q=require("application/application-context"),r=require("platform/entity/services/dto/entity-dto"),s=require("../views/ref-doc-container-view"),t=require("ui/elements/ref-doc/view-models/downloaders/downloader"),u=require("system/hardware/device"),v=require("system/ui/busy-indicator");require("ui/elements/tool-bar/view-model"),require("ui/elements/filter/filter-view-model"),
require("ui/elements/resultgrid/resultgrid-view-model");function w(){this.element=null,this.entityKey=null,this.siteKey=null,this.refDocEntity=null,this.familyKey=null,this.service=null,this.refDocs=null,this.translator=null,this.callback=null,this.refDocsUpdated=null,this.refDocEvents=null,this.refDocPathModel=null,this.refDocListContainer=null,this.datasheet=null,this.datasheetViewModel=null,this.canInsert=!1,this.canUpdate=!1,this.canView=!1,this.canDelete=!1,this.isSuperUser=!1,this.isAddAllowed=null,this.isUpdateAllowed=null,this.isUnlinkAllowed=null,this.readonly=null,this.showicon=null,this.failedRefDocLinkCount=0,this.refDocKeys=[],this.refDocFamilyKey=null,this.dialog=null}w.prototype=Object.create(HTMLElement.prototype),w.prototype.createdCallback=function(){this.element=this,this.refDocs=Object.resolve(e),this.service=Object.resolve(f),this.translator=Object.resolve(i),this.indicator=Object.resolve(v),this.isAddAllowed=c.observable(!0),this.isUpdateAllowed=c.observable(!0),
this.isUnlinkAllowed=c.observable(!0),this.refDocsUpdated=new l,this.refDocEvents=new o,this.familyKey="MI Reference Document",this.showicon=this.getAttribute("showicon"),this.entityKey=this.getAttribute("entitykey"),this.readonly=!!this.getAttribute("readonly")&&g.toBoolean(this.getAttribute("readonly").toLowerCase(),"true")},w.prototype.attachedCallback=function(){this.element.innerHTML=d,this.isSuperUser=q.user.isSuperUser,this.entityKey&&this.loadRefDocForDataSheet(),p.getEntityFamilyByid(this.familyKey).done(x.bind(null,this))},w.prototype.populateResultgrid=function a(){var c=this;c.resultGrid=b(c.element).find("mi-resultgrid")[0],m.upgrade(c.resultGrid),c.resultGrid.loadJSONData=c.loadData.bind(c),0===b(c.resultGrid).find(".editRefDoc").length&&(c.resultGrid.loadConfigurableButtons=c.loadButtons.bind(c)),c.resultGrid.toolbarItemClickCallback=c.toolBarItemClicked.bind(c),c.resultGrid.showGridBorder=!0,c.resultGrid.onRowMultiSelectCB=c.gridRefDocSelc.bind(null,c),
c.resultGrid.cellTemplateCB=c.cellTemplateCallback.bind(null,c),c.resultGrid.gridLoadedCB=c.gridLoadComplete.bind(null,c),b(c.resultGrid).find(".editRefDoc, .unlinkRefDoc, .deleteRefDoc").attr("disabled",!0),c.indicator.attachTo(b(c.element).find(".refdoc-container")[0])},w.prototype.cellTemplateCallback=function a(c,d,e){if(e.data.MIRD_DOC_PATH_CHR){var f=b("<a class='ref-doc-href'></a>").text(e.value);e.data.MI_REF_DOCUMENTS_STORE_DOCUM_L?(f.on("click",L.bind(null,c,e.column,e.data)),d.append(f)):e.data.MI_REF_DOCUMENTS_STORE_DOCUM_L===!1?(f.on("click",I.bind(null,c,e.column,e.data)),d.append(f)):d.text(e.value)}else d.text(e.value)},w.prototype.refDocCB=function(a){this.fromDataSheet=!0,this.callback=a,b(this.element).closest(".datasheet-layout-container").addClass("refdoc-datasheet-layout")},w.prototype.getState=function(){return this.element},w.prototype.setState=function(a){var b=this},w.prototype.gridRefDocSelc=function a(c,d){if(c.refDocKeys=[],
!c.readonly)if(void 0!==d&&void 0!==d[0]){for(var e=d.length,f=!0,g=0;g<e;g++)c.refDocKeys.push(d[g].ENTY_KEY),!f||c.isSuperUser||"0"!==d[g].MI_SITE_KEY.toString()&&""!==d[g].MI_SITE_KEY.toString()||(f=!1);1===e?b(c.resultGrid).find(".editRefDoc").removeAttr("disabled"):b(c.resultGrid).find(".editRefDoc").attr("disabled",!0),f&&b(c.resultGrid).find(".deleteRefDoc").removeAttr("disabled"),b(c.resultGrid).find(".unlinkRefDoc").removeAttr("disabled")}else b(c.resultGrid).find(".editRefDoc, .unlinkRefDoc, .deleteRefDoc").attr("disabled",!0)},w.prototype.gridLoadComplete=function a(c,d){0===b(c.resultGrid).find(".dx-selection").length?b(c.resultGrid).find(".editRefDoc, .unlinkRefDoc, .deleteRefDoc").attr("disabled",!0):b(c.resultGrid).find(".editRefDoc, .unlinkRefDoc, .deleteRefDoc").removeAttr("disabled"),b(c.resultGrid).find(".dx-selection").length>1&&b(c.resultGrid).find(".editRefDoc").attr("disabled",!0),c.fromDataSheet&&b(c.resultGrid).find(".backToDatasheet").show(),
d.option("columnAutoWidth",!1)},w.prototype.loadData=function a(){var c=this,d=b.Deferred();return c.service.getAllRefDocByRelatedEntyKey(this.entityKey).done(function(a){d.resolve(a)}).fail(G.bind(null,c,"REFDOCS_FAILED_TO_GET")),d},w.prototype.loadButtons=function a(){return[{action:"linkRefDoc",title:this.translator.translate("LINK"),iconClass:"icon-link",align:"left",btnClass:"linkRefDoc"},{action:"addRefDoc",title:this.translator.translate("ADD"),iconClass:"icon-plus",align:"left",btnClass:"addRefDoc"},{action:"backToDatasheet",title:this.translator.translate("BACK"),iconClass:"icon-header-back-arrow",align:"left",btnClass:"backToDatasheet"},{action:"deleteRefDoc",title:this.translator.translate("DELETE"),iconClass:"icon-delete-selected",align:"right",btnClass:"deleteRefDoc"},{action:"editRefDoc",title:this.translator.translate("EDIT"),iconClass:"icon-edit",align:"right",btnClass:"editRefDoc"},{action:"unlinkRefDoc",title:this.translator.translate("UNLINK"),
iconClass:"icon-unlink",align:"right",btnClass:"unlinkRefDoc"}]},w.prototype.toolBarItemClicked=function a(b){var c=this;"addRefDoc"===b?N(c,c.familyKey):"linkRefDoc"===b?T(c):"deleteRefDoc"===b?D(c):"editRefDoc"===b?S(c,c.refDocKeys[0]):"unlinkRefDoc"===b?B(c):"backToDatasheet"===b&&M(c)};function x(a,b){a.canInsert=b.canInsert,a.canView=b.canView,a.canUpdate=b.canUpdate,a.canDelete=b.canDelete,a.refDocFamilyKey=b.key,a.isAddAllowed(a.canInsert||a.isSuperUser),a.isUnlinkAllowed(a.canDelete||a.isSuperUser),a.isUpdateAllowed(a.canUpdate||a.isSuperUser),Z(a)}w.prototype.detachedCallback=function(){b(this.element).closest(".datasheet-layout-container").removeClass("refdoc-datasheet-layout")},w.prototype.attributeChangedCallback=function(a,b,c){"entitykey"===a?(this.entityKey=c,this.populateResultgrid(),this.service.getSiteKey(this.entityKey).done(F.bind(null,this)).fail(G.bind(null,this,"REFDOCS_FAILED_TO_GET_SITE"))):"readonly"===a&&(this.readonly=c),this.readonly?y(this):z(this)},
w.prototype.loadRefDocForDataSheet=function a(){this.populateResultgrid(),this.service.getSiteKey(this.entityKey).done(F.bind(null,this)).fail(G.bind(null,this,"REFDOCS_FAILED_TO_GET_SITE")),this.readonly?y(this):z(this)};function y(a){a.resultGrid&&(b(a.resultGrid).find(".editRefDoc, .unlinkRefDoc, .deleteRefDoc").attr("disabled",!0),b(a.resultGrid).find(".addRefDoc, .linkRefDoc").attr("disabled",!0))}function z(a){a.resultGrid&&(b(a.resultGrid).find(".editRefDoc, .unlinkRefDoc, .deleteRefDoc").removeAttr("disabled"),b(a.resultGrid).find(".addRefDoc, .linkRefDoc").removeAttr("disabled"))}function A(a,b){h.showOk(a,b)}function B(a){var b=a.translator.translate("DS_UNLINK_SELECTED_ENTITIES_MESSAGE"),c=a.translator.translate("RM_UNLINK_RECORD_TITLE");h.showOkCancel(b,c).done(C.bind(null,a)).fail(H.bind(null,a))}function C(a,b){0===b&&(_(a),a.service.unlinkRefDoc(a.entityKey,a.refDocKeys).done($.bind(null,a)).fail(G.bind(null,a,"REFDOCS_FAILED_TO_UNLINK")))}function D(a){
var b=a.translator.translate("DS_DELETE_SELECTED_ENTITIES_MESSAGE"),c=a.translator.translate("CONFIRM_DELETE");h.showOkCancel(b,c).done(E.bind(null,a)).fail(H.bind(null,a))}function E(a,b){0===b&&(_(a),a.service.delteRefDoc(a.refDocKeys).done($.bind(null,a)).fail(G.bind(null,a,"REFDOCS_FAILED_TO_DELETE")))}function F(a,b){a.siteKey=b&&"0"!==b?b:null}function G(a,b){aa(a),A(a.translator.translate(b),a.translator.translate("REFDOCS_ALERT"))}function H(a){console.log("dialog show ok cancel fail")}function I(a,b,c){var d=c.ENTY_KEY;_(a),a.service.getRefDocType(d).done(J.bind(null,a,d))}function J(a,b,c){var d=c.type;"URL"===c.type?("undefined"!=typeof cordova?cordova.InAppBrowser.open(c.documentPath,"_blank"):window.open(c.documentPath),aa(a)):(a.service.openRefDoc(b,c).fail(K.bind(null,a)),aa(a))}function K(a){new j({closeButton:!0,timeOut:"200",hideDuration:"200"}).error({code:"0",message:a.translator.translate("REFDOCS_FAILED_TO_OPEN_DOCUMENT")})}function L(a,b,c){
new t(a.indicator).download(c.ENTY_KEY)}function M(a){b(a.element).closest(".datasheet-layout-container").removeClass("refdoc-datasheet-layout");var c=a.resultGrid._totalCount();Object.tryMethod(a,"callback",c)}function N(a,b){var c={familykey:a.familyKey},d={functionsAvailable:["save"],readOnly:!1,canedit:!1,showDatasheetSelection:!0};require(["platform/datasheets/datasheet-dialog"],function(b){var e=a.translator.translate("REFDOCS_ADD_REFERENCE_DOCUMENT");a.dialog=new b(c,d,e,!1);var f={width:"60%",height:"75%"};a.dialog.show(f),a.dialog.datasheetViewModel.dfd.done(O.bind(null,a))})}function O(a,b){a.refDocEntity=b,b.entitySaved.add(P.bind(null,a),a),a.datasheet=a.dialog.datasheetViewModel.datasheet,void 0!==a.siteKey&&(a.datasheet.datasheetManager.layout.siteKey(a.siteKey),a.isSuperUser||a.datasheet.datasheetManager.layout.isSelectedSiteViewOnly(!0))}function P(a,b){a.service.linkRefDocEnntity(a.entityKey,b.key).done(Q.bind(null,a)).fail(R.bind(null,a))}function Q(a){
a.dialog&&(a.dialog.close(),a.dialog=null),a.resultGrid.reload(),a.refDocsUpdated.raise()}function R(a,b){A(b,a.translator.translate("REFDOCS_ALERT"))}function S(a,b){var c={entityObj:b},d={functionsAvailable:["save","delete"],readOnly:!1,canedit:!1,showDatasheetSelection:!0};require(["platform/datasheets/datasheet-dialog"],function(b){var e=a.translator.translate("REFDOCS_EDIT_REFERENCE_DOCUMENT");a.dialog=new b(c,d,e,!1);var f={width:"60%",height:"75%"};a.dialog.show(f),a.dialog.datasheetViewModel.dfd.done(function(b){var c=a.dialog.datasheetViewModel.datasheet;c.entitySaved.add(Q.bind(null,a),a),c.entityDeleted.add(Q.bind(null,a),a)})})}function T(a){var c=b.Deferred(),d=new k,e=null===a.siteKey?[a.siteKey]:[a.siteKey,null],f={multiSelect:!0,selectRelated:!1,families:[a.refDocFamilyKey],relationships:[],defaultFamily:a.refDocFamilyKey,siteKeys:e};return c.done(Y.bind(null,a)),d.show(f).done(U.bind(null,a,c)),c}function U(b,c,d){var e=d.length;a.each(d,V.bind(null,b,e,c))}
function V(a,b,c,d,e){a.failedRefDocLinkCount=0,_(a),a.service.linkRefDocEnntity(a.entityKey,d.key).done(W.bind(null,a,b,c,e)).fail(X.bind(null,a,b,c,e))}function W(a,b,c,d){b===d+1&&c.resolve(a.failedRefDocLinkCount),a.refDocsUpdated.raise(),aa(a)}function X(a,b,c,d){var e=b===d+1;a.failedRefDocLinkCount++,e&&c.resolve(a.failedRefDocLinkCount),aa(a)}function Y(a){0===a.failedRefDocLinkCount?a.resultGrid.reload():h.showOk(a.translator.translate("REFDOCS_FAILED_TO_LINK")+" "+a.failedRefDocLinkCount,a.translator.translate("REFDOCS_FAILED"))}function Z(a){a.isAddAllowed()||(b(a.element).find(".addRefDoc").addClass("no-access"),b(a.element).find(".linkRefDoc").addClass("no-access")),a.isUnlinkAllowed()||(b(a.element).find(".unlinkRefDoc").addClass("no-access"),b(a.element).find(".deleteRefDoc").addClass("no-access")),a.isUpdateAllowed()||b(a.element).find(".editRefDoc").addClass("no-access")}function $(a,b){aa(a),
b&&b[0]&&""!==b[0].errorMessage&&A(b[0].errorMessage,a.translator.translate("ERROR_MESSAGE")),a.resultGrid.reload(),a.refDocsUpdated.raise()}function _(a){a.indicator.show()}function aa(a){a.indicator.hide()}return m.registerElement("mi-ref-doc",{prototype:w.prototype}),w});
define('ui/elements/associated-pages-btn/services/dto/hyperlink-dto',[],function(){"use strict";function a(a){this.hyperLinkKey=a.hyperLinkKey,this.familyKey=a.familyKey,this.url=a.url,this.sequence=a.sequence,this.defaultText=a.defaultText,this.parentMenuKey=a.parentMenuKey,this.condition=a.condition,this.isDefaultMenu=a.isDefaultMenu,this.displayText=a.displayText,this.environment=a.environment,this.children=b(a.children),this.hasChildren=null,this.isOpen=!1,a.url||(this.hasChildren=!0),"-"===a.defaultText&&(this.hasChildren=!1)}function b(b){for(var c=[],d=0;d<b.length;d++)c.push(new a(b[d]));return c}return a});
define('ui/elements/associated-pages-btn/services/associated-pages-service',['require','jquery','./dto/hyperlink-dto','system/http/ajax-client','platform/entity/services/dto/entity-dto'],function(require){"use strict";var a=require("jquery"),b=require("./dto/hyperlink-dto"),c=require("system/http/ajax-client"),d=require("platform/entity/services/dto/entity-dto"),e="api/core/entity",f="api/core/entity/Urls/";function g(a){this.ajaxClient=a}return g.dependsOn=[c],g.prototype.getAssocPages=function c(d){var e,g=f+d,h=a.Deferred();return this.ajaxClient.get(g).done(function(a){var c=[];for(e=0;e<a.length;e++)c.push(new b(a[e]));h.resolve(c)}).fail(function(a){h.reject(a.responseText)}),h.promise()},g.prototype.getDataSheetDetails=function b(c){var f=a.Deferred();return this.ajaxClient.get(e+"/"+c).done(function(a){f.resolve(new d(a))}).fail(function(a){f.reject(a)}),f.promise()},g});

define('text!ui/elements/associated-pages-btn/component/component-view.html',[],function () { return '<div class="assoc-page-placeholder">    \r\n    <div class="assoc-pages-empty" data-bind="visible: !children().length ">\r\n        <h2 name="text" class="system-ellipsis-text" data-bind="text: translator.translate(\'NO_ASSOCIATED_PAGES\')"></h2>\r\n    </div>    \r\n    <div class="assoc-list-group-template" data-bind="template: { name: \'componentTemplate\'} ">\r\n    </div>\r\n</div>\r\n\r\n<script type="text/html" id="componentTemplate">\r\n    <ul class="assoc-list-group" data-bind="foreach: $data.children">\r\n        <li class="assoc-list-group-item">\r\n            <!-- ko if: $data.children.length == 0 -->\r\n            <span class="span-item-text" data-bind="style: { \'font-weight\': isDefaultMenu ? \'bold\' : \'\' }">\r\n                <a data-bind="text: displayText,click: $root.selectedElementNavigateUrl.bind($root, url), attr:{ href: url, target:\'_blank\' }"></a>\r\n            </span>\r\n            <!-- /ko -->\r\n            <!-- ko if: $data.children.length > 0 -->\r\n            <span class="span-item-text" data-bind="style: { \'font-weight\': isDefaultMenu ? \'bold\' : \'\' }, click: function() { isOpen(!isOpen()) }">\r\n                <i class="icon-tree-collapse" data-bind="css: { \'icon-tree-expand\': isOpen }"></i>\r\n                <span data-bind="text: displayText"></span>\r\n            </span>\r\n\r\n            <!-- ko if: $data.isOpen && $data.isOpen() -->\r\n            <span data-bind="template: { name: \'componentTemplate\' }"></span>\r\n            <!-- /ko -->\r\n            <!-- /ko -->\r\n        </li>\r\n    </ul>\r\n</script>';});

define('ui/elements/associated-pages-btn/model/hyperlink-model',['knockout','system/text/clean-href'],function(){"use strict";var a=require("knockout"),b=require("system/text/clean-href");function c(c){this.hyperLinkKey=c.hyperLinkKey,this.familyKey=c.familyKey,this.url=b(c.url),this.sequence=c.sequence,this.defaultText=c.defaultText,this.parentMenuKey=c.parentMenuKey,this.condition=c.condition,this.isDefaultMenu=c.isDefaultMenu,this.displayText=c.displayText,this.environment=c.environment,this.children=d(c.children),this.hasChildren=null,this.isOpen=a.observable(!1),c.url||(this.hasChildren=!0),"-"===c.defaultText&&(this.hasChildren=!1)}function d(a){for(var b=[],d=0;d<a.length;d++)b.push(new c(a[d]));return b}return c});
define('ui/elements/associated-pages-btn/component/component-view-model',['require','jquery','system/knockout/knockout-manager','spa/ko/knockout-view-model','system/globalization/translator','text!./component-view.html','../services/associated-pages-service','../model/hyperlink-model','spa/region','knockout','application/application-events','system/lang/object'],function(require){"use strict";var a=require("jquery"),b=require("system/knockout/knockout-manager"),c=require("spa/ko/knockout-view-model"),d=require("system/globalization/translator"),e=require("text!./component-view.html"),f=require("../services/associated-pages-service"),g=require("../model/hyperlink-model"),h=require("spa/region"),i=require("knockout"),j=require("application/application-events");require("system/lang/object");function k(a){l.call(this,e);var b=this;b.appEvents=Object.resolve(j),b.navigate=b.appEvents.navigate,b.children=i.observableArray([]),b.entitykey=a.entitykey,b.familykey=a.familykey,b.associatedPagesService=Object.resolve(f),b.translator=Object.resolve(d),b.getPagesFromService(b.familykey).done(b.createAssocPages.bind(null,b)),b.callback=null}var l=Object.inherit(c,k);k.prototype.attach=function a(b){var c=this;l.prototype.attach.call(c,b),c.region=b},k.prototype.getPagesFromService=function b(c){var d=this
;return c&&!isNaN(c)?d.associatedPagesService.getAssocPages(c).done(function(a){m(a,d)}).fail(function(a){console.error(a)}):a.Deferred()},k.prototype.createAssocPages=function a(b){var c,d,e,f,g;e=document.getElementsByClassName("assoc-page-placeholder")[0],b.contentConatiner=e,e&&b.initAssociatedPages(b)};function m(a,b){var c=[];b.dataKeys={};for(var d=0;d<a.length;d++){var e=new g(a[d]);c.push(e),b.dataKeys[e.hyperLinkKey]=e.children,e.children.length&&n(b,e.children)}b.children(c),b.componentCallback(b,b.children())}k.prototype.componentCallback=function a(b){Object.tryMethod(b,"callback")},k.prototype.initAssociatedPages=function a(b){b.loadAssociatedPages(b)},k.prototype.loadAssociatedPages=function b(c){var d=a.Deferred();return d.resolve(c.children()),d};function n(a,b){for(var c=0;c<b.length;c++){var d=b[c];a.dataKeys[d.hyperLinkKey]=d.children,d.children.length&&n(a,d.children)}}k.prototype.selectedElementNavigateUrl=function a(b){var c=this;if(b){var d=!1
;if((b.indexOf("webmacros/macrorunner")>-1||0===b.indexOf("!"))&&(d=!0),"#"===b.charAt(0)||"!"===b.charAt(0))if(/\{[0-9]\}/.test(b)&&(b=b.replace(/\{[0-9]\}/,c.entitykey),b=b.replace(/\{[0-9]\}/,c.familykey),d?(b=b.substring(1),c.navigate.raise(b,{isActionRoute:!0})):c.navigate.raise(b,{tab:!0})),(/\[ENTY_KEY\]/.test(b)||/\[enty_key\]/.test(b)||/\[FMLY_KEY\]/.test(b)||/\[fmly_key\]/.test(b))&&(b=b.replace("[ENTY_KEY]",c.entitykey),b=b.replace("[FMLY_KEY]",c.familykey),b=b.replace("[enty_key]",c.entitykey),b=b.replace("[fmly_key]",c.familykey)),/\[([A-Z]|[a-z]|[0-9]|\_)*\]/.test(b)){var e=/\[([A-Z]|[a-z]|[0-9]|\_)*\]/g.exec(b),f=e[0],g=f.slice(1,f.length-1);c.associatedPagesService.getDataSheetDetails(c.entitykey).done(function(a){for(var h=0;h<a.fields.length;h++)a.fields[h].id.toLowerCase()!==g.toLowerCase()||(b=b.replace(f,a.fields[h].dbValue),null===(e=/\[([A-Z]|[a-z]|[0-9]|\_)*\]/g.exec(b)))||(f=e[0],g=f.slice(1,f.length-1),h=-1);d?(b=b.substring(1),c.navigate.raise(b,{
isActionRoute:!0})):c.navigate.raise(b,{tab:!0})}).fail(function(a){console.error(a)})}else d?(b=b.substring(1),c.navigate.raise(b,{isActionRoute:!0})):c.navigate.raise(b,{tab:!0});else window.open(b);o()}};function o(){a(".filter-outer-container").remove()}return k.prototype.detach=function a(b){l.prototype.detach.call(this,b)},k});

define('text!ui/elements/associated-pages-btn/associated-pages-view.html',[],function () { return '<mi-filter-no-ko data-bind="" icon="icon-duplicate-entries" custom-filter="true" isfilterscrollable="false">\r\n</mi-filter-no-ko>';});

define('ui/elements/associated-pages-btn/associated-pages',['require','lodash','jquery','system/globalization/translator','system/lang/converter','./services/associated-pages-service','./component/component-view-model','text!./associated-pages-view.html','ui/elements/filter/filter-no-ko'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/globalization/translator"),d=require("system/lang/converter"),e=require("./services/associated-pages-service"),f=require("./component/component-view-model"),g=require("text!./associated-pages-view.html");require("ui/elements/filter/filter-no-ko");var h=Object.create(HTMLElement.prototype);h.createdCallback=function(){var a;a=this,a.translator=Object.resolve(c),a.familykey=a.getFamilyKey(),a.entitykey=a.getEntityKey(),a.disabled=a.getDisabled(),a.componentViewModel=Object.resolve(f,a),a.hideifnorecords=a.getAssociatedPagesVisible()},h.getFamilyKey=function(){return this.getAttribute("familykey")},h.getEntityKey=function(){return this.getAttribute("entitykey")},h.getDisabled=function(){return this.getAttribute("disabled")},h.getAssociatedPagesVisible=function(){return this.getAttribute("hideifnorecords")},h.setFamilyKey=function(a){var b=this
;b.filter&&b.filter.filterViewModel&&(b.filter.filterViewModel.familykey=a)};function i(a,b){a.filter&&a.filter.filterViewModel&&(a.filter.filterViewModel.entitykey=b)}h.attributeChangedCallback=function(a,b,c){var d=this;"familykey"===a?(d.familykey=c,d.setFamilyKey(c),d.componentViewModel&&d.componentViewModel.getPagesFromService(d.familykey).done(d.componentViewModel.createAssocPages.bind(null,d.componentViewModel)),k(d)):"entitykey"===a?(d.entitykey=c,i(d,c),k(d)):"disabled"===a&&(d.disabled=c,d.filter&&(d.filter.disabled=c))},h.attachedCallback=function(){var a=this;b(a).empty(),b(a).append(g),a.filter=b(a).find("mi-filter-no-ko")[0],a.componentViewModel.familykey=a.familykey,a.componentViewModel.entitykey=a.entitykey,a.componentViewModel.callback=j.bind(null,a),a.filter.filterViewModel=a.componentViewModel,a.filter.icon="icon-duplicate-entries",a.filter.disabled=a.disabled,b(a.filter).attr("title",a.translator.translate("ASSOCIATED_PAGES_TITLE")),k(a)};function j(a){k(a)}
function k(a){a.hideifnorecords=a.getAssociatedPagesVisible();var c=d.toBoolean(a.hideifnorecords,"true");"0"===a.entitykey?b(a).css("display","none"):"0"!==a.entitykey&&(c&&a.componentViewModel.children()&&0===a.componentViewModel.children().length?b(a).css("display","none"):b(a).css("display","inline"))}return h.detachedCallback=function(){b(this).empty(),this.familykey=null,this.entitykey=null,this.disabled=null},document.registerElement("mi-associated-pages-btn",{prototype:h}),h});
define('platform/datasheets/layout/ui/datasheet-view-model',['require','lodash','jquery','knockout','spa/ko/knockout-view-model','./layout-element-view-model','../services/datasheet-service','system/lang/event','../model/field-value-model','../model/entity-model','../model/datasheet-clipboard-model','../adapters/datasheet-adapter','application/export-service','../adapters/datasheet-field-info-adapter','platform/datasheets/layout/ui/utils','./helpers/ref-doc-helper','./helpers/js-module-helper','./helpers/ui-helper','./helpers/print-helper','./helpers/record-manager-helper','text!./views/datasheet.html','text!./field-control-template-map.json','text!./views/templates/layout-control-template.html','text!./views/templates/layout-element-template.html','text!./views/templates/layout-empty-space-template.html','text!./views/templates/layout-group-template.html','text!./views/templates/layout-label-template.html','text!./views/templates/layout-root-template.html','text!./views/templates/layout-tabbed-group-template.html','text!./views/templates/layout-table-column-template.html','text!./views/templates/layout-table-row-template.html','text!./views/templates/layout-table-template.html','text!./views/templates/field-check-box-template.html','text!./views/templates/field-combo-box-template.html','text!./views/templates/field-date-template.html','text!./views/templates/field-date-alt-template.html','text!./views/templates/field-radio-template.html','text!./views/templates/field-text-area-template.html','text!./views/templates/field-hyperlink-template.html','text!./views/templates/field-text-template.html','text!./views/templates/field-select-template.html','text!./views/templates/field-multivalue-template.html','text!./views/templates/field-empty-template.html','text!./views/templates/field-browse-template.html','text!./views/templates/field-multi-text-template.html','text!./views/templates/field-masked-template.html','text!./views/templates/field-uom-template.html','system/globalization/translator','application/application-events','ui/elements/ref-doc/models/refdoc-path-model','ui/elements/ref-doc/models/refdoc-path-adapter','system/error/error-message','system/knockout/knockout-manager','platform/metadata/services/metadata','ui/elements/ref-doc/services/service','../../layout/model/uom-conversion-model','platform/entity/entity-factory','logging/feedback-component/feedback-component','system/knockout/knockout-helpers','./bootstrap-tabs','ui/elements/select/view-model','ui/elements/multi-value/view-model','ui/elements/text-ext/view-model','ui/elements/date-time/bootstrap-datetimepicker','ui/elements/date-time/element','ui/elements/more-options/more-options','ui/elements/site-selector/site-selector-element','ui/elements/state-transition/component','ui/elements/ref-doc/view-models/refdoc-container-view-model','ui/elements/associated-pages-btn/associated-pages'],function(require){"use strict"
;var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("spa/ko/knockout-view-model"),e=require("./layout-element-view-model"),f=require("../services/datasheet-service"),g=require("system/lang/event"),h=require("../model/field-value-model"),i=require("../model/entity-model"),j=require("../model/datasheet-clipboard-model"),k=require("../adapters/datasheet-adapter"),l=require("application/export-service"),m=require("../adapters/datasheet-field-info-adapter"),n=require("platform/datasheets/layout/ui/utils"),o=require("./helpers/ref-doc-helper"),p=require("./helpers/js-module-helper"),q=require("./helpers/ui-helper"),r=require("./helpers/print-helper"),s=require("./helpers/record-manager-helper"),t=require("text!./views/datasheet.html"),u=JSON.parse(require("text!./field-control-template-map.json")),v=require("text!./views/templates/layout-control-template.html")+require("text!./views/templates/layout-element-template.html")+require("text!./views/templates/layout-empty-space-template.html")+require("text!./views/templates/layout-group-template.html")+require("text!./views/templates/layout-label-template.html")+require("text!./views/templates/layout-root-template.html")+require("text!./views/templates/layout-tabbed-group-template.html")+require("text!./views/templates/layout-table-column-template.html")+require("text!./views/templates/layout-table-row-template.html")+require("text!./views/templates/layout-table-template.html"),w=require("text!./views/templates/field-check-box-template.html")+require("text!./views/templates/field-combo-box-template.html")+require("text!./views/templates/field-date-template.html")+require("text!./views/templates/field-date-alt-template.html")+require("text!./views/templates/field-radio-template.html")+require("text!./views/templates/field-text-area-template.html")+require("text!./views/templates/field-hyperlink-template.html")+require("text!./views/templates/field-text-template.html")+require("text!./views/templates/field-select-template.html")+require("text!./views/templates/field-multivalue-template.html")+require("text!./views/templates/field-empty-template.html")+require("text!./views/templates/field-browse-template.html")+require("text!./views/templates/field-multi-text-template.html")+require("text!./views/templates/field-masked-template.html")+require("text!./views/templates/field-uom-template.html"),x=require("system/globalization/translator"),y=require("application/application-events"),z=require("ui/elements/ref-doc/models/refdoc-path-model"),A=require("ui/elements/ref-doc/models/refdoc-path-adapter"),B=require("system/error/error-message"),C=require("system/knockout/knockout-manager"),D=require("platform/metadata/services/metadata"),E=require("ui/elements/ref-doc/services/service"),F=require("../../layout/model/uom-conversion-model"),G=require("platform/entity/entity-factory"),H=require("logging/feedback-component/feedback-component")
;require("system/knockout/knockout-helpers"),require("./bootstrap-tabs"),require("ui/elements/select/view-model"),require("ui/elements/multi-value/view-model"),require("ui/elements/text-ext/view-model"),require("ui/elements/date-time/bootstrap-datetimepicker"),require("ui/elements/date-time/element"),require("ui/elements/more-options/more-options"),require("ui/elements/site-selector/site-selector-element"),require("ui/elements/state-transition/component"),require("ui/elements/ref-doc/view-models/refdoc-container-view-model"),require("ui/elements/associated-pages-btn/associated-pages");function I(a){var b=this;J.call(this,t),this.kom=Object.resolve(C),this.util=Object.resolve(n),this.region=null,this.scrollEl=null,this.collapsibleChangeEventHandler=null,this.translator=Object.resolve(x),this.datasheetService=a,this.title=c.observable(""),this.appEvents=Object.resolve(y),this.exportService=Object.resolve(l),this.refDocHelper=Object.resolve(o),this.jsModuleHelper=Object.resolve(p),
this.printHelper=Object.resolve(r),this.uiHelper=Object.resolve(q),this.recordManagerHelper=Object.resolve(s),b.refDocPathModel=null,b.teamModel=null,this.entityFactory=new G,j.onChange.add(b.onChangingClipboardData,b),this.entykey=c.observable(),this.currentEntyKey=c.observable(),this.isBulkDatasheet=c.observable(!1),this.datasheetKeys=c.observableArray(),this.datasheets=c.observableArray(),this.currentDatasheetKey=c.observable(),this.previousDatasheetKey=c.observable(),this.cachedFieldValues=null,this.cachedFamilykey=null,this.assocFamilykey=c.observable(),this.assocDisabled=c.observable(!0),this.currentDatasheet=c.observable(),this.currentEntity=c.observable(),this.fieldInfos=c.observableArray(),this.layoutElements=c.observableArray(),this.entityReference=null,this.kom.subscribe(this.currentEntity,_.bind(null,this)),this.kom.subscribe(this.currentEntity,$.bind(null,this),null,"beforeChange"),this.isSaveAvailable=c.observable(!0),this.isNewAvailable=c.observable(!0),
this.isDeleteAvailable=c.observable(!0),this.isHistoryAvailable=c.observable(!0),this.isHistoryEnabled=c.observable(!0),this.isSiteFiltered=c.observable(!1),this.siteKey=c.observable(),this.isSelectedSiteViewOnly=c.observable(!1),this.showSiteSelector=c.observable(!0),this.assetContextKey=c.observable(),this.kom.subscribe(this.assetContextKey,ba.bind(b,this)),this.isRefDocEnabled=c.observable(!1),this.refDocCount=c.observable(""),this.isReferencesAvailable=c.observable(!0),this.isCopyAvailable=c.observable(!0),this.isPasteEnabled=c.observable(!0),this.isDatasheetReadOnly=c.observable(!1),this.showEditButton=c.observable(!1),this.canEdit=c.observable(!1),this.showStateManagement=c.observable(!0),this.showDatasheetSelection=c.observable(!0),this.isReadOnly=c.observable(!1),this.helpTextModeOn=c.observable(!1),this.helpButtonText=c.observable(this.translate("DS_TURN_ON_HELPTEXT")),this.bindKeypress=c.observable(!1),this.isSilmmerHeader=c.observable(!1),this.canPaste=c.observable(!0),
this.overlayTop=c.observable("0"),this.overlayHeight=c.observable(),this.kom.subscribe(this.isDatasheetReadOnly,aa.bind(b,this)),this.isMasterDatasheet=c.observable(!1),this.kom.subscribe(this.isMasterDatasheet,va.bind(b,this)),this.entityState=c.observable(),this.oldEntity=null,this.isDatasheetRendered=c.observable(!1),this.isRefDocRendered=c.observable(!1),this.isNewEntityCreated=c.observable(!1),this.isDatasheetRenderedInRM=c.observable(!1),this.isRootRecordAvailable=c.observable(!0),this.isUnlinkRecordAvailable=c.observable(!0),this.isUnlinkRecordEnabled=c.observable(!0),this.isDefaultHelpTextAvailable=c.observable(!0),this.hideMoreOptionsForIcons=c.observable(!1),this.tabWidth=c.observable(0),this.containerWidth=c.observable(0),this.showTabScroll=this.kom.computed(ua.bind(null,b)),this.datasheetNavWidth=c.observable(0),this.appEvents.windowResized.add(this.handleNavAppearance,this),this.layoutRendered=new g,this.entityRendered=new g,this.fieldValueChanged=new g,
this.fieldTouched=new g,this.currentEntityChanged=new g,this.datasheetSaved=new g,this.datasheetNew=new g,this.datasheetDelete=new g,this.datasheetReference=new g,this.datasheetHistory=new g,this.onMasterDetail=new g,this.changeCanPaste=new g,this.beforeStateTransition=new g,this.onStateTransition=new g,this.onSiteChange=new g,this.tabSwitched=new g,this.refDocsHidden=new g,this.refDocsRendered=new g,this.datasheetChanged=new g,this.toggleEditBtnClicked=new g,this.siteSelector=null,b.uiHelper.attachTemplates(b,v,w),this.refDocService=Object.resolve(E),this.isStateTransitionDisabled=c.observable(!1),this.loadingPromises=[],this.isReferenceDocument=!1}var J=Object.inherit(d,I);I.dependsOn=[f],I.prototype.setErrorMessageForDate=function(a){for(var b=this.entityReference.fields.length,c=0;c<b;c++)a.id()===this.entityReference.fields.models[c].id&&(this.entityReference.fields.models[c].attributes.errorMessage=this.translator.translate("FORMAT_IS_NOT_VALID"),
a.errorMessage(this.translator.translate("FORMAT_IS_NOT_VALID")))},I.prototype.clearErrorMessageForDate=function(a){for(var b=this.entityReference.fields.length,c=0;c<b;c++)a.id()===this.entityReference.fields.models[c].id&&(this.entityReference.fields.models[c].attributes.errorMessage="",a.errorMessage(""))},I.prototype.onControlTouched=function(a){return this.fieldTouched.raise(a.id()),!0},I.prototype.attach=function c(d,e){if(d.element){if(J.prototype.attach.call(this,d),this.region=d,e){var f=this.scrollEl=b(e);f.on("scroll.ds",a.debounce(K.bind(null,this,d,f),100)),this.collapsibleChangeEventHandler=a.defer.bind(a,K.bind(null,this,d,f))}else this.collapsibleChangeEventHandler=a.defer.bind(a,this.uiHelper.handleNavAppearance.bind(null,this,d));b("mi-collapsible").on("change.ds",this.collapsibleChangeEventHandler)}};function K(a,b,c){a.uiHelper.handleNavAppearance(a,b),a.uiHelper.handleStickyHeader(a,b,c)}I.prototype.onLayoutChanged=function a(){var b=this
;b.uiHelper.handleHeaderHeight(b,b.region),b.uiHelper.handleNavAppearance(b)},I.prototype.detach=function a(c){J.prototype.detach.call(this,c),sa(this),this.scrollEl&&this.scrollEl.off("scroll.ds"),b("mi-collapsible")&&b("mi-collapsible").length&&b("mi-collapsible").off("change.ds",this.collapsibleChangeEventHandler)},I.prototype.handleNavAppearance=function a(){var b=this;b.uiHelper.handleNavAppearance(b),b.region&&b.scrollEl&&(b.uiHelper.handleStickyHeader(b,b.region,b.scrollEl),b.uiHelper.handleHeaderHeight(b,b.region))},I.prototype.translate=function a(b){return this.translator.translate(b)},I.prototype.setTitle=function a(b){this.title(b)},I.prototype.handleSiteChange=function a(b,c){b.onSiteChange.raise(c.originalEvent.detail.value)},I.prototype.print=function a(){D.retrieveFamilyReports(this.cachedFamilykey).then(xa.bind(null,this))},I.prototype.saveDatasheet=function a(){var b=this;b.datasheetSaved.raise(b.refDocPathModel)},I.prototype.newDatasheet=function a(){
this.datasheetNew.raise()},I.prototype.deleteDatasheet=function a(){this.datasheetDelete.raise()},I.prototype.showRefDocs=function a(b){var c=this;c.refDocHelper.showRefDocs(c,b)},I.prototype.hideRefDocs=function(a,b){var c=this;c.refDocHelper.hideRefDocs(c,a,b)},I.prototype.downloadRefdoc=function(a,b){b&&b.preventDefault();var c=this;return c.refDocHelper.downloadRefDoc(c,c.currentEntyKey(),b),!1},I.prototype.uncDownloadRefDoc=function a(b,c){var d=this;c&&c.preventDefault(),d.entityFactory.hasRefDocServerCredentials().done(U.bind(null,d,b)).fail(W.bind(null,d))},I.prototype.updateRefDocView=function(a){this.showRefDocs(a)},I.prototype.showJSModule=function a(b,c,d,e,f,g,h){var i={key:b,jsModuleName:c,jsModuleParams:d,jsModuleUseApply:h,type:"form"};this.jsModuleHelper.showJSModule(this,i)},I.prototype.callOnFocus=function a(b,c,d,e,f,g){var h={key:b,entityKey:c,clientID:d,jsModuleName:e,jsModuleParams:f,popJSModuleOnFocus:g,type:"form"};this.jsModuleHelper.callOnFocus(this,h)},
I.prototype.showHistory=function a(){this.datasheetHistory.raise()},I.prototype.onBeforeStateChanged=function(a,b){this.beforeStateTransition.raise(a,b)},I.prototype.onAfterStateChanged=function(a,b){this.onStateTransition.raise(a,b)},I.prototype.copyDatasheet=function a(){var b=this.currentEntity().fieldValues();j.setData(this.cachedFamilykey,b)},I.prototype.pasteDatasheet=function a(){var b=j.getData(),c=b.fieldValues,d;if(b.familykey.toString()===this.cachedFamilykey.toString())for(d=0;d<c.length;d++)this.updateFieldValue(c[d].key,c[d].value,c[d].values,c[d].displayValue,c[d].picklist,c[d].isDisabled,c[d].required,c[d].hidden,c[d].errorMessage,c[d].backColor,c[d].maxNumberOfValues,!1)},I.prototype.showTextEditor=function a(b,c){var d=this,e=b.fieldValue().showTextEditor.call(b,d.isDatasheetReadOnly());return e.onSave.add(function a(){}),e.onClose.add(function a(){}),e},I.prototype.setCachedFamilyKey=function a(b){this.cachedFamilykey=b},I.prototype.setCurrentEntity=function a(b){
L(this,b),la(this),this.currentEntity().fieldValueChanged.add(fa.bind(null,this))},I.prototype.showUOMConversionTool=function a(b,c){b.uomConversion=Object.resolve(F),b.uomConversion.show(c)};function L(a,b){var c=b.length,d,e=[],f;for(d=0;d!==c;d++)e.push(new h(b[d].fieldKey,b[d].fieldId,b[d].fieldValue,b[d].fieldDisplayValue,{required:b[d].options.required,disabled:b[d].options.disabled,isHtmlField:b[d].options.isHtmlField,unitOfMeasure:b[d].options.unitOfMeasure,unitOfMeasureKey:b[d].options.unitOfMeasureKey,picklist:b[d].options.picklist,backColor:b[d].options.backColor,jsModuleName:b[d].options.jsModuleName,jsModuleParams:b[d].options.jsModuleParams,jsModuleUseApply:b[d].options.jsModuleUseApply,popJSModuleOnFocus:b[d].options.popJSModuleOnFocus,addParseValueParam:b[d].options.addParseValueParam,dependentFields:b[d].options.dependentFields,isPicklistRestricted:b[d].options.isPicklistRestricted,maxNumberOfValues:b[d].options.maxNumberOfValues,values:b[d].options.values,
helpText:b[d].options.helpText,format:b[d].options.format,dbLength:b[d].options.dbLength,behaviors:b[d].options.behaviors,hidden:b[d].options.hidden}));f=new i(e),a.currentEntity(f)}I.prototype.showDatasheet=function a(c,d,e,f){var g=this,h=b.Deferred(),i=b.Deferred(),j,k,l;return e?g.cachedFieldValues=e:e=g.cachedFieldValues,d?g.cachedFamilykey=d:d=g.cachedFamilykey,g.assocFamilykey(d),f&&(g.entityReference=f,g.currentEntyKey(f.key)),sa(g),l=h.then(function(){var a=g.datasheetService.getDatasheets(d);return g.loadingPromises&&g.loadingPromises.push(a),a}).then(function(a){if(0===a.length||g.uiHelper.isAllDatasheetsHidden(a))return void g.throwException(g.translate("DS_DATASHEET_NOT_CONFIGURED_MESSAGE"));N(g,c,a)}),j=l.then(function(){var a;return void 0!==c&&g.currentDatasheetKey&&g.currentDatasheetKey()?(a=g.datasheetService.getDatasheet(g.currentDatasheetKey(),"False"),g.loadingPromises&&g.loadingPromises.push(a),
a):g.currentDatasheetKey&&g.currentDatasheetKey()?(a=g.datasheetService.getDatasheet(g.currentDatasheetKey()),g.loadingPromises&&g.loadingPromises.push(a),a):void 0}).then(function(a){a&&(da(g,a),O(g,a),ga(g))}),k=j.then(function(){if(g.currentDatasheet&&g.currentDatasheet()){var a=g.datasheetService.getFieldInfo(g.currentDatasheet().familyKey());return g.loadingPromises&&g.loadingPromises.push(a),a}}).then(function(a){try{return ea(g,a)}catch(a){}}).done(function(a){if(!a)return void i.resolve();try{P(g,i,e)}catch(a){console.error(a)}}).fail(function(a){"abort"===a?i.reject(a):(g.throwException(g.translate("DS_LOAD_DATASHEET_FAIL_EXCEPTION")),i.reject())}),h.resolve(),i},I.prototype.abortLoadingPromises=function a(){var b,c=this;for(b=0;b<c.loadingPromises.length;b++)M(c.loadingPromises[b]);c.loadingPromises=null};function M(a){a.request.abort()}function N(a,b,c){try{var d=0,e=!1;if(void 0!==b&&"string"==typeof b)for(d=0;d<c.length;d++)if(c[d].id===b){b=c[d].key;break}
for(d=0;d<c.length;d++)c[d].isHidden||(a.datasheets.push(c[d]),a.datasheetKeys.push({key:c[d].key,caption:c[d].caption,id:c[d].id}),c[d].lastViewed===!0?(a.currentDatasheetKey(b||c[d].key),e=!0):c[d].isDefault===!0&&(a.currentDatasheetKey(b||c[d].key),e=!0));e||(a.currentDatasheetKey(b||c[0].key),e=!0),a.previousDatasheetKey(a.currentDatasheetKey())}catch(a){}}function O(b,c){if(b.currentDatasheet().isMasterDetail()){var d=a.find(b.datasheetKeys(),function(a){return c.customFormParameters["master Family Datasheet ID"]===a.id});if(d&&d.key)return void b.onMasterDetail.raise(b.currentDatasheetKey(),c,d.key,b.datasheetKeys())}}function P(a,b,c){a.attachEntityToLayout(c).done(function(){ia(a),la(a),qa(a),a.kom.subscribe(a.currentDatasheetKey,Q.bind(null,a)),a.calculateTabWidth(),a.calculateContainerWidth(),a.uiHelper.handleNavAppearance(a,a.region),b.resolve()})}function Q(a){if(a.proceed===!1)return void(a.proceed=!0);a.datasheetChanged.raise()}
I.prototype.executeDatasheetChanged=function c(d,e){var f=b.Deferred(),g=b.Deferred(),h,i,j,k=this;return j=e?e:k.cachedFieldValues,k.isDatasheetRendered(!1),sa(k),h=f.then(function(){if(da(k,d),k.currentDatasheet().isMasterDetail()){var b=a.find(k.datasheetKeys(),function(a){return d.customFormParameters["master Family Datasheet ID"]==a.id});if(b&&b.key)return void k.onMasterDetail.raise(k.currentDatasheetKey(),d,b.key,k.datasheetKeys())}ga(k)}),i=h.then(function(){return k.datasheetService.getFieldInfo(k.currentDatasheet().familyKey())}).then(function(a){try{ea(k,a)}catch(a){}}).done(function(){try{k.attachEntityToLayout(j).done(function(){ia(k),la(k),qa(k),k.uiHelper.setOverlay(k),g.resolve()})}catch(a){}}).fail(function(){k.throwException(k.translate("DS_LOAD_DATASHEET_FAIL_EXCEPTION")),g.reject()}),f.resolve(),g},I.prototype.throwException=function a(b){var c=new B(1,b,"platform/datasheets/layout/ui/datasheet-view-model.js");this.appEvents.errorOccured.raise(this,c)},
I.prototype.attachEntityToLayout=function a(c){var d=b.Deferred();return L(this,c),d.resolve(),d},I.prototype.updateFieldValue=function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=0,w=0,x=[],y=null,z=this;if(this.currentEntity&&this.currentEntity()&&(x=this.currentEntity().fieldValues()),s&&null!==m)for(v=0;v!==x.length;v++){for(w=0;w!==m.length;w++)x[v].key().toString()===m[w].toString()&&x[v].clientDisabled(!1);x[v].key().toString()===b.toString()&&x[v].clientDisabled(!1)}for(v=0;v!==x.length;v++){if(x[v].key().toString()===b.toString()){y=x[v];break}x[v].changedFromView(!0)}R(z,y,{newValue:c,newValues:d,newDisplayValue:e,picklist:f,isDisabled:g,isRequired:h,isHidden:i,errorMessage:j,backColor:k,maxNumberOfValues:l,jsModuleName:n,jsModuleParams:o,popJSModuleOnFocus:p,addParseValueParam:q,stopPropagate:s,format:r,successMessage:t},u)};function R(b,c,d,e){if(c){if(d.stopPropagate&&c.changedFromView(!1),c.value(d.newValue),a.isEqual(c.values(),d.newValues)||(c.values(d.newValues),
c._values(d.newValues)),c.dateSubscription&&(c.dateValue(d.newValue),c.handleDateFormat(d.format)),d.newDisplayValue&&d.newDisplayValue.toString().indexOf("&parseValue=true")>-1){var f=d.newDisplayValue.toString().substring(0,d.newDisplayValue.toString().indexOf("&parseValue=true"));b.isReferenceDocument&&"MIRD_DOC_PATH_CHR"===c.id()?Y(b,c,f):c.displayValue(f)}else b.isReferenceDocument&&"MIRD_DOC_PATH_CHR"===c.id()?b.isReferenceDocument&&"MIRD_DOC_PATH_CHR"===c.id()&&Z(c,e):c.displayValue(d.newDisplayValue);c.disabled(d.isDisabled),c.required(d.isRequired),c.hidden(d.isHidden),c.layoutElement&&c.layoutElement.isHidden&&c.layoutElement.isHidden(d.isHidden),c.errorMessage(d.errorMessage),c.backColor(d.backColor),c.maxNumberOfValues(d.maxNumberOfValues),c.successMessage(d.successMessage),void 0!==c.jsModuleName&&c.jsModuleName()&&null!==c.jsModuleName()&&c.jsModuleName(d.jsModuleName),
void 0!==c.jsModuleParams&&c.jsModuleParams()&&null!==c.jsModuleParams()&&c.jsModuleParams(d.jsModuleParams),void 0!==c.popJSModuleOnFocus&&c.popJSModuleOnFocus()&&null!==c.popJSModuleOnFocus()&&c.popJSModuleOnFocus(d.popJSModuleOnFocus),void 0!==c.picklist&&c.picklist(c.createPickList(d.picklist)),c.changedFromView(!0)}}function S(a,b){b&&b.preventDefault(),a.refDocHelper.downloadRefDoc(a,a.currentEntyKey(),b)}function T(a,b,c){c&&c.preventDefault(),a.entityFactory.hasRefDocServerCredentials().done(U.bind(null,a,b)).fail(W.bind(null,a))}function U(a,b,c){var d=new H({closeButton:!0,timeOut:"200",hideDuration:"200"});c===!0?a.refDocService.openRefDoc(a.currentEntyKey(),b).fail(X.bind(null,a,d)):V(a,d)}function V(a,b){b.error({message:a.translate("REFDOCSERVER_NO_CREDENTIALS")},a.translate("DS_REFERENCE_DOCS_TITLE"))}function W(a){new H({closeButton:!0,timeOut:"200",hideDuration:"200"}).error({message:a.translate("REFDOCSERVER_FAILED_CREDENTIALS")
},a.translate("DS_REFERENCE_DOCS_TITLE"))}function X(a,b){b.error({message:a.translate("REFDOCS_FAILED_TO_OPEN_DOCUMENT")},a.translate("DS_REFERENCE_DOCS_TITLE"))}function Y(a,c,d){var e;try{e=JSON.parse(d)}catch(a){e=null}if(e&&e.path)if(e.isStored)c.displayValue('<a href="#" id="ref-doc-download-link">'+e.path+"</a>"),b("#ref-doc-download-link").on("click",S.bind(null,a));else if(!e.isStored&&e.path.startsWith("\\")){c.displayValue('<a href="#" id="ref-doc-unc-link">'+e.path+"</a>");var f={type:"UNC",documentPath:e.path};b("#ref-doc-unc-link").on("click",T.bind(null,a,f))}else c.displayValue('<a href="'+e.path+'" target="tab">'+e.path+"</a>")}function Z(a,b){if(a.layoutElement){var c=a.layoutElement.elementCss(),d="inactiveHyperlink",e="";b===!0?c.indexOf(d)===-1&&(e=c+" "+d,a.layoutElement.elementCss(e)):b===!1&&(e=a.layoutElement.elementCss().replace(d,""),a.layoutElement.elementCss(e))}}I.prototype.dispose=function a(){this.currentEntity()&&this.currentEntity().dispose(),
this.layoutRendered.remove(),this.entityRendered.remove()};function $(a,b){a.oldEntity=b}function _(a,b){a.oldValue&&a.oldValue.dispose(),b.fieldValueChanged.add(fa.bind(null,a)),a.currentEntityChanged.raise(b,a.oldEntity)}function aa(a){var b=0,c;for(a.isDatasheetReadOnly()===!0&&(a.isSelectedSiteViewOnly(!0),a.isStateTransitionDisabled(!0)),b=0;b!==a.layoutElements().length;b++)c=a.layoutElements()[b],ra(a,c)}function ba(a,b){void 0!==b&&null!==b&&""!==b&&(a.siteSelector=a.region.$element.find("mi-site-selector")[0],Element.upgrade(a.siteSelector),a.siteSelector&&a.siteSelector.selectSiteByAssetKey(b))}function ca(a){if(a&&a.region&&a.region.$element){var b=a.region.$element.find("mi-site-selector");if(b.length){a.siteSelector=b[0],Element.upgrade(a.siteSelector);var c=a.siteSelector.isSiteViewOnly;c&&(a.isSelectedSiteViewOnly(c),a.isSaveAvailable(!1),a.isDeleteAvailable(!1))}}}I.prototype.afterLoad=function a(){ca(this)},I.prototype.toggleEdit=function a(){
this.isDatasheetReadOnly(!this.isDatasheetReadOnly()),this.showEditButton(!1),this.isSelectedSiteViewOnly(this.siteSelector.isSiteViewOnly),this.isStateTransitionDisabled(!1),this.toggleEditBtnClicked.raise()},I.prototype.toggleHelpText=function a(){this.helpTextModeOn(!this.helpTextModeOn()),this.helpTextModeOn()===!0?this.helpButtonText(this.translate("DS_TURN_OFF_HELPTEXT")):this.helpButtonText(this.translate("DS_TURN_ON_HELPTEXT"))};function da(a,b){var c=k.toModelObject(b);a.currentDatasheet(c)}function ea(a,c){if(c){var d=b.map(c,function(a){return m.toModelObject(a)});a.fieldInfos(d)}return c}function fa(a,b,c,d,e,f,g,h){var i=0,j=0,k=[];for(a.currentEntity()&&(k=a.currentEntity().fieldValues()),i=0;i!==k.length;i++){for(j=0;j!==g.length;j++)k[i].key()===g[j]&&k[i].clientDisabled(!0);k[i].key()!==c||k[i].dateValue()||null===k[i].dateValue()||k[i].clientDisabled(!0)}a.fieldValueChanged.raise(b,c,d,e,h)}function ga(a){var c=b.map(a.currentDatasheet().layout.elements(),function(b){
return new e(b,a.isReadOnly())});a.layoutElements(c),a.uiHelper.attachTabClickHandlers(a),ha(a)}function ha(a){var b=j.getData();b&&a.cachedFamilykey.toString()===b.familykey.toString()&&(a.isReadOnly()||j.isEmpty()||a.canPaste(!1))}function ia(a){var b=0,c;for(b=0;b!==a.layoutElements().length;b++)c=a.layoutElements()[b],ja(a,c)}function ja(a,b){var c=0,d,e;if("0"===b.controlName().toString())d="Empty";else for(c=0;c!==a.fieldInfos().length;c++)if(a.fieldInfos()[c].fieldId===b.controlName()){d=a.fieldInfos()[c].inputType;break}for(ka(a,b,d),b.controlTemplate(u[d]||null),ra(a,b),c=0;c!==b.children().length;c++)e=b.children()[c],ja(a,e)}function ka(a,b,c){for(var d,e=0;e!==a.currentEntity().fieldValues().length;e++)a.currentEntity().fieldValues()[e].id().toString()===b.controlName().toString()&&(d=a.currentEntity().fieldValues()[e],d.inputType(c),b.fieldValue(d))}function la(a){var b=0,c;for(b=0;b!==a.layoutElements().length;b++)c=a.layoutElements()[b],ma(a,c);a.entityRendered.raise()}
function ma(a,b){var c=0,d,e;for(na(a,b),c=0;c!==b.children().length;c++)e=b.children()[c],ma(a,e)}function na(a,b){var c=0,d;if("0"===b.controlName().toString())b.controlTemplate(u.Empty);else for(c=0;c!==a.currentEntity().fieldValues().length;c++)if(a.currentEntity().fieldValues()[c].id().toString()===b.controlName().toString()){oa(a.currentEntity().fieldValues()[c],b),a.currentEntity().fieldValues()[c].isMaskedField===!0?(b.controlTemplate(u.MaskedTextBox),a.currentEntity().fieldValues()[c].inputType("MaskedTextBox")):void 0===a.currentEntity().fieldValues()[c].picklist||a.currentEntity().fieldValues()[c].isPicklistRestricted()?void 0!==a.currentEntity().fieldValues()[c].picklist?(b.controlTemplate(u.ComboBox),a.currentEntity().fieldValues()[c].inputType("ComboBox")):parseInt(a.currentEntity().fieldValues()[c].maxNumberOfValues())>1?(b.controlTemplate(u.MultiText),
a.currentEntity().fieldValues()[c].inputType("MultiText")):(!pa(a.currentEntity().fieldValues()[c].displayValue())&&a.currentEntity().fieldValues()[c].displayValue().indexOf("href")>0||a.currentEntity().fieldValues()[c].isHtmlField()||a.isReferenceDocument&&"MIRD_DOC_PATH_CHR"===a.currentEntity().fieldValues()[c].id().toString())&&a.currentEntity().fieldValues()[c].isCleanHref()?(b.controlTemplate(u.Hyperlink),a.currentEntity().fieldValues()[c].inputType("Hyperlink")):"-1"!==a.currentEntity().fieldValues()[c].uomKey()&&(b.controlTemplate(u.UOMTextbox),a.currentEntity().fieldValues()[c].inputType("UOMTextbox")):(b.controlTemplate(u.MultiValue),a.currentEntity().fieldValues()[c].inputType("MultiValue")),b.controlTemplate()===u.Date&&a.currentEntity().fieldValues()[c].handleDate();break}}function oa(a,b){a.layoutElement=b,a.layoutElement.isHidden(a.hidden())}function pa(a){return/<a href=(|'|")#datasheet-dialog.*<\/a>/.test(a)}function qa(a){if(a.layoutRendered.raise(),
a.isDatasheetRendered(!0),a.uiHelper.addMoreOptionsForIcons(a,".form-ds-iconbar","form"),a&&a.region&&a.region.$element){var b=a.region.$element.find("mi-site-selector");if(b.length){a.siteSelector=b[0],Element.upgrade(a.siteSelector),"0"===a.siteKey()&&0===a.currentEntyKey()&&a.showSiteSelector()&&a.siteSelector.selectDefaultSite();var c=a.siteSelector.isSiteViewOnly;c&&(a.isSelectedSiteViewOnly(c),a.isSaveAvailable(!1),a.isDeleteAvailable(!1))}}}function ra(a,b){a.isDatasheetReadOnly()===!0?(a.uiHelper.setOverlay(a),b.elementCss("form-control-readonly"),b.headerCss("ds-group-header-disabled")):(b.elementCss("form-control"),b.headerCss("ds-group-header-enabled"))}I.prototype.setTabsOptions=function a(){var c=this,d=b.Deferred();return d=c.uiHelper.setTabsOptions(c,d)};function sa(a){a.region&&a.region.$element.find('[data-toggle="tab"], [data-toggle="pill"]').each(function(a,c){b(c).off("click")})}I.prototype.deallocateMem=function a(){!!this.kom&&this.kom.dispose(),
this.cachedFieldValues=null,this.translator=null,this.layoutElements=null,this.currentDatasheet=null,this.fieldInfos=null,this.iconsMoreOptions&&(this.iconsMoreOptions=null),this.datasheets=null,this.appEvents=null,this.isDatasheetRendered=null,this.datasheetKeys=null,this.isDatasheetReadOnly=null,this.currentDatasheetKey=null,this.isMasterDatasheet=null,this.isBulkDatasheet=null,this.helpTextModeOn=null,this.tabWidth=null,this.currentEntity&&this.currentEntity()&&this.currentEntity().dispose(),this.currentEntity=null,this.overlayHeight=null,this.overlayTop=null,this.canEdit=null,this.containerWidth=null,this.isReadOnly=null,this.isRefDocRendered=null,this.isRootRecordAvailable=null,this.isSaveAvailable=null,this.isSiteFiltered=null,this.showDatasheetSelection=null,this.showEditButton=null,this.showStateManagement=null,this.title=null,this.iconOptions=null,this.showTabScroll=null,this.currentEntyKey=null,this.isHistoryEnabled=null,
!!this.datasheetChanged&&this.datasheetChanged.remove(),!!this.datasheetHistory&&this.datasheetHistory.remove(),!!this.datasheetReference&&this.datasheetReference.remove(),!!this.refDocsRendered&&this.refDocsRendered.remove(),!!this.tabSwitched&&this.tabSwitched.remove(),this.canPaste=null,this.entityState=null,this.entykey=null,this.helpButtonText=null,this.hideMoreOptionsForIcons=null,this.isCopyAvailable=null,this.isDatasheetRenderedInRM=null,this.isDefaultHelpTextAvailable=null,this.isDeleteAvailable=null,this.isHistoryAvailable=null,this.isNewAvailable=null,this.isNewEntityCreated=null,this.isPasteEnabled=null,this.isRefDocEnabled=null,this.refDocCount=null,this.isReferencesAvailable=null,this.isUnlinkRecordAvailable=null,this.isUnlinkRecordEnabled=null,this.previousDatasheetKey=null,this.siteKey=null,!!this.beforeStateTransition&&this.beforeStateTransition.remove(),!!this.changeCanPaste&&this.changeCanPaste.remove(),!!this.currentEntityChanged&&this.currentEntityChanged.remove(),
!!this.datasheetDelete&&this.datasheetDelete.remove(),!!this.datasheetNew&&this.datasheetNew.remove(),!!this.datasheetSaved&&this.datasheetSaved.remove(),this.datasheetService=null,!!this.entityRendered&&this.entityRendered.remove(),!!this.fieldValueChanged&&this.fieldValueChanged.remove(),!!this.layoutRendered&&this.layoutRendered.remove(),!!this.onMasterDetail&&this.onMasterDetail.remove(),!!this.onStateTransition&&this.onStateTransition.remove(),!!this.refDocsHidden&&this.refDocsHidden.remove(),this.subscriptions=null,this.exportService=null,j.onChange.remove(this),this.assetContextKey=null,this.beforeStateTransition=null,this.cachedFamilykey=null,this.changeCanPaste=null,this.currentEntityChanged=null,this.datasheetChanged=null,this.datasheetDelete=null,this.datasheetHistory=null,this.datasheetNew=null,this.datasheetReference=null,this.datasheetSaved=null,this.entityReference=null,this.entityRendered=null,this.fieldValueChanged=null,this.kom=null,this.layoutRendered=null,
this.makeRootRecordEvent=null,this.onMasterDetail=null,this.onStateTransition=null,this.refDocsHidden=null,this.tabSwitched=null,this.unlinkRecordEvent=null,this.util=null,this.refDocsRendered=null,this.view=null,this.refDocPathModel=null,this.teamModel=null,this.siteSelector=null,this.oldEntity=null,this.assocFamilykey=null,this.assocDisabled=null,this.tabsMoreOptions&&(this.tabsMoreOptions=null),this.tabContainer&&(this.tabContainer=null),this.tabs&&(this.tabs=null),this.tabWidths&&(this.tabWidths=null),this.tabVms&&(this.tabVms=null),this.alternativeTabsContainer&&(this.alternativeTabsContainer=null),this.moreOptions&&(this.moreOptions=null),this.tabContainerContext&&(this.tabContainerContext=null),this.refdocEl&&(this.refdocEl=null),ta(this),this.region=null,this.refDocService=null,this.isStateTransitionDisabled=null,this.toggleEditBtnClicked=null,this.datasheetNavWidth=null,
this.appEvents&&this.appEvents.windowResized&&this.handleNavAppearance&&this.appEvents.windowResized.remove(this.handleNavAppearance,this)};function ta(a){if(a.region&&a.region.$element){var b=a.region.$element.find("mi-more-options-noko"),c;for(c=0;c<b.length;c++)"function"==typeof b[c].deallocateMem&&b[c].deallocateMem()}}I.prototype.onChangingClipboardData=function a(){var b=this;ha(b),b.changeCanPaste.raise(b.canPaste())},I.prototype.calculateTabWidth=function(){var a=this;a.uiHelper.calculateTabWidth(a)},I.prototype.calculateContainerWidth=function(){var a=this;a.uiHelper.calculateContainerWidth(a)};function ua(a){return a.tabWidth()>a.containerWidth()}I.prototype.makeRootRecord=function a(){this.recordManagerHelper.makeRootRecord()},I.prototype.unlinkRecord=function a(){this.recordManagerHelper.unlinkRecord()},I.prototype.addMoreOptionsForIcons=function a(){this.uiHelper.addMoreOptionsForIcons(this,".form-ds-iconbar","form")},I.prototype.setIconOptions=function a(){
var c=b.Deferred();return c=this.uiHelper.setIconOptions(this,"form")},I.prototype.setErrorAndReturnErrorFlag=function a(b){var c=this,d=!1;return this.util.clearAllErrorNotifications(b),d=this.util.setErrorAndReturnErrorFlag("form",b)},I.prototype.removeDOMElements=function a(c){var d=this;(c?b("."+c):d.region.$element).find("*").each(function(a,c){b.event.remove(c),b.removeData(c),wa(c)})};function va(a){a.isMasterDatasheet()&&a.region.$element.find(".datasheet-disabled-overlay").css("display","none")}function wa(a){var c=a.childNodes;if(c)for(var d=!1;!d;){for(var e=c.length,f=0;f<e;f+=1){var g=c[f];if(0===g.childNodes.length){b.event.remove(g),a.removeChild(g),d=!0;break}wa(g)}if(!d)break;d=!1}}function xa(a,b){a.printHelper.print(a,"form",b)}return I});

define('text!platform/datasheets/layout/ui/views/datasheetReference.html',[],function () { return '<div class="datasheetRefContainer">\r\n    <div class="row">\r\n        <button class="datasheetRefAddNew btn btn-primary pull-right" data-bind="click:addNewRef">Add</button>\r\n    </div>\r\n    <div class="row">\r\n        <div class="col-md-4">\r\n\r\n            <div class="list-group datasheetRefList" data-bind="foreach: references">\r\n\r\n                <div class="list-group-item" data-bind="text: $data.caption, click:function(){$parent.selectRef($data);}"></div>\r\n\r\n            </div>\r\n\r\n        </div>\r\n        <div class="col-md-8 dataReferenceInfo" data-bind="visible:isSelected">\r\n            <p><strong data-bind="text: selectedRef.caption"></strong> </p>\r\n            <div class="detailsView"></div>\r\n        </div>\r\n    </div>\r\n</div>';});

define('platform/datasheets/layout/ui/datasheet-reference-view-model',['require','knockout','spa/ko/knockout-view-model','system/lang/event','text!./views/datasheetReference.html'],function(require){"use strict";var a=require("knockout"),b=require("spa/ko/knockout-view-model"),c=require("system/lang/event"),d=require("text!./views/datasheetReference.html");function e(b){this.contentEl=d,f.call(this,this.contentEl),this.region=null,this.entityKey=b,this.references=a.observableArray(),this.newReference=new c,this.isSelected=a.observable(!1),this.selectedRef=a.mapping.fromJS({caption:null})}var f=Object.inherit(b,e);return e.prototype.attach=function a(b){f.prototype.attach.call(this,b),this.region=b},e.prototype.addNewRef=function a(){console.log("adding new reference")},e.prototype.selectRef=function b(c){a.mapping.fromJS(c,this.selectedRef)},e.prototype.loadReferences=function a(b){this.renderRefs(b)},e.prototype.renderRefs=function b(c){var d;for(d=0;d<c.length;d++)this.references.push(c[d]);a.mapping.fromJS(this.references()[0],this.selectedRef),this.isSelected(!0)},e});

define('text!platform/datasheets/layout/ui/views/DSFieldHistory.html',[],function () { return '<div class="datasheet-field-history" style="font-size:12px; height:100%;overflow:hidden;">\r\n    <div data-bind="visible: isAuthenticationEnabled" class="block-group auth-div-group">\r\n        <div class="block auth-div"><span data-bind="text: $root.translate(\'DS_AUTH_BY\') + \': \'"></span><span data-bind="text: createdBy"></span></div>\r\n        <div class="block auth-div"><span data-bind="text: $root.translate(\'DS_AUTH_DATE\') + \': \'"></span><span data-bind="text: createdDate"></span></div>\r\n    </div>\r\n    <div style="height: calc( 100% - 100px); overflow:auto;" class="table-responsive">\r\n        <table class="table table-bordered" data-bind="visible:FieldHistoryDTOs().length">\r\n            <thead style="background:#fff;">\r\n                <tr>\r\n                    <th class="sortable" data-bind="sort: { arr: FieldHistoryDTOs, prop: \'fieldCaption\'}, text: $root.translate(\'DS_FIELD\')"></th>\r\n                    <th class="sortable" data-bind="sort: { arr: FieldHistoryDTOs, prop: \'updateDate\' }, text: $root.translate(\'DS_CHANGED_ON\')"></th>\r\n                    <th class="sortable" data-bind="sort: { arr: FieldHistoryDTOs, prop: \'updateUser\' }, text: $root.translate(\'DS_CHANGED_BY\')"></th>\r\n                    <th data-bind="text: $root.translate(\'DS_NEW_VALUE\')"></th>\r\n                    <th data-bind="text: $root.translate(\'DS_PREVIOUS_VALUE\')"></th>\r\n                </tr>\r\n            </thead>\r\n            <tbody data-bind="foreach:FieldHistoryDTOs">\r\n                <tr>\r\n                    <td data-bind="text:$data.fieldCaption"></td>\r\n                    <td data-bind="text:$data.updateDate"></td>\r\n                    <td data-bind="text:$data.updateUser"></td>\r\n                    <td data-bind="text:$data.formattedNewValue"></td>\r\n                    <td data-bind="text:$data.formattedOldValue"></td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n    <div class="" style="height:50px;">\r\n        <button class="btn btn-primary pull-right" data-bind="click:closeHistory.bind($root), text: $root.translate(\'DS_CLOSE\')"></button>\r\n    </div>\r\n</div>';});

define('platform/datasheets/layout/services/manager-service',['require','jquery','system/http/ajax-client','security/services/user-dto'],function(require){"use strict";var a=require("jquery"),b=require("system/http/ajax-client"),c="api/core/security",d=require("security/services/user-dto");function e(a){this.ajaxClient=a}return e.dependsOn=[b],e.prototype.getUserFull=function(){var b=a.Deferred();return this.ajaxClient.get(c+"/sessionuser",{}).done(function(a){b.resolve(new d(a))}).fail(function(a){b.reject(a)}),b.promise()},e.prototype.getUserByKey=function(b){var e=a.Deferred();return this.ajaxClient.get(c+"/user/"+b).done(function(a){e.resolve(new d(a))}).fail(function(a){e.reject(a)}),e.promise()},e.prototype.login=function(b,d,e){var f=a.Deferred();return this.ajaxClient.post(c+"/login",{DatasourceId:b,Id:d,Password:e}).done(function(a){f.resolve(a)}).fail(function(a){a.preventSessionTimeoutDefault=!0,f.reject(a)}),f.promise()},e});
define('platform/datasheets/layout/ui/datasheet-history-view-model',['require','knockout','spa/ko/knockout-view-model','text!./views/DSFieldHistory.html','system/globalization/translator','platform/datasheets/layout/services/manager-service','application/application-context','moment','system/knockout/knockout-helpers'],function(require){"use strict";var a=require("knockout"),b=require("spa/ko/knockout-view-model"),c=require("text!./views/DSFieldHistory.html"),d=require("system/globalization/translator"),e=require("platform/datasheets/layout/services/manager-service"),f=require("application/application-context"),g=require("moment");require("system/knockout/knockout-helpers");function h(b){this.contentEl=c,i.call(this,this.contentEl),this.region=null,this.entity=null,this.dialog=null,this.entityKey=b,this.FieldHistoryDTOs=a.observableArray([]),this.translator=Object.resolve(d),this.managerService=Object.resolve(e),this.isAuthenticationEnabled=!1,this.createdBy=a.observable(),this.createdDate=a.observable(),this.dateFormat=a.observable(),f.user&&f.user.formats&&f.user.formats.dateTime&&this.dateFormat(f.user.formats.dateTime)}var i=Object.inherit(b,h);h.prototype.attach=function a(b,c){i.prototype.attach.call(this,b),this.region=b,this.entity=c},h.prototype.translate=function a(b){
return this.translator.translate(b)},h.prototype.loadHistory=function a(){var b=this,c;b.entity.getHistory().then(n.bind(null,b)),b.entity.isAuditable&&(b.isAuthenticationEnabled=!0,c=j(b,b.entity.createdDate),b.createdDate(c),b.managerService.getUserByKey(b.entity.createdBy).done(o.bind(null,b)))},h.prototype.setDialog=function a(b){this.dialog=b},h.prototype.closeHistory=function a(){this.dialog.closeDialog()};function j(a,b){return b?g(b).format(k(a.dateFormat())):b}function k(a){var b=a;return b=l("d","D",b),b=l("y","Y",b),b=l("h","H",b),b=l("tt","A",b)}function l(a,b,c){return c.replace(new RegExp(a,"g"),b)}function m(a,b){var c;for(c=0;c<a.length;c++)b.FieldHistoryDTOs.push(a[c])}function n(a,b){b.length?m(b,a):a.region.$element.find(".table-responsive").append(a.translate("DS_NO_HISTORY_AVAILABLE"))}function o(a,b){a.createdBy(b.displayName)}return h});

define('text!platform/datasheets/layout/ui/views/spinner.html',[],function () { return '<div class="load-spinner">\r\n    <span class="loading-med loading-active center-block"></span>\r\n</div>';});

define('system/ui/unsaved-changes-message-box',['require','jquery','system/ui/message-box','system/globalization/translator'],function(require){"use strict";var a=require("jquery"),b=require("system/ui/message-box"),c=Object.resolve(require("system/globalization/translator"));function d(){}return d.show=function d(){var e=a.Deferred(),f=c.translate("UNSAVED_CHANGES_MESSAGE")+" "+c.translate("UNSAVED_CHANGES_PROMPT"),g=c.translate("UNSAVED_CHANGES_TITLE");return b.showOkCancel(f,g).done(function(a){0===a?e.resolve():e.reject()}),e.promise()},d});

define('text!platform/datasheets/layout/ui/views/datasheet-authentication-dialog.html',[],function () { return '<div>\r\n    <div>\r\n        <div data-bind="text: $root.translate(\'DS_AUTH_USER_ID\')"></div>\r\n        <div><input type="text" class="form-control" data-bind="value: $root.userId" disabled /></div>\r\n        <br />\r\n        <div data-bind="text: $root.translate(\'DS_AUTH_PASSWORD\')"></div>\r\n        <div><input type="password" class="form-control" data-bind="value: $root.password, attr: {placeholder: $root.translate(\'DS_AUTH_PASSWORD_PLACEHOLDER\')}" /></div>\r\n    </div>\r\n    <br />\r\n    <br />\r\n    <div class="authentication-dialog-buttons-div">\r\n        <button data-bind="text: $root.translate(\'DS_AUTH_SAVE\'), click: saveClicked" class="btn authentication-dialog-save-btn"></button>\r\n        <button data-bind="text: $root.translate(\'DS_AUTH_CANCEL\'), click: cancelClicked" class="btn"></button>\r\n    </div>\r\n</div>';});

define('platform/datasheets/layout/ui/datasheet-authentication-dialog-view-model',['require','jquery','knockout','spa/ko/knockout-view-model','text!platform/datasheets/layout/ui/views/datasheet-authentication-dialog.html','system/globalization/translator','system/lang/event','platform/datasheets/layout/services/manager-service','system/ui/message-box'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("spa/ko/knockout-view-model"),d=require("text!platform/datasheets/layout/ui/views/datasheet-authentication-dialog.html"),e=require("system/globalization/translator"),f=require("system/lang/event"),g=require("platform/datasheets/layout/services/manager-service"),h=require("system/ui/message-box");function i(){var c=this;j.call(this,d),c.translator=Object.resolve(e),c.saveAllowed=new f,c.saveDenied=new f,c.saveCancelled=new f,c.password=b.observable(""),c.securityService=Object.resolve(g),c.userId=a.parseJSON(window.sessionStorage.getItem("meridium-session")).userId}var j=Object.inherit(c,i);i.prototype.translate=function a(b){return this.translator.translate(b)},i.prototype.saveClicked=function b(){var c=a.parseJSON(sessionStorage.getItem("meridium-session")).datasourceId,d=this
;if(""===d.password().trim())return void h.showOk(d.translate("DS_AUTH_PASSWORD_BLANK_MSG"),d.translate("DS_AUTH_FAILURE_DIALOG_TITLE"));d.securityService.login(c,d.userId,d.password()).done(k.bind(null,d)).fail(l.bind(null,d))},i.prototype.cancelClicked=function a(){this.saveCancelled.raise()};function k(a){a.saveAllowed.raise()}function l(a){a.saveDenied.raise()}return i});
define('platform/team-component/dto/member-dto',['require','mithril','system/lang/converter'],function(require){"use strict";var a=require("mithril"),b=require("system/lang/converter");function c(a){a=a||{},this.id=b.toString(a.id),this.entityKey=b.toString(a.key),this.firstName=b.toString(a.firstName),this.lastName=b.toString(a.lastName),this.jobTitle=b.toString(a.jobTitle),this.contentGuid=b.toString(a.contentGuid),this.email=b.toString(a.email),this.phoneNumber=b.toString(a.phoneNumber),this.hasPhoto=b.toString(a.hasPhoto),this.photoURL=b.toString(a.photoURL),this.areaOfResponsibility=b.toString(a.areaOfResponsibility),this.facility=b.toString(a.facility),this.modificationType=b.toString(a.modificationType),this.hrKey=b.toString(a.hrKey)}return c.fromDataCollection=function a(b){if(void 0===b||null===b)return[];var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e},c.prototype.PopulateHTML=function b(){var c="";return c+='<section class="content block-group"  data-key="'+this.entityKey+'">',c+='<div class="block col-10 icon-user">',
this.hasPhoto&&this.photoURL&&this.photoURL.length>0&&(c+='<img id="thumbnailPhoto" class="thumbnailPhoto" src="'+this.photoURL+'"/><br />',c+=this.id.toString()),c+="</div>",c+='<div class="block col-30"><b>',c+=this.lastName,this.firstName&&(c+=", "+this.firstName),c+="</b>",this.jobTitle&&(c+="<div>"+this.jobTitle.toString()+"</div>"),this.email&&(c+="<div>"+this.email.toString()+"</div>"),this.phoneNumber&&(c+="<div>"+this.phoneNumber.toString()+"</div>"),c+="</div>",c+="</section>",a.trust(c)},c});
define('platform/team-component/dto/team-dto',['require','mithril','system/lang/converter','application/application-context','./member-dto'],function(require){"use strict";var a=require("mithril"),b=require("system/lang/converter"),c=require("application/application-context"),d=require("./member-dto");function e(a){a=a||{},this.key=b.toString(a.key),this.id=b.toString(a.id),this.siteKey=b.toString(a.siteKey),this.members=f(a.teamMembers||a.members||[]),this.teamName=b.toString(a.id),this.modificationType=b.toString(a.modificationType)}e.prototype.PopulateHTML=function b(){var c="";return c+='<section class="content block-group"  data-key="'+this.key+'">',c+='<div class="block col-10 icon-resources">',this.hasPhoto&&this.photoURL&&this.photoURL.length>0&&(c+='<img id="thumbnailPhoto" class="thumbnailPhoto" src="'+this.photoURL+'"/><br />',c+=this.id.toString()),c+="</div>",c+='<a class="block col-30 team-name" style="color: #4A90E2; width: calc(100% - 170px)" data-bind="attr:{ href: ";rte=teams", title:  this.teamName  }" key='+this.key+">",c+=this.teamName,c+="</a>",
this.members&&this.members.length?(c+='<div class="block col-30 members-count-message" style="width: 100px; float:right;">'+this.members.length,c+=" Members</div>"):c+='<div class="block col-30 members-count-message" style="width: 100px; float:right;">0 Members</div>',c+="</section>",a.trust(c)},e.fromTeamCollection=function a(b){if(void 0===b||null===b)return[];var c,d=[];for(c=0;c<b.length;c++)d[d.length]=new e(b[c]);return d};function f(a){if(void 0===a||null===a)return[];var b,c=[];for(b=0;b<a.length;b++)c[c.length]=new d(a[b]);return c}return e});
define('platform/team-assignment-component/services/dto/team-member-dto',['require','mithril','system/lang/converter'],function(require){"use strict";var a=require("mithril"),b=require("system/lang/converter");function c(a){a=a||{},this.id=b.toString(a.id),this.entityKey=b.toString(a.key||a.entityKey),this.key=b.toString(a.key),this.hrKey=b.toString(a.hrKey),this.firstName=b.toString(a.firstName),this.lastName=b.toString(a.lastName),this.jobTitle=b.toString(a.jobTitle),this.contentGuid=b.toString(a.contentGuid),this.email=b.toString(a.email),this.phoneNumber=b.toString(a.phoneNumber),this.hasPhoto=b.toString(a.hasPhoto),this.photoURL=b.toString(a.photoURL),this.areaOfResponsibility=b.toString(a.areaOfResponsibility),this.facility=b.toString(a.facility),this.modificationType=b.toString(a.modificationType)}c.fromDataCollection=function a(b){if(void 0!==b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}},c.prototype.PopulateHTML=function b(){var c="";return c+='<section class="content block-group"  data-key="'+this.entityKey+'">',c+='<div class="block col-10">',
this.hasPhoto&&this.photoURL&&this.photoURL.length>0&&(c+='<img id="thumbnailPhoto" class="thumbnailPhoto" src="'+this.photoURL+'"/><br />',c+=this.id.toString()),c+="</div>",c+='<div class="block col-30"><div class="name">',c+=this.lastName,this.firstName&&(c+=", "+this.firstName),c+="</div>",this.jobTitle&&(c+="<div>"+this.jobTitle.toString()+"</div>"),this.email&&(c+="<div>"+this.email.toString()+"</div>"),this.phoneNumber&&(c+="<div>"+this.phoneNumber.toString()+"</div>"),c+="</div>",c+="</section>",a.trust(c)},c.fromMembersContextDTO=function a(b){return new c({entityKey:b.entityKey,id:b.description})};function d(a){var c,d=[];for(c=0;c<a.length;c++)d[c]=b.toInteger(a[c][0]);return d}return c.fromJson=function(a){var b=new c;return b.description=a.description||"",b.isComplete=a.isComplete||!1,b},c.prototype.toJson=function(){return{description:this.description,isComplete:this.isComplete}},c});
define('platform/team-assignment-component/services/dto/assignment-dto',['require','platform/team-component/dto/team-dto','./team-member-dto'],function(require){"use strict";var a=require("platform/team-component/dto/team-dto"),b=require("./team-member-dto");function c(a){a=a||{},this.teams=d(a.teams),this.teamMembers=e(a.teamMembers)}function d(b){if(void 0===b||null===b)return[];var c,d=[];for(c=0;c<b.length;c++)d[d.length]=new a(b[c]);return d}function e(a){if(void 0!==a){var c,d=[];for(c=0;c<a.length;c++)d[d.length]=new b(a[c]);return d}}return c});
define('platform/team-assignment-component/services/assignment-service',['require','jquery','system/http/ajax-client','./dto/assignment-dto'],function(require){"use strict";var a=require("jquery"),b=require("system/http/ajax-client"),c=require("./dto/assignment-dto"),d="api/core/teammember";function e(a){this.ajaxClient=a}return e.dependsOn=[b],e.prototype.SyncTeamMembersAndTeams=function b(e,f,g,h,i){var j=a.Deferred(),k={teamMembersAndTeamsDTO:g};return this.ajaxClient.post(d+"/syncmembersandteams/"+e+"/"+f+"/"+h+"/"+i,g).done(function(a){j.resolve(new c(a))}).fail(function(a){j.reject(a)}),j.promise()},e.prototype.GetTeamMembersAndTeams=function b(e,f,g,h){var i=a.Deferred();return this.ajaxClient.get(d+"/getmembersandteams/"+e+"/"+f+"/"+g+"/"+h).done(function(a){i.resolve(new c(a))}).fail(function(a){i.reject(a)}),i.promise()},e});
define('platform/datasheets/forms-datasheet-manager',['require','jquery','lodash','./layout/ui/datasheet-view-model','spa/region','../entity/entity-factory','./layout/ui/datasheet-reference-view-model','./layout/ui/datasheet-history-view-model','logging/feedback-component/feedback-component','system/ui/dialog-view-model','text!./layout/ui/views/spinner.html','system/lang/event','system/ui/message-box','system/ui/unsaved-changes-message-box','./layout/services/manager-service','system/globalization/translator','system/lang/converter','application/application-events','ui/elements/ref-doc/models/refdoc-path-model','system/error/error-message','platform/metadata/services/metadata','application/application-context','system/ui/busy-indicator','./error-dialog/ui/error-dialog-view-model','platform/datasheets/layout/ui/datasheet-authentication-dialog-view-model','system/hardware/device','platform/team-assignment-component/services/assignment-service','bluebird'],function(require){"use strict"
;var a=require("jquery"),b=require("lodash"),c=require("./layout/ui/datasheet-view-model"),d=require("spa/region"),e=require("../entity/entity-factory"),f=require("./layout/ui/datasheet-reference-view-model"),g=require("./layout/ui/datasheet-history-view-model"),h=require("logging/feedback-component/feedback-component"),i=require("system/ui/dialog-view-model"),j=require("text!./layout/ui/views/spinner.html"),k=require("system/lang/event"),l=require("system/ui/message-box"),m=require("system/ui/unsaved-changes-message-box"),n=require("./layout/services/manager-service"),o=require("system/globalization/translator"),p=require("system/lang/converter"),q=require("application/application-events"),r=require("ui/elements/ref-doc/models/refdoc-path-model"),s=require("system/error/error-message"),t=require("platform/metadata/services/metadata"),u=require("application/application-context"),v=require("system/ui/busy-indicator"),w=require("./error-dialog/ui/error-dialog-view-model"),x=require("platform/datasheets/layout/ui/datasheet-authentication-dialog-view-model"),y=require("system/hardware/device"),z=require("platform/team-assignment-component/services/assignment-service"),A=require("bluebird")
;function B(a){this.defaultConfig={functionsavailable:["save","new","delete","references","history","copy"],readonly:!1,canedit:!0,showdatasheetselection:!0,delegatedatasheetsave:!1,loadedfrommodule:!0,loadedfromrecordmanager:!1,showdefaulthelptext:!0,showsiteselector:!0,disablesiteselector:!1,capturekeypress:!1,slimmerheader:!1},this.translator=Object.resolve(o),this.containerEl=a.containerel,this.scrollEl=a.scrollel,this.datasheetkey=a.datasheetkey,this.entityObj=a.entityobj,this.familyKey=a.familykey,this.assetContextKey=a.assetcontextkey,this.isEntity=a.isentity,this.savedSiteKey=null,this.preventSiteChangeUpdate=!1,this.currentDatasheetKey=a.currentDatasheetKey,this.dto=a.dto,this.datasheetKeys=a.datasheetKeys,this.refDocs=null,this.runningSpinner=null,this.appEvents=Object.resolve(q),this.entityFactory=new e,this.entityDeleted=new k,this.entityModified=new k,this.entityCreated=new k,this.entitySaved=new k,this.onMasterDetail=new k,this.beforeEntitiesSaved=new k,
this.fieldTouched=new k,this.entityIdChanged=new k,this.window=window,this.canInsert=!1,this.canUpdate=!1,this.canView=!1,this.canDelete=!1,this.isSuperUser=!1,this.makeRootRecordEvent=new k,this.unlinkRecordEvent=new k,this.masterDatasheetDirtyEvent=new k,this.refDocsSet=new k,this.newDatasheet=new k,this.indicator=Object.resolve(v),this.device=Object.resolve(y),this.messagebox=null,this.loadingPromises=[],this.canUpdateRefDocView=!1,this.teamAssignmentService=Object.resolve(z),this.savingFromUnsavedChangesDialog=new k}B.prototype.getState=function a(){return this.detachEntityEventHandlers(),pa(this)},B.prototype.getRefDocState=function a(){return this.layout&&this.layout.refdocEl&&this.layout.isRefDocRendered()?this.layout.refdocEl.getState():null},B.prototype.updateRefDocState=function a(b){b&&(this.refDocs=b,this.canUpdateRefDocView=!0)},B.prototype.removeDOMElements=function a(b){this.layout&&this.layout.removeDOMElements(b)},B.prototype.load=function b(c){
var d=this,e=a.Deferred(),f,g,h;return d.showSpinner(),d.setConfig(c),d.attachEventListeners(),g=d.getSecurityPrivPromise(),g.done(function(b){f=d.getEntityPromise(),f.done(function(b){d.cachedEntity&&(b=d.cachedEntity),d.entity=b,d.familyKey||(d.familyKey=d.entity.familyKey),d.attachEntityEventListeners(b),h=d.renderDatasheet(b),h.done(function(b){if(b)return d.clearSpinner(),void e.resolve();I(d),d.layout.afterLoad(),0!==d.entity.key&&d.layout.currentEntyKey(d.entity.key),d.entityCopy=a.extend(!0,{},d.entity),d.entityCopy.fields=d.entityCopy.fields.toJSON(),d.clearSpinner(),e.resolve(d.entity)}).fail(function(){d.throwException(d.translate("DS_RENDER_DATASHEET_FAIL_EXCEPTION")),e.reject()})}).fail(function(a,b){b&&403===b.status?(d.clearSpinner(),l.showOk(b.statusText)):d.entityObj&&0!==d.entityObj||d.canInsert?(d.clearSpinner(),d.throwException(d.translate("DS_LOAD_ENTITY_FAIL_EXCEPTION")+": "+b.responseText)):(d.clearSpinner(),
l.showOk(d.translate("DS_ENTITY_NO_INSERT_PRIV"),d.translator.translate("DS_INFORMATION"))),e.reject()})}),e},B.prototype.translate=function a(b){return this.translator.translate(b)},B.prototype.changeDatasheet=function b(c,d){var e=this,f=a.Deferred(),g;return e.setConfig(d),e.attachEventListeners(),e.showSpinner(),e.entity=c,e.familyKey||(e.familyKey=e.entity.familyKey),e.datasheetkey=e.currentDatasheetKey,e.attachEntityEventListeners(c),t.getEntityFamilyByKey(c.familyKey).done(function(a){e.canInsert=a.canInsert,e.canView=a.canView,e.canUpdate=a.canUpdate,e.canDelete=a.canDelete,e.fieldMetadata=a.fields,g=e.renderDatasheet(c),g.done(function(){e.clearSpinner(),I(e),f.resolve(e.entity)}).fail(function(){e.throwException(e.translate("DS_RENDER_DATASHEET_FAIL_EXCEPTION")),f.reject()})}).fail(function(a){f.reject(null,a)}),f},B.prototype.attachEventListeners=function a(){},B.prototype.unload=function b(c){var d=this,e=a.Deferred();c=c!==!0&&c!==!1||c
;var f=d.entityFactory.checkIfEntityDirty(d.entity);return f.done(C.bind(null,d,e)),f.fail(D.bind(null,d,e,c)),e};function C(a,b){if(!a.layout)return b.resolve(),b;if(a.layout.isRefDocEnabled&&a.layout.isRefDocEnabled()&&a.layout.isRefDocRendered()&&a.layout.refdocEl&&a.layout.refdocEl.datasheet){a.layout.refdocEl.datasheet.unload().done(fa.bind(null,a,b)).fail(F.bind(null,b))}else fa(a,b)}function D(a,b,c){c?N().done(E.bind(null,a,b)).fail(F.bind(null,b)):fa(a,b)}function E(b,c,d){if(0===d)fa(b,c);else if(1===d){var e=b.layout?b.layout.refDocPathModel:null,f=a.Deferred();b.showSpinner(),P(b,f,e,!0),b.savingFromUnsavedChangesDialog.raise(),a.when(f).done(fa.bind(null,b,c)).fail(F.bind(null,c))}}function F(a){a.reject()}B.prototype.setTitle=function a(b){var c=this;c.layout&&c.layout.setTitle(b)},B.prototype.showSpinner=function a(){this.containerEl.parent().prepend(j),this.spinner=this.containerEl.parent().find(".load-spinner"),this.runningSpinner=!0},
B.prototype.clearSpinner=function a(){this.spinner&&this.spinner.remove(),this.runningSpinner=!1},B.prototype.getSecurityPrivPromise=function b(){var c=a.Deferred(),d=this;return d.isSuperUser=u.user.isSuperUser,d.entityObj&&0!==d.entityObj?c.resolve():d.familyKey&&(isNaN(parseInt(d.familyKey))?t.getEntityFamilyByid(d.familyKey).done(function(a){d.canInsert=a.canInsert,d.canView=a.canView,d.canUpdate=a.canUpdate,d.canDelete=a.canDelete,d.fieldMetadata=a.fields,c.resolve(a)}):t.getEntityFamilyByKey(d.familyKey).done(function(a){d.canInsert=a.canInsert,d.canView=a.canView,d.canUpdate=a.canUpdate,d.canDelete=a.canDelete,d.fieldMetadata=a.fields,c.resolve(a)})),c.promise()},B.prototype.getEntityPromise=function b(){var c=this;if(c.entityObj&&0!==c.entityObj){if(p.toBoolean(c.isEntity,"true")){var d=a.Deferred();return d.resolve(c.entityObj),d.promise()}return c.loadEntity()}if(c.familyKey)return c.createEntity()},B.prototype.createEntity=function b(){var c=a.Deferred(),d=this
;return d.entityFactory.new(d.familyKey).done(function(a){c.resolve(a)}).fail(function(a){c.reject(null,a)}),c.promise()},B.prototype.loadEntity=function b(){var c=a.Deferred(),d=this;return d.entityFactory.get(d.entityObj).done(function(a){t.getEntityFamilyByKey(a.familyKey).done(function(b){d.canInsert=b.canInsert,d.canView=b.canView,d.canUpdate=b.canUpdate,d.canDelete=b.canDelete,d.fieldMetadata=b.fields,c.resolve(a)}).fail(function(a){c.reject(null,a)})}).fail(function(a,b){c.reject(a,b)}),c.promise()},B.prototype.updateState=function a(b){var c=!1,d;b&&(this.entityObj?(d=typeof this.entityObj,"string"===d||"number"===d?this.entityObj.toString()===b.key.toString()&&(c=!0):this.entityObj.key.toString()===b.key.toString()&&(c=!0)):this.familyKey&&(this.familyKey.toString()!==b.familyKey.toString()&&this.familyKey.toString()!==b.familyID.toString()||(c=!0)),c&&(this.cachedEntity=b))},B.prototype.renderDatasheet=function a(b){return this.renderGenericDatasheet(b)},
B.prototype.renderGenericDatasheet=function b(e){var f=a.Deferred(),g=this,h,i;return g.layout||(g.layout=Object.resolve(c)),0!==g.config.functionsavailable.length||g.config.showdefaulthelptext||g.layout.hideMoreOptionsForIcons(!0),g.region=new d,g.attachLayoutEventListeners(),g.region.setElement(g.containerEl),g.layout.isHistoryEnabled(e.isHistoryEnabled&&e.key),g.layout.isSiteFiltered(e.isSiteFiltered),"0"===e.siteKey&&M(g,e.siteKey),g.layout.siteKey(e.siteKey),g.savedSiteKey=e.siteKey,h=g.getRefDocStatus(e),h.done(function(a){g.layout.isRefDocEnabled&&g.layout.isRefDocEnabled(a),p.toBoolean(a,"true")&&(i=g.getRefDocCount(e),i.done(function(a){g.layout.refDocCount&&g.layout.refDocCount(a)}).fail(function(){g.layout.refDocCount("")}),g.loadingPromises&&g.loadingPromises.push(i))}).fail(function(){g.layout.isRefDocEnabled&&g.layout.isRefDocEnabled(!1)}),g.loadingPromises&&g.loadingPromises.push(h),
g.layout.showStateManagement(e.showStateManagement&&e.isStateManagementActive&&e.key&&g.config.functionsavailable.indexOf("state")>0),g.config.showsiteselector||g.layout.showSiteSelector(!1),g.layout.attach(g.region,g.scrollEl),"MI Reference Document"===e.familyID&&(g.layout.isReferenceDocument=!0,la(e)),g.layout.showDatasheet(g.datasheetkey,g.familyKey,da(g,e),e).done(function(){var b,c,d,h,i;if(!g.layout||!g.layout.cachedFieldValues)return void f.resolve(!0);e.isSiteFiltered&&0===e.key&&g.assetContextKey>0&&g.layout.assetContextKey(g.assetContextKey),g.config.loadedfromrecordmanager&&g.layout.isDatasheetRenderedInRM(!0),g.config.showdefaulthelptext||g.layout.isDefaultHelpTextAvailable(!1),0===e.key||g.isSuperUser||g.layout.isSelectedSiteViewOnly(!0),g.config.disablesiteselector&&g.layout.isSelectedSiteViewOnly(!0),0!==e.key&&g.layout.assocDisabled(!1),e.useUrlRedirection&&!g.config.loadedfrommodule?(g.layout.isDatasheetReadOnly(!0),g.layout.isCopyAvailable(!1),
g.layout.isSaveAvailable(!1),g.layout.isDeleteAvailable(!1),g.layout.isNewAvailable(!1),g.layout.showEditButton(!1),g.layout.canEdit(!1)):g.config.readonly?(g.layout.isDatasheetReadOnly(!0),g.layout.showEditButton(!0),g.layout.canEdit(g.config.canedit)):g.layout.isDatasheetReadOnly(!1),g.config.showdatasheetselection||g.layout.showDatasheetSelection(!1),g.config.capturekeypress&&g.layout.bindKeypress(!0),g.config.showdatasheetselection||g.config.showdefaulthelptext||0!==g.config.functionsavailable.length||(g.region.$element.find(".datasheet-layout-container .datasheet-nav").hide(),g.layout.uiHelper.setOverlay(g.layout)),g.layout.entityState(e.activeState),c=a(".datasheet-layout-container mi-date-time"),c.on("keypress keydown",G.bind(null,g)),b=c.css("background-color"),b&&c.find(".form-control").css("background-color",b),g.canUpdateRefDocView&&!g.layout.currentDatasheet().isMasterDetail()&&(g.layout.updateRefDocView(g.refDocs),g.canUpdateRefDocView=!1),
g.config.slimmerheader&&(g.layout.isSilmmerHeader(!0),g.region.$element.find(".datasheet-layout-container .datasheet-nav").addClass("slimmer-ds-nav")),g.layout.isReferenceDocument&&(a("#ref-doc-download-link").on("click",ma.bind(null,g)),d=oa(e.fields,"MIRD_DOC_PATH_CHR"),h=d.attributes.value,i={type:"UNC",documentPath:h},a("#ref-doc-unc-link").on("click",na.bind(null,g,i))),f.resolve()}).fail(function(a){"abort"===a?f.resolve():f.reject()}),f};function G(a,b){a&&a.device&&a.device.isMobile()&&b.preventDefault()}function H(b,c,d,e){return a.inArray(c,b.config.functionsavailable)>=0&&(d||e)}function I(b){b.config.functionsavailable&&(b.layout.isNewAvailable(!b.layout.isDatasheetReadOnly()&&H(b,"new",b.isSuperUser,b.canInsert)),0===b.entity.key?b.layout.isSaveAvailable(!b.layout.isDatasheetReadOnly()&&H(b,"save",b.isSuperUser,b.canInsert)):b.layout.isSaveAvailable(!b.layout.isDatasheetReadOnly()&&H(b,"save",b.isSuperUser,b.canUpdate)),
b.layout.isDeleteAvailable(!b.layout.isDatasheetReadOnly()&&H(b,"delete",b.isSuperUser,b.canDelete)),b.layout.isUnlinkRecordEnabled(H(b,"unlinkRecord",b.isSuperUser,b.canDelete)),b.layout.isPasteEnabled(!b.layout.isDatasheetReadOnly()&&H(b,"copy",b.isSuperUser,b.canInsert)&&H(b,"copy",b.isSuperUser,b.canUpdate)),a.inArray("references",b.config.functionsavailable)<0&&b.layout.isReferencesAvailable(!1),a.inArray("history",b.config.functionsavailable)<0&&b.layout.isHistoryAvailable(!1),a.inArray("copy",b.config.functionsavailable)<0&&b.layout.isCopyAvailable(!1),a.inArray("state",b.config.functionsavailable)<0&&b.layout.showStateManagement(!1),a.inArray("rootRecord",b.config.functionsavailable)<0&&b.layout.isRootRecordAvailable(!1),a.inArray("unlinkRecord",b.config.functionsavailable)<0&&b.layout.isUnlinkRecordAvailable(!1))}function J(a){a.config.disablesiteselector&&a.layout.isSelectedSiteViewOnly(!0),
a.layout.isNewAvailable(!a.layout.isDatasheetReadOnly()&&H(a,"new",a.isSuperUser,a.canInsert)),a.layout.isSaveAvailable(!a.layout.isDatasheetReadOnly()&&H(a,"save",a.isSuperUser,a.canUpdate)),a.layout.isDeleteAvailable(!a.layout.isDatasheetReadOnly()&&H(a,"delete",a.isSuperUser,a.canDelete)),a.layout.isPasteEnabled(!a.layout.isDatasheetReadOnly()&&H(a,"copy",a.isSuperUser,a.canInsert)&&H(a,"copy",a.isSuperUser,a.canUpdate))}B.prototype.getUserFamilyPrivileges=function a(){return this.userFamilyPrivileges},B.prototype.getRefDocStatus=function a(b){var c,d;return c=b.familyID,d=b.key,this.entityFactory.canRefDoc(c,d)},B.prototype.getRefDocCount=function a(b){var c;return c=b.key,this.entityFactory.getRefDocCount(c)},B.prototype.attachEntityEventListeners=function a(b){var c=this;b.entityModified&&b.entityModified.add(c.onEntityChanged,c),b.entitySaved&&b.entitySaved.add(c.onEntitySaved,c),b.entityDeleted&&b.entityDeleted.add(c.onEntityDeleted,c),
b.entityChangedEvent&&b.entityChangedEvent.add(c.onEntityChanged,c),b.entityIdChanged&&b.entityIdChanged.add(c.onEntityIdChanged,c)},B.prototype.attachLayoutEventListeners=function a(){var b=this;b.layout.fieldValueChanged.add(b.onLayoutFieldChanged,b),b.layout.datasheetNew.add(b.onDatasheetNew,b),b.layout.datasheetSaved.add(b.onDatasheetSaved,b),b.layout.datasheetDelete.add(b.onDatasheetDelete,b),b.layout.datasheetReference.add($.bind(null,b)),b.layout.datasheetHistory.add(_.bind(null,b)),b.layout.onMasterDetail.add(b.executeMasterDetail,b),b.layout.beforeStateTransition.add(b.beforeStateTransition,b),b.layout.onStateTransition.add(b.onStateTransition,b),b.layout.onSiteChange.add(b.handleSiteChange,b),b.layout.recordManagerHelper.makeRootRecordEvent.add(ia.bind(null,b)),b.layout.recordManagerHelper.unlinkRecordEvent.add(ja.bind(null,b)),b.layout.refDocsRendered.add(ka.bind(null,b)),b.layout.datasheetChanged.add(aa.bind(null,b)),b.layout.toggleEditBtnClicked.add(J.bind(null,b)),
b.layout.fieldTouched.add(K.bind(null,b)),b.appEvents&&b.appEvents.layoutChanged&&b.appEvents.layoutChanged.add(L.bind(null,b))};function K(a,b){a.fieldTouched.raise(b)}function L(a){a&&a.layout&&a.layout.onLayoutChanged()}B.prototype.handleSiteChange=function a(b){var c=this;if(c.preventSiteChangeUpdate)return void(c.preventSiteChangeUpdate=!1);c.entity&&(c.entity.siteKey=b,c.entityFactory.updateEntitySite(c.entity))};function M(a,b){return a.layout.siteKey()!==b&&(a.preventSiteChangeUpdate=!0,!0)}B.prototype.detachEntityEventHandlers=function a(){var b=this;b.entity&&(b.entity.entityModified&&b.entity.entityModified.remove(b),b.entity.entitySaved&&b.entity.entitySaved.remove(b),b.entity.entityDeleted&&b.entity.entityDeleted.remove(b),b.entity.entityChangedEvent&&b.entity.entityChangedEvent.remove(b),b.entity.entityIdChanged&&b.entity.entityIdChanged.remove(b)),b.layout&&(b.layout.fieldValueChanged&&b.layout.fieldValueChanged.remove(b),
b.layout.datasheetSaved&&b.layout.datasheetSaved.remove(b),b.layout.datasheetNew&&b.layout.datasheetNew.remove(b),b.layout.datasheetDelete&&b.layout.datasheetDelete.remove(b),b.layout.onMasterDetail&&b.layout.onMasterDetail.remove(b),b.layout.beforeStateTransition&&b.layout.beforeStateTransition.remove(b),b.layout.onStateTransition&&b.layout.onStateTransition.remove(b)),b.appEvents&&b.appEvents.layoutChanged&&b.appEvents.layoutChanged.remove(L.bind(null,b))},B.prototype.tabSwitched=function a(){var b=this;if(b.layout)return b.layout.tabSwitched},B.prototype.setConfig=function b(c){var d=this;d.config=c||{},d.config=ca(d.config),a.extend(d.defaultConfig,d.config),d.config=d.defaultConfig,d.validateConfig()},B.prototype.validateConfig=function a(){var b=this;b.entityObj&&0!==b.entityObj||b.familyKey||b.throwException(b.translate("DS_ENTITY_FAMILY_KEY_EXCEPTION"))},B.prototype.throwException=function a(b){var c=new s(1,b,"platform/datasheets/forms-datasheet-manager.js")
;this.appEvents.errorOccured.raise(this,c)},B.prototype.confirm=function a(b){return this.window.confirm(b)},B.prototype.callOnDatasheetNew=function b(){var c=a.Deferred();return this.onDatasheetNew().done(function(a){c.resolve(a)}),c},B.prototype.callOnDatasheetDelete=function b(){var c=this,d=a.Deferred();return c.onDatasheetDelete().done(function(a){d.resolve(a)}),d},B.prototype.callOnDatasheetCopy=function a(b){var d=this;d.layout||(d.layout=Object.resolve(c)),d.layout.setCachedFamilyKey(b.familyKey),d.layout.copyDatasheet()},B.prototype.callOnDatasheetPaste=function a(b){var d=this;d.layout||(d.layout=Object.resolve(c)),d.layout.pasteDatasheet()},B.prototype.callBeforeStateTransition=function a(b,c){this.beforeStateTransition(b,c)},B.prototype.callOnStateTransition=function a(b,c){this.onStateTransition(b,c)};function N(){return l.showUnsavedChanges()}B.prototype.onEntityChanged=function b(c,d,e,f,g,h){var i,j=this;i=e?d.dependentFields:null;var k=f?d.value:d.displayValue
;j.layout&&(j.entity.siteKey=j.layout.siteKey(),j.layout.updateFieldValue(d.key.toString(),d.value,d.values,k,d.pickList,d.isDisabled,d.isRequired,d.isHidden,d.errorMessage,d.backColor,d.maxNumberOfValues,i,d.jsModuleName,d.jsModuleParams,d.popJSModuleOnFocus,d.addParseValueParam,d.format,!0,d.successMessage,c.isDirty)),j.cachedEntity?j.cachedEntity=a.extend(!0,c,j.cachedEntity):j.cachedEntity=c,h&&g&&g!==h.lockSeqNbr&&j.layout.uiHelper.lockEntityUpdateHelper(j),j.entityModified.raise(d,e)},B.prototype.onEntitySaved=function b(c,d,e){var f,g=this;if(g.layout){for("function"==typeof d&&d.call(g,c,e),
f=0;f!==c.fields.length;f++)g.layout.updateFieldValue(c.fields[f].key.toString(),c.fields[f].value,c.fields[f].values,c.fields[f].displayValue,c.fields[f].pickList,c.fields[f].isDisabled,c.fields[f].isRequired,c.fields[f].isHidden,c.fields[f].errorMessage,c.fields[f].backColor,c.fields[f].maxNumberOfValues,c.fields[f].dependentFields,c.fields[f].jsModuleName,c.fields[f].jsModuleParams,c.fields[f].popJSModuleOnFocus,c.fields[f].addParseValueParam,c.fields[f].format,!1,c.fields[f].successMessage,c.isDirty);g.layout.isHistoryEnabled(g.entity.isHistoryEnabled&&g.entity.key),g.layout.isSiteFiltered(g.entity.isSiteFiltered),M(g,g.entity.siteKey),g.layout.siteKey(g.entity.siteKey),g.layout.currentEntyKey(c.key),0===g.entity.key||g.isSuperUser||g.layout.isSelectedSiteViewOnly(!0),g.savedSiteKey=g.entity.siteKey,g.getRefDocStatus(g.entity).done(function(a){null!==g.layout&&g.layout.isRefDocEnabled(a)}).fail(function(){null!==g.layout&&g.layout.isRefDocEnabled(!1)}),
g.layout.showStateManagement(g.entity.showStateManagement&&g.entity.isStateManagementActive&&g.entity.key&&g.config.functionsavailable.indexOf("state")>0)}g.entityCopy=a.extend(!0,{},g.entity),g.entityCopy.fields=g.entityCopy.fields.toJSON(),g.entitySaved.raise(g.entity),g.cachedEntity=g.entity},B.prototype.onEntityDeleted=function a(){var b=this;b.layout&&b.layout.isReadOnly(!0),b.entityDeleted.raise(b.entity),b.entity=null},B.prototype.onEntityIdChanged=function a(b){this.entityIdChanged.raise(b)},B.prototype.onDatasheetSaved=function b(c){var d=this,e,f=a.Deferred();return d.showSpinner(),d.entity.checkIfEntityDirty().done(O.bind(null,d,f,c)).fail(P.bind(null,d,f,c,!1)),f};function O(a,b,c){0===a.entity.key||a.savedSiteKey!==a.layout.siteKey()?P(a,b,c,!1):b.resolve(),a.clearSpinner()}function P(a,b,c){if(0===a.entity.updateReqCount&&0===a.entity.saveQueue)R(a,b,c);else{var d={};d.clearIntervalRef=setInterval(Q,100,d,a,b,c)}}function Q(a,b,c,d){
0===b.entity.updateReqCount&&0===b.entity.saveQueue&&(R(b,c,d),clearInterval(a.clearIntervalRef))}function R(a,b,c){if(a.layout.setErrorAndReturnErrorFlag(a))return b.reject(),void a.clearSpinner();a.entity.isAuditable?S(a,T,b,c):T(a,b,c)}function S(a,b,c,d){var e,f;e=Object.resolve(x),f=new i(e,a.translate("DS_AUTH_DIALOG_TITLE"),{height:300,width:400}),f.show(),e.saveAllowed.add(b.bind(null,a,c,d,f)),e.saveDenied.add(W.bind(null,a,f,c)),e.saveCancelled.add(V.bind(null,a,f))}function T(a,b,c,d){if(0!==a.entity.key||!a.layout.isNewEntityCreated()){if(0===a.entity.key&&a.layout.isNewEntityCreated(!0),a.config.delegatedatasheetsave){var e={entity:a.entity,datasheetSaveDfd:b};a.entity.entityModified=null,a.entity.entityDeleted=null,a.entity.entitySaved=null,a.entity.entityIdChanged=null,a.entity.entityChangedEvent=null,a.entity.siteKey=a.layout.siteKey(),a.beforeEntitiesSaved.raise(e),a.clearSpinner()}else if(a.layout.showSiteSelector()&&(a.entity.siteKey=a.layout.siteKey()),
a.entity.checkIfEntityDirty()||a.savedSiteKey!==a.layout.siteKey()){if(0===a.entity.key&&"-1"===a.entity.siteKey&&(a.entity.siteKey="0"),a.runningSpinner&&c){var f=a.region.$element.closest(".dialog-wrapper");f.length>0&&(f.find(".close-btn").attr("disabled",!0),f.find(".close-btn").parent().css("overflow","hidden"),f.find(".icon-close-popup").css("pointer-events","none"))}a.entityFactory.save(a.entity).done(function(d){c?c.isStored()?a.entityFactory.uploadRefDoc(c.formData,d.key).done(function(){a.clearSpinner(),f.length>0&&(f.find(".close-btn").attr("disabled",!1),f.find(".icon-close-popup").css("pointer-events","auto"))}).fail(function(){a.clearSpinner(),a.throwException(a.translate("REFDOCS_FAILED_TO_UPLOAD_REF_DOC"))
}):c.isUnc()?a.entityFactory.hasRefDocServerCredentials().done(X.bind(null,a)).fail(Y.bind(null,a)):a.clearSpinner():a.layout.teamModel?a.teamAssignmentService.SyncTeamMembersAndTeams(d.key,d.siteKey,a.layout.teamModel,a.layout.teamModel.hrRelId,a.layout.teamModel.teamRelId).done(function(a,b){a.clearSpinner()}.bind(null,a)).fail(U.bind(null,a)):a.clearSpinner(),a.layout.currentEntyKey(d.key),a.layout.isNewEntityCreated(!1),b.resolve()}).fail(function(c){a.clearSpinner(),a.layout.isNewEntityCreated(!1),c.statusCode&&409===c.statusCode().status?a.layout.uiHelper.lockEntityUpdateHelper(a):a.throwException(a.translate("DS_SAVE_ENTITY_FAIL_EXCEPTION")+": "+c.responseText),b.reject()})}V(a,d)}}function U(a,b){a.clearSpinner(),a.throwException("Failed to sync Members and Teams: "+b.responseText)}function V(a,b){b&&b.closeDialog()}function W(a,b,c){V(a,b),l.showOk(a.translate("DS_AUTH_FAILURE_MSG"),a.translate("DS_AUTH_FAILURE_DIALOG_TITLE")),c.reject()}function X(a,b){var c=new h({
closeButton:!0,timeOut:"200",hideDuration:"200"});b===!1&&c.warning(a.translate("REFDOCSERVER_NO_CREDENTIALS"),a.translate("REFDOCSERVER")),a.clearSpinner()}function Y(a){new h({closeButton:!0,timeOut:"200",hideDuration:"200"}).error(a.translate("REFDOCSERVER_FAILED_CREDENTIALS"),a.translate("REFDOCSERVER")),a.clearSpinner()}B.prototype.onDatasheetNew=function b(){var c=a.Deferred(),d=this;if(d.layout.isDatasheetRenderedInRM())return d.newDatasheet.raise(d.familyKey),c.resolve(),c;if(null!==d.entity){if(0!==d.entity.updateReqCount)return void d.throwException(d.translate("DS_CANNOT_ADD_NEW_ENTITY_EXCEPTION"));d.entityFactory.checkIfEntityDirty(d.entity).done(function(){if(d.layout.isMasterDatasheet())return c.resolve(d.entity),c;d.layout&&d.layout.isReadOnly(!1),d.entityFactory.new(d.familyKey).done(function(a){d.entity=a,d.attachEntityEventListeners(a),d.layout.isHistoryEnabled(a.isHistoryEnabled&&a.key),d.layout.isSiteFiltered(a.isSiteFiltered),M(d,a.siteKey),
d.layout.siteKey(a.siteKey),d.savedSiteKey=a.siteKey,d.getRefDocStatus(d.entity).done(function(a){d.layout.isRefDocEnabled(a)}).fail(function(){d.layout.isRefDocEnabled(!1)}),d.layout.showStateManagement(a.showStateManagement&&a.isStateManagementActive&&a.key&&d.config.functionsavailable.indexOf("state")>0),d.layout.setCurrentEntity(da(d,d.entity)),d.entityCreated.raise(a),c.resolve(a)})}).fail(function(){N().done(function(b){if(0===b)Z(d,c);else if(1===b){var e=d.layout?d.layout.refDocPathModel:null,f=a.Deferred();d.showSpinner(),P(d,f,e,!0),a.when(f).done(Z.bind(null,d,c))}})})}else d.entityFactory.new(d.familyKey).done(function(a){d.entity=a,d.attachEntityEventListeners(a),d.layout.isHistoryEnabled(a.isHistoryEnabled&&a.key),d.layout.isSiteFiltered(a.isSiteFiltered),M(d,a.siteKey),d.layout.siteKey(a.siteKey),d.savedSiteKey=a.siteKey,d.getRefDocStatus(d.entity).done(function(a){d.layout.isRefDocEnabled(a)}).fail(function(){d.layout.isRefDocEnabled(!1)}),
d.layout.showStateManagement(a.showStateManagement&&a.isStateManagementActive&&a.key&&d.config.functionsavailable.indexOf("state")>0),d.layout.setCurrentEntity(da(d,d.entity)),d.entityCreated.raise(a),c.resolve(a)});return c};function Z(a,b){a.cachedEntity=null,a.layout&&a.layout.isReadOnly(!1),a.entityFactory.new(a.familyKey).done(function(c){a.entity=c,a.attachEntityEventListeners(c),a.layout.isHistoryEnabled(c.isHistoryEnabled&&c.key),a.layout.isSiteFiltered(c.isSiteFiltered),M(a,c.siteKey),a.layout.siteKey(c.siteKey),a.savedSiteKey=c.siteKey,a.getRefDocStatus(a.entity).done(function(b){a.layout.isRefDocEnabled(b)}).fail(function(){a.layout.isRefDocEnabled(!1)}),a.layout.showStateManagement(c.showStateManagement&&c.isStateManagementActive&&c.key&&a.config.functionsavailable.indexOf("state")>0),a.layout.setCurrentEntity(da(a,a.entity)),a.entityCreated.raise(c),b.resolve(c)}),a.masterDatasheetDirtyEvent.raise()}B.prototype.onDatasheetDelete=function b(){var c=a.Deferred(),d=!0,e=this
;return 0!==e.entity.key?l.showYesNo(e.translate("DS_DELETE_ENTITY_MESSAGE"),e.translate("CONFIRM_REC_DEL")).done(function(a){0===a&&e.entityFactory.delete(e.entity).done(function(a){c.resolve(a)}).fail(function(a){l.show(a,"Error!"),c.reject()})}):l.showOk(e.translate("DS_CANNOT_DELETE_ENTITY_EXCEPTION"),e.translate("DS_ALERT_TITLE")),c};function $(a){a.layout.entykey(a.entity.key)}function _(a){var b=Object.resolve(g),c=new d;b.attach(c,a.entity),b.loadHistory();var e=new i(b,a.translate("DS_FIELD_HISTORY_TITLE"),{height:"90%",width:"80%"});b.setDialog(e),e.show()}function aa(b){b.layout.datasheetService.getDatasheet(b.layout.currentDatasheetKey()).done(function(c){c&&c.isMasterDetail?b.entityFactory.checkIfEntityDirty(b.entity).done(function(){b.layout.previousDatasheetKey(b.layout.currentDatasheetKey()),b.layout.executeDatasheetChanged(c)}).fail(function(){N().done(function(d){if(0===d)ba(b,c);else if(1===d){var e=b.layout?b.layout.refDocPathModel:null,f=a.Deferred()
;b.showSpinner(),P(b,f,e,!0),a.when(f).done(ba.bind(null,b,c))}}).fail(function(){b.layout.proceed=!1,b.layout.currentDatasheetKey(b.layout.previousDatasheetKey())})}):c&&!c.isMasterDetail&&b.layout.executeDatasheetChanged(c,da(b,b.entity))})}function ba(a,b){a.cachedEntity=null,a.layout.previousDatasheetKey(a.layout.currentDatasheetKey()),a.layout.executeDatasheetChanged(b)}B.prototype.onLayoutFieldChanged=function a(b,c,d,e,f){var g=this;g.entity.siteKey=g.layout.siteKey(),f?g.entityFactory.updateFieldByKey(g.entity,c,d,f):g.entityFactory.updateFieldValue(g.entity,c,d,e,!0)},B.prototype.executeMasterDetail=function a(b,c,d,e){var f=this,g;f.layout.detach(f.region),g=0===f.entity.key?f.entityFactory.new(f.entity.familyKey):f.entityFactory.get(f.entity.key),g.done(function(a){a=qa(f,a),f.onMasterDetail.raise(b,c,a,d,e)}).fail(function(){f.throwException(f.translate("DS_LOAD_ENTITY_FAIL_EXCEPTION"))})},B.prototype.beforeStateTransition=function a(b,c){},
B.prototype.onStateTransition=function a(b,c){var d=this,e=c.originalEvent.detail;new h({closeButton:!0,timeOut:"200",hideDuration:"200"}).success(d.translator.translate("STATE_CHANGE")+e.transitionData.activeState.caption);var f=d.layout.isMasterDatasheet();d.unload().done(function(){d.load(d.config).done(function(){d.entitySaved.raise(d.entity),d.layout.isMasterDatasheet(f)})})},B.prototype.displayError=function a(b,c){for(var d="",e="",f=!1,g=[],j=0;j<c.length;j++)c[j].errorMessage&&(d=c[j].id,e="locerror"===c[j].errorMessage?b.translate("CMMS_ERROR_LOC"):b.translate("CMMS_ERROR_RISK"),g.push({id:d,errorMessage:e}),f=!0);if(f){var k=new w(g),l=new i(k,b.translate("MSG_CMMS_ERROR"));k.closeDialog.add(function(){l.closeDialog()}),l.show()}else{new h({closeButton:!0,timeOut:"200",hideDuration:"200"}).success(b.translate("MSG_CMMS_SUCC"))}};function ca(b){var c={};return a.each(b,function(a,b){c[a.toLowerCase()]=b}),c}function da(a,c){
for(var d=c.fields.models.length,e,f,g=[],h=0;h<d;h++)e=c.fields.models[h].get("key"),f=b.find(a.fieldMetadata,ea.bind(null,e)),g.push({fieldKey:e,fieldId:c.fields.models[h].get("id"),fieldValue:c.fields.models[h].get("value"),fieldDisplayValue:c.fields.models[h].get("displayValue"),options:{required:c.fields.models[h].get("isRequired"),disabled:c.fields.models[h].get("isDisabled"),isHtmlField:c.fields.models[h].get("isHtmlField"),unitOfMeasure:c.fields.models[h].get("unitOfMeasure"),unitOfMeasureKey:c.fields.models[h].get("unitOfMeasureKey"),picklist:c.fields.models[h].get("pickList"),backColor:c.fields.models[h].get("backColor"),jsModuleName:c.fields.models[h].get("jsModuleName"),jsModuleParams:c.fields.models[h].get("jsModuleParams"),jsModuleUseApply:c.fields.models[h].get("jsModuleUseApply"),popJSModuleOnFocus:c.fields.models[h].get("popJSModuleOnFocus"),addParseValueParam:c.fields.models[h].get("addParseValueParam"),dependentFields:c.fields.models[h].get("dependentFields"),
isPicklistRestricted:c.fields.models[h].get("isPicklistRestricted"),maxNumberOfValues:c.fields.models[h].get("maxNumberOfValues"),values:c.fields.models[h].get("values"),helpText:c.fields.models[h].get("helpText"),format:c.fields.models[h].get("format"),dbLength:c.fields.models[h].get("dbLength"),behaviors:f?f.behaviors:null,hidden:c.fields.models[h].get("isHidden")}});return g}function ea(a,b){return b.key===a}function fa(a,b){a.cachedEntity=null,a.layout&&(ga(a),a.detachEntityEventHandlers(),a.layout.deallocateMem(),a.layout.detach(a.region),a.layout=null,b.resolve())}function ga(a){var b;for(b=0;b<a.loadingPromises.length;b++)ha(a.loadingPromises[b]);a.loadingPromises=[],a.layout.abortLoadingPromises()}function ha(a){a.request.abort()}function ia(a){a.makeRootRecordEvent.raise(a.entity)}function ja(a){a.unlinkRecordEvent.raise(a.entity)}function ka(a,b){a.refDocs=b,t.getEntityFamilyByid("MI Reference Document").done(function(a,b){a.refDocs.isAddAllowed(b.canInsert||a.isSuperUser),
a.refDocs.isUnlinkAllowed(b.canDelete||a.isSuperUser)}.bind(null,a)),a.refDocsSet.raise()}function la(a){var b,c,d,e;b=oa(a.fields,"MI_REF_DOCUMENTS_STORE_DOCUM_L"),c=oa(a.fields,"MIRD_DOC_PATH_CHR"),d=!(!b.attributes.value||"true"!==b.attributes.value.toString().toLowerCase()),""!==(e=c.attributes.value)&&(d?c.attributes.displayValue='<a href="#" id="ref-doc-download-link">'+e+"</a>":!d&&e.startsWith("\\")?c.attributes.displayValue='<a href="#" id="ref-doc-unc-link">'+e+"</a>":c.attributes.displayValue='<a href="'+e+'" target="tab">'+e+"</a>")}function ma(a,b){a.layout.downloadRefdoc(),b&&b.preventDefault()}function na(a,b,c){a.layout.uncDownloadRefDoc(b,c),c&&c.preventDefault()}function oa(a,c){return b.find(a.models,function(a){return a.id===c})}function pa(a){return a.entity&&"-1"===a.entity.siteKey?a.cachedEntity=a.entity:a.cachedEntity&&a.entity&&"0"===a.entity.siteKey&&(a.cachedEntity.siteKey="0"),a.cachedEntity}function qa(a,b){
return"-1"===a.savedSiteKey&&0===b.key&&(b.siteKey=a.savedSiteKey),b}return B});
define('platform/datasheets/layout/ui/bulk-column-view-model',['require','knockout','system/knockout/knockout-helpers'],function(require){"use strict";var a=require("knockout");require("system/knockout/knockout-helpers");function b(b){b=b||{},this.columnCaption=b.columnCaption,this.columnFieldKey=b.columnFieldKey,this.model=b,this.controlTemplate=a.observable(),this.fieldValue=a.observable(),this.fieldValue.subscribe("function"==typeof this.model.fieldValue?this.model.fieldValue:function(){}),this.isSelected=a.observable(!1),this.entitykey=null,this.clientid=null,this.elementCss=a.observable("form-control")}return b.prototype.deallocateMem=function a(){this.columnCaption=null,this.columnFieldKey=null,this.controlTemplate=null,this.fieldValue=null,this.isSelected=null,this.entitykey=null,this.clientid=null,this.elementCss=null},b});
define('platform/datasheets/layout/ui/bulk-row-view-model',['require','lodash','jquery','knockout','./bulk-column-view-model','application/application-context','system/knockout/knockout-helpers'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("./bulk-column-view-model"),e=require("application/application-context");require("system/knockout/knockout-helpers");function f(a,d,f,g){var j=this;b.isArray(a)?this.entityKeyArray=c.observableArray(a):this.entitykey=c.observable(a),this.isCheckboxDisabled=c.observable(!1),this.clientid=c.observable(d),this.cols=c.observableArray(),this.isReadonly=c.observable(!1),this.isModified=c.observable(!1),this.isSelected=c.observable(!1),this.isFrozen=c.observable(!1),this.entityStatus=c.observable(),this.refDocPathModel=c.observable(),this.siteKey=c.observable(),this.isSelectedSiteViewOnly=c.observable(!1),this.preventSiteChangeUpdate=!1,this.isSuperUser=e.user.isSuperUser,0!==a&&(this.siteKey(g),this.isSuperUser||this.isSelectedSiteViewOnly(!0)),f.isSelectedSiteViewOnly&&f.isSelectedSiteViewOnly()&&this.isSelectedSiteViewOnly(!0),
f.frozenColsKeys&&(this.frozenColsKeys=f.frozenColsKeys,this.freezedCols=c.pureComputed(i.bind(j,j)),this.floatCols=c.pureComputed(l.bind(j,j))),this.entityStatusClass=c.computed(h.bind(null,this))}f.prototype.addColumns=function b(c){var e=this,f=a.map(c,function(a){return new d(a)});e.cols(f)},f.prototype.addColumn=function a(b){this.cols.push(new d(b))},f.prototype.deallocateMem=function a(){this.entityKeyArray&&(this.entityKeyArray=null),this.entitykey&&(this.entitykey=null),this.isCheckboxDisabled=null,this.clientid=null,g(this),this.cols=null,this.isReadonly=null,this.isModified=null,this.isSelected=null,this.isFrozen=null,this.entityStatus=null,this.frozenColsKeys&&(this.frozenColsKeys=null),this.freezedCols&&(this.freezedCols.dispose(),this.freezedCols=null),this.floatCols&&(this.floatCols.dispose(),this.floatCols=null),this.entityStatusClass&&(this.entityStatusClass.dispose(),this.entityStatusClass=null)};function g(a){var b
;for(b=0;b<a.cols().length;b++)a.cols()[b].deallocateMem(),a.cols()[b]=null}function h(a){return"new-clean"===a.entityStatus()?"ds-more":"new-dirty"===a.entityStatus()?"ds-add":"clean"===a.entityStatus()?"ds-save":"ds-edit"}function i(b){return a.filter(b.cols(),j.bind(null,b.frozenColsKeys()))}function j(b,c){return a.includes(b,c.columnFieldKey)}function k(a,b){return b.columnFieldKey===a}function l(b){return a.filter(b.cols(),m.bind(null,b.frozenColsKeys()))}function m(b,c){return!a.includes(b,c.columnFieldKey)}function n(a,b){return a.columnFieldKey===b}return f});
define('platform/datasheets/layout/ui/bulk-column-chooser',['require','lodash','jquery','knockout','spa/ko/knockout-view-model','system/knockout/knockout-helpers'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("spa/ko/knockout-view-model");require("system/knockout/knockout-helpers");function e(a){this.layout=a,f.call(this,'<div data-bind="template:\'bdf-column-chooser\'" style="height:100%;"></div>'),this.dialog=null,this.selCols=this.layout.selectedColumns()}var f=Object.inherit(d,e);e.prototype.toggleSelectAll=function a(){this.layout.selectedColumns().length!==this.layout.columns().length&&this.layout.selectedColumns([].concat(this.layout.columns()))},e.prototype.toggleSelectColumn=function a(c,d,e){var f=this.selectedColumns();if(d.fieldValue&&d.fieldValue()&&d.fieldValue().required())return!1;if(c.isActive(d)){if(f.length>2){var h=b.grep(f,function(a){return a.columnFieldKey!==d.columnFieldKey});this.selectedColumns(h)}}else{f=[].concat(f),f.push(d);var i=g(this.columns(),f);this.selectedColumns(i)}};function g(b,c){var d=[];return a.each(b,function(b){
var e=a.find(c,function(a){return b.columnFieldKey===a.columnFieldKey});e&&d.push(e)}),d}return e.prototype.isActive=function b(c){return!!a.find(this.layout.selectedColumns(),function(a){return a.columnFieldKey===c.columnFieldKey})},e.prototype.reOrder=function a(){this.dialog&&this.dialog.closeDialog(),this.layout.changeColumns()},e.prototype.cancel=function a(){this.layout.selectedColumns([].concat(this.selCols)),this.dialog&&this.dialog.closeDialog()},e.prototype.setDialog=function a(b){this.dialog=b},e});

define('text!platform/datasheets/layout/ui/views/bulk-datasheet.html',[],function () { return '<div class="datasheet-layout-container bulk-form-datasheet" data-bind="css:{\'edit\':!isDatasheetReadOnly() || !canEdit(), \'bulk-datasheet-readonly-container\': isDatasheetReadOnly}">\r\n    <div style="height:100%">\r\n\r\n        <!-- Bulk DS Nav Section -->\r\n        <div class="bulk-datasheet-header-container">\r\n            <h2 data-bind="text: title"></h2>\r\n            <div data-bind="if: isDatasheetRendered" class="datasheet-nav">\r\n                <div class="bulk-datasheet-nav datasheet-toolbar">\r\n                    <div class="datasheet-selector-container block b7" data-bind="visible: showDatasheetSelection">\r\n                        <div class="datasheet-lbl1">\r\n                            <span data-bind="text: $root.translate(\'DS_DATASHEET_ID_LABEL\')"></span>:\r\n                        </div>\r\n                        <mi-select class="" data-bind="miproperty:{\r\n                        value: currentDatasheetKey,\r\n                        options: datasheetKeys,\r\n                        optionsValue:\'key\',\r\n                        optionsText:\'caption\'}"></mi-select>\r\n                    </div>\r\n                    <div class="datasheet-empty-space-container block b7" data-bind="visible: !showDatasheetSelection()">\r\n                    </div>\r\n                    <div class="datasheet-controls-container block b5">\r\n                        <!-- ko if: canEdit -->\r\n                        <div class="datasheet-btn-group bulk-datasheet-edit-control" data-bind="visible: isDatasheetReadOnly, click:showEditMode">\r\n                            <button class="btn btn-icon" data-bind="attr: {title: translate(\'DS_EDIT_TOOLTIP\')}">\r\n                                <i class="icon-edit"></i>\r\n                            </button>\r\n                        </div>\r\n                        <!-- /ko -->\r\n                        <div class="datasheet-btn-group bulk-ds-iconbar" data-bind="visible: !isDatasheetReadOnly()">\r\n                            <button class="btn btn-icon " data-bind="visible: isDatasheetRendered(), click: toggleSelectMode, attr: {title: translate(\'DS_SELECT_TOOLTIP\')}"><i class="icon-select-all"></i> </button>\r\n                            <mi-associated-pages-btn familykey entitykey data-bind="attr: { familykey: assocFamilyKey(), entitykey: assocEntityKey(), disabled: !isSingleEntitySelected() } " hideifnorecords="true"></mi-associated-pages-btn>\r\n                            <button class="btn btn-icon" data-bind="visible: isDatasheetRendered() && isSaveAvailable() && !ValidateBeforeSave(), click: saveDatasheet, attr: {title: translate(\'DS_SAVE_TOOLTIP\')}"><i class="icon-save"></i></button>\r\n                            <button class="btn btn-icon" data-bind="visible: isDatasheetRendered() && isSaveAvailable() && ValidateBeforeSave(), click: saveDatasheet2, attr: {title: translate(\'DS_SAVE_TOOLTIP\')}"><i class="icon-save"></i> </button>\r\n                        </div>\r\n                        <!-- ko if: isRefDocFamily() -->\r\n                        <div class="datasheet-btn-group reference-doc-download">\r\n                            <button class="btn btn-icon" data-bind="click: downloadRefDoc, disable: !(isSingleEntitySelected() && canDownloadRefDoc()), attr: {title: translate(\'DS_DOWNLOAD_REF_DOC\')}"><i class="icon-download"></i></button>\r\n                        </div>\r\n                        <!-- /ko -->\r\n                        <!-- ko if: !isMasterDatasheet()-->\r\n                        <div class="datasheet-btn-group  print-btn-group">\r\n                            <button class="btn btn-icon" data-bind="click : print, attr: {title: translate(\'PRINT\')}"><i class="icon-printer"></i></button>\r\n                        </div>\r\n                        <!-- /ko -->\r\n                        <div class="datasheet-btn-group" data-bind="visible:maxPage()>1">\r\n                            <mi-select data-bind="miproperty:{\r\n                                   options:pageOptions,\r\n                                   optionsValue:\'value\',\r\n                                   optionsText:\'text\',\r\n                                   value:pageSelector,\r\n                                   editable:false\r\n                                   }"></mi-select>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <h5 data-bind="visible: isMasterDatasheet(), text: currentDatasheetCaption"></h5>\r\n        </div>\r\n        <!-- end of Bulk DS  Nav-->\r\n        <!-- Custom Table for Bulk DS -->\r\n        <div class="bulk-datasheet-table" style="height:calc(100% - 65px);overflow:auto;">\r\n\r\n            <!-- Table header -->\r\n            <div class="bulk-datasheet-table-header">\r\n\r\n                <!-- table header frozen columns -->\r\n                <div class="freezed-cols-container pull-left">\r\n                    <table class="table table-cust1-header">\r\n                        <thead>\r\n                            <tr data-bind="">\r\n                                <th class="status-col"></th>\r\n                                <th class="row-selector" data-bind="visible:$root.selectMode()">\r\n                                    <div class="checkbox-selectall">\r\n                                        <mi-checkbox class="row-selection" data-bind="miCheckboxProperty:{ checked:$root.selectAll}"> </mi-checkbox>\r\n\r\n                                    </div>\r\n                                </th>\r\n                                <!-- ko if: $root.isDatasheetRendered() && $root.isSiteFiltered() && $root.showSiteSelector -->\r\n                                <th class="site-selector-caption" data-bind="text: translate(\'DS_SITE_CAPTION\')"></th>\r\n                                <!-- /ko -->\r\n                                <!-- ko foreach:freezedCols -->\r\n                                <th class="freezed-column" data-bind="text:columnCaption,attr:{title:columnCaption},event:{click:$parent.selectColumn.bind($parent)},css:{\'selected\':$data.isSelected}"></th>\r\n                                <!-- /ko -->\r\n\r\n                            </tr>\r\n                        </thead>\r\n                    </table>\r\n                </div>\r\n                <!-- end of table header frozen columns -->\r\n                <!-- table header floating columns -->\r\n                <div class="table-responsive" data-bind="css: {\'datasheet-readonly-container\': isDatasheetReadOnly}">\r\n                    <table class="table table-cust1-header bulk-float-table">\r\n                        <thead>\r\n                            <tr data-bind="">\r\n                                <!-- ko foreach:floatCols -->\r\n                                <th data-bind="text:columnCaption,attr:{title:columnCaption},event:{click:$parent.selectColumn.bind($parent)},css:{\'selected\':$data.isSelected}"></th>\r\n                                <!-- /ko -->\r\n                            </tr>\r\n                        </thead>\r\n                    </table>\r\n                </div>\r\n                <!-- end of table header floating columns -->\r\n            </div>\r\n            <!-- end of Table Header -->\r\n            <!-- Table Body section-->\r\n            <div class="bulk-datasheet-table-body">\r\n\r\n                <!-- Frozen rows section -->\r\n                <div class="freezed-rows-container">\r\n\r\n                    <!-- frozen rows\'s frozen columns -->\r\n\r\n                    <div class="freezed-cols-container pull-left">\r\n                        <table class="table table-cust1">\r\n                            <tbody data-bind="foreach:frozenRows">\r\n                                <tr data-bind="css:{\'active\':$data.isSelected}">\r\n                                    <td class="status-col">\r\n                                        <span data-bind="attr: {class: entityStatusClass}"></span>\r\n                                    </td>\r\n                                    <td class="row-selector" data-bind="visible:$root.selectMode()">\r\n                                        <div class="checkbox-selectall">\r\n                                            <mi-checkbox class="row-selection" data-bind="miCheckboxProperty:{ checked:$data.isSelected, value:$data.entitykey, disable:$data.isCheckboxDisabled}"> </mi-checkbox>\r\n\r\n                                        </div>\r\n                                    </td>\r\n                                    <!-- ko if: $root.isDatasheetRendered() && $root.isSiteFiltered() && $root.showSiteSelector() -->\r\n                                    <td class="site-selector-container">\r\n                                        <div class="site-filter-component">\r\n                                            <mi-site-selector data-bind="value: $data.siteKey,attr: { readonly: $data.isSelectedSiteViewOnly },event:{\'change\': $root.handleSiteChange.bind(null, $root)}, visible: $root.showSiteSelector"></mi-site-selector>\r\n                                        </div>\r\n                                    </td>\r\n                                    <!-- /ko -->\r\n                                    <!-- ko foreach:freezedCols -->\r\n                                    <td class="datasheetCell" data-bind="template:{name: controlTemplate() ? \'bulk-\'+controlTemplate() : controlTemplate()} , event: { keyup: function bulkdatasheet_element_onkeyup(data,event){ $root.focusNextRow(data,event,$index,$parentContext.$index);}}"></td>\r\n                                    <!-- /ko -->\r\n                                </tr>\r\n                            </tbody>\r\n\r\n\r\n                        </table>\r\n                    </div>\r\n                    <!-- end of frozen rows\'s frozen columns -->\r\n                    <!-- frozen rows floating columns-->\r\n                    <div class="table-responsive" data-bind="css: {\'datasheet-readonly-container\': isDatasheetReadOnly}">\r\n\r\n                        <table class="table table-cust1 bulk-float-table">\r\n                            <tbody data-bind="foreach:frozenRows">\r\n                                <tr data-bind="css:{\'active\':$data.isSelected}">\r\n\r\n                                    <!-- ko foreach:$data.floatCols -->\r\n                                    <td class="datasheetCell" data-bind="template:{name: controlTemplate() ? \'bulk-\'+controlTemplate() : controlTemplate()} , event: { keyup: function bulkdatasheet_element_onkeyup(data,event){ $root.focusNextRow(data,event,$index,$parentContext.$index);}}"></td>\r\n                                    <!-- /ko -->\r\n                                </tr>\r\n                            </tbody>\r\n\r\n\r\n                        </table>\r\n\r\n                    </div>\r\n                    <!-- end of frozen rows floating columns-->\r\n                </div>\r\n                <!-- end of frozen rows -->\r\n                <!-- floating rows -->\r\n                <div class="floating-rows-container" data-bind="css:\'offset-rows-\'+ frozenRows().length">\r\n\r\n                    <!-- floating rows frozen columns -->\r\n                    <div class="freezed-cols-container pull-left">\r\n                        <table class="table table-cust1">\r\n                            <tbody data-bind="foreach:rows">\r\n                                <!-- ko ifnot:$data.isFrozen() -->\r\n                                <tr data-bind="css:{\'active\':$data.isSelected}">\r\n                                    <td class="status-col">\r\n                                        <span data-bind="attr: {class: entityStatusClass}"></span>\r\n                                    </td>\r\n                                    <td class="row-selector" data-bind="visible:$root.selectMode()">\r\n                                        <div class="checkbox-selectall">\r\n                                            <mi-checkbox class="row-selection" data-bind="miCheckboxProperty:{ checked:$data.isSelected, value:$data.entitykey, disable:$data.isCheckboxDisabled}"> </mi-checkbox>\r\n\r\n                                        </div>\r\n                                    </td>\r\n                                    <!-- ko if: $root.isDatasheetRendered() && $root.isSiteFiltered() && $root.showSiteSelector() -->\r\n                                    <td class="site-selector-container">\r\n                                        <div class="site-filter-component">\r\n                                            <mi-site-selector data-bind="value: $data.siteKey,attr: { readonly: $data.isSelectedSiteViewOnly },event:{\'change\': $root.handleSiteChange.bind(null, $root)},visible: $root.showSiteSelector "></mi-site-selector>\r\n                                        </div>\r\n                                    </td>\r\n                                    <!-- /ko -->\r\n                                    <!-- ko foreach:freezedCols -->\r\n                                    <td class="datasheetCell" data-bind="template:{name:controlTemplate() ? \'bulk-\'+controlTemplate() : controlTemplate()} , event: { keyup: function bulkdatasheet_element_onkeyup(data,event){ $root.focusNextRow(data,event,$index,$parentContext.$index);}}"></td>\r\n                                    <!-- /ko -->\r\n                                </tr>\r\n                                <!-- /ko -->\r\n                            </tbody>\r\n\r\n\r\n                        </table>\r\n                    </div>\r\n                    <!-- end of floating rows frozen columns -->\r\n                    <!-- floating rows floating columns -->\r\n                    <!-- This is the floating section all the time -->\r\n                    <div class="table-responsive" data-bind="css: {\'datasheet-readonly-container\': isDatasheetReadOnly}">\r\n\r\n                        <table class="table table-cust1 bulk-float-table">\r\n                            <tbody data-bind="foreach:rows">\r\n                                <!-- ko ifnot:$data.isFrozen() -->\r\n                                <tr data-bind="css:{\'active\':$data.isSelected}">\r\n\r\n                                    <!-- ko foreach:$data.floatCols -->\r\n                                    <td class="datasheetCell" data-bind="template:{name:controlTemplate() ? \'bulk-\'+controlTemplate() : controlTemplate()} , event: { keyup: function bulkdatasheet_element_onkeyup(data,event){ $root.focusNextRow(data,event,$index,$parentContext.$index);}}"></td>\r\n                                    <!-- /ko -->\r\n                                </tr>\r\n                                <!-- /ko -->\r\n                            </tbody>\r\n                        </table>\r\n\r\n                    </div>\r\n\r\n                    <!-- end of floating rows floating columns -->\r\n                </div>\r\n                <!-- end of floating rows -->\r\n            </div>\r\n            <!-- end of table body section -->\r\n            <!-- table floating sections horizontal scrollbar-->\r\n            <div class="bulk-float-table-scrollbar"></div>\r\n        </div>\r\n\r\n        <!-- end of custom table -->\r\n\r\n        <!--<div class="bulk-datasheet-disabled-overlay" data-bind="visible: isDatasheetReadOnly,style: { top: overlayTop}"></div>-->\r\n\r\n    </div>\r\n\r\n\r\n    <script type="text/html" id="bdf-column-chooser">\r\n        <div class="bdf-column-chooser">\r\n            <div data-bind="" class="bdf-column-chooser-list">\r\n                <div class="list-item">\r\n                    <div data-bind="event:{click:toggleSelectAll},\r\n                    css:{\'dx-checkbox-indeterminate\':layout.selectedColumns().length && layout.selectedColumns().length !== layout.columns().length ,\r\n                        \'dx-checkbox-checked\':layout.selectedColumns().length === layout.columns().length}"\r\n                         class="pull-left dx-select-checkbox dx-datagrid-checkbox-size dx-widget dx-checkbox"\r\n                         tabindex="0" onclick="void(0)">\r\n                        <div class="dx-checkbox-container">\r\n                            <span class="dx-checkbox-icon"></span>\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        <span data-bind="text: layout.translate(\'DS_BULK_COLUMN_CHOOSER_ALLCOLUMNS_CAPTION\')"></span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div data-bind="foreach:layout.columns">\r\n                    <div class="list-item">\r\n                        <div data-bind="event:{click:$parent.toggleSelectColumn.bind($parent.layout,$parent)},\r\n                    css:{ \'dx-checkbox-checked\':$parent.isActive && $parent.isActive($data),\r\n                             \'dx-state-disabled\' :  $data.fieldValue && $data.fieldValue() && $data.fieldValue().required() }"\r\n                             class="pull-left dx-select-checkbox dx-datagrid-checkbox-size dx-widget dx-checkbox"\r\n                             tabindex="0" onclick="void(0)">\r\n                            <div class="dx-checkbox-container">\r\n                                <span class="dx-checkbox-icon"></span>\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <span data-bind="text:$data.columnCaption"></span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="button-control">\r\n                <button class="btn btn-text" data-bind="click:reOrder, text: layout.translate(\'OK\')">  </button>\r\n                <button class="btn btn-text btn-primary" data-bind="click:cancel, text: layout.translate(\'CANCEL\')" style="margin-left:10px;">  </button>\r\n            </div>\r\n        </div>\r\n    </script>    \r\n</div>';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-check-box-template.html',[],function () { return '<script type="text/html" id="bulk-field-check-box-template">\r\n    <div class="checkbox" data-bind="css: { \'has-error\': fieldValue() && !fieldValue().isValid(),\r\n                                            \'hide-field\': fieldValue() && fieldValue().hidden }">\r\n        <mi-checkbox data-bind="miCheckboxProperty:{ checked: fieldValue().computedBoolVal, disable: fieldValue().disabled() || fieldValue().clientDisabled()}"> </mi-checkbox>\r\n        \r\n            <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n               data-bind="visible: !fieldValue().isValid() ,\r\n                    click: fieldValue().showErrorMessage,\r\n                    toolTip: fieldValue().validationMessage()"></i>\r\n            <!--ko if: fieldValue().successMessage() -->\r\n            <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n               data-bind="visible: fieldValue().isValid(),\r\n                    warningMsg: fieldValue().successMessage()"></i>\r\n            <!-- /ko -->\r\n      \r\n\r\n    </div>\r\n</script>\r\n ';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-combo-box-template.html',[],function () { return '<script type="text/html" id="bulk-field-combo-box-template">\r\n\r\n    <div class="form-group-mi-select" data-bind="css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n\r\n        <!-- ko if:(fieldValue().maxNumberOfValues() > 1) -->\r\n        <mi-select data-bind="miproperty:{\r\n                                   selectedOptions: fieldValue()._values,\r\n                                   options: fieldValue().picklist,\r\n                                   optionsValue:\'value\',\r\n                                   optionsText: \'displayValue\',\r\n                                   disabled: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                    multiple: fieldValue().maxNumberOfValues() > 1\r\n                           },event:{selected:function(self, ev, values){\r\n                                fieldValue().values(values);\r\n                            }},\r\n                                   style: {\'backgroundColor\': fieldValue().backColor}"></mi-select>\r\n\r\n        <!-- /ko -->\r\n        <!-- ko ifnot:(fieldValue().maxNumberOfValues() > 1) -->\r\n        <mi-select data-bind="miproperty:{\r\n                                           value: fieldValue().picklistValue,\r\n                                           options: fieldValue().picklist,\r\n                                           optionsValue:\'value\',\r\n                                           optionsText: \'displayValue\',\r\n                                           disabled: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                            multiple: fieldValue().maxNumberOfValues() > 1\r\n                                   },\r\n                                           style: {\'backgroundColor\': fieldValue().backColor}"></mi-select>\r\n        <!-- /ko -->\r\n       \r\n       \r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n           data-bind="visible: fieldValue().isValid(),\r\n                warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n       \r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-date-template.html',[],function () { return '<script type="text/html" id="bulk-field-date-template">\r\n\r\n    <div class="form-group date-template"\r\n         data-bind="css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n\r\n\r\n        <mi-date-time data-bind=" hasFocus: fieldValue().isSelected,\r\n                      attr:{\r\n                        format:fieldValue().dateFormat,\r\n                        \'pick-time\': \'true\',\r\n                        \'use-seconds\': true,\r\n                        disabled: fieldValue().disabled() || fieldValue().clientDisabled()\r\n                      },\r\n                      value:fieldValue().dateValue,\r\n                      style: {\'backgroundColor\': fieldValue().backColor},\r\n                       event: {invalid: $root.setErrorMessageForDate.bind($root, fieldValue()),\r\n                      clear:$root.clearErrorMessageForDate.bind($root,fieldValue())}"\r\n                      ></mi-date-time>\r\n\r\n        \r\n       \r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n           data-bind="visible: fieldValue().isValid(),\r\n                warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n\r\n       \r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-date-alt-template.html',[],function () { return '\r\n<script type="text/html" id="bulk-field-date-alt-template">\r\n\r\n    <div class="form-group date-alt-template"\r\n         data-bind="css: { \'has-error\': fieldValue() && !fieldValue().isValid() },\r\n    ">\r\n      \r\n      \r\n\r\n        <input type="text"\r\n               class="form-control"\r\n               placeholder="---"\r\n               data-bind="event:{focus:$root.renderDateControl.bind($root,$root)},value:fieldValue().convertDate(),\r\n                                disable: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                style: {\'backgroundColor\': fieldValue().backColor},\r\n                                flash: fieldValue().shouldFlash()" />\r\n\r\n\r\n        <button type="button"\r\n                data-bind=" event:{focus:$root.renderDateControl.bind($root,$root)},disable: fieldValue().disabled() || fieldValue().clientDisabled()"\r\n                class="btn btn-icon custom-form-button custom-icon-field-button" style="z-index:0;right:0;margin-top:-38px;">\r\n            <i class="icon-calendar"></i>\r\n        </button>\r\n\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n\r\n\r\n     \r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-radio-template.html',[],function () { return '<script type="text/html" id="bulk-field-radio-template">\r\n\r\n    <div class="checkbox" data-bind="">\r\n        <label>\r\n            <input type="checkbox"\r\n                   data-bind="checked: fieldValue().value,\r\n                              disable: fieldValue().disabled() || fieldValue().clientDisabled()" />\r\n           \r\n        </label>\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-text-area-template.html',[],function () { return '<script type="text/html" id="bulk-field-text-area-template">\r\n                        \r\n    <div class="form-group"\r\n         data-bind="css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n       \r\n\r\n        \r\n        <textarea class="form-control"\r\n                  placeholder="---"\r\n                  data-bind="text: fieldValue().displayValue,\r\n                            value: fieldValue().isSelected() ? fieldValue().value : fieldValue().displayValue,\r\n                            hasFocus: fieldValue().isSelected,\r\n                            disable: fieldValue().disabled,\r\n                            style: {\'backgroundColor\': fieldValue().backColor}, attr: {readonly: fieldValue().clientDisabled}" />\r\n        <button class="btn btn-icon textareaIcon" tabindex="-1"  data-bind="event: {click: function showTextEditor(data){ $root.showTextEditor(data, $index, $parentContext.$index);}}">\r\n            <i class="icon-expand-text-area"></i>\r\n        </button>\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n           data-bind="visible: fieldValue().isValid(),\r\n                warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n       \r\n\r\n\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-hyperlink-template.html',[],function () { return '<script type="text/html" id="bulk-field-hyperlink-template">\r\n\r\n    <div class="form-group"\r\n         data-bind="css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n        <div class="form-control hyperlinkEllipsis" data-bind="html: fieldValue().displayValue,attr:{title:fieldValue().innerText()}"></div>\r\n                                     \r\n\r\n       \r\n        <!--ko if: fieldValue().jsModuleName() && fieldValue().jsModuleName().length -->\r\n        <input type="button"\r\n               class="btn btn-icon custom-bulk-ds-button"\r\n               placeholder="..."\r\n               data-bind="value: \'...\',\r\n                            click: function bulk_datasheet_view_model_showJSModule(data){ $root.showJSModule(fieldValue().key(), fieldValue().entityKey(), fieldValue().clientid(), fieldValue().jsModuleName(), fieldValue().jsModuleParams(), $data, $index, $parentContext.$index);}">\r\n        <!-- /ko -->\r\n            <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n               data-bind="visible: !fieldValue().isValid() ,\r\n                    click: fieldValue().showErrorMessage,\r\n                    toolTip: fieldValue().validationMessage()"></i>\r\n            <!--ko if: fieldValue().successMessage() -->\r\n            <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n               data-bind="visible: fieldValue().isValid(),\r\n                    warningMsg: fieldValue().successMessage()"></i>\r\n            <!-- /ko -->\r\n\r\n    </div>\r\n\r\n</script> ';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-text-template.html',[],function () { return '<script type="text/html" id="bulk-field-text-template">\r\n\r\n    <div class="form-group"\r\n         data-bind="css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n     \r\n       \r\n       \r\n        <input type="text"\r\n               class="form-control"\r\n               placeholder="---"\r\n               data-bind="hasFocus: fieldValue().isSelected,\r\n                              value: fieldValue().isSelected() ? fieldValue().value : fieldValue().disValue,\r\n                                disable: fieldValue().disabled,\r\n                                style: {\'backgroundColor\': fieldValue().backColor},\r\n                                flash: fieldValue().shouldFlash(), attr: { maxLength: fieldValue().dbLength , readonly:fieldValue().clientDisabled}" />\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n            data-bind="visible: fieldValue().isValid(),\r\n                warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n       \r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-select-template.html',[],function () { return '<script type="text/html" id="bulk-field-select-template">\r\n\r\n    <div class="form-group-select">\r\n        <select class="form-control" data-bind="value: fieldValue().picklistValue,\r\n                                           options: fieldValue().picklist,\r\n                                           optionsValue:\'value\',\r\n                                           optionsText: \'displayValue\',\r\n                                           disable: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                           visible:fieldValue(),\r\n                                           style: {\'backgroundColor\': fieldValue().backColor}"></select>\r\n       \r\n            <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n               data-bind="visible: !fieldValue().isValid() ,\r\n                    click: fieldValue().showErrorMessage,\r\n                    toolTip: fieldValue().validationMessage()"></i>\r\n            <!--ko if: fieldValue().successMessage() -->\r\n            <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n               data-bind="visible: fieldValue().isValid(),\r\n                    warningMsg: fieldValue().successMessage()"></i>\r\n            <!-- /ko -->\r\n      \r\n    </div>\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-multivalue-template.html',[],function () { return '<script type="text/html" id="bulk-field-multivalue-template">\r\n\r\n    <div data-bind="css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n\r\n\r\n\r\n        <!-- ko if:(fieldValue().maxNumberOfValues() > 1) -->\r\n\r\n        <mi-multi-value data-bind="miproperty:{\r\n                                        selectedOptions: fieldValue().values,\r\n                                       options: fieldValue().picklist,\r\n                                       optionsValue: \'value\',\r\n                                       optionsText:  \'displayValue\',\r\n                                       disabled: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                       multiple: fieldValue().maxNumberOfValues() > 1\r\n                                       },\r\n                                       style: {\'backgroundColor\': fieldValue().backColor}"></mi-multi-value>\r\n\r\n        <!-- /ko -->\r\n        <!-- ko ifnot:(fieldValue().maxNumberOfValues() > 1) -->\r\n\r\n        <mi-multi-value data-bind="miproperty:{\r\n                                       value: fieldValue().picklistValue,\r\n                                       options: fieldValue().picklist,\r\n                                       optionsValue: \'value\',\r\n                                       optionsText:  \'displayValue\',\r\n                                       disabled: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                       multiple: fieldValue().maxNumberOfValues() > 1\r\n                                       },\r\n                                       style: {\'backgroundColor\': fieldValue().backColor}"></mi-multi-value>\r\n\r\n        <!-- /ko -->\r\n        \r\n       \r\n       \r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n           data-bind="visible: fieldValue().isValid(),\r\n                    warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n       \r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-empty-template.html',[],function () { return '<script type="text/html" id="bulk-field-empty-template">\r\n\r\n    <div class="form-group disabled" data-bind="style:{\'background-color\':\'#eee\',\'min-height\':\'25px\'}">\r\n\r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-multi-text-template.html',[],function () { return '<script type="text/html" id="bulk-field-multi-text-template">\r\n\r\n    <div data-bind="css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n\r\n        <mi-text-ext data-bind="miproperty:{\r\n                           value: fieldValue().value,\r\n                           options: fieldValue().values,\r\n                           disable: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                           },\r\n                           style: {\'backgroundColor\': fieldValue().backColor}"></mi-text-ext>\r\n\r\n\r\n       \r\n       \r\n            <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n               data-bind="visible: !fieldValue().isValid() ,\r\n                    click: fieldValue().showErrorMessage,\r\n                    toolTip: fieldValue().validationMessage()"></i>\r\n            <!--ko if: fieldValue().successMessage() -->\r\n            <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n               data-bind="visible: fieldValue().isValid(),\r\n                    warningMsg: fieldValue().successMessage()"></i>\r\n            <!-- /ko -->\r\n\r\n        \r\n    </div>\r\n\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-jsmodule-template.html',[],function () { return '<script type="text/html" id="bulk-field-jsmodule-template">\r\n\r\n    <div class="form-group"\r\n         data-bind="css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n\r\n\r\n      \r\n        <input type="text"\r\n               style="margin-right: 26px;"\r\n               class="form-control custom-form-text"\r\n               placeholder="..."\r\n               data-bind="hasFocus: fieldValue().isSelected,\r\n                                  value: fieldValue().isSelected() ? fieldValue().jsModuleValue : fieldValue().disValue,\r\n                                    disable: fieldValue().disabled() || fieldValue().clientDisabled(),\r\n                                    style: {\'backgroundColor\': fieldValue().backColor},\r\n                                    flash: fieldValue().shouldFlash(),\r\n    event: {focus: function bulk_datasheet_view_model_showJSModule(data){ $root.callOnFocus(fieldValue(), $data, $index, $parentContext.$index);}}\r\n                                    ">\r\n        <input type="button"\r\n               class="btn btn-icon custom-bulk-ds-button"\r\n               placeholder="..."\r\n               data-bind="value: \'...\',\r\n                            click: function bulk_datasheet_view_model_showJSModule(data){ $root.showJSModule(fieldValue().key(), fieldValue().entityKey(), fieldValue().clientid(), fieldValue().jsModuleName(), fieldValue().jsModuleParams(), $data, $index, $parentContext.$index, fieldValue().jsModuleUseApply);}">\r\n\r\n\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n           data-bind="visible: fieldValue().isValid(),\r\n                warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n\r\n    </div>\r\n\r\n</script>\r\n';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-masked-template.html',[],function () { return '<script type="text/html" id="bulk-field-masked-template">\r\n    <div class="form-group" data-bind="css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n              \r\n\r\n      \r\n        <input type="password" data-bind="hasFocus: fieldValue().isSelected,\r\n                                          value: fieldValue().isSelected() ? fieldValue().value : fieldValue().disValue,\r\n                                          style: {\'backgroundColor\': fieldValue().backColor},\r\n                                          attr:{maxLength: fieldValue().dbLength}" class="form-control" placeholder="---" />\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n           data-bind="visible: fieldValue().isValid(),\r\n                warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n      \r\n    </div>\r\n</script>';});


define('text!platform/datasheets/layout/ui/views/templates/bulk-controls/field-uom-template.html',[],function () { return '<script type="text/html" id="bulk-field-uom-template">\r\n\r\n    <div class="form-group"\r\n         data-bind="css: { \'has-error\': fieldValue() && !fieldValue().isValid() }">\r\n       \r\n        <input type="text"\r\n               class="form-control"\r\n               placeholder="---"\r\n               data-bind="hasFocus: fieldValue().isSelected,\r\n                              value: fieldValue().isSelected() ? fieldValue().value : fieldValue().disValue,\r\n                                disable: fieldValue().disabled,\r\n                                style: {\'backgroundColor\': fieldValue().backColor},\r\n                                flash: fieldValue().shouldFlash(), attr: { maxLength: fieldValue().dbLength , readonly:fieldValue().clientDisabled}" />\r\n        <button type="button"\r\n                placeholder="..."\r\n                data-bind="click: $root.showUOMConversionTool.bind(null, $root),\r\n                 disable: !fieldValue().value() || fieldValue().disabled"\r\n                class="btn btn-icon custom-form-button custom-icon-field-button bulk-uom-button">\r\n            <i class="icon-uom"></i>\r\n        </button>\r\n        <i class="bulk-datasheet-error-indicator icon-node-warning" title=""\r\n           data-bind="visible: !fieldValue().isValid() ,\r\n                click: fieldValue().showErrorMessage,\r\n                toolTip: fieldValue().validationMessage()"></i>\r\n        <!--ko if: fieldValue().successMessage() -->\r\n        <i class="bulk-datasheet-warning-indicator icon-node-warning" title=""\r\n           data-bind="visible: fieldValue().isValid(),\r\n                warningMsg: fieldValue().successMessage()"></i>\r\n        <!-- /ko -->\r\n      \r\n    </div>\r\n\r\n</script>';});

var jQuery=require("jquery"),_=require("lodash"),Device=require("system/hardware/device");!function(a){"use strict";var b=!1,c;"function"==typeof Device&&(c=Object.resolve(Device),b=c.isIE()),a.fn.autoScroll=function(a,c){var d=this;function e(a){d.find(c).scrollLeft(a.currentTarget.scrollLeft)}return d.find(a).off("scroll.autoScroll").on("scroll.autoScroll",b?_.debounce(e,1):e),d},a.fn.touchScroll=function(){var a=this,b=null,c=null,d=null;function e(e){var f=e.originalEvent;b=f.touches[0].clientX,c=f.touches[0].clientY,d=a.scrollLeft()}function f(e){var f=e.originalEvent;if(b&&c){var g=f.touches[0].clientX,h=f.touches[0].clientY,i=b-g,j=c-h;if(Math.abs(i)>Math.abs(j)){var k=d+i;a.scrollLeft(k)}}}function g(a){b=null,c=null,d=null}return this.off("touchstart.touchScroll").on("touchstart.touchScroll",e).off("touchmove.touchScroll").on("touchmove.touchScroll",f).off("touchend.touchScroll").on("touchend.touchScroll",g)},a.fn.gridScroll=function(b){
var c=this,d=".table-responsive",e=".floating-rows-container",f=".freezed-cols-container",g=".freezed-rows-container",h={table:".grid-table",header:".grid-table-header ",body:".grid-table-body",scrollBar:".grid-table-scrollbar",rowSelectorCol:"grid-row-selector",excludeCols:"grid-exclude-col"},i=a.extend(h,b),j=a.Deferred();function k(){var a=c.find(i.body+" "+e+" "+d).height(),b=c.find(i.body+" "+e).height();c.find(i.body).removeClass("has-overflow-rows"),b<a&&c.find(i.table).addClass("has-overflow-rows")}function l(){var b=c.find(i.body+" "+e+" "+d).width(),f=c.find(i.body+" "+e+" "+d+" table"),g=f.width(),h=a("<p/>").css({width:g,height:2});c.find(i.scrollBar).empty().append(h).width(b)}function m(){n(d),n(f)}function n(b){var d=c.find(i.header+" "+b+" table"),f=d.find("tr:first-child th"),h=c.find(i.body+" "+e+" "+b+" table"),j=h.find("tr:first-child td"),k=c.find(i.body+" "+g+" "+b+" table"),l=k.find("tr:first-child td");a(l).add(f).add(j).css({"min-width":"none",
"max-width":"none"});for(var m,n,o,p=0;p<j.length;p++)a(j[p]).hasClass(i.rowSelectorCol)||a(j[p]).hasClass(i.excludeCols)||(n=j[p].clientWidth-j[p].style.paddingLeft-j[p].style.paddingRight,l[p]&&(o=l[p].clientWidth-l[p].style.paddingLeft-l[p].style.paddingRight,o>n&&(n=o),l[p].style.minWidth=n+1+"px",l[p].style.maxWidth=n+1+"px"),f[p].style.minWidth=n+1+"px",f[p].style.maxWidth=n+1+"px",j[p].style.minWidth=n+1+"px",j[p].style.maxWidth=n+1+"px")}return c.is(":visible")&&(m(),l(),k(),c.autoScroll(i.scrollBar,d),c.autoScroll(d,d),c.find(d).touchScroll()),j.resolve(),j.promise()}}(jQuery);
define("platform/datasheets/layout/ui/helpers/gridScroll", function(){});

define('platform/datasheets/layout/ui/bulk-datasheet-view-model',['require','lodash','jquery','knockout','spa/region','spa/ko/knockout-view-model','./bulk-column-view-model','./bulk-row-view-model','./bulk-column-chooser','../services/datasheet-service','system/lang/event','../model/field-value-model','../model/entity-model','../adapters/datasheet-adapter','application/export-service','../model/datasheet-clipboard-model','../adapters/datasheet-field-info-adapter','text!./views/bulk-datasheet.html','./helpers/print-helper','./helpers/js-module-helper','./helpers/ui-helper','system/ui/dialog-view-model','text!./field-control-template-map.json','text!./views/templates/bulk-controls/field-check-box-template.html','text!./views/templates/bulk-controls/field-combo-box-template.html','text!./views/templates/bulk-controls/field-date-template.html','text!./views/templates/bulk-controls/field-date-alt-template.html','text!./views/templates/bulk-controls/field-radio-template.html','text!./views/templates/bulk-controls/field-text-area-template.html','text!./views/templates/bulk-controls/field-hyperlink-template.html','text!./views/templates/bulk-controls/field-text-template.html','text!./views/templates/bulk-controls/field-select-template.html','text!./views/templates/bulk-controls/field-multivalue-template.html','text!./views/templates/bulk-controls/field-empty-template.html','text!./views/templates/bulk-controls/field-multi-text-template.html','text!./views/templates/bulk-controls/field-jsmodule-template.html','text!./views/templates/bulk-controls/field-masked-template.html','text!./views/templates/bulk-controls/field-uom-template.html','system/globalization/translator','application/application-events','system/error/error-message','platform/datasheets/layout/ui/utils','system/knockout/knockout-manager','platform/metadata/services/metadata','system/hardware/device','ui/elements/ref-doc/services/service','./helpers/ref-doc-helper','../../layout/model/uom-conversion-model','system/knockout/knockout-helpers','jquery-ui','ui/elements/checkbox/checkbox-view-model','ui/elements/select/view-model','ui/elements/multi-value/view-model','ui/elements/text-ext/view-model','ui/elements/site-selector/site-selector-element','./helpers/gridScroll','ui/elements/associated-pages-btn/associated-pages'],function(require){"use strict"
;var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("spa/region"),e=require("spa/ko/knockout-view-model"),f=require("./bulk-column-view-model"),g=require("./bulk-row-view-model"),h=require("./bulk-column-chooser"),i=require("../services/datasheet-service"),j=require("system/lang/event"),k=require("../model/field-value-model"),l=require("../model/entity-model"),m=require("../adapters/datasheet-adapter"),n=require("application/export-service"),o=require("../model/datasheet-clipboard-model"),p=require("../adapters/datasheet-field-info-adapter"),q=require("text!./views/bulk-datasheet.html"),r=require("./helpers/print-helper"),s=require("./helpers/js-module-helper"),t=require("./helpers/ui-helper"),u=require("system/ui/dialog-view-model"),v=JSON.parse(require("text!./field-control-template-map.json")),w=require("text!./views/templates/bulk-controls/field-check-box-template.html")+require("text!./views/templates/bulk-controls/field-combo-box-template.html")+require("text!./views/templates/bulk-controls/field-date-template.html")+require("text!./views/templates/bulk-controls/field-date-alt-template.html")+require("text!./views/templates/bulk-controls/field-radio-template.html")+require("text!./views/templates/bulk-controls/field-text-area-template.html")+require("text!./views/templates/bulk-controls/field-hyperlink-template.html")+require("text!./views/templates/bulk-controls/field-text-template.html")+require("text!./views/templates/bulk-controls/field-select-template.html")+require("text!./views/templates/bulk-controls/field-multivalue-template.html")+require("text!./views/templates/bulk-controls/field-empty-template.html")+require("text!./views/templates/bulk-controls/field-multi-text-template.html")+require("text!./views/templates/bulk-controls/field-jsmodule-template.html")+require("text!./views/templates/bulk-controls/field-masked-template.html")+require("text!./views/templates/bulk-controls/field-uom-template.html"),x=require("system/globalization/translator"),y=require("application/application-events"),z=require("system/error/error-message"),A=require("platform/datasheets/layout/ui/utils"),B=require("system/knockout/knockout-manager"),C=require("platform/metadata/services/metadata"),D=require("system/hardware/device"),E=require("ui/elements/ref-doc/services/service"),F=require("./helpers/ref-doc-helper"),G=require("../../layout/model/uom-conversion-model")
;require("system/knockout/knockout-helpers"),require("jquery-ui"),require("ui/elements/checkbox/checkbox-view-model"),require("ui/elements/select/view-model"),require("ui/elements/multi-value/view-model"),require("ui/elements/text-ext/view-model"),require("ui/elements/site-selector/site-selector-element"),require("./helpers/gridScroll"),require("ui/elements/associated-pages-btn/associated-pages");function H(a,b,d,e){var f=this;I.call(this,q),this.kom=Object.resolve(B),this.region=null,this.datasheetService=a,this.translator=Object.resolve(x),this.appEvents=Object.resolve(y),this.exportService=Object.resolve(n),this.printHelper=Object.resolve(r),this.jsModuleHelper=Object.resolve(s),this.uiHelper=Object.resolve(t),this.title=c.observable(""),this.isBulkDatasheet=c.observable(!0),this.isMasterDatasheet=c.observable(!1),this.updatePref=null,this.datasheetKeys=c.observableArray(),this.datasheets=c.observableArray(),this.currentDatasheetKey=c.observable(),
this.currentDatasheetCaption=c.observable(),this.cachedFieldValues=null,this.cachedFamilykey=null,this.assocFamilyKey=c.observable(),this.assocEntityKey=c.observable(),this.isAssociatedPagesDisabled=c.observable(!0),this.currentDatasheet=c.observable(),this.currentEntity=c.observable(),this.currentEntities=c.observable(),this.fieldInfos=c.observableArray(),this.columns=c.observableArray(),this.rows=c.observableArray(),this.currentCellIndex=c.observable(0),this.entities=c.observableArray(),this.ValidateBeforeSave=c.observable(!1),this.isSaveAvailable=c.observable(!0),this.isCopyAvailable=c.observable(!0),this.isPasteEnabled=c.observable(!0),this.isDeleteAvailable=c.observable(!0),this.isHistoryAvailable=c.observable(!0),this.isHistoryDisabled=c.observable(!1),this.isRefDocAvailable=c.observable(!0),this.isRefDocDisabled=c.observable(!0),this.isSingleEntitySelected=c.observable(!1),this.isLinkAvailable=c.observable(!0),this.isUnlinkAvailable=c.observable(!0),
this.isNewAvailable=c.observable(!0),this.isSiteFiltered=c.observable(!1),this.isSelectedSiteViewOnly=c.observable(!1),this.showSiteSelector=c.observable(!0),this.showColumnChooser=c.observable(!0),this.assetContextKey=c.observable(),this.kom.subscribe(this.assetContextKey,Ha.bind(f,this)),this.isDatasheetReadOnly=c.observable(!1),this.canEdit=c.observable(!1),this.canPaste=c.observable(!1),this.overlayTop=c.observable("0"),this.showDatasheetSelection=c.observable(!0),this.oldEntity=null,this.isDatasheetRendered=c.observable(!1),this.isReadOnly=c.observable(!1),this.loadedFromCache=c.observable(""),this.predEntitySiteKey=c.observable(""),this.layoutRendered=new j,this.entityRendered=new j,this.fieldValueChanged=new j,this.currentEntityChanged=new j,this.datasheetSaved=new j,this.datasheetNew=new j,this.datasheetDelete=new j,this.datasheetHistory=new j,this.datasheetRefDoc=new j,this.hasSelectionChanged=new j,this.unlinkEntities=new j,this.datasheetChanged=new j,this.onSiteChange=new j,
this.PreventSiteChangeUpdate=new j,this.ValidateBeforeEveryThing=new j,this.entitySelected=new j,this.selectMode=c.observable(!1),this.hasSelection=c.observable(!0),this.selectAll=c.observable(!1),this.selectedEntities=c.observableArray([]),this.selectedRows=c.observableArray([]),this.frozenRows=this.kom.computed(Ga.bind(null,f)),this.currentEntityChangedSubscription=this.kom.subscribe(this.currentEntity,ha.bind(null,this)),this.currentEntityBeforeChangeSubscription=this.kom.subscribe(this.currentEntity,ga.bind(null,this),null,"beforeChange"),this.useNativeSelect=c.observable(!1),this.siteSelector=[],this.pageChangeEvent=new j,this.preventPageChange=!1,this.pageSelector=c.observable("1"),this.kom.subscribe(this.pageSelector,Oa.bind(null,this)),this.pageSize=e,this.minPage=1,this.maxPage=c.observable(),this.pageOptions=c.observableArray(),this.totalRows=void 0===b?d:b.length,this.updatePageCount(this.totalRows),this.queryColumns=[],this.selectedColumns=c.observableArray([]),
this.columnsToView=c.observableArray([]),this.focusedColumn=null,this.frozenColsKeys=c.observableArray([]),this.freezedCols=c.computed(Pa.bind(f,f)),this.floatCols=c.computed(Ra.bind(f,f)),f.uiHelper.attachTemplatesForBulk(f,w),f.util=Object.resolve(A),this.device=Object.resolve(D),this.isRefDocFamily=c.observable(!1),this.canDownloadRefDoc=c.observable(!1),this.refDocService=Object.resolve(E),this.refDocHelper=Object.resolve(F),this.entitiesReference=null}var I=Object.inherit(e,H);H.dependsOn=[i],H.prototype.setErrorMessageForDate=function(a){a.errorMessage(this.translator.translate("FORMAT_IS_NOT_VALID"));for(var b=0;b<this.entitiesReference.length;b++)if(this.entitiesReference[b].key===a.entityKey())for(var c=this.entitiesReference[b].fields,d=0;d<c.length;d++)c.models[d].id===a.id()&&(c.models[d].attributes.errorMessage=this.translator.translate("FORMAT_IS_NOT_VALID"))},H.prototype.clearErrorMessageForDate=function(a){a.errorMessage(this.translator.translate(""))
;for(var b=0;b<this.entitiesReference.length;b++)if(this.entitiesReference[b].key===a.entityKey())for(var c=this.entitiesReference[b].fields,d=0;d<c.length;d++)c.models[d].id===a.id()&&(c.models[d].attributes.errorMessage="")};function J(a,b){for(var c=[],d=0;d<a.maxPage();d++)c.push({text:d*a.pageSize+1+" - "+((d+1)*a.pageSize<b?(d+1)*a.pageSize:b),value:d+1});return c}H.prototype.updatePageCount=function a(b){var c=this;c.maxPage(Math.ceil(b/c.pageSize)),c.pageOptions(J(this,b))},H.prototype.activate=function a(){},H.prototype.translate=function a(b){return this.translator.translate(b)},H.prototype.attach=function a(c){I.prototype.attach.call(this,c),this.region=c,b(window).on("resize",this.handleScrolling.bind(this,this))},H.prototype.detach=function a(c){I.prototype.detach.call(this,c),b(window).off("resize",this.handleScrolling.bind(this,this))},H.prototype.setTitle=function a(b){this.title(b)},H.prototype.handleSiteChange=function a(b,c,d){
c.entitykey&&b.onSiteChange.raise(c.entitykey(),d.originalEvent.detail.value)},H.prototype.newDatasheet=function a(){this.datasheetNew.raise()},H.prototype.saveDatasheet=function a(){this.datasheetSaved.raise(this.entities())},H.prototype.saveDatasheet2=function a(){this.ValidateBeforeEveryThing.raise(this)},H.prototype.deleteDatasheet=function a(){this.datasheetDelete.raise(this.selectedEntities())},H.prototype.toggleSelectMode=function a(){this.selectMode(!this.selectMode()),this.region&&this.region.$element&&Ua(this)},H.prototype.unlinkRelatedEntities=function a(){this.unlinkEntities.raise()},H.prototype.showEditMode=function a(){this.isDatasheetReadOnly(!1)},H.prototype.print=function a(){C.retrieveFamilyReports(this.cachedFamilykey).done(Va.bind(null,this))},H.prototype.showDatasheet=function a(c,d,e,f){var g=this,h=b.Deferred(),i=b.Deferred(),j,k,l,m,n,o;g.updatePref=f
;for(var p=0;p<this.entitiesReference.length;p++)for(var q=this.entitiesReference[p].fields,r=0;r<q.length;r++)"Date"===q.models[r].attributes.dataType&&(q.models[r].attributes.errorMessage="");return e?g.cachedFieldValues=e.slice():e=g.cachedFieldValues.slice(),d?g.cachedFamilykey=d:d=g.cachedFamilykey,g.assocFamilyKey(d),o=h.then(K.bind(null,g,d)).then(L.bind(null,g,c)).then(M.bind(null,g,"BULKDSFROZENCOLS")).then(N.bind(null,g)).then(M.bind(null,g,"BULKDSCOLCHOOSER")).then(O.bind(null,g)).then(P.bind(null,g)).then(Q.bind(null,g)).then(R.bind(null,g)).then(S.bind(null,g,e,i)).fail(T.bind(null,g,i)),h.resolve(),i};function K(a,b){return a.datasheetService.getDatasheets(b)}function L(a,c,d){var e=b.Deferred();return a.isAllDatasheetsHidden=a.uiHelper.isAllDatasheetsHidden(d),a.isAllDatasheetsHidden?e.reject():U(a,c,d),e.resolve(),e}function M(a,b){return a.datasheetService.getBDFLayoutPreferences(a.currentDatasheetKey(),b)}function N(a,b){a.frozenColsKeys(b)}function O(a,b){
a.excludedColumnsKeys=b}function P(a){return a.datasheetService.getBulkDatasheet(a.currentDatasheetKey(),a.updatePref)}function Q(a,b){ia(a,b),la(a)}function R(a){return a.datasheetService.getFieldInfo(a.currentDatasheet().familyKey())}function S(a,b,c,d){ja(a,d),Aa(a),a.kom.subscribe(a.currentDatasheetKey,ba.bind(null,a)),aa(a,b),V(a,d,b),c.resolve()}function T(a,c){a.isAllDatasheetsHidden?a.isMasterDatasheet()?c.reject():(a.throwException(a.translate("DS_DATASHEET_NOT_CONFIGURED_MESSAGE")),b(".bdf-container h4.bulkTitle").css("display","none")):(a.throwException(a.translate("DS_LOAD_DATASHEET_FAIL_EXCEPTION")),c.reject())}function U(b,c,d){var e=0,f=!1,g;if(void 0!==c&&"string"==typeof c)for(e=0;e<d.length;e++)if(d[e].id===c){c=d[e].key;break}for(e=0;e<d.length;e++)d[e].isMasterDetail||d[e].isHidden||(b.datasheets.push(d[e]),b.datasheetKeys.push({key:d[e].key,caption:d[e].caption}),d[e].lastViewed===!0?(b.currentDatasheetKey(c||d[e].key),
f=!0):d[e].isDefault===!0&&(b.currentDatasheetKey(c||d[e].key),f=!0));f||(b.currentDatasheetKey(c||b.datasheets()[0].key),f=!0),g=a.find(d,function(a){return a.key===b.currentDatasheetKey()}),b.currentDatasheetCaption(g.caption)}function V(c,d,e){var f,h=[],i=[],j=c.rows(),k,l,m=b.Deferred();for(k=0;k<e.length;k++)f=new g(e[k].entitykey,e[k].clientid,c,e[k].siteKey),0!==e[k].entitykey?f=e[k].isDirty?_(f,"dirty"):_(f,"clean"):(f=e[k].isDirty?_(f,"new-dirty"):_(f,"new-clean"),0===e[k].entitykey&&c.showSiteSelector()&&i.push({entity:e[k],index:k}),f.isCheckboxDisabled(!0)),c.attachEntityToLayout(e[k].entitykey,e[k].fields,k,e[k].clientid,e[k].isAuditable),ra(c,k,f),h.push(f);return Y(j,h),c.rows(h),X(c),i&&i.length&&a.each(i,function(a){Z(c,a.entity,!0,a.index)}),a.delay(function(){Ua(c).done(W.bind(null,m))},10),m.promise()}function W(a){a.resolve()}function X(a){a.selectedEntities=a.kom.computed(Ca.bind(null,a)),a.selectedRows=a.kom.computed(Fa.bind(null,a)),
a.kom.subscribe(a.selectedEntities,Da.bind(null,a)),a.kom.subscribe(a.selectAll,Ea.bind(null,a))}function Y(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(a[c].entitykey().toString()===b[d].entitykey().toString()){b[d].isSelected(a[c].isSelected()),b[d].isFrozen(a[c].isFrozen());break}return b}function Z(a,b,c,d){c&&Ba(a);var e=a.region.$element.find("mi-site-selector"),f=d>=0?d:e.length-1;if(e.length){var g=e[f];c||(a.siteSelector.push(g),Element.upgrade(g)),0!==b.entitykey||"0"!==b.siteKey&&a.loadedFromCache()||""===a.predEntitySiteKey()||!a.showSiteSelector()?0===b.entitykey&&!a.predEntitySiteKey()&&"0"===b.siteKey&&a.showSiteSelector()?(a.handlePreventSiteChangeUpdate(a,f,b.siteKey),g.selectDefaultSite()):0===b.entitykey&&"0"!==b.siteKey&&a.showSiteSelector()&&$(a,f,b.siteKey):c?$(a,f,b.siteKey):$(a,f,a.predEntitySiteKey())}}function $(a,b,c){a.rows&&a.rows()&&(a.handlePreventSiteChangeUpdate(a,b,c),a.rows()[b].siteKey(c))}function _(a,b){return a.entityStatus(b),a}
function aa(b,c){var d=0;a.each(c,function(b){a.each(b.fields,function(a){a.options.picklist&&d++})}),d>20&&b.useNativeSelect(!0)}H.prototype.throwException=function a(b){var c=new z(1,b,"platform/datasheets/layout/ui/bulk-datasheet-view-model.js");this.appEvents.errorOccured.raise(this,c)},H.prototype.setQueryColumns=function a(b,c){var d,e,f,g;for(d=0;d<b.length;d++)e={},g=b[d],e.columnCaption=""===g.getAlias()?g.getFieldId():g.getAlias(),e.columnFieldKey=g.getFieldId().replace(/\[|\]/g,""),f=Wa(c,e.columnFieldKey),f?Xa(e,f):Ya(e,g),this.queryColumns.push(e)},H.prototype.setErrorAndReturnErrorFlag=function a(b,c){var d=this,e=!1;return d.util.clearAllErrorNotifications(b),e=d.util.setErrorAndReturnErrorFlag("bulk",b,c)};function ba(a){a.datasheetChanged.raise()}H.prototype.executeDatasheetChanged=function a(c){var d=b.Deferred(),e=b.Deferred(),f=this,g,h,i;return i=c?c:f.cachedFieldValues.slice(),f.isDatasheetRendered(!1),g=d.then(function(){
return f.datasheetService.getBulkDatasheet(f.currentDatasheetKey(),f.updatePref)}).then(function(a){if(0===a.length||f.uiHelper.isAllDatasheetsHidden(a))return void f.throwException(f.translate("DS_DATASHEET_NOT_CONFIGURED_MESSAGE"));f.currentDatasheetCaption(a.caption),ia(f,a),la(f)}),h=g.then(function(){return f.datasheetService.getFieldInfo(f.currentDatasheet().familyKey())}).then(function(a){ja(f,a),Aa(f),f.entities([]),f.siteSelector=[],V(f,a,i).done(W.bind(null,e))}).done(function(){}).fail(function(){f.throwException(f.translate("DS_LOAD_DATASHEET_FAIL_EXCEPTION")),e.reject()}),d.resolve(),e},H.prototype.attachEntityToLayout=function a(b,c,d,e,f){var g=c.length,h,i=[],j,m=this;for(h=0;h!==g;h++)i.push(new k(c[h].fieldKey,c[h].fieldId,c[h].fieldValue,c[h].fieldDisplayValue,{required:c[h].options.required,disabled:c[h].options.disabled,unitOfMeasure:c[h].options.unitOfMeasure,unitOfMeasureKey:c[h].options.unitOfMeasureKey,picklist:c[h].options.picklist,
backColor:c[h].options.backColor,jsModuleName:c[h].options.jsModuleName,jsModuleParams:c[h].options.jsModuleParams,popJSModuleOnFocus:c[h].options.popJSModuleOnFocus,addParseValueParam:c[h].options.addParseValueParam,dependentFields:c[h].options.dependentFields,isPicklistRestricted:c[h].options.isPicklistRestricted,maxNumberOfValues:c[h].options.maxNumberOfValues,values:c[h].options.values,format:c[h].options.format,dbLength:c[h].options.dbLength,behaviors:c[h].options.behaviors},e,b));j=new l(i,b,e,f),m.entities.push(j),m.entities()[d].fieldValueChanged.add(ka.bind(null,this))},H.prototype.updateFieldValue=function b(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=0,w=0,x,y=[],z=null,A=this;if(this.entities()&&(x=a.find(this.entities(),function(a){return void 0===c.clientid?a.key===c.key:a.clientid===c.clientid}),y=x.fieldValues()),t)for(v=0;v!==y.length;v++){if(null!==n)for(w=0;w!==n.length;w++)y[v].key().toString()!==n[w]&&y[v].key()!==n[w]||y[v].clientDisabled(!1)
;y[v].key().toString()===d.toString()&&y[v].clientDisabled(!1)}for(v=0;v!==y.length;v++){if(y[v].key().toString()===d||y[v].key()===d){z=y[v];break}y[v].changedFromView(!0)}ca(z,x,{newValue:e,newValues:f,newDisplayValue:g,picklist:h,isDisabled:i,isRequired:j,errorMessage:k,backColor:l,maxNumberOfValues:m,jsModuleName:o,jsModuleParams:p,popJSModuleOnFocus:q,addParseValueParam:r,stopPropagate:t,format:s,entityKey:c.key,clientid:c.clientid,successMessage:u})};function ca(b,c,d){var e=0;b&&(d.stopPropagate&&b.changedFromView(!1),b.value(d.newValue),a.isEqual(b.values(),d.newValues)||(b.values(d.newValues),b._values(d.newValues)),b.displayValue(d.newDisplayValue),b.disabled(d.isDisabled),b.required(d.isRequired),b.errorMessage(d.errorMessage),b.backColor(d.backColor),b.maxNumberOfValues(d.maxNumberOfValues),b.handleDateFormat(d.format),b.successMessage(d.successMessage),
c.fieldValues()[e].isDateControl()&&/^\d{1,2}\/\d{1,2}\/\d{1,4} \d{1,2}:\d{2}:\d{2} AM|PM$/.test(d.newValue)&&c.fieldValues()[e].handleDate(),void 0!==b.jsModuleName&&b.jsModuleName()&&null!==b.jsModuleName()&&b.jsModuleName(d.jsModuleName),void 0!==b.jsModuleParams&&b.jsModuleParams()&&null!==b.jsModuleParams()&&b.jsModuleParams(d.jsModuleParams),void 0!==b.popJSModuleOnFocus&&b.popJSModuleOnFocus()&&null!==b.popJSModuleOnFocus()&&b.popJSModuleOnFocus(d.popJSModuleOnFocus),void 0!==b.picklist&&b.picklist(b.createPickList(d.picklist)),b.changedFromView(!0),b.entityKey(d.entityKey),b.clientid(d.clientid))}H.prototype.updateRow=function a(b,c,d){var e=this,f;if("delete"===b)f=e.deleteRow(c);else if("new"===b){for(var g=!1,h=0;h<e.rows().length;h++)"new-clean"===e.rows()[h].entityStatus()&&(g=!0);!g&&e.isNewAvailable()&&(f=e.addNewRow(c))}else"status"===b?(f=e.getRowByKey(c),f.entityStatus(d)):"save"===b?(e.entities()[d].key=c.key,e.entities()[d].clientid=void 0,
e.rows()[d].entitykey(c.key),0!==c.key&&e.rows()[d].isCheckboxDisabled(!1)):"clientid"===b&&(e.entities()[0].clientid=c.clientid,e.rows()[0].clientid(c.clientid),0!==c.key&&void 0!==c.key||e.rows()[0].isCheckboxDisabled(!0))},H.prototype.addNewRow=function a(b){var c=this,d,e=c.rows().length;d=new g(b.entitykey,b.clientid,c,b.siteKey),d.entityStatus("new-clean"),d.isCheckboxDisabled(!0),c.cachedFieldValues.push(b),c.attachEntityToLayout(b.entitykey,b.fields,e,b.clientid,b.isAuditable),ra(c,e,d),c.rows.push(d),Z(c,b,!1)},H.prototype.handlePreventSiteChangeUpdate=function a(b,c,d){d&&b.PreventSiteChangeUpdate.raise(c,d)},H.prototype.deleteRow=function a(b){var c=this,d,e,f;for(f=0;f<c.rows().length;f++)if(c.rows()[f].entitykey().toString()===b.toString()){d=c.rows()[f],e=f;break}for(c.rows.remove(d),f=0;f<c.entities().length;f++)if(c.entities()[f].key.toString()===b.toString()){d=c.entities()[f],e=f;break}return c.entities.remove(d),d},H.prototype.getRowByKey=function a(b){
var c=this,d=c.rows(),e,f;if(0!==b.key&&"0"!==b.key){for(f=0;f<d.length;f++)if(d[f].entitykey().toString()===b.key.toString()){e=d[f];break}}else for(f=0;f<d.length;f++)if(d[f].clientid()==b.clientid){e=d[f];break}return e},H.prototype.dispose=function a(){this.currentEntity()&&this.currentEntity().dispose(),this.layoutRendered.remove(),this.entityRendered.remove()},H.prototype.renderDateControl=function c(d,e,f){if(!e.fieldValue().disabled()){var g=b(f.currentTarget).closest("td");e.controlTemplate(v.Date),e.fieldValue().handleDate(),a.delay(function(){var a=b(g).find("input.form-control");a.trigger("focus"),a.on("keypress keydown",da.bind(null,d))},10)}};function da(a,b){a&&a.device&&a.device.isMobile()&&b.preventDefault()}H.prototype.changeColumns=function b(){var c=this,d=c.rows(),e=d.length,f=[],g=!0
;(g=!ea(a.map(c.columnsToView(),"columnFieldKey"),a.map(c.selectedColumns(),"columnFieldKey")))&&(c.selectedColumns().length!==c.columns().length&&(f=a.difference(a.map(c.columns(),"columnFieldKey"),a.map(c.selectedColumns(),"columnFieldKey"))),c.datasheetService.updateBDFLayoutPreferences(c.currentDatasheetKey(),"BULKDSCOLCHOOSER",f).done(function(){c.excludedColumnsKeys=f,c.columnsToView(oa(c.selectedColumns()));for(var b=0;b<e;b++)ra(c,b,d[b]);a.defer(Ua.bind(null,c))}).fail(function(){throw"Failed to save bulk datasheet layout preferences"}))};function ea(b,c){return b.length===c.length&&a.every(b,fa.bind(null,c))}function fa(b,c){return a.includes(b,c)}function ga(a,b){a.oldEntity=b}function ha(a,b){a.oldValue&&a.oldValue.dispose(),b.fieldValueChanged.add(ka.bind(null,a)),a.currentEntityChanged.raise(b,a.oldEntity)}function ia(a,b){var c=m.toModelObject(b);a.currentDatasheet(c)}function ja(a,c){var d=b.map(c,function(a){return p.toModelObject(a)});a.fieldInfos(d)}
function ka(b,c,d,e,f,g,h,i){var j=0,k=0,l,m=[];for(b.entities()&&(l=a.find(b.entities(),function(a){return void 0===g?a.key===c:a.clientid===g}),m=l.fieldValues()),j=0;j!==m.length;j++){for(k=0;k!==h.length;k++)m[j].key().toString()!==h[k]&&m[j].key()!==h[k]||m[j].clientDisabled(!0);m[j].key()!==d||m[j].dateValue()||null===m[j].dateValue()||m[j].clientDisabled(!0)}for(var n=0;n<b.entitiesReference.length;n++)for(var o=b.entitiesReference[n].fields,p=0;p<o.length;p++)o.models[p].attributes.key===d&&(o.models[p].attributes.errorMessage="");b.fieldValueChanged.raise(c,d,e,f,g,i),b.handleScrolling()}function la(a){var c={};c=0!==a.queryColumns.length?qa(a.queryColumns):a.currentDatasheet().columns;var d=b.map(c,function(b){return new f(b,a.isReadOnly())});if(a.columns(d),a.excludedColumnsKeys.length){var e=na(a);a.selectedColumns(oa(e)),a.columnsToView(oa(e))}else a.selectedColumns(oa(d)),a.columnsToView(oa(d));ma(a)}function ma(a){var b=o.getData()
;b&&a.cachedFamilykey.toString()===b.familykey.toString()&&(a.isReadOnly()||o.isEmpty()||a.canPaste(!0))}function na(b){for(var c=b.columns(),d=a.difference(a.map(c,"columnFieldKey"),b.excludedColumnsKeys),e=[],f,g=0;g<d.length;g++)(f=a.find(c,pa.bind(null,d[g])))&&e.push(f);return e}function oa(a){return[].concat(a)}function pa(a,b){return b.columnFieldKey===a}function qa(a){var b=[],c;for(c=0;c<a.length;c++)a[c].isVisible&&b.push(a[c]);return b}function ra(a,b,c){var d=0;c.cols([]);var e=a.selectedColumns(),f=e.length;c.addColumns(e),sa(a,b,c)}function sa(a,b,c){var d=0,e,f=a.entities()[b],g;for(d=0;d!==c.cols().length;d++)e=va(a,c.cols()[d]),g=wa(a,f,c.cols()[d],c),c.cols()[d].fieldValue(g),xa(a,c.cols()[d],g,e),g&&g.inputType(e)}function ta(a,b){a.entityRendered.raise()}function ua(a,b){var c=0,d=0,e,f;for(e=a.entities()[b],c=0;c!==a.rows()[b].cols().length;c++)for(d=0;d!==e.fieldValues().length;d++)if(e.fieldValues()[d].id()==a.rows()[b].cols()[c].columnFieldKey){
f=e.fieldValues()[d],xa(a,a.rows()[b].cols()[c],f);break}}function va(a,b){var c;if("-1"===b.columnFieldKey.toString())c="Empty";else{var d=0;for(d=0;d!==a.fieldInfos().length;d++)if(a.fieldInfos()[d].fieldId.toString()===b.columnFieldKey.toString()){c=a.fieldInfos()[d].inputType;break}}return c}function wa(a,b,c,d){for(var e,f=b.fieldValues(),g=0;g<f.length;g++)if(f[g].id().toString()===c.columnFieldKey.toString()&&b.key.toString()===d.entitykey().toString()){e=f[g],c.fieldValue(e);break}return e}function xa(a,b,c,d){d=d||null,c&&c.isMaskedField===!0?d="MaskedTextBox":c&&void 0!==c.picklist?d=a.useNativeSelect()&&parseInt(c.maxNumberOfValues())<2&&c.isPicklistRestricted()?"Select":c.isPicklistRestricted()?"ComboBox":"MultiValue":c&&parseInt(c.maxNumberOfValues())>1?d="MultiText":c&&c.displayValue().indexOf("href")>0?d="Hyperlink":c&&void 0!==c.uomKey()&&"-1"!==c.uomKey()?d="UOMTextbox":c&&c.jsModuleName()&&c.jsModuleName().length&&(d="JSModule"),"Date"===d&&(d="DateAlt"),
b.controlTemplate(v[d]||null),b.fieldValue(c),"field-date-template"===b.controlTemplate()&&c.handleDate()}H.prototype.handleOverlay=function a(){ya(this)};function ya(a){var c=0,d,e,f,g;a.isDatasheetReadOnly()&&a.containerEl&&(d=b(a.containerEl).find(".freezed-cols-container .table.table-cust1"),d.length>0&&(c=b(d[0]).width()),e=b(a.containerEl).find(".table-responsive .table.table-cust1").width()+c,b(a.containerEl).find(".bulk-datasheet-disabled-overlay").width(e),(f=b(a.containerEl).find(".datasheet-layout-container .bulk-datasheet-header-container").height()+10)&&(g=b(a.containerEl).find(".datasheet-layout-container").height(),za(a.region.$element.find(".datasheet-layout-container .table-responsive"))?b(a.containerEl).find(".bulk-datasheet-disabled-overlay").height(g-f-37):b(a.containerEl).find(".bulk-datasheet-disabled-overlay").height(g-f-20),a.overlayTop(f+"px")))}function za(a){return 0!==a.length&&a[0].clientWidth<a[0].scrollWidth}function Aa(a){a.layoutRendered.raise(),
a.isDatasheetRendered(!0),a.uiHelper.addMoreOptionsForIcons(a,".bulk-ds-iconbar","bulk")}function Ba(b){var c=b.region.$element.find("mi-site-selector");b.siteSelector=[],c.length&&a.each(c,function(a){b.siteSelector.push(a);var c=a.isSiteViewOnly;Element.upgrade(a),c&&(b.isSelectedSiteViewOnly(c),b.isSaveAvailable(!1))})}H.prototype.afterLoad=function a(){Ba(this)},H.prototype.focusNextRow=function a(c,d,e,f){var g=this.rows(),h=this;switch(d.which){case b.ui.keyCode.LEFT:this.moveLeft(c,g,e,f);break;case b.ui.keyCode.UP:this.moveUp(c,g,e,f);break;case b.ui.keyCode.RIGHT:this.moveRight(c,g,e,f);break;case b.ui.keyCode.DOWN:this.moveDown(c,g,e,f);break;case b.ui.keyCode.SPACE:"field-check-box-template"===c.controlTemplate()&&c.fieldValue().value(!c.fieldValue().value());break;case b.ui.keyCode.TAB:if(b(d.target).hasClass("custom-bulk-ds-button")){if(h.moveRight(c,h.rows(),e,f),e()<h.rows()[f()].cols().length-1){var i=h.rows()[f()].cols()[e()+1]
;"field-text-template"===i.controlTemplate()&&i.fieldValue().jsModuleName()&&i.fieldValue().jsModuleName().length>0&&h.callOnFocus(i.fieldValue(),i,function(){return e()+1},f)}}else"field-text-template"===c.controlTemplate()&&c.fieldValue().jsModuleName()&&c.fieldValue().jsModuleName().length&&h.callOnFocus(c.fieldValue(),c,e,f);break;default:return!0}return!0},H.prototype.moveToNextCell=function a(b,c){c.fieldValue().isSelected(!0)},H.prototype.moveLeft=function a(b,c,d,e){var f,g=this,h;h=g.freezedCols()&&g.freezedCols().length?d()+g.freezedCols().length:d(),f=c[e()].cols()[h-1],h>0&&f.fieldValue().isSelected(!0)},H.prototype.moveRight=function a(b,c,d,e){var f,g=this,h;h=g.freezedCols()&&g.freezedCols().length?d()+g.freezedCols().length:d(),f=c[e()].cols()[h+1],h<c[e()].cols().length-1&&(f.fieldValue()?f.fieldValue().isSelected(!0):g.moveRight(null,g.rows(),function(){return h+1},e))},H.prototype.focusCell=function a(b,c,d,e){var f;e&&d&&(f=c[e()].cols()[d()],
f.fieldValue().isSelected(!0))},H.prototype.moveUp=function a(b,c,d,e){e()>0&&c[e()-1].cols()[d()].fieldValue().isSelected(!0)},H.prototype.moveDown=function a(b,c,d,e){e()<c.length-1?c[e()+1].cols()[d()].fieldValue().isSelected(!0):e()===c.length-1&&"new-dirty"===c[e()].entityStatus()&&(this.currentCellIndex(d()),this.datasheetNew.raise())},H.prototype.showTextEditor=function a(b,c,d){var e=this,f=b.fieldValue().showTextEditor.call(b,e.isDatasheetReadOnly());return f.onSave.add(function a(){e.focusCell(b,e.rows(),c,d)}),f.onClose.add(function a(){e.focusCell(b,e.rows(),c,d)}),f},H.prototype.multipleRowSelect=function a(b,c,d){var e;if(c.shiftKey){var f=[];for(e=0;e<this.rows().length;e++)this.rows()[e].isSelected()&&f.push(e);if(0!==f.length)if(d()<f[0])for(e=d()+1;e<f[0];e++)this.rows()[e].isSelected(!0);else if(d()>f[f.length-1])for(e=f[f.length-1];e<d();e++)this.rows()[e].isSelected(!0)}},H.prototype.showHistory=function a(){this.datasheetHistory.raise(this.selectedEntities())},
H.prototype.showRefDocs=function a(){this.datasheetRefDoc.raise(this.selectedEntities())};function Ca(a){var b=[];return c.utils.arrayForEach(a.rows(),function(a){a.isSelected()&&a.entitykey()&&(b.push(a.entitykey()),this.entitySelected.raise(this.entities()))}.bind(a)),b}function Da(a,b){a.hasSelection(!b.length),a.canDownloadRefDoc(!1),1===b.length?(a.isSingleEntitySelected(!0),a.isRefDocFamily()&&0!==b[0]&&Ia(a,b[0])&&a.canDownloadRefDoc(!0)):a.isSingleEntitySelected(!1)}function Ea(a,b){c.utils.arrayForEach(a.rows(),function(a){a.entitykey()&&!a.isReadonly()?a.isSelected(b):a.isSelected(!1)})}function Fa(a){var b=[];return c.utils.arrayForEach(a.rows(),function(a){a.isSelected()&&a.entitykey()&&b.push(a)}.bind(a)),b}function Ga(a){var b=[];return c.utils.arrayForEach(a.rows(),function(a){a.isFrozen()&&b.push(a)}.bind(a)),b}function Ha(a,b){void 0!==b&&null!==b&&""!==b&&(a.siteSelector=a.region.$element.find("mi-site-selector")[0],Element.upgrade(a.siteSelector),
a.siteSelector&&a.siteSelector.selectSiteByAssetKey(b))}H.prototype.getSelectedEntities=function a(){return this.selectedEntities()};function Ia(a,b){var c,d,e,f,g=Ja(a.entities(),b);return c=Ka(g.fieldValues(),"MI_REF_DOCUMENTS_STORE_DOCUM_L"),d=Ka(g.fieldValues(),"MIRD_DOC_PATH_CHR"),e=!(!c.value()||"true"!==c.value().toString().toLowerCase()),f=d.value(),e&&""!==f}function Ja(b,c){return a.find(b,function(a){return a.key===c})}function Ka(b,c){return a.find(b,function(a){return a.id()===c})}H.prototype.showJSModule=function a(b,c,d,e,f,g,h,i){var j={key:b,jsModuleName:e,jsModuleParams:f,type:"bulk",entityKey:c,clientID:d,data:g,cellIndex:h,rowIndex:i,fieldKey:b};this.jsModuleHelper.showJSModule(this,j)},H.prototype.callOnFocus=function a(b,c,d,e){var f={key:b.key(),data:c,cellIndex:d,rowIndex:e,type:"bulk",entityKey:b.entityKey(),clientID:b.clientid(),fieldKey:b.key()};this.jsModuleHelper.callOnFocus(this,f,b)},H.prototype.getSelectedRowIndex=function a(){
for(var b=[],c=0;c<this.rows().length;c++)this.rows()[c].isSelected()&&b.push(c);return b},H.prototype.copyDatasheet=function a(){var b=this.entities()[this.getSelectedRowIndex()].fieldValues();o.setData(this.cachedFamilykey,b),this.canPaste(!0)},H.prototype.pasteDatasheet=function a(){for(var b=o.getData(),c=this,d=b.fieldValues,e=0;e<this.rows().length;e++)if("new-clean"===this.rows()[e].entityStatus()){for(var f=0;f<this.rows()[e].cols().length;f++)for(var g=0;g<d.length;g++)if(d[g].id.toString()===this.rows()[e].cols()[f].columnFieldKey.toString()){var h=this.rows()[e].cols()[f].fieldValue();this.updateFieldValue({clientid:this.rows()[e].clientid(),entitykey:this.rows()[e].entitykey(),fields:d,isDirty:!0},h.key(),d[g].value,d[g].values,d[g].displayValue,d[g].picklist,!1,d[g].required,d[g].required?"this is required field":"",d[g].backColor,d[g].maxNumberOfValues,d[g].dependentFields);break}
for(var i=0;i<c.excludedColumnsKeys.length;i++)for(var j=0;j<d.length;j++)if(d[j].id.toString()===c.excludedColumnsKeys[i].toString()){this.updateFieldValue({clientid:this.rows()[e].clientid(),entitykey:this.rows()[e].entitykey(),fields:d,isDirty:!0},d[j].key,d[j].value,d[j].values,d[j].displayValue,d[j].picklist,!1,d[j].required,d[j].required?"this is required field":"",d[j].backColor,d[j].maxNumberOfValues,d[j].dependentFields);break}}},H.prototype.addMoreOptionsForIcons=function a(){this.uiHelper.addMoreOptionsForIcons(this,".bulk-ds-iconbar","bulk")},H.prototype.setIconOptions=function a(){var c=b.Deferred();return c=this.uiHelper.setIconOptions(this,"bulk")},H.prototype.selectColumn=function a(b){var c=this;c.focusedColumn&&c.focusedColumn.isSelected(!1),c.focusedColumn=b,b.isSelected(!0)},H.prototype.isFrozenColumn=function b(c){var d=this;return d.focusedColumn&&a.indexOf(d.frozenColsKeys(),d.focusedColumn.columnFieldKey)!==-1},H.prototype.freezeColumn=function b(c){var d=this
;if(d.focusedColumn&&d.frozenColsKeys().length<4){var e=a.includes(d.frozenColsKeys(),d.focusedColumn.columnFieldKey),f=oa(d.frozenColsKeys());d.focusedColumn&&!e&&(f.push(d.focusedColumn.columnFieldKey),d.datasheetService.updateBDFLayoutPreferences(d.currentDatasheetKey(),"BULKDSFROZENCOLS",f).done(function(){d.frozenColsKeys.push(d.focusedColumn.columnFieldKey),Ua(d)}).fail(function(){throw"Failed to update Bulk datasheet layout preferences"}))}},H.prototype.unfreezeColumn=function b(c){var d=this;if(d.focusedColumn){var e=a.includes(d.frozenColsKeys(),d.focusedColumn.columnFieldKey),f=oa(d.frozenColsKeys());d.focusedColumn&&e&&(a.pull(f,d.focusedColumn.columnFieldKey),d.datasheetService.updateBDFLayoutPreferences(d.currentDatasheetKey(),"BULKDSFROZENCOLS",f).done(function(){d.frozenColsKeys.remove(d.focusedColumn.columnFieldKey),Ua(d)}).fail(function(){throw"Failed to update Bulk datasheet layout preferences"}))}},H.prototype.openColumnChooser=function a(){
var b=this,c=new h(this),e=new d;c.attach(e);var f=new u(c,b.translate("DATASHEET_REORDER_COLUMNS"),{height:"50%",width:"50%"});c.setDialog(f),f.show()},H.prototype.downloadRefDoc=function a(){var b=this;b.refDocHelper.downloadRefDoc(b,b.selectedEntities()[0])},H.prototype.deallocateMem=function a(){Ma(this),La(this),Na(this),this.kom.dispose(),this.kom=null,this.datasheetService=null,this.translator=null,this.appEvents=null,this.exportService=null,this.printHelper=null,this.jsModuleHelper=null,this.uiHelper=null,this.title=null,this.isBulkDatasheet=null,this.isMasterDatasheet=null,this.datasheetKeys=null,this.datasheets=null,this.currentDatasheetKey=null,this.currentDatasheetCaption=null,this.cachedFieldValues=null,this.cachedFamilykey=null,this.assocFamilyKey=null,this.assocEntityKey=null,this.isAssociatedPagesDisabled=null,this.currentDatasheet=null,this.currentEntity=null,this.currentEntities=null,this.fieldInfos=null,this.columns=null,this.rows=null,this.currentCellIndex=null,
this.entities=null,this.ValidateBeforeSave=null,this.isSaveAvailable=null,this.isCopyAvailable=null,this.isPasteEnabled=null,this.isDeleteAvailable=null,this.isHistoryAvailable=null,this.isHistoryDisabled=null,this.isRefDocAvailable=null,this.isRefDocDisabled=null,this.isSingleEntitySelected=null,this.isLinkAvailable=null,this.isUnlinkAvailable=null,this.isNewAvailable=null,this.isSiteFiltered=null,this.isSelectedSiteViewOnly=null,this.showSiteSelector=null,this.loadedFromCache=null,this.predEntitySiteKey=null,this.assetContextKey=null,this.isDatasheetReadOnly=null,this.canEdit=null,this.canPaste=null,this.overlayTop=null,this.showDatasheetSelection=null,this.oldEntity=null,this.isDatasheetRendered=null,this.isReadOnly=null,this.layoutRendered.remove(),this.entityRendered.remove(),this.fieldValueChanged.remove(),this.currentEntityChanged.remove(),this.datasheetSaved.remove(),this.datasheetNew.remove(),this.datasheetDelete.remove(),this.datasheetHistory.remove(),
this.datasheetRefDoc.remove(),this.hasSelectionChanged.remove(),this.unlinkEntities.remove(),this.datasheetChanged.remove(),this.ValidateBeforeEveryThing.remove(),this.entitySelected.remove(),this.pageChangeEvent.remove(),this.PreventSiteChangeUpdate.remove(),this.onSiteChange.remove(),this.layoutRendered=null,this.entityRendered=null,this.fieldValueChanged=null,this.currentEntityChanged=null,this.datasheetSaved=null,this.datasheetNew=null,this.datasheetDelete=null,this.datasheetHistory=null,this.datasheetRefDoc=null,this.hasSelectionChanged=null,this.unlinkEntities=null,this.datasheetChanged=null,this.ValidateBeforeEveryThing=null,this.entitySelected=null,this.selectMode=null,this.hasSelection=null,this.selectAll=null,this.selectedEntities=null,this.selectedRows=null,this.frozenRows=null,this.useNativeSelect=null,this.siteSelector=null,this.pageChangeEvent=null,this.preventPageChange=null,this.pageSelector=null,this.pageSize=null,this.minPage=null,this.maxPage=null,
this.pageOptions=null,this.totalRows=null,this.queryColumns=null,this.selectedColumns=null,this.columnsToView=null,this.focusedColumn=null,this.frozenColsKeys=null,this.freezedCols=null,this.floatCols=null,this.util=null,this.currentEntityChangedSubscription=null,this.currentEntityBeforeChangeSubscription=null,this.iconOptions=null,this.excludedColumnsKeys=null,this.subscriptions=null,this.view=null,this.iconsMoreOptions=null,this.region=null,this.isRefDocFamily=null,this.refDocHelper=null,this.refDocService=null,this.canDownloadRefDoc=null,this.updatePref=null,this.entitiesReference=null,this.showColumnChooser=null,this.PreventSiteChangeUpdate=null,this.onSiteChange=null,this.device=null};function La(a){var b=a.region.$element.find("mi-more-options-noko"),c;for(c=0;c<b.length;c++)"function"==typeof b[c].deallocateMem&&b[c].deallocateMem()}function Ma(a){var b;for(b=0;b<a.rows().length;b++)a.rows()[b].deallocateMem(),a.rows()[b]=null
;for(b=0;b<a.columns().length;b++)a.columns()[b].deallocateMem(),a.columns()[b]=null}function Na(a){var b;for(b=0;b<a.entities().length;b++)a.entities()[b].fieldValueChanged.remove(),a.entities()[b].deallocateMem(),a.entities()[b]=null}function Oa(a,b){if(a.preventPageChange)return void(a.preventPageChange=!1);a.pageChangeEvent.raise(b)}function Pa(b){var c=[];return a.each(b.frozenColsKeys(),Qa.bind(null,b,c)),c}function Qa(b,c,d){function e(a,b){return b.columnFieldKey===a}var f=a.find(b.columnsToView(),e.bind(null,d));return f&&c.push(f),c}function Ra(b){var c=[];return a.each(b.columnsToView(),Sa.bind(null,b,c)),c}function Sa(b,c,d){function e(a,b){return a.columnFieldKey===b}return a.find(b.frozenColsKeys(),e.bind(null,d))||c.push(d),c}H.prototype.isFrozenRow=function a(b){var c=this;return 1===c.selectedRows().length&&c.selectedRows()[0].isFrozen()},H.prototype.freezeRow=function a(b){var c=this;c.selectedRows()[0].isFrozen(!0),Ua(c)},H.prototype.unfreezeRow=function a(b){
var c=this;c.selectedRows()[0].isFrozen(!1),Ua(c)},H.prototype.freezeRowsByKeys=function b(c){for(var d=this,e=0;e<c.length;e++){a.find(d.rows(),Ta.bind(null,c[e])).isFrozen(!0)}},H.prototype.showUOMConversionTool=function a(b,c){b.uomConversion=Object.resolve(G),b.uomConversion.show(c)};function Ta(a,b){return a.toString()===b.entitykey().toString()}H.prototype.handleScrolling=function a(){Ua(this)};function Ua(a){return a.region.$element.gridScroll({table:".bulk-datasheet-table",header:".bulk-datasheet-table-header ",body:".bulk-datasheet-table-body",scrollBar:".bulk-float-table-scrollbar",rowSelectorCol:"row-selector",excludeCols:"site-selector-container"})}function Va(a,b){a.printHelper.print(a,"bulk",b)}function Wa(b,c){return a.find(b,function(a){return a.id.replace(/\[|\]/g,"")===c})}function Xa(a,b){a.isVisible=b.display}function Ya(a,b){a.isVisible=b.getIsDisplayed()}return H});

define('text!platform/datasheets/layout/ui/views/refdoc-view.html',[],function () { return '<div class="datasheet-refdoc-container">\r\n    <mi-ref-doc data-bind="attr: {entitykey: $root.entityKey}"></mi-ref-doc>\r\n</div>\r\n<footer>\r\n    <button class="btn btn-text pull-right datasheet-refdoc-closebtn" data-bind="click: $root.closeRefDoc, text: $root.translate(\'DS_CLOSE\')"></button>\r\n</footer>\r\n';});

define('platform/datasheets/layout/ui/datasheet-refdoc-view-model',['require','knockout','spa/ko/knockout-view-model','text!./views/refdoc-view.html','system/globalization/translator'],function(require){"use strict";var a=require("knockout"),b=require("spa/ko/knockout-view-model"),c=require("text!./views/refdoc-view.html"),d=require("system/globalization/translator");function e(b){this.contentEl=c,f.call(this,this.contentEl),this.region=null,this.entity=null,this.dialog=null,this.entityKey=a.observable(b),this.translator=Object.resolve(d)}var f=Object.inherit(b,e);e.prototype.attach=function a(b){f.prototype.attach.call(this,b),this.region=b,this.refdocEl=this.region.$element.find("mi-ref-doc")[0],Element.upgrade(this.refdocEl)},e.prototype.translate=function a(b){return this.translator.translate(b)},e.prototype.setDialog=function a(b){this.dialog=b},e.prototype.closeRefDoc=function a(){g(this)};function g(a){a.dialog.closeDialog()}return e});
define('platform/datasheets/bulk-datasheet-manager',['require','lodash','jquery','./layout/ui/bulk-datasheet-view-model','spa/region','../entity/entity-factory','text!./layout/ui/views/spinner.html','system/lang/event','system/lang/converter','./error-dialog/ui/error-dialog-view-model','system/ui/dialog-view-model','./layout/ui/datasheet-history-view-model','./layout/ui/datasheet-refdoc-view-model','logging/feedback-component/feedback-component','system/ui/message-box','system/ui/unsaved-changes-message-box','./layout/services/manager-service','system/globalization/translator','application/application-events','system/error/error-message','platform/metadata/services/metadata','application/application-context','system/ui/busy-indicator','platform/datasheets/layout/ui/datasheet-authentication-dialog-view-model','catalog/services/catalog-service','query/execution/query-execution-engine'],function(require){"use strict"
;var a=require("lodash"),b=require("jquery"),c=require("./layout/ui/bulk-datasheet-view-model"),d=require("spa/region"),e=require("../entity/entity-factory"),f=require("text!./layout/ui/views/spinner.html"),g=require("system/lang/event"),h=require("system/lang/converter"),i=require("./error-dialog/ui/error-dialog-view-model"),j=require("system/ui/dialog-view-model"),k=require("./layout/ui/datasheet-history-view-model"),l=require("./layout/ui/datasheet-refdoc-view-model"),m=require("logging/feedback-component/feedback-component"),n=require("system/ui/message-box"),o=require("system/ui/unsaved-changes-message-box"),p=require("./layout/services/manager-service"),q=require("system/globalization/translator"),r=require("application/application-events"),s=require("system/error/error-message"),t=require("platform/metadata/services/metadata"),u=require("application/application-context"),v=require("system/ui/busy-indicator"),w=require("platform/datasheets/layout/ui/datasheet-authentication-dialog-view-model"),x=require("catalog/services/catalog-service"),y=require("query/execution/query-execution-engine")
;function z(a){this.defaultConfig={functionsavailable:["save","new","delete"],readonly:!1,canedit:!0,hasspinner:!0,showdatasheetselection:!0,loadedfrommodule:!0,showsiteselector:!0,disablesiteselector:!1,columnchooser:!0},this.options=a,this.translator=Object.resolve(q),this.containerEl=a.containerel,this.datasheetkey=a.datasheetkey,this.updatePref=a.updatepref,this.entityObj=[].concat(a.entityobj),this.inEntityFormat=a.inEntityFormat,this.familyKey=a.familykey,this.catalogItemPath=a.catalogitempath,this.assetContextKey=a.assetcontextkey,this.validationCB=a.validationcb||!1,this.predEntityKey=a.predentitykey||"",this.entityFactory=new e,this.appEvents=Object.resolve(r),this.entitySaved=new g,this.entityModified=new g,this.entityDeleted=new g,this.entityCreated=new g,this.unlinkEntities=new g,this.entitySelected=new g,this.pageChangeDone=new g,this.detailDatasheetEditDenied=new g,this.entityIdChanged=new g,this.ValidateBeforeEveryThing=new g,this.noEntitiesToSave=new g,
this.sequenceNumber=1,this.isCreatingNewRow=!1,this.newEntityFlag=!1,this.window=window,this.canInsert=!1,this.canUpdate=!1,this.canView=!1,this.canDelete=!1,this.isSuperUser=!1,this.isMasterDatasheetDirty=!1,this.indicator=Object.resolve(v,"loading-med"),this.pageSize=a.pagesize||100,this.startIndex=0,this.endIndex=this.pageSize,this.catalogService=Object.resolve(x),this.queryColumns=null,this.totalRows=0,this.maxRows=100,this.frozenRowKeys=[],this.viewOnly=!1,this.masterSiteKey=null,this.predEntitySiteKey=null,this.queryColumnDesigns=null}z.prototype.translate=function a(b){return this.translator.translate(b)},z.prototype.getState=function a(){var b;for(b=0;this.entity&&b<this.entity.length;b++)this.detachEntityEventHandlers(this.entity[b]);return A(this)};function A(b){return b.region.$element.find("mi-site-selector").length&&a.each(b.cachedEntity,function(c,d){a.each(b.layout.rows(),function(a,e){
c.key.toString()===a.entitykey().toString()&&d===e&&(b.cachedEntity[d].siteKey=a.siteKey())})}),b.cachedEntity}z.prototype.load=function a(c){var d=this,e=b.Deferred(),f,g,h;return d.setConfig(c),d.config.hasspinner&&(d.indicator.attachTo(this.containerEl.parent()[0]),b(this.containerEl.parent()[0]).find(".busy-indicator-wrap").css("min-height","400px"),d.indicator.show()),g=d.getSecurityPrivPromise(),g.done(function(a){f=d.getEntityPromise(),f.done(function(a){if(d.clearSpinner(),a)if(d.cachedEntity&&(a=d.cachedEntity),a.length>0){d.entity=a,d.familyKey||(d.familyKey=d.entity[0].familyKey);for(var b=0;b<a.length;b++)d.attachEntityEventListeners(a[b]);d.entityFactory.bulkDeleteEvent.add(T.bind(null,d)),d.entityFactory.updateEntitiesEvent.add(U.bind(null,d)),""!==d.predEntityKey?d.getSiteKey().done(function(b){d.predEntitySiteKey=b,B(d,e,a)}):B(d,e,a)}else d.clearSpinner(),d.catalogItemPath&&n.showOk(d.translate("NO_RECORD_MSG"));else e.resolve()}).fail(function(a,b){
b&&403===b.status?n.showOk(b.statusText):d.entityObj&&0===d.entityObj.length&&!d.canInsert?n.showOk(d.translate("DS_ENTITY_NO_INSERT_PRIV"),d.translator.translate("DS_INFORMATION")):d.throwException(d.translate("DS_LOAD_ENTITY_FAIL_EXCEPTION")),e.reject(),d.clearSpinner()})}),e};function B(a,b,c){var d;d=a.renderDatasheet(c),a.layout.isHistoryDisabled(!a.getHistoryStatus(c)),a.layout.isSiteFiltered(a.getSiteFilteredStatus(c)),a.getRefDocStatus(c).done(function(b){a.layout.isRefDocDisabled(!b)}).fail(function(){a.layout.isHistoryDisabled(!0)}),d.done(function(){L(a),a.layout.afterLoad(),M(a),b.resolve(a.entity),a.clearSpinner()}).fail(function(){a.config.ismasterdatasheet||a.throwException(a.translate("DS_RENDER_DATASHEET_FAIL_EXCEPTION")),a.layout.isAllDatasheetsHidden?b.reject(!0):b.reject(),a.clearSpinner()})}z.prototype.changeDatasheet=function a(c,d,e){var f=this,g=b.Deferred();return 0===c.length&&f.canInsert?f.entityFactory.new(e).done(function(a){
null!==f.masterSiteKey&&(a.siteKey=f.masterSiteKey),c.push(a),f.familyKey=c[0].familyKey,C(f,c,d).done(function(){g.resolve(f.entity)})}):C(f,c,d).done(function(){g.resolve(f.entity)}),g};function C(a,c,d){var e,f=b.Deferred();a.setConfig(d),a.entity=c,a.familyKey||(a.familyKey=a.entity[0].familyKey),a.clearSpinner();for(var g=0;g<c.length;g++)a.attachEntityEventListeners(c[g]);return a.entityFactory.bulkDeleteEvent.add(T.bind(null,a)),a.entityFactory.updateEntitiesEvent.add(U.bind(null,a)),e=a.renderDatasheet(c),a.layout.isHistoryDisabled(!a.getHistoryStatus(c)),a.layout.isSiteFiltered(a.getSiteFilteredStatus(c)),e.done(function(){L(a),M(a),f.resolve(a.entity)}).fail(function(){a.throwException(a.translate("DS_RENDER_DATASHEET_FAIL_EXCEPTION")),f.reject()}),f}z.prototype.getEntityPromise=function a(){var c=this,d=b.Deferred()
;return c.entityObj&&0===c.entityObj.length?c.familyKey&&!c.viewOnly?c.createEntity():(c.viewOnly&&(b(".detail-datasheet-container").length?b(".detail-datasheet-container").html(""):b(c.containerEl).html('<div class="empty-detail-datasheet">'+c.translate("NO_RECORD_MSG")+"</div>"),b(".empty-detail-datasheet").show()),d.resolve(!1),d.promise()):h.toBoolean(c.inEntityFormat,"true")?(d.resolve(c.entityObj),d.promise()):c.loadEntity()};function D(a){!a.canView||a.canInsert||a.canUpdate||a.canDelete||(a.viewOnly=!0)}z.prototype.getSecurityPrivPromise=function a(){var c=b.Deferred(),d=this;return d.isSuperUser=u.user.isSuperUser,d.entityObj&&0===d.entityObj.length?d.familyKey&&(isNaN(parseInt(d.familyKey))?t.getEntityFamilyByid(d.familyKey).done(function(a){d.canInsert=a.canInsert,d.canView=a.canView,d.canUpdate=a.canUpdate,d.canDelete=a.canDelete,d.fieldMetadata=a.fields,D(d),c.resolve(a)}):t.getEntityFamilyByKey(d.familyKey).done(function(a){d.canInsert=a.canInsert,d.canView=a.canView,
d.canUpdate=a.canUpdate,d.canDelete=a.canDelete,d.fieldMetadata=a.fields,D(d),c.resolve(a)})):d.catalogItemPath?(d.canInsert=!0,d.canView=!0,d.canUpdate=!0,d.canDelete=!0,c.resolve()):c.resolve(),c.promise()},z.prototype.setConfig=function a(c){var d=this;d.config=c||{},d.config=ma(d.config),b.extend(d.defaultConfig,d.config),d.config=d.defaultConfig,d.validateConfig()},z.prototype.validateConfig=function a(){var b=this;b.entityObj&&0!==b.entityObj||b.familyKey||b.catalogItemPath||b.throwException(b.translate("DS_BULK_VALID_CONFIG_EXCEPTION"))},z.prototype.showSpinner=function a(){this.config.hasspinner&&this.indicator.show()},z.prototype.clearSpinner=function a(){this.config.hasspinner&&this.indicator.hide()},z.prototype.callOnMasterDatasheetDelete=function a(){var c=this,d=b.Deferred();return c.layout&&(c.layout.detach(c.region),d.resolve()),d},z.prototype.unload=function a(c){var d=this,e=b.Deferred();c=c!==!0&&c!==!1||c;var f=d.entityFactory.checkIfEntitiesDirty(d.entity)
;return f.done(function(){d.layout&&d.layout.detach(d.region),e.resolve()}),f.fail(function(){d.isMasterDatasheetDirty===!1&&c?ja().done(function(a){0===a?E(d,e):1===a&&U(d,d.entity).done(E.bind(null,d,e))}).fail(function(){e.reject()}):E(d,e)}),e};function E(a,b){a.layout&&(a.layout.detach(a.region),b.resolve())}z.prototype.setTitle=function a(b){var c=this;c.layout&&c.layout.setTitle(b)},z.prototype.repaint=function a(){var b=this;b.layout&&b.layout.handleScrolling(b)},z.prototype.loadEntity=function a(){var c=b.Deferred(),d=this;if(d.catalogItemPath)d.getBulkQueryData().done(function(a){c.resolve(a)});else{var e=F(d);d.entityFactory.get(e).done(function(a){t.getEntityFamilyByKey(a[0].familyKey).done(function(b){d.canInsert=b.canInsert,d.canView=b.canView,d.canUpdate=b.canUpdate,d.canDelete=b.canDelete,d.fieldMetadata=b.fields,c.resolve(a)}).fail(function(a){c.reject(null,a)})}).fail(function(a){c.reject(null,a)})}return c.promise()},z.prototype.getSiteKey=function a(){
var c=b.Deferred(),d=this;return d.entityFactory.getSiteKey(d.predEntityKey).done(function(a){c.resolve(a)}).fail(function(a){c.reject(null,a)}),c.promise()};function F(b){var c=b.entityObj.length>b.pageSize?b.entityObj.slice(b.startIndex,b.endIndex):b.entityObj;return a.union(c,b.frozenRowKeys)}z.prototype.createEntity=function a(){var c=b.Deferred(),d=this,e=[];return d.canInsert?d.entityFactory.new(d.familyKey).done(function(a){null!==d.masterSiteKey&&(a.siteKey=d.masterSiteKey),e.push(a),c.resolve(e)}).fail(function(a,b){c.reject(a,b)}):c.reject(),c.promise()},z.prototype.updateState=function b(c,d,e){c&&(this.sequenceNumber=a.max(a.compact(a.map(c,"clientid")))+1,d&&(this.entityObj=d),this.cachedEntity=c)},z.prototype.getBulkQueryData=function a(){var c=b.Deferred(),d=this;return 0===d.totalRows?d.getCatalogQueryEntity().done(function(a){d.getCatalogQueryTotalCount(d,a),d.compositeObject=ra(d,a),d.entityFactory.getBulkEntitiesByQuery(d.compositeObject).done(function(a){
c.resolve(a)}).fail(function(a){c.reject(null,a)})}):(d.compositeObject.startRow=d.startIndex,d.entityFactory.getBulkEntitiesByQuery(d.compositeObject).done(function(a){c.resolve(a)}).fail(function(a){c.reject(null,a)})),c.promise()},z.prototype.getCatalogQueryEntity=function a(){var c=b.Deferred(),d=this,e={};return e.suppressPrompts=!1,e.pageSize=100,e.startPage="0",d.catalogService.getCatalogItemKey(d.catalogItemPath).done(function(a){e.catalogItemKey=a,e.sync=!0,d.queyExecutionEngine=new y(e),d.queyExecutionEngine.execute(e).done(function(a){d.queryColumnDesigns=a.queryContainer.columnDesigns,d.queryColumns=a.result.getColumns(),c.resolve(a)})}),c.promise()},z.prototype.getCatalogQueryTotalCount=function a(c,d){var e=b.Deferred(),f={};return f.evalOnly=!0,f.suppressPrompts=!0,f.queryContainer=d.queryContainer,c.queyExecutionEngine=new y(f),c.queyExecutionEngine.execute(f).done(function(a){c.totalRows=a.rowCount}),e.promise()},z.prototype.renderDatasheet=function a(b){
return G(this,b)};function G(a,e){var f=b.Deferred(),g=[];a.layout=Object.resolve(c,a.entityObj,a.totalRows,a.pageSize),a.catalogItemPath&&a.layout.setQueryColumns(a.queryColumns,a.queryColumnDesigns),a.validationCB&&a.layout.ValidateBeforeSave(!0),e.length&&"MI Reference Document"===e[0].familyID&&a.layout.isRefDocFamily(!0),a.region=new d,a.attachLayoutEventListeners(),a.layout.fieldValueChanged.add(R.bind(null,a)),a.region.setElement(a.containerEl),1===u.dbSiteCount&&(a.config.showsiteselector=!1),a.config.showsiteselector||a.layout.showSiteSelector(!1),a.config.disablesiteselector&&a.layout.isSelectedSiteViewOnly(!0),a.config.columnchooser||a.layout.showColumnChooser(!1),a.predEntitySiteKey&&a.layout.predEntitySiteKey(a.predEntitySiteKey),a.cachedEntity&&a.layout.loadedFromCache(!0),a.layout.attach(a.region);for(var h=0;h<e.length;h++)g.push({entitykey:e[h].key,clientid:e[h].clientid,fields:N(a,e[h]),isAuditable:e[h].isAuditable,siteKey:e[h].siteKey})
;return(e[0]&&e[0].useUrlRedirection&&!a.config.loadedfrommodule||a.config.readonly)&&a.layout.isSelectedSiteViewOnly(!0),a.layout.entitiesReference=a.entity,a.config.ismasterdatasheet&&a.layout.isMasterDatasheet(a.config.ismasterdatasheet),a.layout.showDatasheet(a.datasheetkey,a.familyKey,g,a.updatePref).done(function(){var c,d;if(e[0]&&e[0].isSiteFiltered&&0===e[0].siteKey&&a.assetContextKey>0&&a.layout.assetContextKey(a.assetContextKey),a.layout.preventPageChange=a.layout.pageSelector()!==(a.endIndex/a.layout.pageSize).toString(),a.layout.pageSelector((a.endIndex/a.layout.pageSize).toString()),e[0]&&e[0].useUrlRedirection&&!a.config.loadedfrommodule?(a.layout.isDatasheetReadOnly(!0),a.layout.isSaveAvailable(!1),a.layout.isDeleteAvailable(!1),a.layout.isNewAvailable(!1),a.layout.canEdit(!1),a.containerEl&&(a.layout.containerEl=a.containerEl),a.detailDatasheetEditDenied.add(J.bind(null,a))):a.config.readonly?(a.layout.isDatasheetReadOnly(!0),a.layout.canEdit(a.config.canedit),
a.containerEl&&(a.layout.containerEl=a.containerEl),a.detailDatasheetEditDenied.add(J.bind(null,a))):a.layout.isDatasheetReadOnly(!1),a.config.showdatasheetselection&&!a.catalogItemPath||a.layout.showDatasheetSelection(!1),a.cachedEntity)for(var g=0;g<e.length;g++)a.getEntityStatus(e[g],a).done(function(b,c,d){a.layout.updateRow("status",b,c)}.bind(null,e[g]));a.canInsert&&a.entity&&0!==a.entity[0].key?ka.call(null,a):(a.entity[0].clientid=a.sequenceNumber++,a.attachEntityEventListeners(a.entity[0]),a.layout.updateRow("clientid",{clientid:a.entity[0].clientid,key:a.entity[0].key}),0===a.entity[0].key&&a.entityCreated.raise(a.entity[0])),d=b(".datasheet-layout-container mi-date-time"),d.on("keypress keydown",I.bind(null,a)),c=d.css("background-color"),c&&(d.find(".date").css("background-color",c),d.find(".form-control").css("background-color",c)),f.resolve()}).fail(function(){f.reject()}),f}function H(a,b,c){
return a.layout.rows()[b].siteKey()!==c&&(a.layout.rows()[b].preventSiteChangeUpdate=!0,!0)}function I(a,b){a&&a.device&&a.device.isMobile()&&b.preventDefault()}function J(a){var b=a.region.$element.find(".table.table-cust1").width();if(a.region.$element.find(".bulk-datasheet-disabled-overlay").width(b),a.layout.isNewAvailable()){var c=a.region.$element.find(".table-responsive").height();a.region.$element.find(".bulk-datasheet-disabled-overlay").height(c-71)}}function K(a,c,d,e){return b.inArray(c,a.config.functionsavailable)>=0&&(d||e)}function L(a){a.config.functionsavailable&&(a.layout.isSaveAvailable(K(a,"save",a.isSuperUser,a.canUpdate)),a.layout.isDeleteAvailable(K(a,"delete",a.isSuperUser,a.canDelete)),a.layout.isNewAvailable(K(a,"new",a.isSuperUser,a.canInsert)),a.layout.isLinkAvailable(K(a,"link",a.isSuperUser,a.canInsert)),a.layout.isUnlinkAvailable(K(a,"unlink",a.isSuperUser,a.canDelete)),
a.layout.isPasteEnabled(K(a,"copy",a.isSuperUser,a.canInsert)&&K(a,"copy",a.isSuperUser,a.canUpdate)),b.inArray("references",a.config.functionsavailable)<0&&a.layout.isRefDocAvailable(!1),b.inArray("history",a.config.functionsavailable)<0&&a.layout.isHistoryAvailable(!1),b.inArray("copy",a.config.functionsavailable)<0&&a.layout.isCopyAvailable(!1),b.inArray("references",a.config.functionsavailable)>0&&a.entity&&a.entity[0]&&"MI Reference Document"===a.entity[0].familyID&&a.layout.isRefDocAvailable(!1))}function M(a){a.layout.isNewAvailable()||1!==a.entity.length||0===a.layout.rows()[0].entitykey()&&a.layout.rows.pop()}function N(b,c){for(var d=c.fields.models.length,e=[],f,g,h=0;h<d;h++)f=c.fields.models[h].get("key"),g=a.find(b.fieldMetadata,O.bind(null,f)),e.push({fieldKey:f,fieldId:c.fields.models[h].get("id"),fieldValue:c.fields.models[h].get("value"),fieldDisplayValue:c.fields.models[h].get("displayValue"),options:{required:c.fields.models[h].get("isRequired"),
disabled:c.fields.models[h].get("isDisabled"),unitOfMeasure:c.fields.models[h].get("unitOfMeasure"),unitOfMeasureKey:c.fields.models[h].get("unitOfMeasureKey"),picklist:c.fields.models[h].get("pickList"),backColor:c.fields.models[h].get("backColor"),jsModuleName:c.fields.models[h].get("jsModuleName"),jsModuleParams:c.fields.models[h].get("jsModuleParams"),popJSModuleOnFocus:c.fields.models[h].get("popJSModuleOnFocus"),addParseValueParam:c.fields.models[h].get("addParseValueParam"),dependentFields:c.fields.models[h].get("dependentFields"),isPicklistRestricted:c.fields.models[h].get("isPicklistRestricted"),maxNumberOfValues:c.fields.models[h].get("maxNumberOfValues"),values:c.fields.models[h].get("values"),format:c.fields.models[h].get("format"),dbLength:c.fields.models[h].get("dbLength"),behaviors:g?g.behaviors:null}});return e}function O(a,b){return b.key===a}z.prototype.attachEntityEventListeners=function a(b){var c=this;b.entityModified.add(c.onEntityChanged,c),
b.entityIdChanged.add(c.onEntityIdChanged,c)},z.prototype.attachLayoutEventListeners=function a(){var b=this;b.layout.datasheetSaved.add(U.bind(null,b)),b.layout.datasheetDelete.add(la.bind(null,b)),b.layout.datasheetNew.add(ka.bind(null,b)),b.layout.datasheetHistory.add(na.bind(null,b)),b.layout.datasheetRefDoc.add(oa.bind(null,b)),b.layout.unlinkEntities.add(pa.bind(null,b)),b.layout.entitySelected.add(qa.bind(null,b)),b.layout.onSiteChange.add(P.bind(null,b)),b.layout.PreventSiteChangeUpdate.add(H.bind(null,b)),b.layout.ValidateBeforeEveryThing.add(S.bind(null,b)),b.layout.pageChangeEvent.add(Q.bind(null,b)),b.layout.datasheetChanged.add(ha.bind(null,b))};function P(b,c,d){var e,f=a.find(b.entity,function(a){return a.key===c}),g=a.find(b.layout.rows(),function(a){return a.entitykey()===c});if(g&&g.preventSiteChangeUpdate)return void(g.preventSiteChangeUpdate=!1);f&&(e=null===d?"0":d,f.siteKey!==e&&(f.siteKey=e,b.entityFactory.updateEntitySite(f)))}function Q(a,c){var d
;for(d=0;a.entity&&d<a.entity.length;d++)a.detachEntityEventHandlers(a.entity[d]);a.containerEl.find("div.table-responsive").remove(),a.config.hasspinner&&a.indicator.show(),c=parseInt(c),a.endIndex=c*a.layout.pageSize,a.startIndex=(c-1)*a.layout.pageSize;var e=a.layout.isMasterDatasheet(),f=a.layout.isHistoryDisabled(),g=a.layout.isSiteFiltered(),h=a.layout.isRefDocDisabled,i=b.Deferred(),j,k,l=a.layout.frozenRows();a.frozenRowKeys=[];for(var m=0;m<l.length;m++)a.frozenRowKeys.push(l[m].entitykey().toString());return j=a.getEntityPromise(),j.done(function(b){if(a.clearSpinner(),b){a.entity=b,a.familyKey||(a.familyKey=a.entity[0].familyKey);for(var c=0;c<b.length;c++)a.attachEntityEventListeners(b[c]);a.layout&&(a.layout.detach(a.region),a.layout.deallocateMem(),a.layout=null),k=a.renderDatasheet(b),a.layout.isHistoryDisabled(f),a.layout.isSiteFiltered(g),a.layout.isRefDocDisabled(h),k.done(function(){L(a),a.layout.afterLoad(),a.layout.isMasterDatasheet(e),i.resolve(a.entity),
a.clearSpinner(),a.pageChangeDone.raise(a.entity),a.frozenRowKeys.length&&a.layout.freezeRowsByKeys(a.frozenRowKeys)}).fail(function(){a.throwException(a.translate("DS_RENDER_DATASHEET_FAIL_EXCEPTION")),i.reject()})}}).fail(function(b,c){c&&403===c.status?n.showOk(c.statusText):a.throwException(a.translate("DS_LOAD_ENTITY_FAIL_EXCEPTION")),i.reject(),a.clearSpinner()}),i}z.prototype.detachEntityEventHandlers=function a(b){var c=this;b&&(b.entityModified&&b.entityModified.remove(c),b.entityIdChanged&&b.entityIdChanged.remove(c))},z.prototype.throwException=function a(b){var c=new s(1,b,"platform/datasheets/bulk-datasheet-manager.js");this.appEvents.errorOccured.raise(this,c)},z.prototype.confirm=function a(b){return this.window.confirm(b)},z.prototype.getSelectedEntities=function a(){var b=this;if(b.layout)return b.layout.getSelectedEntities()},z.prototype.updateRow=function a(b,c,d){var e=this;if(e.layout)return e.layout.updateRow(b,c,d)},z.prototype.handleOverlay=function a(){
var b=this;b.layout&&b.layout.handleOverlay()};function R(b,c,d,e,f,g,h){var i=!0,j;j=a.find(b.entity,function(a){return void 0===g||0!==a.key?a.key===c:a.clientid===g}),h?b.entityFactory.updateFieldByKey(j,d,e,h):b.entityFactory.updateFieldValue(j,d,e,f,i)}z.prototype.onEntityChanged=function a(c,d,e,f,g,h,i){var j,k,l=this,m;m=e?d.dependentFields:null,i!==!0&&i!==!1||(c.updatedFromModule=i);var n=f?d.value:d.displayValue;if(l.layout&&(l.layout.updateFieldValue(c,d.key,d.value,d.values,n,d.pickList,d.isDisabled,d.isRequired,d.errorMessage,d.backColor,d.maxNumberOfValues,m,d.jsModuleName,d.jsModuleParams,d.popJSModuleOnFocus,d.addParseValueParam,d.format,!0,d.successMessage),l.getEntityStatus(c,l).done(function(a){l.layout.updateRow("status",c,a),l.layout.datasheetNew.raise()})),l.cachedEntity){
for(k=0;k<l.cachedEntity.length;k++)if((void 0===l.cachedEntity[k].clientid||0!==c.key)&&c.key.toString()===l.cachedEntity[k].key.toString()||l.cachedEntity[k].clientid&&l.cachedEntity[k].clientid===c.clientid){l.cachedEntity[k]=b.extend(!0,c,l.cachedEntity[k]);break}}else for(l.cachedEntity=l.entity,k=0;k<l.cachedEntity.length;k++)if(l.cachedEntity[k].clientid&&l.cachedEntity[k].clientid===c.clientid||(void 0===l.cachedEntity[k].clientid||0!==c.key)&&c.key.toString()===l.cachedEntity[k].key.toString()){l.cachedEntity[k]=c;break}h&&g&&g!==h.lockSeqNbr&&l.layout.uiHelper.lockEntityUpdateHelper(l),l.entityModified.raise(d,e,c)},z.prototype.onEntityIdChanged=function a(b){this.entityIdChanged.raise(b)},z.prototype.getEntityStatus=function a(c,d){var e=b.Deferred();return d.entityFactory.checkIfEntityDirty(c).done(function(){d.entityFactory.checkIfEntityNew(c)?e.resolve("new-clean",c):e.resolve("clean",c)}).fail(function(){
d.entityFactory.checkIfEntityNew(c)?e.resolve("new-dirty",c):e.resolve("dirty",c)}),e},z.prototype.onDatasheetSaved=function a(){return U(this,this.entity)};function S(a,b){a.ValidateBeforeEveryThing.raise(a,b)}function T(a,b,c){var d=[],e=0,f=0,g=!1,h;for(c=c||[],d=b.filter(function(a){return c.indexOf(a)===-1}),e=0;e<c.length;e++)if(""!==c[e].errorMessage){g=!0,h=c[e].errorMessage;break}if(g)n.show(h,a.translate("DS_ERROR"));else for(a.entityDeleted.raise(d),e=0;e<d.length;e++){a.layout.updateRow("delete",d[e]),function(){for(f=0;f<a.entity.length;f++)if(a.entity[f].key===d[e])return}();var i=f;a.entity.splice(i,1)}}function U(a,c){var d=b.Deferred();return a.getEntitiesToBeSaved(c).done(V.bind(null,a,d)),d}function V(a,b,c,d){0===c.length?(a.clearSpinner(),b.resolve()):W(a,c,d,b)}function W(a,b,c,d){if(a.layout.setErrorAndReturnErrorFlag(a,b))return d.reject(),void a.clearSpinner();b.length&&b[0].isAuditable?ea(a,X,b,c,d):X(a,b,c,d)}function X(b,c,d,e,f){
var g=[],h=0,i=0,j=!1,k=!1,l=$(c);c=Z(c),b.showSpinner(),b.entityFactory.save(c).done(function(b,c,f){if(b.clearSpinner(),!(c&&f&&_(b,c,f))){for(b.layout.isHistoryDisabled(!b.getHistoryStatus(f)),b.layout.isSiteFiltered(b.getSiteFilteredStatus(f)),f.length,h=0;h<f.length;h++)if(""===f[h].errorMessage)for(k=!0,0===f[h].key||a.includes(b.entityObj,f[h].key.toString())||(b.entityObj?(b.entityObj.unshift(f[h].key.toString()),b.layout.updatePageCount(b.entityObj.length)):b.layout.updatePageCount(b.totalRows)),b.layout.updateRow("save",f[h],d[h]),aa(b,f[h],d[h]),b.getEntityStatus(b.entity[d[h]],b).done(function(a,c,d){b.layout.updateRow("status",a,c)}.bind(null,f[h])),
i=0;i!==f[h].fields.models.length;i++)b.layout.updateFieldValue(f[h],f[h].fields.models[i].get("key").toString(),f[h].fields.models[i].get("value"),f[h].fields.models[i].get("values"),f[h].fields.models[i].get("displayValue"),f[h].fields.models[i].get("pickList"),f[h].fields.models[i].get("isDisabled"),f[h].fields.models[i].get("isRequired"),f[h].fields.models[i].get("errorMessage"),f[h].fields.models[i].get("backColor"),f[h].fields.models[i].get("maxNumberOfValues"),f[h].fields.models[i].get("dependentFields"),f[h].fields.models[i].get("jsModuleName"),f[h].fields.models[i].get("jsModuleParams"),f[h].fields.models[i].get("popJSModuleOnFocus"),f[h].fields.models[i].get("addParseValueParam"),!1);else j=!0;k&&(Y(b),b.entitySaved.raise(f),e.resolve()),j&&(b.displayError(b),k||e.reject())}}.bind(null,b,l)).fail(function(a){b.clearSpinner(),a.statusCode&&409===a.statusCode().status&&b.layout.uiHelper.lockEntityUpdateHelper(b),e.reject()}),ga(b,f)}function Y(b){
a.each(b.layout.rows(),function(a,b,c){0===a.layout.rows()[c].entitykey()||a.isSuperUser||a.layout.rows()[c].isSelectedSiteViewOnly(!0)}.bind(null,b))}function Z(b){return a.each(b,function(a,b,c){null===b.siteKey&&(a[c].siteKey="0")}.bind(null,b)),b}function $(b){return a.map(b,function(a){return{entitykey:a.key,lockSeqNbr:a.lockSeqNbr}})}function _(a,b,c){for(var d=!1,e=0;e<b.length;e++)for(var f=0;f<c.length;f++)if(c[f].errorMessage===a.translator.translate("DS_BULK_ENTITY_CONCURRENT_WARNING_MESSSAGE")){a.layout.uiHelper.lockEntityUpdateHelper(a,"bulk"),d=!0;break}return d}function aa(a,b,c){var d=a.layout.rows()[c].refDocPathModel();d&&(d.isStored()?a.entityFactory.uploadRefDoc(d.formData,b.key).done(ba.bind(null,a,b.key,c)).fail(function(){a.throwException(a.translate("REFDOCS_FAILED_TO_UPLOAD_REF_DOC"))}):d.isUnc()&&a.entityFactory.hasRefDocServerCredentials().done(ca.bind(null,a)).fail(da.bind(null,a)),
d.isStored()||a.layout.selectedEntities()[0]!==b.key||a.layout.canDownloadRefDoc(!1))}function ba(a,b,c){a.layout.rows()[c].refDocPathModel(null),a.layout.selectedEntities()[0]===b&&a.layout.canDownloadRefDoc(!0)}function ca(a,b){var c=new m({closeButton:!0,timeOut:"200",hideDuration:"200"});b===!1&&c.warning(a.translate("REFDOCSERVER_NO_CREDENTIALS"),a.translate("REFDOCSERVER"))}function da(a){new m({closeButton:!0,timeOut:"200",hideDuration:"200"}).error(a.translate("REFDOCSERVER_FAILED_CREDENTIALS"),a.translate("REFDOCSERVER"))}function ea(a,b,c,d,e){var f,g;f=Object.resolve(w),g=new j(f,a.translate("DS_AUTH_DIALOG_TITLE"),{height:300,width:400}),g.show(),f.saveAllowed.add(b.bind(null,a,c,d,e,g)),f.saveDenied.add(fa.bind(null,a,g,e)),f.saveCancelled.add(ga.bind(null,a,g))}function fa(a,b,c){ga(a,b),n.showOk(a.translate("DS_AUTH_FAILURE_MSG"),a.translate("DS_AUTH_FAILURE_DIALOG_TITLE")),c.reject()}function ga(a,b){b&&b.closeDialog()}function ha(a){var b=[];a.showSpinner()
;for(var c=0;c<a.entity.length;c++)(0!==a.entity[c].key||a.layout.isNewAvailable())&&b.push({entitykey:a.entity[c].key,clientid:a.entity[c].clientid,fields:N(a,a.entity[c]),isAuditable:a.entity[c].isAuditable,isDirty:a.entity[c].isDirty,siteKey:a.entity[c].siteKey});b=ia(a,b),a.layout.executeDatasheetChanged(b).always(a.clearSpinner.bind(a))}function ia(b,c){return b.region.$element.find("mi-site-selector").length&&a.each(c,function(c,d,e){a.each(b.layout.rows(),function(a,b,c){d.entitykey.toString()===b.entitykey().toString()&&e===c&&(a[e].siteKey=b.siteKey())}.bind(null,c))}.bind(null,c)),c}z.prototype.getHistoryStatus=function a(b){for(var c=0;c<b.length;c++)if(0!==b[c].key)return b[0].isHistoryEnabled;return!1},z.prototype.getSiteFilteredStatus=function a(b){for(var c=0;c<b.length;c++)return b[0].isSiteFiltered;return!1},z.prototype.getRefDocStatus=function a(b){var c,d,e;for(d=0;d<b.length;d++){c=b[0].familyID,e=b[0].key;break}return this.entityFactory.canRefDoc(c,e)},
z.prototype.getEntitiesToBeSaved=function a(c){var d=this,e,f=[],g=[],h=0,i=b.Deferred();for(c=c||d.entity,e=0;e<c.length;e++)d.entity[e].clientid=c[e].clientid,h++,d.getEntityStatus(d.entity[e],d).done(function(a,b,c){h--,"new-clean"!==b&&"clean"!==b&&(d.layout.isSiteFiltered()&&d.layout.isDatasheetRendered()&&(d.layout.showSiteSelector()?c.siteKey=d.layout.rows()[a].siteKey():0===c.key&&(c.siteKey=u.user.defaultSiteKey)),0===c.key&&null!==d.masterSiteKey&&(c.siteKey=d.masterSiteKey),f.push(c),g.push(a)),h||i.resolve(f,g)}.bind(null,e));return i},z.prototype.hasNewCleanRow=function a(c){var d=this,e=0,f=!1,g=0,h=b.Deferred();for(c=c||d.entity,e=0;e<c.length;e++)d.entity[e].clientid=c[e].clientid,g++,d.getEntityStatus(d.entity[e],d).done(function(a,b,c){g--,"new-dirty"===b&&c.updatedFromModule===!0&&(f=!0),"new-clean"===b&&(f=!0),g||h.resolve(f)}.bind(d,e));return h},z.prototype.displayError=function a(b){var c,d,e=0,f=[]
;for(e=0;e<b.entity.length;e++)""!==b.entity[e].errorMessage&&f.push({id:b.entity[e].id,errorMessage:b.entity[e].errorMessage});c=new i(f),d=new j(c,this.translate("DS_ERROR_REPORT")),c.closeDialog.add(function(){d.closeDialog()}),d.show()};function ja(){return n.showUnsavedChanges()}function ka(a){if(a.newEntityFlag)return!1;a.newEntityFlag=!0,a.hasNewCleanRow().done(function(c){if(c||!a.canInsert||!a.layout.isNewAvailable())return void(a.newEntityFlag=!1);a.isCreatingNewRow=a.entityFactory.new(a.familyKey),a.isCreatingNewRow.done(function(c){var d,e;c.clientid=a.sequenceNumber++,null!==a.masterSiteKey&&(c.siteKey=a.masterSiteKey),a.entity.push(c),a.attachEntityEventListeners(c),a.layout.updateRow("new",{entitykey:c.key,isDirty:c.isDirty,fields:N(a,c),clientid:c.clientid,siteKey:c.siteKey}),a.entityCreated.raise(c),a.isCreatingNewRow=!1,a.newEntityFlag=!1,e=b(".datasheet-layout-container mi-date-time"),e.on("keypress keydown",function(a){console.log("bulk manager"),a.preventDefault()
}),(d=e.css("background-color"))&&(e.find(".date").css("background-color",d),e.find(".form-control").css("background-color",d))})})}function la(a,b){var c=[];n.showYesNo(a.translate("DS_DELETE_SELECTED_ENTITIES_MESSAGE"),a.translate("CONFIRM_REC_DEL")).done(function(d){if(0===d){for(var e=0;e<a.entity.length;e++)for(var f=0;f<b.length;f++)a.entity[e].key==b[f]&&c.push(a.entity[e].key);a.entityFactory.delete(c)}})}function ma(a){var c={};return b.each(a,function(a,b){c[a.toLowerCase()]=b}),c}function na(b,c){var e,f,g;g=a.find(b.entity,function(a){return a.key.toString()===c.toString()}),e=Object.resolve(k),f=new d,e.attach(f,g),e.loadHistory();var h=new j(e,b.translate("DS_FIELD_HISTORY_TITLE"),{height:"90%",width:"80%"});e.setDialog(h),h.show()}function oa(a,b){var c=Object.resolve(l,b[0]),d=new j(c,a.translate("DS_REFERENCE_DOCS_TITLE"),{height:"90%",width:"80%"});c.setDialog(d),d.show()}function pa(a){a.unlinkEntities.raise()}function qa(a,b){a.entitySelected.raise(b)}
function ra(a,b){var c=[],d={};if(a.catalogQuery="(!"+a.catalogItemPath+")",b.queryContainer.parmContainer){var e=b.queryContainer.parmContainer.parmDesigns;if(void 0!==e)for(var f=0;f<e.length;f++)c.push(e[f].parmPrompts[0])}return d.Query=a.catalogQuery,d.startRow=a.startIndex,d.maxRows=a.maxRows,d.parameters=c,d}return z});

define('text!platform/datasheets/layout/ui/views/master-detail-datasheet.html',[],function () { return '<div class="master-detail-datasheet-layout-container" data-bind="visible: isDatasheetRendered">\r\n    <div data-bind="" class="datasheet-nav">\r\n        <div class="datasheet-toolbar" data-bind="visible: !isRefDocsDisplayed()">\r\n            <div class="datasheet-selector-container block b8">\r\n\r\n                <div class="datasheet-selector-label-container block" data-bind="visible: showDatasheetSelection">\r\n                    <div class="datasheet-lbl">\r\n                        <span data-bind="text: $root.translate(\'DS_DATASHEET_ID_LABEL\')"></span>:\r\n                    </div>                    \r\n                </div>\r\n                <div class="datasheet-selector-select-container block" data-bind="visible: showDatasheetSelection">                    \r\n                    <mi-select class="datasheet-selector" data-bind="miproperty:{\r\n                        value: currentDatasheetKey,\r\n                        options: datasheetKeys,\r\n                        optionsValue: \'key\',\r\n                        optionsText: \'caption\'\r\n                           }"></mi-select>\r\n                </div>\r\n            </div>\r\n            <div class="datasheet-controls-container block b4 pull-right">\r\n                <div class="pull-right datasheet-btn-group master-ds-iconbar" data-bind="visible: !showEditButton()">\r\n                    <!--<button class="btn btn-icon" data-bind="visible: isRootRecordAvailable(), click: makeRootRecord, attr: {title: $root.translate(\'RM_MAKE_ROOT_RECORD_TOOLTIP\')}"><i class="icon-open-in-new-window"></i></button>-->\r\n                    <mi-associated-pages-btn familykey entitykey disabled data-bind="attr: { familykey: assocFamilykey(), entitykey: currentEntyKey(), disabled: assocDisabled() }" hideifnorecords="true"></mi-associated-pages-btn>\r\n                    <button class="btn btn-icon" data-bind="visible: isDatasheetRendered() && isSaveAvailable(), click: saveDatasheet, attr: {title: translate(\'DS_SAVE_TOOLTIP\')}"><i class="icon-save"></i></button>\r\n                </div>\r\n                <div class="pull-right datasheet-btn-group" data-bind="visible: showEditButton()">\r\n                    <!-- ko if: canEdit -->\r\n                    <button class="btn btn-icon pull-right" data-bind="click : toggleEdit, attr: {title: translate(\'DS_EDIT_TOOLTIP\')}"><i class="icon-edit"></i> </button>\r\n                    <!-- /ko -->\r\n                </div>\r\n                <!-- ko if: $root.datasheetNavWidth() > 768 -->\r\n                <!--<div class="pull-right datasheet-btn-group print-btn-group">\r\n                    <button class="btn btn-icon" data-bind="click : print, attr: {title: translate(\'PRINT\')}"><i class="icon-printer"></i></button>\r\n                </div>-->\r\n                <!-- /ko -->\r\n                <!-- ko if: isDatasheetRendered() && isSiteFiltered() && $root.showSiteSelector-->\r\n                <div class="pull-right datasheet-btn-group site-filter-component">\r\n                    <mi-site-selector data-bind="value: siteKey,attr: { readonly: isSelectedSiteViewOnly }, event:{\'change\': handleSiteChange}"></mi-site-selector>\r\n                </div>\r\n                <!-- /ko -->\r\n                <!-- ko if: isDatasheetRendered() && showStateManagement() -->\r\n                <div class="pull-right datasheet-btn-group">\r\n                    <mi-state-transition hidereservedops data-bind="attr: { entitykey: currentEntyKey, disable: isStateTransitionDisabled },\r\n                                    event: {\r\n                                        beforeStateChanged: onBeforeStateChanged,\r\n                                        stateChanged: onAfterStateChanged\r\n                                    }"></mi-state-transition>\r\n                </div>\r\n                <!-- /ko -->\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="mdf-tab-header">\r\n        <mi-tab-group tabs="2">\r\n            <mi-tab value="master" number="" selected="true" data-bind="attr:{text: translate(\'DS_MASTER_CAPTION\')}, event:{click: $root.masterTabClick}"></mi-tab>\r\n            <mi-tab value="detail" number="" data-bind="attr: {text: translate(\'DS_DETAIL_CAPTION\')}, event:{click: $root.detailTabClick}"></mi-tab>\r\n\r\n        </mi-tab-group>\r\n\r\n    </div>\r\n\r\n    <div class="master-datasheet-tab-content" data-bind="css:{\'master-datasheet-readonly-container\': isDatasheetReadOnly}">\r\n        <div class="master-tab-pane" data-bind="visible:showMasterTab">\r\n            <div class="master-tab-header" data-bind="visible:showMasterTabForPrint">\r\n                <ul class="nav nav-tabs">\r\n                    <li class="active">\r\n                        <a data-toggle="tab" data-bind="text: translate(\'DS_MASTER_CAPTION\')"></a>\r\n                    </li>\r\n\r\n                    <li>\r\n                        <a data-toggle="tab" data-bind="text: translate(\'DS_DETAIL_CAPTION\')"></a>\r\n                    </li>\r\n                </ul>\r\n\r\n            </div>\r\n            <div class="master-datasheet-container" data-bind="text: translate(\'DS_MASTER_DATASHEET_CAPTION\')">\r\n\r\n            </div>\r\n        </div>\r\n\r\n        <div class="detail-tab-pane" data-bind="visible: !isRefDocsDisplayed() && !showMasterTab()">\r\n            <div class="detail-tab-header" data-bind="visible:showMasterTabForPrint">\r\n                <ul class="nav nav-tabs">\r\n                    <li>\r\n                        <a data-toggle="tab" data-bind="text: translate(\'DS_MASTER_CAPTION\')"></a>\r\n                    </li>\r\n\r\n                    <li class="active">\r\n                        <a data-toggle="tab" data-bind="text: translate(\'DS_DETAIL_CAPTION\')"></a>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n            <div class="detail-datasheet-container" data-bind="text: translate(\'DS_DETAIL_DATASHEET_CAPTION\')"></div>\r\n            <div class="empty-detail-datasheet" data-bind="text: translate(\'NO_RECORD_MSG\')"></div>\r\n        </div>\r\n\r\n        <!--<div class="master-detail-datasheet-disabled-overlay" data-bind="visible: isDatasheetReadOnly, style: { top: overlayTop}">-->\r\n\r\n    </div>\r\n\r\n</div>\r\n</div>\r\n<div class="load-spinner" data-bind="visible: !isDatasheetRendered()">\r\n    <span class="loading-med loading-active center-block"></span>\r\n</div>';});

define('platform/datasheets/layout/ui/master-detail-view-model',['require','lodash','jquery','knockout','spa/ko/knockout-view-model','../services/datasheet-service','../adapters/datasheet-adapter','system/lang/event','application/export-service','text!./views/master-detail-datasheet.html','system/error/error-message','application/application-events','system/globalization/translator','platform/datasheets/layout/ui/utils','platform/metadata/services/metadata','./helpers/print-helper','./helpers/ui-helper','ui/elements/state-transition/component','ui/elements/site-selector/site-selector-element','ui/elements/associated-pages-btn/associated-pages'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("spa/ko/knockout-view-model"),e=require("../services/datasheet-service"),f=require("../adapters/datasheet-adapter"),g=require("system/lang/event"),h=require("application/export-service"),i=require("text!./views/master-detail-datasheet.html"),j=require("system/error/error-message"),k=require("application/application-events"),l=require("system/globalization/translator"),m=require("platform/datasheets/layout/ui/utils"),n=require("platform/metadata/services/metadata"),o=require("./helpers/print-helper"),p=require("./helpers/ui-helper");require("ui/elements/state-transition/component"),require("ui/elements/site-selector/site-selector-element"),require("ui/elements/associated-pages-btn/associated-pages");function q(a){r.call(this,i),this.region=null,this.translator=Object.resolve(l),this.util=Object.resolve(m),this.datasheetKeys=c.observableArray(),
this.currentDatasheetKey=c.observable(),this.appEvents=Object.resolve(k),this.previousDatasheetKey=c.observable(),this.currentDatasheet=c.observable(),this.isDatasheetRendered=c.observable(!1),this.detailFamilyCaption=c.observable(),this.showEditButton=c.observable(!1),this.canEdit=c.observable(!1),this.overlayTop=c.observable("93px"),this.exportService=Object.resolve(h),this.datasheetService=a,this.masterDetailShellRendered=new g,this.onFormsDatasheet=new g,this.onMasterDetail=new g,this.onNewMasterDetail=new g,this.isSaveAvailable=c.observable(!0),this.isNewAvailable=c.observable(!0),this.isDeleteAvailable=c.observable(!0),this.isCopyAvailable=c.observable(!0),this.isHistoryAvailable=c.observable(!0),this.isHistoryEnabled=c.observable(!0),this.isReferencesAvailable=c.observable(!0),this.isRefDocEnabled=c.observable(!1),this.refDocCount=c.observable(""),this.showDatasheetSelection=c.observable(!0),this.isDatasheetReadOnly=c.observable(!1),this.canPaste=c.observable(!0),
this.isMasterDatasheet=c.observable(!1),this.showStateManagement=c.observable(!0),this.entityState=c.observable(),this.isDatasheetReadOnly.subscribe(z.bind(null,this)),this.helpTextModeOn=c.observable(!1),this.helpButtonText=c.observable(this.translate("DS_TURN_ON_HELPTEXT")),this.isDatasheetRenderedInRM=c.observable(!1),this.isRefDocsDisplayed=c.observable(!1),this.isRootRecordAvailable=c.observable(!0),this.isUnlinkRecordAvailable=c.observable(!0),this.isUnlinkRecordEnabled=c.observable(!0),this.isPasteEnabled=c.observable(!0),this.hideMoreOptionsForIcons=c.observable(!1),this.isDefaultHelpTextAvailable=c.observable(!0),this.siteKey=c.observable(),this.isSiteFiltered=c.observable(!1),this.assetContextKey=c.observable(),this.assetContextKey.subscribe(y.bind(this,this)),this.isSelectedSiteViewOnly=c.observable(!1),this.showSiteSelector=c.observable(!0),this.assocFamilykey=c.observable(),this.assocDisabled=c.observable(!0),this.masterDetailSaved=new g,this.masterDetailNew=new g,
this.masterDetailDelete=new g,this.masterDatasheetHistory=new g,this.masterDatasheetCopy=new g,this.masterDatasheetPaste=new g,this.beforeStateTransition=new g,this.onStateTransition=new g,this.datasheetReadOnlyChange=new g,this.toggleHelpTextButtonClicked=new g,this.makeRootRecordEvent=new g,this.unlinkRecordEvent=new g,this.masterDatasheetRefDocs=new g,this.datasheetChanged=new g,this.detailTabClicked=new g,this.onSiteChange=new g,this.toggleEditBtnClicked=new g,this.showMasterTab=c.observable(!0),this.showMasterTabForPrint=c.observable(!1),this.familyKey=null,this.printHelper=Object.resolve(o),this.uiHelper=Object.resolve(p),this.currentEntyKey=c.observable(),this.isStateTransitionDisabled=c.observable(!1),this.collapsibleChangeEventHandler=null,this.scrollEl=null,this.datasheetNavWidth=c.observable(0),this.appEvents.windowResized.add(this.handleNavAppearance,this)}var r=Object.inherit(d,q);q.dependsOn=[e],q.prototype.activate=function a(){},q.prototype.attach=function c(d,e){
if(r.prototype.attach.call(this,d),this.region=d,this.masterDetailShellRendered.raise(),this.currentDatasheetKey.subscribe(w.bind(null,this)),e){var f=this.scrollEl=b(e);f.on("scroll.mdf",a.debounce(this.uiHelper.handleStickyHeader.bind(null,this,d,f),100)),this.collapsibleChangeEventHandler=a.defer.bind(a,this.uiHelper.handleStickyHeader.bind(null,this,d,f))}else this.collapsibleChangeEventHandler=a.defer.bind(a,this.uiHelper.handleNavAppearance.bind(null,this,d));b("mi-collapsible").on("change.mdf",this.collapsibleChangeEventHandler)},q.prototype.detach=function a(b){r.prototype.detach.call(this,b)},q.prototype.handleNavAppearance=function a(){var b=this;b.uiHelper.handleNavAppearance(b),b.region&&b.scrollEl&&(b.uiHelper.handleStickyHeader(b,b.region,b.scrollEl),b.uiHelper.handleHeaderHeight(b,b.region))},q.prototype.masterTabClick=function a(){this.showMasterTab(!0)},q.prototype.detailTabClick=function a(){this.showMasterTab(!1),this.detailTabClicked.raise()},
q.prototype.onLayoutChanged=function a(){var b=this;b.uiHelper.handleHeaderHeight(b,b.region),b.uiHelper.handleNavAppearance(b)},q.prototype.deallocateMem=function a(){this.region=null,this.translator=null,this.datasheetKeys=null,this.currentDatasheetKey=null,this.previousDatasheetKey=null,this.currentDatasheet=null,this.isDatasheetRendered=null,this.detailFamilyCaption=null,this.showEditButton=null,this.canEdit=null,this.overlayTop=null,this.exportService=null,this.datasheetService=null,this.masterDetailShellRendered=null,this.onFormsDatasheet=null,this.onMasterDetail=null,this.onNewMasterDetail=null,this.isSaveAvailable=null,this.isNewAvailable=null,this.isDeleteAvailable=null,this.isCopyAvailable=null,this.isHistoryAvailable=null,this.isHistoryEnabled=null,this.isReferencesAvailable=null,this.isRefDocEnabled=null,this.refDocCount=null,this.showDatasheetSelection=null,this.isDatasheetReadOnly=null,this.canPaste=null,this.isMasterDatasheet=null,this.showStateManagement=null,
this.entityState=null,this.helpTextModeOn=null,this.helpButtonText=null,this.isDatasheetRenderedInRM=null,this.isRefDocsDisplayed=null,this.isRootRecordAvailable=null,this.isUnlinkRecordAvailable=null,this.hideMoreOptionsForIcons=null,this.isDefaultHelpTextAvailable=null,this.siteKey=null,this.isSiteFiltered=null,this.assetContextKey=null,this.assocFamilykey=null,this.assocDisabled=null,this.masterDetailSaved=null,this.masterDetailNew=null,this.masterDetailDelete=null,this.masterDatasheetHistory=null,this.masterDatasheetCopy=null,this.masterDatasheetPaste=null,this.beforeStateTransition=null,this.onStateTransition=null,this.datasheetReadOnlyChange=null,this.toggleHelpTextButtonClicked=null,this.makeRootRecordEvent=null,this.unlinkRecordEvent=null,this.masterDatasheetRefDocs=null,this.datasheetChanged=null,this.familyKey=null,this.printHelper=null,this.isStateTransitionDisabled=null,this.toggleEditBtnClicked=null,this.datasheetNavWidth=null,
this.appEvents&&this.appEvents.windowResized&&this.handleNavAppearance&&this.appEvents.windowResized.remove(this.handleNavAppearance,this)},q.prototype.toggleEdit=function a(){this.isDatasheetReadOnly(!this.isDatasheetReadOnly()),this.showEditButton(!1),this.isStateTransitionDisabled(!1),this.toggleEditBtnClicked.raise()},q.prototype.toggleHelpText=function a(){this.helpTextModeOn(!this.helpTextModeOn()),this.toggleHelpTextButtonClicked.raise(),this.helpTextModeOn()===!0?this.helpButtonText(this.translate("DS_TURN_OFF_HELPTEXT")):this.helpButtonText(this.translate("DS_TURN_ON_HELPTEXT"))},q.prototype.translate=function a(b){return this.translator.translate(b)},q.prototype.saveDatasheet=function a(){this.masterDetailSaved.raise()},q.prototype.newDatasheet=function a(){this.masterDetailNew.raise()},q.prototype.deleteDatasheet=function a(){this.masterDetailDelete.raise()},q.prototype.setDetailFamilyCaption=function a(b){this.detailFamilyCaption(b)},q.prototype.showHistory=function a(){
this.masterDatasheetHistory.raise()},q.prototype.copyDatasheet=function a(){this.masterDatasheetCopy.raise()},q.prototype.pasteDatasheet=function a(){this.masterDatasheetPaste.raise()},q.prototype.showStateAssignment=function a(){this.beforeStateTransition.raise()},q.prototype.showStateTransition=function a(){this.onStateTransition.raise()},q.prototype.showRefDocs=function a(){this.masterDatasheetRefDocs.raise(),this.isRefDocsDisplayed(!0),this.showMasterTab()||(this.showMasterTab(!0),this.region.$element.find(".mdf-tab-header .tab-group-item.block.two-tab").first().addClass("active"),this.region.$element.find(".mdf-tab-header .tab-group-item.block.two-tab").last().removeClass("active"))},q.prototype.getRelationshipFamilyById=function a(b){var c=this;return n.getRelationshipFamilyById(b)},q.prototype.getBulkHtmlForPrinting=function c(d){
var e="<div style='padding:10px;'>",f=b("div.table-responsive > table.table > thead > tr > th"),g=d.region.$element.find("div.freezed-cols-container > table.table > thead > tr > th"),h=[],i=[],j="---",k="#fff";return d.region.$element.find("div.table-responsive > table.table > tbody > tr").each(function(a,c){h[a]=b(this).find("td")}),d.region.$element.find("div.freezed-cols-container > table.table > tbody > tr").each(function(a,c){i[a]=b(this).find("td")}),e=s(g,i,j,e),a.each(f,function(b,c){if(c>=0&&"status-col"!==b.className&&"row-selector"!==b.className){var d=0===c?"border-left: 1px solid #e6e6e6;":"";e=t(e,b,c,d),a.each(h,function(a,f){a.length>=0&&"status-col"!==b.className&&"row-selector"!==b.className&&(e=u(e,j,a,f,c,d))}),e+="</div>"}}),e+="</div>"};function s(c,d,e,f){return a.each(c,function(c,g){if(g>=2&&(b(c).hasClass("freezed-column")||b(c).hasClass("site-selector-caption"))){var h=2===g?"border-left: 1px solid #e6e6e6;":"";f=t(f,c,g,h),a.each(d,function(a,b){
a.length>=2&&"status-col"!==c.className&&"row-selector"!==c.className&&(f=u(f,e,a,b,g,h))}),f+="</div>"}}),f}function t(a,c,d,e){return a+="<div style='display:inline-block;vertical-align:top;margin-top:20px;border-top:1px solid #444;'><div style='padding:5px;border: 0;"+e+"border-bottom: 1px solid #e6e6e6;border-right: 1px solid #e6e6e6;'>"+b(c).text()+"</div>"}function u(a,c,d,e,f,g){var h;return b(d[f]).find(".site-filter-component").length>0?c=b(d[f]).find("mi-site-selector li.active").text():b(d[f]).find(".hyperlinkEllipsis").length>0?(c=b(d[f]).find(".hyperlinkEllipsis").html(),h=b(d[f]).find(".form-control").css("background-color")):b(d[f]).find(".form-control").length>0&&!b(d[f]).find("input:password")?(c=b(d[f]).find(".form-control").val(),h=b(d[f]).find(".form-control").css("background-color")):b(d[f]).find("mi-checkbox").length>0?(c=b(d[f]).find("mi-checkbox").html(),h=b(d[f]).find(".form-control").css("background-color")):c=b(d[f]).html(),
a+="<div style='padding:5px;height:70px;background-color:"+h+";border: 0;"+g+"border-bottom: 1px solid #e6e6e6;border-right: 1px solid #e6e6e6 !important;'>"+c+"</div>"}q.prototype.print=function a(){var b=this;n.retrieveFamilyReports(b.familyKey).done(v.bind(null,b))};function v(a,b){a.printHelper.print(a,"mdf",b)}function w(a){if(a.proceed===!1)return void(a.proceed=!0);a.datasheetChanged.raise(),a.uiHelper.handleNavAppearance(a)}q.prototype.executeDatasheetChanged=function c(){var d,e=b.Deferred(),f=this;return d=e.then(function(){return f.datasheetService.getDatasheet(f.currentDatasheetKey())}).then(function(b){if(x(f,b),f.currentDatasheet().isMasterDetail()){var c=a.find(f.datasheetKeys(),function(a){return b.customFormParameters["master Family Datasheet ID"]===a.id});f.onNewMasterDetail.raise(f.currentDatasheetKey(),b,c.key,f.datasheetKeys())}else f.onFormsDatasheet.raise(f.currentDatasheetKey(),b,f.datasheetKeys())}),e.resolve(),e};function x(a,b){var c=f.toModelObject(b)
;a.currentDatasheet(c)}function y(a,b){void 0!==b&&null!==b&&""!==b&&(a.siteSelector=a.region.$element.find("mi-site-selector")[0],a.siteSelector&&(Element.upgrade(a.siteSelector),a.siteSelector.selectSiteByAssetKey(b)))}function z(a){a.isDatasheetReadOnly()===!0&&(a.isSelectedSiteViewOnly(!0),a.isStateTransitionDisabled(!0)),a.datasheetReadOnlyChange.raise()}q.prototype.makeRootRecord=function a(){this.makeRootRecordEvent.raise()},q.prototype.unlinkRecord=function a(){this.unlinkRecordEvent.raise()},q.prototype.addMoreOptionsForIcons=function a(){var c=this;if(!c.hideMoreOptionsForIcons()){var d=c.region.$element.find(".master-ds-iconbar"),e=b("<mi-more-options-noko/>").attr("data-bind",'property: {icon: "icon-options"}');e.attr("class","datasheet-icons-more-options"),window.CustomElements&&!window.CustomElements.useNative&&window.CustomElements.upgrade(e.get(0)),c.iconsMoreOptions=e.get(0),c.iconsMoreOptions.loader=c.setIconOptions.bind(c),d.append(c.iconsMoreOptions),
c.iconsMoreOptions.moreoptionsCB(B.bind(null,c))}},q.prototype.setIconOptions=function a(){var c=b.Deferred();return A(this),c.resolve(this.iconOptions),c},q.prototype.setFamilyKey=function a(b){b&&(this.familyKey=b)},q.prototype.setErrorAndReturnErrorFlag=function a(b,c){var d=this,e=!1;return this.util.clearAllErrorNotifications(b),e=this.util.setErrorAndReturnErrorFlag("mdf",b,c)},q.prototype.handleSiteChange=function a(b,c){b.onSiteChange.raise(c.originalEvent.detail.value)},q.prototype.displaySmallTabs=function a(){var b=this,c;(c=b.region.$element.find("mi-tab-group")[0])&&(Element.upgrade(c),c.setAttribute("size","small"),c.updateTabSize())},q.prototype.onBeforeStateChanged=function(a,b){this.beforeStateTransition.raise(a,b)},q.prototype.onAfterStateChanged=function(a,b){this.onStateTransition.raise(a,b)},q.prototype.setCurrentEntyKey=function a(b){b&&this.currentEntyKey(b)};function A(a){var b=[];b.push({type:"text",text:a.translate("PRINT"),icon:"icon-printer"}),
a.isDefaultHelpTextAvailable()&&b.push({type:"text",text:a.helpButtonText(),icon:"icon-questionmark"}),b.push({type:"text",text:a.translate("DS_ADD"),icon:"icon-add-alt",noaccess:!a.isNewAvailable()}),a.isUnlinkRecordAvailable()&&b.push({type:"text",text:a.translate("RM_UNLINK_RECORD"),icon:"icon-unlink",noaccess:!a.isUnlinkRecordEnabled()}),b.push({type:"text",text:a.translate("DS_DELETE"),icon:"icon-bin",noaccess:!a.isDeleteAvailable()}),a.isReferencesAvailable()&&a.isRefDocEnabled()&&b.push({type:"text",text:a.refDocCount()+" "+a.translate("DS_REF_DOCS"),icon:"icon-doc"}),a.isHistoryAvailable()&&a.isHistoryEnabled()&&b.push({type:"text",text:a.translate("DS_HISTORY"),icon:"icon-history"}),a.isCopyAvailable()&&(b.push({type:"text",text:a.translate("DS_COPY"),icon:"icon-copy",noaccess:!a.isPasteEnabled()}),b.push({type:"text",text:a.translate("DS_PASTE"),icon:"icon-paste",disabled:a.canPaste(),noaccess:!a.isPasteEnabled()})),a.iconOptions=b}function B(a,b){
b.noaccess||(b.text===a.helpButtonText()?a.toggleHelpText():b.text===a.translate("DS_STATE_TRANSITION")?a.showStateTransition():b.text===a.translate("DS_STATE_ASSIGNMENT")?a.showStateAssignment():b.text===a.translate("DS_ADD")?a.newDatasheet():b.text===a.translate("RM_UNLINK_RECORD")?a.unlinkRecord():b.text===a.translate("DS_DELETE")?a.deleteDatasheet():b.text&&b.text.indexOf(a.translate("DS_REF_DOCS"))>=0?a.showRefDocs():b.text===a.translate("DS_HISTORY")?a.showHistory():b.text===a.translate("DS_COPY")?a.copyDatasheet():b.text===a.translate("DS_PASTE")?a.pasteDatasheet():b.text===a.translate("PRINT")&&a.print())}return q});
define('platform/datasheets/master-detail-datasheet-manager',['require','lodash','jquery','./layout/ui/master-detail-view-model','./forms-datasheet-manager','./bulk-datasheet-manager','./layout/ui/datasheet-history-view-model','system/ui/dialog-view-model','spa/region','../entity/entity-factory','system/lang/event','system/ui/message-box','system/ui/unsaved-changes-message-box','system/globalization/translator','./layout/services/manager-service','application/application-events','system/error/error-message','platform/datasheets/layout/ui/datasheet-authentication-dialog-view-model','system/ui/busy-indicator'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("./layout/ui/master-detail-view-model"),d=require("./forms-datasheet-manager"),e=require("./bulk-datasheet-manager"),f=require("./layout/ui/datasheet-history-view-model"),g=require("system/ui/dialog-view-model"),h=require("spa/region"),i=require("../entity/entity-factory"),j=require("system/lang/event"),k=require("system/ui/message-box"),l=require("system/ui/unsaved-changes-message-box"),m=require("system/globalization/translator"),n=require("./layout/services/manager-service"),o=require("application/application-events"),p=require("system/error/error-message"),q=require("platform/datasheets/layout/ui/datasheet-authentication-dialog-view-model"),r=require("system/ui/busy-indicator");function s(a,b,c,d,e,f){this.defaultConfig={functionsavailable:["save","new","delete","references","history","copy"],readonly:!1,showdatasheetselection:!0,loadedfrommodule:!0,loadedfromrecordmanager:!1,
showdefaulthelptext:!0,displaysmalltabs:!1,showmastersiteselector:!0,disablemastersiteselector:!1,showdetailsiteselector:!1,disabledetailsiteselector:!0,detailfunctionsavailable:null},this.translator=Object.resolve(m),this.containerEl=a.containerel,this.scrollEl=a.scrollel,this.assetContextKey=a.assetcontextkey,this.datasheetkey=b,this.datasheetdto=c,this.entity=d,this.masterdatasheetkey=e,this.datasheetkeys=f,this.refDocs=null,this.savedSiteKey=null,this.appEvents=Object.resolve(o),this.indicator=Object.resolve(r),this.entityFactory=new i,this.window=window,this.onFormsDatasheet=new j,this.onMasterDetailDatasheet=new j,this.onNewMasterDetail=new j,this.onMasterDetailDatasheetSaved=new j,this.onMasterDetailDatasheetNew=new j,this.onBulkEntitiesDeleted=new j,this.onBulkEntitiesUnlinked=new j,this.onMasterDatasheetLoaded=new j,this.makeRootRecordEvent=new j,this.unlinkRecordEvent=new j,this.refDocsSet=new j,this.entityDeleted=new j,this.newDatasheet=new j,this.preventSiteChangeUpdate=!1,
this.isSuperUser=!1,this.siteSelector=null,this.entityModified=new j,this.canUpdateRefDocView=!1,this.entityIdChanged=new j,this.canDeleteRelationshipFamily=!0,this.canInsertRelationshipFamily=!0}s.prototype.getState=function a(){return this.detachEntityEventHandlers(),Fa(this)},s.prototype.getRefDocState=function a(){return this.masterDatasheet&&this.masterDatasheet.layout&&this.masterDatasheet.layout.refdocEl&&this.masterDatasheet.layout.isRefDocRendered()?this.masterDatasheet.layout.refdocEl.getState():null},s.prototype.updateRefDocState=function a(b){b&&(this.refDocs=b,this.canUpdateRefDocView=!0)},s.prototype.removeDOMElements=function a(){},s.prototype.load=function a(b){this.setConfig(b),this.renderDatasheet(),this.entityFactory.bulkUnlinkEvent.add(U.bind(null,this))},s.prototype.translate=function a(b){return this.translator.translate(b)},s.prototype.updateState=function a(b){b&&(this.cachedEntity=b)},s.prototype.getUserFamilyPrivileges=function a(){
return this.userFamilyPrivileges},s.prototype.renderDatasheet=function a(){var b=this;b.layout||(b.layout=Object.resolve(c)),0!==b.config.functionsavailable.length||b.config.showdefaulthelptext||b.layout.hideMoreOptionsForIcons(!0),b.attachLayoutHandlers(),b.layout.datasheetKeys(b.datasheetkeys),b.layout.currentDatasheetKey(b.datasheetkey),b.layout.previousDatasheetKey(b.datasheetkey),b.region=new h,b.region.setElement(b.containerEl),b.layout.attach(b.region,b.scrollEl),b.indicator.attachTo(b.containerEl[0]),b.config.displaysmalltabs&&b.layout.displaySmallTabs()},s.prototype.attachLayoutHandlers=function a(){this.layout.masterDetailShellRendered.add(E.bind(null,this)),this.layout.onFormsDatasheet.add(Q.bind(null,this)),this.layout.onMasterDetail.add(R.bind(null,this)),this.layout.onNewMasterDetail.add(S.bind(null,this)),this.layout.masterDetailSaved.add(V.bind(null,this)),this.layout.masterDetailNew.add(ea.bind(null,this)),this.layout.masterDetailDelete.add(ga.bind(null,this)),
this.layout.masterDatasheetHistory.add(ka.bind(null,this)),this.layout.masterDatasheetCopy.add(ha.bind(null,this)),this.layout.masterDatasheetPaste.add(ia.bind(null,this)),this.layout.beforeStateTransition.add(ma.bind(null,this)),this.layout.onStateTransition.add(na.bind(null,this)),this.layout.datasheetReadOnlyChange.add(oa.bind(null,this)),this.layout.toggleHelpTextButtonClicked.add(w.bind(null,this)),this.layout.makeRootRecordEvent.add(Ca.bind(null,this)),this.layout.unlinkRecordEvent.add(Da.bind(null,this)),this.layout.masterDatasheetRefDocs.add(la.bind(null,this)),this.layout.datasheetChanged.add(qa.bind(null,this)),this.layout.detailTabClicked.add(pa.bind(null,this)),this.layout.onSiteChange.add(this.handleSiteChange,this),this.layout.toggleEditBtnClicked.add(z.bind(null,this)),this.appEvents&&this.appEvents.layoutChanged&&this.appEvents.layoutChanged.add(u.bind(null,this))},s.prototype.handleSiteChange=function a(b){var c=this
;if(c.preventSiteChangeUpdate)return void(c.preventSiteChangeUpdate=!1);c.entity&&(c.entity.siteKey=b,c.masterDatasheet.layout.siteKey(b),c.masterDatasheet.entity.siteKey=b,c.entityFactory.updateEntitySite(c.entity))};function t(a,b){return a.layout.siteKey()!==b&&(a.preventSiteChangeUpdate=!0,!0)}function u(a){a&&a.layout&&a.layout.onLayoutChanged()}s.prototype.setConfig=function a(c){var d=this;d.config=c||{},d.config=Aa(d.config),b.extend(d.defaultConfig,d.config),d.config=d.defaultConfig},s.prototype.renderMasterDatasheet=function a(){var c=b(".master-datasheet-container"),e,f=this,g=b.Deferred();return f.cachedEntity.master&&(f.entity=f.cachedEntity.master),f.layout.isSiteFiltered(f.entity.isSiteFiltered),"0"===f.entity.siteKey&&t(f,f.entity.siteKey),f.layout.siteKey(f.entity.siteKey),f.savedSiteKey=f.entity.siteKey,e={containerel:c,entityobj:f.entity,currentDatasheetKey:f.masterdatasheetkey},0===f.entity.key||f.isSuperUser||f.layout.isSelectedSiteViewOnly(!0),
f.config.showmastersiteselector||f.layout.showSiteSelector(!1),f.isSuperUser&&f.config.disablemastersiteselector&&f.layout.isSelectedSiteViewOnly(!1),f.config.functionsavailable&&(b.inArray("history",f.config.functionsavailable)<0&&f.layout.isHistoryAvailable(!1),b.inArray("copy",f.config.functionsavailable)<0&&f.layout.isCopyAvailable(!1),b.inArray("references",f.config.functionsavailable)<0&&f.layout.isReferencesAvailable(!1),b.inArray("rootRecord",f.config.functionsavailable)<0&&f.layout.isRootRecordAvailable(!1),b.inArray("unlinkRecord",f.config.functionsavailable)<0&&f.layout.isUnlinkRecordAvailable(!1)),f.config.loadedfromrecordmanager&&f.layout.isDatasheetRenderedInRM(!0),f.config.showdefaulthelptext||f.layout.isDefaultHelpTextAvailable(!1),f.entity&&0!==f.entity.key&&(f.layout.assocDisabled(!1),f.layout.assocFamilykey(f.entity.familyKey)),f.entity.useUrlRedirection&&!f.config.loadedfrommodule?(f.layout.isDatasheetReadOnly(!0),f.layout.isCopyAvailable(!1),
f.layout.isSaveAvailable(!1),f.layout.isDeleteAvailable(!1),f.layout.isNewAvailable(!1),f.layout.showEditButton(!1),f.layout.canEdit(!1)):f.config.readonly?(f.layout.isDatasheetReadOnly(!0),f.layout.showEditButton(!0),f.layout.canEdit(f.config.canedit)):f.layout.isDatasheetReadOnly(!1),f.config.showdatasheetselection||f.layout.showDatasheetSelection(!1),this.masterDatasheet=new d(e),this.masterDatasheet.changeDatasheet(f.entity,f.config).done(x.bind(null,f,g)),f.layout.isHistoryEnabled(f.entity.isHistoryEnabled&&f.entity.key),g},s.prototype.renderDetailDatasheet=function a(){var c=b(".detail-datasheet-container"),d,f,g=this,h=[],i=["delete","new","link","unlink","history","references"],j=g.datasheetdto.customFormParameters,k=b.Deferred(),l,m,n,o=!1;return m=j["relationship Family ID"],n=j["detail Family ID"],l=g.entityFactory.getRelatedEntities(g.entity.key,m,n),l.then(function(a){var b,l,m=g.userFamilyPrivileges,o=m.isSuperUser;for(g.isSuperUser=m.isSuperUser,
b=0;b<m.privileges.length;b++)if(m.privileges[b].familyKey.toString()===g.entity.familyKey.toString()){l=m.privileges[b];break}if(h=a,d={containerel:c,entityobj:h,datasheetkey:j["detail Family Datasheet ID"],pagesize:25},h.length||(d.familykey=n),g.config.detailfunctionsavailable&&(i=g.config.detailfunctionsavailable),i=Ba(i,j),f={functionsavailable:i,showdatasheetselection:!1,ismasterdatasheet:!0},g.config&&(f.showsiteselector=g.config.showdetailsiteselector,f.disablesiteselector=g.config.disabledetailsiteselector),"False"===j["allow Edit"]&&(f.readonly=!0,f.canedit=!1),g.config=f,g.detailDatasheet=new e(d),g.detailDatasheet.unlinkEntities.add(T.bind(null,g)),g.detailDatasheet.entityDeleted.add(v.bind(null,g)),g.detailDatasheet.pageChangeDone.add(B.bind(null,g)),!o&&l&&!l.vw)return g.noAccessToDetailDatasheet=!0,g.region.$element.find(".detail-datasheet-container").addClass("no-access"),void k.resolve();(o||l&&l.ins)&&(g.detailDatasheet.canInsert=!0),
(o||l&&l.del)&&(g.detailDatasheet.canDelete=!0),(o||l&&l.upd)&&(g.detailDatasheet.canUpdate=!0),(o||l&&l.vw)&&(g.detailDatasheet.canView=!0),o||!l||!l.vw||l.ins||l.del||l.upd||(f.readonly=!0,f.canedit=!1),g.config=f,g.cachedEntity.detail&&g.detailDatasheet.updateState(g.cachedEntity.detail,h),g.detailDatasheet.masterSiteKey=g.layout.siteKey(),g.detailDatasheet.load(f).done(C.bind(null,g,k)).fail(D.bind(null,g,k))}).fail(function(){g.throwException(g.translate("DS_LOAD_BULK_ENTITY_FAIL_EXCEPTION")),k.resolve()}),k},s.prototype.throwException=function a(b){var c=new p(1,b,"platform/datasheets/master-detail-datasheet-manager.js");this.appEvents.errorOccured.raise(this,c)},s.prototype.onDatasheetSaved=function a(){return V(this)};function v(a){a.onBulkEntitiesDeleted.raise()}function w(a){a.masterDatasheet.layout.toggleHelpText()}function x(a,b,c){a.entity=c,a.masterDatasheet.setTitle(""),a.masterDatasheet.layout.isMasterDatasheet(!0),
a.masterDatasheet.layout.changeCanPaste.add(ja.bind(null,a),a),a.layout.canPaste(a.masterDatasheet.layout.canPaste()),a.layout.showStateManagement(a.masterDatasheet.layout.showStateManagement()),a.layout.entityState(a.masterDatasheet.layout.entityState()),a.layout.isSiteFiltered(c.isSiteFiltered),a.layout.siteKey(c.siteKey),a.savedSiteKey=c.siteKey,"0"===a.masterDatasheet.entity.siteKey&&t(a,a.masterDatasheet.entity.siteKey),a.masterDatasheet.layout.isRefDocEnabled()&&a.layout.isRefDocEnabled(!0),a.layout.refDocCount(a.masterDatasheet.layout.refDocCount()),a.masterDatasheet.layout.refDocsHidden.add(O.bind(null,a)),a.masterDatasheet.layout.refDocsRendered.add(P.bind(null,a)),a.onMasterDatasheetLoaded.raise(),a.entity&&(a.layout.setFamilyKey(a.entity.familyKey),a.layout.setCurrentEntyKey(a.entity.key)),b.resolve()}function y(a,b){var c,d,e;if(b){for(a.userFamilyPrivileges=b,c=b.isSuperUser,a.isSuperUser=c,
d=0;d<b.privileges.length;d++)if(b.privileges[d].familyKey.toString()===a.entity.familyKey.toString()){e=b.privileges[d];break}a.layout.isNewAvailable(A(a,"new",e,c,"ins")),0===a.entity.key?a.layout.isSaveAvailable(A(a,"save",e,c,"ins")):a.layout.isSaveAvailable(A(a,"save",e,c,"upd")),a.layout.isDeleteAvailable(A(a,"delete",e,c,"del")),a.layout.isUnlinkRecordEnabled(A(a,"unlinkRecord",e,c,"del")),a.layout.isPasteEnabled(A(a,"copy",e,c,"ins")&&A(a,"copy",e,c,"upd"))}}function z(a){a.layout.isSelectedSiteViewOnly(a.siteSelector.isSiteViewOnly)}function A(a,c,d,e,f){var g=d&&d[f];return b.inArray(c,a.config.functionsavailable)>=0&&(e||g)}function B(a,b){a.entities=b}function C(a,b,c){a.entities=c,a.detailDatasheet.setTitle(""),a.detailDatasheet.layout&&(a.detailDatasheet.layout.isMasterDatasheet(!0),a.layout.setDetailFamilyCaption(a.entities[0].familyCaption),a.canDeleteRelationshipFamily===!1&&a.detailDatasheet.layout.isUnlinkAvailable(!1)),
0===a.entity.key||a.isSuperUser||a.layout.isSelectedSiteViewOnly(!0),b.resolve()}function D(a,b,c){c&&(a.throwException(a.translate("DS_DATASHEET_NOT_CONFIGURED_MESSAGE")),a.region.$element.find(".load-spinner").css("display","none")),b.reject()}function E(a){var c=Object.resolve(n),d,e,f=a.datasheetdto.customFormParameters["relationship Family ID"];a.cachedEntity||(a.cachedEntity={master:null,detail:null}),d=a.layout.getRelationshipFamilyById(f),e=c.getUserFull(),b.when(d,e).then(F.bind(null,a))}function F(a,c,d){var e,f;c&&(a.canDeleteRelationshipFamily=c.canDelete,a.canInsertRelationshipFamily=c.canInsert),y(a,d),e=a.renderMasterDatasheet(),f=a.renderDetailDatasheet(),b.when(e,f).then(a.renderMasterDetailDatasheet_done.bind(null,a))}s.prototype.renderMasterDetailDatasheet_done=function a(b){var c,d;b.entity.isSiteFiltered&&0===b.entity.key&&b.assetContextKey>0&&b.layout.assetContextKey(b.assetContextKey),b.layout.isDatasheetRendered(!0),b.layout.addMoreOptionsForIcons(),
b.masterDatasheet.layout.isDatasheetRendered(!1),b.masterDatasheet.layout.isDatasheetRendered(!0),d=K(b),0!==b.region.$element.find(".master-datasheet-container .nav-tabs").length&&(d+=40),c=H(b),I(b,c,d),b.region.$element.find(".master-detail-datasheet-disabled-overlay").is(":visible")&&b.masterDatasheet.tabSwitched()&&b.masterDatasheet.tabSwitched().add(L.bind(null,b)),b.masterDatasheet.entityModified.add(M.bind(null,b)),b.detailDatasheet.entityModified.add(N.bind(null,b)),b.masterDatasheet.entityDeleted.add(G.bind(null,b)),b.masterDatasheet.entityIdChanged.add(Ea.bind(null,b)),b.detailDatasheet.entityIdChanged.add(Ea.bind(null,b));var e=b.region.$element.find("mi-site-selector");if(e.length){b.siteSelector=e[0],Element.upgrade(b.siteSelector),"0"===b.layout.siteKey()&&0===b.entity.key&&b.siteSelector.selectDefaultSite();var f=b.siteSelector.isSiteViewOnly;f&&(b.layout.isSelectedSiteViewOnly(f),b.isSaveAvailable(!1),b.isDeleteAvailable(!1))}
b.canUpdateRefDocView&&(b.masterDatasheet.refDocs=b.refDocs,b.layout.showRefDocs()),b.layout.handleNavAppearance()};function G(a){a.entityDeleted.raise(a.entity)}function H(a){var b,c,d,e,f;return c=a.region.$element.find(".datasheet-layout-container.bulk-form-datasheet>div").height(),d=a.region.$element.find(".master-datasheet-container").height(),e=41,f=31,"True"===a.datasheetdto.customFormParameters["allow Insert"]?(b=d+c+e+f+51,a.detailDatasheet.newEntityFlag||(b=d+c+e+f)):"False"===a.datasheetdto.customFormParameters["allow Insert"]&&(b=d+c+e+f),b}function I(a,b,c){a.region.$element.find(".master-datasheet-container .nav-tabs").is(":visible")&&(b-=40),J(a.region.$element.find(".datasheet-layout-container .table-responsive"))&&(b-=30),a.layout.overlayTop(c+"px"),a.region.$element.find(".master-detail-datasheet-disabled-overlay").css("height",b)}function J(a){return 0!==a.length&&a[0].clientWidth<a[0].scrollWidth}function K(a){var b,c;return b=a.layout.overlayTop().split("px"),
c=parseInt(b[0])}function L(a){var b,c;b=K(a),c=H(a),I(a,c,b)}function M(a,b,c){a.cachedEntity.master=a.masterDatasheet.cachedEntity,a.entityModified.raise(b,c)}function N(a,b,c,d){a.detailDatasheet.masterSiteKey=a.layout.siteKey(),a.cachedEntity.detail=a.detailDatasheet.cachedEntity,a.entityModified.raise(b,c,d)}function O(a){a.layout.isRefDocsDisplayed(!1)}function P(a,b){a.refDocs=b,a.refDocsSet.raise()}function Q(a,b,c,d){var e;a.layout&&a.layout.detach(a.region),e=0===a.entity.key?a.entityFactory.new(a.entity.familyKey):a.entityFactory.get(a.entity.key),e.done(function(e){a.onFormsDatasheet.raise(b,c,d,e)}).fail(function(){a.throwException(a.translate("DS_LOAD_ENTITY_FAIL_EXCEPTION"))})}function R(a,b,c,d){a.layout&&a.layout.detach(a.region),a.onMasterDetailDatasheet.raise(b,c,d,a.entity)}function S(a,b,c,d,e){var f;a.layout.detach(a.region),f=0===a.entity.key?a.entityFactory.new(a.entity.familyKey):a.entityFactory.get(a.entity.key),f.done(function(f){
a.onNewMasterDetail.raise(b,c,f,d,e)}).fail(function(){a.throwException(a.translate("DS_LOAD_ENTITY_FAIL_EXCEPTION"))})}function T(a){var b=a.detailDatasheet.getSelectedEntities(),c=a.datasheetdto.customFormParameters,d=[],e,f=!1,g;k.showYesNo(a.translate("DS_UNLINK_SELECTED_ENTITIES_MESSAGE"),a.translate("DS_ALERT_TITLE")).done(function(h){if(0===h){for(var i=0;i<b.length;i++)d.push(b[i]);e=a.entityFactory.deleteRelationships(c["relationship Family ID"],a.entity.key,d),e.done(function(b){for(var c=0;c<b.length;c++)if(""!==b[c].errorMessage){f=!0,g=b[c].errorMessage;break}if(f)return void k.show(g,a.translate("DS_ERROR"));a.onBulkEntitiesUnlinked.raise()})}})}function U(b,c,d){var e=[],f=0;for(d=d||[],e=c.filter(function(a){return d.indexOf(a)===-1}),f=0;f<e.length;f++){b.detailDatasheet.updateRow("delete",c[f]);var g=a.findIndex(b.detailDatasheet.entity,function(a){return a.key===e[f]});b.detailDatasheet.entity.splice(g,1)}b.entities=b.detailDatasheet.entity}function V(a){
var c=b.Deferred();a.indicator.show();var d=a.entityFactory.checkIfEntityDirty(a.entity),e=a.entityFactory.checkIfEntitiesDirty(a.entities);return e.always(W.bind(null,a,d,e,c)),c}function W(a,c,d,e){var f=!1,g;"rejected"===d.state()&&(f=!0),g=b.when(c,d),g.done(X.bind(null,a,e)).fail(Y.bind(null,a,f,e))}function X(a,b){t(a,a.masterDatasheet.entity.siteKey),0===a.entity.key||a.savedSiteKey!==a.layout.siteKey()?Y(a,!1,b):(b.resolve(),da(a))}function Y(a,b,c){a.detailDatasheet.masterSiteKey=a.layout.siteKey(),a.detailDatasheet.getEntitiesToBeSaved(a.entities).done(Z.bind(null,a,b,c))}function Z(a,b,c,d){$(a,b,c,d)}function $(a,b,c,d){var e,f;if(a.layout.setErrorAndReturnErrorFlag(a,d))return c.reject(),void da(a);e=(a.entity.isDirty||a.entity.isNew)&&a.entity.isAuditable,f=a.entities.length>0&&(b||a.entity.isNew)&&a.entities[0].isAuditable,e||f?_(a,ca,c):ca(a,c)}function _(a,b,c){var d,e;d=Object.resolve(q),e=new g(d,a.translate("DS_AUTH_DIALOG_TITLE"),{height:300,width:400}),e.show(),
d.saveAllowed.add(b.bind(null,a,c,e)),d.saveDenied.add(aa.bind(null,a,c,e)),d.saveCancelled.add(ba.bind(null,a,e))}function aa(a,b,c){ba(a,c),k.showOk(a.translate("DS_AUTH_FAILURE_MSG"),a.translate("DS_AUTH_FAILURE_DIALOG_TITLE")),b.reject()}function ba(a,b){b&&(b.closeDialog(),da(a))}function ca(a,b,c){a.saveMasterEntity().done(xa.bind(null,a,b)).fail(ya.bind(null,a,b)),c&&c.closeDialog()}function da(a){a.indicator.hide()}function ea(a){var b,c;b=a.datasheetdto.customFormParameters["detail Family ID"],a.masterDatasheet.masterDatasheetDirtyEvent.add(fa.bind(null,a)),c=a.masterDatasheet.callOnDatasheetNew(),c.then(function(){if(a.entity=a.masterDatasheet.entity,a.layout.isDatasheetRenderedInRM())return void a.newDatasheet.raise(a.entity.familyKey);a.detailDatasheet.unload().done(function(){var c;a.onMasterDetailDatasheetNew.raise(a.entity),c=a.detailDatasheet.changeDatasheet([],a.config,b),c.then(function(){a.entities=a.detailDatasheet.entity}),
a.masterDatasheet.layout.isMasterDatasheet(!1),a.masterDatasheet.callOnDatasheetNew().done(function(){a.masterDatasheet.layout.isMasterDatasheet(!0),a.detailDatasheet.isMasterDatasheetDirty=!1})})})}function fa(a){a.detailDatasheet.isMasterDatasheetDirty=!0}function ga(a){a.masterDatasheet.callOnDatasheetDelete().done(function(){a.detailDatasheet.callOnMasterDatasheetDelete(),a.layout.isSaveAvailable(!1),a.layout.isDeleteAvailable(!1),a.layout.isHistoryAvailable(!1),a.layout.isCopyAvailable(!1),a.layout.setDetailFamilyCaption("")})}function ha(a){a.masterDatasheet.callOnDatasheetCopy(a.entity)}function ia(a){a.masterDatasheet.callOnDatasheetPaste(a.entity)}function ja(a,b){a.layout.canPaste&&a.layout.canPaste(b)}function ka(a){var b=Object.resolve(f),c=new h;b.attach(c,a.entity),b.loadHistory();var d=new g(b,a.translate("DS_FIELD_HISTORY_TITLE"),{height:"90%",width:"80%"});b.setDialog(d),d.show()}function la(a){
a.canUpdateRefDocView?(a.masterDatasheet.layout.updateRefDocView(a.refDocs),a.canUpdateRefDocView=!1):a.masterDatasheet.layout.showRefDocs()}function ma(a,b,c){a.masterDatasheet.callBeforeStateTransition(b,c)}function na(a,b,c){a.masterDatasheet.callOnStateTransition(b,c)}function oa(b){a.defer(function(){b.masterDatasheet&&b.detailDatasheet&&(b.masterDatasheet.layout.isDatasheetReadOnly(!1),b.detailDatasheet.layout&&(b.config.readonly===!0?(b.detailDatasheet.layout.isDatasheetReadOnly(!0),b.detailDatasheet.detailDatasheetEditDenied.raise()):b.detailDatasheet.layout.isDatasheetReadOnly(!1)))})}function pa(a){a.detailDatasheet&&(a.detailDatasheet.handleOverlay(),a.detailDatasheet.layout.handleScrolling())}function qa(a){var c,d,e;c=a.entityFactory.checkIfEntityDirty(a.entity),d=a.entityFactory.checkIfEntitiesDirty(a.entities),e=b.when(c,d),e.done(function(){a.layout.previousDatasheetKey(a.layout.currentDatasheetKey()),a.layout.executeDatasheetChanged()}).fail(function(){
wa().done(function(c){if(0===c)ra(a);else if(1===c){var e=b.Deferred(),f=!1;a.indicator.show(),"rejected"===d.state()&&(f=!0),Y(a,f,e),b.when(e).done(ra.bind(null,a))}}).fail(function(){a.layout.proceed=!1,a.layout.currentDatasheetKey(a.layout.previousDatasheetKey())})})}function ra(a){a.cachedEntity={master:null,detail:null},a.layout.previousDatasheetKey(a.layout.currentDatasheetKey()),a.layout.executeDatasheetChanged()}s.prototype.saveMasterEntity=function a(){var c=b.Deferred(),d=this,e=d.masterDatasheet.entity.checkIfEntityDirty();return d.savedSiteKey!==d.layout.siteKey()&&(d.masterDatasheet.entity.siteKey=d.layout.siteKey(),e.reject()),0===d.entity.key&&e.reject(),e.done(function(){c.reject(d.masterDatasheet.entity)}).fail(function(){d.entityFactory.save(d.masterDatasheet.entity).done(function(a){d.entity=a,c.resolve(a)}).fail(function(a){if(a.statusCode&&409===a.statusCode().status)d.layout.uiHelper.lockEntityUpdateHelper(d);else if(a.statusCode&&500===a.statusCode().status){
var b=d.translator.translate("MDF_SAVE_ERROR"),e=new p(1,b,a.responseJSON);d.appEvents.errorOccured.raise(d,e)}c.reject()})}),c},s.prototype.saveDetailEntities=function a(){var c=b.Deferred(),d=this,e=[],f,g,h;return f=d.datasheetdto.customFormParameters["relationship Family ID"],d.detailDatasheet.getEntitiesToBeSaved(d.entities).done(function(a,b){if(a.length>0){var e=sa(a);g=d.entityFactory.saveAndLinkEntities(a,d.entity.key,f),g.then(ua.bind(null,d,c,b,e))}else c.resolve(d.entities)}),c};function sa(b){return a.map(b,function(a){return{entitykey:a.key,lockSeqNbr:a.lockSeqNbr,sitekey:a.siteKey}})}function ta(a,b,c){for(var d=!1,e=0;e<b.length;e++)for(var f=0;f<c.length;f++)if(c[f].errorMessage===a.translator.translate("DS_BULK_ENTITY_CONCURRENT_WARNING_MESSSAGE")){a.layout.uiHelper.lockEntityUpdateHelper(a,"master"),d=!0;break}return d}function ua(b,c,d,e,f){var g=!1;if(e&&f&&ta(b,e,f))return c.reject(),void da(b)
;b.detailDatasheet.layout.isHistoryDisabled(!b.detailDatasheet.getHistoryStatus(f));for(var h=0;h<f.length;h++)""===f[h].errorMessage?(0===f[h].key||a.includes(b.detailDatasheet.entityObj,f[h].key.toString())||(b.detailDatasheet.entityObj.unshift(f[h].key.toString()),b.detailDatasheet.layout.updatePageCount(b.detailDatasheet.entityObj.length)),b.detailDatasheet.layout.updateRow("save",f[h],d[h]),b.detailDatasheet.getEntityStatus(b.entities[d[h]],b.detailDatasheet).done(function(a,c,d){b.detailDatasheet.layout.updateRow("status",a,c)}.bind(null,f[h]))):g=!0;g&&b.detailDatasheet.displayError(b.detailDatasheet),b.cachedEntity.detail=b.detailDatasheet.entity,c.resolve(b.entities)}s.prototype.unload=function a(){var c=this,d=b.Deferred(),e,f,g,h;return f=c.entityFactory.checkIfEntityDirty(c.entity),g=c.entityFactory.checkIfEntitiesDirty(c.entities),h=b.when(f,g),h.done(function(){d.resolve()}),h.fail(function(){wa().done(function(a){if(0===a)va(c,d);else if(1===a){var e=b.Deferred(),f=!1
;c.indicator.show(),"rejected"===g.state()&&(f=!0),Y(c,f,e),b.when(e).done(va.bind(null,c,d))}}).fail(function(){d.reject()})}),d};function va(a,b){a.layout&&(a.layout.detach(a.region),a.layout&&a.layout.deallocateMem(),a.layout=null,a.masterDatasheet.layout.changeCanPaste.remove(a),a.masterDatasheet.detachEntityEventHandlers(),b.resolve())}s.prototype.detachEntityEventHandlers=function a(){if(this.masterDatasheet&&this.masterDatasheet.detachEntityEventHandlers(),this.detailDatasheet)for(var b=0;this.detailDatasheet.entity&&b<this.detailDatasheet.entity.length;b++)this.detailDatasheet.detachEntityEventHandlers(this.detailDatasheet.entity[b]);this.appEvents&&this.appEvents.layoutChanged&&this.appEvents.layoutChanged.remove(u.bind(null,this))};function wa(){return k.showUnsavedChanges()}function xa(a,b,c){if(a.entity=c,0===a.entity.key||a.isSuperUser||a.layout.isSelectedSiteViewOnly(!0),a.noAccessToDetailDatasheet)return a.onMasterDetailDatasheetSaved.raise(a.entity),b.resolve(),
void da(a);a.detailDatasheet&&a.saveDetailEntities().done(za.bind(null,a,b))}function ya(a,b){a.detailDatasheet&&a.entityFactory.checkIfEntitiesDirty(a.entities).done(function(){b.resolve(),da(a)}).fail(function(){a.saveDetailEntities().done(za.bind(null,a,b))})}function za(a,b,c){a.entities=c,a.onMasterDetailDatasheetSaved.raise(a.entity),b.resolve(),da(a)}function Aa(a){var c={};return b.each(a,function(a,b){c[a.toLowerCase()]=b}),c}function Ba(a,b){var c;return b["allow Delete"]&&"false"!==b["allow Delete"].toLowerCase()||(c=a.indexOf("delete"))>-1&&a.splice(c,1),b["allow Insert"]&&"false"!==b["allow Insert"].toLowerCase()||(c=a.indexOf("new"),c>-1&&a.splice(c,1),(c=a.indexOf("link"))>-1&&a.splice(c,1)),b["allow Linking"]&&"false"!==b["allow Linking"].toLowerCase()||(c=a.indexOf("link"))>-1&&a.splice(c,1),b["allow Unlinking"]&&"false"!==b["allow Unlinking"].toLowerCase()||(c=a.indexOf("unlink"))>-1&&a.splice(c,1),a}function Ca(a){a.makeRootRecordEvent.raise(a.entity)}function Da(a){
a.unlinkRecordEvent.raise(a.entity)}function Ea(a,b){a.entityIdChanged.raise(b)}function Fa(a){return"-1"===a.entity.siteKey&&(a.cachedEntity=a.entity),a.cachedEntity}return s});

define('text!platform/datasheets/layout/ui/views/aggregate-datasheet.html',[],function () { return '<div class="datasheet-layout-container bulk-form-datasheet" data-bind="css:{\'edit\':!isDatasheetReadOnly()}">\r\n    <div class="datasheet-header-container">\r\n        <h2 data-bind="visible: noData, text: translate(\'DS_NO_DATA\')" class="no-data"></h2>\r\n        <h2 data-bind="text: title, visible: !noData"></h2>\r\n        <div data-bind="if: isDatasheetRendered" class="datasheet-nav">\r\n            <div class="pull-right">\r\n                <button class="btn btn-icon " data-bind="visible: isDatasheetRendered() && isSelectAllAvailable(), click: toggleSelectMode, attr: {title: translate(\'DS_SELECT_TOOLTIP\')}"><i class="icon-select-all"></i> </button>\r\n                <button class="btn btn-icon " data-bind="visible: isDatasheetRendered() && isDeleteAvailable(), click: deleteDatasheet, disable: hasSelection(), attr: {title: translate(\'DS_DELETE_TOOLTIP\')}"><i class="icon-bin"></i> </button>\r\n                <button class="btn btn-icon" data-bind="visible: isDatasheetRendered() && isSaveAvailable(), click: saveDatasheet, attr: {title: translate(\'DS_SAVE_TOOLTIP\')}"><i class="icon-save"></i> </button>\r\n            </div>\r\n        </div>\r\n        <h5 data-bind="text: currentDatasheetCaption"></h5>\r\n    </div>\r\n\r\n\r\n    <div class="table-responsive" data-bind="css:{\'title\':title,\'caption\':currentDatasheetCaption,\'full\':title() && currentDatasheetCaption()}">\r\n        <table class="table table-cust1">\r\n            <thead>\r\n                <tr data-bind="">\r\n                    <th data-bind="visible:$root.selectMode()">\r\n                        <div class="checkbox-selectall">\r\n                            <mi-checkbox data-bind="miCheckboxProperty:{ checked:$root.selectAll}"> </mi-checkbox>\r\n\r\n                        </div>\r\n                    </th>\r\n                    <!-- ko foreach:columns -->\r\n                    <th data-bind="text:columnCaption"></th>\r\n                    <!-- /ko -->\r\n                </tr>\r\n            </thead>\r\n            <tbody data-bind="foreach:rows">\r\n                <tr data-bind="css:{\'active\':$data.isSelected},visible:!isReadonly()">\r\n                    <td data-bind="visible:$root.selectMode()">\r\n                        <div class="checkbox-selectall">\r\n                            <mi-checkbox data-bind="miCheckboxProperty:{ checked:$data.isSelected, value:$data.entitykey, disable:$data.isCheckboxDisabled}"> </mi-checkbox>\r\n\r\n                        </div>\r\n                    </td>\r\n\r\n                    <!-- ko foreach:$data.cols -->\r\n                    <td class="datasheetCell" data-bind="template:{name:controlTemplate()} , event: { keyup: function bulkdatasheet_element_onkeyup(data,event){ $root.focusNextRow(data,event,$index,$parentContext.$index);}}"></td>\r\n                    <!-- /ko -->\r\n                </tr>\r\n            </tbody>\r\n\r\n\r\n        </table>\r\n\r\n        <div class="bulk-datasheet-disabled-overlay" data-bind="visible: isDatasheetReadOnly,style: { top: overlayTop}"></div>\r\n\r\n    </div>\r\n</div>';});

define('platform/datasheets/layout/ui/aggregate-datasheet-view-model',['require','lodash','jquery','knockout','spa/ko/knockout-view-model','./bulk-column-view-model','./bulk-row-view-model','../services/datasheet-service','system/lang/event','../model/field-value-model','../model/entity-model','../adapters/datasheet-adapter','../adapters/datasheet-field-info-adapter','./helpers/ui-helper','./helpers/js-module-helper','text!./views/aggregate-datasheet.html','text!./field-control-template-map.json','text!./views/templates/field-check-box-template.html','text!./views/templates/field-combo-box-template.html','text!./views/templates/field-date-template.html','text!./views/templates/field-radio-template.html','text!./views/templates/field-text-area-template.html','text!./views/templates/field-hyperlink-template.html','text!./views/templates/field-text-template.html','text!./views/templates/field-select-template.html','text!./views/templates/field-multivalue-template.html','text!./views/templates/field-date-alt-template.html','text!./views/templates/field-empty-template.html','text!./views/templates/field-multi-text-template.html','system/globalization/translator','system/knockout/knockout-helpers','jquery-ui','ui/elements/checkbox/checkbox-view-model','ui/elements/select/view-model','ui/elements/multi-value/view-model','ui/elements/text-ext/view-model'],function(require){"use strict"
;var a=require("lodash"),b=require("jquery"),c=require("knockout"),d=require("spa/ko/knockout-view-model"),e=require("./bulk-column-view-model"),f=require("./bulk-row-view-model"),g=require("../services/datasheet-service"),h=require("system/lang/event"),i=require("../model/field-value-model"),j=require("../model/entity-model"),k=require("../adapters/datasheet-adapter"),l=require("../adapters/datasheet-field-info-adapter"),m=require("./helpers/ui-helper"),n=require("./helpers/js-module-helper"),o=require("text!./views/aggregate-datasheet.html"),p=JSON.parse(require("text!./field-control-template-map.json")),q=require("text!./views/templates/field-check-box-template.html")+require("text!./views/templates/field-combo-box-template.html")+require("text!./views/templates/field-date-template.html")+require("text!./views/templates/field-radio-template.html")+require("text!./views/templates/field-text-area-template.html")+require("text!./views/templates/field-hyperlink-template.html")+require("text!./views/templates/field-text-template.html")+require("text!./views/templates/field-select-template.html")+require("text!./views/templates/field-multivalue-template.html")+require("text!./views/templates/field-date-alt-template.html")+require("text!./views/templates/field-empty-template.html")+require("text!./views/templates/field-multi-text-template.html"),r=require("system/globalization/translator")
;require("system/knockout/knockout-helpers"),require("jquery-ui"),require("ui/elements/checkbox/checkbox-view-model"),require("ui/elements/select/view-model"),require("ui/elements/multi-value/view-model"),require("ui/elements/text-ext/view-model");function s(a){t.call(this,o),this.region=null,this.datasheetService=a,this.translator=Object.resolve(r),this.uiHelper=Object.resolve(m),this.jsModuleHelper=Object.resolve(n),this.title=c.observable("Datasheet"),this.isBulkDatasheet=c.observable(!0),this.datasheetKeys=c.observableArray(),this.datasheets=c.observableArray(),this.currentDatasheetKey=c.observable(),this.currentDatasheetCaption=c.observable(),this.cachedFieldValues=null,this.cachedFamilykey=null,this.currentDatasheet=c.observable(),this.currentEntity=c.observable(),this.currentEntities=c.observable(),this.fieldInfos=c.observableArray(),this.columns=c.observableArray(),this.rows=c.observableArray(),this.currentCellIndex=c.observable(0),this.entities=c.observableArray(),
this.isSelectAllAvailable=c.observable(!0),this.isSaveAvailable=c.observable(!0),this.isDeleteAvailable=c.observable(!0),this.isHistoryAvailable=c.observable(!0),this.isHistoryDisabled=c.observable(!1),this.isSingleEntitySelected=c.observable(!1),this.isLinkAvailable=c.observable(!0),this.isUnlinkAvailable=c.observable(!0),this.isNewAvailable=c.observable(!0),this.isDatasheetReadOnly=c.observable(!1),this.canEdit=c.observable(!1),this.overlayTop=c.observable("0"),this.showDatasheetSelection=c.observable(!0),this.oldEntity=null,this.isDatasheetRendered=c.observable(!1),this.isReadOnly=c.observable(!1),this.layoutRendered=new h,this.entityRendered=new h,this.fieldValueChanged=new h,this.currentEntityChanged=new h,this.datasheetSaved=new h,this.datasheetNew=new h,this.datasheetDelete=new h,this.datasheetHistory=new h,this.hasSelectionChanged=new h,this.unlinkEntities=new h,this.selectMode=c.observable(!1),this.hasSelection=c.observable(!0),this.selectAll=c.observable(!1),
this.isTextareaFocused=c.observable(!1),this.noData=c.observable(!1),this.selectedEntities=c.computed(I.bind(null,this)),this.currentEntityChangedSubscription=this.currentEntity.subscribe(x.bind(null,this)),this.currentEntityBeforeChangeSubscription=this.currentEntity.subscribe(w.bind(null,this),null,"beforeChange"),this.selectedEntities.subscribe(J.bind(null,this)),this.selectAll.subscribe(K.bind(null,this)),this.useNativeSelect=c.observable(!1),this.uiHelper.attachTemplatesForAggregate(this,q)}var t=Object.inherit(d,s);s.dependsOn=[g],s.prototype.activate=function a(){},s.prototype.attach=function a(b){t.prototype.attach.call(this,b),this.region=b},s.prototype.detach=function a(b){t.prototype.detach.call(this,b)},s.prototype.translate=function a(b){return this.translator.translate(b)},s.prototype.setTitle=function a(b){this.title(b)},s.prototype.newDatasheet=function a(){this.datasheetNew.raise()},s.prototype.saveDatasheet=function a(){this.datasheetSaved.raise(this.entities())},
s.prototype.deleteDatasheet=function a(){this.datasheetDelete.raise(this.selectedEntities())},s.prototype.toggleSelectMode=function a(){this.selectMode(!this.selectMode())},s.prototype.unlinkRelatedEntities=function a(){this.unlinkEntities.raise()},s.prototype.showEditMode=function a(){this.isDatasheetReadOnly(!1)},s.prototype.showDatasheet=function a(c){var d=this,e=b.Deferred(),f=b.Deferred(),g,h,i,j;return u(d,c),B(d,c),H(d),f.resolve(c),e.resolve(),f},s.prototype.assignFieldValues=function a(b){for(var c=this,d=0,e=0;e<b.length;e++)F(c,e,b),d=0};function u(b,c){var d=0;a.each(c,function(b){a.each(b,function(b){a.each(b.fields,function(a){a.options.picklist&&d++})})}),d>5&&b.useNativeSelect(!0)}s.prototype.updateFieldValue=function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=0,t=0,u,w=[],x=null,y=this;if(this.entities()){for(var z=0;z<this.entities().length;z++)for(var A=0;A<this.entities()[z].length;A++){
if("0"===this.entities()[z][A].key.toString()&&"0"===b.key.toString()&&this.entities()[z][A].clientid===b.clientid){u=this.entities()[z][A];break}if("0"!==b.key.toString()&&this.entities()[z][A].key.toString()===b.key.toString()){u=this.entities()[z][A];break}}w=u.fieldValues()}if(r&&null!==m)for(s=0;s!==w.length;s++)for(t=0;t!==m.length;t++)w[s].key().toString()!==m[t]&&w[s].key()!==m[t]&&w[s].key()!==c||w[s].clientDisabled(!1);for(s=0;s!==w.length;s++){if(w[s].key().toString()===c||w[s].key()===c){x=w[s];break}w[s].changedFromView(!0)}v(x,{newValue:d,newValues:e,newDisplayValue:f,picklist:g,isDisabled:h,isRequired:i,errorMessage:j,backColor:k,maxNumberOfValues:l,jsModuleName:n,jsModuleParams:o,popJSModuleOnFocus:p,stopPropagate:r,addParseValueParam:q})};function v(a,b){a&&(b.stopPropagate&&a.changedFromView(!1),a.value(b.newValue),a.values(b.newValues),a._values(b.newValues),a.displayValue(b.newDisplayValue),a.disabled(b.isDisabled),a.required(b.isRequired),
a.errorMessage(b.errorMessage),a.backColor(b.backColor),a.maxNumberOfValues(b.maxNumberOfValues),void 0!==a.jsModuleName&&a.jsModuleName()&&null!==a.jsModuleName()&&a.jsModuleName(b.jsModuleName),void 0!==a.jsModuleParams&&a.jsModuleParams()&&null!==a.jsModuleParams()&&a.jsModuleParams(b.jsModuleParams),void 0!==a.popJSModuleOnFocus&&a.popJSModuleOnFocus()&&null!==a.popJSModuleOnFocus()&&a.popJSModuleOnFocus(b.popJSModuleOnFocus),void 0!==a.picklist&&a.picklist(a.createPickList(b.picklist)),a.changedFromView(!0))}s.prototype.updateRow=function a(b,d,e){var f=this,g;if("delete"===b)g=f.deleteRow(d);else if("new"===b){for(var h=!1,i=0;i<f.rows().length;i++)"new-clean"===f.rows()[i].entityStatus()&&(h=!0);h||(g=f.addNewRow(d))}else"status"===b?(g=f.getRowByKey(d),g.entityStatus(e)):"save"===b?(f.entities()[e].key=d.key,f.entities()[e].clientid=void 0,f.rows()[e].entitykey(d.key),0!==d.key&&f.rows()[e].isCheckboxDisabled(!1),
window.entitykey=c.observable(d.key)):"clientid"===b&&(f.entities()[0].clientid=d.clientid,f.rows()[0].clientid(d.clientid))},s.prototype.renderDateControl=function c(d,e,f){if(!e.fieldValue().disabled()){var g=b(f.currentTarget).closest("td");e.controlTemplate(p.Date),e.fieldValue().handleDate(),a.delay(function(){var a=b(g).find("input.form-control");a.trigger("focus"),a.on("keypress keydown",function(a){a.preventDefault()})},10)}},s.prototype.addNewRow=function a(b){var c=this,d,e=c.rows().length;c.rows.push(new f(b.entitykey,b.clientid,c)),d=c.rows()[e],d.entityStatus("new-clean"),d.isCheckboxDisabled(!0),c.cachedFieldValues.push(b),c.attachEntityToLayout(b.entitykey,b.fields,e,b.clientid),F(c,e)},s.prototype.deleteRow=function a(b){var c=this,d,e,f;for(f=0;f<c.rows().length;f++)if(c.rows()[f].entitykey().toString()===b.toString()){d=c.rows()[f],e=f;break}for(c.rows.remove(d),f=0;f<c.entities().length;f++)if(c.entities()[f].key.toString()===b.toString()){d=c.entities()[f],e=f;break
}return c.entities.remove(d),d},s.prototype.getRowByKey=function a(b){var c=this,d=c.rows(),e,f;if(0!==b.key&&"0"!==b.key){for(f=0;f<d.length;f++)if(d[f].entityKeyArray().indexOf(b.key)>-1){e=d[f];break}}else for(f=0;f<d.length;f++)if(d[f].clientid()==b.clientid){e=d[f];break}return e},s.prototype.dispose=function a(){this.currentEntity()&&this.currentEntity().dispose(),this.layoutRendered.remove(),this.entityRendered.remove()};function w(a,b){a.oldEntity=b}function x(a,b){a.oldValue&&a.oldValue.dispose(),b.fieldValueChanged.add(A.bind(null,a)),a.currentEntityChanged.raise(b,a.oldEntity)}function y(a,b){var c=k.toModelObject(b);a.currentDatasheet(c)}function z(a,c){var d=b.map(c,function(a){return l.toModelObject(a)});a.fieldInfos(d)}function A(a,b,c,d,e,f,g,h){var i=0,j=0,k,l=[];if(a.entities()){for(var m=0;m<a.entities().length;m++)for(var n=0;n<a.entities()[m].length;n++){
if("0"===a.entities()[m][n].key.toString()&&"0"===b.toString()&&a.entities()[m][n].clientid.toString()===f.toString()){k=a.entities()[m][n];break}if("0"!==b.toString()&&a.entities()[m][n].key.toString()===b.toString()){k=a.entities()[m][n];break}}l=k.fieldValues()}for(i=0;i!==l.length;i++)for(j=0;j!==g.length;j++)l[i].key().toString()!==g[j]&&l[i].key()!==g[j]&&l[i].key()!==c||l[i].clientDisabled(!0);a.fieldValueChanged.raise(b,c,d,e,f,h)}function B(a,b){for(var c=b.length-1,d=[],g=0;g<b.length;g++){for(var h=[],i=0;i<b[g].length;i++)h.push(b[g][i].entitykey);var j=new f(h,b[g][0].clientid,a);d.push(j),a.attachEntityToLayout(b[g],g);for(var k=0;k<b[g].length;k++){var l=j.cols().length,m=a.entities()[g][k];if(b[g][k].fields.length>0)for(var n=0;n<b[g][k].fields.length;n++){var o={},q=m.fieldValues()[n];o.columnCaption=b[g][k].fields[n].fieldCaption,o.columnFieldKey=b[g][k].fields[n].fieldKey;var r=new e(o);j.addColumn(r),j.cols()[l+n].fieldValue(q)
;var s=p[b[g][k].fields[n].fieldDataType]||"Character";E(a,q,j.cols()[l+n],s)}else for(var t=0;t<b[c][k].fields.length;t++){var u={};u.columnCaption=b[c][k].fields[t].fieldCaption,u.columnFieldKey=b[c][k].fields[t].fieldKey,j.addColumn(new e(u))}}}a.rows(d),a.columns(a.rows()[c].cols())}s.prototype.attachEntityToLayout=function a(b,c){var d=this,e=[];C(d,b,e),d.entities.push(e)};function C(a,b,c){for(var d=0;d<b.length;d++){for(var e=b[d].fields.length,f=[],g,h=0;h!==e;h++)f.push(new i(b[d].fields[h].fieldKey,b[d].fields[h].fieldId,b[d].fields[h].fieldValue,b[d].fields[h].fieldDisplayValue,{required:b[d].fields[h].options.required,disabled:b[d].fields[h].options.disabled,unitOfMeasure:b[d].fields[h].options.unitOfMeasure,picklist:b[d].fields[h].options.picklist,backColor:b[d].fields[h].options.backColor,jsModuleName:b[d].fields[h].options.jsModuleName,jsModuleParams:b[d].fields[h].options.jsModuleParams,popJSModuleOnFocus:b[d].fields[h].options.popJSModuleOnFocus,
addParseValueParam:b[d].fields[h].options.addParseValueParam,dependentFields:b[d].fields[h].options.dependentFields,isPicklistRestricted:b[d].fields[h].options.isPicklistRestricted,maxNumberOfValues:b[d].fields[h].options.maxNumberOfValues,values:b[d].fields[h].options.values,format:b[d].fields[h].options.format},b[d].clientid,b[d].entitykey));g=new j(f,b[d].entitykey,b[d].clientid),c.push(g),c[d].fieldValueChanged.add(A.bind(null,a))}}function D(a,b,c){var d=0,e=0,f=0,g=0,h,i,j;for(h=a.entities()[b],g=c.length-1,d=0;d<h.length;d++)if(i=h[d],i.fieldValues().length>0){for(e=0;e!==i.fieldValues().length;e++)j=i.fieldValues()[e],a.rows()[b].cols()[f+e].fieldValue(j);f+=i.fieldValues().length}else{var k=c[g][d].fields.length;for(e=0;e!==k;e++)a.rows()[b].cols()[f].fieldValue(null),f+=1}}function E(a,b,c,d){d=d||null,
void 0!==b.picklist?d=a.useNativeSelect()&&parseInt(b.maxNumberOfValues())<2?p.Select:b.isPicklistRestricted()?p.ComboBox:p.MultiValue:parseInt(b.maxNumberOfValues())>1?d=p.MultiText:b.displayValue().indexOf("href")>0&&(d=p.Hyperlink),d===p.Date&&(d=p.DateAlt),c.controlTemplate(d),"field-date-template"===c.controlTemplate()&&b.handleDate()}function F(a,b,c){G(a,b,c),a.entityRendered.raise()}function G(a,b,c){var d=0,e=0,f=0,g=0,h,i,j;for(h=a.entities()[b],g=c.length-1,d=0;d<h.length;d++)if(i=h[d],i.fieldValues().length>0)f+=i.fieldValues().length;else{var k=c[g][d].fields.length;for(e=0;e!==k;e++)a.rows()[b].cols()[f].controlTemplate(p.Empty),f+=1}}function H(a){a.layoutRendered.raise(),a.isDatasheetRendered(!0)}s.prototype.focusNextRow=function a(c,d,e,f){var g=this.rows(),h=this;switch(d.which){case b.ui.keyCode.LEFT:this.moveLeft(c,g,e,f);break;case b.ui.keyCode.UP:this.moveUp(c,g,e,f);break;case b.ui.keyCode.RIGHT:this.moveRight(c,g,e,f);break;case b.ui.keyCode.DOWN:
this.moveDown(c,g,e,f);break;case b.ui.keyCode.SPACE:"field-check-box-template"===c.controlTemplate()&&c.fieldValue().value(!c.fieldValue().value());break;case b.ui.keyCode.TAB:if("field-text-area-template"!==c.controlTemplate()||this.isTextareaFocused())if(b(d.target).hasClass("custom-bulk-ds-button")){if(h.moveRight(c,h.rows(),e,f),e()<h.rows()[f()].cols().length-1){var i=h.rows()[f()].cols()[e()+1];"field-text-template"===i.controlTemplate()&&i.fieldValue().jsModuleName()&&i.fieldValue().jsModuleName().length>0&&h.callOnFocus(i.fieldValue(),i,function(){return e()+1},f)}}else"field-text-template"===c.controlTemplate()&&c.fieldValue().jsModuleName()&&c.fieldValue().jsModuleName().length&&h.callOnFocus(c.fieldValue(),c,e,f);else{var j=this.showTextEditor(c);this.isTextareaFocused(!0),j.onSave.add(function(){h.isTextareaFocused(!1),h.focusCell(c,h.rows(),e,f)}),j.onClose.add(function(){h.isTextareaFocused(!1),h.focusCell(c,h.rows(),e,f)})}break;default:return!0}return!0},
s.prototype.moveToNextCell=function a(b,c){c.fieldValue().isSelected(!0),"field-text-area-template"===c.controlTemplate()&&b.fieldValue().showTextEditor.call(c)},s.prototype.moveLeft=function a(b,c,d,e){var f;f=c[e()].cols()[d()-1],d()>0&&(f.fieldValue().isSelected(!0),"field-text-area-template"===f.controlTemplate()&&b.fieldValue().showTextEditor.call(f))},s.prototype.moveRight=function a(b,c,d,e){var f,g=this;f=c[e()].cols()[d()+1],d()<c[e()].cols().length-1&&(f.fieldValue().isSelected(!0),"field-text-area-template"===f.controlTemplate()&&g.showTextEditor(b,function(){return d()+1},e))},s.prototype.focusCell=function a(b,c,d,e){var f;f=c[e()].cols()[d()],f.fieldValue().isSelected(!0)},s.prototype.moveToNextModuleCell=function a(b,c,d,e){for(var f,g,h,i=e();i<c.length;i++){for(i+=1,h=d();c[i]&&h<c[i].cols().length;h++)if(f=c[i].cols()[h],f.fieldValue().popJSModuleOnFocus()){f.fieldValue().isSelected(!0);break}break}},s.prototype.moveUp=function a(b,c,d,e){
e()>0&&c[e()-1].cols()[d()].fieldValue().isSelected(!0)},s.prototype.moveDown=function a(b,c,d,e){e()<c.length-1?c[e()+1].cols()[d()].fieldValue().isSelected(!0):e()===c.length-1&&"new-dirty"===c[e()].entityStatus()&&(this.currentCellIndex(d()),this.datasheetNew.raise())},s.prototype.showTextEditor=function a(b,c,d){var e=this,f=b.fieldValue().showTextEditor.call(b);return this.isTextareaFocused(!0),f.onSave.add(function a(){e.isTextareaFocused(!1),e.focusCell(b,e.rows(),c,d)}),f.onClose.add(function a(){e.isTextareaFocused(!1),e.focusCell(b,e.rows(),c,d)}),f},s.prototype.multipleRowSelect=function a(b,c,d){var e;if(c.shiftKey){var f=[];for(e=0;e<this.rows().length;e++)this.rows()[e].isSelected()&&f.push(e);if(0!==f.length)if(d()<f[0])for(e=d()+1;e<f[0];e++)this.rows()[e].isSelected(!0);else if(d()>f[f.length-1])for(e=f[f.length-1];e<d();e++)this.rows()[e].isSelected(!0)}};function I(a){var b=[];return c.utils.arrayForEach(a.rows(),function(a){
if(a.isSelected()&&a.entityKeyArray()!==[])for(var c=0;c<a.entityKeyArray().length;c++)b.push(a.entityKeyArray()[c])}),b}function J(a,b){a.hasSelection(!b.length),1===b.length?a.isSingleEntitySelected(!0):a.isSingleEntitySelected(!1)}function K(a,b){c.utils.arrayForEach(a.rows(),function(a){a.entitykey()&&!a.isReadonly()?a.isSelected(b):a.isSelected(!1)})}return s.prototype.getSelectedEntities=function a(){return this.selectedEntities()},s.prototype.showJSModule=function a(b,c,d,e,f,g,h,i){var j={key:b,jsModuleName:e,jsModuleParams:f,type:"aggregate",entityKey:c,clientID:d,data:g,cellIndex:h,rowIndex:i,fieldKey:g.columnFieldKey};this.jsModuleHelper.showJSModule(this,j)},s.prototype.callOnFocus=function a(b,c,d,e){var f={key:b.key(),data:c,cellIndex:d,rowIndex:e,type:"aggregate",entityKey:b.entityKey(),clientID:b.clientid(),fieldKey:c.columnFieldKey};this.jsModuleHelper.callOnFocus(this,f,b)},s});
define('platform/datasheets/aggregate-datasheet-manager',['require','jquery','./layout/ui/aggregate-datasheet-view-model','application/application-context','spa/region','../entity/entity-factory','text!./layout/ui/views/spinner.html','system/lang/event','./error-dialog/ui/error-dialog-view-model','system/ui/dialog-view-model','./layout/ui/datasheet-history-view-model','system/ui/message-box','system/ui/unsaved-changes-message-box','system/globalization/translator','application/application-events','system/error/error-message'],function(require){"use strict";var a=require("jquery"),b=require("./layout/ui/aggregate-datasheet-view-model"),c=require("application/application-context"),d=require("spa/region"),e=require("../entity/entity-factory"),f=require("text!./layout/ui/views/spinner.html"),g=require("system/lang/event"),h=require("./error-dialog/ui/error-dialog-view-model"),i=require("system/ui/dialog-view-model"),j=require("./layout/ui/datasheet-history-view-model"),k=require("system/ui/message-box"),l=require("system/ui/unsaved-changes-message-box"),m=require("system/globalization/translator"),n=require("application/application-events"),o=require("system/error/error-message");function p(a){this.defaultConfig={functionsavailable:["select","save","delete"],readonly:!1},this.translator=Object.resolve(m),this.containerEl=a.containerel,this.aggregateObject=a.aggregateobject,this.disableNonInputColumns=a.disablenoninputcolumns,this.entityFactory=new e,this.appEvents=Object.resolve(n),
this.entitySaved=new g,this.beforeEntitiesSaved=new g,this.entityModified=new g,this.entityDeleted=new g,this.beforeEntitiesDelete=new g,this.entityCreated=new g,this.unlinkEntities=new g,this.sequenceNumber=1,this.window=window,this.siteKey=void 0}p.prototype.translate=function a(b){return this.translator.translate(b)},p.prototype.load=function e(f){var g=this,h=a.Deferred(),i,j;return g.showSpinner(),i=g.getEntityPromise(),f&&(g.setConfig(f),g.siteKey=g.config.sitekey),i.done(function(a){if(g.cachedEntity&&(a=g.cachedEntity),0===a.length)return h.reject(),g.layout=Object.resolve(b),g.region=new d,g.region.setElement(g.containerEl),g.layout.attach(g.region),g.clearSpinner(),void g.layout.noData(!0);g.entity=a;for(var e=1,f=0;f<a.length;f++)for(var i=0;i<a[f].length;i++)g.attachEntityEventListeners(a[f][i]),g.entity[f][i].clientid=e++,0===a[f][i].key&&void 0!==g.siteKey?g.entity[f][i].siteKey=g.siteKey:0===a[f][i].key&&void 0===g.siteKey&&(g.entity[f][i].siteKey=c.user.defaultSiteKey)
;j=g.renderDatasheet(a),j.done(function(a){g.clearSpinner(),h.resolve(g.entity),g.layout.assignFieldValues(a)}).fail(function(){g.clearSpinner(),g.throwException(g.translate("DS_RENDER_DATASHEET_FAIL_EXCEPTION")),h.reject()})}).fail(function(){g.clearSpinner(),g.throwException(g.translate("DS_LOAD_ENTITY_FAIL_EXCEPTION")),h.reject()}),h},p.prototype.reload=function a(b){var c=this;return b&&(c.aggregateObject=b),c.load()},p.prototype.getEntityPromise=function a(){return this.loadEntity()},p.prototype.loadEntity=function b(){var c=a.Deferred(),d=this;return"query"===z(d.aggregateObject)?d.entityFactory.getAggregatedEntities(d.aggregateObject).done(function(a){c.resolve(a)}).fail(function(a){d.clearSpinner(),d.throwException(a),c.reject()}):d.entityFactory.getAggregateEntitiesForCompositeObj(d.aggregateObject).done(function(a){c.resolve(a)}).fail(function(a){d.clearSpinner(),d.throwException(a),c.reject()}),c.promise()},p.prototype.setConfig=function b(c){var d=this;d.config=c||{},
d.config=y(d.config),a.extend(d.defaultConfig,d.config),d.config=d.defaultConfig},p.prototype.updateState=function a(b){b&&(this.cachedEntity=b)},p.prototype.getState=function a(){var b,c;for(b=0;b<this.entity.length;b++)for(c=0;c<this.entity[b].length;c++)this.detachEntityEventListeners(this.entity[b][c]);return this.cachedEntity},p.prototype.renderDatasheet=function a(b){return q(this,b)},p.prototype.attachEntityEventListeners=function a(b){var c=this;b.entityModified.add(c.onEntityChanged,c)},p.prototype.detachEntityEventListeners=function a(b){var c=this;b.entityModified&&b.entityModified.remove(c)},p.prototype.attachLayoutEventListeners=function a(){var b=this;b.layout.datasheetSaved.add(u.bind(null,b)),b.layout.datasheetDelete.add(v.bind(null,b))},p.prototype.throwException=function a(b){var c=new o(1,b,"platform/datasheets/aggregate-datasheet-manager.js");this.appEvents.errorOccured.raise(this,c)};function q(c,e){var f=a.Deferred(),g=[];c.layout=Object.resolve(b),c.region=new d,
c.attachLayoutEventListeners(),c.layout.fieldValueChanged.add(t.bind(null,c)),c.region.setElement(c.containerEl),c.layout.attach(c.region);for(var h=0;h<e.length;h++){for(var i=[],j=0;j<e[h].length;j++)i.push({entitykey:e[h][j].key,clientid:c.sequenceNumber++,fields:r(c,e[h][j]),sitekey:e[h][j].siteKey});g.push(i)}return c.layout.showDatasheet(g).done(function(b){if(c.config.functionsavailable&&(a.inArray("select",c.config.functionsavailable)<0&&c.layout.isSelectAllAvailable(!1),a.inArray("save",c.config.functionsavailable)<0&&c.layout.isSaveAvailable(!1),a.inArray("delete",c.config.functionsavailable)<0&&c.layout.isDeleteAvailable(!1)),c.config.readonly){c.layout.isDatasheetReadOnly(!0),c.layout.canEdit(c.config.canedit);var d=0;0!==a(".datasheet-layout-container").find(".datasheet-nav").length&&(d+=80),c.layout.overlayTop(d+"px")}else c.layout.isDatasheetReadOnly(!1);f.resolve(b)}).fail(function(){c.clearSpinner(),f.reject()}),f}function r(a,b){
for(var c=b.fields.models.length,d=[],e=0;e<c;e++)d.push({fieldKey:b.fields.models[e].get("key"),fieldId:b.fields.models[e].get("id"),fieldCaption:b.fields.models[e].get("caption"),fieldDataType:b.fields.models[e].get("dataType"),fieldValue:b.fields.models[e].get("value"),fieldDisplayValue:b.fields.models[e].get("displayValue"),options:{required:b.fields.models[e].get("isRequired"),disabled:s(a,b.key,b.fields.models[e].get("id"),b.fields.models[e].get("isDisabled")),unitOfMeasure:b.fields.models[e].get("unitOfMeasure"),picklist:b.fields.models[e].get("pickList"),backColor:b.fields.models[e].get("backColor"),jsModuleName:b.fields.models[e].get("jsModuleName"),jsModuleParams:b.fields.models[e].get("jsModuleParams"),popJSModuleOnFocus:b.fields.models[e].get("popJSModuleOnFocus"),addParseValueParam:b.fields.models[e].get("addParseValueParam"),dependentFields:b.fields.models[e].get("dependentFields"),isPicklistRestricted:b.fields.models[e].get("isPicklistRestricted"),
maxNumberOfValues:b.fields.models[e].get("maxNumberOfValues"),values:b.fields.models[e].get("values"),format:b.fields.models[e].get("format")}});return d}function s(a,b,c,d){return void 0!==a.disableNonInputColumns&&"true"===a.disableNonInputColumns.toString()&&"0"!==b.toString()||d}function t(a,b,c,d,e,f,g){for(var h=!0,i,j=0;j<a.entity.length;j++)for(var k=0;k<a.entity[j].length;k++){if("0"===a.entity[j][k].key.toString()&&"0"===b.toString()&&a.entity[j][k].clientid===f){i=a.entity[j][k];break}if("0"!==b.toString()&&a.entity[j][k].key.toString()===b.toString()){i=a.entity[j][k];break}}g?a.entityFactory.updateFieldByKey(i,c,d,g):a.entityFactory.updateFieldValue(i,c,d,e,h)}p.prototype.onEntityChanged=function b(c,d,e,f){var g,h,i,j=this,k;k=e?d.dependentFields:null;var l=f?d.value:d.displayValue;if(j.layout&&(g=j.getEntityStatus(c,j),
j.layout.updateFieldValue(c,d.key,d.value,d.values,l,d.pickList,d.isDisabled,d.isRequired,d.errorMessage,d.backColor,d.maxNumberOfValues,k,d.jsModuleName,d.jsModuleParams,d.popJSModuleOnFocus,d.addParseValueParam,!0)),j.cachedEntity){for(h=0;h<j.cachedEntity.length;h++)for(i=0;i<j.cachedEntity[h].length;i++)if((void 0===j.cachedEntity[h][i].clientid||0!==c.key)&&c.key.toString()===j.cachedEntity[h][i].key.toString()||j.cachedEntity[h][i].clientid&&j.cachedEntity[h][i].clientid===c.clientid){j.cachedEntity[h][i]=a.extend(!0,c,j.cachedEntity[h][i]);break}}else for(j.cachedEntity=j.entity,h=0;h<j.cachedEntity.length;h++)for(i=0;i<j.cachedEntity[h].length;i++)if(j.cachedEntity[h][i].clientid&&j.cachedEntity[h][i].clientid===c.clientid||(void 0===j.cachedEntity[h][i].clientid||0!==c.key)&&c.key.toString()===j.cachedEntity[h][i].key.toString()){j.cachedEntity[h][i]=c;break}j.entityModified.raise(d,e,c)};function u(a,b,c){var d=[],e=0,f=0,g=!1;d=a.getEntitiesToBeSaved(b),d.done(function(b){
var d={entity:b,datasheetSaveDfd:c};a.beforeEntitiesSaved.raise(d)})}function v(a,b){var c=[];k.showYesNo(a.translate("DS_DELETE_SELECTED_ENTITIES_MESSAGE"),a.translate("CONFIRM_REC_DEL")).done(function(d){if(0===d){for(var e=0;e<a.entity.length;e++)for(var f=0;f<a.entity[e].length;f++)for(var g=0;g<b.length;g++)a.entity[e][f].key==b[g]&&c.push(a.entity[e][f].key);a.beforeEntitiesDelete.raise(c)}})}p.prototype.unload=function b(){var c=this,d=a.Deferred(),e=c.entityFactory.checkIfCompositeEntitiesDirty(c.entity);return e.done(function(){c.layout&&c.layout.detach(c.region),d.resolve()}),e.fail(function(){x().done(function(b){if(0===b)w(c,d);else if(1===b){var e=a.Deferred();u(c,c.entity,e),a.when(e).done(w.bind(null,c,d))}}).fail(function(){d.reject()})}),d};function w(a,b){a.layout&&(a.layout.detach(a.region),b.resolve())}p.prototype.setTitle=function a(b){var c=this;c.layout&&c.layout.setTitle(b)},p.prototype.showSpinner=function a(){this.containerEl.append(f)},
p.prototype.clearSpinner=function a(){this.containerEl.find(".load-spinner").remove()},p.prototype.getEntitiesToBeSaved=function b(c){var d=this,e,f,g=[],h=0,i=a.Deferred();for(e=0;e<c.length;e++)for(f=0;f<c[e].length;f++){d.entity[e][f].clientid=c[e][f].clientid,h++;var j=d.getEntityStatus(d.entity[e][f],d);j.done(function(a,b){h--,"dirty"!==a&&"new-dirty"!==a||g.push(b),h||i.resolve(g)}).fail(function(){--h||i.resolve(g)})}return i},p.prototype.getEntityStatus=function b(c,d){var e=a.Deferred(),f=d.entityFactory.checkIfEntityDirty(c);return f.fail(function(){d.entityFactory.checkIfEntityNew(c)?e.resolve("new-dirty",c):e.resolve("dirty",c)}),f.done(function(){d.entityFactory.checkIfEntityNew(c)?e.reject("new-clean",c):e.reject("clean",c)}),e},p.prototype.displayError=function a(b){var c,d,e=0,f=0,g=[];for(e=0;e<b.entity.length;e++)for(f=0;f<b.entity[e].length;f++)""!==b.entity[e][f].errorMessage&&g.push({id:b.entity[e][f].id,errorMessage:b.entity[e][f].errorMessage});c=new h(g),
d=new i(c,b.translate("DS_ERROR_REPORT")),c.closeDialog.add(function(){d.closeDialog()}),d.show()};function x(){return k.showUnsavedChanges()}function y(b){var c={};return a.each(b,function(a,b){c[a.toLowerCase()]=b}),c}function z(a){return"string"==typeof a||a instanceof String?"query":"compositeObject"}return p});
define('platform/datasheets/datasheet',['require','jquery','./forms-datasheet-manager','./bulk-datasheet-manager','./master-detail-datasheet-manager','./aggregate-datasheet-manager','system/lang/event','../entity/entity-factory','system/globalization/translator','application/application-events','system/error/error-message'],function(require){"use strict";var a=require("jquery"),b=require("./forms-datasheet-manager"),c=require("./bulk-datasheet-manager"),d=require("./master-detail-datasheet-manager"),e=require("./aggregate-datasheet-manager"),f=require("system/lang/event"),g=require("../entity/entity-factory"),h=require("system/globalization/translator"),i=require("application/application-events"),j=require("system/error/error-message");function k(a){if(a=a||{},a=B(a),this.options=a,this.translator=Object.resolve(h),this.appEvents=Object.resolve(i),a.containerel||this.throwException(this.translate("DS_CONTAINER_UNDEFINED_EXCEPTION")),this.entityObj=a.entityobj,this.catalogItemPath=a.catalogitempath,this.aggregateObject=a.aggregateobject,this.entitySaved=new f,this.entityModified=new f,this.entityDeleted=new f,this.entityCreated=new f,this.entitySelected=new f,this.onMasterDetail=new f,this.beforeEntitiesSave=new f,this.beforeEntitiesDelete=new f,this.entityFactory=new g,
void 0!==this.aggregateObject)this.datasheetManager=new e(a);else switch(this.resolveDatasheetType()){case"forms":this.datasheetManager=new b(a);break;case"bulk":this.datasheetManager=new c(a)}this.window=window,this.switchDatasheetManager=new f,this.onMasterDatasheetLoaded=new f,this.newDatasheet=new f,this.fieldTouched=new f,this.entityIdChanged=new f,this.savingFromUnsavedChangesDialog=!1,this.datasheetSaveDfd=null}k.prototype.load=function b(c){var d=this,e=a.Deferred();return d.attachEventListeners(),d.config=c,d.datasheetManager.load(c).done(function(a){d.entity=a,e.resolve()}).fail(function(){e.reject()}),e},k.prototype.translate=function a(b){return this.translator.translate(b)},k.prototype.throwException=function a(b){var c=new j(1,b,"platform/datasheets/datasheet.js");this.appEvents.errorOccured.raise(this,c)},k.prototype.unload=function a(b){return this.datasheetManager.unload(b)},k.prototype.getState=function a(){return this.datasheetManager.getState()},
k.prototype.removeDOMElements=function a(b){return this.datasheetManager.removeDOMElements(b)},k.prototype.updateState=function a(b){return b&&(this.cachedEntity=b,b.length||!b.master&&null!==b.master||(b=b.master)),this.datasheetManager.updateState(b)},k.prototype.getRefDocState=function a(){return this.datasheetManager.getRefDocState()},k.prototype.updateRefDocState=function a(b){this.datasheetManager.updateRefDocState(b)},k.prototype.getRefDocDatasheet=function a(){return!!(this.datasheetManager.layout&&this.datasheetManager.layout.refdocEl&&this.datasheetManager.layout.refdocEl.datasheet)&&this.datasheetManager.layout.refdocEl.datasheet},k.prototype.getUserFamilyPrivileges=function a(){return this.datasheetManager.getUserFamilyPrivileges()},k.prototype.toggleHelpText=function a(){this.datasheetManager.layout.toggleHelpText()},k.prototype.setTitle=function a(b){this.datasheetManager.setTitle(b)},k.prototype.repaint=function a(){
this.datasheetManager&&this.datasheetManager.repaint&&this.datasheetManager.repaint(this)},k.prototype.getDatasheetType=function a(){var b=this.resolveDatasheetType();return"bulk"===b?b:"forms"===b?this.datasheetManager.layout.isMasterDatasheet()?"master":"forms":void 0},k.prototype.attachEventListeners=function a(){var b=this;b.datasheetManager.beforeEntitiesSaved&&b.datasheetManager.beforeEntitiesSaved.add(n.bind(null,this)),b.datasheetManager.entitySaved.add(p.bind(null,this)),b.datasheetManager.entityModified.add(q.bind(null,this)),b.datasheetManager.entitySelected&&b.datasheetManager.entitySelected.add(t.bind(null,this)),b.datasheetManager.entityCreated.add(r.bind(null,this)),b.datasheetManager.beforeEntitiesDelete&&b.datasheetManager.beforeEntitiesDelete.add(o.bind(null,this)),b.datasheetManager.entityDeleted.add(s.bind(null,this)),b.datasheetManager.onMasterDetail&&b.datasheetManager.onMasterDetail.add(x.bind(null,this)),
b.datasheetManager.onFormsDatasheet&&b.datasheetManager.onFormsDatasheet.add(A.bind(null,this)),b.datasheetManager.onNewMasterDetail&&b.datasheetManager.onNewMasterDetail.add(x.bind(null,this)),b.datasheetManager.newDatasheet&&b.datasheetManager.newDatasheet.add(C.bind(null,b)),b.datasheetManager.fieldTouched&&b.datasheetManager.fieldTouched.add(D.bind(null,b)),b.datasheetManager.entityIdChanged&&b.datasheetManager.entityIdChanged.add(v.bind(null,b)),b.datasheetManager.savingFromUnsavedChangesDialog&&b.datasheetManager.savingFromUnsavedChangesDialog.add(w.bind(null,b))},k.prototype.tabSwitched=function a(){var b=this;if(b.datasheetManager.tabSwitched)return b.datasheetManager.tabSwitched()},k.prototype.resolveDatasheetType=function b(){return a.isArray(this.entityObj)||this.catalogItemPath?"bulk":"forms"},k.prototype.handleDatasheetSave=function b(){var c=this,d=a.Deferred();return c.datasheetManager.onDatasheetSaved().done(l.bind(null,d)).fail(m.bind(null,d)),d};function l(a){
a.resolve()}function m(a){a.reject()}function n(a,b){a.datasheetSaveDfd=b.datasheetSaveDfd,a.beforeEntitiesSave.raise(b)}function o(a,b){a.beforeEntitiesDelete.raise(b)}function p(a,b){a.entitySaved.raise(b)}function q(a,b,c,d){a.entityModified.raise(b,c,d)}function r(a,b){a.entityCreated.raise(b)}function s(a,b){a.entityDeleted.raise(b)}function t(a,b){a.entitySelected.raise(b)}function u(a){a.tabSwitched.raise()}function v(a,b){a.entityIdChanged.raise(b)}function w(a){a.savingFromUnsavedChangesDialog=!0}function x(a,b,c,e,f,g){var h=a.datasheetManager.canUpdateRefDocView,i;h&&(i=a.datasheetManager.refDocs),a.datasheetManager.layout&&(a.datasheetManager.detachEntityEventHandlers(),a.datasheetManager.layout.deallocateMem()),a.datasheetManager=new d(a.options,b,c,e,f,g),a.cachedEntity&&a.datasheetManager.updateState(a.cachedEntity),a.datasheetManager.canUpdateRefDocView=h,a.datasheetManager.refDocs=i,a.datasheetManager.onFormsDatasheet.add(A.bind(null,a)),
a.datasheetManager.onNewMasterDetail.add(x.bind(null,a)),a.datasheetManager.onMasterDetailDatasheetSaved.add(y.bind(null,a)),a.datasheetManager.onMasterDetailDatasheetNew.add(z.bind(null,a)),a.datasheetManager.onMasterDatasheetLoaded.add(function(){a.onMasterDatasheetLoaded.raise()}),a.datasheetManager.load(a.config),a.switchDatasheetManager.raise(),a.datasheetManager.newDatasheet.add(C.bind(null,a)),a.datasheetManager.entityDeleted.add(s.bind(null,a)),a.datasheetManager.entityModified.add(q.bind(null,a)),a.datasheetManager.entityIdChanged&&a.datasheetManager.entityIdChanged.add(v.bind(null,a))}function y(a,b){a.entitySaved.raise(b)}function z(a,b){a.entityCreated.raise(b)}function A(c,d,e,f,g){var h={currentDatasheetKey:d,dto:e,datasheetKeys:f};a.extend(h,c.options),c.datasheetManager.layout&&c.datasheetManager.layout.deallocateMem(),c.datasheetManager=new b(h),c.datasheetManager.onMasterDetail.add(x.bind(null,c)),c.datasheetManager.entitySaved.add(p.bind(null,c)),
c.datasheetManager.changeDatasheet(g,c.config),c.switchDatasheetManager.raise(),c.datasheetManager.newDatasheet.add(C.bind(null,c)),c.datasheetManager.entityDeleted.add(s.bind(null,c)),c.datasheetManager.entityModified.add(q.bind(null,c)),c.datasheetManager.entityIdChanged&&c.datasheetManager.entityIdChanged.add(v.bind(null,c))}function B(b){var c={};return a.each(b,function(a,b){c[a.toLowerCase()]=b}),c}function C(a,b){a.newDatasheet.raise(b)}function D(a,b){a.fieldTouched.raise(b)}return k});

define('text!platform/datasheets/datasheet-dialog/datasheet.html',[],function () { return '<div class="datasheet-dialog-wrapper">\r\n    <div class="panel-content">\r\n        <div class="datasheet-dialog-container"></div>\r\n    </div>\r\n    <div class="panel-footer pull-right">\r\n        <!-- ko if: interceptSave()-->\r\n        <div class="btn btn-text pull-right" data-bind="click: $root.cancelClicked, text: $root.translate(\'DS_CANCEL\')"></div>\r\n        <div class="btn btn-text pull-right" data-bind="click: $root.okClicked, text: $root.translate(\'DS_OK\')"></div>\r\n        <!-- /ko -->\r\n        <!-- ko ifnot: interceptSave()-->\r\n        <div class="btn btn-text close-btn pull-right" data-bind="click: $root.closeDialog, text: $root.translate(\'DS_CLOSE\')"></div>\r\n        <!-- /ko -->\r\n    </div>\r\n</div>';});

define('platform/datasheets/datasheet-dialog/datasheet-view-model',['require','jquery','spa/ko/knockout-view-model','platform/datasheets/datasheet','text!./datasheet.html','system/lang/event','knockout','system/globalization/translator'],function(require){"use strict";var a=require("jquery"),b=require("spa/ko/knockout-view-model"),c=require("platform/datasheets/datasheet"),d=require("text!./datasheet.html"),e=require("system/lang/event"),f=require("knockout"),g=require("system/globalization/translator");function h(b,c,h,j,k,l){i.call(this,d),this.translator=Object.resolve(g),this.key=b,this.familyKey=c,this.isEntity=l,this.config=h,this.interceptSave=k?f.observable(!0):f.observable(!1),this.dfd=a.Deferred(),this.datasheet=null,this.entity=null,this.isDatasheetLoaded=!1,this.datasheetUnload=new e,this.entitySaved=new e}var i=Object.inherit(b,h);h.prototype.attach=function a(b){i.prototype.attach.call(this,b),this.element=b.$element.find(".datasheet-dialog-container"),this.loadDatasheet()},h.prototype.translate=function a(b){return this.translator.translate(b)},h.prototype.loadDatasheet=function b(){var d=this,e={containerEl:a(d.element),entityObj:d.key,familyKey:d.familyKey,isentity:d.isEntity}
;d.datasheet=new c(e),d.datasheet.load(d.config).done(j.bind(null,d))},h.prototype.detach=function a(b){i.prototype.detach.call(this,b)},h.prototype.unload=function a(){this.datasheet=null},h.prototype.closeDialog=function(){var a=this;a.datasheet&&(a.isDatasheetLoaded?a.datasheet.unload().done(function(){a.datasheet&&a.datasheetUnload.raise(a.datasheet.datasheetManager.entityCopy)}):a.datasheetUnload.raise(a.entity))},h.prototype.okClicked=function(){this.datasheetUnload.raise(this.entity)},h.prototype.cancelClicked=function(){this.datasheetUnload.raise("close")};function j(a){a.datasheet.entitySaved.add(k.bind(null,a)),a.isDatasheetLoaded=!0,a.entity=a.datasheet.datasheetManager.entity,a.dfd.resolve(a.entity)}function k(a,b){a.entity=b}return h});
define('platform/datasheets/datasheet-dialog',['require','jquery','platform/datasheets/datasheet-dialog/datasheet-view-model','system/ui/dialog-view-model','system/lang/event'],function(require){"use strict";var a=require("jquery"),b=require("platform/datasheets/datasheet-dialog/datasheet-view-model"),c=require("system/ui/dialog-view-model"),d=require("system/lang/event");function e(a,c,e,f){this.key=a.entityObj,this.familyKey=a.familykey,this.isEntity=a.isentity,this.config=c,this.title=e?e:"",this.interceptSave=f,this.region=null,this.dfd=null,this.datasheet=null,this.datasheetViewModel=Object.resolve(b,this.key,this.familyKey,this.config,this.title,f,this.isEntity),this.entity=null,this.ok=new d}e.prototype.show=function b(d){return d=a.extend({width:"70%",height:"90%",closeIcon:!0},d||{}),this.dialog=new c(this.datasheetViewModel,this.title,d),this.dialog.closeDialog=f.bind(null,this),this.dfd=a.Deferred(),this.dialog.show(),this.dialog.centerDialog(),i(this),this.datasheetViewModel.dfd.done(g.bind(null,this)),this.dfd},e.prototype.close=function a(){this.dialog.closeDialog()};function f(a){a.datasheetViewModel.closeDialog()}function g(a,b){h(a,b),
l(a)}function h(a,b){a.entity=b}function i(a){a.datasheetViewModel.datasheetUnload.add(k.bind(null,a))}function j(a){a.datasheetViewModel.datasheetUnload.remove()}function k(a,b){a.interceptSave?"close"===b?c.prototype.closeDialog.call(a.dialog):(b&&b.fields&&b.fields.models&&(b.fields=b.fields.toJSON()),a.ok.raise(b),c.prototype.closeDialog.call(a.dialog)):(b&&b.fields&&b.fields.models&&(b.fields=b.fields.toJSON()),a.dfd.resolve(b),c.prototype.closeDialog.call(a.dialog))}function l(a){a.dialog.centerDialog()}return e});
define('platform/static-module/load-datasheet-dialog-model',['require','platform/datasheets/datasheet-dialog'],function(require){"use strict";var a=require("platform/datasheets/datasheet-dialog");function b(b){var c={entityObj:b},d={functionsAvailable:["save","delete","references","history"],readOnly:!0,canedit:!0,showDatasheetSelection:!0};this.dialog=new a(c,null,"Datasheet",!0),this.dialog.show().done(function(a){}),this.dialog.ok.add(function(a){})}return b});
define('ui/screen-size',["require","exports","system/lang/ioc","system/hardware/device","mi-assert"],function(require,exports,a,b){"use strict";var c=require("mi-assert"),d=1,e=767,f=1e3,g=1920,h=function(){function c(){this.device=a.resolve(b)}return c.prototype.isTooSmallForAllPages=function(){return i(this)<e},c.prototype.isTooSmallForSomePages=function(){return l(this)?n(this):o(this)},c.prototype.toString=function(){return"ScreenSize "+JSON.stringify({pixelRatio:m(this),deviceInnerWidth:j(this)})},c}();function i(a){return k(a).innerWidth()}function j(a){return k(a).deviceInnerWidth()}function k(a){return p(a),a.device}function l(a){return m(a)<=d}function m(a){return k(a).pixelRatio()}function n(a){return i(a)<f}function o(a){return j(a)<g}function p(a){c.instanceOf(a,h,"self"),c.instanceOf(a.device,b,"self.device")}return h});
define('spa/react/react-view-model',["require","exports","react","react-dom","system/lang/object","system/lang/private"],function(require,exports,a,b,c,d){"use strict";var e=function(a){return function(b){a[b]=a[b].bind(a)}},f=function(a){return function(b){var c=a[b];a[b]=function(){c.apply(a,arguments),a.updateView()}}};return function(){function g(a){d(this).view=a,d(this).mountNode=null,d(this).afterViewUpdate=null}return g.prototype.bindMethods=function(a){a.forEach(e(this))},g.prototype.updateViewAfter=function(a){a.forEach(f(this))},g.prototype.attach=function(a){c.tryMethod(this,"beforeAttach",a),a.attach(document.createElement("div")),d(this).mountNode=a.activeContainer,d(this).afterViewUpdate=this.afterViewUpdate.bind(this),this.updateView(),c.tryMethod(this,"afterAttach",a)},g.prototype.updateView=function(){var c=d(this).mountNode;if(c){var e=a.createElement(d(this).view,{vm:this}),f=d(this).afterViewUpdate;b.render(e,c,f)}},g.prototype.afterViewUpdate=function(){},g.prototype.detach=function(a){
c.tryMethod(this,"beforeDetach",a),b.unmountComponentAtNode(d(this).mountNode),d(this).afterViewUpdate=null,d(this).mountNode=null,c.tryMethod(this,"afterDetach",a)},g}()});
define('spa/route-overflow/views/components/route-list-item',["require","exports","react"],function(require,exports,a){"use strict";var b=a.createElement;exports.RouteListItem=function(a){var c=a.tabIndex,d=a.route,e=a.className,f=a.icon,g=a.handleClick,h=a.routeTitle,i=a.hoverText;return b("li",{className:e,onClick:g?g.bind(null,{route:d,tabIndex:c}):null,title:i},b("i",{className:f}),b("span",{},h))}});
define('spa/route-overflow/views/route-overflow-view',["require","exports","react","ramda","application/application-context","spa/route-overflow/views/components/route-list-item"],function(require,exports,a,b,c,d){"use strict";var e=a.createElement,f=2,g=function(a){__extends(g,a);function g(b){var d=a.call(this,b)||this;return d.props=b,d.state={tabsToRemove:[]},d.tabs=c.navigation.tabsInfo,d.toggleRemoval=d.toggleRemoval.bind(d),d}return g.prototype.componentWillUpdate=function(a,b){var c=b.tabsToRemove;this.props.vm.toggleCloseEnable(c),this.props.vm.routesToClose=c},g.prototype.getClassName=function(a){var c=a.isActiveTab,d=a.tabIndex,e=a.route,f=[b.contains({route:e,tabIndex:d},this.state.tabsToRemove)?"inactive":"active",c?"activeTab":""];return b.join(" ",f).trim()},g.prototype.hoverText=function(a){return a.title},g.prototype.toggleRemoval=function(a){b.contains(a,this.state.tabsToRemove)?this.setState(function(c){var d=c.tabsToRemove;return{tabsToRemove:b.filter(function(b){return b.tabIndex!==a.tabIndex},d)}
}):this.setState(function(b){return{tabsToRemove:b.tabsToRemove.concat(a)}})},g.prototype.tabList=function(a){var b=this;return e("ul",{},a.slice(f).map(function(a){return e(d.RouteListItem,{tabIndex:a.tabIndex,route:a.route,icon:a.icon,routeTitle:a.title,handleClick:b.toggleRemoval,className:b.getClassName(a),hoverText:b.hoverText(a),key:a.tabIndex})}))},g.prototype.render=function(){return e("div",{className:"route-overflow-dialog"},this.tabList(this.tabs))},g}(a.Component);exports.RouteOverflowView=g});
define('spa/route-overflow/view-models/route-overflow-view-model',["require","exports","spa/react/react-view-model","spa/route-overflow/views/route-overflow-view","bluebird"],function(require,exports,a,b,c){"use strict";return function(a){__extends(d,a);function d(c){var d=a.call(this,b.RouteOverflowView)||this;return d.routes=c,d.routesToClose=[],d.updateViewAfter(["attach"]),d}return d.prototype.afterAttach=function(a){var b=this;setTimeout(function(){b.toggleCloseEnable(b.routesToClose)},0)},d.prototype.closeTabs=function(){return c.resolve(this.routesToClose)},d.prototype.toggleCloseEnable=function(a){var b=document.querySelector(".dialog-wrapper .btn-primary");a.length>0&&b?b.classList.remove("disabled"):b&&(b.className+=" disabled")},d}(a)});
define('spa/route-overflow/route-overflow-dialog-manager',["require","exports","spa/route-overflow/view-models/route-overflow-view-model","system/lang/object","application/application-events","system/globalization/translator","system/ui/dialog-box"],function(require,exports,a,b,c,d){"use strict";var e=require("system/ui/dialog-box");return function(){function f(a,b){this.routes=a,this.requestedRoute=b}return f.prototype.show=function(c){var f=this,g=b.resolve(d),h=new a(this.routes),i={buttons:[{name:g.translate("CLOSE_TABS"),value:"closeTabs",cssClass:"btn-primary"},{name:g.translate("CANCEL"),value:"cancel",cssClass:"btn-default"}]};new e(h,c,i).show().done(function(a,b,c){"closeTabs"===b&&c.done(f.raiseBulkClose.bind(null,f.requestedRoute))})},f.prototype.raiseBulkClose=function(a,d){b.resolve(c).bulkClose.raise(d,a)},f}()});
define('spa/multi-route-strategy',['require','ramda','application/application-context','platform/static-module/load-datasheet-dialog-model','ui/screen-size','system/globalization/translator','spa/route-overflow/route-overflow-dialog-manager','system/lang/url-codec'],function(require){"use strict";var a=require("ramda"),b=require("application/application-context"),c=require("platform/static-module/load-datasheet-dialog-model"),d=require("ui/screen-size"),e=require("system/globalization/translator"),f=require("spa/route-overflow/route-overflow-dialog-manager"),g=require("system/lang/url-codec"),h="?",i=";rte=",j=";act=",k=";?=",l=/(;rte=)|(;act=)/gim;function m(a,b,c){this.maxRoutes=a,this.staticRoutes=b,this.removeQueryString=c,this.screenSize=Object.resolve(d),this.translator=Object.resolve(e),this.previousActiveRoute=0}m.prototype.parse=function(a){return q(a)?o(this,a):n(this,a)};function n(a,b){return p(a,b,b.split(h),b,null)}function o(a,b){var c=b.split(k);return p(a,b,c,c.length>=0?c[0]:null,w(c))}function p(b,c,d,e,f){var g=e.split(j),h=e.split(l);return y(h),z(h,g),b.getDatasheetDialog(t(d)),s(b,h),r(h),{routes:a.map(decodeURIComponent,u(h)),active:v(h),query:f,actionRoutes:x(g)}}function q(a){return a.indexOf(";?=")>-1}
function r(a){b.navigation.activeRoute=u(a)[v(a)]}function s(a,b){a.previousActiveRoute=v(b,u(b))}function t(a){var b=a.length>0?a[1]:null;return b?g.decode(b):null}function u(a){var b;return b=1===a.length?[a[0]]:a.slice(1)}function v(a){var b=0;return 1!==a.length&&(b=parseInt(a[0],10),isNaN(b)&&(b=0),b=Math.min(b,u(a).length-1)),b}function w(a){var b=t(a);return b&&(b.__isQueryString__=!0),b}function x(a){var b;return a.length>1&&(b=a.slice(1)),b}function y(a){A(a,i),A(a,j),A(a,void 0)}function z(a,b){if(b.length>1)for(var c=b.slice(1),d=0;d<c.length;d++)A(a,c[d])}function A(a,b){for(var c=a.length-1;c>=0;c--)a[c]===b&&a.splice(c,1)}m.prototype.getDatasheetDialog=function(a){for(var b in a)a.hasOwnProperty(b)&&"datasheet-dialog"===b&&(this.datasheetDialog=new c(a[b]))},m.prototype.getHash=function(a,b,c,d){var e;return a=G(a),0===a.length?"#":(b=H(a,b),e=I(this,a,b,c),E(this)||(a=F(e.routes)),b=e.activeRoute,c=B(c,d),this.previousActiveRoute=b,"#"+b+i+a.join(i)+c)};function B(a,b){
return a=b?C(a,b):D(a,b)}function C(a,b){return a=a&&!b.persistQueryString?";?="+a:""}function D(a,b){return a=a?";?="+a:""}function E(a){return a.screenSize.isTooSmallForAllPages()}function F(a){return a.length>1&&(a[0]="home"),a}function G(a){return a=a||[],a instanceof Array?a:[a]}function H(a,b){return b=parseInt(b,10)||0,b=Math.min(b,a.length-1)}function I(a,b,c,d){var e,g,h;return c>a.maxRoutes+a.staticRoutes-1&&(c=a.previousActiveRoute,e=a.translator.translate("TAB_LIMIT_EXCEEDED_DIALOG_TITLE"),g=b[b.length-1],b.pop(),g=d?g+"?"+d:g,h=new f(b,g),h.show(e)),{routes:b,activeRoute:c}}return m});
define('spa/i-router',['require','exports','module','system/lang/interface'],function(require,exports,module){"use strict";return new(require("system/lang/interface"))(module.id,["activate","resolve","deactivate"],["routerConfig","matchedRoute"])});
define('spa/action-routes/action-route-close',['require','exports','module','jquery','system/globalization/translator'],function(require,exports,module){"use strict";var a=require("jquery"),b=require("system/globalization/translator");function c(a){this.busyIndicator=a,this.closeButton=null,this.translator=Object.resolve(b),this.boundClickHandler=f.bind(null,this)}c.prototype.handleBusyIndicatorClose=function(){setTimeout(d.bind(null,this),1e4)};function d(b){if(g()&&0===a("button.action-route-indicator-close").length){e(b.translator.translate("CLOSE_LOADING_INDICATOR")),b.closeButton=document.querySelector("button.action-route-indicator-close"),b.closeButton.addEventListener("click",b.boundClickHandler)}}function e(b){a("#shell").prepend('<button class="btn action-route-indicator-close">'+b+"</button>")}function f(b){b.busyIndicator.hide(),b.closeButton.removeEventListener("click",b.boundClickHandler),a(b.closeButton).remove()}function g(){return"block"===document.querySelector("#shell").querySelector(".busy-indicator-wrap").style.display}return c});
define('spa/action-routes/action-route-url-remover',['require','exports','module'],function(require,exports,module){"use strict";function a(){}a.remove=function(a,d){var f=d.arguments.url,g=c(a,f);g=e(g,d),b(g)};function b(a){window.location.href=window.location.href.replace(a,"")}function c(a,b){var c=";act=",e;return b?(e=c+a+b,e=d(e)):e=c+a,e}function d(a){return a.replace("*","")}function e(a,b){var c=b.arguments.named;for(var d in c)a.indexOf(d)>-1&&(a=a.replace("@"+d,c[d]));return a}return a});
define('spa/action-routes/action-route-opener',['require','exports','module','jquery','spa/action-routes/action-route-close','system/ui/busy-indicator','spa/action-routes/action-route-url-remover','application/application-events'],function(require,exports,module){"use strict";var a=require("jquery"),b=require("spa/action-routes/action-route-close"),c=require("system/ui/busy-indicator"),d=require("spa/action-routes/action-route-url-remover"),e=require("application/application-events");function f(){}f.prototype.open=function(a,b){g(a,b)};function g(a,e){var f=new c("loading-extra-large"),g=new b(f),i=e.arguments.positional,k=e.arguments.named,l={};l.query=i,l.routeArgs=k,l.routeInfo=e,f.attachTo(document.querySelector("#shell")),f.show(),g.handleBusyIndicatorClose(),e.screen.execute(l).done(h.bind(null,f)).fail(j.bind(null,f)),d.remove(a.config.url,e)}function h(a,b){b&&b.route&&i(b.route),a.hide()}function i(a){var b=Object.resolve(e),c={tab:!0};b.navigate.raise(a,c)}function j(a){a.hide()}return f});
define('spa/route-parser',['require','exports','module','jquery','system/lang/event','system/diagnostics/log-manager','system/lang/url-codec'],function(require,exports,module){"use strict";var a=require("jquery"),b=require("system/lang/event"),c=require("system/diagnostics/log-manager"),d=c.getLogger(module.id),e=require("system/lang/url-codec"),f=/\*|@\w*/g,g=/^$/,h=/@\w+/g,i=/@/g,j=/\/\*/g,k=/^\/|\/$/g,l="([^/]*)",m="?(.*)",n="/?(.*)";function o(){this.routes=[],this.routeMatched=new b,this.badRoute=new b}o.prototype.dispatch=function(a,b){d.isTraceEnabled()&&d.trace("dispatch url ",a);var c=a.split("?"),e=this.match(c[0]);if(void 0===e)return d.warn("unmatched url ",a),void this.badRoute.raise({url:a});var f=this.parse(a,e,b);this.routeMatched.raise({module:e.module,arguments:f,config:p(e)})};function p(b){var c=a.extend({},b);return c.matches&&delete c.matches,c.regExp&&delete c.regExp,c}o.prototype.load=function(a){this.routes=a,d.isTraceEnabled()&&d.trace("configure Routes"),this.routes.forEach(o.configureRoute)},o.configureRoute=function(a){var b,c,e=f;if(a.matches=[],""===(a.url||""))return a.regExp=g,a
;for(b="^"+a.url.replace(h,l).replace(i,m).replace(j,n)+"$",a.regExp=new RegExp(b,"i"),d.isTraceEnabled()&&d.trace("url: ",a.url," regex: ",b),c=e.exec(a.url);null!==c;)a.matches.push(c[0]),c=e.exec(a.url);return a},o.prototype.match=function(a){a=a.replace(k,"");for(var b=0;b<this.routes.length;b++)if(this.routes[b].regExp.lastIndex=0,this.routes[b].regExp.test(a))return d.isTraceEnabled()&&d.trace("route match ",a," matched ",this.routes[b]),this.routes[b]},o.prototype.parse=function(a,b,c){var e={named:null,positional:[],url:"",icon:""},f=a.split("?"),g,h;if(a=f[0],c=q(c,f),d.isTraceEnabled()&&d.trace("parse values"),a=a.replace(k,""),b.regExp.lastIndex=0,null!==(g=b.regExp.exec(a)))for(h=1;h<g.length;h++)s(e,g[h],b.matches[h-1]);return c&&e.positional.push(c),e.icon=b.icon,d.isTraceEnabled()&&d.trace("parsed values: ",e),e};function q(a,b){return a||(a=r(b)),a}function r(a){var b=a.length>0?a[1]:null,c=b?e.decode(b):null;return c&&a.length>0&&(c.__isQueryString__=!0),c}
function s(a,b,c){if(d.isTraceEnabled()&&d.trace(b,c),void 0!==c&&void 0!==b){if("*"===c)return void(a.url=b);if("@"===c){var e=b.split("/");return""===e[e.length-1]&&e.pop(),void Array.prototype.push.apply(a.positional,e)}null===a.named&&(a.named={}),a.named[c.substring(1)]=b}}return o});
define('spa/router',['require','jquery','mi-assert','./i-router','system/lang/event','spa/action-routes/action-route-opener','spa/route-parser'],function(require){"use strict";var a=require("jquery"),b=require("mi-assert"),c=require("./i-router"),d=require("system/lang/event"),e=require("spa/action-routes/action-route-opener"),f=require("spa/route-parser"),g="status-pages/url-not-supported/url-not-supported-view-model";function h(a){this.routerConfig=a||{},this.routeParser=new f,this.matchedRoute=new d,this.loadModuleDeferred=null,this.matchedRouteQueue=[],b.implementsInterface(this,c)}h.prototype.activate=function(){this.routeParser.load(this.routerConfig),this.routeParser.routeMatched.add(this.routeMatchedHandler,this),this.routeParser.badRoute.add(this.badRouteHandler,this)},h.prototype.resolve=function(a,b){b?this.routeParser.dispatch(a,b):this.routeParser.dispatch(a)},h.prototype.deactivate=function(){this.routeParser.routeMatched.remove(),this.routeParser.badRoute.remove()},h.prototype.routeMatchedHandler=function(a){i(this,a),k(this)};function i(a,b){a.matchedRouteQueue[a.matchedRouteQueue.length]=b}function j(a){
var b;return a.matchedRouteQueue.length>0&&(b=a.matchedRouteQueue[a.matchedRouteQueue.length-1]),a.matchedRouteQueue=[],b}function k(a){var b;a.loadModuleDeferred||(b=j(a))&&a.loadModule(b.module).done(a.raiseMatchedRoute.bind(a,b))}h.prototype.raiseMatchedRoute=function(a,module){var b={};if(b.arguments=a.arguments,b.screen=this.createScreenInstance(a,module),b.conn=this.createConnectionInstance(a,module),this.matchedRoute.raise(b),this.loadModuleDeferred=null,a.config&&a.config.isActionRoute){(new e).open(a,b)}k(this)},h.prototype.createScreenInstance=function(a,module){return a&&a.config&&a.config.member&&(module=module[a.config.member]),Object.resolve(module)},h.prototype.createConnectionInstance=function(a,module){return a&&a.config&&a.config.member&&(module=module[a.config.member]),Object.resolve(module)},h.prototype.badRouteHandler=function(){this.routeMatchedHandler(l())};function l(){return{arguments:{named:null,positional:[],url:"",icon:""},module:g}}
h.prototype.loadModule=function(module){return this.loadModuleDeferred=a.Deferred(),require([module],m.bind(null,this),n.bind(null,this)),this.loadModuleDeferred.promise()};function m(a,module){a.loadModuleDeferred.resolve(module)}function n(a,b){console.error(b),require([g],m.bind(null,a))}return h});
define('spa/hd-router-proxy',['require','exports','module','mi-assert','system/diagnostics/log-manager','./i-router','./router','ui/screen-size'],function(require,exports,module){"use strict";var a=require("mi-assert"),b=require("system/diagnostics/log-manager"),c=b.getLogger(module.id),d=require("./i-router"),e=require("./router"),f=require("ui/screen-size"),g="status-pages/invalid-screen-size/invalid-screen-size-view-model";function h(b){i.call(this,b),this.__private__={screenSize:Object.resolve(f)},a.implementsInterface(this,d,"this"),v(this)}var i=Object.inherit(e,h);h.prototype.routeMatchedHandler=function(a){v(this),w(a),a=j(this,a),i.prototype.routeMatchedHandler.call(this,a)};function j(a,b){return k(a),m(a)?b=n(b):p(a)&&(b=q(b)),b}function k(a){c.trace(l(a).toString())}function l(a){return v(a),a.__private__.screenSize}function m(a){return l(a).isTooSmallForAllPages()}function n(a){return s(a)?a:(c.info("screen is too small for any page, setting module to ",g),o(a))}function o(a){return w(a),c.info("screen is too small for",a.config.url,"setting module to ",g),a.module=g,w(a),a}function p(a){
return l(a).isTooSmallForSomePages()}function q(a){return r(a)?a:o(a)}function r(a){return w(a),!!a.config["allow-small-screen"]}function s(a){return w(a),!!a.config["allow-tiny-screen"]}h.prototype.createScreenInstance=function(a,module){var b=i.prototype.createScreenInstance.call(this,a,module);return t(a)&&(b.isSmallScreenAllowed=r(a),b.usingInvalidScreenSizeRoute=u(a)),b};function t(a){return a.module===g}function u(a){return a.module===a.config.module}function v(b){a.enabled&&(a.instanceOf(b,h,"self"),a.instanceOf(b.__private__.screenSize,f,"self.__private__.screenSize"))}function w(b){a.enabled&&(a.ok(b,"event"),a.stringNotEmpty(b.module,"event.module"))}return h});
define('spa/offline-access',['require','exports','module','jquery','mi-assert','system/diagnostics/log-manager','./i-router','./router','spa/hd-router-proxy','application/application-context'],function(require,exports,module){"use strict";var a=require("jquery"),b=require("mi-assert"),c=require("system/diagnostics/log-manager"),d=c.getLogger(module.id),e=require("./i-router"),f=require("./router"),g=require("spa/hd-router-proxy"),h=require("application/application-context"),i="status-pages/not-available-offline/feature-not-available-view-model";function j(a){k.call(this,a),b.implementsInterface(this,e,"this"),t(this)}var k=Object.inherit(g,j);j.prototype.routeMatchedHandler=function(a){t(this),u(a),a=l(this,a),k.prototype.routeMatchedHandler.call(this,a)};function l(a,b){return m(a),n(a)?b=p(b):b}function m(a){d.trace(n(a).toString())}function n(a){return t(a),!h.connectionStatus.connected}function o(a){return u(a),d.info("Page ",a.config.url," is not available offline; setting module to ",i),a.module=i,u(a),a}function p(a){return q(a)?a:o(a)}function q(a){return u(a),!!a.config["available-offline"]}j.prototype.createScreenInstance=function(a,module){
return k.prototype.createScreenInstance.call(this,a,module)},j.prototype.createConnectionInstance=function(a,module){var b=k.prototype.createConnectionInstance.call(this,a,module);return r(a)&&(b.isAvailableOffline=q(a),b.usingPageOfflineRoute=s(a)),b};function r(a){return a.module===i}function s(a){return a.module===a.config.module}function t(a){b.enabled&&b.instanceOf(a,j,"self")}function u(a){b.enabled&&(b.ok(a,"event"),b.stringNotEmpty(a.module,"event.module"))}return j});
define('spa/mobile-router',['require','exports','module','mi-assert','system/diagnostics/log-manager','./i-router','spa/hd-router-proxy','application/application-context'],function(require,exports,module){"use strict";var a=require("mi-assert"),b=require("system/diagnostics/log-manager"),c=b.getLogger(module.id),d=require("./i-router"),e=require("spa/hd-router-proxy"),f=require("application/application-context"),g="status-pages/not-available-mobile/feature-not-available-view-model",h="status-pages/not-available-offline/feature-not-available-view-model";function i(b){j.call(this,b),a.implementsInterface(this,d,"this"),t(this)}var j=Object.inherit(e,i);i.prototype.routeMatchedHandler=function(a){t(this),u(a),a=k(this,a),j.prototype.routeMatchedHandler.call(this,a)};function k(a,b){return l(a),n(a,b)}function l(a){c.trace(m(a).toString())}function m(a){return t(a),!f.connectionStatus.connected}function n(a,b){return r(b)?o(a,b):p(b)}function o(a,b){return m(a)?s(b)?b:q(b):b}function p(a){return u(a),c.info("Page ",a.config.url," is not available in the mobile app; setting module to ",g),a.module=g,u(a),a}function q(a){return u(a),
c.info("Page ",a.config.url," is not available offline; setting module to ",h),a.module=h,u(a),a}function r(a){return u(a),!!a.config["available-on-mobile"]}function s(a){return u(a),!!a.config["available-offline"]}function t(b){a.enabled&&a.instanceOf(b,i,"self")}function u(b){a.enabled&&(a.ok(b,"event"),a.stringNotEmpty(b.module,"event.module"))}return i});
define('config/dependency',['require','spa/url-manager','spa/multi-route-strategy','spa/router','spa/offline-access','spa/hd-router-proxy','application/application-context','spa/mobile-router','system/hardware/device'],function(require){"use strict";var a=require("spa/url-manager"),b=require("spa/multi-route-strategy"),c=require("spa/router"),d=require("spa/offline-access"),e=require("spa/hd-router-proxy"),f=require("application/application-context"),g=require("spa/mobile-router"),h=require("system/hardware/device");a.singleton=!0,a.factory=function(){var c=8,d=2,e=!0,f=new b(c,d,e);return new a(window,f)},c.factory=function(){return f.isAppHub?Object.resolve(e):i()?Object.resolve(g):Object.resolve(d)};function i(){return Object.resolve(h).isMobileApp()}});
