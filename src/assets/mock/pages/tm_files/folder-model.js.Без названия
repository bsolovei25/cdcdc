/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("application/application-context"),d=require("catalog/services/catalog-constants");function e(h){this.constants=new d,this.user=c.user;var k=[];h=h||{},this.key=b.observable(h.key),this.id=b.observable(h.id),this.description=b.observable(h.description),this.caption=b.observable(h.caption),this.folderType=b.observable(h.folderType),this.hasChildren=b.observable(h.hasChildren),this.parentKey=b.observable(h.parentKey),this.ownerKey=b.observable(h.ownerKey),this.ownerId=b.observable(h.ownerId),this.path=b.observable(h.path),this.privilege=h.privilege,this.spread=h.spread,this.updateDate=b.observable(h.updateDate),this.updateUser=b.observable(h.updateUser),this.lockSeq=b.observable(h.lockSeq),h.children&&h.children.length>0&&(k=a.map(h.children,function(a){return new e(a)})),this.children=b.observableArray(k),this.canCreate=b.observable(!1),this.canCreateSpread=b.observable(!1),
this.canView=b.observable(!1),this.canViewSpread=b.observable(!1),this.canEditAll=b.observable(!1),this.canEditOwn=b.observable(!1),this.canEditSpread=b.observable(!1),this.canDeleteAll=b.observable(!1),this.canDeleteOwn=b.observable(!1),this.canDeleteSpread=b.observable(!1),this.setPrivilege(this,h.privilege),this.isNew=b.computed(f.bind(null,this)),this.isProtectedFolder=b.computed(g.bind(null,this)),this.parent=b.observable(),this.hierarchyLevel=b.computed(i.bind(null,this)),this.pathArray=b.computed(j.bind(null,this))}function f(a){return a.key()&&"0"===a.key().toString()}function g(a){var b=a.constants,c=a.key(),d=a.folderType(),e=a.parentKey();if(c&&"0"!==c)return c=c.toString(),e=e?e.toString():null,d===b.FOLDER_TYPE_BASELINE||(c===b.KEY_PUBLIC_FOLDER.toString()||c===b.KEY_PERSONAL_FOLDER.toString()||(e===b.KEY_PERSONAL_FOLDER.toString()||!h(a)&&!a.canEditAll()))}function h(a){if(a.user.isSuperUser)return!0;if(void 0===a.user.groups||null===a.user.groups)return!1
;for(var b=0;b<a.user.groups.length;b++)if(a.user.groups[b].id===a.constants.GRP_CATALOG_ADMIN||a.user.groups[b].id===a.constants.GRP_POWER_USER)return!0;return!1}function i(a){return a.parent()?a.parent().hierarchyLevel()+1:1}function j(a){var b=[];return a.parent()&&(b=a.parent().pathArray().slice()),b.push(a),b}return e.prototype.setPrivilege=function a(){this.canCreate(this.privilege===(this.privilege|this.constants.FOLDER_PRIV_CREATE)),this.canView(this.privilege===(this.privilege|this.constants.FOLDER_PRIV_VIEW)),this.canEditAll(this.privilege===(this.privilege|this.constants.FOLDER_PRIV_EDIT_ALL)),this.canEditOwn(this.privilege===(this.privilege|this.constants.FOLDER_PRIV_EDIT_OWN)),this.canDeleteAll(this.privilege===(this.privilege|this.constants.FOLDER_PRIV_DELETE_ALL)),this.canDeleteOwn(this.privilege===(this.privilege|this.constants.FOLDER_PRIV_DELETE_OWN)),this.canCreateSpread(this.spread===(this.spread|this.constants.FOLDER_PRIV_CREATE)),
this.canViewSpread(this.spread===(this.spread|this.constants.FOLDER_PRIV_VIEW)),this.canEditSpread(this.spread===(this.spread|this.constants.FOLDER_PRIV_EDIT_ALL||this.spread|this.constants.FOLDER_PRIV_EDIT_OWN&&this.ownerKey===this.user)),this.canDeleteSpread(this.spread===(this.spread|this.constants.FOLDER_PRIV_DELETE_ALL||this.spread|this.constants.FOLDER_PRIV_DELETE_OWN&&this.ownerKey===this.user))},e.prototype.extractPrivilege=function a(b){var c=0;this.canCreate&&(c+=1),this.canView&&(c+=2),this.canEditOwn&&(c+=4),this.canEditAll&&(c+=8),this.canDeleteOwn&&(c+=16),this.canDeleteAll&&(c+=32),b.privilege=c;var d=0;this.canCreateSpread&&(d+=1),this.canViewSpread&&(d+=2),this.canEditOwn&&this.canEditSpread&&(d+=4),this.canEditAll&&this.canEditSpread&&(d+=8),this.canDeleteOwn&&this.canDeleteSpread&&(d+=16),this.canDeleteAll&&this.canDeleteSpread&&(d+=32),b.spread=d},e});