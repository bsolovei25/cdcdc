/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define('spa/knockout/knockout-view-model',["require","exports","knockout"],function(require,exports,a){"use strict";return function(){function b(a){this.view=a,this.subscriptions=[],this.preserveContext=!1}return b.prototype.attach=function(b){b.attach($(this.view));var c=b.element;if(a.contextFor(c)&&this.preserveContext){var d=a.contextFor(c).createChildContext(this);a.applyBindingsToDescendants(d,c)}else a.applyBindingsToDescendants(this,c)},b.prototype.detach=function(b){a.cleanNode(b.element),b.clear()},b}()});
define('system/lang/ioc',["require","exports"],function(require,exports){"use strict";function a(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return function(b){b.dependsOn=a}}exports.dependsOn=a;function b(a){a.singleton=!0}exports.singleton=b;function c(a){return function(b){b.factory=a}}exports.factory=c;function d(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return Object.resolve.apply(Object,[a].concat(b))}exports.resolve=d});
define('system/lang/object',["require","exports","lodash","jquery","bluebird"],function(require,exports,a,b,c){"use strict";function d(a,b){return __extends(b,a),a}function e(a){return new(Function.prototype.bind.apply(a,arguments))}function f(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];if(g(b))return h(b);var k;if(i(b))k=j(b);else{var o=l(b),p=a.map(o,function(a){return f(a)});p.unshift(b),p=p.concat(c),k=e.apply(null,p)}return m(b)&&n(b,k),k}function g(a){return a.singleton&&a.instance}function h(a){return a.instance}function i(b){return b.factory&&a.isFunction(b.factory)}function j(a){return k(a)()}function k(a){return a.factory}function l(a){return a.dependsOn||[]}function m(a){return!!a.singleton}function n(a,b){a.instance=b}function o(b,c){var d=[],e=0;for(c=c||0,e=0;e<c;e++)d.push({});return a.each(b,function(a,b){var c={id:e,name:b,text:a,toString:function(){return a}};d[b]=c,d.push(c),e++}),d.parse=function(c){if(isNaN(c)){var e=void 0;return a.each(d,function(a){c===a&&(e=c)}),
e||a.each(b,function(a,b){c!==a&&c!==b||(e=d[b])}),e}return d[c]},d.getDisplayText=function(a){var b=d.parse(a);return b?b.text:""},Object.freeze&&Object.freeze(d),d}function p(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];var e=Array.prototype.slice.call(arguments,2);if(r(a,b))return a[b].apply(a,e)}function q(a,b){b(a),p(a,"dispose")}function r(b,c,d){void 0===d&&(d=!1),a.isArray(c)||(c=[c]);for(var e=0;e<c.length;e++)if(!a.isFunction(b[c[e]])){if(d)throw"Required method "+c[e]+" is not defined";return!1}return!0}function s(b,c){var d=b[c];if(d&&a.isFunction(d))return d.bind(b)}function t(a,b,c){return!!a[b]&&(a[b]=c,!0)}function u(a,b){var c;return a[b]&&(c=a[b],delete a[b]),c}function v(a,b){return null===a?b:void 0===a?b:a}function w(a){var b=function(){return arguments.length&&(a=arguments[0]),a};return b.prop=function(){return a},b}var x=function(){function a(a){void 0===a&&(a=""),this.message=a,this.name="AbstractClassError"}return a}(),y=function(){
function a(a){void 0===a&&(a=""),this.message=a,this.name="AbstractMethodError"}return a}();function z(a,b){if(a.constructor===b)throw new x("Cannot create an instance of abstract class "+(b.name||""))}function A(a){throw new y("Cannot execute abstract method "+a+", must be overridden")}function B(a){return new c(C.bind(null,a))}function C(a,b,c){require(a,E.bind(null,b),D.bind(null,c))}function D(a,b){throw a(b),new Error(b)}function E(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];a(b)}var F={construct:e,resolve:f,inherit:d,createEnum:o,use:q,tryMethod:p,respondsTo:r,method:s,trySet:t,removeProperty:u,defaultValue:v,prop:w,AbstractClassError:x,AbstractMethodError:y,abstractClass:z,abstractMethod:A,require:B};return b.extend(Object,F),F});
define('system/text/parser',["require","exports","ramda","globalize"],function(require,exports,a){"use strict";var b=require("globalize"),c=function(){function c(){}return c.prototype.parseInt=function(a,c,d){return void 0===a||null===a?a:"string"!=typeof a&&"number"!=typeof a?NaN:b.parseInt(a,c,d)},c.prototype.parseFloat=function(a,c,d){return void 0===a||null===a||"number"==typeof a?a:"string"!=typeof a?NaN:b.parseFloat(a,c,d)},c.prototype.parseDate=function(c,e,f){if(!e){var g=a.clone(b.findClosestCulture().calendar.patterns);return g.dt=d("d","t"),g.dT=d("d","T"),g.Dt=d("D","t"),g.DT=d("D","T"),g.Mt=d("M","t"),g.MT=d("M","T"),g.Yt=d("Y","t"),g.YT=d("Y","T"),b.parseDate(c,a.values(g),f)}return b.parseDate(c,e,f)},c}();function d(a,b){return e(a)+" "+e(b)}function e(a){return b.findClosestCulture().calendar.patterns[a]}return new c});
define('system/text/formatter',["require","exports","lodash","jquery","system/lang/ioc","system/text/parser"],function(require,exports,a,b,c,d){"use strict";var e=require("globalize");Date.Formats={Unformatted:"yyyy-MM-dd HH:mm:ss",Sortable:"S",LongDate_ShortTime:"f",LongDate_LongTime:"F",ShortTime:"t",LongTime:"T",ShortDate:"d",LongDate:"D",Month_Year:"Y",Month_Day:"M"};var f=function(a){return function(b){return a+(b||"")}};Number.Formats={Number:f("n"),Decimal:f("d"),Percent:f("p"),Currency:f("c")},Number.Formats.Number_Zero="n0",Number.Formats.Number_Two=Number.Formats.Number(2),Number.Formats.Number_Four=Number.Formats.Number(4),Number.Formats.Decimal_Zero="d0",Number.Formats.Decimal_Two=Number.Formats.Decimal(2),Number.Formats.Decimal_Four=Number.Formats.Decimal(4),Number.Formats.Percent_Zero="p0",Number.Formats.Percent_One=Number.Formats.Percent(1),Number.Formats.Percent_Two=Number.Formats.Percent(2),Number.Formats.Currency_Zero="c0",Number.Formats.Currency_Two=Number.Formats.Currency(2)
;var g=function(){function c(){this.culture="en"}return c.prototype.setCulture=function(a){this.culture=a,e.culture(a)},c.prototype.cultureInfo=function(){return e.culture()},c.prototype.getFormatByCode=function(a){return i(a)},c.prototype.format=function(b,c,f){var g=this,i=!1,j=null;if(f=f||this.culture,a.isArray(c))return a.map(c,function(a){return g.format(b,a,f)}).join(" ");if(c=c,b instanceof Date)return h(b,c,f);if(c&&null!==c.match(/^[ndmg]e?[0-9]*/i)&&!(b instanceof Date)){var k="number"==typeof b?b:d.parseFloat(b,10,"en");if(isNaN(k)||null===k)c=void 0;else{var l=c.substr(0,1);if(null!==c.match(/^[ndmg]e[0-9]*/i)){c=c.replace("e","");var n=m(k,!0);n&&n.length>1&&(k=parseFloat(n[0]),j="e"+n[1])}switch(b=k,l){case"m":c=o(k,c);break;case"g":c=o(k,c),i=!0}}}var p=e.format(b,c,f);if(j&&(p+=j),i){var q=new RegExp(e.culture(f).numberFormat[","].replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),"g");p&&(p=p.replace(q,""))}return p},c.prototype.abbreviate=function(a,b){
return a&&a.length>2*b?a.substr(0,b)+"..."+a.substr(a.length-b,a.length):a},c.prototype.abbreviateByWidth=function(a,c,d){if(!a)return a;var e=document.createElement("span");e.className="dummy-span";var f=b(e);f.text(a),b(document).find("body").append(f);var g=f.width();return b(e).remove(),g>c?this.abbreviate(a,d):a},c}();g=__decorate([c.singleton],g);function h(a,b,c){return b=i(b),e.format(a,b,c)}function i(a){return"g"===a?j():"G"===a||"GT"===a?l():"r"===a||"R"===a?"ddd, dd MMM yyyy HH':'mm':'ss 'GMT'":"s"===a||"m"===a||"y"===a?a.toUpperCase():a}function j(){return k("d")+" "+k("t")}function k(a){return e.culture().calendar.patterns[a]}function l(){return k("d")+" "+k("T")}function m(a,b){return a=a,!b&&n(a)?[a.toString()]:a.toExponential().split(/[eE]/)}function n(a){if(0===a)return!0;var b=Math.abs(a);return b<1e10&&b>1e-6}function o(a,b){var c=b.substr(1);return p(q(a,c.length>0?parseInt(c,10):void 0))}function p(a){var b=a.indexOf(".");return"n"+(b>-1?a.length-1-b:0)}
function q(a,b){var c=Number(a);if(isNaN(c))return a;var d,e=m(c);if(Math.abs(c)<1&&e&&e.length>1){var f=Math.floor(parseFloat(e[0])).toString().length,g=e[0].toString().length>f?e[0].toString().length-f-1:0,h=f+g,i=Math.abs(parseFloat(e[1])),j=i+(b>h?h:b)-1;d=c.toFixed(j>20?20:j)}else d=Math.abs(c)>=1||!b?0===b||b?c.toFixed(b>20?20:b):c.toString():c.toPrecision(b);var k=c.toString();return k.length<d.length?k:d}return g});
define('system/diagnostics/log-message',["require","exports","lodash","system/lang/object","system/text/formatter"],function(require,exports,a,b,c){"use strict";var d=function(){function d(a,b,c,d,e){void 0===e&&(e=""),this.level=a,this.source=b,this.text=c,this.timestamp=d?new Date(d):new Date,this.context=e}return d.fromJson=function(a){return new d(a.level,a.source,a.text,a.timestamp,a.context)},d.fromJsonCollection=function(b){return a.map(b,d.fromJson)},d.prototype.fullSource=function(){return this.context?this.source+" ["+this.context+"]":this.source},d.prototype.toJson=function(){return{timestamp:this.timestamp.toISOString(),level:this.level,source:this.source,text:this.text,context:this.context}},d.prototype.getFormattedTimestamp=function(){return b.resolve(c).format(this.timestamp,"f")},d.prototype.getLevelCaption=function(a){return e(a,this.level)},d}();function e(b,c){var d=a.find(b,{value:c});return d?d.text:c}return d});
define('system/diagnostics/logger',["require","exports","lodash","./log-message"],function(require,exports,a,b){"use strict";var c={trace:5,debug:4,info:3,warn:2,error:1,fatal:0},d=function(){function a(a,b,c){this.id=a,this.messageLogged=b,this.level=c}return a.prototype.log=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];e(this,a,b)},a.prototype.trace=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.trace,b)},a.prototype.debug=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.debug,b)},a.prototype.info=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.info,b)},a.prototype.warn=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.warn,b)},a.prototype.error=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];e(this,a.levels.error,b)},a.prototype.fatal=function(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c]
;e(this,a.levels.fatal,b)},a.prototype.isTraceEnabled=function(){return f(this,a.levels.trace)},a.prototype.isDebugEnabled=function(){return f(this,a.levels.debug)},a.prototype.isInfoEnabled=function(){return f(this,a.levels.info)},a.prototype.isWarnEnabled=function(){return f(this,a.levels.warn)},a.prototype.isErrorEnabled=function(){return f(this,a.levels.error)},a.prototype.isFatalEnabled=function(){return f(this,a.levels.fatal)},a}();d.levels={trace:"trace",debug:"debug",info:"info",warn:"warn",error:"error",fatal:"fatal"};function e(a,c,d){if(f(a,c)){var e=new b(c,a.id,g(d).join(" "));a.messageLogged.raise(a,e)}}function f(a,b){return c[b]<=c[a.level]}function g(b){return a.map(b,function(b){return a.isObject(b)?JSON.stringify(b):a.isNull(b)?"":a.isUndefined(b)?"":b.toString()})}return d});
define('application/application-context',["require","exports","ramda"],function(require,exports,a){"use strict";var b=function(b){return function(c){if(!c)return!1;var d=b(c);return!a.isNil(d)&&""!==d}},c=b(a.prop("siteKey")),d=b(a.prop("defaultSiteKey")),e=function(){function a(){f(this)}return a.prototype.getSiteContext=function(){return c(this.assetcontext)?this.assetcontext.siteKey:d(this.user)?this.user.defaultSiteKey:null},a.prototype.hasPredixSDKInstalled=function(){return!!window.PredixSDK},a.prototype.reset=function(){f(this)},a}();function f(a){a.user=null,a.session=null,a.homeRoute="home",a.sessionStatus={isActive:!1},a.assetcontext=null,a.licensedModules=null,a.help={helpContext:null,helpUrl:null,defaultUrl:null},a.connectionStatus={connected:!0,lastStatusChange:null,connectionCheckerInterval:null,lastResponse:new Date,lastUserActivity:new Date},a.navigation={activeRoute:null,tabsInfo:null},a.isSupportedBrowser=!0,a.isAppHub=!!window.nav,a.hostingEnvironment=0}return new e});
define('config/storage-config',["require","exports","application/application-context"],function(require,exports,a){"use strict";function b(){var b=a.session,c=b.apiServer.toUpperCase(),d=b.datasourceId.toUpperCase(),e=b.userId.toUpperCase(),f="Meridium APM("+c+", "+d+", "+e+")";return{name:f,description:f}}exports.documentStorage=b});
define('system/data/document-storage',["require","exports","jquery","config/storage-config","localforage"],function(require,exports,a,b){"use strict";var c=require("localforage");return function(){function d(d){var e=a.extend({},b.documentStorage(),{storeName:"data"});this.prefix=d+"__",this.instance=c.createInstance(e)}return d.prototype.getItem=function(b){var c=a.Deferred();return this.instance.getItem(this.prefix+b).then(c.resolve.bind(c),c.reject.bind(c)),c.promise()},d.prototype.setItem=function(b,c){var d=a.Deferred();return this.instance.setItem(this.prefix+b,c).then(d.resolve.bind(d),d.reject.bind(d)),d.promise()},d.prototype.removeItem=function(b){var c=a.Deferred();return this.instance.removeItem(this.prefix+b).then(c.resolve.bind(c),c.reject.bind(c)),c.promise()},d}()});
define('system/data/client-preferences',["require","exports","system/data/document-storage","system/lang/ioc"],function(require,exports,a,b){"use strict";var c=function(){function b(){this.documentStorage=new a("client_preferences")}return b.prototype.retrievePreferences=function(a){return this.documentStorage.getItem(a)},b.prototype.savePreference=function(a,b){return this.documentStorage.setItem(a,b)},b.prototype.deletePreference=function(a){return this.documentStorage.removeItem(a)},b}();return c=__decorate([b.singleton],c)});
define('system/diagnostics/log-service',["require","exports","lodash","jquery","system/lang/object","system/lang/ioc","system/data/document-storage","system/data/client-preferences","./log-message","./logger"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";var i={id:"log_config",level:h.levels.error,size:1e3},j=function(){function d(){this.clientPreferences=c.resolve(f),this.logStorage=new e("log"),this.messages=[]}return d.prototype.initializeLogConfig=function(a){return void 0===a&&(a=b.Deferred()),k(this).done(l.bind(null,this,a)),a.promise()},d.prototype.trimLog=function(){for(;this.messages.length>i.size;)this.messages.shift();return b.Deferred().resolve().promise()},d.prototype.saveConfig=function(b){return b=a.extend({},i,b),this.clientPreferences.savePreference(i.id,b)},d.prototype.saveMessage=function(a){var c=b.Deferred();this.messages.push(a.toJson()),this.trimLog(),this.logStorage.setItem("messages",this.messages).done(c.resolve.bind(c)).fail(o)},d.prototype.getAllMessages=function(){var a;try{
return a=this.messages.slice(0),a.reverse(),a=g.fromJsonCollection(a||[]),Promise.resolve(a)}catch(a){return console.error(a),Promise.reject(a)}},d.prototype.clearLog=function(){return this.messages=[],Promise.resolve(this.logStorage.setItem("messages",this.messages))},d}();j=__decorate([d.singleton],j);function k(a){return a.clientPreferences.retrievePreferences(i.id)}function l(a,b,c){c?n(a).done(b.resolve.bind(b,c)):a.saveConfig(i).done(m.bind(null,a,b,i))}function m(a,b,c){n(a).done(b.resolve.bind(b,c))}function n(a){return a.logStorage.getItem("messages").done(function(b){b&&(a.messages=b)}).fail(console.error)}function o(a,b){console.error(b),a.reject(b)}return j});
define('system/lang/event-binding',["require","exports"],function(require,exports){"use strict";var a=function(){function a(a,b,c){void 0===c&&(c=[]),this.handler=a,this.context=b,this.args=c}return a.prototype.execute=function(a){void 0===a&&(a=[]),a=this.args.concat(a),this.handler.apply(this.context,a)},a.prototype.dispose=function(){this.handler=null,this.context=null,this.args=null},a}();exports.EventBinding=a});
define('system/lang/event',["require","exports","./event-binding"],function(require,exports,a){"use strict";var b=function(){function b(){this.bindings=[]}return b.prototype.add=function(b,c){for(var d=[],e=2;e<arguments.length;e++)d[e-2]=arguments[e];if(null===b)throw"Event handler must not be null";if(void 0===b)throw"Event handler must not be undefined";var f=Array.prototype.slice.call(arguments,2),g=new a.EventBinding(b,c,f);return this.bindings.push(g),g},b.prototype.raise=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];for(var c=this.bindings.length,d=0;d!==c;d++)this.bindings[d].execute(a)},b.prototype.remove=function(a,b){arguments.length>1?c(this,a,b):arguments.length>0?(b=a,d(this,b)):e(this)},b}();function c(a,b,c){for(var d=[],e=a.bindings.length,f=0;f!==e;f++){var g=a.bindings[f];g.handler!==b||g.context!==c?d.push(g):g.dispose()}a.bindings=d}function d(a,b){for(var c=[],d=a.bindings.length,e=0;e!==d;e++){var f=a.bindings[e];f.context!==b?c.push(f):f.dispose()}
a.bindings=c}function e(a){for(var b=a.bindings.length,c=0;c!==b;c++)a.bindings[c].dispose();a.bindings=[]}return b});
define('system/diagnostics/log-manager',["require","exports","lodash","system/lang/object","./logger","./log-service","system/lang/event"],function(require,exports,a,b,c,d,e){"use strict";var f=function(){function f(){this.defaultLevel=c.levels.error,this.level=this.defaultLevel,this.loggers={},this.nestedContexts=[],this.messageCache=[],this.messageLogged=new e,this.messageLogged.add(this.cacheMessage,this)}return f.prototype.cacheMessage=function(a,b){b.context=this.currentContext(),this.messageCache.push(b)},f.prototype.initialize=function(){var a=b.resolve(d);return a.trimLog(),a.initializeLogConfig().done(g.bind(null,this)).fail(h)},f.prototype.saveConfig=function(){return b.resolve(d).saveConfig().fail(h)},f.prototype.getLogger=function(a){var b=this.loggers[a];return b||(b=new c(a,this.messageLogged,this.level),this.loggers[a]=b),b},f.prototype.setLevel=function(b){this.level=b,a.each(this.loggers,function(a){return a.level=b})},f.prototype.pushContext=function(a){this.nestedContexts.push(k(a))},
f.prototype.popContext=function(){this.nestedContexts.pop()},f.prototype.currentContext=function(){return this.nestedContexts[this.nestedContexts.length-1]},f}();function g(a,b){a.setLevel(c.levels[b.level]),i(a),a.messageLogged.add(function(b,c){c.context=a.currentContext(),j(a,c)},a)}function h(a){console.error(a)}function i(b){b.messageLogged.remove(b.cacheMessage,b),a.each(b.messageCache,j.bind(null,b))}function j(a,c){b.resolve(d).saveMessage(c)}function k(b){return a.isObject(b)?JSON.stringify(b):b.toString()}return new f});
define('application/application-events',["require","exports","system/lang/event","system/lang/ioc"],function(require,exports,a,b){"use strict";var c=function(){function b(){this.windowResized=new a,this.windowUnloaded=new a,this.signout=new a,this.windowClicked=new a,this.errorOccured=new a,this.errorUnhandled=new a,this.errorCleared=new a,this.titleChanged=new a,this.iconChanged=new a,this.navigate=new a,this.assetcontextChanged=new a,this.connectionChanged=new a,this.sessionChanged=new a,this.sessionExpired=new a,this.offlineSessionExpired=new a,this.smallDeviceOptionsMenuClicked=new a,this.layoutChanged=new a,this.bulkClose=new a}return b.prototype.removeAll=function(){this.connectionChanged.remove(),this.windowResized.remove(),this.windowUnloaded.remove(),this.signout.remove(),this.windowClicked.remove(),this.errorOccured.remove(),this.errorUnhandled.remove(),this.errorCleared.remove(),this.titleChanged.remove(),this.iconChanged.remove(),this.navigate.remove(),this.assetcontextChanged.remove(),
this.connectionChanged.remove(),this.sessionExpired.remove(),this.smallDeviceOptionsMenuClicked.remove(),this.layoutChanged.remove(),this.bulkClose.remove()},b}();return c=__decorate([b.singleton],c)});
define('system/error/error-message',["require","exports"],function(require,exports){"use strict";return function(){function a(a,b,c){void 0===c&&(c=null),this.code=a,this.message=b,this.detail=c}return a.fromHttpResponse=function(b,c,d){if(c.responseText){var e=d?d+c.responseText:c.responseText;return new a(b,this.fromDetail(e),c.responseText)}var e=d?d+c.statusText:c.statusText;return new a(b,e)},a.fromDetail=function(a){return a=a.replace("\r\n"," ").replace("\n","").replace("\r",""),a.length>512&&(a=a.substring(0,510)+".."),a},a}()});
define('system/globalization/translator',["require","exports","system/lang/ioc","jed"],function(require,exports,a){"use strict";var b=require("jed"),c=function(){function a(){this.jed=null}return a.prototype.setLocale=function(a){this.jed=new b(a)},a.prototype.translate=function(a,b,c){if(!a)return a;if(!this.jed)return a;var d=this.jed.translate(a);return b&&d.onDomain(b),c&&d.withContext(c),d.fetch()},a}();return c=__decorate([a.singleton],c)});
define('spa/conductor',["require","exports","jquery","system/lang/ioc","system/diagnostics/log-manager","application/application-events","system/error/error-message","system/globalization/translator"],function(require,exports,a,b,c,d,e,f){"use strict";var g=c.getLogger("spa/conductor"),h="FND1",i="PAGE_NOT_LOADED",j=function(){function b(a,b){this.errorOccured=a.errorOccured,this.translator=b}return b.prototype.activateScreen=function(a,b){try{return k(this,a,b)}catch(a){l(this,a)}},b.prototype.createArgumentArray=function(a,b){return void 0===b&&(b=[]),g.isTraceEnabled()&&g.trace("create argument array"),a?(a.named&&b.push(a.named),Array.prototype.push.apply(b,a.positional),b):b},b.prototype.reuseScreen=function(a,b,c){try{return m(this,a,b,c)}catch(a){l(this,a)}},b.prototype.deactivateScreen=function(a){try{n(a)}catch(a){l(this,a)}},b.prototype.canUnloadScreen=function(a){try{return o(a)}catch(a){return l(this,a),!1}},b.prototype.attachScreen=function(a,b,c){try{p(a,b,c)}catch(a){l(this,a)}},
b.prototype.detachScreen=function(a){try{q(a)}catch(a){l(this,a)}},b.prototype.canReuseScreen=function(a,b,c){try{return r(this,a,b,c)}catch(a){return l(this,a),!1}},b.prototype.openScreen=function(a,b){try{s(this,a,b)}catch(a){l(this,a)}},b.prototype.loadScreen=function(a,b){try{t(this,a,b)}catch(a){l(this,a)}},b.prototype.closeScreen=function(a){try{u(a)}catch(a){l(this,a)}},b.prototype.unloadScreen=function(a){try{v(a)}catch(a){l(this,a)}},b.prototype.changeScreen=function(b,d,e,f){void 0===e&&(e={});var h=d.screen,i={isClosing:!0,checkForReuse:!0,checkForUnload:!1};if(c.pushContext(w(b)+" from "+w(h)),a.extend(i,f),i.checkForReuse&&this.canReuseScreen(h,b,e))return g.isDebugEnabled()&&g.debug("Reusing previous screen."),void this.reuseScreen(h,d,e);this.openScreen(b,e),this.loadScreen(b,e),this.deactivateScreen(h),this.activateScreen(b,e),this.detachScreen(d),this.attachScreen(b,d,e.url),i.isClosing&&b!==h&&(g.isDebugEnabled()&&g.debug("closing previous screen."),
this.unloadScreen(h),this.closeScreen(h)),c.popContext()},b.prototype.hideScreen=function(a){this.deactivateScreen(a.screen),this.detachScreen(a)},b.prototype.clearScreen=function(a){this.changeScreen(null,a),a.screen=null},b.prototype.showScreen=function(a,b){this.activateScreen(a.screen),this.attachScreen(a.screen,a,b)},b}();j=__decorate([b.dependsOn(d,f)],j);function k(a,b,c){if(g.isTraceEnabled()&&g.trace("activating screen"),(!b||!b.isActive)&&b&&(b.isActive=!0,b.activate)){var d=a.createArgumentArray(c);return b.activate.apply(b,d)}}function l(a,b){var c,d;c=b&&b.message?b.message:b instanceof Object?JSON.stringify(b):b,d=b.stack?b.stack:(new Error).stack;var f=a.translator.translate(i),g=new e(h,f,c+"\n"+d);a.errorOccured.raise(a,g)}function m(a,b,c,d){if(g.isTraceEnabled()&&g.trace("reuse screen"),b.reuse){var e=a.createArgumentArray(d,[c,d.url]);return b.reuse.apply(b,e)}}function n(a){g.isTraceEnabled()&&g.trace("deactivating screen"),a&&!a.isActive||a&&(a.isActive=!1,
a.deactivate&&a.deactivate())}function o(a){return g.isTraceEnabled()&&g.trace("can deactivate screen"),!a||!a.canUnload||a.canUnload()}function p(a,b,c){a&&a.isAttached===!0||(g.isTraceEnabled()&&g.trace("attaching screen"),a&&a.attach&&(a.attach(b,c),b.screen=a,a.isAttached=!0))}function q(a){g.isTraceEnabled()&&g.trace("detaching screen"),a&&a.screen&&(a&&a.screen&&!a.screen.isAttached||a.screen.detach&&(a.screen.detach(a),a.screen.isAttached=!1))}function r(a,b,c,d){var e=!0;if(g.isTraceEnabled()&&g.trace("can reuse screen: ",w(c)),!c||!b||c.constructor!==b.constructor)return!1;if(c.canReuse){var f=a.createArgumentArray(d);e=c.canReuse.apply(c,f)}else c.reuse||(e=!1);return e!==!1}function s(a,b,c){if(g.isTraceEnabled()&&g.trace("opening screen"),b&&!b.isOpen){if(b.open){var d=a.createArgumentArray(c);d[d.length]=c.url,b.open.apply(b,d)}b.isOpen=!0}}function t(a,b,c){if(g.isTraceEnabled()&&g.trace("load screen"),b&&!b.isLoaded){if(b.load){var d=a.createArgumentArray(c)
;b.load.apply(b,d)}b.isLoaded=!0}}function u(a){g.isTraceEnabled()&&g.trace("closing screen"),a&&a.isOpen&&(a.close&&a.close(),a.isOpen=!1)}function v(a){g.isTraceEnabled()&&g.trace("unload screen"),a&&a.isLoaded&&(a.unload&&a.unload(),a.isLoaded=!1)}function w(a){return a?a.constructor&&a.constructor.name?a.constructor.name:a.constructor?a.constructor:a.toString():a}return j});
define('spa/region',["require","exports","jquery"],function(require,exports,a){"use strict";var b=8,c=function(){function a(a){this.element=null,this.$element=null,this.setElement(a),this.activeContainer=null,this.screen=null}return a.prototype.setElement=function(a){var b=d(a);this.element=e(b),this.$element=h(b),i(this)},a.prototype.attach=function(a){this.clear(),this.activeContainer=j(),k(this,a),l(this)},a.prototype.clear=function(){this.activeContainer&&(n(this),i(this))},a.prototype.remove=function(){if(!this.$element)throw new Error("region.$element is null");this.$element.remove()},a.prototype.dispose=function(){this.clear(),this.detach(),this.screen=null},a.prototype.detach=function(){this.element=null,this.$element=null},a.prototype.removeAndDispose=function(){this.remove(),this.dispose()},a}();function d(a){return a||document.createElement("div")}function e(a){return f(a)?g(a):a}function f(b){return b instanceof a}function g(a){return a.get(0)}function h(b){return f(b)?b:a(b)}
function i(a){if(!a.$element)throw new Error("region.$element is null");a.$element.empty()}function j(){var a=document.createElement("div");return a.classList.add("region"),a}function k(b,c){a(b.activeContainer).append(c)}function l(a){if(m(a.element)){if(!a.$element)throw new Error("region.$element is null");a.$element.after(a.activeContainer)}else{if(!a.element)throw new Error("region.element is null");a.element.appendChild(a.activeContainer)}}function m(a){return!!a&&a.nodeType===b}function n(b){a(b.activeContainer).remove(),b.activeContainer=null}return c});
define('system/lang/interface',['lodash'],function(){"use strict";var a=require("lodash");function b(a,b,c){this.name=a,this.methods=b||[],this.properties=c||[]}b.prototype.implementedBy=function(a){c(this,a),d(this,a)};function c(b,c){var d,e;for(d=0;d<b.methods.length;d++){if(e=b.methods[d],a.isUndefined(c[e]))throw"Missing method "+e;if(!a.isFunction(c[e]))throw e+" is not a function"}return!0}function d(b,c){var d,e;for(d=0;d<b.properties.length;d++)if(e=b.properties[d],a.isUndefined(c[e]))throw"Missing property "+e;return!0}return b});
define('spa/i-router',['require','exports','module','system/lang/interface'],function(require,exports,module){"use strict";return new(require("system/lang/interface"))(module.id,["activate","resolve","deactivate"],["routerConfig","matchedRoute"])});
define('spa/action-routes/action-route-close',['require','exports','module','jquery','system/globalization/translator'],function(require,exports,module){"use strict";var a=require("jquery"),b=require("system/globalization/translator");function c(a){this.busyIndicator=a,this.closeButton=null,this.translator=Object.resolve(b),this.boundClickHandler=f.bind(null,this)}c.prototype.handleBusyIndicatorClose=function(){setTimeout(d.bind(null,this),1e4)};function d(b){if(g()&&0===a("button.action-route-indicator-close").length){e(b.translator.translate("CLOSE_LOADING_INDICATOR")),b.closeButton=document.querySelector("button.action-route-indicator-close"),b.closeButton.addEventListener("click",b.boundClickHandler)}}function e(b){a("#shell").prepend('<button class="btn action-route-indicator-close">'+b+"</button>")}function f(b){b.busyIndicator.hide(),b.closeButton.removeEventListener("click",b.boundClickHandler),a(b.closeButton).remove()}function g(){return"block"===document.querySelector("#shell").querySelector(".busy-indicator-wrap").style.display}return c});
define('system/ui/busy-indicator',['require','scopedQuerySelector'],function(require){"use strict";require("scopedQuerySelector");function a(a){this.container=null,this.loaderClassName=a||null,this.displayCache=null,this.positionCache=null}a.prototype.attachTo=function(a){a&&(this.displayCache=a.style.overflow,this.positionCache=a.style.position,b(this,a))},a.prototype.detach=function(){this.container=null,this.loaderClassName=null,this.displayCache=null,this.positionCache=null},a.prototype.show=function(){var a,b;if(this.container)for(this.container.style.overflow="hidden",this.container.style.position=this.positionCache?this.positionCache:"relative",a=this.container.querySelectorAll(":scope > .busy-indicator-wrap"),b=0;b<a.length;b++)a[b].style.display="block"},a.prototype.hide=function(){var a,b;if(this.container)for(this.displayCache?this.container.style.overflow=this.displayCache:this.container.style.overflow="",this.positionCache?this.container.style.position=this.positionCache:this.container.style.position="",
a=this.container.querySelectorAll(":scope > .busy-indicator-wrap"),b=0;b<a.length;b++)a[b].style.display="none"};function b(a,b){if(a.container=b,!a.container.querySelector(":scope > .busy-indicator-wrap")){var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div"),f=a.container.getBoundingClientRect();c.classList.add("busy-indicator-wrap"),c.style.display="none",d.classList.add("busy-indicator"),a.loaderClassName?e.classList.add(a.loaderClassName):a.container.offsetWidth<640?e.classList.add("loading-small"):a.container.offsetWidth<1024&&a.container.offsetWidth>641?e.classList.add("loading-med"):a.container.offsetWidth<1440&&a.container.offsetWidth>1025?e.classList.add("loading-large"):a.container.offsetWidth>1441?e.classList.add("loading-extra-large"):e.classList.add("loading-med"),c.appendChild(d),d.appendChild(e),a.container.appendChild(c),c.style.top=a.container.clientTop+"px",c.style.left=a.container.clientLeft+"px"}}return a});
define('spa/action-routes/action-route-url-remover',['require','exports','module'],function(require,exports,module){"use strict";function a(){}a.remove=function(a,d){var f=d.arguments.url,g=c(a,f);g=e(g,d),b(g)};function b(a){window.location.href=window.location.href.replace(a,"")}function c(a,b){var c=";act=",e;return b?(e=c+a+b,e=d(e)):e=c+a,e}function d(a){return a.replace("*","")}function e(a,b){var c=b.arguments.named;for(var d in c)a.indexOf(d)>-1&&(a=a.replace("@"+d,c[d]));return a}return a});
define('spa/action-routes/action-route-opener',['require','exports','module','jquery','spa/action-routes/action-route-close','system/ui/busy-indicator','spa/action-routes/action-route-url-remover','application/application-events'],function(require,exports,module){"use strict";var a=require("jquery"),b=require("spa/action-routes/action-route-close"),c=require("system/ui/busy-indicator"),d=require("spa/action-routes/action-route-url-remover"),e=require("application/application-events");function f(){}f.prototype.open=function(a,b){g(a,b)};function g(a,e){var f=new c("loading-extra-large"),g=new b(f),i=e.arguments.positional,k=e.arguments.named,l={};l.query=i,l.routeArgs=k,l.routeInfo=e,f.attachTo(document.querySelector("#shell")),f.show(),g.handleBusyIndicatorClose(),e.screen.execute(l).done(h.bind(null,f)).fail(j.bind(null,f)),d.remove(a.config.url,e)}function h(a,b){b&&b.route&&i(b.route),a.hide()}function i(a){var b=Object.resolve(e),c={tab:!0};b.navigate.raise(a,c)}function j(a){a.hide()}return f});
define('system/lang/url-codec',["require","exports"],function(require,exports){"use strict";var a=[],b=/\[\]$/,c=/\[/,d=/\]$/,e=function(){function b(){}return b.encode=function(b){return a=[],h("",b).join("&")},b.decode=function(a){return i(a)},b}();function f(a){return"[object Array]"===Object.prototype.toString.call(a)}function g(b,c){c="function"==typeof c?c():null===c?"":void 0===c?"":c,a[a.length]=encodeURIComponent(b)+"="+encodeURIComponent(c)}function h(c,d){var e,i;if(c)if(f(d))for(e=0,i=d.length;e<i;e++)b.test(c)?g(c,d[e]):h(c+"["+("object"==typeof d[e]?e:"")+"]",d[e]);else if(d&&"[object Object]"===String(d))for(var j in d)d.hasOwnProperty(j)&&h(c+"["+j+"]",d[j]);else g(c,d);else if(f(d))for(e=0,i=d.length;e<i;e++)g(d[e].name,d[e].value);else for(var j in d)d.hasOwnProperty(j)&&h(j,d[j]);return a}function i(a){var b={};return a?(a.split("&").forEach(j.bind(null,b)),b):b}function j(a,b){var e=b.split("="),f=decodeURIComponent(e[0]),g=typeof a,h=f.split("]["),i=h.length-1
;if(c.test(h[0])&&d.test(h[i])){h[i]=h[i].replace(d,"");var j=h.shift();null!==j&&(h=j.split("[").concat(h),i=h.length-1)}else i=0;if(2===e.length){var k=decodeURIComponent(e[1]);if(i)for(var l=0;l<=i;l++)f=""===h[l]?g.length:h[l],g=g[f]=l<i?g[f]||(h[l+1]&&isNaN(h[l+1])?{}:[]):k;else"[object Array]"===Object.prototype.toString.call(a[f])?a[f].push(k):!{}.hasOwnProperty.call(a,f)?a[f]=k:a[f]=[a[f],k]}}return e});
define('spa/route-parser',['require','exports','module','jquery','system/lang/event','system/diagnostics/log-manager','system/lang/url-codec'],function(require,exports,module){"use strict";var a=require("jquery"),b=require("system/lang/event"),c=require("system/diagnostics/log-manager"),d=c.getLogger(module.id),e=require("system/lang/url-codec"),f=/\*|@\w*/g,g=/^$/,h=/@\w+/g,i=/@/g,j=/\/\*/g,k=/^\/|\/$/g,l="([^/]*)",m="?(.*)",n="/?(.*)";function o(){this.routes=[],this.routeMatched=new b,this.badRoute=new b}o.prototype.dispatch=function(a,b){d.isTraceEnabled()&&d.trace("dispatch url ",a);var c=a.split("?"),e=this.match(c[0]);if(void 0===e)return d.warn("unmatched url ",a),void this.badRoute.raise({url:a});var f=this.parse(a,e,b);this.routeMatched.raise({module:e.module,arguments:f,config:p(e)})};function p(b){var c=a.extend({},b);return c.matches&&delete c.matches,c.regExp&&delete c.regExp,c}o.prototype.load=function(a){this.routes=a,d.isTraceEnabled()&&d.trace("configure Routes"),this.routes.forEach(o.configureRoute)},o.configureRoute=function(a){var b,c,e=f;if(a.matches=[],""===(a.url||""))return a.regExp=g,a
;for(b="^"+a.url.replace(h,l).replace(i,m).replace(j,n)+"$",a.regExp=new RegExp(b,"i"),d.isTraceEnabled()&&d.trace("url: ",a.url," regex: ",b),c=e.exec(a.url);null!==c;)a.matches.push(c[0]),c=e.exec(a.url);return a},o.prototype.match=function(a){a=a.replace(k,"");for(var b=0;b<this.routes.length;b++)if(this.routes[b].regExp.lastIndex=0,this.routes[b].regExp.test(a))return d.isTraceEnabled()&&d.trace("route match ",a," matched ",this.routes[b]),this.routes[b]},o.prototype.parse=function(a,b,c){var e={named:null,positional:[],url:"",icon:""},f=a.split("?"),g,h;if(a=f[0],c=q(c,f),d.isTraceEnabled()&&d.trace("parse values"),a=a.replace(k,""),b.regExp.lastIndex=0,null!==(g=b.regExp.exec(a)))for(h=1;h<g.length;h++)s(e,g[h],b.matches[h-1]);return c&&e.positional.push(c),e.icon=b.icon,d.isTraceEnabled()&&d.trace("parsed values: ",e),e};function q(a,b){return a||(a=r(b)),a}function r(a){var b=a.length>0?a[1]:null,c=b?e.decode(b):null;return c&&a.length>0&&(c.__isQueryString__=!0),c}
function s(a,b,c){if(d.isTraceEnabled()&&d.trace(b,c),void 0!==c&&void 0!==b){if("*"===c)return void(a.url=b);if("@"===c){var e=b.split("/");return""===e[e.length-1]&&e.pop(),void Array.prototype.push.apply(a.positional,e)}null===a.named&&(a.named={}),a.named[c.substring(1)]=b}}return o});
define('spa/router',['require','jquery','mi-assert','./i-router','system/lang/event','spa/action-routes/action-route-opener','spa/route-parser'],function(require){"use strict";var a=require("jquery"),b=require("mi-assert"),c=require("./i-router"),d=require("system/lang/event"),e=require("spa/action-routes/action-route-opener"),f=require("spa/route-parser"),g="status-pages/url-not-supported/url-not-supported-view-model";function h(a){this.routerConfig=a||{},this.routeParser=new f,this.matchedRoute=new d,this.loadModuleDeferred=null,this.matchedRouteQueue=[],b.implementsInterface(this,c)}h.prototype.activate=function(){this.routeParser.load(this.routerConfig),this.routeParser.routeMatched.add(this.routeMatchedHandler,this),this.routeParser.badRoute.add(this.badRouteHandler,this)},h.prototype.resolve=function(a,b){b?this.routeParser.dispatch(a,b):this.routeParser.dispatch(a)},h.prototype.deactivate=function(){this.routeParser.routeMatched.remove(),this.routeParser.badRoute.remove()},h.prototype.routeMatchedHandler=function(a){i(this,a),k(this)};function i(a,b){a.matchedRouteQueue[a.matchedRouteQueue.length]=b}function j(a){
var b;return a.matchedRouteQueue.length>0&&(b=a.matchedRouteQueue[a.matchedRouteQueue.length-1]),a.matchedRouteQueue=[],b}function k(a){var b;a.loadModuleDeferred||(b=j(a))&&a.loadModule(b.module).done(a.raiseMatchedRoute.bind(a,b))}h.prototype.raiseMatchedRoute=function(a,module){var b={};if(b.arguments=a.arguments,b.screen=this.createScreenInstance(a,module),b.conn=this.createConnectionInstance(a,module),this.matchedRoute.raise(b),this.loadModuleDeferred=null,a.config&&a.config.isActionRoute){(new e).open(a,b)}k(this)},h.prototype.createScreenInstance=function(a,module){return a&&a.config&&a.config.member&&(module=module[a.config.member]),Object.resolve(module)},h.prototype.createConnectionInstance=function(a,module){return a&&a.config&&a.config.member&&(module=module[a.config.member]),Object.resolve(module)},h.prototype.badRouteHandler=function(){this.routeMatchedHandler(l())};function l(){return{arguments:{named:null,positional:[],url:"",icon:""},module:g}}
h.prototype.loadModule=function(module){return this.loadModuleDeferred=a.Deferred(),require([module],m.bind(null,this),n.bind(null,this)),this.loadModuleDeferred.promise()};function m(a,module){a.loadModuleDeferred.resolve(module)}function n(a,b){console.error(b),require([g],m.bind(null,a))}return h});
define('spa/knockout/knockout-route-screen',['require','ramda','lodash','./knockout-view-model','spa/conductor','spa/region','spa/router'],function(require){"use strict";var a=require("ramda"),b=require("lodash"),c=require("./knockout-view-model"),d=require("spa/conductor"),e=require("spa/region"),f=require("spa/router");function g(a,b,c,f){h.call(this,a),this.routeConfig=b,this.contentSelector=c,this.conductor=f||Object.resolve(d),this.contentRegion=new e,this.subRouter=null,this.url=void 0,this.routeArgs=[]}var h=Object.inherit(c,g);return g.prototype.canReuse=function a(){return!0},g.prototype.reuse=function b(c,d){var e=a.drop(2,arguments);this.resolveSubRoute(d,e)},g.prototype.activate=function a(){this.routeArgs=b.toArray(arguments),this.subRouter=Object.resolve(f),this.subRouter.routerConfig=this.routeConfig,this.subRouter.matchedRoute.add(this.route,this),this.subRouter.activate()},g.prototype.attach=function a(b){h.prototype.attach.call(this,b),this.contentRegion.setElement(b.$element.find(this.contentSelector))},g.prototype.route=function a(b){
this.conductor.changeScreen(b.screen,this.contentRegion,b.arguments)},g.prototype.resolveSubRoute=function a(c,d){var e=b.last(d),f=e&&e.__isQueryString__;if(this.url===c&&!f)return void this.conductor.showScreen(this.contentRegion,c);this.subRouter&&(this.url=c,f?this.subRouter.resolve(c,e):this.subRouter.resolve(c))},g.prototype.detach=function a(){h.prototype.detach.apply(this,arguments),this.conductor.hideScreen(this.contentRegion)},g.prototype.deactivate=function a(){this.subRouter&&(this.subRouter.matchedRoute.remove(),this.subRouter.deactivate())},g.prototype.canUnload=function a(){return this.conductor.canUnloadScreen(this.contentRegion.screen)},g.prototype.isDirty=function(){return!!(this.contentRegion&&this.contentRegion.screen&&this.contentRegion.screen.isDirty)&&this.contentRegion.screen.isDirty()},g.prototype.unload=function a(){this.conductor.clearScreen&&this.conductor.clearScreen(this.contentRegion),this.url=void 0},g});
/**
 * @license RequireJS text 2.0.9 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */
/*jslint regexp: true */
/*global require, XMLHttpRequest, ActiveXObject,
  define, window, process, Packages,
  java, location, Components, FileUtils */

define('text',['module'], function (module) {
    'use strict';

    var text, fs, Cc, Ci, xpcIsWindows,
        progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'],
        xmlRegExp = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,
        bodyRegExp = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,
        hasLocation = typeof location !== 'undefined' && location.href,
        defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\:/, ''),
        defaultHostName = hasLocation && location.hostname,
        defaultPort = hasLocation && (location.port || undefined),
        buildMap = {},
        masterConfig = (module.config && module.config()) || {};

    text = {
        version: '2.0.9',

        strip: function (content) {
            //Strips <?xml ...?> declarations so that external SVG and XML
            //documents can be added to a document without worry. Also, if the string
            //is an HTML document, only the part inside the body tag is returned.
            if (content) {
                content = content.replace(xmlRegExp, "");
                var matches = content.match(bodyRegExp);
                if (matches) {
                    content = matches[1];
                }
            } else {
                content = "";
            }
            return content;
        },

        jsEscape: function (content) {
            return content.replace(/(['\\])/g, '\\$1')
                .replace(/[\f]/g, "\\f")
                .replace(/[\b]/g, "\\b")
                .replace(/[\n]/g, "\\n")
                .replace(/[\t]/g, "\\t")
                .replace(/[\r]/g, "\\r")
                .replace(/[\u2028]/g, "\\u2028")
                .replace(/[\u2029]/g, "\\u2029");
        },

        createXhr: masterConfig.createXhr || function () {
            //Would love to dump the ActiveX crap in here. Need IE 6 to die first.
            var xhr, i, progId;
            if (typeof XMLHttpRequest !== "undefined") {
                return new XMLHttpRequest();
            } else if (typeof ActiveXObject !== "undefined") {
                for (i = 0; i < 3; i += 1) {
                    progId = progIds[i];
                    try {
                        xhr = new ActiveXObject(progId);
                    } catch (e) {}

                    if (xhr) {
                        progIds = [progId];  // so faster next time
                        break;
                    }
                }
            }

            return xhr;
        },

        /**
         * Parses a resource name into its component parts. Resource names
         * look like: module/name.ext!strip, where the !strip part is
         * optional.
         * @param {String} name the resource name
         * @returns {Object} with properties "moduleName", "ext" and "strip"
         * where strip is a boolean.
         */
        parseName: function (name) {
            var modName, ext, temp,
                strip = false,
                index = name.indexOf("."),
                isRelative = name.indexOf('./') === 0 ||
                             name.indexOf('../') === 0;

            if (index !== -1 && (!isRelative || index > 1)) {
                modName = name.substring(0, index);
                ext = name.substring(index + 1, name.length);
            } else {
                modName = name;
            }

            temp = ext || modName;
            index = temp.indexOf("!");
            if (index !== -1) {
                //Pull off the strip arg.
                strip = temp.substring(index + 1) === "strip";
                temp = temp.substring(0, index);
                if (ext) {
                    ext = temp;
                } else {
                    modName = temp;
                }
            }

            return {
                moduleName: modName,
                ext: ext,
                strip: strip
            };
        },

        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,

        /**
         * Is an URL on another domain. Only works for browser use, returns
         * false in non-browser environments. Only used to know if an
         * optimized .js version of a text resource should be loaded
         * instead.
         * @param {String} url
         * @returns Boolean
         */
        useXhr: function (url, protocol, hostname, port) {
            var uProtocol, uHostName, uPort,
                match = text.xdRegExp.exec(url);
            if (!match) {
                return true;
            }
            uProtocol = match[2];
            uHostName = match[3];

            uHostName = uHostName.split(':');
            uPort = uHostName[1];
            uHostName = uHostName[0];

            return (!uProtocol || uProtocol === protocol) &&
                   (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) &&
                   ((!uPort && !uHostName) || uPort === port);
        },

        finishLoad: function (name, strip, content, onLoad) {
            content = strip ? text.strip(content) : content;
            if (masterConfig.isBuild) {
                buildMap[name] = content;
            }
            onLoad(content);
        },

        load: function (name, req, onLoad, config) {
            //Name has format: some.module.filext!strip
            //The strip part is optional.
            //if strip is present, then that means only get the string contents
            //inside a body tag in an HTML string. For XML/SVG content it means
            //removing the <?xml ...?> declarations so the content can be inserted
            //into the current doc without problems.

            // Do not bother with the work if a build and text will
            // not be inlined.
            if (config.isBuild && !config.inlineText) {
                onLoad();
                return;
            }

            masterConfig.isBuild = config.isBuild;

            var parsed = text.parseName(name),
                nonStripName = parsed.moduleName +
                    (parsed.ext ? '.' + parsed.ext : ''),
                url = req.toUrl(nonStripName),
                useXhr = (masterConfig.useXhr) ||
                         text.useXhr;

            //Load the text. Use XHR if possible and in a browser.
            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {
                text.get(url, function (content) {
                    text.finishLoad(name, parsed.strip, content, onLoad);
                }, function (err) {
                    if (onLoad.error) {
                        onLoad.error(err);
                    }
                });
            } else {
                //Need to fetch the resource across domains. Assume
                //the resource has been optimized into a JS module. Fetch
                //by the module name + extension, but do not include the
                //!strip part to avoid file system issues.
                req([nonStripName], function (content) {
                    text.finishLoad(parsed.moduleName + '.' + parsed.ext,
                                    parsed.strip, content, onLoad);
                });
            }
        },

        write: function (pluginName, moduleName, write, config) {
            if (buildMap.hasOwnProperty(moduleName)) {
                var content = text.jsEscape(buildMap[moduleName]);
                write.asModule(pluginName + "!" + moduleName,
                               "define(function () { return '" +
                                   content +
                               "';});\n");
            }
        },

        writeFile: function (pluginName, moduleName, req, write, config) {
            var parsed = text.parseName(moduleName),
                extPart = parsed.ext ? '.' + parsed.ext : '',
                nonStripName = parsed.moduleName + extPart,
                //Use a '.js' file name so that it indicates it is a
                //script that can be loaded across domains.
                fileName = req.toUrl(parsed.moduleName + extPart) + '.js';

            //Leverage own load() method to load plugin value, but only
            //write out values that do not have the strip argument,
            //to avoid any potential issues with ! in file names.
            text.load(nonStripName, req, function (value) {
                //Use own write() method to construct full module value.
                //But need to create shell that translates writeFile's
                //write() to the right interface.
                var textWrite = function (contents) {
                    return write(fileName, contents);
                };
                textWrite.asModule = function (moduleName, contents) {
                    return write.asModule(moduleName, fileName, contents);
                };

                text.write(pluginName, nonStripName, textWrite, config);
            }, config);
        }
    };

    if (masterConfig.env === 'node' || (!masterConfig.env &&
            typeof process !== "undefined" &&
            process.versions &&
            !!process.versions.node &&
            !process.versions['node-webkit'])) {
        //Using special require.nodeRequire, something added by r.js.
        fs = require.nodeRequire('fs');

        text.get = function (url, callback, errback) {
            try {
                var file = fs.readFileSync(url, 'utf8');
                //Remove BOM (Byte Mark Order) from utf8 files if it is there.
                if (file.indexOf('\uFEFF') === 0) {
                    file = file.substring(1);
                }
                callback(file);
            } catch (e) {
                errback(e);
            }
        };
    } else if (masterConfig.env === 'xhr' || (!masterConfig.env &&
            text.createXhr())) {
        text.get = function (url, callback, errback, headers) {
            var xhr = text.createXhr(), header;
            xhr.open('GET', url, true);

            //Allow plugins direct access to xhr headers
            if (headers) {
                for (header in headers) {
                    if (headers.hasOwnProperty(header)) {
                        xhr.setRequestHeader(header.toLowerCase(), headers[header]);
                    }
                }
            }

            //Allow overrides specified in config
            if (masterConfig.onXhr) {
                masterConfig.onXhr(xhr, url);
            }

            xhr.onreadystatechange = function (evt) {
                var status, err;
                //Do not explicitly handle errors, those should be
                //visible via console output in the browser.
                if (xhr.readyState === 4) {
                    status = xhr.status;
                    if (status > 399 && status < 600) {
                        //An http 4xx or 5xx error. Signal an error.
                        err = new Error(url + ' HTTP status: ' + status);
                        err.xhr = xhr;
                        errback(err);
                    } else {
                        callback(xhr.responseText);
                    }

                    if (masterConfig.onXhrComplete) {
                        masterConfig.onXhrComplete(xhr, url);
                    }
                }
            };
            xhr.send(null);
        };
    } else if (masterConfig.env === 'rhino' || (!masterConfig.env &&
            typeof Packages !== 'undefined' && typeof java !== 'undefined')) {
        //Why Java, why is this so awkward?
        text.get = function (url, callback) {
            var stringBuffer, line,
                encoding = "utf-8",
                file = new java.io.File(url),
                lineSeparator = java.lang.System.getProperty("line.separator"),
                input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)),
                content = '';
            try {
                stringBuffer = new java.lang.StringBuffer();
                line = input.readLine();

                // Byte Order Mark (BOM) - The Unicode Standard, version 3.0, page 324
                // http://www.unicode.org/faq/utf_bom.html

                // Note that when we use utf-8, the BOM should appear as "EF BB BF", but it doesn't due to this bug in the JDK:
                // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058
                if (line && line.length() && line.charAt(0) === 0xfeff) {
                    // Eat the BOM, since we've already found the encoding on this file,
                    // and we plan to concatenating this buffer with others; the BOM should
                    // only appear at the top of a file.
                    line = line.substring(1);
                }

                if (line !== null) {
                    stringBuffer.append(line);
                }

                while ((line = input.readLine()) !== null) {
                    stringBuffer.append(lineSeparator);
                    stringBuffer.append(line);
                }
                //Make sure we return a JavaScript string and not a Java string.
                content = String(stringBuffer.toString()); //String
            } finally {
                input.close();
            }
            callback(content);
        };
    } else if (masterConfig.env === 'xpconnect' || (!masterConfig.env &&
            typeof Components !== 'undefined' && Components.classes &&
            Components.interfaces)) {
        //Avert your gaze!
        Cc = Components.classes,
        Ci = Components.interfaces;
        Components.utils['import']('resource://gre/modules/FileUtils.jsm');
        xpcIsWindows = ('@mozilla.org/windows-registry-key;1' in Cc);

        text.get = function (url, callback) {
            var inStream, convertStream, fileObj,
                readData = {};

            if (xpcIsWindows) {
                url = url.replace(/\//g, '\\');
            }

            fileObj = new FileUtils.File(url);

            //XPCOM, you so crazy
            try {
                inStream = Cc['@mozilla.org/network/file-input-stream;1']
                           .createInstance(Ci.nsIFileInputStream);
                inStream.init(fileObj, 1, 0, false);

                convertStream = Cc['@mozilla.org/intl/converter-input-stream;1']
                                .createInstance(Ci.nsIConverterInputStream);
                convertStream.init(inStream, "utf-8", inStream.available(),
                Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);

                convertStream.readString(inStream.available(), readData);
                convertStream.close();
                inStream.close();
                callback(readData.value);
            } catch (e) {
                throw new Error((fileObj && fileObj.path || '') + ': ' + e);
            }
        };
    }
    return text;
});


define('text!assets/views/asset-shell.html',[],function () { return '<div class="assets-shell-screen">\r\n    <div class="block-group page">\r\n        <div class="block context">\r\n            <mi-asset-context data-open="true" allow-add="true"></mi-asset-context>\r\n        </div>\r\n        <div class="block list">\r\n            <div class="asset-content">&nbsp;</div>\r\n        </div>\r\n    </div>\r\n</div>\r\n';});

define('system/hardware/device',["require","exports","detect"],function(require,exports){"use strict";var a=require("detect");return function(){function b(b){this.userAgent=b||navigator.userAgent,this.parsedUserAgent=a.parse(this.userAgent)}return b.prototype.isMobile=function(){return this.isMobileApp()},b.prototype.isMobileApp=function(){return void 0!==window.cordova},b.prototype.isWindowsApp=function(){return!!window.MSApp},b.prototype.isAndroid=function(){return/Android/i.test(this.userAgent)},b.prototype.isIOS=function(){return/iPhone|iPad|iPod/i.test(this.userAgent)},b.prototype.isIE=function(){return/Trident/i.test(this.userAgent)&&!/MSIE/i.test(this.userAgent)},b.prototype.isEdge=function(){return/EDGE/i.test(this.userAgent)},b.prototype.isChromeOnAndroid=function(){return!!this.canReadBrowserAndOS()&&("CHROME"===this.parsedUserAgent.browser.family.toUpperCase()&&"ANDROID"===this.parsedUserAgent.os.family.toUpperCase())},b.prototype.canReadBrowserAndOS=function(){
return!(!this.parsedUserAgent.browser.family||!this.parsedUserAgent.os.family)},b.prototype.innerWidth=function(){return window.innerWidth},b.prototype.outerWidth=function(){return window.outerWidth},b.prototype.screenWidth=function(){return window.screen.width},b.prototype.innerHeight=function(){return window.innerHeight},b.prototype.pixelRatio=function(){return window.devicePixelRatio},b.prototype.deviceInnerWidth=function(){return this.roundUp(this.innerWidth()*this.pixelRatio())},b.prototype.roundUp=function(a){return Math.ceil(a)},b.prototype.deviceOuterWidth=function(){return this.roundUp(this.outerWidth()*this.pixelRatio())},b.prototype.deviceScreenWidth=function(){return this.roundUp(this.screenWidth()*this.pixelRatio())},b.prototype.isChrome=function(){return/Chrome/i.test(this.userAgent)},b}()});
define('system/mobile/device-connectivity',["require","exports","system/lang/ioc","system/lang/ioc","system/lang/ioc","application/application-events","bluebird","ramda"],function(require,exports,a,b,c,d,e,f){"use strict";var g=function(){function a(){this.userSetToOffline=!1,this.applicationEvents=c.resolve(d)}return a.prototype.getManualOfflineStatus=function(){return this.userSetToOffline},a.prototype.setManualOfflineStatus=function(a){this.userSetToOffline=a,this.hasPredixSDKInstalled()?this.queryConnectivity().catch(this.handleConnectivityFailure.bind(null,this)).then(this.handleConnectivityResponse.bind(null,this)):this.applicationEvents.connectionChanged.raise(this,{connected:!this.userSetToOffline})},a.prototype.hasPredixSDKInstalled=function(){return!!window.PredixSDK},a.prototype.queryConnectivity=function(){return new e(function(a,b){window.PredixSDK.queryConnectivity(a,b)})},a.prototype.handleConnectivityResponse=function(a,b){var c=window;a.deviceIsOnline(b)&&(b=a.resetConnectivityWithToggle(a,b)),
c.broadcaster.fireEvent("PredixSDK.ReachabilityChanged",{ReachabilityStatus:b})},a.prototype.deviceIsOnline=function(a){return f.contains("Online",a)},a.prototype.resetConnectivityWithToggle=function(a,b){b=a.getStateAsArray(b);var c=f.indexOf("Online",b);return a.userSetToOffline===!0&&(b[c]="Offline"),b},a.prototype.getStateAsArray=function(a){return"string"==typeof a&&(a=a.split(",")),a},a.prototype.handleConnectivityFailure=function(a){console.log("An error occurred")},a}();return g=__decorate([a.singleton,b.dependsOn(d)],g)});
define('system/http/predix-mobile-ajax-client',["require","exports","system/diagnostics/log-manager","application/application-context","system/mobile/device-connectivity","system/lang/object","ramda"],function(require,exports,a,b,c,d,e){"use strict";var f=a.getLogger("system/http/ajax-client"),g=59900,h={timeout:g,headers:{"Content-Type":"application/json",timeout:g}},i="apm",j="api/core/utility/unauthorizedping",k="",l=function(){function a(){}return a.prototype.baseUrl=function(){return k+i+"/"},a.useSecureConnection=function(a){},a.setServer=function(a){k=a},a.addAjaxOption=function(a,b){var c={};c[a]=b,$.extend(h,c)},a.clearHeaders=function(){},a.prototype.url=function(a){return a=this.trimSlash(a),a=k+i+"/"+a,a=encodeURI(decodeURI(a))},a.prototype.get=function(a,b){return f.info("ajax GET",a),a=this.url(a),m("GET","text",b,{},a)},a.prototype.post=function(a,b,c){return f.info("ajax POST",b,c),a=this.url(a),m("POST","text",c,b,a)},a.prototype.put=function(a,b,c){return f.info("ajax PUT",b,c),a=this.url(a),
m("PUT","text",c,b,a)},a.prototype.delete=function(a,b){return f.info("ajax DELETE",a),a=this.url(a),m("DELETE","text",b,{},a)},a.prototype.getBinary=function(a,b){return f.info("ajax binary GET",a),a=this.url(a),m("GET","blob",b,{},a)},a.isMultiTenant=function(){return!!window.nav},a.prototype.trimSlash=function(a){return a&&"/"===a.charAt(0)&&(a=a.substring(0).slice(1)),a},a}();function m(a,b,f,g,i){var j=$.extend(!0,{},h,f),k=$.Deferred(),l=window,m=new l.PredixRequest(a,i),p=d.resolve(c);return m.responseType=b,q(m,j),m.onComplete=x.bind(null,k.resolve.bind(k),k.reject.bind(k),a,i),m.onError=y.bind(null,k.reject.bind(k),i),m.beforeSend=o(m,p.getManualOfflineStatus()),"GET"===a?m.send():f&&!e.isNil(f.data)?m.send(f.data):m.send(g),n(k,m)}function n(a,b){var c=a.promise();return c.abort=b.abort,c}function o(a,b){return b?p.bind(null,a):null}function p(a){console.log("Aborting"),a.abort(),a.onComplete({statusCode:-1,error:"error"})}function q(a,b){
e.mapObjIndexed(r.bind(null,a),b.headers)}function r(a,b,c){a.setRequestHeader(c,b)}function s(a){return a>=200&&a<300||304===a}function t(a,b,c,d){if(null===b.data||""===b.data)try{c(null,null,a)}catch(a){console.log("error from success callback for url: "+d),console.log("response: "+JSON.stringify(b)),console.log("error: "+a)}else if("string"==typeof b.data)try{c(JSON.parse(b.data),null,a)}catch(a){console.log("error from success callback for url: "+d),console.log("response: "+JSON.stringify(b)),console.log("error: "+a)}else try{c(b.data,null,a)}catch(c){console.log("error from success callback for url: "+d),console.log("response: "+JSON.stringify(b),null,a),console.log("error: "+c)}}function u(a,b,c,d){var e="error";try{console.log("====jqXHR: "+JSON.stringify(a)),console.log("====text: "+e),console.log("====Error thrown "+d+" === "+b),c(a,e,b)}catch(a){console.log("error from fail callback for url: "+d),console.log("error: "+a)}}function v(a){
w(a,j)||(b.connectionStatus.lastResponse=new Date)}function w(a,b){return a.indexOf(b)>-1}function x(a,b,c,d,e){console.log("====SUCCESS "+c+" RESPONSE FROM URL: "+d+" === "+e.data),v(d);var f=s(e.statusCode),g={status:e.statusCode};f===!0?t(g,e,a,d):u(g,e.data,b,d)}function y(a,b,c){console.log("====FAIL RESPONSE FROM URL: "+b+" === "+JSON.stringify(c)),u({status:c.statusCode,statusText:c.error},c.error,a,b)}return l});
define('system/http/binary-transport',['require','jquery'],function(require){"use strict";require("jquery").ajaxTransport("+binary",function(a,b,c){if(window.FormData&&(a.dataType&&"binary"===a.dataType||a.data&&(window.ArrayBuffer&&a.data instanceof ArrayBuffer||window.Blob&&a.data instanceof Blob)))return{send:function(b,c){var d=new XMLHttpRequest,e=a.url,f=a.type,g=a.async||!0,h=a.responseType||"blob",i=a.data||null,j=a.username||null,k=a.password||null;d.addEventListener("load",function(){var b={};b[a.dataType]=d.response,c(d.status,d.statusText,b,d.getAllResponseHeaders())}),d.open(f,e,g,j,k);for(var l in b)b.hasOwnProperty(l)&&d.setRequestHeader(l,b[l]);d.responseType=h,d.send(i)},abort:function(){c.abort()}}})});
define('system/http/ajax-client',["require","exports","lodash","jquery","system/lang/ioc","application/application-events","system/diagnostics/log-manager","system/hardware/device","system/mobile/device-connectivity","system/http/predix-mobile-ajax-client","system/lang/object","./binary-transport"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";require("./binary-transport");var j=k()?59900:3e5;function k(){return!!window.nav}var l=e.getLogger("system/http/ajax-client"),m={contentType:"application/json",dataType:"json",cache:!0,timeout:j,headers:{timeout:j}},n={useSecureConnection:"https:"===location.protocol,server:null},o=function(){function c(){}return c.useSecureConnection=function(a){n.useSecureConnection=a,l.info("connectionOptions.useSecureConnection",a)},c.setServer=function(a){c.useSecureConnection(r(a)),a=v(a),a=w(a),n.server=a,l.info("connectionOptions.server",a)},c.server=function(){return n.server},c.secureConnection=function(){return n.useSecureConnection},c.addHeader=function(a,c){
var d={};d[a]=c,m.headers=m.headers||{},b.extend(m.headers,d),l.info("adding to ajaxOptions.headers",a,c)},c.clearHeaders=function(){m.headers=void 0,l.info("ajaxOptions.headers cleared")},c.headers=function(){return b.extend({},m.headers)},c.promise=function(a,b){var c=a.promise();return c.request={abort:b.abort},c},c.prototype.url=function(a){return q(this,a)},c.prototype.get=function(a,c){a=q(this,a);var d="GET",e=b.extend({},m,{url:a,type:d});return l.info("ajax GET",e.url),y(e,c)},c.prototype.getBinary=function(a,c){a=this.url(a);var d="GET",e="binary",f=!1,g=b.extend({},m,{url:a,type:d,dataType:e,processData:f});return delete g.contentType,l.info("ajax binary GET",g.url),y(g,c)},c.prototype.post=function(c,d,e){c=q(this,c),d=a.isObject(d)?JSON.stringify(d):d;var f="POST",g=b.extend({},m,{url:c,type:f,data:d});return l.info("ajax POST",d,e),y(g,e)},c.prototype.put=function(c,d,e){return l.info("ajax PUT",d,e),c=q(this,c),y(b.extend({},m,{url:c,type:"PUT",
data:a.isObject(d)?JSON.stringify(d):d}),e)},c.prototype.delete=function(a,c){a=q(this,a);var d=b.extend({},m,{url:a,type:"DELETE"});return l.info("ajax DELETE",d.url),y(d,c)},c.isMultiTenant=function(){return k()},c.prototype.protocol=function(){return n.useSecureConnection?"https":"http"},c.prototype.baseUrl=function(){return z(this)},c}();o=__decorate([c.dependsOn(d)],o),o.factory=function(){return p()?new h:new o};function p(){return!!window.PredixSDK}function q(a,b){return b=(new f).isMobileApp()?z(a)+"meridium/"+A(b):A(b)}function r(a){return s(a)?u(a):x()}function s(a){return!!a&&(t(a)||u(a))}function t(a){return a.toLowerCase().indexOf("http://")>-1}function u(a){return a.toLowerCase().indexOf("https://")>-1}function v(a){return a?a.toLowerCase().replace("https://","").replace("http://",""):a}function w(a){return a?a.toString().replace(/\//g,""):a}function x(){return"https:"===location.protocol}function y(a,c){var d=i.resolve(f),e=i.resolve(g)
;return d.isMobile()&&e.getManualOfflineStatus()?b.ajax({beforeSend:function(a){a.abort("error")}}):b.ajax(b.extend({},a,c))}function z(a){return n.server?a.protocol()+"://"+n.server+"/":""}function A(a){return a&&"/"===a.charAt(0)&&(a=a.substring(0).slice(1)),a}return o});
define('system/lang/converter',['require','system/text/parser','globalize'],function(require){"use strict";var a=require("system/text/parser"),b=require("globalize");function c(){}c.prototype.toNullable=function a(b){return b?b:null},c.prototype.toObject=function a(b,c){return b?b:c},c.prototype.toString=function a(b,c){return void 0===b||null===b?void 0!==c?c:"":b.toString()},c.prototype.toNullableString=function a(b){return c.prototype.toString(b,null)},c.prototype.toBoolean=function a(b,c){return void 0!==b&&(b===c||b===!0)},c.prototype.toNullableBoolean=function a(b,c){return void 0!==c||void 0!==b&&null!==b?b===c||b===!0:null},c.prototype.toInteger=function a(b,c){var d=parseInt(b,10);return c=c||0,isNaN(d)?c:d},c.prototype.toFloat=function a(b,c){var d=parseFloat(b);return arguments.length<2&&(c=0),isNaN(d)?c:d},c.prototype.toDate=function a(b,c,e){return d(b,c,e)},c.prototype.toNullableDate=function a(b,c){return d(b,c,null)};function d(b,c,d){return c=c||"yyyy-MM-ddTHH:mm:ss.fff",d=Object.defaultValue(d,null),
null===b||void 0===b?d:b instanceof Date?b:a.parseDate(b,c)||a.parseDate(b,"yyyy-MM-ddTHH:mm:ss.fff")||d}return c.prototype.toDateString=function a(c,d){return d=d||"S",b.format(c,d)},c.prototype.toNullableInteger=function a(b){var c=parseFloat(b);return isNaN(c)?null:c},c.prototype.toNullableFloat=function a(b){return this.toFloat(b,null)},new c});
define('assets/services/hierarchy-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){this.entityKey=a.toString(b.entityKey),this.description=a.toString(b.description),this.familyKey=a.toString(b.familyKey),this.familyId=a.toString(b.familyId),this.siteKey=a.toNullableString(b.siteKey),this.hasChildren=null,b.childCount&&(this.hasChildren=a.toInteger(b.childCount)>0),b.hierarchyPath&&(this.hierarchyPath=a.toString(b.hierarchyPath))}return b.fromDataCollection=function a(c){for(var d=[],e=0;e<c.length;e++)d[d.length]=new b(c[e]);return d},b});
define('assets/services/hierarchy-paging-dto',[],function(){"use strict";function a(a){this.page=a.page||1,this.pageSize=a.per_page||25,this.data=null}return a});
define('assets/services/taxonomy-dto',['require','lodash','system/lang/converter'],function(require){"use strict";var a=require("lodash"),b=require("system/lang/converter");function c(a,c){this.code=b.toString(a),this.description=b.toString(c),this.children=[]}return c.fromDataCollection=function b(d){for(var e=[],f=a.values(a.groupBy(d,"categoryCode")),g,h,i,j,k=0;k<f.length;k++){g=new c(f[k][0].categoryCode,f[k][0].categoryDescription),e[e.length]=g,h=a.values(a.groupBy(f[k],"classCode"));for(var l=0;l<h.length;l++){i=new c(h[l][0].classCode,h[l][0].classDescription),g.children[g.children.length]=i;for(var m=0;m<h[l].length;m++)j=new c(h[l][m].typeCode,h[l][m].typeDescription),i.children[i.children.length]=j}}return e},c});
define('assets/services/asset-context-dto',['require','system/globalization/translator','system/lang/converter'],function(require){"use strict";var a=require("system/globalization/translator"),b=require("system/lang/converter");function c(a){a=a||{},this.entityKey=b.toString(a.entityKey),this.description="-1"===this.entityKey?d("ASSET_HIERARCHY_ROOT"):b.toString(a.description),this.type=b.toString(a.type),this.familyId=b.toString(a.familyId),this.siteKey=b.toString(a.siteKey)}c.fromDataCollection=function a(b){for(var d=[],e=0;e<b.length;e++)d[d.length]=new c(b[e]);return d},c.fromHierarchyDTO=function a(b){return b?new c({entityKey:b.entityKey,description:b.description,type:"Hierarchy",familyId:b.familyId,siteKey:b.siteKey}):c.default()},c.fromGroupDTO=function a(b){return new c(b?{entityKey:b.entityKey,description:b.groupid,type:"Group",siteKey:b.siteKey}:{type:"Group"})},c.default=function a(b){var e=d("ASSET_HIERARCHY_ROOT");return new c({entityKey:b||"-1",description:e,type:"Hierarchy"})};function d(b){return Object.resolve(a).translate(b)}return c});
define('assets/models/family',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.id=a.toString(b.id),this.caption=a.toString(b.caption)}return b.fromDataCollection=function a(c){var d,e=[];for(d=0;d<c.length;d++)e[d]=new b(c[d]);return e},b});
define('assets/models/field',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){this.key=a.toString(b.key),this.caption=a.toString(b.caption)}return b});
define('system/collections/list',["require","exports","jquery","knockout","system/lang/object"],function(require,exports,a,b,c){"use strict";return function(){function d(a){void 0===a&&(a=[]),this.items=a}return d.indexOf=function(b,c){var d=-1;return a.isArray(b)===!1?d:(a.each(b,function(a,b){if(c(b,a)===!0)return d=a,!1}),d)},d.sort=function(a,c,d,e){function f(a,b){return a&&b||!a&&!b?0:a?1:-1}function g(a,b){return a===b?0:a<b?-1:1}function h(a,b){var c=a.toString().toLocaleLowerCase(),d=b.toString().toLocaleLowerCase();return c===d?0:c<d?-1:1}function i(a,i){var j=b.utils.unwrapObservable(d?a[d]:a),k=b.utils.unwrapObservable(d?i[d]:i);e=e||typeof j;var l;switch(e){case"boolean":l=f(j,k);break;case"number":l=j-k;break;case"datetime":l=g(j,k);break;default:l=h(j,k)}return c||(l=0-l),l}a.sort(i)},d.fillArray=function(a,b,c){for(;b--;)a[b]=c;return a},d.prototype.count=function(){return this.items.length},d.prototype.add=function(a){this.items[this.count()]=a},d.prototype.item=function(a){
return a<0&&(a+=this.count()),this.items[a]},d.prototype.clear=function(){this.items.length=0},d.prototype.indexOf=function(a){return this.items.indexOf(a)},d.prototype.contains=function(a){return this.indexOf(a)!==-1},d.prototype.addRange=function(a){a.forEach(this.add,this)},d.prototype.forEach=function(a,b){for(var c=0;c!==this.count();c++)a.call(b,this.item(c),c,this)},d.prototype.map=function(a,b){for(var d=c.resolve(this.constructor),e=0;e!==this.count();e++)d.add(a.call(b,this.item(e),e,this));return d},d.prototype.take=function(a){var b;return b=a>=0?this.items.slice(0,a):this.items.slice(a),c.resolve(this.constructor,b)},d.prototype.shift=function(){return this.items.shift()},d.prototype.pop=function(){return this.items.pop()},d.prototype.moveToEnd=function(a){this.remove(a),this.add(a)},d.prototype.remove=function(a){var b=this.indexOf(a);b!==-1&&this.items.splice(b,1)},d.prototype.createArrayIndex=function(a,b){var c={};if(a)for(var d=0;d<a.length;d++)c[a[d][b]]=a[d]
;return c},d}()});
define('system/collections/observable-list',["require","exports","knockout"],function(require,exports,a){"use strict";return function(){function b(b){void 0===b&&(b=[]),this.items=a.observableArray(b)}return b.prototype.count=function(){return this.items().length},b.prototype.item=function(a){return this.items()[a]},b.prototype.add=function(a){this.items.push(a)},b.prototype.remove=function(a){return this.items.remove(a)},b.prototype.clear=function(){this.items([])},b.prototype.indexOf=function(a){return this.items.indexOf(a)},b.prototype.moveUp=function(a){var b=this.items.indexOf(a);0!==b&&(this.items()[b]=this.items()[b-1],this.items()[b-1]=a,this.items.valueHasMutated())},b.prototype.moveDown=function(a){var b=this.items.indexOf(a);b!==this.items().length-1&&(this.items()[b]=this.items()[b+1],this.items()[b+1]=a,this.items.valueHasMutated())},b.prototype.dispose=function(){this.items([])},b}()});
define('system/knockout/change-tracker',["require","exports","knockout","ramda"],function(require,exports,a,b){"use strict";var c=function(){function b(b,c,f){void 0===c&&(c=a.toJSON),void 0===f&&(f=!1),this.hashFunction=c,this.objectToTrack=b,this.lastCleanState=a.observable(),f||this.lastCleanState(e(this)),this.isDirty=a.computed(d.bind(null,this))}return b.prototype.markCurrentStateAsClean=function(){this.lastCleanState(e(this))},b.prototype.dispose=function(){this.isDirty.dispose(),this.lastCleanState(null)},b}();function d(a){return e(a)!==a.lastCleanState()}function e(a){var c=a.hashFunction.apply(a.objectToTrack);return b.is(Object,c)?JSON.stringify(c):c}return c});
define('system/lang/functional',['require','ramda'],function(require){"use strict";var a=require("ramda");function b(){}function c(b,c){return a.is(Function,c[b])?c[b]():c[b]}function d(a,b){return console[a](b),b}function e(a){return a}function f(){return Array.prototype.join.call(arguments,"")}function g(b){if(a.is(Function,b)){var c=Array.prototype.slice.call(arguments,1);return setTimeout(function(){b.apply(void 0,c)},1)}}var h=a.either(a.identity,function(){return{}}),i=a.either(a.identity,function(){return[]});return{noop:b,identity:a.identity,areSame:a.identical,result:a.curry(c),log:d.bind(null,"log"),trace:d.bind(null,"trace"),warn:d.bind(null,"warn"),error:d.bind(null,"error"),debug:e,str:f,defer:g,defaultToObject:h,defaultToArray:i}});
define('system/knockout/knockout-manager',["require","exports","knockout","system/collections/list","system/collections/observable-list","./change-tracker","system/lang/functional"],function(require,exports,a,b,c,d){"use strict";var e=require("system/lang/functional");return function(){function f(a){void 0===a&&(a=e.noop),this.observables=new b,this.computeds=new b,this.subscriptions=new b,this.tracker=new d(this,a),this.isDirty=this.tracker.isDirty}return f.prototype.observable=function(){var b=a.observable.apply(null,Array.prototype.splice.call(arguments,0));return this.observables.add(b),b},f.prototype.observableArray=function(){var b=a.observableArray.apply(null,Array.prototype.splice.call(arguments,0));return this.observables.add(b),b},f.prototype.observableList=function(a){var b=new c(a);return this.observables.add(b),b},f.prototype.computed=function(b){var c=a.computed.apply(null,Array.prototype.splice.call(arguments,0));return this.computeds.add(c),c},f.prototype.pureComputed=function(b){
var c=a.pureComputed.apply(null,Array.prototype.splice.call(arguments,0));return this.computeds.add(c),c},f.prototype.subscribe=function(a,b,c,d){var e=a.subscribe(b,c,d);return this.subscriptions.add(e),e},f.prototype.dispose=function(){this.disposeSubscriptions(),this.disposeComputeds(),this.disposeObservables(),this.tracker.dispose()},f.prototype.disposeSubscriptions=function(){this.subscriptions.forEach(function(a){a.dispose()}),this.subscriptions.clear()},f.prototype.disposeComputeds=function(){this.computeds.forEach(function(a){a.dispose()}),this.computeds.clear()},f.prototype.disposeObservables=function(){this.observables.forEach(function(a){a.dispose?a.dispose():a(null)}),this.observables.clear()},f.prototype.createHash=function(){return this.observables.items.map(function(a){return a()})},f}()});
define('assets/models/hierarchy-configuration',['require','system/lang/converter','assets/models/family','assets/models/field','system/knockout/knockout-manager'],function(require){"use strict";var a=require("system/lang/converter"),b=require("assets/models/family"),c=require("assets/models/field"),d=require("system/knockout/knockout-manager");function e(e){var h,i;if(e=e||{},this.kom=Object.resolve(d),this.entityKey=a.toString(e.entityKey),this.displayFieldKey=this.kom.observable(a.toString(e.displayFieldKey)),this.parentDisplayFieldKey=this.kom.observable(a.toString(e.parentDisplayFieldKey)),this.parentKey=this.kom.observable(a.toString(e.parentKey)),this.childKey=this.kom.observable(a.toString(e.childKey)),i=[],e.children)for(h=0;h<e.children.length;h++)i[i.length]=new b(e.children[h]);if(this.children=this.kom.observableArray(i),this.relationshipKey=this.kom.observable(a.toString(e.relationshipKey)),i=[],e.relationships)for(h=0;h<e.relationships.length;h++)i[i.length]=new b(e.relationships[h]);if(this.relationships=this.kom.observableArray(i),this.taxonomyCategoryFieldKey=this.kom.observable(a.toString(e.taxonomyCategoryFieldKey)),
this.parentTaxonomyCategoryFieldKey=this.kom.observable(a.toString(e.parentTaxonomyCategoryFieldKey)),this.taxonomyClassFieldKey=this.kom.observable(a.toString(e.taxonomyClassFieldKey)),this.parentTaxonomyClassFieldKey=this.kom.observable(a.toString(e.parentTaxonomyClassFieldKey)),this.taxonomyTypeFieldKey=this.kom.observable(a.toString(e.taxonomyTypeFieldKey)),this.parentTaxonomyTypeFieldKey=this.kom.observable(a.toString(e.parentTaxonomyTypeFieldKey)),this.level=this.kom.observable(a.toInteger(e.level)),i=[],e.fields)for(h=0;h<e.fields.length;h++)i[i.length]=new c(e.fields[h]);if(this.fields=this.kom.observableArray(i),i=[],e.parentFields)for(h=0;h<e.parentFields.length;h++)i[i.length]=new c(e.parentFields[h]);this.parentFields=this.kom.observableArray(i),this.isNotRecursive=this.kom.computed(g.bind(null,this)),this.kom.tracker.hashFunction=f.bind(null,this),this.kom.tracker.markCurrentStateAsClean()}e.prototype.isDirty=function(){return this.kom.isDirty()},
e.prototype.markClean=function(){this.kom.tracker.markCurrentStateAsClean()},e.prototype.dispose=function(){this.kom.dispose()};function f(a){var b;return b={level:a.level(),displayField:a.displayFieldKey(),parentFamilyKey:a.parentKey(),childFamilyKey:a.childKey(),relationshipKey:a.relationshipKey(),taxonomyCategeoryField:a.taxonomyCategoryFieldKey(),taxonomyClassField:a.taxonomyClassFieldKey(),taxonomyTypeField:a.taxonomyTypeFieldKey(),parentDisplayField:a.parentDisplayFieldKey(),parentTaxonomyCategeoryField:a.parentTaxonomyCategoryFieldKey(),parentTaxonomyClassField:a.parentTaxonomyClassFieldKey(),parentTaxonomyTypeField:a.parentTaxonomyTypeFieldKey()},JSON.stringify(b)}function g(a){return 0===a.level()&&a.parentKey()!==a.childKey()}return e});
define('assets/models/hierarchy-config-dto',[],function(){"use strict";function a(a){a=a||{},this.entityKey=a.entityKey,this.displayFieldKey=a.displayFieldKey(),this.parentKey=a.parentKey(),this.childKey=a.childKey(),this.relationshipKey=a.relationshipKey(),this.taxonomyCategoryFieldKey=a.taxonomyCategoryFieldKey(),this.taxonomyClassFieldKey=a.taxonomyClassFieldKey(),this.taxonomyTypeFieldKey=a.taxonomyTypeFieldKey(),this.level=a.level(),this.parentDisplayFieldKey=a.parentDisplayFieldKey(),this.parentTaxonomyCategoryFieldKey=a.parentTaxonomyCategoryFieldKey(),this.parentTaxonomyClassFieldKey=a.parentTaxonomyClassFieldKey(),this.parentTaxonomyTypeFieldKey=a.parentTaxonomyTypeFieldKey()}return a});
define('assets/adapters/hierarchy-config-adapter',['require','assets/models/hierarchy-configuration','assets/models/hierarchy-config-dto'],function(require){"use strict";var a=require("assets/models/hierarchy-configuration"),b=require("assets/models/hierarchy-config-dto");function c(){}return c.fromDTOArray=function(b){var c,d,e=[];for(c=0;c<b.length;c++)d=new a(b[c]),e[e.length]=d;return e},c.toDTO=function(a){return new b(a)},c});
define('assets/services/hierarchy-service',['require','jquery','system/http/ajax-client','assets/services/hierarchy-dto','assets/services/hierarchy-paging-dto','assets/services/taxonomy-dto','assets/services/asset-context-dto','assets/adapters/hierarchy-config-adapter','assets/models/family','assets/models/field','system/globalization/translator','application/application-context'],function(require){"use strict";var a=require("jquery"),b=require("system/http/ajax-client"),c=require("assets/services/hierarchy-dto"),d=require("assets/services/hierarchy-paging-dto"),e=require("assets/services/taxonomy-dto"),f=require("assets/services/asset-context-dto"),g=require("assets/adapters/hierarchy-config-adapter"),h=require("assets/models/family"),i=require("assets/models/field"),j=require("system/globalization/translator"),k=require("application/application-context"),l="api/common/assethierarchy/",m="MI_AST_GRP",n="api/core/userpref",o="asset-hierarchy-key",p=7;function q(a,b){this.ajaxClient=a,this.request=null,this.translator=b}q.dependsOn=[b,j],q.prototype.get=function(){var b=a.Deferred();return this.ajaxClient.get(l).done(A.bind(null,b)).fail(b.reject.bind(b)),b},q.prototype.children=function b(c,d,e,f,g,h){var i=a.Deferred(),j=l+"children";return c&&(j+="/"+c.toString()),
j+="?taxonomyCategory="+d+"&taxonomyClass="+e+"&taxonomyType="+f+"&page="+g+"&pageSize="+h,this.request=this.ajaxClient.get(j),this.request.done(v.bind(null,this,i)),this.request.fail(t.bind(null,i)),i.promise()},q.prototype.childrenFilteredBySites=function(b,c,d,e,f,g,h){var i=a.Deferred(),j=l+"children";return b&&(j+="/"+b.toString()),j+="?taxonomyCategory="+c+"&taxonomyClass="+d+"&taxonomyType="+e+"&page="+f+"&pageSize="+g,this.request=this.ajaxClient.post(j,h),this.request.done(v.bind(null,this,i)),this.request.fail(t.bind(null,i)),i.promise()},q.prototype.search=function b(c,d,e){var f=a.Deferred(),g=l;return g+="search?term="+encodeURIComponent(c)+"&page="+d+"&pageSize="+e,this.ajaxClient.get(g).done(w.bind(null,this,f)).fail(f.reject.bind(f)),f.promise()},q.prototype.searchFilteredBySites=function(b,c,d,e){var f=a.Deferred(),g=l;return g+="search?term="+encodeURIComponent(b)+"&page="+c+"&pageSize="+d,this.ajaxClient.post(g,e).done(w.bind(null,this,f)).fail(f.reject.bind(f)),
f.promise()},q.prototype.assets=function b(c,d){var e,f=a.Deferred(),g=l+"assets/"+c.toString();if(d&&d.length>0)for(e=0;e<d.length;e++)g+=(0===e?"?":"&")+"families="+d[e].toString();return this.ajaxClient.get(g).done(u.bind(null,f)).fail(f.reject.bind(f)),f.promise()},q.prototype.assetsFilteredBySites=function b(c,d){var e=a.Deferred(),f=l+"assets/"+c.toString();return this.ajaxClient.post(f,d).done(u.bind(null,e)).fail(e.reject.bind(e)),e.promise()},q.prototype.abort=function a(){this.request&&this.request.abort()},q.prototype.taxonomy=function b(){var c=a.Deferred();return this.ajaxClient.get(l+"taxonomy").done(x.bind(null,c)).fail(c.reject.bind(c)),c.promise()},q.prototype.path=function b(c){var d=a.Deferred();return c&&"-1"!==c&&"0"!==c?(this.request=this.ajaxClient.get(l+"path/"+c),this.request.done(y.bind(null,this,d)),this.request.fail(d.reject.bind(d)),d.promise()):(setTimeout(y.bind(null,this,d,[]),0),d.promise())},q.prototype.pathAll=function b(c,d){
var e=a.Deferred(),f=l+"pathAll/"+d;return this.ajaxClient.post(f,c).done(z.bind(null,this,e)).fail(e.reject.bind(e)),e.promise()},q.prototype.families=function(){var b=a.Deferred();return this.ajaxClient.get(l+"families").done(B.bind(null,b)).fail(b.reject.bind(b)),b.promise()},q.prototype.relationships=function(b){var c=a.Deferred();return this.ajaxClient.get(l+"families/"+b.toString()).done(B.bind(null,c)).fail(c.reject.bind(c)),c.promise()},q.prototype.getPartialFamily=function(b){var c=a.Deferred();return this.ajaxClient.get(l+"family/"+b.toString()).done(D.bind(null,c)).fail(c.reject.bind(c)),c.promise()},q.prototype.relationshipsById=function(){var b=a.Deferred();return this.ajaxClient.get(l+"families/"+m).done(B.bind(null,b)).fail(b.reject.bind(b)),b.promise()},q.prototype.relatedFamilies=function(b,c){var d=l+"families/"+b.toString()+"/"+c.toString(),e=a.Deferred();return this.ajaxClient.get(d).done(B.bind(null,e)).fail(e.reject.bind(e)),e.promise()},
q.prototype.familyFields=function(b){var c=a.Deferred();return this.ajaxClient.get(l+"families/"+b.toString()+"/fields").done(C.bind(null,c)).fail(c.reject.bind(c)),c.promise()},q.prototype.updateConfiguration=function(a){return this.ajaxClient.put(l,a)},q.prototype.rebuild=function(){return this.ajaxClient.post(l+"rebuild")},q.prototype.storeAssetHierarchyKey=function(a){return this.ajaxClient.post(n+"/set",r(a))};function r(a){return{userKey:s(),prefType:p,name:o,value:a}}function s(){return k.user.key}function t(a,b,c,d){"abort"!==c&&a.reject(b,c,d)}function u(a,b){a.resolve(c.fromDataCollection(b))}function v(a,b,e){var f;a.request=null,f=new d(e),f.data=c.fromDataCollection(e.data),b.resolve(f)}function w(a,b,e){var f;f=new d(e),f.data=c.fromDataCollection(e.data),b.resolve(f)}function x(a,b){a.resolve(e.fromDataCollection(b))}function y(a,b,c){var d=f.fromDataCollection(c);d.unshift({description:a.translator.translate("ASSET_HIERARCHY_ROOT"),entityKey:"-1"}),b.resolve(d)}
function z(a,b,c){b.resolve(f.fromDataCollection(c))}function A(a,b){a.resolve(g.fromDTOArray(b))}function B(a,b){var c,d=[];for(c=0;c<b.length;c++)d[d.length]=new h(b[c]);a.resolve(d)}function C(a,b){var c,d=[];for(c=0;c<b.length;c++)d[d.length]=new i(b[c]);a.resolve(d)}function D(a,b){var c={},d=0;for(c.relationships=[],c.parentFields=[],d=0;d<b.parentFields.length;d++)c.parentFields[c.parentFields.length]=new i(b.parentFields[d]);for(d=0;d<b.relationships.length;d++)c.relationships[c.relationships.length]=new h(b.relationships[d]);a.resolve(c)}return q});
define('assets/services/asset-context-service',['require','lodash','jquery','system/http/ajax-client','assets/services/asset-context-dto','application/application-context'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/http/ajax-client"),d=require("assets/services/asset-context-dto"),e=require("application/application-context"),f="api/common/assetcontext/";function g(a){this.ajaxClient=a,this.request=null}g.dependsOn=[c],g.prototype.getcontext=function c(d){var e=b.Deferred();return this.request&&this.abort(),d&&"-1"!==d&&"0"!==d?this.request=this.ajaxClient.get(f+d).done(k.bind(null,this,e)).fail(l.bind(null,this,e)):(this.request="home",a.defer(j,this,e,"-1")),e.promise()},g.prototype.abort=function(){this.request&&this.request.abort?this.request.abort():"home"===this.request&&(this.request="home-abort")},g.prototype.getAssetContextPreference=function(){var a=f+"preference/"+i(),c=b.Deferred();return this.ajaxClient.get(a).done(k.bind(null,this,c)).fail(l.bind(null,this,c)),c.promise()},g.prototype.getAssetContextAppHub=function(){var a=f+"apphub/"+i(),c=b.Deferred()
;return this.ajaxClient.get(a).done(h.bind(null,c)).fail(l.bind(null,this,c)),c.promise()};function h(a,b){return a.resolve(b)}g.prototype.setAssetContextAppHub=function(a){var c=f+"apphub/"+a,d=b.Deferred();return this.ajaxClient.put(c).done(k.bind(null,this,d)).fail(l.bind(null,this,d)),d.promise()};function i(){return e.user.key}function j(a,b,c){"home-abort"!==a.request&&b.resolve(d.default(c)),a.request=null}function k(a,b,c){a.request=null,b.resolve(new d(c))}function l(a,b,c,e){a.request=null,404===c.status?b.resolve(d.default()):"abort"!==e&&b.reject()}return g});
define('app-hub/global/app-hub-application-context',["require","exports","system/lang/ioc","application/application-context"],function(require,exports,a,b){"use strict";var c="meridium-app-hub-asset-context",d=function(){function a(){this.getAssetContext=g,this.setAssetContext=h,this.getActiveRoute=i}return a}();d=__decorate([a.singleton],d);function e(a){sessionStorage.setItem(c,a)}function f(){return sessionStorage.getItem(c)?sessionStorage.getItem(c):{}}function g(){return JSON.parse(f())}function h(a){e(a?JSON.stringify(a):null)}function i(){return b.navigation.activeRoute?b.navigation.activeRoute:""}return d});

define('text!assets/views/asset-hierarchy-control-filter.html',[],function () { return '<div class="filter-trigger-container">\r\n    <button class="btn btn-default btn--bare actionable actionable--secondary filter-trigger-btn">\r\n        <i class="icon-collection-filter"></i>\r\n        <span class="filter-txt label--inline" for="filter-icon">Filter</span>\r\n    </button>\r\n    <button class="ahc-filters-clear-btn pull-right hide">Clear</button>\r\n</div>\r\n<div class="uacb-filter-popup hide"></div>';});

define('assets/asset-hierarchy-control-filter',['require','jquery','assets/services/hierarchy-service','spa/ko/knockout-view-model','system/knockout/knockout-manager','system/globalization/translator','text!./views/asset-hierarchy-control-filter.html'],function(require){"use strict";var a=require("jquery"),b=require("assets/services/hierarchy-service"),c=require("spa/ko/knockout-view-model"),d=require("system/knockout/knockout-manager"),e=require("system/globalization/translator"),f=require("text!./views/asset-hierarchy-control-filter.html");function g(a,c,g){h.call(this,f),this.service=Object.resolve(b),this.translator=Object.resolve(e),this.categories=null,this.classes=null,this.types=null,this.currentCategory=a,this.currentClass=c,this.currentType=g,this.kom=Object.resolve(d)}var h=Object.inherit(c,g);g.prototype.load=function a(){this.categories=this.kom.observableArray(),this.classes=this.kom.computed(m.bind(null,this)),this.types=this.kom.computed(n.bind(null,this)),this.service.taxonomy().done(l.bind(null,this))},g.prototype.attach=function b(c){c.attach(a(f)),h.prototype.attach.call(this,c),c.element.querySelector(".apply").addEventListener("click",this),c.$element.addClass("asset-hierarchy-filter-popover")},
g.prototype.detach=function(a){a.element.querySelector(".apply").removeEventListener("click",this),h.prototype.detach(a)},g.prototype.unload=function a(){this.kom.dispose()},g.prototype.translate=function a(b){return this.translator.translate(b)},g.prototype.handleEvent=function b(c){"click"===c.type&&c.target.classList.contains("apply")&&(a(".hierarchy-control-filter")[0].closeFilter(),a(".hierarchy-control-filter").trigger("filter-closed"))};function i(a,b){var c,d;for(c=a.currentCategory().code,d=0;d<b.length;){if(b[d].code===c){a.currentCategory(b[d]);break}d++}}function j(a){var b,c,d;for(b=a.currentCategory(),c=a.currentClass().code,d=0;d<b.children.length;){if(b.children[d].code===c){a.currentClass(b.children[d]);break}d++}}function k(a){var b,c,d;for(b=a.currentClass(),c=a.currentType().code,d=0;d<b.children.length;){if(b.children[d].code===c){a.currentType(b.children[d]);break}d++}}function l(a,b){a.currentCategory()&&i(a,b),a.currentClass()&&j(a),a.currentType()&&k(a),
a.categories(b)}function m(a){return a.currentCategory()?a.currentCategory().children:[]}function n(a){return a.currentClass()?a.currentClass().children:[]}return g});

define('text!assets/views/asset-hierarchy-control.html',[],function () { return '<asset-hierarchy-control data-bind="attr:{enableMultiSelect:settings.multiSelect}"></asset-hierarchy-control>\r\n';});


define('text!assets/views/asset-hierarchy-control-search.html',[],function () { return '<input placeholder="Search" type="text" class="ahc-search-input text-input" />\r\n<i class="ahc-search-icon icon-global-search"></i>\r\n<i class="ahc-search-clear-icon icon-multiply icon-close hide"></i>';});

define('ui/elements/list-group-item/view-model',['system/globalization/translator'],function(){"use strict";var a=require("system/globalization/translator"),b=Object.create(HTMLElement.prototype);b.createdCallback=function(){var b,d,e,f,g;this.translator=Object.resolve(a),this.className="list-group-item",b=document.createElement("div"),b.classList.add("background-div"),this.appendChild(b),d=document.createElement("div"),d.classList.add("block-group"),d.classList.add("mi-li-body"),this.appendChild(d),e=document.createElement("div"),e.setAttribute("name","selector"),d.appendChild(e),l(this),e=document.createElement("div"),g=document.createElement("span"),f=document.createElement("span"),g.setAttribute("name","text"),f.setAttribute("name","custom-icon"),g.classList.add("system-ellipsis-text"),e.appendChild(f),e.appendChild(g),d.appendChild(e),this._listItemIcon=f,m(this),c(this)},b.attachedCallback=function(){this.querySelector(".mi-li-body").addEventListener("click",this)},b.attributeChangedCallback=function(a,b,c){
"selector"===a||"multiselect"===a||"radio-child-only"===a?l(this):"checked"===a?r(this,c):"description"===a&&this.value?q(this):"icon-class"===a?s(this,c):"has-children"===a?m(this):"use-html"===a?q(this):"disabled"===a?n(this,c):"disabledicon"===a&&o(this,c)},b.handleEvent=function(a){"click"===a.type?t(this,a):"change"===a.type&&u(this,a)};function c(a){a._value=null,Element.defineProperty(a,"value",{get:f.bind(null,a),set:g.bind(null,a)}),Element.defineProperty(a,"listItemIcon",{get:d.bind(null,a),set:e.bind(null,a)})}function d(a){return a._listItemIcon}function e(a,b){}function f(a){return a._value}function g(a,b){a._value=b,q(a),m(a)}function h(a,b,c){var d=document.createElement("span"),e=document.createElement("input");"true"===a.getAttribute("multiselect")?(e.type="checkbox",d.classList.add("custom-checkbox")):e=i(a,e),a.getAttribute("checked")?e.checked="true"===a.getAttribute("checked"):e.checked=!1,e.setAttribute("selector",!0),b.appendChild(d),b.appendChild(e),
c.classList.add("selector-seperator")}function i(a,b){var c=!!a.querySelector("i.icon-right-arrow"),d=a.getAttribute("radio-child-only");return b=j(b),d&&c&&(b.style.visibility="hidden"),b}function j(a){return a.type="radio",a.name="list-group-radio",a}function k(a,b,c){var d=document.createElement("i");d.className="icon-plus",d.title=a.translator.translate("ADD_ASSET"),b.appendChild(d),c.classList.add("selector-seperator")}function l(a){var b=a.getAttribute("selector"),c,d=a.querySelector('[name="selector"]'),e=a.querySelector('[name="text"]');d.hasChildNodes()&&(c=d.querySelector("input"),c&&c.removeEventListener("checked",a),d.innerHTML=""),"toggle"===b?h(a,d,e):"addOnly"===b&&k(a,d,e)}function m(a){var b,c,d,e,f=a.querySelector(".mi-li-body");c=a.getAttribute("has-children"),c?"true"===c?d=!0:(e=a.value[c],d=e instanceof Function?e():e):d=!1,d&&!f.querySelector('i[name="icon"]')?(b=document.createElement("i"),b.className=a.getAttribute("icon-class"),
b.title=a.translator.translate("EXPAND"),b.setAttribute("name","icon"),f.appendChild(b)):d||(b=f.querySelector('i[name="icon"]'))&&f.removeChild(b)}function n(a,b){b===!0||"true"===b?a.classList.add("disabled"):b!==!1&&"false"!==b||a.classList.remove("disabled")}function o(a,b){b===!0||"true"===b?a.classList.add("disabledIcon"):b!==!1&&"false"!==b||a.classList.remove("disabledIcon")}function p(a){var b,c=a.querySelector(".mi-li-body");c.querySelector('i[name="icon"]')||(b=document.createElement("i"),b.className=a.getAttribute("icon-class"),b.setAttribute("name","icon"),c.appendChild(b))}function q(a){var b,c,d=a.getAttribute("description")||"description",e=a.getAttribute("use-html");a.value&&(b=a.value[d],c=b instanceof Function?b.call(a.value):b,e?a.querySelector('[name="text"]').innerHTML=c:a.querySelector('[name="text"]').textContent=c)}function r(a,b){var c=a.querySelector('[name="selector"] input');c&&(c.checked="false"!==b,
c.checked?c.previousSibling.classList.add("checked"):c.previousSibling.classList.remove("checked"))}function s(a,b){var c=a.querySelector('[name="icon"]');null!==c?c.className=b:(p(a),c=a.querySelector('[name="icon"]'),c.className=b)}function t(a,b){var c;if(b.cancelBubble=!0,b.preventDefault=!0,c=new CustomEvent("click",{bubbles:!0,cancelable:!0}),"selector"===b.target.getAttribute("name")||"selector"===b.target.parentElement.getAttribute("name"))if("INPUT"===b.target.tagName)"radio"!==b.target.getAttribute("type")&&"checkbox"!==b.target.getAttribute("type")||(c.selecting=b.target.checked);else if("I"===b.target.tagName){if("true"===a.getAttribute("disabledicon"))return;c.selecting=!0}a.dispatchEvent(c)}function u(a,b){var c,d;c=b.target.checked,a.setAttribute("checked",b.target.checked),d=b.target.checked,c!==d&&(b.target.checked=c)}return document.registerElement("mi-li",{prototype:b}),b});
define('ui/elements/searchbox/view-model',['lodash','jquery','system/globalization/translator'],function(){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/globalization/translator"),d=Object.create(HTMLElement.prototype),e=["key","description","page","page-size","scroll-percent","use-html","multiselect","selector"];d.createdCallback=function(){var b;this.classList.add("btn"),this.classList.add("btn-icon"),b=document.createElement("i"),b.className="icon-search",this.appendChild(b),this.search=a.debounce(q,500),this._searchDiv=null,this._searchList=null,this._value="",Element.defineProperty(this,"value",{get:o.bind(null,this),set:p.bind(null,this)}),this._closeSearchBind=this.closeSearch.bind(this),this._resizeBind=i.bind(null,this),this.isInToolbar=!1,this.disabled=!1,this.translator=null},d.attachedCallback=function(){this.addEventListener("click",this),window.addEventListener("resize",this._resizeBind),this.translator=Object.resolve(c),this.title=f(this,"SEARCH")},d.detachedCallback=function(){this._searchDiv&&j(this),
window.removeEventListener("resize",this._resizeBind),this.isInToolbar&&this._searchList&&k(this)},d.handleEvent=function(a){"input"===a.type?(this._value=a.target.value,n(this)):"click"===a.type&&"I"===a.target.tagName&&(a.target.classList.contains("icon-multiply")?r(this):a.target.classList.contains("icon-search")&&!this.disabled&&(w(this,a),g(this)))},d.attributeChangedCallback=function(b,c,d){var f;"delay"===b?this.search=a.debounce(q,d):"disabled"===b?this.disabled="true"===d:this.searchDiv&&(f=this.searchDiv.querySelector(".search-list"))&&e.indexOf(b)>-1&&f.setAttribute(b,d)},d.closeSearch=function(a){if(""===this._value)if(this._searchList&&"none"!==b(this._searchList).css("display")){if(a.target===this._searchDiv.querySelector("input"))return;this._searchDiv&&""===this._searchDiv.querySelector("input").value&&(j(this),k(this))}else{
if(a&&"blur"!==a.type&&(a.target===this||a.target.parentElement===this||a.target===this._searchDiv||a.target.parentElement===this._searchDiv))return;j(this)}},d.toggleEnabled=function(a){var b=this.querySelector("Search");b.disabled="true"===a},d.toggleSearch=function(){g(this)};function f(a,b){return a.translator.translate(b.toUpperCase())}function g(a){var b;a._searchDiv||a.isInToolbar&&a._searchList?(r(a),j(a),k(a)):(a._searchDiv=document.createElement("div"),a._searchDiv.className="mi-searchbox","MI-TOOL-BAR"!==a.parentElement.tagName?a.parentElement.appendChild(a._searchDiv):a.parentElement.parentElement.insertBefore(a._searchDiv,a.parentElement.nextElementSibling),b=document.createElement("input"),b.setAttribute("type","text"),b.className="form-control mi-searchbox",b.value=a.value,b.addEventListener("blur",a._closeSearchBind),a._searchDiv.appendChild(b),b.focus(),b=document.createElement("i"),b.className="icon-multiply",a._searchDiv.appendChild(b),b.addEventListener("click",a),
"true"!==a.getAttribute("custom-search")&&(b=document.createElement("mi-list-group"),Element.upgrade(b),b.classList.add("search-list"),b.classList.add("dropdown-menu-left"),s(a,b),b.loader=t.bind(null,a),"MI-TOOL-BAR"!==a.parentElement.tagName?a._searchDiv.appendChild(b):(a.isInToolbar=!0,a._searchDiv.parentElement.insertBefore(b,a._searchDiv.nextElementSibling),a._searchList=b,a._searchList.searchResult=a._searchList.parentElement.searchResult,h(a,b)),i(a)),m(a),l(a),a._searchDiv.addEventListener("input",a))}function h(a){a._searchList.addEventListener("click",function(b){b.target===this?g(a):"MI-LI"===b.target.tagName&&w(a,b)})}function i(a){var c;"true"!==a.getAttribute("custom-search")&&(c=a.parentElement)&&("MI-TOOL-BAR"===c.nodeName&&(c=c.parentElement),a._searchDiv&&(a.isInToolbar?a._searchList&&(a._searchList.style.height=(c.clientHeight-77).toString()+"px",b(a._searchList).css("position","absolute"),"relative"===b(c).css("position")?(b(a._searchList).css("top",77),
b(a._searchList).css("left",0)):(b(a._searchList).css("top",b(c).position().top+77),b(a._searchList).css("left",b(c).position().left)),a._searchList.style.width=c.clientWidth.toString()+"px"):(a._searchList=a._searchDiv.querySelector(".search-list"),a._searchList.style.height=(c.clientHeight-46-35).toString()+"px")))}function j(a){a._searchDiv&&(a._searchDiv.removeEventListener("click",a),a._searchDiv.removeEventListener("input",a),a._searchDiv.querySelector("input").removeEventListener("blur",a._closeSearchBind),Element.clearDom(a._searchDiv),a._searchDiv.parentElement.removeChild(a._searchDiv),a._searchDiv=null,l(a))}function k(a){a._searchList&&(a._searchList.removeEventListener("click",a),Element.clearDom(a._searchList),b(a._searchList).remove(),a._searchList=null,l(a))}function l(a){var b=new CustomEvent("resize",{bubbles:!0});b.open=null!==a._searchDiv,a.dispatchEvent(b)}function m(a){
a.value.length>0?a._searchDiv.querySelector("i").style.display="inline-block":a._searchDiv.querySelector("i").style.display="none"}function n(a){m(a),a.search(a)}function o(a){return a._value}function p(a,b){a._value=b||"",""===a._value||a._searchDiv||g(a),a._searchDiv&&(a._searchDiv.querySelector("input").value=a._value,n(a))}function q(a){var b;a.searchCallback&&a._searchDiv&&("true"===a.getAttribute("custom-search")?(b=a._searchDiv.querySelector("input"),a.searchCallback(b.value)):(a._searchList.value=null,a._searchList.reload()))}function r(a){a.value="",q(a),a._searchDiv.querySelector(".mi-searchbox input").focus()}function s(a,b){var c,d;for(c=0;c<e.length;c++)(d=a.getAttribute(e[c]))&&b.setAttribute(e[c],d)}function t(a,c,d){var e=a._searchDiv.querySelector("input");return e&&a.searchCallback?a.searchCallback(e.value,c,d).done(u.bind(null,a)):b.Deferred().resolve().promise()}function u(a,b){var c
;a._searchDiv&&(c=a.isInToolbar?a._searchList:a._searchDiv.querySelector(".search-list"))&&(b&&b.length>0?c.classList.add("open"):c.classList.remove("open"))}function v(a){for(var b=a.hasAttribute("multiselect")?a.querySelectorAll("mi-li[checked]"):a.querySelectorAll(".active"),c=[],d=0;d<b.length;d++)c.push(b[d].value);return c}function w(a,b){var c;c=new CustomEvent("search-selected",{bubbles:!0}),c.searchResult=v(b.currentTarget),a.dispatchEvent(c)}return document.registerElement("mi-searchbox",{prototype:d}),d});
define('ui/elements/tool-bar/view-model',['lodash','jquery'],function(){"use strict";var a=require("lodash"),b=require("jquery"),c=Object.create(HTMLElement.prototype);c.createdCallback=function(){var b,c;this._closeOverflowBind=m.bind(null,this),this.$filter=null,this.popoverId=null,b=document.createElement("button"),b.className="more-options-icon btn btn-primary btn-icon dropdown-toggle",this.appendChild(b),c=document.createElement("icon"),c.className="icon-options",b.appendChild(c),this.throttledPositionEllipsis=a.throttle(this.positionEllipsis.bind(this),650)},c.attachedCallback=function(){a.defer(q.bind(null,this)),window.addEventListener("resize",this),document.querySelector("body").addEventListener("click",this._closeOverflowBind),this.addEventListener("click",this)},c.detachedCallback=function(){var a;window.removeEventListener("resize",this),document.querySelector("body").removeEventListener("click",this._closeOverflowBind),this.$filter&&(a=document.querySelector(this.popOverId),a&&a.parentElement.removeChild(a),
this.$filter=null)},c.showElement=function(a,b){for(var c=this.firstElementChild;c;)d(c,a)&&e(c,b),null!==c&&(c=c.nextElementSibling)};function d(a,b){return a.className.split(" ").indexOf(b)>=0}function e(a,c){c?b(a).addClass("overflow").removeClass("no-access"):b(a).addClass("no-access").removeClass("overflow")}c.handleEvent=function(b){var c,d,e,f;if("resize"===b.type&&b.target===window)this.throttledPositionEllipsis(),a.defer(q.bind(null,this));else if("click"===b.type){if(c=this.querySelector(".more-options-icon"),d=document.querySelector(this.popOverId),b.target===c||c.contains(b.target))l(this);else if(d&&d.contains(b.target)){for(f=b.target;f&&!e;)f.original&&(e=f.original),f=f.parentElement;e&&(b.cancelBubble=!0,e.dispatchEvent(new CustomEvent("click",{bubble:!0})))}b.target.parentElement.classList.contains("tool-bar-overflow")&&this._closeOverflowBind(this,b)}},c.positionEllipsis=function(){
var a=this.firstElementChild,b=this.querySelector(".more-options-icon"),c=document.querySelector(".content").getBoundingClientRect(),d=0,e=5,l,m=!1,n,o,p,q,r;if(r=this,null!==this.offsetParent)if(p=this.parentElement.getBoundingClientRect(),l="MI-TREE"===this.parentElement.tagName,this.$filter&&this.$filter.popover("hide"),a&&a!==b){for(n=b.getBoundingClientRect(),q=c.width===p.width||l?p.width-n.width-e:p.left+p.width-n.width-e,o=a.getBoundingClientRect(),d=h(r,b,o,p),a=this.firstElementChild;a;)o=a.getBoundingClientRect(),j(a,b,o,p)&&(i(a)?d>0?(m=!0,a.classList.add("overflow"),f(a),d--,d=h(r,b,o,p)):(g(a),a.classList.remove("overflow")):k(a,this)?(m=!0,a.classList.add("overflow")):(g(a),a.classList.remove("overflow"))),null!==a&&(a=a.nextElementSibling);m?(b.style.visibility="visible",b.style.left=q.toString()+"px"):b.style.visibility="hidden"}else;};function f(a){var c=b(a);""===c.next().text()||c.hasClass("more-options-icon")||c.next().css({"margin-right":"20px"})}function g(a){
var c=b(a),d=[];c.hasClass("overflow")&&c.attr("style",""),c.parent().children().each(function(a,c){"right"!==b(this).css("float")||b(this).hasClass("overflow")||d.push(b(this))}),b.each(d,function(a){0!==a&&b(this).attr("style","")})}function h(a,b,c,d){var e,f=0;for(e=a.firstElementChild;e;)j(e,b,c,d)&&k(e,a)&&i(e)&&f++,e=e.nextElementSibling;return f}function i(a){return"right"===b(a).css("float")}function j(a,b,c,d){var e="addItem"===a.getAttribute("data-action");return a!==b&&c.width!==d.width&&!e}function k(a,c){var d=b(a).position().top>b(c).position().top+b(c).height();return a.classList.contains("overflow")&&!a.classList.contains("dropdown-toggle")&&(b(a).removeClass("overflow"),d=b(a).position().top>b(c).position().top+b(c).height(),b(a).addClass("overflow")),d}function l(a){if(!a.$filter){var c,d;a.$filter=b(a.querySelector(".more-options-icon")),a.$filter.popover({placement:"bottom",container:"body",content:" "}),a.$filter.on("shown.bs.popover",a,n),
a.$filter.on("hide.bs.popover",a,o),a.$filter.on("hidden.bs.popover",a,p),a.$filter.popover("show"),setTimeout(function(){c=parseInt(b(a.popOverId).css("left")),d=parseInt(b(a.popOverId).width()),b(a.popOverId).css("left",c-(d-30))},250)}}function m(a,b){var c;if(a.$filter){if(!(c=document.querySelector(a.popOverId))||c.contains(b.target)||b.target===a)return;a.$filter.popover("hide")}}function n(a){var b=a.data,c,d=b.querySelectorAll(".overflow"),e,f;for(b.popOverId="#"+a.target.attributes["aria-describedby"].value,c=document.querySelector(b.popOverId+" .popover-content"),c.classList.add("tool-bar-overflow"),e=0;e<d.length;e++)f=d[e].cloneNode(),f.original=d[e],c.appendChild(f),f.textContent=f.getAttribute("title");c.addEventListener("click",b)}function o(a){var b=a.data,c;c=document.querySelector(b.popOverId+" .popover-content"),c&&c.addEventListener("click",b),b.$filter.off("shown.bs.popover",n),b.$filter.off("hide.bs.popover",o)}function p(a){var b=a.data
;b.$filter&&(b.$filter.off("hidden.bs.popover",p),b.$filter.popover("destroy"),b.$filter=null,b.popoverId=null)}function q(a){a&&a.positionEllipsis&&a.positionEllipsis instanceof Function&&a.positionEllipsis()}return document.registerElement("mi-tool-bar",{prototype:c}),c});
define('ui/elements/tool-bar-filter/view-model',['require','jquery','spa/conductor','spa/region','system/globalization/translator'],function(require){"use strict";var a=require("jquery"),b=require("spa/conductor"),c=require("spa/region"),d=require("system/globalization/translator"),e=Object.create(HTMLElement.prototype);e.createdCallback=function(){var a;h(this),this.classList.add("btn"),this.classList.add("btn-default"),this.classList.add("btn-icon"),a=document.createElement("i"),a.className="icon-collection-filter",this.appendChild(a),this.region=null,this.translator=null},e.attachedCallback=function(){this.addEventListener("click",this),document.querySelector("body").addEventListener("click",this._closeFilterBind),this.translator=Object.resolve(d),this.title=f(this,"FILTER")},e.detachedCallback=function(){var a;"true"!==this.getAttribute("custom-filter")&&(this.$filter&&(a=document.querySelector(this.popOverId),a&&a.parentElement.removeChild(a),this.$filter=null),this.conductor.unloadScreen(this.filterViewModel),this.conductor.closeScreen(this.filterViewModel)),
document.querySelector("body").removeEventListener("click",this._closeFilterBind)},e.handleEvent=function(a){"click"===a.type&&(a.target!==this&&a.target.parentElement!==this||g(this))},e.openFilter=function(){g(this)},e.closeFilter=function(){i(this)};function f(a,b){return a.translator.translate(b.toUpperCase())}function g(b){if("true"===b.getAttribute("custom-filter"))b.filterViewModel();else{if(b.$filter)return;b.$filter=a(b),b.$filter.popover({placement:"bottom",content:" ",container:"body"}),b.$filter.on("shown.bs.popover",b,l),b.$filter.on("hide.bs.popover",b,m),b.$filter.on("hidden.bs.popover",b,n),b.$filter.popover("show")}}function h(a){a.conductor=Object.resolve(b),a._closeFilterBind=i.bind(null,a),a.$filter=null,a.popoverId=null,a._filterViewModel=null,Element.defineProperty(a,"filterViewModel",{get:j.bind(null,a),set:k.bind(null,a)})}function i(a,b){var c;if(a.$filter){if(!(c=document.querySelector(a.popOverId))||c.contains(b.target)||b.target===a)return
;a.$filter.popover("hide")}}function j(a){return a._filterViewModel}function k(a,b){b?(a._filterViewModel=b,"true"!==a.getAttribute("custom-filter")&&(a.conductor.openScreen(a._filterViewModel),a.conductor.loadScreen(a._filterViewModel))):a._filterViewModel=null}function l(b){var d=b.data;d.region=new c,d.popOverId="#"+b.target.getAttribute("aria-describedby"),d.region.setElement(a(d.popOverId+" .popover-content")),d.conductor.activateScreen(d.filterViewModel),d.conductor.attachScreen(d.filterViewModel,d.region)}function m(a){var b=a.data;b.conductor.deactivateScreen(b.filterViewModel),b.conductor.detachScreen(b.region),b.$filter.off("shown.bs.popover",l),b.$filter.off("hide.bs.popover",m)}function n(a){var b=a.data;b.$filter&&(b.$filter.off("hidden.bs.popover",n),b.$filter.popover("destroy"),b.$filter=null,b.popoverId=null,b.dispatchEvent(new CustomEvent("filter-closed",{bubbles:!0})))}return document.registerElement("mi-tool-bar-filter",{prototype:e}),e});
define('ui/elements/list-group/view-model',['require','jquery','ramda','lodash','system/lang/converter','system/globalization/translator','ui/elements/list-group-item/view-model','ui/elements/searchbox/view-model','ui/elements/tool-bar/view-model','ui/elements/tool-bar-filter/view-model'],function(require){"use strict";var a=require("jquery"),b=require("ramda"),c=require("lodash"),d=require("system/lang/converter"),e=require("system/globalization/translator"),f=["key","description","selector","multiselect","has-children","use-html","delay","custom-search","radio-child-only"];require("ui/elements/list-group-item/view-model"),require("ui/elements/searchbox/view-model"),require("ui/elements/tool-bar/view-model"),require("ui/elements/tool-bar-filter/view-model");var g=Object.create(HTMLElement.prototype);g.selectRadioButton=function(a,b){E(this,a,b,!0)},g.createdCallback=function(){var a,b,c,d,e,f,g;j(this),this.classList.add("nav-list-group"),c=this.querySelector("mi-tool-bar"),c||(c=document.createElement("mi-tool-bar"),this.appendChild(c)),this.filterViewModel&&this.classList.add("show-filter"),e=document.createElement("mi-tool-bar-filter"),e.filterViewModel=this.filterViewModel,f=this.getAttribute("custom-filter"),
"true"===f&&e.setAttribute("custom-filter","true"),c.insertBefore(e,c.firstChild),this.searchCallback&&this.classList.add("show-search-button"),d=document.createElement("mi-searchbox"),d.searchCallback=this.searchCallback,c.insertBefore(d,c.firstChild),B(this,d),"false"!==this.getAttribute("allow-add")&&this.classList.add("allow-add"),c.insertBefore(N(this,"addItem","NEWITEM","icon-plus"),c.firstChild),a=document.createElement("div"),a.className="list-group",b=this.getAttribute("selector"),"addOnly"!==b&&"toggle"!==b||(a.className+=" selectable"),this.appendChild(a),g=document.createElement("div"),g.className="loading-small",this.appendChild(g),this.loader&&this.reload(),this.addEventListener("search-selected",this)},g.attachedCallback=function(){var a=U(this),b=this.querySelector("mi-tool-bar");a.addEventListener("scroll",this),a.addEventListener("click",this),b.addEventListener("click",this),b.addEventListener("resize",this),b.addEventListener("filter-closed",this),T(this)},
g.attributeChangedCallback=function(a,b,c){var d=U(this),e;"selector"===a&&d&&("addOnly"===c||"toggle"===c?d.classList.add("selectable"):d.classList.remove("selectable")),"allow-add"===a&&("false"===c?this.classList.remove("allow-add"):this.classList.add("allow-add")),"custom-filter"===a&&(e=this.querySelector("mi-tool-bar mi-tool-bar-filter"))&&e.setAttribute(a,c),A(this,a,c,d)},g.handleEvent=function(a){var b;"scroll"===a.type?J(this,a):"click"===a.type?C(a.target)?(E(this,D(a.target).value,a.selecting),h(this,a)):"BUTTON"===a.target.nodeName?(b=a.target.getAttribute("data-action"),S(this,b,a)):"I"===a.target.tagName&&"BUTTON"===a.target.parentElement.tagName&&(b=a.target.parentElement.getAttribute("data-action"),S(this,b,a)):"resize"===a.type?T(this):"filter-closed"===a.type?this.reload():"search-selected"===a.type&&(W.call(null,this,a.searchResult),x.call(null,this,this.searchResult))};function h(a,b){F(a)&&D(b.target).value&&!b.selecting&&i(a)&&l(a,k(a))}function i(a){
return t(a)&&c.includes(t(a),k(a))}g.reload=function(){var a=U(this);a&&(this.resume(),Element.clearDom(a),this.setAttribute("page","1"),a.scrollTop=0,this.loader&&this.load().done(M.bind(null,this)))},g.pause=function(){this.paused=!0},g.resume=function(){this.paused=!1},g.load=function(){var b=this.getAttribute("page"),c=L(this),d;return this.loader?(this.pause(),this.classList.add("loading"),T(this),d=this.loader(b,c),d.done(I.bind(null,this)),d.always(V.bind(null,this)),d.promise()):a.Deferred().done().promise()},g.scrollIntoView=function(){var a,b,c,d,e=U(this);e&&(a=e.querySelector("mi-li.active"),a?(b=a.parentNode,d=a.getBoundingClientRect(),c=b.getBoundingClientRect(),(d.top<c.top||d.top>c.bottom)&&(b.scrollTop=a.offsetTop-b.offsetTop)):e.firstElementChild&&(e.firstElementChild.scrollTop=0))},g.addItem=function(){this.dispatchEvent(new CustomEvent("add-item",{bubbles:!0}))},g.loadState=function(a){var b=this.querySelector("mi-tool-bar mi-searchbox");a=a||{},
a.value&&(this.value=a.value),a.searchTerm&&(b.value=a.searchTerm)},g.saveState=function(){var a=this.querySelector("mi-tool-bar mi-searchbox");return{value:this.value,searchTerm:a.value}};function j(a){a.translator=Object.resolve(e),a.paused=!1,a.searchResult=[],a._loader=null,Element.defineProperty(a,"loader",{get:q.bind(null,a),set:r.bind(null,a)}),a._value=null,Element.defineProperty(a,"value",{get:s.bind(null,a),set:E.bind(null,a)}),Element.defineProperty(a,"items",{get:t.bind(null,a),set:u.bind(null,a)}),Element.defineProperty(a,"selectedItems",{get:v.bind(null,a),set:x.bind(null,a)}),a._filterViewModel=null,Element.defineProperty(a,"filterViewModel",{get:O.bind(null,a),set:P.bind(null,a)}),a._searchCallback=null,Element.defineProperty(a,"searchCallback",{get:Q.bind(null,a),set:R.bind(null,a)}),a._listItemIconCallback=null,Element.defineProperty(a,"listItemIconCallback",{get:o.bind(null,a),set:p.bind(null,a)})}function k(a){var b=m(a);if(b)return b.selectedRadioButton}
function l(a,b){var c=m(a);c&&(c.selectedRadioButton=b)}function m(a){var b=n(a);if(b)return b[0]}function n(b){var c=b.parentElement,d;if(c)return d=a(c).siblings()}function o(a){return a._listItemIconCallback}function p(a,b){a._listItemIconCallback=b||null}function q(a){return a._loader}function r(a,b){a._loader=b,a.reload()}function s(a){return a._value}function t(a){var b=U(a),c,d=[],e;if(b)for(c=b.querySelectorAll("mi-li"),e=0;e<c.length;e++)d[d.length]=c[e].value;return d}function u(a,b){var c=U(a);c&&(Element.clearDom(c),b&&y(a,b))}function v(a){var b=U(a),c,d=[],e;if(b)for(c=b.querySelectorAll('mi-li[checked="true"]'),e=0;e<c.length;e++)d[d.length]=c[e].value;return d}function w(a){var b,c,d=U(a);if(d&&(b=d.querySelectorAll('mi-li[checked="true"]'),b.length>0))for(c=0;c<b.length;c++)b[c].setAttribute("checked","false")}function x(a,b){var c,d;if(w(a),b)for(c=0;c<b.length;c++)(d=H(a,b[c]))&&d.setAttribute("checked","true")}function y(a,b){var c,d,e=U(a),f;if(e){
for(f=document.createDocumentFragment(),z(b,e),c=0;c<b.length;c++)d=document.createElement("mi-li"),d.setAttribute("icon-class","icon-right-arrow"),f.appendChild(d),d.value=b[c],d.value.hasOwnProperty("disabled")&&d.setAttribute("disabled","true"===d.value.disabled||d.value.disabled),d.value.hasOwnProperty("disabledIcon")&&d.setAttribute("disabledIcon","true"===d.value.disabledIcon||d.value.disabledIcon),Object.tryMethod(a,"_listItemIconCallback",d.listItemIcon,b[c]),B(a,d);var g=new CustomEvent("loaded",{bubbles:!0,cancelable:!0,detail:{frag:f}});a.dispatchEvent(g),e.appendChild(f),a.searchResult.length&&x(a,a.searchResult)}}function z(a,b){if(0===a.length){var c=b.parentElement,d,e;c&&(c.parentElement&&(c=c.parentElement,c.previousSibling&&(c=c.previousSibling)),"MI-PATH-HISTORY"===c.nodeName&&(d=c.children[0].children,e=d[d.length-1],e.setAttribute("icon-class","")))}}function A(a,b,c,d){var e,g,h;if(d&&f.indexOf(b)>-1){for(e=d.getElementsByTagName("mi-li"),
g=0;g<e.length;g++)e[g].setAttribute(b,c);h=a.querySelector("mi-tool-bar mi-searchbox"),h&&h.setAttribute(b,c)}}function B(a,b){var c,d;for(c=0;c<f.length;c++)(d=a.getAttribute(f[c]))&&b.setAttribute(f[c],d)}function C(a){return"MI-LI"===a.tagName||"MI-LI"===a.parentNode.tagName||"MI-LI"===a.parentNode.parentNode.tagName||"MI-LI"===a.parentNode.parentNode.parentNode.tagName}function D(a){for(var b=a;"MI-LI"!==b.tagName;)b=b.parentNode;return b}function E(a,b,c,d){if(b){var e,f,g;if(g=new CustomEvent("selecting",{bubbles:!0,cancelable:!0}),g.selecting=c,g.newValue=b,a.dispatchEvent(g)){if(f=a.getElementsByClassName("active"),f&&f.length>0&&f[0].classList.remove("active"),a._value=b,b)if(F(a)&&b&&c&&l(a,b),void 0!==(e=H(a)))a._value=e.value,e.classList.add("active"),a.scrollIntoView();else{var h=a.querySelector("mi-list-group");h&&void 0!==h&&(a._value=h.value,h.classList.add("active"),a.scrollIntoView())}
return a.value&&void 0!==e?(e.getAttribute("multiselect")&&("true"===e.getAttribute("checked")?e.setAttribute("checked","false"):e.setAttribute("checked","true")),d?(e.setAttribute("checked","true"),G(a,c,!0),!0):(F(a)?G(a,c,!0):G(a,c),!0)):(null!==a.value&&void 0!==a.value||G(a,c),!1)}}}function F(a){return b.any(b.propEq("name","radio-child-only"),a.attributes)}function G(a,b,c){var d=new CustomEvent("change",{bubbles:!0,cancelable:!0});a.dispatchEvent(d),d=new CustomEvent("selected",{bubbles:!0,cancelable:!0}),d.preventListGroupNull=c,d.selecting=b,a.dispatchEvent(d)}function H(a,b){var c=0,d=U(a),e,f,g;if(d&&(e=d.querySelectorAll("mi-li"))&&0!==e.length){for(b=b||a.value,f=a.getAttribute("key")||"entityKey",g=b[f];c<e.length&&g!==e[c].value[f];)c++;return e[c]}}function I(a,b){var c=U(a);c&&"1"===a.getAttribute("page")&&Element.clearDom(c),b&&(y(a,b),b.length===L(a)&&a.resume())}function J(a,b){
var c=b.target,e=d.toFloat(a.getAttribute("scroll-percent")||"0.75"),f=(c.offsetHeight+c.scrollTop)/c.scrollHeight;!a.paused&&f>=e&&(K(a),a.load())}function K(a){var b=d.toInteger(a.getAttribute("page")||"1");b++,a.setAttribute("page",b.toString())}function L(a){var b=a.getAttribute("page-size")||"25";return d.toInteger(b)}function M(a){a.value&&(E(a,a.value)||(a.paused?a.value=null:(K(a),a.load().done(M.bind(null,a)))))}function N(a,b,c,d){var e=document.createElement("button"),f=document.createElement("i");return e.className="btn btn-default btn-icon",e.setAttribute("data-action",b),e.title=a.translator.translate(c),f.className=d,e.appendChild(f),e}function O(a){return a._filterViewModel}function P(a,b){var c=a.querySelector("mi-tool-bar mi-tool-bar-filter");b?a.classList.add("show-filter"):a.classList.remove("show-filter"),c&&(c.filterViewModel=b),a._filterViewModel=b}function Q(a){return a._searchCallback}function R(a,b){var c=a.querySelector("mi-tool-bar mi-searchbox")
;b?a.classList.add("show-search-button"):a.classList.remove("show-search-button"),c&&(c.searchCallback=b),a._searchCallback=b}function S(a,b,c){b&&a[b]&&a[b](c)}function T(a){var b,c=a.querySelector("mi-tool-bar"),d=U(a);c&&(b=a.querySelector("mi-tool-bar").clientHeight,a.classList.contains("loading")&&(b+=16),d.style.height="calc(100% - "+(b+1)+"px)")}function U(a){var b=a.querySelectorAll(".list-group");return 0===b.length?null:b[b.length-1]}function V(a){a.classList.remove("loading"),T(a)}function W(a,b){var c,d,e=0;for(c=0;c<b.length;c++){for(d=0;d<a.searchResult.length;d++)if(a.searchResult[d].key===b[c].key){e++;break}0===e&&a.searchResult.push(b[c])}}return document.registerElement("mi-list-group",{prototype:g}),g});
define('ui/elements/path-history/view-model',['require','lodash','jquery','ui/elements/list-group-item/view-model','ui/elements/list-group/view-model'],function(require){"use strict";var a=require("lodash"),b=require("jquery");require("ui/elements/list-group-item/view-model"),require("ui/elements/list-group/view-model");var c=["key","description","selector","multiselect","checked","has-children","use-html","page-size","delay","radio-child-only"],d=Object.create(HTMLElement.prototype);d.createdCallback=function(){var a;this.style.display="block",a=document.createElement("div"),a.className="list-group",this.appendChild(a),Element.defineProperty(this,"value",{get:k.bind(null,this),set:l.bind(null,this)}),Element.defineProperty(this,"listGroup",{get:m.bind(null,this),set:n}),this._loader=null,Element.defineProperty(this,"loader",{get:o.bind(null,this),set:p.bind(null,this)}),this._listItemIconCallback=null,Element.defineProperty(this,"listItemIconCallback",{get:g.bind(null,this),set:h.bind(null,this)}),this._selectedRadioButton=null,Element.defineProperty(this,"selectedRadioButton",{get:e.bind(null,this),set:f.bind(null,this)})}
;function e(a){return a._selectedRadioButton}function f(a,b){a._selectedRadioButton=b}function g(a){return a._listItemIconCallback}function h(a,b){a._listItemIconCallback=b||null}d.attachedCallback=function(){this.firstElementChild.addEventListener("click",this)},d.attributeChangedCallback=function(a,b,d){var e,f;if(c.indexOf(a)>-1)for(f=this.firstElementChild.getElementsByTagName("mi-li"),e=0;e<f.length;e++)"description"!==a&&"use-html"!==a||f[e].setAttribute(a,d),f[e].listGroup.setAttribute(a,d)},d.handleEvent=function(a){var b;"click"===a.type&&(a.cancelBubble=!0,a.preventDefault=!0,b=new CustomEvent("click",{bubbles:!0}),b.data=a.target.value,this.dispatchEvent(b),i(this))};function i(a){if(a.selectedRadioButton){var c=b(a).siblings(),d,f,g;c&&(d=b(a).siblings()[0]),d&&(f=d.children),f&&(g=f[0]),g&&e(a)&&j(a,g)}}d.contains=function(a){var b,c=this.value;for(b=0;b<c.length;b++)if(a===c[b].value)return!0;return!1},d.push=function(a){var b;b=document.createElement("mi-li"),
this.firstElementChild.appendChild(b),b.classList.add("selected"),null!==a.hasChildren&&b.setAttribute("icon-class","icon-arrow"),this.getAttribute("description")&&b.setAttribute("description",this.getAttribute("description")),this.getAttribute("use-html")&&b.setAttribute("use-html",this.getAttribute("use-html")),b.setAttribute("has-children",!0),b.value=a,b.listGroup=r(this,a),Object.tryMethod(this,"_listItemIconCallback",b.listItemIcon,a),q(this),j(this,b.listGroup)};function j(b,c){c&&b.selectedRadioButton&&a.includes(c.items,b.selectedRadioButton)&&c.selectRadioButton(b.selectedRadioButton,!0)}d.pop=function(){var a=this.firstElementChild,b=a.getElementsByTagName("mi-li");b.length>1&&(a.removeChild(b[b.length-1]),q(this))},d.moveBack=function(a){var b=this.firstElementChild,c=b.getElementsByTagName("mi-li"),d,e;if(a instanceof Object)for(;c&&c[c.length-1].value!==a;)b.removeChild(c[c.length-1]),q(this);else for(c=c.splice(a+1),d=0;d<c.length;d++)b.removeChild(c[d]),q(this)
;(e=b.querySelector("mi-li:last-of-type").listGroup)&&(e._value=null)},d.clear=function(){this.firstElementChild.innerHTML=""};function k(a){var b=a.firstElementChild.getElementsByTagName("mi-li"),c=[],d;for(d=0;d<b.length;d++)c[c.length]=b[d].value;return c}function l(a,b){var c,d,e=a.firstElementChild,f=!1;if(b instanceof Array){for(d=e.getElementsByTagName("mi-li"),c=0;c<b.length;c++)c>=d.length?(a.push(b[c]),f=!0):b[c]!==d[c].value&&(d[c].value=b[c],d[c].listGroup.reload(),f=!0);if(b.length<d.length){for(f=!0,c=d.length-1;c>b.length-1;c--)e.removeChild(d[c]);d[d.length-1].listGroup.value=null}f&&q(a)}else a.firstChild.innerHTML="",b&&a.push(b),q(a)}function m(a){var b=a.firstElementChild.getElementsByTagName("mi-li"),c=[],d;for(d=0;d<b.length;d++)c[c.length]=b[d].listGroup;return c}function n(){}function o(a){return a._loader}function p(a,b){var c,d=a.firstElementChild.getElementsByTagName("mi-li");for(a._loader=b,
c=0;c<d.length;c++)d[c].listGroup.listItemIconCallback=a.listItemIconCallback,d[c].listGroup.loader=b?b.bind(null,c):null}function q(a){var b=new CustomEvent("change",{bubbles:!0});a.dispatchEvent(b)}function r(a,b){var d=document.createElement("mi-list-group"),e=a.firstElementChild.getElementsByTagName("mi-li").length-1,f;for(f=0;f<c.length;f++)t(a,d,c[f]);return d.setAttribute("allow-add","false"),b&&b.loader?d.loader=b.loader.bind(null,e):a.loader&&(d.loader=a.loader.bind(null,e)),d.listItemIconCallback=a.listItemIconCallback,d.addEventListener("change",s),d}function s(a){a.cancelBubble=!0,a.preventDefault()}function t(a,b,c){var d=a.getAttribute(c);d&&b.setAttribute(c,d)}return document.registerElement("mi-path-history",{prototype:d}),d});
define('ui/elements/tree/view-model',['require','jquery','system/globalization/translator','ui/elements/path-history/view-model','ui/elements/searchbox/view-model','ui/elements/list-group/view-model','ui/elements/tool-bar/view-model','ui/elements/tool-bar-filter/view-model'],function(require){"use strict";var a=require("jquery"),b=require("system/globalization/translator"),c=["key","description","page","page-size","scroll-percent","selector","multiselect","checked","has-children","use-html","delay","radio-child-only"];require("ui/elements/path-history/view-model"),require("ui/elements/searchbox/view-model"),require("ui/elements/list-group/view-model"),require("ui/elements/tool-bar/view-model"),require("ui/elements/tool-bar-filter/view-model");var d=Object.create(HTMLElement.prototype);d.createdCallback=function(){var a,b,c,d,f,h;g(this),b=this.querySelector("mi-tool-bar"),b||(b=document.createElement("mi-tool-bar"),Element.upgrade(b),this.appendChild(b)),this.filterViewModel&&this.classList.add("show-filter"),d=document.createElement("mi-tool-bar-filter"),Element.upgrade(d),d.classList.add("default-buttons-left"),d.filterViewModel=this.filterViewModel,f=this.getAttribute("custom-filter"),"true"===f&&d.setAttribute("custom-filter","true"),
b.insertBefore(d,b.firstChild),this.searchCallback&&this.classList.add("show-search-button"),c=document.createElement("mi-searchbox"),Element.upgrade(c),c.classList.add("default-buttons-left"),c.searchCallback=e.bind(null,this),c.setAttribute("custom-search","true"),c.setAttribute("no-auto-close","true"),b.insertBefore(c,b.firstChild),p(this,c),"false"!==this.getAttribute("allow-add")&&this.classList.add("allow-add"),b.insertBefore(C(this,"addItem","NEWITEM","icon-plus"),b.firstChild),b.insertBefore(C(this,"togglePathHistory","HIDE","icon-up-arrow","hide-button"),b.firstChild),b.insertBefore(C(this,"backInHistory","BACK","icon-back-arrow","back-button"),b.firstChild),a=document.createElement("section"),a.className="nav-list-group",this.appendChild(a),this.pathHistory=document.createElement("mi-path-history"),Element.upgrade(this.pathHistory),this.pathHistory.loader=this._loader,this.pathHistory.value=this._value,this.pathHistory.className="expanded",a.appendChild(this.pathHistory),
p(this,this.pathHistory),h=document.createElement("div"),h.className="tree-list-control",a.appendChild(h),this._value&&x(this)},d.attachedCallback=function(){var a=this.querySelector("section.nav-list-group"),b=this.querySelector("mi-tool-bar");a.addEventListener("selecting",this),a.addEventListener("selected",this),a.addEventListener("click",this),b.addEventListener("click",this),b.addEventListener("resize",this),b.addEventListener("filter-closed",this),this.pathHistory.addEventListener("change",this),B(this)},d.attributeChangedCallback=function(a,b,d){var e,f;"root-name"===a?B(this,d):"allow-add"===a?"false"===d?this.classList.remove("allow-add"):this.classList.add("allow-add"):"custom-filter"===a?(f=this.querySelector("mi-tool-bar mi-tool-bar-filter"))&&f.setAttribute(a,d):c.indexOf(a)>-1&&(this.pathHistory.setAttribute(a,d),(e=this.querySelector("mi-tool-bar mi-searchbox"))&&e.setAttribute(a,d))},d.handleEvent=function(a){
"selecting"===a.type?D(this,a):"selected"===a.type?E(this,a):"click"===a.type?q(this,a):"change"===a.type?x(this):"resize"===a.type&&a.target!==window?t(this,a):"filter-closed"===a.type?this.refreshAll():"focus"===a.type&&a.target.parentElement.classList.contains("mi-searchbox")?(this.pathHistory.value=this.pathHistory.value[0],this.pathHistory.firstElementChild.firstElementChild.style.display="none",setTimeout(t.bind(null,this),0)):"blur"===a.type&&a.target.classList.contains("mi-searchbox")&&t(this)},d.togglePathHistory=function(){var a=!this.pathHistory.classList.contains("expanded"),b=this.querySelector('button[data-action="togglePathHistory"]');b.firstElementChild.className=a?"icon-up-arrow":"icon-arrow",b.title=this.translator.translate(a?"HIDE":"SHOW"),this.pathHistory.className=a?"expanded":"collapsed",t(this)},d.backInHistory=function(){var a=this.value;a.length>1&&w(this,a[a.length-2])},d.refresh=function(){var a=this.value,b=a[a.length-1]
;1===a.length?this.reload():(this.pathHistory.pop(),this.pathHistory.push(b))},d.refreshAll=function(){var a=this.pathHistory.listGroup,b;if(a.length<=1)this.reload();else{for(b=0;b<a.length;b++)a[b].items=null,a[b].resume();a[a.length-1].reload()}},d.reload=function(){A(this)&&this.pathHistory.clear(),B(this)},d.addItem=function(){this.dispatchEvent(new CustomEvent("add-item",{bubble:!0}))},d.loadState=function(a){var b;a=a||{},a.searchTerm&&(b=this.querySelector("mi-searchbox"),b._value=a.searchTerm,b.toggleSearch(),this.searchTerm=a.searchTerm,t(this),this.preSearchValue=a.preSearchValue),this.value=a.value,a.searchTerm&&(this.pathHistory.firstElementChild.firstElementChild.style.display="none")},d.saveState=function(){return{preSearchValue:this.preSearchValue,value:this.value,searchTerm:this.searchTerm}};function e(a,b){a.pathHistory.clear(),a.pathHistory.value={description:b,loader:a._searchCallback.bind(null,b)},a.searchTerm=b,
a.pathHistory.firstElementChild.firstElementChild.style.display="none",t(a)}function f(a){var b,c;a.preSearchValue&&(a.pathHistory.clear(),a.pathHistory.value=a.preSearchValue,a.preSearchValue=null,a.searchTerm="",a.querySelector("mi-searchbox").value=null,b=a.pathHistory.firstElementChild.firstElementChild,b&&(b.style.display="block"),c=new CustomEvent("search-closed",{bubbles:!0}),a.dispatchEvent(c),t(a))}function g(a){a.translator=Object.resolve(b),a._loader=null,a.preSearchValue=null,a.searchTerm="",Element.defineProperty(a,"loader",{get:j.bind(null,a),set:k.bind(null,a)}),a._value=null,Element.defineProperty(a,"value",{get:l.bind(null,a),set:m.bind(null,a)}),Element.defineProperty(a,"listGroup",{get:n.bind(null,a),set:o}),a._filterViewModel=null,Element.defineProperty(a,"filterViewModel",{get:F.bind(null,a),set:G.bind(null,a)}),a._searchCallback=null,Element.defineProperty(a,"searchCallback",{get:H.bind(null,a),set:I.bind(null,a)}),a._listItemIconCallback=null,
Element.defineProperty(a,"listItemIconCallback",{get:h.bind(null,a),set:i.bind(null,a)})}function h(a){return a._listItemIconCallback}function i(a,b){a._listItemIconCallback=b||null,a.pathHistory&&(a.pathHistory.listItemIconCallback=b)}function j(a){return a.pathHistory?a.pathHistory.loader:a._loader}function k(a,b){a.pathHistory&&(a.pathHistory.listItemIconCallback=a._listItemIconCallback,a.pathHistory.loader=b),a._loader=b}function l(a){return a.pathHistory?a.pathHistory.value:a._value}function m(a,b){a.pathHistory&&b&&(a.pathHistory.value=b),a._value=b}function n(a){return a.querySelector(".tree-list-control mi-list-group")}function o(){}function p(a,b){var d,e;for(d=0;d<c.length;d++)(e=a.getAttribute(c[d]))&&b.setAttribute(c[d],e)}function q(a,b){var c;"BUTTON"===b.target.nodeName?(c=b.target.getAttribute("data-action"),r(a,c,b)):"I"===b.target.tagName&&"BUTTON"===b.target.parentElement.tagName?(c=b.target.parentElement.getAttribute("data-action"),
r(a,c,b)):"MI-PATH-HISTORY"===b.target.tagName&&b.data&&w(a,b.data)}function r(a,b,c){b&&a[b]&&a[b](c)}function s(a,b){a.preSearchValue=a.pathHistory.value,b.target._searchDiv&&(b.target._searchDiv.querySelector("input").addEventListener("focus",a),b.target._searchDiv.querySelector("input").addEventListener("blur",a))}function t(b,c){var d=b.querySelector(".tree-list-control"),e=b.querySelector("section.nav-list-group"),g=e.firstElementChild,h=b.children,i=b.querySelector("mi-tool-bar"),j=0,k;if(d){if(c&&(c.open===!1?f(b):s(b,c)),i){for(k=0;k<h.length;k++)h[k]!==e&&(j+=a(h[k]).outerHeight());e.style.height="calc(100% - "+j+"px)"}for(j=0;g;)g!==d&&(j+=g.clientHeight),g=g.nextElementSibling;j=j.toString()+"px",d.style.height="calc(100% - "+j+")"}}function u(a,b){var c,d;for(c=new CustomEvent("navigating",{bubbles:!0,cancelable:!0}),c.newValue=[],d=0;d<a.length&&a[d]!==b;)c.newValue[c.newValue.length]=a[d],d++;return void 0!==b&&(c.newValue[c.newValue.length]=b),c}function v(a,b){
var c,d=a.pathHistory.listGroup[a.pathHistory.listGroup.length-1];b&&b.preventListGroupNull||(d.selectedItems=null),c=new CustomEvent("navigated",{bubbles:!0}),a.dispatchEvent(c)}function w(a,b){var c;c=u(a.value,b),a.dispatchEvent(c)&&(a.pathHistory.moveBack(b),v(a))}function x(a){y(a),z(a)}function y(b){var c=a("button.hide-button",b),d=a("button.back-button",b);c.addClass("pull-right"),1===b.pathHistory.value.length?(d.addClass("disabled"),c.addClass("disabled")):(d.removeClass("disabled"),c.removeClass("disabled"))}function z(a){var b=a.pathHistory.listGroup[a.pathHistory.listGroup.length-1],c=a.querySelector(".tree-list-control");b&&(c.firstElementChild&&c.removeChild(c.firstElementChild),c.appendChild(b),t(a),0!==b.items.length||b.paused?b.scrollIntoView():b.load())}function A(a){return a.getAttribute("root-name")||a.getAttribute("title")}function B(a,b){var c,d,e=a.getAttribute("description")||"description",f=b||A(a);if(f)d=a.value,0===d.length?(c={},c[e]=f,
a.value=c):(d[0]instanceof Object||(d[0]={}),d[0][e]=f,a.value=d);else if(a.value.length>0)return void(a.value=a.value[0])}function C(a,b,c,d,e){var f=document.createElement("button"),g=document.createElement("i");return f.className="btn btn-default btn-icon default-buttons-left "+(e||""),f.setAttribute("data-action",b),f.title=a.translator.translate(c),g.className=d,f.appendChild(g),f}function D(a,b){var c;b.selecting!==!0&&b.selecting!==!1&&(b.cancelBubble=!0,c=u(a.value,b.newValue),a.dispatchEvent(c)||b.preventDefault())}function E(a,b){var c;if(b.target.classList.contains("search-list"))return void(b.cancelBubble=!0);null!==b.selecting&&void 0!==b.selecting||(b.cancelBubble=!0,a.pathHistory.push(b.target.value),v(a,b),a.preSearchValue&&(c=new CustomEvent("search-selected",{bubbles:!0}),c.searchResult=[b.target.value],a.dispatchEvent(c)))}function F(a){return a._filterViewModel}function G(a,b){var c=a.querySelector("mi-tool-bar mi-tool-bar-filter")
;b?a.classList.add("show-filter"):a.classList.remove("show-filter"),c&&(c.filterViewModel=b),a._filterViewModel=b}function H(a){return a._searchCallback}function I(a,b){b?a.classList.add("show-search-button"):a.classList.remove("show-search-button"),a._searchCallback=b}return Element.registerElement("mi-tree",{prototype:d}),d});

define('text!ui/elements/filter/filter-btn-no-ko-view.html',[],function () { return '<div class="icon-filter-container">\r\n    <button class="icon-container btn btn-icon">\r\n        <i class="icon-collection-filter"></i>\r\n    </button>\r\n</div>\r\n';});


define('text!ui/elements/filter/filter-body-no-ko-view.html',[],function () { return '<!--<mi-select data-optionscaption="Select" data-selectedoptions="" data-disabled="false" data-required="false" data-visible="true" data-multiple="false"></mi-select>-->\r\n<div class="filter-container">\r\n\r\n    <div class="filters-noko">\r\n        <!--<div class="clear-all">\r\n            <a></a>\r\n        </div>-->\r\n        <div class="tag-section tag-area">\r\n        </div>\r\n        <div class="filter-content">\r\n            <div class="sort-header ">\r\n                \r\n            </div>\r\n        </div>\r\n        <div class="filter-header">\r\n            <header></header>\r\n            <header class="dotted-border"> </header>\r\n        </div>\r\n        <div class="filter-body">\r\n            \r\n        </div>\r\n    </div>\r\n</div>\r\n';});


define('text!ui/elements/filter/filter-group-no-ko-view.html',[],function () { return '<div class="filter-section">\r\n    <header></header>\r\n    <div class="filter-item">\r\n        <form class="form-item">\r\n            <div>\r\n                <!--<mi-checkbox data-bind="miCheckboxProperty: {checked: isSelected, text: text}"></mi-checkbox>-->\r\n            </div>\r\n        </form>\r\n        <div class="second-dotted-border"></div>\r\n    </div>\r\n</div>';});

define('ui/elements/filter/filter-item-no-ko',['require'],function(require){"use strict";function a(a,b){a=a||null,this.caption=b,this.value=a.value,this.text=a.text,this.isSelected=a.isSelected}return a});
define('ui/elements/filter/filter-group-no-ko',['require','./filter-item-no-ko'],function(require){"use strict";var a=require("./filter-item-no-ko");function b(b){var c;for(b=b||null,this.caption=b.caption,this.type=b.type,this.items=[],this.hideCaption=b.hideCaption,c=0;c<b.options.length;c++)this.items.push(new a(b.options[c].option,this.caption))}return b});
define('ui/elements/filter/filter-collection-no-ko',['require','./filter-group-no-ko'],function(require){"use strict";var a=require("./filter-group-no-ko");function b(){this.filterGroups=[]}return b.prototype.populateGroups=function(b){var c,d;for(c=0;c<b.filteroptions.length;c++)d=new a(b.filteroptions[c]),this.filterGroups.push(d)},b.prototype.clear=function(){this.filterGroups=[]},b});

define('text!ui/elements/select/template.html',[],function () { return '<div class="mi-select-container" data-bind="event:{click:toggleOptions,\r\n                                                    mousedown:handleMouseDown},\r\n    css:{\'disabled\':disabled,\'open\':isOpen,\'required\': isRequired }">\r\n    <div data-bind="css:{\'active\':isOpen}" class="mi-dropdown-selector">\r\n        <div data-bind="visible:multiple,\r\n    event:{click:toggleSelectAll},\r\n    css:{\'dx-checkbox-indeterminate\':selectedOptions().length && selectedOptions().length !== options().length ,\r\n        \'dx-checkbox-checked\':selectedOptions().length === options().length}" \r\n             class="pull-left dx-select-checkbox dx-datagrid-checkbox-size dx-widget dx-checkbox" tabindex="0" onclick="void(0)">\r\n            <div class="dx-checkbox-container">\r\n                <span class="dx-checkbox-icon"></span>\r\n            </div>\r\n        </div>\r\n        <input type="text" class="mi-selected-value-text pull-left"\r\n               data-bind="value:text,\r\n    valueUpdate:\'keyup\',\r\n    attr:{\'readonly\':(!editable() || disabled() || multiple() || isMobile),\r\n           \'title\': text},\r\n    css:{\'multi\':multiple},\r\n    event: {keyup: handleKeyUpOnTextInput,\r\n            keydown:handleKeyDownOnTextInput,\r\n            click:handleKeyUpOnTextInput,\r\n            mousedown:handleKeyUpOnTextInput},\r\n    hasFocus:textFocus" /> \r\n        <i class="icon-arrow pull-right"></i>\r\n        <!--disable:(!editable() || disabled() || multiple())<span class="mi-selected-value-text pull-left" data-bind="text:selectedValueText()"></span> <span class="fa fa-angle-down pull-right"></span>-->\r\n    </div>\r\n\r\n</div>';});


define('text!ui/elements/select/options-template.html',[],function () { return '<div data-bind="visible:isOpen(),event:{mousedown:$root.handleMouseDown}" class="mi-select-options-container">\r\n\r\n    <p class="mi-select-caption" data-bind="visible:optionsCaption() && optionsCaption().trim(),text:optionsCaption,event:{\r\n                                    click:function(data,event){selectValue($root,null,event);}},\r\n                                    css:{\'mi-select-option\':optionsCaption}\r\n                                "></p>\r\n\r\n    <!-- ko ifnot:optionsGroup -->\r\n    <!-- ko foreach:filteredOptions -->\r\n    <p class="mi-select-option" data-bind="html:$parent.wrapOptionText($data),event:{\r\n                                                    click:function(data,event){$parent.selectValue($parent,data,event);}},\r\n                                                    css:{\'active\':$parent.isActive($data)},\r\n                                                    attr:{\'data-index\':$index()}">\r\n    </p>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- ko if:optionsGroup -->\r\n    <!-- ko foreach:Object.keys(filteredOptions()) -->\r\n\r\n    <strong class="mi-select-group-title" data-bind="text:$data,visible:$data !== \'undefined\',click:$root.handleMouseDown"></strong>\r\n    <!-- ko foreach:$root.filteredOptions()[$data] -->\r\n    <p class="mi-select-option" data-bind="html:$root.wrapOptionText($data),event:{\r\n                                                                            click:function(data,event){$root.selectValue($root,data,event);}},\r\n                                                                            css:{\'active\':$root.isActive($data)},\r\n                                                                            attr:{\'data-index\':$index()}">\r\n    </p>\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n    <!-- /ko -->\r\n</div>\r\n';});

define('system/knockout/bindings/halt-bindings',['require','knockout'],function(require){"use strict";var a=require("knockout");a.bindingHandlers["halt-bindings"]||(a.bindingHandlers["halt-bindings"]={init:function(){return{controlsDescendantBindings:!0}}});function b(a){return Element.build("div",a,null,{"data-bind":"halt-bindings: true"})}return{createElement:b}});
define('ui/elements/select/mi-property',['require','lodash','jquery','knockout'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("knockout"),d="property-changed-event-handlers",e=1;if(!c.bindingHandlers.miproperty){c.bindingHandlers.miproperty={init:function(e,f){var h,i=b(e),j={},k=g(f());a.each(k,function(b,c){h=function(b,d){var e=f()[c];a.isFunction(e)&&e(d)},j[c]=h,i.on("attributes."+c+":changed",h),i.on("properties."+c+":changed",h)}),c.utils.domData.set(e,d,j),c.utils.domNodeDisposal.addDisposeCallback(e,function(){var b=c.utils.domData.get(e,d);a.each(f(),function(a,c){i.off("attributes."+c+":changed",b[c]),i.off("properties."+c+":changed",b[c])})})},update:function(d,h){var i,j=g(h());f(d,!1),a.each(j,function(f,g){i=c.unwrap(f),"object"==typeof i&&!a.isEqual(b(d).data(g.toLowerCase()),i)||""===i?(b(d).data(g.toLowerCase(),i),b(d).attr("data-"+g.toLowerCase(),e),e++):(b(d).data(g.toLowerCase(),i),b(d).attr("data-"+g.toLowerCase(),i))}),f(d,!0)}};var f=function(a,d){if(b(a).find(".mi-select-container")[0]){
var e=c.contextFor(b(a).find(".mi-select-container")[0]).$data;e.propertiesUpdateDone&&e.propertiesUpdateDone(d)}},g=function(a){for(var b={},c=["addCaption","multiple","editable","value","selectedOptions","optionsCaption","optionsText","optionsValue","optionsGroup","disabled","required","options"],d=0;d<c.length;d++)void 0!==a[c[d]]&&(b[c[d]]=a[c[d]]);return b}}});
define('ui/elements/select/element',['require','lodash','jquery','jquery','knockout','system/lang/converter','system/knockout/knockout-manager','system/knockout/bindings/halt-bindings','./mi-property'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("jquery"),d=require("knockout"),e=require("system/lang/converter"),f=require("system/knockout/knockout-manager");require("system/knockout/bindings/halt-bindings"),require("./mi-property");function g(a,b){var c=Object.create(HTMLElement.prototype);c.createdCallback=function(){this.implementation=Object.resolve(b,this),this.implementation.element=this,Object.tryMethod(this.implementation,"created")},c.attachedCallback=function(){this.implementation&&Object.tryMethod(this.implementation,"attached")},c.detachedCallback=function(){this.implementation&&(Object.tryMethod(this.implementation,"detached"),this.implementation=null)},c.attributeChangedCallback=function(a,b,c){Object.tryMethod(this.implementation,a.toLowerCase()+"Changed",b,c)},c.getControl=function(){return this.implementation},Element.registerElement(a,{prototype:c})}var h=function(){function a(a,b,c){this.kom=Object.resolve(f),
this.properties=[],this.view=a,this.preserveContext=b||!1,this.appendAfterBindings=c||!1,this.container=null,this.element=null,this.state=null}a.prototype.created=function(){Object.tryMethod(this,"beforeCreated"),c(this),Object.tryMethod(this,"afterCreated")},a.prototype.attached=function(){Object.tryMethod(this,"beforeAttached"),e(this),Object.tryMethod(this,"afterAttached")},a.prototype.detached=function(){Object.tryMethod(this,"beforeDetached"),g(this),Object.tryMethod(this,"afterDetached"),this.kom.dispose(),this.kom=null,this.properties=null,this.view=null,this.preserveContext=null,this.appendAfterBindings=null,this.state=null,this.container=null},a.prototype.bindAttribute=function(a,c,d,e){var f=e||!1;this["data-"+a.toLowerCase()+"Changed"]=function(c,d){var e=b(this.element).data(a.toLowerCase());this[a]&&this[a](e)}.bind(this),this.kom.subscribe(this[a],function(c){f||b(this.element).trigger("attributes."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),
void 0===b(this.element).attr("data-"+a.toLowerCase())?this.element.setAttribute("data-"+a.toLowerCase(),c):this[a](b(this.element).data(a.toLowerCase()))},a.prototype.bindProperty=function(a,c,d,e){this[a]=this.kom.observable();var f=e||!1;Object.defineProperty(this.element,a,{get:function(){return this[a]()}.bind(this),set:function(b){this[a]&&this[a](b)}.bind(this)}),this.properties.push(a),this.kom.subscribe(this[a],function(c){f||b(this.element).trigger("properties."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),this[a](Object.defaultValue(this.element[a],c))},a.prototype.bindArrayProperty=function(a,c,d,e){this[a]=this.kom.observableArray();var f=e||!1;Object.defineProperty(this.element,a,{get:function(){return this[a]()}.bind(this),set:function(b){this[a](b)}.bind(this)}),this.properties.push(a),this.kom.subscribe(this[a],function(c){f||b(this.element).trigger("properties."+a+":changed",[c])},this),d&&this.kom.subscribe(this[a],d,this),
this[a](Object.defaultValue(this.element[a],c))};function c(a){a.state="created";var c=document.createElement("div"),d=b(c),e=b(a.view);a.preserveContext||d.attr("data-bind","halt-bindings"),d.append(e),a.appendAfterBindings||b(a.element).empty().append(d),a.container=c}function e(a){if("detached"===a.state){var c=document.createElement("div"),e=b(c),f=b(a.view);a.preserveContext||e.attr("data-bind","halt-bindings"),e.append(f),a.appendAfterBindings||b(a.element).empty().append(e),a.container=c}a.state="attached",d.applyBindingsToDescendants(a,a.container),a.appendAfterBindings&&b(a.element).empty().append(a.container)}function g(a){a.state="detached",d.cleanNode(a.container),b(a.container).remove()}function h(a,b){delete a[b]}return a}();function i(b,d){window.CustomElements&&(window.CustomElements.useNative||(a.isArray(b)?j(b,d):a.isString(b)?k(b,d):b instanceof c?l(b):m(b)))}function j(a,b){for(var c=0;c!==a.length;c++)i(a[c],b)}function k(a,c){c&&c.$element&&(c=c.$element),
l(b(a,c))}function l(a){a.each(function(a,b){m(b)})}function m(a){window.CustomElements.upgrade(a)}function n(b,c,d,e){var f,g=document.createElement(b);if(c&&c.appendChild(g),d)for(f=0;f!==d.length;f++)g.classList.add(d[f]);return e&&a.each(e,function(a,b){e.hasOwnProperty(b)&&g.setAttribute(b,a)}),g}function o(a,b,c){var d=a.getAttribute(b);return d?e.toBoolean(d,"true"):c}function p(a,b,c){var d=a.getAttribute(b);return d?e.toInteger(d):c}function q(a,b,c){var d=a.getAttribute(b);return d?e.toString(d):c}function r(a){for(;a.firstChild;)a.removeChild(a.firstChild)}return{register:g,ViewModel:h,upgrade:i,build:n,booleanAttribute:o,intAttribute:p,stringAttribute:q,clearDom:r}});
define('system/lang/string',[],function(){"use strict";String.prototype.toStaticHTML=function(){return window.toStaticHTML?window.toStaticHTML(this).trim():this.trim()},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.startsWith=function(a,b){void 0===b&&(b=!0);var c=b?a.toLowerCase():a,d=a.length;return(b?this.toLowerCase():this).substr(0,d)===c},String.prototype.format=function(){var a=arguments,b=/\{(\d|\d\d)\}/g,c=/\d+/;return this.replace(b,function(b){var d=1*b.match(c)[0];return void 0!==a[d]?a[d]:""===a[d]?"":b})},String.isNullOrWhitespace=function(a){return void 0===a||null===a||("string"!=typeof a&&(a=a.toString()),""===a.trim())},String.compare=function(a,b){return void 0!==a&&null!==a&&void 0!==b&&null!==b&&a.toLocaleLowerCase().localeCompare(b.toLocaleLowerCase())},String.escapeRegex=function(a){return String(a).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},String.prototype.endsWith=function(a,b){
var c=this.toString();("number"!=typeof b||!isFinite(b)||Math.floor(b)!==b||b>c.length)&&(b=c.length),b-=a.length;var d=c.lastIndexOf(a,b);return d!==-1&&d===b}});
define('ui/elements/select/view-model',['require','lodash','jquery','text!./template.html','text!./options-template.html','knockout','spa/region','./element','system/hardware/device','system/lang/string','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./template.html"),d=require("text!./options-template.html"),e=require("knockout"),f=require("spa/region"),g=require("./element"),h=Object.resolve(require("system/hardware/device"));require("system/lang/string"),require("system/lang/object");function i(a){j.call(this,c,!1,!1);var b=this;this.element=a,this.isOpen=null,this.selectedItem=null,this.text=null,this.showAllOptions=null,this.textFocus=null,this.keyPressed=null,this.optionsValue=null,this.optionsText=null,this.optionsGroup=null,this.multiple=null,this.optionsCaption=null,this.options=null,this.value=null,this.required=null,this.disabled=null,this.editable=null,this.selectedOptions=null,this.isRequired=null,this.currentText=null,this.currentMatchedOptions=null,this._selectedOptions=[],this.updated_selectedOptions=!1,this.propertiesUpdateDone=!0,this.selectedValueText=null,this.filteredOptions=null,this.isMobile=h.isMobile(),
this.optionsRegion=new f("","blah"),b.optionsContainerDiv=null,this.isClicked=!1,this.documentHandlerFn=w.bind(null,b),this.isRequiredSubscriber=null,this.filteredOptionsSubscriber=null}var j=Object.inherit(g.ViewModel,i);function k(b){if(!b.options)return[];var c=[].concat(b.options()),d=b.text(),f=[],g=b.optionsGroup(),h=c,i=[],j,k=b.optionsCaption(),n,o;if(c&&c.length)if(i=m(b,h,d),j=k!==d,!b.showAllOptions()&&("object"!=typeof b.options()[0]||b.optionsText())&&b.text()&&"object"!=typeof b.text()&&j&&b.keyPressed()&&(d=l(d),n=new RegExp(d.trim(),"i"),o=e.utils.arrayFilter(c,function(a){var c=b.getOptionText(a);return n.test(c)}),(!i||i&&o.length>1)&&(h=o.length?o:c)),"object"==typeof h[0]&&g){var p=a.groupBy(h,g),q={undefined:[]};f=p?p:q}else f=h;return f}function l(a){return a=a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}i.prototype.beforeAttached=function(){var c=this;this.init(),b(document).off("mousedown",this.documentHandlerFn).on("mousedown",this.documentHandlerFn),
this.bindAttribute("multiple",!1,C.bind(null,this),!0),this.bindAttribute("editable",!0,null,!0),this.bindAttribute("value",null,D.bind(null,this),!0),this.bindAttribute("selectedOptions",[],E.bind(null,this),!0),this.bindAttribute("optionsCaption",null,null,!0),this.bindAttribute("optionsText",null,null,!0),this.bindAttribute("optionsValue",null,null,!0),this.bindAttribute("optionsGroup",null,null,!0),this.bindAttribute("disabled",!1,q.bind(null,c),!0),this.bindAttribute("required",!1,null,!0),this.bindAttribute("options",[],B.bind(null,c),!0),this.resizeProxy=b.proxy(a.debounce(this.resize,100),this),this.scrollProxy=b.proxy(this.resize,this)},i.prototype.init=function a(){var b=this;this.isOpen=e.observable(!1),this.keyPressed=e.observable(),this.selectedItem=e.observable(),this.text=e.observable(),this.showAllOptions=e.observable(!1),this.textFocus=e.observable(),this.optionsValue=e.observable(),this.optionsText=e.observable(),this.optionsGroup=e.observable(),
this.multiple=e.observable(!1),this.optionsCaption=e.observable(""),this.options=e.observableArray([]),this.value=e.observable(),this.required=e.observable(!1),this.disabled=e.observable(!1),this.editable=e.observable(!0),this.selectedOptions=e.observableArray([]),this.propertiesUpdateDone=e.observable(!0),this.isRequired=e.computed(o.bind(b,b)),this.isRequiredSubscriber=this.isRequired.subscribe(r.bind(b,b)),this.selectedValueText=e.computed(y.bind(null,this)),this.filteredOptions=e.computed(k.bind(null,this)),this.filteredOptionsSubscriber=this.filteredOptions.subscribe(p.bind(b,b))};function m(b,c,d){return d!==b.currentText&&(b.currentText=d,b.currentMatchedOptions=a.find(c,n.bind(b,b,d))),b.currentMatchedOptions}function n(a,b,c){var d=a.getOptionText(c);return d&&d.toString()===b.toString()}function o(a){return a.required()&&!a.hasValue()}function p(a,b){a.setOptionContainerPosition.bind(null,a)(b),M.bind(null,a)(b)}function q(a,c){
c?b(a.element).addClass("mi-select-disabled"):b(a.element).removeClass("mi-select-disabled")}function r(a,c){a.isRequired()?b(a.element).addClass("mi-select-required"):b(a.element).removeClass("mi-select-required")}i.prototype.afterAttached=function(){var a=this},i.prototype.afterDetached=function(){this.isOpen(!1),b(this.optionsContainerDiv).remove(),this.isOpen=null,this.selectedItem=null,this.text=null,this.showAllOptions=null,this.textFocus=null,this.optionsValue=null,this.optionsText=null,this.optionsGroup=null,this.multiple=null,this.optionsCaption=null,this.options=null,this.value=null,this.required=null,this.disabled=null,this.editable=null,this.selectedOptions=null,this.isRequired=null,this.keyPressed=null,this.selectedValueText=null,this.filteredOptions=null,b(document).off("mousedown",this.documentHandlerFn),this.isRequiredSubscriber&&this.isRequiredSubscriber.dispose(),this.filteredOptionsSubscriber&&this.filteredOptionsSubscriber.dispose()},
i.prototype.selectValue=function(c,d,e){if(e&&(e.preventDefault(),e.stopPropagation()),c.disabled())return!1;if(c.multiple()){if(c.multiple()){if(!d)return!0;var f=c.selectedOptions(),g=f||[],h=c.getOptionValue(d);b.inArray(h,c.selectedOptions())===-1?(c._selectedOptions.push(d),g.push(h)):(c._selectedOptions=b.grep(c._selectedOptions,function(a){return c.getOptionValue(a)!==h}),g=b.grep(g,function(a){return a!==h})),c.updated_selectedOptions=!0,c.selectedOptions(g),b(c.element).trigger("properties.selectedOptions:changed",[g]),c.textFocus(!0)}}else{var i;if(c.selectedItem(d),a.isEqual(d,c.value()))y(c);else{if(d){var j=c.getOptionValue(d);return i=j,c.isOpen(!1),u(c),c.value&&c.value(j),b(c.element).trigger("properties.value:changed",[i]),b(c.element).trigger("selected",[c.value?c.value():c.value]),!0}c.value("");var k=c.optionsCaption()?c.optionsCaption():"";c.text(k),i="",b(c.element).trigger("properties.value:changed",[i])}c.textFocus(!0),c.isOpen(!1),u(c),
b(c.element).trigger("selected",[c.value()])}return!0},i.prototype.toggleSelectAll=function(a,c){var d=this;if(d.disabled())return!0;if(d.selectedOptions().length||d.selectedOptions().length===d.options().length)d._selectedOptions=[],d.updated_selectedOptions=!0,d.selectedOptions([]),b(d.element).trigger("properties.selectedOptions:changed",[[]]);else if(!d.selectedOptions().length){var e=s(d.options(),d.getOptionValue.bind(d));d._selectedOptions=d.options(),d.updated_selectedOptions=!0,d.selectedOptions(e),b(d.element).trigger("properties.selectedOptions:changed",[e])}return!0};function s(a,b){var c=[],d;for(d=0;d<a.length;d++)c.push(b(a[d]));return c}i.prototype.toggleOptions=function(a,c){c.stopPropagation();var d=this;return!(d.disabled()||d.options()&&!d.options().length)&&(d.isClicked=!0,b(document).trigger("mousedown",[d.element]),this.showAllOptions(!0),d.isOpen()?(u(d),b(d.element).trigger("selected",[d.multiple()?d.selectedOptions():d.value()])):(F(d),t(d)),
d.isOpen()||b(d.optionsContainerDiv).css("visibility","hidden"),d.textFocus()||d.textFocus(!0),d.isOpen(!d.isOpen()),!0)};function t(a){b(a.element).parents().on("scroll",a.scrollProxy)}function u(a){b(a.optionsContainerDiv).css("visibility","hidden"),b(a.element).parents().off("scroll",a.scrollProxy),L(a)}i.prototype.showOptions=function(a){var c=this;this.showAllOptions(c.multiple()),this.isOpen()||13===a.keyCode||c.disabled()||(b(c.optionsContainerDiv).css("visibility","hidden"),c.isClicked=!0,b(document).trigger("mousedown",[c.element]),this.isOpen(!0),F(this),t(c))},i.prototype.handleMouseDown=function a(b,c){return c.stopPropagation(),!0},i.prototype.handleKeyUpOnTextInput=function a(b,c){return c.stopPropagation(),this.isOpen()||this.keyPressed(!1),"keyup"===c.type&&this.keyPressed(!0),this.showOptions(c),!0},i.prototype.handleKeyDownOnTextInput=function a(c,d){var e=this,f;if(d.stopPropagation(),b(e.element).trigger("textChange",[d]),9===d.keyCode)e.isOpen(!1),u(e),f=!e.text(),
y(e),b(e.element).trigger("selected",[e.multiple()?e.selectedOptions():e.value()]),x(e,f);else{if(8===d.keyCode&&(e.multiple()||e.disabled()))return!1;this.showAllOptions(e.multiple()),J.bind(null,e)(d)}return!0},i.prototype.getValue=function(a){return"function"==typeof a?a():a},i.prototype.getReturnValue=function(a,b){return"function"==typeof a?b?a.call(b,b):b:b?b[a]:b},i.prototype.getOptionText=function(a){var b=this;return a&&b.optionsText()?b.getValue(b.getReturnValue(b.optionsText(),a)):a},i.prototype.getOptionValue=function(a){var b=this;return a&&b.optionsValue()?b.getValue(b.getReturnValue(b.optionsValue(),a)):a},i.prototype.hasValue=function(){var a=this;if(a.multiple()){if(a.selectedOptions()&&0===a.selectedOptions().length)return!1}else if(!a.value())return!1;return!0},i.prototype.isActive=function(c){var d=this
;return d.multiple()?b.inArray(d.getOptionValue(c),d.selectedOptions())!==-1:"object"!=typeof d.value()||d.optionsValue()?d.getOptionValue(c)===d.value():a.isEqual(c,d.value())},i.prototype.resize=function(){this.isOpen(!1),v(this)},i.prototype.wrapOptionText=function(a){var b=this,c=b.getOptionText(a),d=b.text(),e,f=c,g=b.options(),h;return h=m(b,g,d),c&&d&&d.trim()&&!h&&(d=l(d),e=new RegExp(d,"gi"),c&&"string"==typeof c&&(c=R(c)),f=c.replace(e,function(a){return"<b>"+a+"</b>"}),f=f.replace(/ /g,"&nbsp;")),f&&"string"==typeof f&&(f=R(f)),f},i.prototype.setFocus=function b(){var c=this;a.defer(c.showOptions.bind(c,{}))};function v(a){u(a)}function w(a,c){var d;a.isClicked?a.isClicked=!1:(a.isOpen&&a.isOpen()&&(a.isOpen(!1),u(a),b(a.element).trigger("selected",[a.multiple()?a.selectedOptions():a.value()]),d=!a.text()),y(a),x(a,d))}function x(a,c){
if(c)if(a.multiple()||null!==a.optionsCaption()&&""!==a.optionsCaption()||!a.options()||!a.options().length)!a.multiple()&&a.options()&&a.options().length&&(a.value(""),b(a.element).trigger("properties.value:changed",[""]));else{var d=a.getOptionValue(a.options()[0]);a.value(d),b(a.element).trigger("properties.value:changed",[d])}}function y(a,c){if(a.options){var d=null,e=a.options(),f=null,g=null,h="";if(!a.multiple()&&(null===a.optionsCaption()||""===a.optionsCaption())&&!a.value()&&a.options()&&e.length&&a.propertiesUpdateDone()){var i=a.getOptionValue(e[0]);a.value(i),b(a.element).trigger("properties.value:changed",[i])}if(a.multiple()){if(a.options()&&e.length&&a.selectedOptions()&&a.selectedOptions().length){var j=a.selectedOptions(),k="",l;return k=s(a._selectedOptions,a.getOptionText.bind(a)).join(" | "),h=k,a.text(h),h}}else if((null!==a.value()||""!==a.value())&&a.options()&&e.length){for(var m=0;m<e.length;m++)if(g=A(a,e[m],a.value())){d=g;break}
if(d)return h=a.getOptionText(d),a.text(h),h}return h=a.optionsCaption()||"",a.text(h),h}}function z(a,b,c){for(var d=[],e,f=0;f<c.length;f++){var g=c[f];if(null!==g)for(var h=0;h<b.length;h++)if(e=A(a,b[h],g)){d.push(e);break}}return d}function A(b,c,d){var e=b.getOptionValue(c),f=null;return void 0===d||null===d||void 0===e||null===e?f:("function"==typeof d.numericValue&&null!==d.numericValue()&&(d=d.numericValue()),b.optionsValue()?e.toString()===d.toString()&&(f=c):c===d.toString()?f=c:"object"==typeof d&&a.isEqual(d,c)&&(f=c),f)}function B(a,b){b.length||(a.value,a.selectedOptions&&a.selectedOptions([])),a.multiple()&&a.selectedOptions&&(a.updated_selectedOptions||(a._selectedOptions=z(a,b,a.selectedOptions()),y(a)),a.updated_selectedOptions=!1)}function C(a){}function D(a,c){null!==c&&b(a.element).trigger("valueChange",[c])}function E(a,c){if(a.multiple()){var d=a.options();a.updated_selectedOptions||(a._selectedOptions=z(a,d,c)),a.updated_selectedOptions=!1,
b(a.element).trigger("valueChange",[c])}}function F(a){a.optionsCaption()===a.text()&&a.text(""),G(a),a.setOptionContainerPosition(a),setTimeout(function(a){if("function"==typeof a.options&&"function"==typeof a.text){var c=m(a,a.options(),a.text());a.text()&&a.optionsCaption()!==a.text()&&c&&!a.isMobile&&b(a.element).find(".mi-selected-value-text").select()}}.bind(a,a),100)}function G(a){var c,f;b("body").find(".select-outer-container").length?c=b("body").find(".select-outer-container"):(c=document.createElement("div"),b(c).addClass("select-outer-container"),document.body.appendChild(c)),a.optionsContainerDiv||(f=document.createElement("div"),a.optionsContainerDiv=f,b(f).css("visibility","hidden"),b(c).append(f),a.optionsRegion.setElement(f),a.optionsRegion.attach(d),e.applyBindings(a,a.optionsRegion.activeContainer))}i.prototype.setOptionContainerPosition=function(a){var c,d,e,f,g,h,i,j=a.optionsContainerDiv;if(j){if(e=b(a.element).outerHeight(),
c=b(a.container).find(".mi-dropdown-selector").offset(),d=b(a.container).find(".mi-dropdown-selector").width(),!c)return;a.topOffset=c?c.top:0,a.leftOffset=c?c.left:0,b(j).css({position:"absolute","min-width":d,"z-index":1e5}),b(a.element).closest(".dialog-wrapper").length>0&&b(j).css({"max-width":d}),setTimeout(H.bind(null,a,j,c,d,e),1)}};function H(a,c,d,e,f){var g=b(c).outerWidth(),i=b(c).outerHeight(),j,k,l=b(c).find(".mi-select-options-container");l.removeClass("top-left top-right bottom-left bottom-right"),!a.isMobile&&h.innerHeight()<700&&b(".select-outer-container .mi-select-options-container").css("max-height","200px"),d.top+i+50>=b(window).height()?(j=d.top-i-20,d.left+e-g<80?(k=d.left,l.addClass("top-left")):(k=d.left-Math.abs(e-g),l.addClass("top-right"))):(j=a.topOffset+f+10,d.left+e-g<80?(k=d.left,l.addClass("bottom-left")):(k=d.left-Math.abs(e-g)+7,l.addClass("bottom-right"))),b(c).css({left:k,top:j,visibility:"visible"}),
b(c).find(".mi-select-option").hasClass("focus")||!a.multiple||a.multiple()||Q(a,"active")}function I(a){}function J(a,b){switch(b.keyCode){case 40:b.preventDefault(),O(a,b);break;case 38:b.preventDefault(),P(a,b);break;case 13:b.preventDefault(),K(a,b);break;default:return}}function K(a,c){var d=a.optionsContainerDiv,f=b(d).find(".mi-select-option.focus");if(f.length&&e.contextFor(b(f[0]).get(0))){var g=e.contextFor(b(f[0]).get(0)).$data;b(f[0]).hasClass("mi-select-caption")&&(g=null),a.selectValue(a,g,c),a.multiple()||(a.isOpen(!1),v(a),b(a.element).trigger("selected",[a.value()]),a.textFocus(!0))}}function L(a){var c=a.optionsContainerDiv;b(c).find(".mi-select-option").removeClass("focus")}function M(a){setTimeout(N.bind(null,a),10)}function N(a){if(!a.options||a.multiple&&a.multiple()||a.isOpen&&!a.isOpen())return!1;var c=a.options(),d=a.text(),e=!1,f=a.optionsContainerDiv;if(c&&c.length&&(e=m(a,c,d)),!e&&d&&d!==a.optionsCaption()){L(a);var g=a.optionsCaption()?1:0
;b(b(f).find(".mi-select-option")[g]).addClass("focus"),Q(a)}else e&&d&&d!==a.optionsCaption()&&(L(a),b(b(f).find(".mi-select-option")).filter(function(){return b(this).text()===d}).addClass("focus"),Q(a));!d&&a.value()&&(L(a),a.value()&&Q(a,"active"))}function O(a){var c=a.optionsContainerDiv,d=b(c).find(".mi-select-option.focus"),e=b(c).find(".mi-select-option.active"),f;b(c).find(".mi-select-option").removeClass("focus"),f=d.length&&b(d).nextAll(".mi-select-option:first").length?b(d).nextAll(".mi-select-option:first"):d.length&&!b(d).nextAll(".mi-select-option:first").length?b(b(c).find(".mi-select-option")[0]):e.length?b(e).nextAll(".mi-select-option:first"):b(b(c).find(".mi-select-option")[0]),f.addClass("focus");var g=a.options(),h=a.text(),i;g&&g.length&&((i=m(a,g,h))||a.optionsCaption()&&a.optionsCaption()===h)&&a.text(f.text()),Q(a)}function P(a){var c=a.optionsContainerDiv,d=b(c).find(".mi-select-option.focus"),e=b(c).find(".mi-select-option.active"),f
;b(c).find(".mi-select-option").removeClass("focus"),f=d.length&&b(d).prevAll(".mi-select-option:first").length?b(d).prevAll(".mi-select-option:first"):d.length&&!b(d).prevAll(".mi-select-option:first").length?b(c).find(".mi-select-option").last():e.length?b(e).prevAll(".mi-select-option:first"):b(b(c).find(".mi-select-option")[0]),f.addClass("focus");var g=a.options(),h=a.text(),i;g&&g.length&&((i=m(a,g,h))||a.optionsCaption()&&a.optionsCaption()===h)&&a.text(f.text()),Q(a)}function Q(a,c){var d=a.optionsContainerDiv,e=c||"focus",f=b(d).find(".mi-select-option."+e);f&&f[0]&&(f[0].parentNode.scrollTop=f[0].offsetTop)}function R(a){return a.replace(/<([a-z]+)([^>]*[^\/])?>(?![\s\S]*<\/\1)/gi,function(a){return b("<div/>").text(a).html()})}return g.register("mi-select",i),i});

define('text!ui/elements/checkbox/template.html',[],function () { return '<div class="checkbox-noko-container">\r\n    <input type="checkbox" />\r\n    <label class="">\r\n        <span class="checkbox-label"></span>\r\n        <span class="chkbox-text"></span>\r\n    </label>\r\n   \r\n</div>';});

define('ui/elements/checkbox/view-model',['require','jquery','text!./template.html','knockout'],function(require){"use strict";var a=require("jquery"),b=require("text!./template.html"),c=require("knockout"),d=Object.create(HTMLElement.prototype);d.createdCallback=function(){this.implementation=Object.resolve(e),this.implementation.element=this,this.implementation.$element=a(this),Object.tryMethod(this.implementation,"created")},d.attachedCallback=function(){Object.tryMethod(this.implementation,"attached")},d.detachedCallback=function(){Object.tryMethod(this.implementation,"detached")},d.attributeChangedCallback=function(a,b,c){Object.tryMethod(this.implementation,a+"Changed",b,c)};function e(){this.element=null,this.$element=null,this.$input=null,this.$container=b,this.inputChangeHandler=f.bind(null,this),this.init={}}e.prototype.created=function b(){var c=this;this.Node=document.createElement("div"),a(this.Node).append(),a(this.element).empty().append(this.$container),this.$input=this.$element.find('input[type="checkbox"]'),this.$label=this.$element.find("label")
;var d=this.getGuid();this.$input.attr("id",d),this.$label.attr("for",d),this.setAccessor("text",g.bind(this,this,"text")),this.setAccessor("checked",g.bind(this,this,"checked")),this.setAccessor("disabled",g.bind(this,this,"disabled")),this.setAccessor("value",g.bind(this,this,"value")),this.setAccessor("name",g.bind(this,this,"name"))},e.prototype.attached=function a(){this.$input.on("change",this.inputChangeHandler)},e.prototype.detached=function a(){this.$input.off("change",this.inputChangeHandler)};function f(a,b){a.$element.parents("mi-widget").length&&b.stopPropagation(),a.checked(b.currentTarget.checked),a.$element.trigger("checkedChange",[b.currentTarget.checked,a.value()])}function g(a,b,c){return"text"===b?void a.$element.find(".chkbox-text").html(c):"checked"===b?void(a.$input.get(0).checked="checked"===c||h(c)):"disabled"===b?void a.$input.prop("disabled",h(c)):void(a.$input&&a.$input.prop(b,c))}function h(a){return"false"!==a&&a!==!1&&("true"===a||a===!0)}
e.prototype.setAccessor=function(a,b){this[a]=c.observable(),Object.defineProperty(this.element,a,{get:i.bind(this,this,a),set:j.bind(this,this,a)}),this[a+"Changed"]=k.bind(this,this,a),this[a].subscribe(l.bind(this,this,b)),this[a](this.element.getAttribute(a))};function i(a,b){return a[b]()}function j(a,b,c){a[b](c)}function k(a,b,c,d){a[b](d)}function l(a,b,c){b&&b.call(a,c)}return e.prototype.getGuid=function a(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},e.prototype.s4=function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},Element.registerElement("mi-checkbox-noko",{prototype:d}),e});

define('text!ui/elements/radio/template.html',[],function () { return '<div class="radio-noko-container">\r\n    <input type="radio" tabindex="0" />\r\n    <label class="">\r\n        <span class="radio-label"></span>\r\n        <span class="radio-text"></span>\r\n    </label>\r\n\r\n</div>';});

define('ui/elements/radio/view-model',['require','jquery','text!./template.html','knockout'],function(require){"use strict";var a=require("jquery"),b=require("text!./template.html"),c=require("knockout"),d=Object.create(HTMLElement.prototype);d.createdCallback=function(){this.implementation=Object.resolve(e),this.implementation.element=this,this.implementation.$element=a(this),Object.tryMethod(this.implementation,"created")},d.attachedCallback=function(){Object.tryMethod(this.implementation,"attached")},d.detachedCallback=function(){Object.tryMethod(this.implementation,"detached")},d.attributeChangedCallback=function(a,b,c){Object.tryMethod(this.implementation,a+"Changed",b,c)};function e(){this.element=null,this.$element=null,this.$input=null,this.$container=b,this.init={}}e.prototype.created=function(){var b=this;this.Node=document.createElement("div"),a(this.Node).append(this.$container),a(this.element).html(this.Node),this.$input=this.$element.find('input[type="radio"]'),this.$label=this.$element.find("label");var c=this.getGuid();this.$input.attr("id",c),
this.$label.attr("for",c),this.$input.on("change",function(a){b.checked(a.currentTarget.checked),b.$element.trigger("checkedChange",[a.currentTarget.checked,b.value(),b.name()])}),this.setAccessor("text",f.bind(this,this,"text")),this.setAccessor("checked",f.bind(this,this,"checked")),this.setAccessor("value",f.bind(this,this,"value")),this.setAccessor("name",f.bind(this,this,"name"))};function f(a,b,c){return a.init[b]&&"null"!==c?"text"===b?void a.$element.find(".radio-text").html(c):"checked"===b?void(a.$input.get(0).checked=g(c)):"disabled"===b?void a.$input.prop("disabled",g(c)):void(a.$input&&a.$input.prop(b,c)):void(a.init[b]=!0)}function g(a){if(!a)return!1;var b=a.toString();return"false"!==b&&"true"===b}return e.prototype.setAccessor=function(a,b){this[a]=c.observable(),this[a+"_canSet"]=!0,Object.defineProperty(this.element,a,{get:function(){return this[a]()}.bind(this),set:function(b){this[a+"_canSet"]=!1,this[a](b),this.element.setAttribute(a,b)}.bind(this)}),
this[a+"Changed"]=function(b,c){this[a+"_canSet"]=!1,this[a](c),this.element[a]=c}.bind(this),this[a].subscribe(function(c){b&&b.call(this,c),this.element.setAttribute(a,c),this.element[a]=c}.bind(this)),this[a](this.element.getAttribute(a)),b&&b.call(this,this.element.getAttribute(a))},e.prototype.attached=function(){},e.prototype.getGuid=function a(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},e.prototype.s4=function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},Element.registerElement("mi-radio-noko",{prototype:d}),e});
define('ui/elements/filter/filter-no-ko',['require','lodash','jquery','text!./filter-btn-no-ko-view.html','text!./filter-body-no-ko-view.html','text!./filter-group-no-ko-view.html','./filter-collection-no-ko','system/lang/converter','system/globalization/translator','spa/conductor','spa/region','ui/elements/select/view-model','ui/elements/checkbox/view-model','ui/elements/radio/view-model'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./filter-btn-no-ko-view.html"),d=require("text!./filter-body-no-ko-view.html"),e=require("text!./filter-group-no-ko-view.html"),f=require("./filter-collection-no-ko"),g=require("system/lang/converter"),h=require("system/globalization/translator"),i=require("spa/conductor"),j=require("spa/region");require("ui/elements/select/view-model"),require("ui/elements/checkbox/view-model"),require("ui/elements/radio/view-model");var k=Object.create(HTMLElement.prototype);k.createdCallback=function(){var c=this;this.resizeProxy=b.proxy(a.debounce(this.resize,100),this),this.scrollProxy=b.proxy(this.scroll,this),this.translator=Object.resolve(h),this.isClicked=!1,this.element=this,this.$element=null,this.isVisible=!1,this.isFilterScrollable=this.getFilterScrollable(),this.loader=null,this.filterOptions=[],this.filterCollection=new f,this.filterVMRegion=null,this.tags=[],
this.customHTML=this.getAttribute("custom-html"),this.customFilter=this.getAttribute("custom-filter"),this.documentClickHandlerFn=r.bind(null,this),c.conductor=Object.resolve(i),c._filterViewModel=null,Element.defineProperty(c,"filterViewModel",{get:n.bind(null,c),set:o.bind(null,c)}),this._loader=null,Element.defineProperty(c,"loader",{get:t.bind(null,c),set:u.bind(null,c)}),this.callback=null,Element.defineProperty(c,"filterCB",{get:function(){return c.callback},set:function(a){c.callback=a}}),this._popupWidth=null,Element.defineProperty(c,"popupWidth",{get:function(){return c._popupWidth},set:function(a){c._popupWidth=a}}),this._showHeading=!0,Element.defineProperty(c,"showHeading",{get:function(){return c._showHeading},set:function(a){void 0!==a&&(c._showHeading=g.toBoolean(a,"true"))}}),this._showTags=!0,Element.defineProperty(c,"showTags",{get:function(){return c._showTags},set:function(a){void 0!==a&&(c._showTags=g.toBoolean(a,"true"))}}),this._maxHeight=null,
Element.defineProperty(c,"maxHeight",{get:function(){return c._maxHeight},set:function(a){c._maxHeight=a}}),this._internalIcon=null,Element.defineProperty(c,"icon",{get:function(){return c._internalIcon}.bind(c),set:function(a){l(c,a)}.bind(c)}),this._disabled=b(this).is("[disabled]"),Element.defineProperty(c,"disabled",{get:function(){return c._disabled}.bind(c),set:function(a){m(c,a)}.bind(c)}),c._internalIcon&&l(c,c._internalIcon)},k.attachedCallback=function(){this.setElement(),this.htmlToDisplay=this.element.innerHTML,this.element.innerHTML=c,this.attachClickHandlers(),l(this,this._internalIcon),m(this,this._disabled)},k.detachedCallback=function(){this.customFilter&&(q(this),this.conductor.unloadScreen(this.filterViewModel),this.conductor.closeScreen(this.filterViewModel)),b(document).find("#shell-screen").off("mousedown.mifilter touchstart click",this.documentClickHandlerFn),W(this),this.resizeProxy=null,this.scrollProxy=null,this.translator=null,this.isClicked=null,
this.isVisible=!1,this.isFilterScrollable=null,this.loader=null,this.filterOptions=null,this.filterCollection&&(this.filterCollection.clear(),this.filterCollection=null),this.filterVMRegion=null,this.tags=null,this.customHTML=null,this.customFilter=null,this.documentClickHandlerFn=null,this.conductor=null,this._loader=null,this.callback=null,this._popupWidth=null,this._showHeading=null,this._showTags=null,this._maxHeight=null,this._internalIcon=null,this._disabled=null,this._filterViewModel=null,this.filterViewModel=null,this.$element=null},k.attributeChangedCallback=function(a,b,c){var d=this;"custom-html"===a?(d.customHTML=c,W(d),"true"===c&&z(d)):"custom-filter"===a?(d.customFilter=c,W(d),"true"===c&&d.isVisible&&(d.conductor.openScreen(d._filterViewModel),d.conductor.loadScreen(d._filterViewModel),z(d))):"icon"===a?l(d,c):"disabled"===a&&m(d,c)};function l(a,c){a._internalIcon=c?c.trim():"icon-collection-filter",b(a).find("button i").removeAttr("class").addClass(a._internalIcon)}
function m(a,c){void 0!==c&&(a._disabled=c),a._disabled?b(a).find("button").addClass("disabled"):b(a).find("button").removeClass("disabled")}k.load=function(){var a;return this.loader?(a=this.loader(),a.promise()):b.Deferred().done().promise()},k.setElement=function(){this.$element=b(this.element)},k.attachClickHandlers=function(){this.$element.find(".icon-container").on("click",v.bind(null,this)),b(document).find("#shell-screen").on("mousedown.mifilter touchstart click",this.documentClickHandlerFn),this.find=s.bind(null,this)},k.detachClickHandlers=function(){},k.resize=function(a){b(a).find(".icon-container").is(":visible")&&a.isVisible&&X(this)},k.scroll=function(a){g.toBoolean(a.isFilterScrollable,"true")?a.resize(a):(w(a),a.isVisible=!1)},k.getFilterScrollable=function(){return this.getAttribute("isfilterscrollable")||!0},k.closeFilter=function(){w(this)};function n(a){return a._filterViewModel}function o(a,b){b?(a._filterViewModel=b,
"true"===a.getAttribute("custom-filter")&&(a.conductor.openScreen(a._filterViewModel),a.conductor.loadScreen(a._filterViewModel))):a._filterViewModel=null}function p(a){var c=new j;a.filterVMRegion=c,c.setElement(b(".filter-outer-container .filters-noko")),a.conductor.activateScreen(a.filterViewModel),a.conductor.attachScreen(a.filterViewModel,c)}function q(a){a.conductor.deactivateScreen(a.filterVMRegion),a.conductor.detachScreen(a.filterVMRegion)}function r(a,c,d){a.isClicked?a.isClicked=!1:b(".filter-outer-container").find(c.target).length||b(".filter-outer-container").find(d).length||b(c.target).closest(".icon-filter-container").length||w(a)}function s(a,c){return b(a.htmlToDisplay).find(c)[0]}function t(a){return a._loader}function u(a,b){a._loader=b,a.isPopulated=!1,a.filterCollection&&a.filterCollection.clear()}function v(a,b){b.stopPropagation(),a._disabled||(a.isVisible?w(a):x(a))}function w(a){a.isVisible=!1,b(window).off("resize",a.resizeProxy.bind(null,a)),
b(a).parents().off("scroll",a.scrollProxy.bind(null,a)),a.contentContainer&&b(a.contentContainer).off(" click","**"),"true"===a.customFilter&&q(a),W(a)}function x(a){a.isClicked=!0,a.isVisible=!0,b(document).find("#shell-screen").trigger("mousedown.mifilter"),"true"===a.customHTML||"true"===a.customFilter?z(a):a.load().done(y.bind(null,a))}function y(a,b){a.filterOptions=b,z(a)}function z(a){V(a),"true"===a.customHTML?b(".filter-outer-container .filters-noko").empty().append(a.htmlToDisplay):"true"===a.customFilter?p(a):(a.filterOptions.sortOptions&&a.filterOptions.sortOptions.length?B(a):b(".filter-outer-container .sort-header").hide(),E(a)),Y(a),X(a),A(a)}function A(a){null!==a._maxHeight&&b(".filter-outer-container .filter-body").css({"max-height":a._maxHeight+"px"})}function B(a){var c=b(".filter-outer-container .sort-header")[0],d,e;for(b(c).append('<mi-select class="sort-dropdown"></mi-select>'),d=b(c).find(".sort-dropdown")[0],e=0;e<a.filterOptions.sortOptions.length;e++);
b(d).data("options",a.filterOptions.sortOptions),b(d).attr("data-options",JSON.stringify(a.filterOptions.sortOptions)),C(a)}function C(a){b(".filter-outer-container .sort-header .sort-dropdown").on("valueChange",function(c){c.preventDefault(),D(a,"sort",b(this).val())})}function D(a,b,c){Object.tryMethod(a,"callback",b,c)}function E(a){a.isPopulated||(F(a),a.isPopulated=!0),G(a),L(a),a.contentContainer.find(".clear-all a").on("click",Q.bind(null,a))}function F(a){a.filterCollection.populateGroups(a.filterOptions)}function G(a){var b,c=a.filterCollection,d=c.filterGroups;for(a.tags=[],b=0;b<d.length;b++)H(a,d[b],b)}function H(a,c,d){var f=a.contentContainer.find(".filter-body").get(0),g=b(e),h,i,j;if(g.data("group-index",d),i=g.find("header"),j=g.find(".form-item div").get(0),I(i,c.caption),"select"===a.filterCollection.filterGroups[d].type)J(a,j,c,d);else for(h=0;h<c.items.length;h++)K(a,j,c.items[h],h,d);b(f).append(g)}function I(a,c){b(a).append(c)}function J(a,c,d,e){
for(var f=d.hideCaption?b('<mi-select data-optionsvalue="value" data-optionstext="text"></mi-select><br />').data({"group-index":e}):b('<mi-select data-optionsvalue="value" data-optionstext="text" data-optionscaption="'+a.filterCollection.filterGroups[e].caption+'"></mi-select><br />').data({"group-index":e}),g=0;g<d.items.length;g++)if(d.items[g].isSelected){b(f[0]).data("value",d.items[g].value),b(f[0]).attr("data-value",d.items[g].value),T(a,{target:f[0]},d.items[g].value,d.caption,d.items[g].text);break}b(f).data("options",d.items),b(f).attr("data-options",JSON.stringify(d.items)),b(c).append(f)}function K(a,c,d,e,f){var g,h;"checkbox"===a.filterCollection.filterGroups[f].type?g=b('<mi-checkbox-noko  value="'+d.value+'" text="'+d.text+'" ></mi-checkbox-noko><br />').data({"group-index":f,"item-index":e,item:d
}):"radio"===a.filterCollection.filterGroups[f].type&&(g=b('<mi-radio-noko  value="'+d.value+'" text="'+d.text+'" name="'+a.filterCollection.filterGroups[f].caption+'" ></mi-radio-noko>').data({"group-index":f,"item-index":e,item:d})),b(c).append(g),d.isSelected&&"checkbox"===a.filterCollection.filterGroups[f].type?(T(a,{target:g[0]},d.value,h,d.text),b(g[0]).attr("checked",d.isSelected)):d.isSelected&&"radio"===a.filterCollection.filterGroups[f].type&&(h=a.filterCollection.filterGroups[f].caption,T(a,{target:g[0]},d.value,h,d.text),g[0].setAttribute("checked",d.isSelected)),b(c).append(g)}function L(a){var b=a.contentContainer.find(".filter-body"),c,d,e;c=b.find("mi-checkbox-noko"),c&&(Element.upgrade(c),c.on("checkedChange",O.bind(null,a))),d=b.find("mi-radio-noko"),d&&(Element.upgrade(d),d.on("checkedChange",N.bind(null,a))),(e=b.find("mi-select"))&&(Element.upgrade(e),e.on("valueChange",M.bind(null,a)))}function M(c,d,e){d.preventDefault()
;var f=b(d.target).data(),g=parseInt(f["group-index"]),h=c.filterCollection.filterGroups[g],i=h.caption;if(e){R(c,i);var j=a.find(h.items,function(a){if(a&&a.value===e)return a});T(c,d,e,i,j.text)}else{P(c,e);var k=b(d.target).data("tag");k&&k.remove()}for(var l=h.type,m=c.filterCollection.filterGroups[g].items,n,o=0;o<m.length;o++)m[o].isSelected=!1,void 0!==m[o].value&&null!==m[o].value&&void 0!==e&&null!==e&&m[o].value.toString()===e.toString()&&(m[o].isSelected=!0,n=m[o]);c.filterCollection.filterGroups[g].items=m,S(c,l,n)}function N(a,c,d,e,f){if(d)R(a,f),T(a,c,e,f,e);else{P(a,e);b(c.target).data("tag").remove()}for(var g=b(c.target).data(),h=parseInt(g["group-index"]),i=a.filterCollection.filterGroups[h],j=i.type,k=a.filterCollection.filterGroups[h].items,l,m=0;m<k.length;m++)k[m].isSelected=!1;a.filterCollection.filterGroups[h].items=k,a.filterCollection.filterGroups[h].items[g["item-index"]].isSelected=d,g.item.isSelected=d,S(a,j,g.item)}function O(a,c,d,e){var f=c.target.text
;if(d)T(a,c,e,null,f);else{P(a,e);b(c.target).data("tag").remove()}var g=b(c.target).data(),h=parseInt(g["group-index"]),i=a.filterCollection.filterGroups[h],j=i.type;a.filterCollection.filterGroups[h].items[parseInt(g["item-index"])].isSelected=d,g.item.isSelected=d,S(a,j,g.item)}function P(a,b){var c=a.tags.indexOf(b);c>=0&&a.tags.splice(c,1),a.tags.length||(a.contentContainer.find(".tag-section").hide(),a.contentContainer.find(".clear-all").hide(),Y(a),X(a))}function Q(a){for(var c=a.contentContainer.find(".tag-section").find(".tag"),d=0;d<c.length;d++){var e=b(c[d]).data();U(a,e.value,e.item,{target:c[d]})}}function R(a,b){var c=a.contentContainer.find(".tag-section").find('.tag[name="'+b+'"]'),d=c.data("value"),e=a.tags.indexOf(d);a.tags.splice(e,1),c.remove()}function S(a,b,c){var d,e=a.filterCollection,f=e.filterGroups;Object.tryMethod(a,"callback",b,c,a.tags)}function T(a,c,d,e,f){a.contentContainer.find(".tag-section").show(),a.contentContainer.find(".clear-all").show(),
a.tags.push(d);var g=b('<div class="tag tag-style"><span><span>'+f+'</span></span><i class="icon-node-error icon-style"></i></div>');g.attr("name",e).data({value:d,item:c}).find(".icon-style").on("click",U.bind(null,a,d,c)),b(c.target).data("tag",g),g.appendTo(a.contentContainer.find(".tag-section"))}function U(a,c,d,e){b(e.target).closest(".tag").remove(),P(a,c);var f=b(d.target).data(),g=parseInt(f["group-index"]),h=a.filterCollection.filterGroups[g],i=h.type;if("checkbox"===i||"radio"===i?d.target.checked=!1:(b(d.target).data("value",""),b(d.target).attr("data-value","")),"checkbox"===i)a.filterCollection.filterGroups[g].items[parseInt(f["item-index"])].isSelected=!1;else if("radio"===i||"select"===i){for(var j=a.filterCollection.filterGroups[g].items,k=0;k<j.length;k++)j[k].isSelected=!1;a.filterCollection.filterGroups[g].items=j}S(a,i,b(d.target).data().item)}function V(a){var c,e;e=b(".content-wrapper"),c=document.createElement("div"),b(c).addClass("filter-outer-container"),
a.contentContainer=b(c),b(e).after(c),b(c).append(d).on("mousedown.mifilter",function a(b){b.stopPropagation()}),b(c).find(".clear-all a").html(a.translator.translate("MF_CLEAR_ALL")),b(b(c).find(".filter-header header")[0]).text(a.translator.translate("FILTER_HEADER_CAPTION")),b(b(c).find(".filter-header")[0]).removeClass("hide"),a.contentContainer.find(".tag-section").removeClass("hide"),a.showHeading||b(b(c).find(".filter-header")[0]).addClass("hide"),a.showTags||a.contentContainer.find(".tag-section").hide().addClass("hide")}function W(a){b(".filter-outer-container").remove()}function X(a){var c=50,d,e;Y(a),Z(a),a.ctrlOffset&&a.ctrlOffset.top+a.filtersHeight+c>=b(window).height()?$(a):_(a),b(window).on("resize",a.resizeProxy.bind(null,a)),b(a).parents().on("scroll",a.scrollProxy.bind(null,a))}function Y(a){a.outerContainer=b(a.contentContainer),a.ctrlOffset=b(a).find(".icon-container").offset(),a.ctrlWidth=b(a).find(".icon-container").width()+25,
null!==a._popupWidth&&b(a.outerContainer).find(".filters-noko").css("width",a._popupWidth+"px"),b(a.outerContainer).css({position:"absolute"}),a.filtersWidth=b(a.outerContainer).find(".filters-noko").width(),a.filtersHeight=b(a.outerContainer).find(".filters-noko").height()}function Z(a){b(a.outerContainer).find(".filters-noko").removeClass("top-left top-right bottom-left bottom-right")}function $(a){var b;a.ctrlOffset&&(b=a.ctrlOffset.top-a.filtersHeight-10,a.ctrlOffset&&a.ctrlOffset.left+a.ctrlWidth-a.filtersWidth<80?aa(a,"top-left",b):ba(a,"top-right",b))}function _(a){var b;a.ctrlOffset&&(b=a.ctrlOffset.top+50-6,a.ctrlOffset&&a.ctrlOffset.left+a.ctrlWidth-a.filtersWidth<80?aa(a,"bottom-left",b):ba(a,"bottom-right",b))}function aa(a,b,c){var d;d=a.ctrlOffset.left,ca(a,b),da(a,d,c)}function ba(a,b,c){var d;d=a.ctrlOffset.left-Math.abs(a.ctrlWidth-a.filtersWidth),null!==a._popupWidth&&(d-=12),ca(a,b),da(a,d,c)}function ca(a,c){var d;d=b(a.outerContainer).find(".filters-noko"),
b(d).addClass(c)}function da(a,c,d){b(a.outerContainer).css({left:c,top:d})}return document.registerElement("mi-filter-no-ko",{prototype:k}),k});
define('assets/asset-hierarchy-control',['require','jquery','spa/ko/knockout-view-model','system/knockout/knockout-manager','spa/region','application/application-events','application/application-context','assets/services/hierarchy-service','assets/asset-hierarchy-control-filter','assets/services/asset-context-dto','system/globalization/translator','toastr','text!./views/asset-hierarchy-control.html','text!./views/asset-hierarchy-control-filter.html','text!./views/asset-hierarchy-control-search.html','ramda','devExWebJS','ui/elements/tree/view-model','ui/elements/filter/filter-no-ko','ui/elements/searchbox/view-model','unified-asset-context-browser'],function(require){"use strict";var a=require("jquery"),b=require("spa/ko/knockout-view-model"),c=require("system/knockout/knockout-manager"),d=require("spa/region"),e=require("application/application-events"),f=require("application/application-context"),g=require("assets/services/hierarchy-service"),h=require("assets/asset-hierarchy-control-filter"),i=require("assets/services/asset-context-dto"),j=require("system/globalization/translator"),k=require("toastr"),l=require("text!./views/asset-hierarchy-control.html"),m=require("text!./views/asset-hierarchy-control-filter.html"),n=require("text!./views/asset-hierarchy-control-search.html"),o=require("ramda");require("devExWebJS"),require("ui/elements/tree/view-model"),require("ui/elements/filter/filter-no-ko"),require("ui/elements/searchbox/view-model"),require("unified-asset-context-browser");var p={selector:"none",multiSelect:!1},q=500,r=500,s=1;function t(a,b,c){u.call(this,l),this.service=a,this.tree=null,this.translator=b,
this.kom=c,this.filter=null,this.category=null,this.class=null,this.type=null,this.applyingFilter=!1,this.errorOccured=Object.resolve(e).errorOccured,this.sites=null,this.searchSelectedKey=null,this.selectChildren=null,this.disableSelectAllChildren=null,this.searchTerm=null,this.currentContext=[],this.contextNodes={},this.selectedAsset=null,this.filterConfigLoaded=!1}var u=Object.inherit(b,t);t.dependsOn=[g,j,c],t.create=function b(c){var d=Object.resolve(t);return d.settings=a.extend(null,p,c),d},t.prototype.load=function(){var a=this;this.category=this.kom.observable(),this.class=this.kom.observable(),this.type=this.kom.observable(),this.filter=new h(this.category,this.class,this.type),this.selectChildren=this.kom.observable(this.settings.selectChildren),this.disableSelectAllChildren=this.kom.observable(!0)},t.prototype.attach=function a(b,c){var e=this;this.settings.contentArea?(this.region=new d,this.region.setElement(b.$element.find(this.settings.contentArea))):this.region=b,
u.prototype.attach.call(this,this.region),this.contextBrowser=this.region.$element.find("asset-hierarchy-control")[0],this.isFirstLoad=!0,this.filterConfigLoaded=!1,Element.upgrade(this.contextBrowser),this.contextBrowser.filterTemplate=m,this.contextBrowser.searchTemplate=n,this.contextBrowser.spinnerTemplate='<span class="loading-med loading-active center-block" ></span>',this.contextBrowser.enableMultiSelect="addOnly"===this.settings.selector,this.contextBrowser.itemSelectorIcon='<i class="icon-plus"></i>',this.contextBrowser.addToolbarButton(v(this)),this.contextBrowser.itemExpandCB=G.bind(null,this),this.contextBrowser.filterConfig=y.bind(null,this),this.contextBrowser.filterCB=w.bind(null,this),this.contextBrowser.searchCB=F.bind(null,this),this.contextBrowser.addEventListener("selected",this),this.contextBrowser.addEventListener("search-cleared",this),!c&&z(this),this.disableSelectAllChildren.subscribe(function(a){
e.region&&e.region.$element&&e.region.$element.find(".add-all-children-btn").attr("disabled",!!a)})};function v(b){var c=a('<button><i class="icon-plus"></i></button>').addClass("btn btn-default btn-icon add-all-children-btn").attr("title",b.translate("ADD_ALL_CHILDREN")).attr("disabled",b.disableSelectAllChildren()).on("click",b.addAllChildren.bind(null,b));return b.settings.enableAddAllChildren&&!b.selectChildren()?c[0]:a("<span></span>")[0]}function w(a,b,c){var d,e,f;c&&(d=c[0],e=c[1],f=c[2]),a.applyingFilter=!0,a.category(d||null),a.class(e||null),a.type(f||null),!c&&a.contextBrowser.selected&&"-1"!==a.contextBrowser.selected&&"0"!==a.contextBrowser.selected?a.service.path(a.contextBrowser.selected).done(x.bind(null,a)):z(a)}function x(a,b){if(a.contextBrowser){if(b.length>1){for(var c=[],d=0;d<b.length;d++)b[d].name=b[d].description,b[d].key=b[d].entityKey,b[d].parentKey="-1",b[d].hasChildren=!0,c.push(b[d]);a.currentContext=[].concat(c),a.isFirstLoad=!0,
a.pathToNavigateInitial=c,J(a,a.pathToNavigateInitial).then(function(){z(a).done(function(){a.contextBrowser.navigate(c)})})}}else z(a)}function y(a,b){a.service.taxonomy().done(function(c){a.filterConfigLoaded=!0;var d=[{id:"CATEGORY",title:a.translate("TAXONOMY_CATEGORY"),defaultCaption:a.translate("SEL_TAX_CAT_CAP"),visible:!0},{id:"CLASS",title:a.translate("TAXONOMY_CLASS"),defaultCaption:a.translate("SEL_TAX_CLS_CAP"),visible:!0},{id:"TYPE",title:a.translate("TAXONOMY_TYPE"),defaultCaption:a.translate("SEL_TAX_TYP_CAP"),visible:!0}];b.resolve(c,d);var e=[a.category(),a.class(),a.type()];e[0]&&a.contextBrowser.filter(e)})}function z(b,c,d){var e=a.Deferred(),f=[{name:"Home",description:"Home",entityKey:"-1",key:"-1",hasChildren:!0,canOpen:!1,isExpanded:void 0===d}];return f=c===!1?[]:f,b.contextBrowser&&b.contextBrowser.init(f,!0),e.resolve(f),e}t.prototype.handleEvent=function(a){"selected"!==a.type||this.searchTerm?"filter-closed"===a.type?(this.applyingFilter=!0,
z(this)):"selected"===a.type&&this.searchTerm?B(this,a):"search-cleared"===a.type&&C(this):(this.service.abort(),this.disableSelectAllChildren(!this.settings.multiSelect))};function A(a){return 1===a.newValue.length}function B(a,b){var c=a.contextBrowser.selectedAsset,d=c.entityKey;a.searchSelectedKey=d}function C(a){var b=null===a.contextBrowser.selectedAsset||"-1"===a.contextBrowser.selectedAsset.key&&a.contextBrowser.selectedAsset.key!==a.contextBrowser.selectedAssetKey?a.selectedAsset:a.contextBrowser.selectedAsset,c=b?b.entityKey:"-1";O(a)&&(c="-1"),a.searchTerm=null,a.service.path(c).done(D.bind(null,a))}function D(a,b){if(a.contextBrowser)if(b.length>1){for(var c=[],d=0;d<b.length;d++)b[d].name=b[d].description,b[d].key=b[d].entityKey,b[d].parentKey="-1",b[d].hasChildren=!0,c.push(b[d]);a.currentContext=[].concat(c),a.isFirstLoad=!0,a.pathToNavigateInitial=c,J(a,a.pathToNavigateInitial).then(function(){z(a).done(function(){a.contextBrowser.navigate(c)})})}else z(a)}
t.prototype.detach=function a(){this.service.abort(),this.region.$element.find(".hierarchy-control-filter").off("filter-closed"),this.contextBrowser.removeEventListener("selected",this),this.contextBrowser=null,this.toolbar=null,this.filterElem=null,this.searchElem=null,this.searchTerm=null,this.applyingFilter=!1,this.currentContext=[],this.contextNodes={},this.category(null),this.class(null),this.type(null),u.prototype.detach.call(this,this.region),this.region=null,this.filterConfigLoaded=!1},t.prototype.unload=function a(){this.kom.dispose()},t.prototype.translate=function(a){return this.translator.translate(a)},t.prototype.loadcontext=function(a){this.contextBrowser.selected=a,this.service.path(a).done(N.bind(null,this)).fail(P.bind(null,this))};var E=o.cond([[o.or(o.equals("0"),o.equals(0)),o.always(null)],[o.T,o.identity()]]);t.prototype.setSiteFilter=function(a){a&&(this.sites=o.map(E,a))},t.prototype.loadState=function(a){a=a||{tree:{value:i.default()}},
this.category(a.category),this.class(a.class),this.type(a.type),this.searchTerm=a.searchTerm,this.selectedAsset=a.context},t.prototype.saveState=function(){var a=null===this.contextBrowser.selectedAsset||null!==this.contextBrowser.selectedAsset&&"-1"===this.contextBrowser.selectedAsset.key&&this.contextBrowser.selectedAsset.key!==this.contextBrowser.selectedAssetKey;return{category:this.category(),class:this.class(),type:this.type(),context:a?this.selectedAsset:this.contextBrowser.selectedAsset,searchTerm:this.searchTerm}},t.prototype.getContextValue=function(){var a=null===this.contextBrowser.selectedAsset||"-1"===this.contextBrowser.selectedAsset.key&&this.contextBrowser.selectedAsset.key!==this.contextBrowser.selectedAssetKey;return i.fromHierarchyDTO(a?this.selectedAsset:this.contextBrowser.selectedAsset)},t.prototype.addAllChildren=function(a,b){var c=new CustomEvent("selectallchildren",{bubbles:!0,cancelable:!0,detail:a.contextBrowser.selectedAsset})
;a.contextBrowser&&a.contextBrowser.dispatchEvent(c)};function F(b,c,d,e,f){var g=a.Deferred();return e=s,f=r,b.searchTerm=c,c&&o.isNil(b.sites)?b.service.search(c,e,f).done(L.bind(null,b,g)).fail(P.bind(null,b)):c&&!o.isNil(b.sites)?b.service.search(c,e,f).done(M.bind(null,b,g,b.sites)).fail(P.bind(null,b)):g.resolve(),g}function G(b,c,d,e,g){var h="",i="",j="",k=d||a.Deferred(),l;return b.contextBrowser?(l=c||f.assetcontext)?b.contextNodes[l.entityKey]?(o.isNil(b.sites)?H(b,k,l,b.contextNodes[l.entityKey]):I(b,k,l,b.sites,b.contextNodes[l.entityKey]),delete b.contextNodes[l.entityKey],k):(b.category()&&(h=b.category().code),b.class()&&(i=b.class().code),b.type()&&(j=b.type().code),o.isNil(b.sites)?b.service.children(l.entityKey,h,i,j,s,q).done(H.bind(null,b,k,l)).fail(P.bind(null,b)):b.service.children(l.entityKey,h,i,j,s,q,b.sites).done(I.bind(null,b,k,l,b.sites)).fail(P.bind(null,b)),k):(setTimeout(H.bind(null,b,k,{data:[]})),k):(setTimeout(k.reject.bind(k),0),k)}
function H(a,b,c,d){for(var e=!1,f=a.currentContext&&a.currentContext.length>1,g=!1,h=0,i=0;i<a.currentContext.length-1;i++)a.currentContext[i].entityKey===c.entityKey&&(g=!0,h=i);var j=d.data.map(function(b){return b.name=b.description,b.key=a.searchTerm?R():b.entityKey,b.parentKey=a.searchTerm?c.key:c.entityKey,b.hasChildren=!!b.hasChildren,g&&!e&&f&&!a.searchTerm&&a.currentContext[h].entityKey===b.parentKey&&a.currentContext[h+1].entityKey===b.entityKey&&(e=!0),b});if(!e&&f&&g&&!a.searchTerm&&!a.applyingFilter){var k=a.currentContext[h+1];j.push(k)}if(j.length>=q){var l=a.searchTerm?c.key:c.entityKey,m={key:l.toString()+"_more_data",isAlertMessage:!0,name:a.translate("ASSET_HIERARCHY_TOO_MANY_MSG"),pathLabel:a.translate("ASSET_HIERARCHY_TOO_MANY_SUGGESTION"),parentKey:l};j.push(m)}b.resolve(j),a.category()&&0===d.data.length&&a.applyingFilter?z(a,!1):a.applyingFilter=!1}function I(a,b,c,d,e){o.forEach(K.bind(null,d),e.data)
;for(var f=!1,g=a.currentContext&&a.currentContext.length>1,h=!1,i=0,j=0;j<a.currentContext.length-1;j++)a.currentContext[j].entityKey===c.entityKey&&(h=!0,i=j);var k=e.data.map(function(b){return b.name=b.description,b.key=a.searchTerm?R():b.entityKey,b.parentKey=a.searchTerm?c.key:c.entityKey,b.hasChildren=!!b.hasChildren,b.canOpen=!b.disabledIcon,h&&!f&&g&&!a.searchTerm&&a.currentContext[i].entityKey===b.parentKey&&a.currentContext[i+1].entityKey===b.entityKey&&(f=!0),b});if(!f&&g&&h&&!a.searchTerm&&!a.applyingFilter){var l=a.currentContext[i+1];k.push(l)}if(k.length>=q){var m=a.searchTerm?c.key:c.entityKey,n={key:m.toString()+"_more_data",isAlertMessage:!0,name:a.translate("ASSET_HIERARCHY_TOO_MANY_MSG"),pathLabel:a.translate("ASSET_HIERARCHY_TOO_MANY_SUGGESTION"),parentKey:m};k.push(n)}b.resolve(k),a.category()&&0===e.data.length&&a.applyingFilter?z(a,!1):a.applyingFilter=!1}function J(b,c){var d=c.filter(function(a){return a.entityKey!==c[c.length-1].entityKey})
;return a.when.apply(a,d.map(function(a){return b.service.children(a.entityKey,"","","",s,q)})).then(function(){for(var a=0;a<d.length;a++)b.contextNodes[d[a].key]=arguments[a]})}function K(a,b){b.disabledIcon=!o.contains(b.siteKey,a)}function L(a,b,c){if(b.resolve(c.data),a.searchSelectedKey=null,a.contextBrowser){var d=c.data.map(function(a){return a.name=a.description,a.key=R(),a.parentKey="-1",a.hasChildren=!!a.hasChildren,a.pathLabel=a.hierarchyPath,a});if(d.length>=r){var e={key:R()+"_more_data",isAlertMessage:!0,name:a.translate("ASSET_HIERARCHY_TOO_MANY_MSG"),pathLabel:a.translate("ASSET_HIERARCHY_TOO_MANY_SUGGESTION"),parentKey:"-1"};d.push(e)}a.contextBrowser.init(d)}}function M(a,b,c,d){if(o.forEach(K.bind(null,c),d.data),b.resolve(d.data),a.searchSelectedKey=null,a.contextBrowser){var e=d.data.map(function(a){return a.name=a.description,a.key=R(),a.parentKey="-1",a.hasChildren=!!a.hasChildren,a.canOpen=!a.disabledIcon,a.pathLabel=a.hierarchyPath,a});if(e.length>=r){var f={
key:R()+"_more_data",isAlertMessage:!0,name:a.translate("ASSET_HIERARCHY_TOO_MANY_MSG"),pathLabel:a.translate("ASSET_HIERARCHY_TOO_MANY_SUGGESTION"),parentKey:"-1"};e.push(f)}a.contextBrowser.init(e)}}function N(a,b){var c;if(a&&a.contextBrowser){for(var d=[],e=0;e<b.length;e++)b[e].name=b[e].description,b[e].key=b[e].entityKey,b[e].parentKey="-1",b[e].hasChildren=!0,d.push(b[e]);c=[a.category(),a.class(),a.type()],a.currentContext=[].concat(d),a.pathToNavigateInitial=d,a.searchTerm&&null!==a.searchTerm?a.contextBrowser.search(a.searchTerm):c[0]?(z(a,!0,!1),a.filterConfigLoaded&&a.contextBrowser.filter(c)):J(a,a.pathToNavigateInitial).then(function(){z(a).done(function(){a.isFirstLoad?a.contextBrowser.navigate(d):a.pathToNavigateInitial=d})})}}function O(b){return!!a(b.region.element).parents(".asset-finder-screen").length}function P(a,b,c,d){d&&"abort"!==d&&k.error(d,void 0,{positionClass:"toast-top-right "})}function Q(){
return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function R(){return Q()+Q()+""+Q()+Q()+Q()+Q()+Q()+Q()}return t});
define('system/http/ajax-request',['require','lodash','system/http/ajax-client','mi-assert'],function(require){"use strict";var a=require("lodash"),b=require("system/http/ajax-client"),c=require("mi-assert");function d(a,c,d,e){this.ajaxClient=Object.resolve(b),this.method=a,this.url=c,this.data=d||null,this.options=e||null}d.get=function(a,b){return new d("get",a,null,b)},d.post=function(a,b,c){return new d("post",a,b,c)},d.put=function(a,b,c){return new d("put",a,b,c)},d.delete=function(a,b){return new d("delete",a,null,b)},d.prototype.send=function a(b){var c;if("get"===this.method)c=this.ajaxClient.get(this.url,this.options);else if("post"===this.method)c=this.ajaxClient.post(this.url,this.data,this.options);else if("put"===this.method)c=this.ajaxClient.put(this.url,this.data,this.options);else{if("delete"!==this.method)throw"Unknown request method: "+this.method;c=this.ajaxClient.delete(this.url,this.options)}return b&&c.fail(this.onFail(b)),c},d.prototype.onFail=function a(b){return c.isObject(b,"dfd"),e.bind(null,b,this)};function e(b,e,f){c.isObject(b,"dfd"),
c.instanceOf(e,d,"request"),c.isObject(f,"response"),a.isFunction(b.promise)?b.reject(e,f):b.reject({request:e,response:f})}return d});
define('system/http/es6-ajax-request',['require','./ajax-request','bluebird'],function(require){"use strict";var a=require("./ajax-request"),b=require("bluebird");function c(a,b,c,e){d.call(this,a,b,c,e),this.xhr=null}var d=Object.inherit(a,c);c.get=function(a,b){return new c("get",a,null,b)},c.post=function(a,b,d){return new c("post",a,b,d)},c.put=function(a,b,d){return new c("put",a,b,d)},c.delete=function(a,b){return new c("delete",a,null,b)},c.prototype.send=function(){return this.xhr=d.prototype.send.call(this),b.resolve(this.xhr).catch(e.bind(null,this))};function e(a,b){return{request:a,response:b}}return c});
define('assets/services/asset-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.entityKey=a.toString(b.entityKey),this.equipmentId=a.toString(b.equipmentId),this.groupid=a.toString(b.equipmentId),this.familyId=a.toString(b.familyId),this.siteKey=a.toInteger(b.siteKey)}return b.fromDataCollection=function a(c){var d,e=[];for(d=0;d<c.length;d++)e[d]=new b(c[d]);return e},b.fromSelectedAsset=function a(c){return new b({entityKey:c.entityKey,equipmentId:c.description,familyId:c.familyId,siteKey:c.siteKey})},b.fromSelectedAssetArray=function a(c){return c.map(b.fromSelectedAsset)},b});
define('assets/services/asset-group-dto',['require','system/lang/converter','assets/services/asset-dto','assets/services/hierarchy-dto','assets/models/family','system/lang/string'],function(require){"use strict";var a=require("system/lang/converter"),b=require("assets/services/asset-dto"),c=require("assets/services/hierarchy-dto"),d=require("assets/models/family");require("system/lang/string");function e(e){e=e||{},this.entityKey=a.toString(e.entityKey),this.groupid=a.toString(e.groupid),this.createdBy=a.toString(e.createdBy),this.modifiedBy=a.toString(e.lastUpdatedBy),this.modifiedOn=a.toDate(e.lastUpdatedDate),this.groupdesc=a.toString(e.groupdesc),this.catalogKey=a.toInteger(e.catalogKey),this.catalogPath=a.toString(e.catalogPath),this.siteKey=a.toInteger(e.siteKey),this.equipmentCount=a.toInteger(e.equipmentCount),this.relationships=e.relationships?d.fromDataCollection(e.relationships):[],this.equipments=e.equipments?b.fromDataCollection(e.equipments):[],this.corrosionloops=e.corrosionloops?f(e.corrosionloops):[],this.hierarchyparents=e.hierarchyparents?c.fromDataCollection(e.hierarchyparents):[],this.selected=null}e.fromDataCollection=function a(b){
var c,d=[];for(c=0;c<b.length;c++)d[c]=new e(b[c]);return d},e.fromAssetContextDTO=function a(b){return new e({entityKey:b.entityKey,createdBy:b.createdBy,groupid:b.description})};function f(b){var c,d=[];for(c=0;c<b.length;c++)d[c]=a.toString(b[c]);return d}return e});
define('security/services/usersite-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key)||"0",this.siteKey=a.toString(b.siteKey)||"0",this.userKey=a.toString(b.userKey)||"0",this.viewOnly=a.toBoolean(b.viewOnly)||!1,this.siteName=a.toString(b.siteName),this.userName=a.toString(b.userName),this.lockSeq=a.toString(b.lockSeq)||"0"}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('security/services/site-dto',['require','./usersite-dto','system/lang/converter'],function(require){"use strict";var a=require("./usersite-dto"),b=require("system/lang/converter");function c(c){c=c||{},this.name=b.toString(c.name),this.key=b.toString(c.key)||"0",this.lockSeq=b.toString(c.lockSeq),this.users=a.fromDataCollection(c.users)}return c.fromDataCollection=function a(b){if(b){var d,e=[];for(d=0;d<b.length;d++)e[e.length]=new c(b[d]);return e}},c});
define('catalog/services/dto/user-pref-dto',['require','system/lang/converter'],function(require){"use strict";var a=require("system/lang/converter");function b(b){b=b||{},this.key=a.toString(b.key),this.userKey=a.toString(b.userKey),this.prefType=a.toInteger(b.prefType),this.name=a.toString(b.name),this.value=a.toString(b.value)}return b.fromDataCollection=function a(c){if(c){var d,e=[];for(d=0;d<c.length;d++)e[e.length]=new b(c[d]);return e}},b});
define('assets/services/group-service',['require','jquery','system/http/ajax-client','assets/services/asset-group-dto','assets/services/asset-dto','assets/services/hierarchy-dto','security/services/site-dto','catalog/services/dto/user-pref-dto','system/lang/url-codec'],function(require){"use strict";var a=require("jquery"),b=require("system/http/ajax-client"),c=require("assets/services/asset-group-dto"),d=require("assets/services/asset-dto"),e=require("assets/services/hierarchy-dto"),f="api/common/assetgroup",g="api/core/security",h=require("security/services/site-dto"),i=require("catalog/services/dto/user-pref-dto"),j="api/core/userpref/",k=require("system/lang/url-codec");function l(a){this.ajaxClient=a,this.request=null}l.dependsOn=[b],l.prototype.abort=function a(){this.request&&this.request.abort()},l.prototype.getAllGroups=function(b,c,d,e,g,h){var i=a.Deferred(),j="",k="",l;for(d=d||[],l=0;l<d.length;l++)j+="&keys="+d[l];return h=h?"&searchterm="+h:"",e=e?"&relationshipId="+e:"",g=g?"&byCurrUser="+g:"",k="?page="+b+"&pageSize="+c+j+e+g+h,this.ajaxClient.get(f+k).done(n.bind(null,i)).fail(i.reject.bind(i)),i.promise()},l.prototype.getGroupDetails=function b(c){var d=a.Deferred()
;return this.ajaxClient.get(f+"/"+c.toString()).done(o.bind(null,d)).fail(u.bind(null,d)),d.promise()},l.prototype.assets=function b(c,d,e){var g=a.Deferred();return this.ajaxClient.get(f+"/"+c+"/assets?page="+d+"&pageSize="+e).done(q.bind(null,g)).fail(g.reject.bind(g)),g.promise()},l.prototype.allAssets=function b(c){var d=a.Deferred();return this.ajaxClient.get(f+"/"+c+"/assets").done(q.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.assetsByKey=function b(c){var d=a.Deferred();return this.ajaxClient.get(f+"/"+c+"/assetsbykey").done(q.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.getGroupDetailsWithPaging=function(b,c,d){var e=a.Deferred(),g=this;return this.request=this.ajaxClient.get(f+"/"+b.toString()+"?page="+c.toString()+"&pageSize="+d.toString()).done(o.bind(null,e)).fail(e.reject.bind(e)).always(p.bind(null,g)),e.promise()},l.prototype.addGroup=function b(c){var d=a.Deferred()
;return this.ajaxClient.post(f,c).done(o.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.editGroup=function b(c){var d=a.Deferred();return this.ajaxClient.put(f,c).done(t.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.removeGroup=function b(c){var d=a.Deferred();return this.ajaxClient.delete(f+"/"+c.toString()).done(t.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.addAssets=function b(c,d,e){var g=a.Deferred();return e=e?"?contextKey="+e.toString():"",this.ajaxClient.post(f+"/"+c.toString()+"/assets"+e,d).done(t.bind(null,g)).fail(g.reject.bind(g)),g.promise()},l.prototype.removeAssets=function b(c,d){var e=a.Deferred(),g=null,h,i=[],j;for(j=d.splice(0,50);j&&j.length>0;)h=j.map(m),g=k.encode({keys:h}),i[i.length]=this.ajaxClient.delete(f+"/"+c.toString()+"/assets?"+g),j=d.splice(0,50);return a.when.apply(a,i).done(t.bind(null,e)).fail(e.reject.bind(e)),e.promise()},l.prototype.addAssociations=function b(c,d){var e=a.Deferred()
;return this.ajaxClient.post(f+"/"+c+"/hierarchy",d).done(t.bind(null,e)).fail(e.reject.bind(e)),e.promise()},l.prototype.removeAssociations=function b(c,d){var e=a.Deferred(),g=null;return g=k.encode({keys:d}),this.ajaxClient.delete(f+"/"+c+"/hierarchy?"+g).done(t.bind(null,e)).fail(e.reject.bind(e)),e.promise()},l.prototype.getAssociations=function b(c){var d=a.Deferred();return this.ajaxClient.get(f+"/"+c.toString()+"/hierarchy").done(s.bind(null,d)).fail(d.reject.bind(d)),d.promise()},l.prototype.getSites=function b(){var c=a.Deferred();return this.ajaxClient.get(g+"/sites",{}).done(r.bind(null,c)).fail(c.reject.bind(c)),c.promise()},l.prototype.getPreference=function b(c,d){var e=a.Deferred(),f=j+"get/"+c+"/1?name="+d;return this.ajaxClient.get(f,{}).done(t.bind(null,e)).fail(e.reject.bind(e)),e.promise()},l.prototype.setPreference=function b(c){var d=a.Deferred(),e=j+"set";return this.ajaxClient.post(e,c).done(t.bind(null,d)).fail(d.reject.bind(d)),d.promise()},
l.prototype.copyGroup=function b(c){var d=a.Deferred();return this.ajaxClient.post(f+"/copy",c).done(o.bind(null,d)).fail(u.bind(null,d)),d.promise()},l.prototype.checkPermission=function(){var b=a.Deferred();return this.ajaxClient.get(f+"/permission").done(b.resolve.bind(b)).fail(b.reject.bind(b)),b.promise()};function m(a){return a.entityKey||a}function n(a,b){a.resolve(c.fromDataCollection(b))}function o(a,b){a.resolve(new c(b))}function p(a){a.request=null}function q(a,b){a.resolve(d.fromDataCollection(b))}function r(a,b){a.resolve(h.fromDataCollection(b))}function s(a,b){a.resolve(e.fromDataCollection(b))}function t(a,b){a.resolve(b)}function u(a,b,c,d){a.reject(b,c,d)}return l});

define('text!assets/views/asset-group-control.html',[],function () { return '<div data-bind="if: settings.loadAssets, style: { height: settings.loadAssets ? \'100%\' : 0 }">\r\n    <mi-tree description="groupid"\r\n             custom-filter="true"\r\n             data-bind="attr: { \'root-name\': translate(\'ASSET_GROUPS\'), multiselect: settings.multiSelect, \'allow-add\': settings.allowAdd, \'has-children\': settings.hasChildren }">\r\n        <mi-tool-bar>\r\n            <!-- ko if: settings.enableAddAllChildren === true -->\r\n            <button class="btn btn-default btn-icon" data-bind="click: addAllChildren, attr: { title: translate(\'ADD_ALL_CHILDREN\'), disabled: disableSelectAllChildren }">\r\n                <i class="icon-plus"></i>\r\n            </button>\r\n            <!-- /ko -->\r\n        </mi-tool-bar>\r\n    </mi-tree>\r\n</div>\r\n\r\n<div data-bind="ifnot: settings.loadAssets, style: { height: !settings.loadAssets ? \'100%\' : 0 }">\r\n<mi-list-group description="groupid"\r\n               custom-filter="true"\r\n               data-bind="attr: { selector: settings.selector, multiselect: settings.multiSelect, \'allow-add\': settings.allowAdd, \'has-children\': settings.hasChildren }">\r\n</mi-list-group>\r\n</div>\r\n';});


define('text!system/ui/views/dialog.html',[],function () { return '<div class="pattern pattern-dialog" >\r\n    <div class="dialog-opacity-style"></div>\r\n    <div class="dialog-wrapper">\r\n        <section class="title">\r\n            <div class="title-wrapper">\n                <div class="title-container" data-bind="text: title, attr: {title: title}"></div>\n            </div>\r\n            <span class="close-dialog icon-close-popup"\r\n            \tdata-bind="click: closeDialog, visible: showCloseIcon"></span>\r\n        </section>\r\n        <section class="content dialog-content"></section>\r\n    </div>\r\n</div>';});

define('system/ui/dialog-view-model',["require","exports","jquery","knockout","spa/conductor","spa/region","application/application-events","system/lang/object","text!./views/dialog.html"],function(require,exports,a,b,c,d,e,f){"use strict";var g=require("text!./views/dialog.html"),h=0,i=function(){function i(a,g,h){void 0===h&&(h=null),this.options=h,this.content=a,this.title=g,this.showHelp=b.observable(!0),this.showClose=b.observable(!0),this.showCloseIcon=b.observable(!1),this.showCheck=b.observable(!0),this.applicationEvents=f.resolve(e),this.dialogShellRegion=new d(null),this.dialogContentRegion=new d(null),this.$wrapper=null,this.conductor=f.resolve(c)}return i.prototype.show=function(){var c=document.createElement("div");document.body.appendChild(c),this.dialogShellRegion.setElement(c),this.dialogShellRegion.attach(a(g)),b.applyBindings(this,this.dialogShellRegion.activeContainer),this.$wrapper=this.dialogShellRegion.$element.find(".dialog-wrapper");var d=this.$wrapper.find(".dialog-content")
;if(this.dialogContentRegion.setElement(d),this.options?(this.options.height&&this.$wrapper.css("height",this.options.height),this.options.width&&this.$wrapper.css("width",this.options.width),this.options.noPadding?d.addClass("dialog-no-padding"):j(this,d)):j(this,d),this.options&&this.options.hasOwnProperty("closeIcon")){var e=this.options.closeIcon||!1;this.showCloseIcon(e)}h++,this.dialogShellRegion.$element.find(".dialog-opacity-style").css("z-index",h.toString()+"98"),this.dialogShellRegion.$element.find(".dialog-opacity-style").on("touchstart",m.bind(null)),this.$wrapper.css("z-index",h.toString()+"99"),this.conductor.changeScreen(this.content,this.dialogContentRegion),l(this),this.applicationEvents.windowResized.add(l,this,this),this.$wrapper.find("div.dialog-message-box div.btn.btn-primary").each(n.bind(null)),this.$wrapper.find(".okButtonClass").hover(o.bind(null,this),p.bind(null,this)),this.$wrapper.find(".cancelButtonClass").hover(o.bind(null,this),p.bind(null,this)),
q(this)},i.prototype.closeDialog=function(){r(this),k(this),h--},i.prototype.centerDialog=function(){l(this)},i.prototype.setContent=function(a){this.content=a,this.conductor.changeScreen(this.content,this.dialogContentRegion),l(this)},i}();function j(a,b){a.$wrapper.find(".title").addClass("title-with-padding"),b.addClass("dialog-with-padding")}function k(a){a.dialogShellRegion.$element.find(".dialog-opacity-style").off("touchstart"),a.conductor.clearScreen(a.dialogContentRegion),b.cleanNode(a.dialogShellRegion.activeContainer),a.dialogShellRegion.clear(),a.dialogShellRegion.$element.remove(),a.applicationEvents.windowResized.remove(a),a.applicationEvents.navigate.remove(a)}function l(b){var c,d,e,f,g,h;window.scrollTo(0,0),e=window.innerHeight?window.innerHeight:a(window).height(),f=window.innerWidth?window.innerWidth:a(window).width(),h=b.$wrapper.outerHeight(),g=b.$wrapper.outerWidth(),c=Math.max(0,(e-h)/2+a(window).scrollTop()),d=Math.max(0,(f-g)/2+a(window).scrollLeft()),
b.$wrapper.css("top",c+"px"),b.$wrapper.css("left",d+"px")}function m(a){a.preventDefault(),a.stopPropagation()}function n(b,c){var d=a(c);d.attr("tabindex",b+1),"OK"===d.text()&&(d.addClass("okButtonClass"),d.focus()),"Cancel"===d.text()&&d.addClass("cancelButtonClass")}function o(b){a(b).focus()}function p(b){a(b).blur()}function q(b){b.$wrapper.keydown(function(b){var c=a(b.currentTarget).find("input, select, textarea, button"),d=c.first(),e=c.last();9===(b.which||b.keyCode)&&(b.shiftKey&&d.length&&d.is(":focus")&&(b.preventDefault(),e.focus()),!b.shiftKey&&e.length&&e.is(":focus")&&(b.preventDefault(),d.focus()))})}function r(a){a.$wrapper.off("keydown")}return i});

define('text!assets/views/hierarchy-finder.html',[],function () { return '<section class="asset-hierarchy-finder">\r\n    <section class="hierarchy-control"></section>\r\n    <section class="well tag-section" data-bind="foreach: results">\r\n        <span class="tag" data-bind="click: $root.removeSelection.bind($root)">\r\n            <span class="block-group">\r\n                <span data-bind="text: description"></span>\r\n                <i class="icon-multiply"></i>\r\n            </span>\r\n        </span>\r\n    </section>\r\n    <div class="controls">\r\n        <button type="button" class="btn  btn-text  btn-secondary" data-bind="click: cancel, text: translate(\'CANCEL\')"></button>\r\n        <button type="button" class="btn btn-text" data-bind="click: done, text: translate(\'OK\'), enable: hasSelection"></button>        \r\n    </div>\r\n</section>\r\n';});

define('assets/models/selected-asset',[],function(){"use strict";function a(a,b,c,d,e){this.entityKey=a,this.description=b,this.family=c,this.familyId=d,this.siteKey=e?e:0}return a});
define('assets/adapters/selected-asset-adapter',['require','assets/models/selected-asset'],function(require){"use strict";var a=require("assets/models/selected-asset");function b(){}return b.fromAssetDTO=function b(c){return new a(c.entityKey,c.equipmentId,"",c.familyId,c.siteKey)},b.fromAssetDTOArray=function a(c){return c.map(b.fromAssetDTO)},b.fromHierarchyDTO=function b(c){return new a(c.entityKey,c.description,c.family,c.familyId,c.siteKey)},b.fromAssetGroupDTO=function b(c){return new a(c.entityKey,c.groupid,"","",c.siteKey)},b.fromHierarchyDTOArray=function a(c){return c.map(b.fromHierarchyDTO)},b});
define('assets/hierarchy-finder',['require','jquery','knockout','system/knockout/knockout-manager','spa/ko/knockout-view-model','assets/asset-hierarchy-control','system/ui/dialog-view-model','text!./views/hierarchy-finder.html','system/globalization/translator','assets/adapters/selected-asset-adapter'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("system/knockout/knockout-manager"),d=require("spa/ko/knockout-view-model"),e=require("assets/asset-hierarchy-control"),f=require("system/ui/dialog-view-model"),g=require("text!./views/hierarchy-finder.html"),h=require("system/globalization/translator"),i=require("assets/adapters/selected-asset-adapter");function j(){k.call(this,g),this.dialog=null,this.dfd=null,this.translator=Object.resolve(h),this.kom=Object.resolve(c),this.results=null,this.existing=[],this.assetHierarchyControl=null,this.settings={multiSelect:!0,contentArea:".hierarchy-control",selector:"addOnly"}}var k=Object.inherit(d,j);j.prototype.show=function b(c,d){var e={height:"90%",width:"40%"};return d===!1&&(this.settings.multiSelect=d),c=c||[],c.map instanceof Function?this.existing=c.map(i.fromHierarchyDTO):this.existing=[i.fromHierarchyDTO(c)],this.dialog=new f(this,this.translator.translate("HIERARCHY_FINDER"),e),
this.dialog.show(),this.dfd=a.Deferred(),this.dfd.promise()},j.prototype.close=function a(){this.dialog=null},j.prototype.load=function a(){this.results=this.kom.observableArray(this.existing),this.hasSelection=this.kom.computed(l.bind(null,this)),this.assetHierarchyControl=e.create(this.settings),this.assetHierarchyControl.load()},j.prototype.attach=function a(b){k.prototype.attach.apply(this,arguments),this.assetHierarchyControl.attach(b),this.assetHierarchyControl.loadState(),this.assetHierarchyControl.contextBrowser.addEventListener("multiSelected",this),this.assetHierarchyControl.contextBrowser.addEventListener("search-selected",this)},j.prototype.detach=function a(){this.assetHierarchyControl.contextBrowser.removeEventListener("multiSelected",this),this.assetHierarchyControl.contextBrowser.removeEventListener("search-selected",this),this.assetHierarchyControl.detach(),k.prototype.detach.apply(this,arguments)},j.prototype.unload=function a(){this.kom.dispose(),
"resolved"!==this.dfd.state()&&this.dfd.reject(),this.dfd=null,this.assetHierarchyControl.unload(),this.assetHierarchyControl=null,this.existing=null},j.prototype.handleEvent=function(a){"multiSelected"===a.type?o(this,a.detail):"search-selected"===a.type&&o(this,a.searchResult[0])},j.prototype.done=function a(){this.settings.multiSelect?this.dfd.resolve(this.results()):this.dfd.resolve(this.results()[0]),this.dialog.closeDialog()},j.prototype.cancel=function a(){this.dialog.closeDialog()},j.prototype.translate=function a(b){return this.translator.translate(b)},j.prototype.removeSelection=function a(c,d){var e=b.dataFor(d.target);d.target.classList.contains("icon-multiply")&&e.entityKey&&n(this,e.entityKey)};function l(a){return a.results().length>0}function m(a,b){for(var c=0;c<a.length&&a[c].entityKey!==b;)c++;return c===a.length?-1:c}function n(a,b){var c=0;(c=m(a.results(),b))>-1&&a.results.splice(c,1)}function o(a,b){
b&&(a.settings.multiSelect?m(a.results(),b.entityKey)===-1&&a.results.push(i.fromHierarchyDTO(b)):a.results.splice(0,1,i.fromHierarchyDTO(b)))}return j});

define('text!assets/views/group-filter.html',[],function () { return '<section class="group-filter">\r\n    <section class="form-group">\r\n        <label class="control-label" for="relationships" data-bind="text: $root.translate(\'ASSET_HIERARCHY_RELATIONSHIP_FIELD\')"></label>\r\n        <select class="form-control"\r\n                name="relationships"\r\n                data-bind="options: relationships, optionsText: \'caption\', optionsValue: \'id\', value: $root.selectedFamily, optionsCaption: $root.translate(\'ASSET_HIERARCHY_RELATIONSHIP_CAPTION\')"></select>\r\n    </section>\r\n\r\n    <section class="hierarchy">\r\n        <button class="hierarchy-filter btn btn-default" data-bind="click: editHierarchy, text: translate(\'HIERARCHY_FILTER\')"></button>\r\n        <div class="hierarchy-list">\r\n            <ul data-bind="foreach: results, click: removeHierarchyFilter">\r\n                <li class="list-group-item"><i class="icon-multiply"></i><span data-bind="text: description"></span></li>\r\n            </ul>\r\n        </div>\r\n    </section>\r\n\r\n    <section class="my-groups">\r\n        <mi-checkbox data-bind="miCheckboxProperty: {\r\n                            checked: filterByCurrUser,\r\n                            disable: false,\r\n                            value: filterByCurrUser,\r\n                            text: translate(\'MY_GROUPS\')}">\r\n        </mi-checkbox>\r\n    </section>\r\n\r\n    <div class="controls">\r\n        <button type="button" class="btn  btn-text  btn-secondary" data-bind="click: cancel, text: translate(\'CLOSE\')"></button>\r\n        <button type="button" class="btn btn-text" data-bind="click: done, text: translate(\'DONE\')"></button>\r\n    </div>\r\n</section>\r\n';});


define('text!ui/elements/checkbox/checkbox-template.html',[],function () { return '<script id="mi-checkbox-tmpl" type="text/html">\r\n    <div class="checkbox-container">\r\n        <input type="checkbox" data-bind="checked: $root.checked,disable: $root.disable,value:$root.value, attr:{id:$data.id, required: $root.required}, checkedValue: $root.checkedValue " />\r\n        <label data-bind="attr:{for:$data.id}">\r\n            <span class="checkbox-label" ></span>\r\n            <span class="chkbox-text" data-bind="text:$root.text"></span>\r\n        </label>       \r\n    </div>\r\n</script>';});

define('ui/elements/checkbox/checkbox-view-model',['require','lodash','jquery','text!./checkbox-template.html','knockout'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("text!./checkbox-template.html"),d=require("knockout");d.bindingHandlers.miCheckboxProperty={createNodes:function(a,b){document.getElementById("mi-checkbox-tmpl")||document.body.insertAdjacentHTML("beforeend",c),d.applyBindingsToNode(a,{template:{name:"mi-checkbox-tmpl"}},b)},init:function(a,c){var e=c();return e.id=d.bindingHandlers.miCheckboxProperty.getGuid(),e.textClick=function a(c,d){if(this.disable)return!1;"function"==typeof this.checked?this.checked(!this.checked()):"boolean"==typeof this.checked&&(b(d.target).parent().find("input").prop("checked",!this.checked),this.checked=!this.checked)},d.bindingHandlers.miCheckboxProperty.createNodes(a,e),{controlsDescendantBindings:!0}},getGuid:function a(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},s4:function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},
update:function(c,e){var f,g=b(c).find('input[type="checkbox"]');a.each(e(),function(a,e){f=d.unwrap(a),"disable"===e?g.prop("disabled",f):"checked"===e?f!==!0&&f!==!1||g.prop("checked",f):"text"===e&&b(c).find(".chkbox-text").html(f)})}};var e=Object.create(HTMLElement.prototype);document.registerElement("mi-checkbox",{prototype:e})});
define('assets/group-filter-view-model',['require','jquery','knockout','spa/ko/knockout-view-model','system/ui/dialog-view-model','system/globalization/translator','assets/hierarchy-finder','assets/services/hierarchy-service','text!./views/group-filter.html','ui/elements/checkbox/checkbox-view-model'],function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("spa/ko/knockout-view-model"),d=require("system/ui/dialog-view-model"),e=require("system/globalization/translator"),f=require("assets/hierarchy-finder"),g=require("assets/services/hierarchy-service"),h=require("text!./views/group-filter.html");require("ui/elements/checkbox/checkbox-view-model");function i(){j.call(this,h),this.dialog=null,this.dfd=null,this.existing=[],this.relationships=[],this.family=null,this.selectedFamily=null,this.service=Object.resolve(g),this.translator=Object.resolve(e),this.results=null,this.finder=null,this.byCurrUser=null,this.filterByCurrUser=!1}var j=Object.inherit(c,i);i.prototype.show=function b(c,e,f){var g={height:"70%",width:"40%"};return c&&c instanceof Array?this.existing=c:this.existing=c?[c]:[],this.family=e,this.byCurrUser=f,this.dialog=new d(this,this.translator.translate("GROUP_FILTER"),g),this.dialog.show(),this.dfd=a.Deferred(),this.dfd.promise()},
i.prototype.close=function a(){this.dialog=null},i.prototype.load=function c(){this.finder=new f,a.isArray(this.existing)?this.results=b.observableArray(this.existing):this.results=b.observableArray([this.existing]),this.selectedFamily=b.observable(this.family),this.relationships=b.observableArray([]),this.filterByCurrUser=b.observable(this.byCurrUser),this.service.relationshipsById().done(k.bind(null,this))},i.prototype.attach=function a(){j.prototype.attach.apply(this,arguments)},i.prototype.detach=function a(){j.prototype.detach.apply(this,arguments)},i.prototype.unload=function a(){this.dialog=null,this.dfd=null,this.existing=[],this.existing=null,this.results([]),this.results=null,this.finder.close(),this.finder=null,this.selectedFamily(null),this.family=null,this.filterByCurrUser(null)},i.prototype.done=function a(){var b={family:this.selectedFamily(),results:this.results(),byCurrUser:this.filterByCurrUser()};this.dfd.resolve(b),this.dialog.closeDialog()},
i.prototype.cancel=function a(){this.dialog.closeDialog()},i.prototype.translate=function a(b){return this.translator.translate(b)},i.prototype.editHierarchy=function a(){this.finder.show(this.results()).done(l.bind(null,this))},i.prototype.removeHierarchyFilter=function c(d,e){var f=b.dataFor(e.target),g=0;if(a(e.target).hasClass("icon-multiply"))for(g=0;g<this.results().length;g++)this.results()[g].entityKey===f.entityKey&&this.results.splice(g,1)};function k(a,b){a.relationships(b),a.selectedFamily(a.family),a.filterByCurrUser(a.byCurrUser)}function l(a,b){a.results(b)}return i});
define('catalog/services/catalog-constants',[],function(){"use strict";function a(){this.FOLDER_TYPE_PERSONAL=0,this.FOLDER_TYPE_BASELINE=1,this.FOLDER_TYPE_PUBLIC=2,this.FOLDER_PRIV_NONE=0,this.FOLDER_PRIV_CREATE=1,this.FOLDER_PRIV_VIEW=2,this.FOLDER_PRIV_EDIT_OWN=4,this.FOLDER_PRIV_EDIT_ALL=8,this.FOLDER_PRIV_DELETE_OWN=16,this.FOLDER_PRIV_DELETE_ALL=32,this.ITEM_TYPE_NONE=0,this.ITEM_TYPE_QUERY=-1,this.ITEM_TYPE_GRAPH=-2,this.ITEM_TYPE_REPORT=-3,this.ITEM_TYPE_SEARCH=-4,this.ITEM_TYPE_DATASET=-5,this.ITEM_TYPE_METRICVIEW=-6,this.ITEM_TYPE_EXPLORER=-7,this.ITEM_TYPE_PROJECT=-8,this.ITEM_TYPE_DASHBOARD=-9,this.ITEM_TYPE_R_SCRIPT=-10,this.ITEM_TYPE_SCRIPT=-11,this.QUERY_TYPE_NONE=0,this.QUERY_TYPE_SELECT=1,this.QUERY_TYPE_UPDATE=2,this.QUERY_TYPE_DELETE=3,this.QUERY_TYPE_APPEND=4,this.QUERY_TYPE_TRANSFORM=5,this.QUERY_TYPE_IN=6,this.QUERY_TYPE_AGGREGATE=7,this.GRP_CATALOG_ADMIN="MI Catalog Administrator",this.GRP_POWER_USER="MI Power User Role",this.KEY_PUBLIC_FOLDER="-1",this.KEY_BASELINE_FOLDER="-41",
this.KEY_PERSONAL_FOLDER="-999999999",this.CATALOG_PREFERENCE=1}return a});
define('assets/asset-group-control',['require','jquery','bluebird','system/http/es6-ajax-request','spa/ko/knockout-view-model','spa/region','assets/services/group-service','assets/services/hierarchy-service','assets/services/asset-group-dto','assets/services/asset-context-dto','text!./views/asset-group-control.html','system/globalization/translator','assets/group-filter-view-model','system/error/error-message','application/application-events','application/application-context','catalog/services/dto/user-pref-dto','system/knockout/knockout-manager','catalog/services/catalog-constants','ui/elements/list-group/view-model','ui/elements/tree/view-model','ui/elements/tool-bar/view-model'],function(require){"use strict";var a=require("jquery"),b=require("bluebird"),c=require("system/http/es6-ajax-request"),d=require("spa/ko/knockout-view-model"),e=require("spa/region"),f=require("assets/services/group-service"),g=require("assets/services/hierarchy-service"),h=require("assets/services/asset-group-dto"),i=require("assets/services/asset-context-dto"),j=require("text!./views/asset-group-control.html"),k=require("system/globalization/translator"),l=require("assets/group-filter-view-model"),m=require("system/error/error-message"),n=require("application/application-events"),o=require("application/application-context"),p=require("catalog/services/dto/user-pref-dto"),q=require("system/knockout/knockout-manager"),r=require("catalog/services/catalog-constants");require("ui/elements/list-group/view-model"),require("ui/elements/tree/view-model"),require("ui/elements/tool-bar/view-model");var s={multiSelect:!1,selector:"none",contentArea:"",allowAdd:!1,loadAssets:!0,
hasChildren:!1};function t(a,b,c,d){u.call(this,j),this.user=o.user,this.constants=new r,this.groupService=a,this.hierarchyService=Object.resolve(g),this.translator=b,this.settings=null,this.selectedHierarchy=null,this.selectedFamily=null,this.filter=null,this.groupElement=null,this.appEvents=c,this.delayed=!1,this.filterByCurrUser=!1,this.kom=d,this.selectChildren=null,this.disableSelectAllChildren=null}var u=Object.inherit(d,t,q);t.dependsOn=[f,k,n,q],t.create=function b(c){var d=Object.resolve(t);return d.settings=a.extend(null,s,c),d.filter=new l,d},t.prototype.addAllChildren=function(){var a=new CustomEvent("selectallchildren",{bubbles:!0,cancelable:!0});this.groupElement.dispatchEvent(a)},t.prototype.attach=function a(b){var c;this.disableSelectAllChildren=this.kom.observable(!0),this.settings.contentArea?(c=new e,c.setElement(b.$element.find(this.settings.contentArea))):c=b,u.prototype.attach.call(this,c),this.groupElement=c.$element.find("mi-tree, mi-list-group")[0],
Element.upgrade(this.groupElement),v(this).then(E.bind(null,this)).then(w.bind(null,this))};function v(a){return b.resolve(a.groupService.getPreference(a.user.key,"groups-by-user"))}function w(a){null!==a.groupElement&&(a.groupElement.loader=a.loadGroup.bind(a),a.groupElement.addEventListener("search-selected",a),a.groupElement.addEventListener("filter-closed",a),a.groupElement.addEventListener("navigating",a),a.groupElement.addEventListener("navigated",a),a.settings.loadAssets?a.groupElement.searchCallback=a.searchGroupTree.bind(a):a.groupElement.searchCallback=a.searchGroupList.bind(a),a.groupElement.filterViewModel=a.editFilter.bind(a),a.groupElement.setAttribute("allow-add",a.settings.allowAdd))}t.prototype.handleEvent=function(a){"navigating"===a.type?(3===a.newValue.length&&a.preventDefault(),
this.disableSelectAllChildren(x(a))):"navigated"===a.type&&2===a.target.pathHistory.listGroup.length?a.target.pathHistory.listGroup[1].setAttribute("has-children","false"):"search-selected"===a.type?this.loadcontext(a.searchResult[0]):"filter-closed"===a.type&&(this.applyingFilter=!0)};function x(a){return 1===a.newValue.length}t.prototype.detach=function a(b){var c;this.groupElement.removeEventListener("search-selected",this),this.groupElement.removeEventListener("filter-closed",this),this.groupElement.removeEventListener("navigating",this),this.groupElement.removeEventListener("navigated",this),this.groupElement=null,this.settings.contentArea?(c=new e,c.setElement(b.$element.find(this.settings.contentArea))):c=b,this.filter&&this.filter.close(),c.screen&&u.prototype.detach.call(this,c)},t.prototype.unload=function a(){this.filter&&(this.filter.close(),this.filter=null)},t.prototype.translate=function a(b){return this.translator.translate(b)},t.prototype.editFilter=function a(){
this.filter.show(this.selectedHierarchy,this.selectedFamily,this.filterByCurrUser).done(y.bind(null,this)).fail(B.bind(null,this))},t.prototype.searchGroupTree=function(a,b,c,d){return this.groupService.getAllGroups(c,d,z(this),this.selectedFamily,this.filterByCurrUser,a).fail(B.bind(null,this)).promise()},t.prototype.searchGroupList=function(a,b,c){return this.groupService.getAllGroups(b,c,z(this),this.selectedFamily,this.filterByCurrUser,a).fail(B.bind(null,this)).promise()},t.prototype.loadGroup=function b(c,d,e){var f=a.Deferred();return void 0===e?this.groupService.getAllGroups(c,d,z(this),this.selectedFamily,this.filterByCurrUser).done(f.resolve.bind(f)).fail(B.bind(null,this)):0===c?this.groupService.getAllGroups(d,e,z(this),this.selectedFamily,this.filterByCurrUser).done(f.resolve.bind(f)).fail(B.bind(null,this)):this.groupService.assets(this.groupElement.value[c].entityKey,d,e).done(f.resolve.bind(f)).fail(B.bind(null,this)),f.promise()},t.prototype.loadcontext=function(a){
a&&(this.settings.loadAssets?C(this,a):D(this,a))},t.prototype.getContextValue=function(){return this.loadAssets?i.fromGroupDTO(this.groupElement.value[this.groupElement.value.length-1]):i.fromGroupDTO(this.groupElement.value||this.groupElement.items[0])},t.prototype.setValue=function(a,b){var c=b.originalEvent.searchResult[0];c&&(this.groupElement.value=c,this.groupElement.reload())},t.prototype.loadState=function(a){a=a||{},this.selectedHierarchy=a.hierarchy,this.selectedFamily=a.family,this.filterByCurrUser=a.byCurrUser,this.groupElement.loadState(a.groupElement)},t.prototype.saveState=function(){return{hierarchy:this.selectedHierarchy,family:this.selectedFamily,byCurrUser:this.filterByCurrUser,groupElement:this.groupElement.saveState()}};function y(a,b){a.selectedFamily=b.family,a.selectedHierarchy=b.results,a.filterByCurrUser!==b.byCurrUser&&(a.filterByCurrUser=b.byCurrUser,F(a)),a.groupElement.reload()}function z(a){
return a.selectedHierarchy?a.selectedHierarchy instanceof Array?0===a.selectedHierarchy.length?null:a.selectedHierarchy.map(A):[a.selectedHierarchy.entityKey]:null}function A(a){return a.entityKey}function B(a,b,c,d){if("abort"!==d){var e=new m("AG1",d,(new Error).stack);a.appEvents.errorOccured.raise(a,e)}}function C(a,b){"-1"===b.entityKey?a.groupElement.value&&a.groupElement.value.length>0&&(a.groupElement.value=a.groupElement.value[0]):a.groupElement.value[1]=h.fromAssetContextDTO(b)}function D(a,b){var c=h.fromAssetContextDTO(b);a.groupElement.value=c,a.groupElement.reload();var d=a.groupElement.querySelector("mi-list-group");d&&(Element.upgrade(d),d.value=c,d.reload())}function E(a,b){b&&b.value&&(a.filterByCurrUser="True"===b.value)}function F(a){var b=new p;b.userKey=a.user.key,b.prefType=a.constants.CATALOG_PREFERENCE,b.name="groups-by-user",b.value=a.filterByCurrUser,a.groupService.setPreference(b)}return t});
define('system/ui/dialog-box',['require','lodash','jquery','system/ui/dialog-view-model','system/lang/object'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("system/ui/dialog-view-model");require("system/lang/object");function d(a,b,c){e.call(this,a,b,c),this.handlingButtonClick=!1,this.dfd=null,this.showHelp(!1),this.showClose(!1),this.showCheck(!1)}var e=Object.inherit(c,d);d.prototype.show=function(){return e.prototype.show.call(this),f(this),this.dialogContentRegion.$element.css("overflow-y","auto").addClass("dialog-box"),this.dfd=b.Deferred(),this.dfd.promise()},d.prototype.setContent=function(a){e.prototype.setContent.call(this,a)};function f(c){if(c.options&&c.options.buttons){var d=c.options.buttons||[],e=c.dialogShellRegion.$element.find(".dialog-wrapper");if(d.length>0){var f=b('<div class="button-bar clearfix text-right"></div>').appendTo(e);a.each(d,function(a,d){var e=a.cssClass?a.cssClass:"btn-default";b('<button class="btn pull-right '+e+'"><span>'+a.name+"</span></button>").on("click",g.bind(null,c,d,a.value||a.name)).appendTo(f)}),
b('<div class="clearfix"></div>').appendTo(f),c.centerDialog()}}}function g(a,c,d){if(!a.handlingButtonClick){a.handlingButtonClick=!0;var e=Object.tryMethod(a.content,d);if(e===!1)return void(a.handlingButtonClick=!1);b.when(e).done(function(b){a.dfd.resolve(c,d,b),a.closeDialog(),a.handlingButtonClick=!1}).fail(function(b){a.options.closeOnReject&&(a.dfd.reject(c,d,b),a.closeDialog()),a.handlingButtonClick=!1})}}d.prototype.closeDialog=function(){h(this),e.prototype.closeDialog.apply(this,arguments)};function h(c){var d=c.dialogShellRegion.$element.find(".dialog-wrapper"),e=b(".button-bar",d),f=e.find("button");a.each(f,i),e.remove(),c.centerDialog()}function i(a){b(a).off().remove()}return d});
define('assets/models/selected-asset-results',['require','knockout'],function(require){"use strict";var a=require("knockout");function b(){this.existing=null,this.selected=null,this.arrayChangeSubscription=null,this.added=[],this.removed=[]}b.prototype.init=function b(d){var e,f=[];if(this.existing=d,d)for(e=0;e<d.length;e++)f[f.length]=d[e];this.selected=a.observableArray(f),this.arrayChangeSubscription=this.selected.subscribe(c.bind(null,this),null,"arrayChange")},b.prototype.dispose=function a(){this.selected([]),this.selected=null,this.arrayChangeSubscription.dispose(),this.arrayChangeSubscription=null};function c(a,b){var c;for(c=0;c<b.length;c++)"added"===b[c].status?f(a,b[c].value):e(a,b[c].value.entityKey)}function d(a,b){for(var c=0,d=!1;c<a.length&&!d;)d=a[c].entityKey===b,c++;return d?a[c-1]:void 0}function e(a,b){var c=0,e=!1,f;if(f=d(a.existing,b))a.removed.push(f);else for(c=0,e=!1;c<a.added.length&&!e;)e=a.added[c].entityKey===b,e&&a.added.splice(c,1),c++}function f(a,b){var c=0,e=!1;if(d(a.existing,b.entityKey))for(c=0,
e=!1;c<a.removed.length&&!e;)e=a.removed[c].entityKey===b.entityKey,e&&a.removed.splice(c,1),c++;else d(a.added,b.entityKey)||a.added.push(b)}return b});

define('text!ui/elements/asset-context/template.html',[],function () { return '<div class="asset-context-selection static">\r\n  <div class="navigation">\r\n    <ul class="nav nav-pills assetMenu pull-left" data-bind="click: menuClick">\r\n      <li data-bind="css: {active: activePill() === hierarchy.url }">\r\n        <a data-bind="attr: { \'data-menu-item\': hierarchy.url, href: hierarchy.href, title: translator.translate(\'ASSET_HIERARCHY\') }, text: translator.translate(\'ASSET_HIERARCHY\')">\r\n        </a>\r\n      </li>\r\n      <li data-bind="css: {active: activePill() === group.url }">\r\n        <a data-bind="attr: { href: group.href, \'data-menu-item\': group.url, title: translator.translate(\'ASSET_GROUP\') }, text: translator.translate(\'ASSET_GROUP\')">\r\n        </a>\r\n      </li>\r\n    </ul>          \r\n  </div>\r\n  <section class="block-group context-select">\r\n    <section class="asset-content">\r\n      <section class="asset-hierarchy-control" data-bind="visible: $root.activePill() === \'hierarchy\'"></section>\r\n      <section class="asset-group-explorer" data-bind="visible: $root.activePill() === \'group\'"></section>\r\n    </section>\r\n  </section>\r\n</div>\r\n';});

define('ui/elements/asset-context/view-model',['require','lodash','jquery','assets/asset-hierarchy-control','assets/asset-group-control','system/ui/dialog-box','system/globalization/translator','assets/models/selected-asset-results','knockout','text!./template.html','spa/region','application/application-context','assets/services/asset-context-dto','assets/services/hierarchy-dto','assets/services/asset-group-dto','assets/services/asset-context-service','ramda'],function(require){"use strict";var a=require("lodash"),b=require("jquery"),c=require("assets/asset-hierarchy-control"),d=require("assets/asset-group-control"),e=require("system/ui/dialog-box"),f=require("system/globalization/translator"),g=require("assets/models/selected-asset-results"),h=require("knockout"),i=require("text!./template.html"),j=require("spa/region"),k=require("application/application-context"),l=require("assets/services/asset-context-dto"),m=require("assets/services/hierarchy-dto"),n=require("assets/services/asset-group-dto"),o=require("assets/services/asset-context-service"),p=require("ramda"),q=["selector","multiselect","allowAdd"],r={};r.prototype=Object.create(HTMLElement.prototype),r.prototype.createdCallback=function(){this.element=this,this.translator=Object.resolve(f),this.results=null,this.dialog=null,this.existing=[],this.activePill=null,this.internalvalue=null,this.showAsDialog=null,this.assetContextService=Object.resolve(o),this.group={
href:"#assets/group",title:this.translator.translate("ASSET_GROUP"),url:"group",screen:null},this.hierarchy={href:"#assets/hierarchy",title:this.translator.translate("ASSET_HIERARCHY"),url:"hierarchy",screen:null},Object.defineProperty(this,"value",{get:K.bind(null,this),set:this.setContext.bind(this)}),this.delayload=Element.booleanAttribute(this,"delayload")},r.prototype.setContext=function(c){var d=new b.Deferred,e;return c&&(e=c.entityKey||c)?this.internalvalue&&"-1"!==this.internalvalue.entityKey&&L(this.internalvalue.entityKey,e)?(a.defer(d.resolve,this.internalvalue),d.promise()):(s(this,c),z(this,c,d),d.promise()):(a.defer(d.resolve,this.internalvalue),d.promise())};function s(a,b){"string"==typeof b&&B(a,b)}r.prototype.attachedCallback=function(){Element.clearDom(this),"true"===this.getAttribute("data-open")?(this.load(),this.attach(new j(b(this)))):T(this)},r.prototype.disableStuff=function(a,b){if(a!==!1||b!==!1){var c=this.region.element.querySelector(".assetMenu")
;a===!0?(P(this),M(this),this.region.element.querySelector(".asset-hierarchy-control").style.display="none",c.removeChild(c.firtElementChild),this.activePill("hierarchy")):b===!0&&(R(this),N(this),this.region.element.querySelector(".asset-group-explorer").removeAttribute("data-bind"),c.removeChild(c.lastElementChild),this.activePill("group")),c.classList.add("not-active")}},r.prototype.detachedCallback=function(){this.region&&(this.detach(),this.unload())},r.prototype.attributeChangedCallback=function(a,b,c){this.delayload===!1&&("entitykey"===a?z(this,c):"loadassets"===a?(this.group.screen.settings.loadAssets="true"===c,this.group.screen.settings.hasChildren="true"===c,this.group.screen.detach(this.region),this.group.screen.attach(this.region)):"selectchildren"===a?this.hierarchy.screen.selectChildren(c):"multiselect"===a&&(this.hierarchy.screen.settings.multiSelect="true"===c),H(this,a,c))},r.prototype.menuClick=function a(b,c){var d,e,f;c.preventDefault(),
c.stopImmediatePropagation(),f=c.target.getAttribute("data-menu-item"),e="hierarchy"===f?this.hierarchy:this.group,d=new CustomEvent("menu-changing",{bubbles:!0,cancelable:!0,detail:{menu:e}}),this.dispatchEvent(d),d.returnValue===!1||d.defaultPrevented||("hierarchy"===f?this.showHierarchy():this.showGroup())},r.prototype.load=function(){var a,b,e,f;for(this.results=new g,this.results.init(),this.results.existing=this.existing,this.activePill=h.observable("hierarchy"),f=this.getAttribute("data-open"),this.showAsDialog=h.observable(!f),a=0;a<this.existing.length;a++)this.results.selected.push(this.existing[a]);b={multiSelect:!1,selectedItems:this.results.selected,selectable:!1,contentArea:".asset-hierarchy-control",enableAddAllChildren:null!==this.getAttribute("enableAddAllChildren"),selectChildren:null!==this.getAttribute("selectChildren")},e={multiSelect:!1,selectedItems:this.results.selected,selectable:!1,contentArea:".asset-group-explorer",
loadAssets:null!==this.getAttribute("loadassets"),enableAddAllChildren:null!==this.getAttribute("enableAddAllChildren"),allowAdd:null!==this.getAttribute("allow-add")},this.hierarchy.screen=c.create(b),this.hierarchy.screen.load(),this.group.screen=d.create(e)},r.prototype.attach=function(a){this.region=a,this.region.attach(b(i)),this.region.$element.find(".region").attr("data-bind","halt-bindings"),this.region.element.addEventListener("change",this),this.delayload===!1&&(h.applyBindingsToDescendants(this,this.region.element.querySelector(".region")),O(this),Q(this),I(this),Element.raiseEvent(this.group.screen.groupElement.querySelector("mi-tool-bar"),"resize",{}))},r.prototype.detach=function(){P(this),R(this),h.cleanNode(this.region.element),this.region.clear(),this.region=null},r.prototype.handleEvent=function(a){
"navigated"===a.type?this.group.screen&&a.target===this.group.screen.groupElement?w(this):u(this):"selected"===a.type&&"group"!==this.activePill()&&this.group.screen&&a.target!==this.group.screen.groupElement?u(this):"selected"===a.type&&"group"===this.activePill()?v(this):"loaded"===a.type?J(this,a):"click"===a.type?x(this):"change"===a.type&&a.target!==this&&a.stopImmediatePropagation()},r.prototype.unload=function a(){M(this),N(this)},r.prototype.translateText=function a(b){return this.translator.translate(b)},r.prototype.done=function a(){this.dialog||y(this)},r.prototype.showHierarchy=function a(){this.activePill(this.hierarchy.url),Element.raiseEvent(this,"menu-change",{menu:this.hierarchy})},r.prototype.showGroup=function a(){this.activePill(this.group.url),Element.raiseEvent(this,"menu-change",{menu:this.group}),Element.raiseEvent(this.group.screen.groupElement.querySelector("mi-tool-bar"),"resize",{})},r.prototype.setSiteFilter=function(a){
this.hierarchy.screen.setSiteFilter(a)},r.prototype.loadState=function(a){var c,d;return a=a||{},a.hierarchy=a.hierarchy||{},a.group=a.group||{},a.hierarchy.value=null,a.group.value=null,this.hierarchy.screen.loadState(a.hierarchy),this.group.screen.loadState(a.group),c=a.value,c?d=this.setContext(c):(d=b.Deferred(),d.resolve(),a.menu===this.group.url?(this.activePill(this.group.url),this.group.screen.groupElement.addEventListener("loaded",this),this.group.screen.groupElement.reload()):(this.activePill(this.hierarchy.url),this.value=t(this)?k.assetcontext:l.default())),d.promise()},r.prototype.saveState=function(){return{hierarchy:this.hierarchy.screen.saveState(),group:this.group.screen.saveState(),value:this.internalvalue,menu:this.activePill()}},r.prototype.href=function(){return this.activePill()===this.hierarchy.url?this.hierarchy.href+"/"+this.value.entityKey:this.group.href+"/"+this.value.entityKey};function t(a){if(p.isNil(a.parentElement))return!1
;if(p.isNil(a.parentElement.parentElement))return!1;if(p.isNil(a.parentElement.parentElement.parentElement))return!1;var b=a.parentElement.parentElement.parentElement;return b.classList.contains("assets-shell-screen")&&!b.classList.contains("asset-finder-screen")}function u(a){var c=a.hierarchy.screen.contextBrowser.selectedAsset;A(a,l.fromHierarchyDTO(c)),b(a.element).find("span.context-id").text(a.internalvalue.description)}function v(a){a.group.screen.groupElement.value&&(A(a,l.fromGroupDTO(a.group.screen.groupElement.value)),b(a.element).find("span.context-id").text(a.internalvalue.description))}function w(a){var c=a.group.screen.groupElement.value.length-1,d=a.group.screen.groupElement.value[c];A(a,l.fromGroupDTO(d)),b(a.element).find("span.context-id").text(a.internalvalue.description)}function x(a){var c={height:"90%",width:"auto",buttons:[{name:a.translator.translate("DONE"),value:"done",cssClass:"btn-primary"}]},d=a.translator.translate("ASSET_HIERARCHY")
;null!==a.getAttribute("dialog")?(a.dialog=new e(a,d,c),a.dialog.show(),a.loadState()):(a.region||a.attach(new j(b(a.querySelector(".asset-context-selection")))),b(a.element).find("div.asset-context-selection").show())}function y(a){b(a.element).find("div.asset-context-selection").removeAttr("style")}function z(a,b,c){var d;b instanceof l?setTimeout(F.bind(null,a,c,b),0):b instanceof m?(d=l.formHierarchyDTO(b),setTimeout(F.bind(null,a,c,d),0)):b instanceof n?(d=l.fromGroupDTO(b),setTimeout(F.bind(null,a,c,d),0)):b.entityKey?a.assetContextService.getcontext(b.entityKey).done(F.bind(null,a,c)).fail(c.reject.bind(c)):a.assetContextService.getcontext(b).done(F.bind(null,a,c)).fail(c.reject.bind(c))}function A(a,b){(!a.internalvalue&&a.internalvalue!==b||a.internalvalue.entityKey!==b.entityKey)&&(a.internalvalue=b,G(a))}function B(a,b){(!a.internalvalue&&a.internalvalue!==b||a.internalvalue.entityKey!==b.entityKey)&&(a.internalvalue=b)}function C(a){var b=a.value||[{}]
;return 0===b.length?"":b[b.length-1].entityKey||""}function D(a){var b=a.selectedAsset;return b?b.entityKey:""}function E(a,b){var c,d,e,f;(a.region||a.dialog)&&(c="Hierarchy"===b.type,f=a.hierarchy.screen.contextBrowser,c?(a.activePill(a.hierarchy.url),D(f)!==b.entityKey&&a.hierarchy.screen.loadcontext(b.entityKey)):(a.activePill(a.group.url),e=a.group.screen.groupElement,e.value&&e.value.entityKey===b.entityKey||a.group.screen.loadcontext(b)))}function F(a,c,d){null===d&&(d=k.assetcontext||l.default()),E(a,d),A(a,d),a.internalvalue&&b(a.element).find("span.context-id").text(a.internalvalue.description),c&&c.resolve(d)}function G(a){Element.raiseEvent(a,"change",a.internalvalue)}function H(a,b,c){var d,e,f,g,h;if(q.indexOf(b)>-1){for(h=a.querySelector("asset-hierarchy-control"),"selector"===b&&h&&(h.enableMultiSelect="addOnly"===c),d=a.getElementsByTagName("mi-list-group"),e=0;e<d.length;e++)null!==c?d[e].setAttribute(b,c):d[e].removeAttribute(b)
;for(f=a.querySelectorAll("mi-tool-bar mi-searchbox"),e=0;e<f.length;e++)null!==c?f[e].setAttribute(b,c):f[e].removeAttribute(b);for(g=a.getElementsByTagName("mi-tree"),e=0;e<g.length;e++)"groupid"===g[e].getAttribute("description")&&"selector"===b&&(c="none"),null!==c?g[e].setAttribute(b,c):g[e].removeAttribute(b)}}function I(a){var b;for(b=0;b<q.length;b++)H(a,q[b],a.getAttribute(q[b]))}function J(a,b){if(null!==b.detail.frag.querySelector("mi-li")){var c=b.detail.frag.querySelector("mi-li").value;a.value=c,a.group.screen&&a.group.screen.groupElement.removeEventListener("loaded",a)}}function K(a){return a.internalvalue}function L(a,b){return a="0"===a?"-1":a,b="0"===b?"-1":b,a===b}function M(a){a.hierarchy.screen&&(a.hierarchy.screen.unload(),a.hierarchy.screen=null)}function N(a){a.group.screen&&(a.group.screen.unload(),a.group.screen=null)}function O(a){a.hierarchy.screen.attach(a.region,!0),a.hierarchy.screen.contextBrowser.addEventListener("selected",a)}function P(a){
a.hierarchy.screen&&(a.hierarchy.screen.contextBrowser.removeEventListener("selected",a),a.hierarchy.screen.detach(a.region))}function Q(a){var b;a.group.screen.attach(a.region),b=null!==a.getAttribute("loadassets"),b?a.group.screen.groupElement.addEventListener("navigated",a):a.group.screen.groupElement.addEventListener("selected",a)}function R(a){a.group.screen&&(a.group.screen.groupElement.removeEventListener("navigated",a),a.group.screen.groupElement.removeEventListener("selected",a),a.group.screen.detach(a.region))}function S(a){var c=k.assetcontext||l.default();F(a,b.Deferred(),c)}function T(a){var b,c,d,e,f;f=document.createElement("div"),f.className="region",b=document.createElement("div"),f.appendChild(b),c=document.createElement("button"),c.className="btn btn-default",b.appendChild(c),e=document.createElement("span"),e.className="context-id",c.appendChild(e),c.addEventListener("click",a),d=document.createElement("i"),d.className="ds ds-assethierachy ds-dashboard-style",
c.appendChild(d),a.appendChild(f),b=document.createElement("div"),b.className="asset-context-selection",a.appendChild(b),S(a)}return document.registerElement("mi-asset-context",{prototype:r.prototype}),r});
define('assets/assets-shell-view-model',['require','jquery','spa/ko/knockout-route-screen','application/application-events','system/globalization/translator','text!./views/asset-shell.html','application/application-context','assets/services/hierarchy-service','assets/services/asset-context-service','app-hub/global/app-hub-application-context','ui/elements/asset-context/view-model'],function(require){"use strict";var a=require("jquery"),b=require("spa/ko/knockout-route-screen"),c=require("application/application-events"),d=require("system/globalization/translator"),e=require("text!./views/asset-shell.html"),f=require("application/application-context"),g=require("assets/services/hierarchy-service"),h=require("assets/services/asset-context-service"),i=require("app-hub/global/app-hub-application-context");require("ui/elements/asset-context/view-model");function j(a){var b=[{url:"",module:"assets/hierarchy-view-model","allow-small-screen":!0,"available-offline":!0},{url:"hierarchy/@",module:"assets/hierarchy-view-model","allow-small-screen":!0,"available-offline":!0},{url:"group/@",module:"assets/manage-group-view-model","allow-small-screen":!0,"available-offline":!0}];k.call(this,e,b,"div.asset-content"),this.assetContextChanged=a.assetcontextChanged,this.updateCurrentContext=null,this.ttitleChanged=a.titleChanged,this.navigate=a.navigate,
this.translator=Object.resolve(d),this.context=null,this.contextState={},this.hierarchyservice=Object.resolve(g),this.appHubApplicationContext=Object.resolve(i),this.assetContextService=Object.resolve(h)}j.dependsOn=[c];var k=Object.inherit(b,j);j.prototype.open=function a(b){var c=b.split("/");this.ttitleChanged.raise(this.translator.translate("ASSETS"),this),this.contextState.menu=c[0],this.contextState.value=c[1],this.assetContextChanged.add(l.bind(null,this),this)};function l(a,b){a.updateCurrentContext=b}j.prototype.handleEvent=function a(b){switch(b.type){case"change":m(this,b);break;case"menu-change":p(this,b)}},j.prototype.activate=function a(){k.prototype.activate.apply(this,arguments)},j.prototype.attach=function b(c,d){k.prototype.attach.apply(this,arguments),this.context=a(c.element).find("mi-asset-context")[0],Element.upgrade(this.context),this.updateCurrentContext&&(this.contextState.value=this.updateCurrentContext,this.updateCurrentContext=null),
this.context.loadState(this.contextState),this.contentRegion.screen&&(this.contentRegion.screen.assetContext=this.context),this.resolveSubRoute(d||""),this.context.addEventListener("menu-change",this),this.context.addEventListener("change",this)},j.prototype.detach=function a(){this.context.removeEventListener("change",this),this.context.removeEventListener("menu-change",this),this.contextState=this.context.saveState(),this.context=null,k.prototype.detach.apply(this,arguments)},j.prototype.route=function(a){a.screen.assetContext=this.context,k.prototype.route.call(this,a)};function m(a,b){if("MI-ASSET-CONTEXT"===b.target.nodeName){var c=b.detail.entityKey;a.hierarchyservice.storeAssetHierarchyKey(c).done(n.bind(null,a,c)),f.assetcontext=b.detail,a.navigate.raise(a.context.href(),a)}}function n(a,b){a.assetContextService.getAssetContextAppHub().done(o.bind(null,a,b))}function o(a,b,c){
b!==f.assetcontext.entityKey&&""===c&&null!==c?a.appHubApplicationContext.setAssetContext(null):""!==c&&null!==c?a.appHubApplicationContext.setAssetContext({sourceKey:c}):a.appHubApplicationContext.setAssetContext(null)}function p(a,b){b.detail.menu.url!==a.url&&(a.context.value=b.detail.menu.screen.getContextValue())}return j});
