/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function(require){"use strict";var a=require("jquery"),b=require("lodash"),c=require("spa/ko/knockout-view-model"),d=require("text!metrics/views/kpi-list-view.html"),e=require("knockout"),f=require("toastr"),g=require("metrics/services/kpi-service"),h=require("system/ui/dialog-box");require("kobindings"),require("system/lang/object"),require("ui/elements/list-group/view-model");function i(a){var b=this;j.call(b,d),b.isChildren=e.observable(!1),b.isForSubIndicators=e.observable(!1),b.selectedKpiList=e.observableArray([]),b.parentKey=e.observable(),b.childrenKey=e.observableArray([]),b.kpiService=a,b.list=null,b.isMultiselectOption=e.observable(!1)}var j=Object.inherit(c,i);i.dependsOn=[g],i.prototype.attach=function a(b){var c=this;j.prototype.attach.call(this,b),c.region=b,c.list=c.region.$element.find("mi-list-group")[0],c.isMultiselectOption()||(c.list.attributes.multiselect.value=!1,c.list.attributes.selector.value="none"),c.list.loader=l.bind(null,c),
c.list.addEventListener("selected",this),c.list.searchCallback=k.bind(null,c),Element.upgrade(c.list)},i.prototype.handleEvent=function(a){var b=this;"selected"===a.type&&null!==a.target.value&&void 0!==a.target.value&&(b.isMultiselectOption()?b.selectedKpiList(a.target.selectedItems):(b.selectedKpiList.removeAll(),b.selectedKpiList([a.target.value])))};function k(c,d,e,f){var g=a.Deferred();return c.kpiService.getKpiList((e-1)*f,f,a.trim(d),c.isForSubIndicators(),c.parentKey()).done(function(a){var d=b.remove(a,function(a){return a.key===c.parentKey()});g.resolve(a)}).fail(function(a){a.responseJSON&&a.responseJSON.modelState&&m(c,a.responseJSON.modelState,a.responseJSON.message)}),g.promise()}function l(c,d,e){var f=a.Deferred();return c.kpiService.getKpiList((d-1)*e,e,null,c.isForSubIndicators(),c.parentKey()).done(function(a){var d=b.remove(a,function(a){return a.key===c.parentKey()});f.resolve(a)}).fail(function(a){
a.responseJSON&&a.responseJSON.modelState&&m(c,a.responseJSON.modelState,a.responseJSON.message)}),f.promise()}i.prototype.ok=function a(){return this.selectedKpiList()};function m(a,b,c){var d;if(b instanceof Object)for(var e in b)if(b.hasOwnProperty(e))for(var g=0;g<b[e].length;g++)f.error(b[e][g],c)}return i});