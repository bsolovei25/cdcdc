/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function(require){"use strict";require("system/lang/object");var a=require("jquery"),b=require("knockout"),c=require("system/http/ajax-client"),d=require("rounds/common/dto/route-info-dto").RouteInfoDTO,e=require("rounds/common/dto/route-detail-dto").RouteDetailDTO,f=require("rounds/designer/models/ref-doc-image-model").RefDocImage,g=require("security/services/user-dto"),h="api/rounds/allowablevalues",i="api/internal/rounds/allowablevalues",j="api/rounds/mlt",k="api/rounds/mlgt",l=require("system/data/client-preferences"),m="inspection-route-horizon",n="api/core/metadata/entityfamily",o="api/core/security",p="api/core/globalization",q="api/internal/Rounds/Routes",r=require("bluebird"),s=require("ramda"),t=100,u=require("rounds/common/dto/reset-nextdate-dto").ResetNextDateDTO,v=require("rounds/common/dto/reset-schedule-dto").ResetScheduleDTO,w="api/rounds/refdoc";function x(a,b){this.ajaxClient=a,this.preferences=b}x.dependsOn=[c,l],
x.prototype.getGroupedAllowableValues=function(){return this.ajaxClient.get(i+"/Grouped")},x.prototype.getAllowableValuesCount=function(){return this.ajaxClient.get(h+"/count")},x.prototype.getAllowableValueFieldLength=function(){return this.ajaxClient.get(n+"?id=MI_OPR_AL_VL")},x.prototype.deleteGroupedAllowableValues=function(a,b){return this.ajaxClient.delete(h+"?type="+a+"&category="+b)},x.prototype.updateValue=function c(d,e){e.ajaxServiceCount+=1;var f=a.Deferred(),g;return g=0===d.key?this.ajaxClient.post(h,b.toJSON(d)):this.ajaxClient.put(h,b.toJSON(d)),g.done(function(a){f.resolve(a),e.ajaxServiceCount-=1}).fail(function(a){f.reject(a),e.ajaxServiceCount-=1}),f},x.prototype.getAllowableValuesCaption=function(){return this.ajaxClient.get(h+"/Caption")},x.prototype.deleteRoute=function(a){return this.ajaxClient.post("api/rounds/routes/deleteRoutes",a)},x.prototype.getAdminRoutes=function(a){return this.ajaxClient.get("api/Rounds/Routes/AdminRoutes/"+a)},
x.prototype.getUserRoutes=function(){var b=a.Deferred();return this.ajaxClient.get("api/Rounds/Routes/UserRoutes/-1").done(K.bind(null,b)).fail(L.bind(null,b)),b},x.prototype.getRecommendations=function(){return this.ajaxClient.get("api/Rounds/Routes/Recommendations/-1")},x.prototype.toggleRouteSubscription=function(a){return this.ajaxClient.post("api/Rounds/Routes/subscription",a.toString())},x.prototype.routesSubscription=function(b){var c=a.Deferred();return this.getHorizonPreference().done(y.bind(null,this,c,b)),c.promise()};function y(a,b,c,d){a.ajaxClient.post("api/internal/Rounds/Routes/Subscribe?key="+c.toString()+"&horizon="+(d||"0")).done(b.resolve.bind(b)).fail(b.reject.bind(b))}x.prototype.routesUnsubscription=function(a){return this.ajaxClient.post("api/internal/Rounds/Routes/Unsubscribe/",a.toString())},x.prototype.getRoutesCaption=function(){return this.ajaxClient.get("api/Rounds/Routes/Caption")},x.prototype.getAllCounts=function(a){
return this.ajaxClient.get("api/internal/Rounds/Routes/AllCount/"+a)},x.prototype.getMLTemplatesCount=function(){return this.ajaxClient.get(j+"/count")},x.prototype.getMLTemplates=function(){return this.ajaxClient.get(j+"/all/0")},x.prototype.deleteMLTemplate=function(a){return this.ajaxClient.delete(j+"/"+a)},x.prototype.getMLTCaption=function(){return this.ajaxClient.get("api/Rounds/MLT/Caption")},x.prototype.getMLGTemplates=function(){return this.ajaxClient.get(k)},x.prototype.getMLGTemplatesCount=function(){return this.ajaxClient.get(k+"/count")},x.prototype.deleteMLGTemplate=function(a){return this.ajaxClient.delete(k+"/"+a)},x.prototype.getMLGTCaption=function(){return this.ajaxClient.get("api/Rounds/MLGT/Caption")},x.prototype.familiesHasCP=function(){return this.ajaxClient.get("api/Rounds/MLGT/HasCPFamilies")},x.prototype.getRouteDetail=function b(c){var d=a.Deferred();return this.ajaxClient.get("api/internal/rounds/inspection/"+c).done(J.bind(null,d)).fail(L.bind(null,d)),d},
x.prototype.getUserRoute=function(b){var c=a.Deferred();return this.ajaxClient.get("api/Rounds/Routes/UserRoute?routekey="+b).done(I.bind(null,c)).fail(L.bind(null,c)),c},x.prototype.getMlsToUpdate=function(a){return this.ajaxClient.get("api/Rounds/MLT/ML/"+a)},x.prototype.updateExistingMLs=function(a,c){return this.ajaxClient.put("api/internal/Rounds/MLT/update/ML/"+a,b.toJSON(c))},x.prototype.getReports=function(){return this.ajaxClient.get("api/Rounds/Routes/Reports")},x.prototype.getHorizonPreference=function(){return this.preferences.retrievePreferences(m)},x.prototype.resetCheckpointNextDateOnRoute=function(a,b){return r.resolve(this.getCheckpointTaskKeys(a,!1)).then(A.bind(null,this.ajaxClient,a,b))},x.prototype.getCheckpointTaskKeys=function(a,b){return this.ajaxClient.get(q+"/"+a+"/"+b+"/checkpointtasks")},x.prototype.resetCheckpointScheduleOnRoute=function(a,b,c){return r.resolve(this.getCheckpointTaskKeys(a,c)).then(E.bind(null,this.ajaxClient,a,b))},
x.prototype.getRefDocImagesForCp=function(a){return r.resolve(this.ajaxClient.get(w+"/"+a)).then(z.bind(this))};function z(a){return f.fromDataCollection(a)}x.prototype.updateRefDocImageForCp=function(a,b){return r.resolve(this.ajaxClient.put(w+"/"+a+"/"+b)).then(z.bind(this))};function A(a,b,c,d){var e=B(d),f=C(a,b,c),g=s.map(f,e);return s.composeP.apply(null,g)()}function B(a){return s.splitEvery(t,a)}function C(a,b,c){return function(d){return function(){return D(a,b,d,c)}}}function D(a,b,c,d){var e=new u({taskKeys:c,dateTime:d});return r.resolve(a.put(q+"/"+b+"/nextdates",e))}function E(a,b,c,d){var e=B(d),f=F(a,b,c),g=s.map(f,e);return s.composeP.apply(null,g)()}function F(a,b,c){return function(d){return function(){return G(a,b,d,c)}}}function G(a,b,c,d){var e=new v({taskKeys:c,schedule:d});return r.resolve(a.put(q+"/"+b+"/schedules",e))}function H(a,b){a.resolve(b)}function I(a,b){a.resolve(new d(b))}function J(a,b){a.resolve(new e(b))}function K(a,b){
a.resolve(d.fromDataCollection(b))}function L(a,b){a.reject(b)}return x});