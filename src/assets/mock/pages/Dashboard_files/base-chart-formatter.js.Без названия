/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(["require","exports","ramda","ui/elements/chart/chart-utilities","system/text/formatter","system/lang/object"],function(require,exports,a){"use strict";var b=require("lodash"),c=require("system/lang/object"),d=require("ui/elements/chart/chart-utilities"),e=require("system/text/formatter"),f=/{(.*?)}/g,g=/{|}/g,h=a.has("options"),i=a.has("formattedValue"),j=a.has("formattedValues"),k=a.has("point"),l=a.has("index"),m=a.has("series"),n=a.has("formattedXValue"),o=a.has("formattedYValue"),p=a.has("formattedZValue"),q=a.split("."),r=a.prop("formattedValue"),s=function(b){return a.propEq("x",b)},t=a.curry(function a(b,c){var d=this.series.options.dataLabels.pointFormat||"{point.y:g2}",e=E(b,d,this);if(F(b)){return'<div class="'+(b.config.truncateLabels?"data-label":"")+'" title="'+e+'">'+e+"</div>"}return e}),u=a.curry(function a(b,c){return E(b,this.series.tooltipOptions.pointFormat,this)}),v=function(){function a(a){this.axisFormatter=w,this.formatDataLabels=t,this.formatTooltip=u,
this.config=a,this.chartUtil=c.resolve(d)}return a.prototype.translateFormatting=function(a){return""!==a.format?a.format+a.decimals:""},a}();exports.BaseChartFormatter=v;function w(){var a=this.axis.options.labels.format||"g2";return x(this.value,a)}function x(a,b){return b?c.resolve(e).format(a,b):a}function y(a,b){var c,d=b.replace(g,"").split("."),e;for(e=a,c=0;c<d.length;c++)void 0!==e[d[c]]&&(e=e[d[c]]);return e}function z(a,b){return b.yAxis?b.yAxis.options.labels.format:F(a)?a.options.yAxis[0].labels.format:""}function A(a,c,d){var e,f,h,i,j,k,l,m=z(a,c.series);return f=d.replace(g,""),e=f.split(":"),l=f.split(".")[1]?f.split(".")[1]:"",f=e[0],h=e.length>1&&""===m?e[1]:m,j=y(c,f),i=D(c,j,h,d),k=isNaN(j)?null:Number(i),null!==i&&!a.config.formattedQuery&&b.isNumber(j)&&c.options&&(c.options.formattedValue=i),null!==k&&"name"!==l&&"percentage:n0"!==l&&(i=C(a,c,f,i)),i}function B(b,c,d){if(a.test(/\bstock\b/,b.config.chartType)){var e=b.chartData[0].data
;return a.compose(a.join("<br/>"),a.uniq,a.map(r),a.filter(s(c)))(e)}return d}function C(b,c,d,e){var f=q(d);return h(c)&&i(c)&&c.options.formattedValue?e=B(b,c.options.x,c.options.formattedValue):k(c)&&h(c.point)&&c.point.options.formattedValue?e=c.point.options.formattedValue:n(c)||o(c)||p(c)?a.any(a.equals("x"),f)&&c.formattedXValue?e=c.formattedXValue:a.any(a.equals("y"),f)&&c.formattedYValue?e=c.formattedYValue:a.any(a.equals("z"),f)&&c.formattedZValue&&(e=c.formattedZValue):l(c)&&m(c)&&l(c.series)&&b.chartData[c.series.index]&&j(b.chartData[c.series.index])?""!==b.chartData[c.series.index].formattedValues[c.index]&&(e=b.chartData[c.series.index].formattedValues[c.index]):null===e&&(e=""),e}function D(a,b,c,d){try{return x(b,c)}catch(b){return window.Highcharts.format(d,{point:a})}}exports.applyFormat=D;function E(a,b,c){var d=b.match(f),e,g,h=b;for(e=0;e<d.length;e++)g=A(a,c.point?c.point:c,d[e]),h=h.replace(d[e],g);return h}function F(a){
return a.chartUtil.CHART_TYPE_PIE===a.config.chartType||a.chartUtil.CHART_TYPE_DONUT===a.config.chartType||a.chartUtil.CHART_TYPE_PYRAMID===a.config.chartType}});