/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function a(require,exports,module){"use strict";var b=require("lodash"),c=require("logging/error-notification-handler"),d=require("system/diagnostics/log-manager"),e=d.getLogger(module.id),f=require("system/lang/event"),g=require("spa/ko/managed-view-model"),h=require("../models/widget"),i=require("./widget-editor"),j=require("../views/edit-widget-dialog-box"),k=require("system/ui/message-box"),l=require("text!../views/widget.html"),m=require("system/lang/property"),n=require("./i-widget-view-model"),o=require("mi-assert");function p(a,d,e,g){o.instanceOf(a,h,"widget"),o.assert(b.isString(d)||void 0===d,"view is string or undefined"),o.assert(b.isFunction(e)||void 0===e,"editorType is function or undefined"),q.call(this,d||l),this.__private__={},m.readOnly(this,"widget",a),m.readOnly(this,"editorType",e||i),m.readOnly(this,"editorDialogOptions",g||{}),m.readOnly(this,"minWidth",6),m.readOnly(this,"minHeight",4),m.readOnly(this,"allowRefresh",!0),m.readOnly(this,"allowGoTo",!0),
this.__private__.saveRequested=Object.resolve(f),this.__private__.layoutChanged=Object.resolve(f),this.__private__.removeRequested=Object.resolve(f),this.__private__.hideRequested=Object.resolve(f),this.errorNotificationHandler=Object.resolve(c),o.implementsInterface(this,n,module.id)}var q=Object.inherit(g,p);p.prototype.load=function(){},p.prototype.unload=function(){},p.prototype.refresh=function(){},p.prototype.redraw=function(){},p.prototype.goto=function(){},p.prototype.beforeAttach=function(a){o.ok(a)},p.prototype.afterAttach=function(a){o.ok(a)},p.prototype.beforeDetach=function(a){o.ok(a)},p.prototype.afterDetach=function(a){o.ok(a),this.dispose()},p.prototype.resize=function(a,b){o.isNumber(a),o.isNumber(b)},p.prototype.show=function(){Object.tryMethod(this,"beforeShow"),Object.tryMethod(this,"afterShow")},p.prototype.onError=function(a){throw e.error(a.stack),a},p.prototype.edit=function(){return j.show(Object.resolve(this.editorType,this),this.editorDialogOptions)},
p.prototype.hide=function(){Object.tryMethod(this,"beforeHide"),r(this).done(s.bind(null,this))};function r(a){y(a);var b=a.translate("CONFIRM_HIDE").replace("$0",a.widget.name()),c=a.translate("CONFIRMATION");return k.showOkCancel(b,c)}function s(a,b){y(a),o.isNumber(b),b||t(a)}function t(a){y(a),a.getHideRequested().raise(a)}p.prototype.getHideRequested=function(){return this.__private__.hideRequested},p.prototype.encodePath=function(a){var b="";return"undefined"!==encodeURI(a)&&(b=encodeURI(a)),b},p.prototype.remove=function(){Object.tryMethod(this,"beforeRemove"),u(this).done(v.bind(null,this))};function u(a){y(a);var b=a.translate("CONFIRM_REMOVE").replace("$0",a.widget.name()),c=a.translate("CONFIRMATION");return k.showOkCancel(b,c)}function v(a,b){y(a),o.isNumber(b),b||w(a)}function w(a){y(a),a.getRemoveRequested().raise(a)}p.prototype.getRemoveRequested=function(){return this.__private__.removeRequested},p.prototype.save=function(){this.widget.properties(this.serialize()),
this.getSaveRequested().raise(this)},p.prototype.getSaveRequested=function(){return this.__private__.saveRequested},p.prototype.notifyLayoutChanged=function(a,b){o.isString(a),o.isObject(b),x(this,a,b)};function x(a,b,c){a.getLayoutChanged().raise(a,{layoutType:b,attributes:c})}p.prototype.getLayoutChanged=function(){return this.__private__.layoutChanged},p.prototype.dispose=function(){Object.tryMethod(this,"beforeDispose"),this.getNameChanged().remove(),this.getSaveRequested().remove(),this.getLayoutChanged().remove()},p.prototype.getNameChanged=function(){return this.widget.nameChanged},p.prototype.serialize=function(){return this.widget.properties()},p.prototype.deserialize=function(){},p.prototype.uniqueID=function(){return this.widget.uniqueID()},p.prototype.widgetName=function(){return this.widget.name()},p.prototype.widgetType=function(){return this.widget.type()},p.prototype.widgetCaption=function(){return this.widget.caption()},p.prototype.icon=function(){
return"dashboard-icon-"+this.widget.type().toLowerCase()},p.prototype.localizationContext=function(a){return this.widget.localizationContext(a)};function y(a){o.instanceOf(a,p,"self")}return p});