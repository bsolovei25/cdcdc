/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function(require){"use strict";var a=require("jquery"),b=require("knockout"),c=require("system/http/ajax-client"),d=require("rounds/data-collection/device-settings/models/device-settings-model").DeviceSettingsModel,e=require("rounds/data-collection/device-settings/models/round-default-settings-model"),f=require("rounds/common/dto/lubrication-priority-dto"),g="api/internal/rounds/roundsadmin/lrprioritymapping",h=require("rounds/common/model/lr-priorities-model"),i="api/core/systemcode/code/table?tableId=",j=require("system/data/client-preferences"),k="api/core/globalization",l="inspection-timezones",m="inspection-route-sync",n=require("bluebird");require("system/lang/object");function o(a){this.ajaxClient=a,this.preferences=Object.resolve(j)}o.dependsOn=[c],o.prototype.updateLRMapping=function(c){var d=a.Deferred(),e;return e=c?this.ajaxClient.put(g,b.toJSON(c)):this.ajaxClient.get(g),e.done(p.bind(null,d)).fail(q.bind(null,d)),d.promise()};function p(a,b){a.resolve(new h(b))}
function q(a,b){a.reject(b)}o.prototype.getPriorityCodes=function b(c){var d=a.Deferred(),e=i+c;return this.ajaxClient.get(e).done(r.bind(null,d)).fail(s.bind(null,d)),d.promise()};function r(a,b){a.resolve(f.fromDataCollection(b))}function s(a,b){a.reject(b)}o.prototype.getSystemDeviceSettings=function(){var b=a.Deferred();return this.ajaxClient.get("api/internal/rounds/roundsadmin/system-device-settings").done(v.bind(null,b)).fail(q.bind(null,b)),b.promise()},o.prototype.getRoundsDefaultSettings=function(){var b=a.Deferred();return this.ajaxClient.get("api/internal/rounds/roundsadmin/rounds-default-settings").done(t.bind(null,b)).fail(q.bind(null,b)),b.promise()};function t(a,b){a.resolve(new e(b))}o.prototype.setSystemDeviceSettings=function(b){var c=a.Deferred();return this.ajaxClient.put("api/internal/rounds/roundsadmin/system-device-settings",b).done(v.bind(null,c)).fail(q.bind(null,c)),c.promise()},o.prototype.setRoundsDefaultSettings=function(a){
return this.ajaxClient.put("api/internal/rounds/roundsadmin/rounds-default-settings",a)},o.prototype.resetSystemDeviceSettings=function(a){return this.ajaxClient.delete("api/internal/rounds/roundsadmin/system-device-settings",a)},o.prototype.getUserDeviceSettings=function(){var b=a.Deferred();return n.resolve(this.ajaxClient.get("api/internal/rounds/devicesettings/user-device-settings")).catch(w.bind(null,this)).then(u.bind(null,this)).then(v.bind(null,b)),b.promise()};function u(a,b){return b=b||{deviceSettingsValue:{downloadHorizon:24,syncInterval:360,batchUploadSize:25,gisTimeout:2}},n.resolve(a.preferences.savePreference(m,b))}function v(a,b){a.resolve(new d(b))}function w(a){return n.resolve(a.preferences.retrievePreferences(m))}o.prototype.getTimezones=function(){var b=a.Deferred();return this.ajaxClient.get(k+"/timezone").done(x.bind(null,this)).done(z.bind(null,b)).fail(y.bind(null,this,b)),b.promise()};function x(a,b){a.preferences.savePreference(l,b)}function y(a,b){
a.preferences.retrievePreferences(l).done(z.bind(null,b)).fail(b.reject.bind(b))}function z(a,b){a.resolve(b)}return o.prototype.setUserDeviceSettings=function(b){var c=a.Deferred();return this.ajaxClient.put("api/internal/rounds/devicesettings/user-device-settings",b).done(u.bind(null,this)).done(v.bind(null,c)).fail(q.bind(null,c)),c.promise()},o.prototype.selectDefaultUserSettings=function(){var b=a.Deferred();return this.ajaxClient.get("api/internal/rounds/roundsadmin/system-device-settings").done(u.bind(null,this)).done(v.bind(null,b)).fail(q.bind(null,b)),b.promise()},o});