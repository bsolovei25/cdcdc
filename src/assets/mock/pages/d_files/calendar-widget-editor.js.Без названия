/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function(require){"use strict";var a=require("jquery"),b=require("lodash"),c=require("dashboard/view-models/widget-editor"),d=require("catalog/catalog-dialog"),e=require("dashboard/views/calendar-widget/calendar-widget-editor-view");require("ui/elements/localize/localize-element");function f(a){g.call(this,a,e.html),this.editorView=Object.resolve(e),this.catalogDialog=Object.resolve(d)}var g=Object.inherit(c,f);f.prototype.afterAttach=function(c){try{var d=this,e="input.form-control.disabled:eq(1)",f;Element.upgrade(c.element.querySelectorAll("mi-localize")),b.defer(function(){f=a("button.btn.pull-right.btn-primary"),f.attr("disabled",!d.widgetVM.isValid()),h(d,e),d.widgetVM.isValid.subscribe(function(a){f.attr("disabled",!a),h(d,e)})})}catch(a){g.prototype.onError.call(this,a)}};function h(b,c){a(c).css("border-color",b.widgetVM.path()?"#C0C5C5":"red")}f.prototype.afterLoad=function(){try{k(this)}catch(a){g.prototype.onError.call(this,a)}},f.prototype.afterCancel=function(){
try{m(this)}catch(a){g.prototype.onError.call(this,a)}},f.prototype.afterSave=function(a){try{l(this),this.widgetVM.reMountFC()}catch(a){g.prototype.onError.call(this,a)}},f.prototype.afterDetach=function(){try{this.editorView.detach()}catch(a){g.prototype.onError.call(this,a)}},f.prototype.choosePathFromCatalog=function(){try{this.catalogDialog.show({path:this.widgetVM.path(),itemTypes:["Query"]}).done(i.bind(null,this)).fail(j.bind(null,this))}catch(a){g.prototype.onError.call(this,a)}};function i(a,b){var c=a.widgetVM.translator.translate("CALENDAR");a.widgetVM.path(b.path),a.widgetVM.widget.name(b.id)}function j(a,b){if("cancelled"!==b)throw new Error("Unable to retrieve catalog item because: "+b)}function k(b){a.extend(b.backup,b.widgetVM.getConfig())}function l(a){a.backup.path=null,a.backup.mappings=null}function m(a){a.widgetVM.updateConfig(a.backup),l(a)}return f});