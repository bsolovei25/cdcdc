/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function(require){"use strict";var a=require("jquery"),b=require("ui/elements/chart/chart-utilities");function c(a){this.rawData=a,this.chartUtilities=new b}c.prototype.load=function(b){var c,e=[],g={},h={totalRows:this.rawData?this.rawData.length:0,categoryArray:b&&b.categoryArray?b.categoryArray:[]};return this.rawData&&(d(this,h.categoryArray,b,e,g),h.gridData={data:this.rawData},f(this,h,b,e,g)),c=a.Deferred(),c.resolve(h),c.promise()};function d(a,b,c,d,f){var g=c.aggregateProperties,h=a.rawData,i,j,k,l,m;for(e(a,c),i=0;i<h.length;i++)if(c.categoryProperty&&(b[b.length]=h[i][c.categoryProperty]),j=h[i][c.series[0].name],d.indexOf(j)<0&&(d[d.length]=j),g)for(k=0;k<g.length;k++)l=g[k],void 0===f[l]&&(f[l]=[]),m=h[i][l]||0,void 0===f[l][j]&&(f[l][j]=[]),f[l][j][f[l][j].length]=m}function e(a,b){b.chartMethod===a.chartUtilities.CHART_METHOD_COUNT?(b.pointFormat=b.pointFormat||"{series.name}: <b>{point.y:g2}</b>",
b.dataLabelFormat=b.dataLabelFormat||"{point.y:g2}"):b.chartMethod===a.chartUtilities.CHART_METHOD_PERCENT?(b.pointFormat=b.pointFormat||"{series.name}: <b>{point.y:p2}%</b>",b.dataLabelFormat=b.dataLabelFormat||"{point.y:p2}%"):b.chartMethod===a.chartUtilities.CHART_METHOD_SUM&&"stacked-column"===b.chartType?(b.pointFormat=b.pointFormat||'<span style="color:{series.color}">{series.name}</span>: <b>{point.y:g2}</b><br/>',b.dataLabelFormat=b.dataLabelFormat||"{point.y:g2}"):b.chartMethod===a.chartUtilities.CHART_METHOD_SUM&&"stacked-column"!==b.chartType&&(b.pointFormat=b.pointFormat||"{series.name}: <b>{point.y:g2}</b>",b.dataLabelFormat=b.dataLabelFormat||"{point.y:g2}")}function f(a,b,c,d,e){var f;switch(f=a.chartUtilities.translateChartType(c.series[0].chartType),c.chartMethod){case a.chartUtilities.CHART_METHOD_PERCENT:b.chartData=h(f,d,c.aggregateProperties,e,b.totalRows);break;case a.chartUtilities.CHART_METHOD_COUNT:b.chartData=i(f,d,c.aggregateProperties,e);break
;case a.chartUtilities.CHART_METHOD_SUM:b.chartData=j(f,d,c.aggregateProperties,e);break;default:b.chartData=g(f,d,c.aggregateProperties,e)}}function g(a,b,c,d){var e,f,g,h=[];for(e=0;e<b.length;e++)for(f=b[e],g=0;g<c.length;g++)h[h.length]={name:f,data:d[c[g]][f],type:a};return h}function h(a,b,c,d,e){var f,g,h,i,j=[];for(g=0;g<b.length;g++){for(i=b[g],f=[],h=0;h<c.length;h++)f[f.length]=d[c[h]][i].length/e*100;"pie"===a?(0===j.length&&(j[0]={data:[],type:"pie"}),j[0].data[j[0].data.length]=[i,f[0]]):j.push({name:i,data:f,type:a})}return j}function i(a,b,c,d){var e,f,g,h,i=[];for(f=0;f<b.length;f++){for(h=b[f],e=[],g=0;g<c.length;g++)e[e.length]=d[c[g]][h].length;i.push({name:h,data:e,type:a})}return i}function j(a,b,c,d){var e,f,g,h,i=[],j,k,l;for(f=0;f<b.length;f++){for(e=[],h=b[f],g=0;g<c.length;g++){for(k=0,l=d[c[g]][h],j=0;j<l.length;j++)k+=l[j];e[e.length]=Number(k.toFixed(4))}i.push({name:h,data:e,type:a})}return i}return c});