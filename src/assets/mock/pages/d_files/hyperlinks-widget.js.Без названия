/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function a(require,exports,module){"use strict";var b=require("dashboard/view-models/widget-view-model"),c=require("dashboard/adapters/hyperlink-adapter"),d=require("dashboard/view-models/hyperlinks-widget/hyperlinks-widget-editor"),e=require("text!dashboard/views/hyperlinks-widget/hyperlinks-widget.html"),f=require("dashboard/view-models/hyperlinks-widget/hyperlinks-layout"),g=require("system/lang/property"),h=require("system/hardware/device"),i=require("logging/error-notification-handler"),j=require("system/diagnostics/log-manager"),k=require("dashboard/view-models/hyperlinks-widget/href-cleaner"),l=j.getLogger(module.id),m=require("mi-assert");function n(a){o.call(this,a,e,d,q()),g.set(this,"minWidth",6),g.set(this,"minHeight",2),g.set(this,"allowRefresh",!1),g.set(this,"allowGoTo",!1),g.readOnly(this,"hyperlinks",this.kom.observableList()),this.region=null,this.layoutHandler=null,this.gridLayoutElement=null,this.errorNotificationHandler=Object.resolve(i)}
var o=Object.inherit(b,n);n.prototype.deserialize=function a(){var b=this.widget.properties();m.ok(b,"properties"),this.hyperlinks.items(c.deserializeAll(this,b.hyperlinks||[]))},n.prototype.afterAttach=function(a){var b=new f;this.region=a,p(this),b.setLayout(a.element),this.layoutHandler=b.setLayoutHandler.bind(b),this.gridLayoutElement=a.$element.closest("mi-grid-layout-item"),this.gridLayoutElement.on("element-resized",this.layoutHandler)};function p(a){a.region.activeContainer.style.height="auto"}n.prototype.beforeDetach=function(){this.gridLayoutElement.off("element-resized",this.layoutHandler)},n.prototype.setLayout=function(){(new f).setLayout(this.region.element)},n.prototype.serialize=function a(){return{hyperlinks:c.serializeAll(this.hyperlinks.items())}};function q(){var a="95%";return{width:a,height:a}}n.prototype.icon=function a(){return"dashboard-icon-hyperlink"},n.prototype.upgradeElements=function a(b){try{r(b)}catch(a){x(this,a)}};function r(a){var b,c
;for(b=0;b<a.length;b++)c=a[b],c.querySelector&&Element.upgrade(c.querySelector("mi-localize"))}n.prototype.cleanHref=function(a){return(new k).clean(a)},n.prototype.openHyperlink=function(a,b){try{return s(a,b)}catch(b){x(a.parent,b)}};function s(a,b){var c=new h;return(new k).clean(a.url())?c.isMobileApp()?t(a):w():(b.preventDefault(),!1)}function t(a){return u(a)?w():v(a)}function u(a){return a.url().startsWith("#")}function v(a){return window.openInExternalBrowser(a.url()),!1}function w(){return!0}function x(a,b){y(b),a.errorNotificationHandler.addError({errorMessage:b.message,errorDetail:b.stack})}function y(a){l.error(a.stack)}return n});