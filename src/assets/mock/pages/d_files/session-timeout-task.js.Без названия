/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function(require){"use strict";var a=require("mi-assert"),b=require("./i-task"),c=require("system/ui/message-box"),d=require("system/globalization/translator"),e=require("application/application-events"),f=require("application/application-context"),g=require("application/application-service"),h=require("security/view-models/login-view-model"),i=1e3,j=60,k=5,l=1,m=60;function n(){a.implementsInterface(this,b,"this"),this.appEvents=Object.resolve(e),this.translator=Object.resolve(d),this.applicationService=Object.resolve(g),this.loggingout=!1,this.promptShown=!1,this.continueMessageBox=null}n.prototype.execute=function(){if(this.loggingout!==!0){var a=o();a<=l&&x(this),this.promptShown===!0&&a>k&&(B(this.continueMessageBox),this.promptShown=!1),this.promptShown!==!0&&a<=k&&v(this)}};function o(){return p(q())}function p(a){return(r()?s():m)-a}function q(){var a=r()?t():u();return(new Date-a)/i/j}function r(){return f.connectionStatus.connected}function s(){
return f.session.sessionTimeout}function t(){return f.connectionStatus.lastResponse}function u(){return f.connectionStatus.lastUserActivity}n.prototype.testPromptToContinue=function(){v(this)},n.prototype.testPromptToLogout=function(){x(this)};function v(a){var b=a.translator.translate("SESSION_ABOUT_TO_EXPIRE"),c=a.translator.translate("CLICK_OK_TO_CONTINUE"),d=[{name:a.translator.translate("OK")}];a.promptShown=!0,a.continueMessageBox=A(a,c,b,d),a.continueMessageBox.showMessage().done(w.bind(null,a))}function w(a){a.promptShown=!1,a.continueMessageBox=null,a.applicationService.ping()}function x(a){var b=a.translator.translate("SESSION_EXPIRED_TITLE"),c=a.translator.translate("SESSION_EXPIRED_MSG"),d=[{name:a.translator.translate("CANCEL")},{name:a.translator.translate("LOGIN")}],e=null;f.sessionStatus.isActive=!1,a.appEvents.sessionChanged.raise(a,f.sessionStatus),a.appEvents.sessionExpired.raise(),a.loggingout=!0,B(a.continueMessageBox),e=A(a,c,b,d),e.showMessage().done(z)}
function y(){Object.resolve(h).forceLogout()}function z(a){1===a&&(y(),window.location.reload())}function A(a,b,d,e){return new c(b,d,e)}function B(a){null!==a&&(a.dialog.closeDialog(),a=null)}return n});