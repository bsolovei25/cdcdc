/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function(require){"use strict";var a=require("jquery"),b=require("system/http/ajax-queue"),c=require("system/http/ajax-client"),d=require("rounds/common/dto/route-info-dto").RouteInfoDTO,e=require("rounds/common/dto/route-detail-dto").RouteDetailDTO,f=require("application/application-context"),g="api/internal/rounds/inspection/",h="api/Rounds/Routes/UserRoutes/",i="api/Rounds/Routes/UserRoute/",j="api/internal/rounds/inspection/routeHistory",k="api/internal/rounds/inspection/uploadandmarkdone";function l(){this.ajaxQueue=Object.resolve(b),this.ajaxClient=Object.resolve(c)}l.prototype.batchGetRouteDetails=function(a,b,c){return m(this,a,b,c)},l.prototype.getUserRoutes=function(){var b=a.Deferred();return this.ajaxClient.get(h+"-1").done(p.bind(null,b)).fail(b.reject.bind(b)),b.promise()},l.prototype.getRouteDetail=function(b,c){var d=a.Deferred();return this.ajaxClient.get(g+b+"?horizon="+(c||"0")).done(q.bind(null,d,b)).fail(d.reject.bind(d)),d.promise()},
l.prototype.getUserRoute=function(b){var c=a.Deferred();return this.ajaxClient.get(i+b).done(s.bind(null,c)).fail(c.reject.bind(c)),c.promise()},l.prototype.deleteRouteHistoryRecord=function(a){return this.ajaxClient.put(j,a.routes,n())},l.prototype.saveReadingAndMarkDone=function(a,b){var c={routeDataCollected:a,routesToBeMarkedDone:b};return this.ajaxClient.put(k,c,n({timeout:12e5}))},l.prototype.unschedule=function(){return this.ajaxClient.delete(g+"unschedule")},l.prototype.schedule=function(a){return this.ajaxClient.post(g+"schedule",a)},l.prototype.getSchedule=function(){return this.ajaxClient.get(g+"schedule")};function m(b,c,d,e){var f=a.Deferred(),h=[],i=Object.keys(c),j,k,l;for(j=0;j<i.length;j++)k=g+i[j]+"?horizon="+(d||"0"),c[i[j]].hash&&(k+="&hash="+encodeURIComponent(c[i[j]].hash)),l=b.ajaxQueue.get(k),l.fail(f.reject.bind(f)),l.done(r.bind(null,e,i[j])),h[h.length]=l;return a.when.apply(a,h).done(f.resolve.bind(f)),f.promise()}function n(b){var c;return b=b||{},c={
headers:{MeridiumToken:f.session.id+";UTC"}},a.extend(c,b)}function o(a,b){a.resolve(b)}function p(a,b){a.resolve(d.fromDataCollection(b))}function q(a,b,c){a.resolve(new e(c,b))}function r(a,b,c,d,f){304!==f.status&&a(new e(c,b),d,f)}function s(a,b){a.resolve(new d(b))}return l});