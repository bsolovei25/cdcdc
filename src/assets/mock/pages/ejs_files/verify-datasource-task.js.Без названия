/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(["require","exports","system/lang/ioc","system/functional/maybe","application/application-context","system/hardware/device","security/services/security-service","application/ajax-event-handler"],function(require,exports,a,b,c,d){"use strict";var e=require("security/services/security-service"),f=require("application/ajax-event-handler"),g=function(){function a(a,b,c){this.service=a,this.ajaxEventHandler=b,this.device=c}return a.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var a=this;return __generator(this,function(b){return this.device.isMobileApp()?[2]:(setTimeout(function(){return a.compareDatasource()},0),[2])})})},a.prototype.compareDatasource=function(){return __awaiter(this,void 0,void 0,function(){var a=this,b,d;return __generator(this,function(e){switch(e.label){case 0:return document.hidden?[2]:document.hasFocus()?(b=c.session,[4,this.tryFetchServerSession()]):[2];case 1:return d=e.sent(),d.bind(function(a){return h(b,a)
}).tapNothing(function(){return a.ajaxEventHandler.notifySessionTimeout()}),[2]}})})},a.prototype.tryFetchServerSession=function(){return __awaiter(this,void 0,void 0,function(){var a,c;return __generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,this.fetchSession()];case 1:return a=d.sent(),[2,b.just(a)];case 2:return c=d.sent(),[2,b.nothing()];case 3:return[2]}})})},a.prototype.fetchSession=function(){return Promise.resolve(this.service.getSession())},a}();g=__decorate([a.dependsOn(e,f,d)],g);function h(a,c){return a.datasourceId===c.datasourceId?b.just(a):b.nothing()}return g});