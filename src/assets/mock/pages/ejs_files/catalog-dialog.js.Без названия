/* Copyright Â© 1993-2019 Meridium, Inc. All rights reserved.  */
define(function(require){"use strict";var a=require("jquery"),b=require("application/application-events"),c=require("spa/conductor"),d=require("system/error/error-message"),e=require("spa/ko/knockout-view-model"),f=require("knockout"),g=require("system/knockout/knockout-manager"),h=require("spa/region"),i=require("system/ui/dialog-view-model"),j=require("./services/catalog-service"),k=require("./adapters/catalog-item-adapter"),l=require("./adapters/folder-adapter"),m=require("./catalog-events"),n=require("./catalog-nav-view-model"),o=require("./catalog-dialog-details"),p=require("system/globalization/translator"),q=require("text!./views/catalog-dialog.html");require("system/lang/string"),require("system/lang/object");function r(a,b,c,d,e,f){s.call(this,q),this.applicationEvents=a,this.events=b,this.navRegion=c,this.navViewModel=d,this.detailsRegion=e,this.detailsViewModel=f,this.translator=Object.resolve(p),this.preferences=null,this.dfd=null,this.dialog=null,this.result=null}
var s=Object.inherit(e,r);r.factory=function(){return new r(Object.resolve(b),Object.resolve(m),Object.resolve(h),Object.resolve(n),Object.resolve(h),Object.resolve(o))};function t(a,b){if("a"===b)return a.translator.translate("KPI_DATASOURCE_MODEL_TYPE_MERIDIUM_ARTICLE")}function u(a,b){if("query"===b)return a.translator.translate("KPI_DATASOURCE_MODEL_TYPE_MERIDIUM_QUERY")}r.prototype.show=function b(c){var d={height:"90%",width:"90%"},e="";if(this.preferences=c,this.preferences||(this.preferences={itemTypes:[]}),this.preferences.itemTypes||(this.preferences.itemTypes=[]),this.detailsViewModel.intendedTypes=this.preferences.itemTypes,this.preferences.itemTypes)if(0!==this.preferences.itemTypes.length){for(var f="",g=0;g<this.preferences.itemTypes.length;g++)f+=t(this,String.articleFor(this.preferences.itemTypes[g]))+" "+u(this,this.preferences.itemTypes[g].toString().toLowerCase()),g!==this.preferences.itemTypes.length-1&&(f+=", "),g===this.preferences.itemTypes.length-2&&(f+="or ")
;e=String.format(this.translate("CATALOG_DIALOG_SELECT_ITEM_SPECIFIC"),f)}else e=this.translate("CATALOG_DIALOG_SELECT_ITEM");else e=this.translate("CATALOG_DIALOG_SELECT_ITEM");return this.dialog=new i(this,e,d),this.dialog.show(),this.dfd=a.Deferred(),this.dfd.promise()},r.prototype.close=function a(){this.dialog=null},r.prototype.open=function a(){},r.prototype.load=function b(c){var d=new a.Deferred;return c||(c={allowAdd:"false"}),this.navViewModel.load(c),this.detailsViewModel.load(c),d.promise()},r.prototype.activate=function a(){this.navViewModel.activate(),this.detailsViewModel.activate(),this.detailsViewModel.navigateToPath(this.preferences.path)},r.prototype.attach=function a(b){s.prototype.attach.call(this,b),this.region=b,this.navRegion.setElement(this.region.$element.find("div.catalog-nav-container")),this.navViewModel.attach(this.navRegion),this.detailsRegion.setElement(this.region.$element.find("div.catalog-details-container")),
this.detailsViewModel.attach(this.detailsRegion)},r.prototype.detach=function a(b){this.navViewModel.detach(this.navRegion),this.navRegion.clear(),this.detailsViewModel.detach(this.detailsRegion),this.detailsRegion.clear(),s.prototype.detach.call(this,b)},r.prototype.canUnload=function a(){return this.navViewModel.canUnload()&&this.detailsViewModel.canUnload()},r.prototype.deactivate=function a(b){this.navViewModel.deactivate(this.navRegion),this.detailsViewModel.deactivate(this.detailsRegion)},r.prototype.unload=function a(){this.navViewModel.unload(),this.detailsViewModel.unload(),this.dfd=null,this.result=null},r.prototype.translate=function(a){return this.translator.translate(a)},r.prototype.openSelectedItem=function a(){this.detailsViewModel.selectedItemVm()&&(this.result=k.toDTO(this.detailsViewModel.selectedItemVm()),this.dfd.resolve(this.result),this.detailsViewModel.selectedItemVm().isSelected(!1)),this.dialog.closeDialog()},r.prototype.cancel=function a(){
this.detailsViewModel.selectedItemVm()&&this.detailsViewModel.selectedItemVm().isSelected(!1),this.result=this.result=null,this.dfd.reject("cancelled"),this.dialog.closeDialog()};function v(a){}return r}),String.format=function(){"use strict";for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+(b-1)+"\\}","gm");a=a.replace(c,arguments[b])}return a},String.articleFor=function(a){"use strict";return"a"===a.charAt(0)||"A"===a.charAt(0)||"e"===a.charAt(0)||"E"===a.charAt(0)||"i"===a.charAt(0)||"I"===a.charAt(0)||"o"===a.charAt(0)||"O"===a.charAt(0)||"u"===a.charAt(0)||"U"===a.charAt(0)?"an":"a"};